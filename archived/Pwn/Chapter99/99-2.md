### 固定偏移量绕过 PIE

打开环境会给出源码及源程序（相比对国内靶场更简单了）

我们只要调用这个 `win()` 函数就可以拿到 flag

```c
void segfault_handler() {
  printf("Segfault Occurred, incorrect address.\n");
  exit(0);
}

int win() {
  FILE *fptr;
  char c;

  printf("You won!\n");
  // 打开文件
  fptr = fopen("flag.txt", "r");
  if (fptr == NULL)
  {
      printf("无法打开文件。\n");
      exit(0);
  }

  // 从文件中读取内容
  c = fgetc(fptr);
  while (c != EOF)
  {
      printf ("%c", c);
      c = fgetc(fptr);
  }

  printf("\n");
  fclose(fptr);
}

int main() {
  signal(SIGSEGV, segfault_handler);
  setvbuf(stdout, NULL, _IONBF, 0); // _IONBF = 无缓冲输出

  printf("Address of main: %p\n", &main);

  unsigned long val;
  printf("Enter the address to jump to, ex => 0x12345: ");
  scanf("%lx", &val);
  printf("Your input: %lx\n", val);

  void (*foo)(void) = (void (*)())val;
  foo();
}
```

动态调式要我们输入一个地址跳转，并给出了 `main()` 函数的地址

我们输入这个 `main()` 函数的地址后果然跳到了这个地址，要重新输入

![](https://pic1.imgdb.cn/item/6884854358cb8da5c8e18dfc.png)

检查发现保护全开，有 PIE 所以没办法直接输入在 IDA 中解析的 `win()` 函数地址

![](https://pic1.imgdb.cn/item/6884859458cb8da5c8e18e1b.png)

输入

```bash
info functions main
```

可以列出所有以 `main` 开头的函数（去掉 `main` 则是所有）

在最后一行可以看到 `main()` 函数的地址与开头对应

![](https://pic1.imgdb.cn/item/6884866358cb8da5c8e194fa.png)

同样的方法在去找下 `win()` 函数

![](https://pic1.imgdb.cn/item/6884868d58cb8da5c8e196b7.png)

计算偏移得到是十进制 150，所以打远程时减去偏移就是 `win()` 函数地址

![](https://pic1.imgdb.cn/item/688487d758cb8da5c8e19c37.png)
