## Nginx 文件上传绕过（CVE-2013-4547）
这个漏洞的原理是，Nginx 错误地解析了请求的 URI，错误地获取到用户请求的文件名，导致出现权限绕过、代码执行等连带影响

```nginx
location ~ \.php$ {
    include        fastcgi_params;

    fastcgi_pass   127.0.0.1:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME  /var/www/html$fastcgi_script_name;
    fastcgi_param  DOCUMENT_ROOT /var/www/html;
}
```

正常情况下（关闭 pathinfo 的情况下），只有 .php 后缀的文件才会被发送给 Fastcgi 解析

而存在 CVE-2013-4547 的情况下，我们请求 `1.gif[0x20][0x00].php`，这个 URI 可以匹配上正则 `\.php$`，可以进入这个 Location 块；但进入后，Nginx 却错误地认为请求的文件是 `1.gif[0x20]`，就设置其为 `SCRIPT_FILENAME` 的值发送给Fastcgi

Fastcgi 根据 `SCRIPT_FILENAME`的值进行解析，最后造成了解析漏洞

上传反弹 Shell，先添加两个空格

![](https://pic1.imgdb.cn/item/68ba91b158cb8da5c8802b9a.png)

将两个 `20` 的最后一个改为 `00`

![](https://pic1.imgdb.cn/item/68ba91de58cb8da5c8802d2c.png)

上传成功

![](https://pic1.imgdb.cn/item/68ba91f058cb8da5c8802db8.png)

访问上传的文件

![](https://pic1.imgdb.cn/item/68ba994558cb8da5c8806992.png)

成功连接

![](https://pic1.imgdb.cn/item/68ba99a658cb8da5c8806ab2.png)
