## Solon 框架任意文件读取

反编译题目给的附件

![](https://pic1.imgdb.cn/item/683c542f58cb8da5c8217bf5.png)

`Solon.start(...)`：启动 Solon 框架的应用程序

`(Class<?>) App.class`：传入当前类的字节码对象，指定启动类

`args`：传入命令行参数

`(ConsumerEx<SolonApp>) app -> {...}`：这是一个 lambda 表达式，用于传入启动后对 `SolonApp` 的配置

```java
Solon.start((Class<?>) App.class, args, (ConsumerEx<SolonApp>) app -> {
```

`StaticMappings.add(...)`：将一个 URL 路径前缀映射到实际的本地目录路径，用于处理静态资源（如 CSS、JS、图片）

`"/assets/"`：请求路径以 `/assets/` 开头时，将映射到本地路径

`new FileStaticRepository("/app/assets")`：表示本地文件系统中 `/app/assets` 目录将被用来提供静态资源

```java
StaticMappings.add("/assets/", new FileStaticRepository("/app/assets"));
```

去看看这个 `FileStaticRepository`

![](https://pic1.imgdb.cn/item/683c6f1158cb8da5c8218949.png)

`FileStaticRepository` 是一个实现了 `StaticRepository` 接口的类

`StaticRepository` 是来自 `org.noear.solon.web.staticfiles` 包的接口，定义了一个静态资源仓库的查找规范

```java
public class FileStaticRepository implements StaticRepository {
```

`location` 表示文件系统中的基础目录路径（静态资源的根目录）

```java
String location;
```

构造器传入 `location` 参数

调用了 `setLocation()` 方法设置文件根目录

```java
public FileStaticRepository(String location) {
    setLocation(location);
}
```

保护级别（`protected`）的方法

如果传入的路径为 `null`，则不设置

否则更新类中的 `location` 成员变量

```java
protected void setLocation(String location) {
    if (location == null) {
        return;
    }
    this.location = location;
}
```

**这是最关键的静态资源查找逻辑**

```java
@Override
public URL find(String relativePath) throws Exception {
    // 构造一个文件对象，相当于拼接路径 location/relativePath
    File file = new File(this.location, relativePath);
    if (file.exists()) {
        // 如果存在，则返回该文件的 URL（Web 框架会用这个返回资源）
        return file.toURI().toURL();
    }
    return null;
}
```

因为这个参数是我们可控的，所以推测存在任意文件读取漏洞

同时找到了 `/backdoor` 路由，内容应该与 flag 相关，但是不知道 `realkey`

![](https://pic1.imgdb.cn/item/683c716458cb8da5c8218a82.png)

```java
public class dashboard {
    // realkey 是一个静态常量
    public static final String realkey = "***********";

    // @Mapping("/")：映射网站根路径
    @Mapping(AntPathMatcher.DEFAULT_PATH_SEPARATOR)
    public Object index() {
        // ModelAndView 是 Solon 提供的用于返回页面模板的类
        // 使用模板引擎渲染 index.ftl（FreeMarker 模板）
        ModelAndView vm = new ModelAndView("index.ftl");
        // 返回后客户端会看到 index.ftl 渲染后的 HTML
        return vm;
    }

    // 映射 /dashboard 请求
    @Mapping("/dashboard")
    public Object dashboard() {
        // 渲染并返回 dashboard.ftl 页面模板
        ModelAndView vm = new ModelAndView("dashboard.ftl");
        return vm;
    }

    // 映射 /backdoor 请求
    // 从请求参数中提取 key 参数
    @Mapping("/backdoor")
    public String backdoor(@Param("key") String key) {
        // 如果 key 与 realkey（也就是 NlRVANA@007）相等，就从环境变量中取出 FLAG
        if (realkey.equals(key)) {
            String flag = System.getenv("FLAG");
            return "flag is " + flag;
        }
        return "you are god";
    }
}
```

注意题目刚开始给出的 `/app`，推测可能存在 `app.jar`，构造 payload

```
/assets/…/app.jar
```

![](https://pic1.imgdb.cn/item/683c730358cb8da5c8218af3.png)

反编译下载的文件拿到 `realkey`

![](https://pic1.imgdb.cn/item/683c734058cb8da5c8218b0e.png)

成功拿到 flag

![](https://pic1.imgdb.cn/item/683c738658cb8da5c8218b19.png)
