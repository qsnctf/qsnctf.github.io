## JWT 算法混淆绕过（CVE-2015-9235）

发现是个登录页面

![](https://pic1.imgdb.cn/item/6839882958cb8da5c81e242f.png)

查看源码发现泄露了登录接口

![](https://pic1.imgdb.cn/item/6839884558cb8da5c81e2805.png)

全局变量 token`

```js
let token = '';
```

登录事件处理

```js
document.getElementById('loginBtn').addEventListener('click', async () => {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    try {
        const response = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });
        const data = await response.json();
        if (response.ok) {
            token = data.token;
            // 更新 UI 显示成功，切换视图
        } else {
            // 显示后端返回的错误信息
        }
    } catch (error) {
        // 网络或解析错误处理
    }
});
```

隐藏接口处理

```js
document.getElementById('getSecretBtn').addEventListener('click', async () => {
    try {
        const response = await fetch('/get_secret', {
            method: 'GET',
            headers: { 'Authorization': token }
        });
        const data = await response.json();
        if (response.ok) {
            // 拼装并展示 data.message、data.public、data.confidential、data.flag
        } else {
            // 展示 data.error
        }
        // 显示结果区域
    } catch (error) {
        // 网络或解析错误提示
    }
});
```

登出逻辑

```js
document.getElementById('logoutBtn').addEventListener('click', () => {
    token = '';
    // 清空输入、隐藏结果、切换回登录区
});
```

Authorization 有一些常见的认证授权方案如：Basic认证、Digest认证、Beare认证、JWT 认证等

JWT 的话存在伪造等漏洞更符合 CTF

[去这个网站构造一个签名](https://jwt.io/)

![](https://pic1.imgdb.cn/item/683994bf58cb8da5c81e3c5b.png)

返回 401 错误，JWT 的算法无效

![](https://pic1.imgdb.cn/item/6839952758cb8da5c81e3c75.png)

JWT 算法存在漏洞 CVE-2015-9235，可以将 `header` 中签名算法改为 `none` 进行绕过

![](https://pic1.imgdb.cn/item/683997a758cb8da5c81e3dac.png)

修改后发送过去了只展示了 `message` 和 `public`

![](https://pic1.imgdb.cn/item/683997cb58cb8da5c81e3db7.png)

看上面分析的代码还有 `confidential` 和 `flag` 没有展示，推测应该缺少了权限

和权限相关的常见字符串如：`role`，`account`，`isAdmin` 等，分别伪造每个值为 `admin`

结果 `role` 是可用的

![](https://pic1.imgdb.cn/item/6839998c58cb8da5c81e3e25.png)
