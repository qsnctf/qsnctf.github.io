在互联网通信体系中，HTTP 协议、Cookie、Session 以及现代的 Token 机制共同构成了 Web 应用的运行基石。本文将从底层原理到应用架构，系统性地解析这些核心技术。

------

## 一、 状态管理的必要性：解决 HTTP 无状态特性

### 1.1 HTTP 的无状态性（Stateless）

HTTP 协议在设计之初，主要用于超文本文件的传输。其核心设计原则是**无状态**：服务器处理的每一个请求都是完全独立的。服务器不会记录之前请求的上下文信息，也不具备识别“回头客”的能力。

### 1.2 状态管理的应用场景

随着 Web 2.0 的发展，交互式应用（如电子商务、社交网络）需要服务器能够识别用户的连续操作。例如，用户在“添加购物车”后跳转到“结算页面”，服务器必须知道这两个操作来自同一个用户。

为了弥补协议本身的缺陷，业界引入了状态管理机制，即通过额外的手段在客户端与服务端之间维持一份“交互记忆”。

------

## 二、 HTTP 请求方法详解

HTTP 方法（也称为动词）明确了客户端意图对服务器资源执行的操作。

### 2.1 基础方法

- **GET**：请求获取指定的资源。参数通过 URL 的查询字符串传递。它是幂等的（多次执行结果相同）且安全的（不应修改服务器状态）。
- **POST**：向指定资源提交数据，通常用于创建新资源或提交表单。数据包含在请求体中，是非幂等的。

### 2.2 进阶方法

- **PUT**：上传指定的资源以替换目标资源。通常用于完整更新。
- **PATCH**：对资源进行部分修改。与 PUT 不同，它仅包含需要更新的字段。
- **DELETE**：请求删除指定的资源。
- **HEAD**：与 GET 类似，但服务器仅返回响应头，不返回响应体。常用于检查资源是否存在或最后修改时间。
- **OPTIONS**：用于查询服务器支持的通信选项，常用于跨域请求（CORS）中的预检请求。
- **TRACE**：回显服务器收到的请求，主要用于诊断或测试。
- **CONNECT**：建立一个到由目标资源标识的服务器的隧道。

------

## 三、 Cookie：客户端状态存储方案

### 3.1 定义与原理

Cookie 是由服务器发送给浏览器并保存在本地的一小段文本数据。当浏览器再次向同一服务器发送请求时，会自动在请求头中携带这些数据。

### 3.2 关键属性

- **Expires/Max-Age**：定义 Cookie 的生命周期。
- **Domain/Path**：限制 Cookie 的作用域（哪些域名或路径可以访问）。
- **HttpOnly**：设置后，JavaScript 无法读取 Cookie，能有效防御 XSS 攻击。
- **Secure**：强制 Cookie 仅通过 HTTPS 协议传输。
- **SameSite**：控制第三方 Cookie 的发送，用于防御 CSRF 攻击。

------

## 四、 Session：服务端状态管理机制

### 4.1 定义与原理

Session 是一种将会话数据存储在服务器端的方案。与 Cookie 不同，Session 存储的是敏感的业务数据，而客户端仅保留一个唯一的识别码（Session ID）。

### 4.2 工作全过程

1. **初始阶段**：用户通过 POST 请求提交凭据（如用户名密码）。
2. **创建会话**：服务器验证成功后，在内存、文件或数据库（如 Redis）中创建一条 Session 记录。
3. **分发 ID**：服务器通过响应头的 `Set-Cookie` 字段，将生成的 Session ID 发送给浏览器。
4. **身份重识别**：后续请求中，浏览器携带 Session ID，服务器根据 ID 检索对应的会话数据。

------

## 五、 Cookie 与 Session 的深度对比

| **维度**       | **Cookie**                   | **Session**                          |
| -------------- | ---------------------------- | ------------------------------------ |
| **存储位置**   | 客户端浏览器                 | 服务器（内存/数据库/文件）           |
| **安全性**     | 较低，数据对用户可见且易伪造 | 较高，敏感数据不离开服务器           |
| **数据容量**   | 每个域名通常限制 4KB 左右    | 理论上不受限制，取决于服务器硬件     |
| **服务器压力** | 无压力                       | 随用户量增加，服务器内存消耗增大     |
| **跨域限制**   | 受同源策略限制较严           | 依赖 Cookie 传输 ID 时受同源策略限制 |

------

## 六、 现代演进：Token 与 JWT

在分布式系统和移动端应用中，传统的 Session 机制面临跨服务器同步困难的问题。由此产生了 **Token（令牌）** 机制，尤其是 **JWT (JSON Web Token)**。

### 6.1 JWT 的结构

JWT 包含三部分：Header（头部）、Payload（负载）、Signature（签名）。它将用户信息加密后存放在客户端。

### 6.2 优势

- **无状态化**：服务器不需要存储会话数据，通过校验签名即可确认身份。
- **跨平台**：天然支持移动端和跨域名调用（通过 Authorization Header 传输）。